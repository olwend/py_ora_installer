CATEGORY_CODE,COMMITTER_ID,DISPLAY_ORDER,ID,PROCESS_ID,PROCESS_NAME,SCRIPT,STATE_INDEX,STATE_NAME,TEMPLATE,VALIDATOR_ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <endrec>
"CUSTOMER","","1","1","1000","Buy Airtime","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__params.ReceiverPartyIdentifier = '737373'; /* China Mobile's short code */
beneficiaries = IC.queryCustListBeneficiary(msisdn);
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","3","10001","1025","Customer Buy Goods","var input = __input.response;
if (empty(input)) { 
__next = '1';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '2';
}","1","Enter Till Number","<html>
<body>
Enter Till Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","10002","20502","Operator Create Account","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';","2","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","1001","1010","Activate Till","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'Activate';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */ 
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","4","10016","2076","Redeem Coupon","var input = __input.response;
if (!empty(input)) {
 __params.PrimaryPartyIdentifier = input;
 __next = '4';
} else {
 __next = '3';
}","3","Enter Organization Short Code","<html>
<body>
Enter Organization Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","1002","1010","Activate Till","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(languages)) {
  __params.@BODY@LanguageCode = languages.get(i).toString();
  __next = '2';
} else {
  __next = '1';
}","1","Select Language","<html>
<body>
Language<br>
$$languages = IC.queryAllLanguages();
$$var i = 1;
$$for (lang: languages) {
  ${i} ${lang.getDisplayName(identity.locale)}<br>
$$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","1003","1010","Activate Till","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';
","2","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","1004","1010","Activate Till","var input = __input.response;
__params.OldPIN = input;
__params.@HEAD@PIN = input;
__secure = true;
__next = '4';
","3","Enter initial PIN","<html>
<body>
Enter initial PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","1005","1010","Activate Till","var input = __input.response;
__params.NewPIN = input;
__secure = true;
__next = '5';","4","Enter New PIN","<html>
<body>
Enter New PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10050","1100","IMT Request Quote","var input = __input.response;
if (empty(input)) { 
__next = '6';
} else {
__params.IMTRoutingFactor = input;
__next = '6';
}","5","Enter IMTRoutingFactor","<html>
<body>
Enter IMTRoutingFactor<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10051","1100","IMT Request Quote","var input = __input.response;
if (empty(input)) { 
__next = '7';
} else {
__params.OtherURI = input;
__next = '7';
}","6","Enter OtherURI","<html>
<body>
Enter OtherURI<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10052","1101","IMT Transfer Abroad","var input = __input.response;
if (empty(input)) { 
__next = '6';
} else {
__params.IMTRoutingFactor = input;
__next = '6';
}","5","Enter IMTRoutingFactor","<html>
<body>
Enter IMTRoutingFactor<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10053","1101","IMT Transfer Abroad","var input = __input.response;
if (empty(input)) { 
__next = '7';
} else {
__params.OtherURI = input;
__next = '7';
}","6","Enter OtherURI","<html>
<body>
Enter OtherURI<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","1006","1010","Activate Till","var input = __input.response;
if(__params.NewPIN == input)
{
__next = '6';
}
else
{
__next = '4';
}","5","Confirm new PIN","<html>
<body>
Confirm new PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","1007","1010","Activate Till","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to Activate Till?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","101","1001","Deposit Money","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","10101","20502","Operator Create Account","var input = __input.response;
__params.ReceiverPartyIdentifier= input;
__next = '2';","1","Enter Organization Short Code","<html>
<body>
Enter Organization Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","10107","2137","Organization Withdraw to Bank for Web","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","10108","2137","Organization Withdraw to Bank for Web","__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;

var bankCardID= CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCardID');
var bankId= CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankId');
var partnerBank= CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PartnerBank');
var queryFee = false;
if(null == bankId || empty(bankId))
{
   CurResp.getResponse().getHeader().setResultCode('TS28009');
   CurResp.getResponse().getHeader().setResultMessage('The Parameter BankId is Empty.');
    __next = 'error';
}
else if(bankId > 0)
{
     if(empty(partnerBank) || '0' == partnerBank)
     {
	    CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReasonTypeCode','10000090');
            CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ServiceCode','2204');
            CurReq.setReceiverParty('10','8000','200000000000010001');
            queryFee = true;
     }
     else if('1' == partnerBank)
     {
	    CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReasonTypeCode','10002840');
            CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ServiceCode','Online Org Withdraw');
            CurReq.setReceiverParty('10','8000','200000000000010001');
            queryFee = true;
     }

     else
     {
         CurResp.getResponse().getHeader().setResultCode('TS28009');
         CurResp.getResponse().getHeader().setResultMessage('The Parameter PartnerBank Error.');
	  __next = 'error';
     }
}
else if (bankId == -2)
{
        CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReasonTypeCode','10002840');
        var bankSwitchingOrgShortCode = IC.getBankSwitchingOrganizationShortCode();
        if(empty(bankSwitchingOrgShortCode))
        {
               CurResp.getResponse().getHeader().setResultCode('TS28009');
               CurResp.getResponse().getHeader().setResultMessage('The System Parameter Bank Switching Organization Short Code is Empty.');
               __next='error';
        }
        else
        {
              CurReq.setReceiverParty('04','5000',bankSwitchingOrgShortCode );
              queryFee = true;
        }
}
else
{
    CurResp.getResponse().getHeader().setResultCode('TS28009');
    CurResp.getResponse().getHeader().setResultMessage('The Parameter BankId Error.');
    __next = 'error';
}

if('true' == queryFee)
{
      var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);

	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId,__params);

	if(__params.get('BudgetResult') == '0')
	{
		 var tips = '';
		  tips = tips+'You will pay ' ;
		  var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
		  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
		  tips = tips + IC.formatAmount(currency, amount);
  
		  tips = tips+' to ';
  
		  var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
		  __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
		  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
		  var maskname=   (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty  (cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);
  
		  tips = tips  +maskname;
		  tips = tips + ', Phone number ';
		  tips = tips + cust.basicIdentifier;
  
		  tips = tips +'. ';
 

		CurResp.putToBody('CalculateFeeResponse.tips', tips);
	}
__next = '2';
}
else
{
CurResp = TargetService.invokeForScript(); 
__next='end';
}
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","3","10112","2137","Organization Withdraw to Bank for Web","var resultType =   CurReq.getValueFromBody('TransactionEventRequest.ResultType');
__params.put('ResultType',resultType);
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

if (resultType == '0')
{ 
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	__params.put('Common.Result.ErrorCode','TS28009');
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
	
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);
	__next='cancel';
}
TC.savingPreValidationEventLog(__params);","2","Do Organization Withdraw to Bank","Do Organization Withdraw to Bank",""<endrec>
"Pre-Validation","","4","10113","2137","Organization Withdraw to Bank for Web","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
//NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","error occurs.",""<endrec>
"TILL","","1","10114","2138","Link Static QR-Code","__params.ServiceCode = __service.serviceCode;
__params.ActionType='LinkMyStaticQRCode';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","10118","2138","Link Static QR-Code","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input == '2') {
  __next = '3';
}else {
  __next = '1';
}","1","Select Link QRcode","<html>
<body>
Link identityfier QRCode :<br>
1 Serial Number <br>
2 QR-Code <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","10119","2138","Link Static QR-Code","var input = __input.response;
if (!empty(input)) {
  __params.SN = input;
  __next = '4';
} else {
  __next = '2';
}","2","Enter Serial Number","<html>
<body>
Enter Serial Number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","10120","2138","Link Static QR-Code","var input = __input.response;
if (!emtpy(input)) {
  __params.@HEAD@PIN = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","10121","2138","Link Static QR-Code","var input = __input.response;
if (input == '1') {
  __next = 'end'
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html><body>Confirm to Link ?<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","10124","2138","Link Static QR-Code","var input = __input.response;
if (!empty(input)) {
  __params.QRCode = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter QR-Code","<html>
<body>
Enter QR-Code <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","10131","20107","Customer Intra-Account Transfer Saving to Saving","var input = __input.response;
if (Validator.isAmount(input)) {
__params.Amount = TC.convertAmountFormat(input);
__secure = true;
 __next = '2';
}
else {
 __next = '1';
}","1","Input Amount","<html>
<body>Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","10132","2140","Operator Query Static QR-Code","__params.ServiceCode = __service.serviceCode;
__params.ActionType='QueryMyStaticQRCode';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","8","10133","20028","Customer Intra-Account Transfer m-pesae  to Saving","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","6","Confirm","<html>
<body>
Confirm to Intra_Account Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","10134","2140","Operator Query Static QR-Code","var input = __input.response;
if (!emtpy(input)) {
  __params.@HEAD@PIN = input;
  __next = 'end';
} else {
  __next = '1';
}","1","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10135","1024","Customer pay bill","var input = __input.response;
__next = '5';","11","Select BillReference","<html>
<body>
Please Select Organization Beneficiary:<br>
$$ var index = 1;
$$ for (orgBeneficiary: orgBeneficiaries){
 ${index} : ${orgBeneficiary.BeneficiaryShortCode} ${orgBeneficiary.BillReference} ${orgBeneficiary.BeneficiaryReference} <br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10140","20107","Customer Intra-Account Transfer Saving to Saving","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                CurrencyCode =  type;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10141","20107","Customer Intra-Account Transfer Saving to Saving","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.PrimaryAccountNo= type.AccountNo;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose From AccountNo","<html>
<body>
Please select Origin account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Savings Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10145","20107","Customer Intra-Account Transfer Saving to Saving","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.ReceiverAccountNo = type.AccountNo;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Choose To AccountNo","<html>
<body>
Please select Destination account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Savings Account' ,CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","102","1001","Deposit Money","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';
","1","Enter phone no","<html>
<body>
Enter phone no<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10202","20107","Customer Intra-Account Transfer Saving to Saving","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","10213","20203","Org Intra Account org float to org float","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Enter PIN","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10228","2164","Query CustomerFF","__params.ActionType='QueryCustomerFF';
__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","10229","2164","Query CustomerFF","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
 __params.@HEAD@PIN = input;
    __next = '2';
} else {
    __secure = true;
    __next = '1';
}","1","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10230","2164","Query CustomerFF","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10231","2165","Manage CustomerFF","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","10232","2165","Manage CustomerFF","var input = __input.response;
if (input == '1') {
__params.ActionType = 'AddCustomerFF';
__next = '2';
} else if (input == '2') {
__params.ActionType = 'ModifyCustomerFF';
__next = '2';
}else if (input == '3') {
__params.ActionType = 'DeleteCustomerFF';
__next = '2';
}else{
__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Add CustomerFF<br>
2 Modify CustomerFF<br>
3 Delete CustomerFF<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10233","2165","Manage CustomerFF","var input = __input.response;
__params.FFMSISDN = input;
if(__params.ActionType == 'AddCustomerFF'){
__next = '4';
}else if(__params.ActionType == 'DeleteCustomerFF'){
__next = '6';
}else{
__next = '3';
}","2","Enter MSISDN","<html>
<body>
Enter MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10234","2165","Manage CustomerFF","var input = __input.response;
__params.FFTargetMSISDN = input;
__next = '5';","3","Enter New MSISDN","<html>
<body>
Enter new MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","10235","2165","Manage CustomerFF","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to change?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10237","2165","Manage CustomerFF","var input = __input.response;
__params.FFNameList = input;
if(__params.ActionType == 'AddCustomerFF'){
__next = '6';
}else{
__next = '5';
}","4","Enter FnFNickName","<html>
<body>
Enter FnFNickName
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10238","2165","Manage CustomerFF","var input = __input.response;
__params.FFTargetNameList = input;
__next = '6';","5","Enter New FnFNickName","<html>
<body>
Enter new FnFNickName
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10239","2165","Manage CustomerFF","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
 __params.@HEAD@PIN = input;
    __next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","10243","2167","Manage Preferred Contact","__params.ServiceCode = __service.serviceCode;
__params.ActionType='QueryPrefContact';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; 
__params.ReceiverPartyIdentifierType = '04';
__params.ReceiverPartyIdentifier = identity.shortCode;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","12","10247","2167","Manage Preferred Contact","var input = __input.response;
if (input == '1') {
  __next = 'end'
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '11';
}","11","Confirm","<html><body>Confirm to operate ?<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","10249","2167","Manage Preferred Contact","var input = __input.response;
if (input == '1') {
__params.ActionType = 'AddPrefContact';
__next = '2';
} else if (input == '2') {
__params.ActionType = 'UpdatePrefContact';
__next = '2';
}else if (input == '3') {
__params.ActionType = 'DeletePrefContact';
__next = '2';
}else{
__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Add PrefContact<br>
2 Update PrefContact<br>
3 Delete PrefContact<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","10250","2167","Manage Preferred Contact","var input = __input.response;
__params.PFMSISDN = input;
if(__params.ActionType == 'AddPrefContact'){
__next = '3';
}else if(__params.ActionType == 'DeletePrefContact'){
__next = '4';
}else{
__next = '6';
}","2","Enter Msisdn","<html>
<body>
Enter MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","10251","2167","Manage Preferred Contact","var input = __input.response;
__params.PFNameList = input;
if(__params.ActionType == 'AddPrefContact'){
__next = '4';
}","3","Enter Customer Nickname","<html>
<body>
Enter Customer Nickname<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","10252","2167","Manage Preferred Contact","var input = __input.response;
__params.PFShortCode = input;
if(__params.ActionType == 'AddPrefContact'){
__next = '5';
}else if(__params.ActionType == 'DeletePrefContact'){
__next = '10';
}else{
__next = '8';
}","4","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","10253","2167","Manage Preferred Contact","var input = __input.response;
__params.PFOrgNameList = input;
if(__params.ActionType == 'AddPrefContact'){
__next = '10';
}","5","Enter Orginization Nickname","<html>
<body>
Enter Orginization Nickname<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","10254","2167","Manage Preferred Contact","var input = __input.response;
__params.PFTargetMSISDN = input;
if(__params.ActionType == 'UpdatePrefContact'){
__next = '7';
}","6","Enter Target Msisdn","<html>
<body>
Enter Target Msisdn<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","10255","2167","Manage Preferred Contact","var input = __input.response;
__params.PFTargetNameList = input;
if(__params.ActionType == 'UpdatePrefContact'){
__next = '4';
}","7","Enter Target Customer Nickname","<html>
<body>
Enter Target Customer Nickname<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","10256","2167","Manage Preferred Contact","var input = __input.response;
__params.PFTargetShortCode = input;
if(__params.ActionType == 'UpdatePrefContact'){
__next = '9';
}","8","Enter Target Short Code","<html>
<body>
Enter Target Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","10257","2167","Manage Preferred Contact","var input = __input.response;
__params.PFTargetOrgNameList = input;
if(__params.ActionType == 'UpdatePrefContact'){
__next = '10';
}","9","Enter Target Orginization Nickname","<html>
<body>
Enter Target Orginization Nickname<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","10258","2167","Manage Preferred Contact","var input = __input.response;
if (!empty(input)) {
  __params.@HEAD@PIN = input;
  __next = '11';
} else {
  __next = '10';
}","10","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","10259","2168","Query Preferred Contact","__params.ServiceCode = __service.serviceCode;
__params.ActionType='QueryPrefContact';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; 
__params.ReceiverPartyIdentifierType = '04';
__params.ReceiverPartyIdentifier = identity.shortCode;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","4","10260","2168","Query Preferred Contact","var input = __input.response;
if (input == '1') {
  __next = 'end'
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html><body>Confirm to Query?<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","10261","2168","Query Preferred Contact","var input = __input.response;
__params.ActionType = 'QueryPrefContact';
if (input == '1') {
	__params.ContactType = '0';
	__next = '2';
}else if(input == '2'){
	__params.ContactType = '2';
	__next = '2';
}else if(input == '3'){
	__params.ContactType = '1';
	__next = '2';
}else{
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 All of the preferred Contact<br>
2 Orginization preferred Contact<br>
3 Customer preferred Contact<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","10270","2168","Query Preferred Contact","var input = __input.response;
if (!empty(input)) {
  __params.@HEAD@PIN = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","10288","1598","Organization Transfer from M-Pesa to Bank","var input = __input.response;
if (input == '1') {
   __params.confirm = 'Yes';
  __next = 'end';
} else if (input == '0') {
  __params.confirm = 'No';
  __next = 'end';
} else {
  __next = '13';
}","13","Confirm Switch To Offline Mode","<html>
<body>
Transaction will switch to offline mode for FI system is in maintenance:<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","103","1001","Deposit Money","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","10362","2195","Add Group Member With Prevalidation for STK","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
cust = IC.queryIdentityName(CurReq.getValueFromBody('AddGroupMemberRequest.Initiator.IdentifierType'), 
                                           CurReq.getValueFromBody('AddGroupMemberRequest.Initiator.Identifier'),
                                             '01', CurReq.getValueFromBody('AddGroupMemberRequest.InvitedMSISDN'));
__params.LogId=__sessionId;
__params.IsRecordPreLog='1';
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","10363","2195","Add Group Member With Prevalidation for STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
 __params.put('ResultType','0');
 __params.Reason=""Continue Pre-Validation Transaction."";
 __params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
 IC.cnsConfirmationProcess(OriginalReq.getIdentifierDef('Initiator'),'01');
 CurResp = TargetService.invokeForScript(); 
 TC.savingPreValidationEventLog(__params);
 __next='end';
}
else
{ 
 var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
 if(resultType == '2' || resultType == '3')
 {
  __params.errDesc='Pre-Validation Result is Rejected.';
  __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
   if(__params.IsCNSDataDisplayed == 'Yes')
   {
     IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'),'01');
   }
 }
 else if(resultType == '4')
 {
 __params.errDesc='Pre-Validation confirmation is Timeout.';
 __params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
 }
 else
 {
 __params.errDesc=""Pre-Validation Request Failed."";
 __params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
 } 
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);
TC.savingPreValidationEventLog(__params);
__next='cancel';
}","2","Pre-Validataion Result","Pre-Validataion Result",""<endrec>
"Pre-Validation","","2","10364","2195","Add Group Member With Prevalidation for STK","var identityServiceInfoAcc = IC.queryIdentityAndServiceByMsisdn(CurReq.getIdentifierDef('Initiator').identifier);
if('04' != identityServiceInfoAcc.identityInfo.identityStatus.toCode())
{

if(!IC.isSupportCustomerNameSearch() || cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01')
{
__params.put('ResultType','0');
__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
CurResp = TargetService.invokeForScript(); 
TC.savingPreValidationEventLog(__params);
__next='end';
}
else
{
  var promptText  = 'Are you sure to add ';
  __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
	  
    if (cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
    {
      if(cust.subType  == '1000')
      {
        promptText = promptText  + 'the unregistered Customer,';
      }
      else if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
      {
        var nameStr= (empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName +' ');		

	promptText = promptText + 'Customer ' + IC.maskIdentityName(nameStr) + ',';
        if(nameStr != '')
        {
           __params.IsCNSDataDisplayed = 'Yes';
        }
      }
    } 	
	promptText = promptText + ' Phone number ' + cust.basicIdentifier + ' to the group?';

	promptText = promptText + ' \n1. Yes\n2. No';
		
__params.InitiatorIdentifier = CurReq.getIdentifierDef('Initiator').identifier;
__params.InitiatorIdentifierType = '01';
__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
accessDevice = CurReq.getIdentifierDef('AccessDevice');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
AG.sendTransOutgoing(CurReq,__params,'19');
__next = '2';
}
}
else
{
CurResp = TargetService.invokeForScript(); 
__next='end';
}","1","Do Pre-Validation","Do Pre-Validation",""<endrec>
"Pre-Validation","","4","10365","2195","Add Group Member With Prevalidation for STK","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc='Pre-Validation confirmation is Timeout.';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
IC.cnsConfirmationProcess(OriginalReq.getIdentifierDef('Initiator'),'01');
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
  if(__params.IsCNSDataDisplayed == 'Yes')
  {
    IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'),'01');
  }
__params.errDesc='Pre-Validation confirmation is Timeout.';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","1","10390","2202","Orgnazation Transfer from M-Pesa to Bank for USSD","__next = '1';
 __params.Channel = __accessChannel;","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","10391","2202","Orgnazation Transfer from M-Pesa to Bank for USSD","_params.IsRecordTransLog='1';
var offlineMode = IC.sendOfflineWithdrawRequest(CurReq);","1","Initiate Transaction","Select Transfer Mode",""<endrec>
"Pre-Validation","","1","10394","2204","Transfer from M-Pesa to Bank By USSD","__next = '1';
 __params.Channel = __accessChannel;
 __params.OfflineServiceCode= '2205';
__params.TxnIndex='23314';","begin","set parammeters","set parammeters",""<endrec>
"Pre-Validation","","2","10395","2204","Transfer from M-Pesa to Bank By USSD","result = IC.sendOfflineWithdrawRequest(CurReq,__params);
if(""SUCCESS"" != result)
{
   notificationInfoList = IC.queryNotificationMsisdn(CurReq,'AccessDevice','500000000000010001');
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.TransactionUMCPreValidationError= result;
__params.put('Common.Result.ErrorCode','TS28009');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);

}","1","Select TransMode","Select TransMode",""<endrec>
"TILL","","4","104","1001","Deposit Money","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';","3","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10425","2210","Customer Query 3rd Bill And Payment","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.sessionId = universalSessionID.channelSessionID;

__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","10426","2210","Customer Query 3rd Bill And Payment","var input = __input.response;

if(empty(input)){
     __next = '1';
}else{

    var orgStatus = IC.queryOrgStatusByShortCode(input);
    if(!empty(orgStatus) && orgStatus =='03'){
        __params.ReceiverPartyIdentifier = input;
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode',input);
        __next = '2';
    }else{
        __errormsg='Sorry,the third party is not in active or the third party is not exist,please try later.';
        __next='error';
    }
}","1","Input Receiver Organization Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10427","2210","Customer Query 3rd Bill And Payment","var input = __input.response;
if(empty(input)){
     __next = '2';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',input);
   
    __next = '3';
}","2","Input KYC Fields","<html>
<body>
Input You FirstName<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10428","2210","Customer Query 3rd Bill And Payment","var input = __input.response;
if(empty(input) || !IC.verifyIdentityPIN(__params.InitiatorIdentifierType,__params.InitiatorIdentifier,input)){
	__next = '3';
}else{

       var pinStatus = IC.queryPinStatusByIdentifier(__params.InitiatorIdentifier,__params.InitiatorIdentifierType);
        if(empty(pinStatus) || pinStatus != '1'){
                __errormsg = 'Sorry, your pin is not in normal.';
		__next='error';
        }else{

        __params.PIN = input;
	__params.put('TransOutgoingRequest@LIST@Param.Identifier',__params.InitiatorIdentifier);
	__params.put('TransOutgoingRequest@LIST@Param.IdentifierType',__params.InitiatorIdentifierType);
        __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
        __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
        __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__params.sessionId);

	
	var result=AG.sendSyncTransOutgoing(__params,'52');
	
	if(empty(result) || empty(result.header)){
		__errormsg = 'Sorry, Query 3rd bill error';
		__next='error';
	}else  if(result.header.resultCode != '0'){
                __errormsg = 'Sorry, Third Party Response error,please try later.';
                __next='error';
        }else{
__params.ResultType='0';
                __params.EventType='QUERY_BILL';


                __params.Reason=""Query Third Party Bills Success"";
                __params.ResultCode='0';
                TC.savingPreValidationEventLog(__params);
		billListStr = result.msgBody.GenericParameters;
                
                if(!empty(billListStr)){
                    billList = Util.stringSplit(billListStr,';');
                }
                __next='4';
        }
    }
}","3","Input PIN","<html>
<body>
Input You PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10435","2210","Customer Query 3rd Bill And Payment","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10437","2210","Customer Query 3rd Bill And Payment","var input = __input.response;

if(empty(input) || !Validator.isDigit(input) || size(billList)<Util.toLong(input)){
    __next='4a';
}else if(input == '0'){
    __next='cancel';
}else{

    __params.remove('TransOutgoingRequest@LIST@Param.Identifier');
    __params.remove('TransOutgoingRequest@LIST@Param.IdentifierType');
    __params.remove('TransOutgoingRequest@LIST@Param.TransTime'); 
    __params.remove('TransOutgoingRequest@LIST@Param.GenericParameters');
    __params.remove('TransOutgoingRequest@LIST@Param.ConversationID');
    __params.remove('TransOutgoingRequest@LIST@Param.ShortCode');
    __params.remove('TransOutgoingRequest@LIST@Param.FirstName');

    var paymentBill=billList.get(Util.toLong(input)-1);
    var billInfoList = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfoList ){
        tempStrList=Util.stringSplit(billInfo,':');
        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
	        __params.BillReferenceNumber=tempStrList[1];
	    }else if(billInfo.contains('BillAmount')){
	        __params.Amount=tempStrList[1];

	    }else if(billInfo.contains('CurrencyCode')){
	        __params.Currency=tempStrList[1];
	    }
        }
    }
    
    __next='5';
}","4","Show Bill List","<html>
<body>
$$if (empty(billList)){
Third party cannot find your bill.
$$}else{
Your bills are as follows,please select bill to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10438","2211","Group Query 3rd Bill And Payment","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.sessionId = universalSessionID.channelSessionID;

__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","10439","2211","Group Query 3rd Bill And Payment","var input = __input.response;

if(empty(input)){
     __next = '1';
}else{
    var orgStatus = IC.queryOrgStatusByShortCode(input);
    if(!empty(orgStatus) && orgStatus =='03'){
        __params.ReceiverPartyIdentifier = input;
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode',input);
        __next = '2';
    }else{
        __errormsg='Sorry,the third party is not in active or the third party is not exist,please try later.';
        __next='error';
    }
}","1","Input Receiver Organization Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10440","2211","Group Query 3rd Bill And Payment","var input = __input.response;
if(empty(input)){
    __next = '2';
}else{
    __params.PrimaryPartyIdentifier = input;

    var groupInfo=IC.queryGroupInfo('15',__params.PrimaryPartyIdentifier);
    if(empty(groupInfo)){
        __errormsg='Sorry,Can not find Group Info,please try again later.';
        __next='error';
    }else{
        __params.put('TransOutgoingRequest@LIST@Param.Identifier',input);
        __params.put('TransOutgoingRequest@LIST@Param.IdentifierType','15');
        __next='3';
    }
}","2","Input the Initiator Group Code","<html>
<body>
Input the Initiator Group Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10441","2211","Group Query 3rd Bill And Payment","var input = __input.response;
if(empty(input)){
     __next = '3';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',input);
   
    __next = '4';
}","3","Input KYC Fields","<html>
<body>
Input Group Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10442","2211","Group Query 3rd Bill And Payment","var input = __input.response;

if(empty(input) || !Validator.isDigit(input) || size(billList)<Util.toLong(input)){
    __next='5a';
}else if(input == '0'){
    __next='cancel';
}else{

    __params.remove('TransOutgoingRequest@LIST@Param.Identifier');
    __params.remove('TransOutgoingRequest@LIST@Param.IdentifierType');
    __params.remove('TransOutgoingRequest@LIST@Param.TransTime'); 
    __params.remove('TransOutgoingRequest@LIST@Param.GenericParameters');
    __params.remove('TransOutgoingRequest@LIST@Param.ConversationID');
    __params.remove('TransOutgoingRequest@LIST@Param.ShortCode');
    __params.remove('TransOutgoingRequest@LIST@Param.GroupName');


    var paymentBill=billList.get(Util.toLong(input)-1);
    var billInfoList = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfoList ){
        tempStrList=Util.stringSplit(billInfo,':');
        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
	        __params.BillReferenceNumber=tempStrList[1];
	    }else if(billInfo.contains('BillAmount')){
	        __params.Amount=tempStrList[1];

	    }else if(billInfo.contains('CurrencyCode')){
	        __params.Currency=tempStrList[1];
	    }
        }
    }
    __next='6';
}","5","Show Bill List","<html>
<body>
$$if (empty(billList)){
Third party cannot find your bill.
$$}else{
Group bills are as follows,please select bill to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10443","2211","Group Query 3rd Bill And Payment","var input = __input.response;

if(empty(input) || !IC.verifyIdentityPIN(__params.InitiatorIdentifierType,__params.InitiatorIdentifier,input)){
	__next = '4';
}else{
       var pinStatus = IC.queryPinStatusByIdentifier(__params.InitiatorIdentifier,__params.InitiatorIdentifierType);
        if(empty(pinStatus) || pinStatus != '1'){
                __errormsg = 'Sorry, your pin is not in normal.';
		__next='error';
        }else{
        __params.PIN = input;
        __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
        __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
        __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__params.sessionId);

	var result=AG.sendSyncTransOutgoing(__params,'52');
	if(empty(result) || empty(result.header)){
		__errormsg = 'Sorry, Query 3rd bill error';
		__next='error';
	}else  if(result.header.resultCode != '0'){
                __errormsg = 'Sorry, Third Party Response error,please try later.';
                __next='error';
        }else{
__params.ResultType='0';
__params.EventType='QUERY_BILL';
                __params.Reason=""Query Third Party Bills Success"";
                __params.ResultCode='0';
                TC.savingPreValidationEventLog(__params);
		billListStr = result.msgBody.GenericParameters;
                


                if(!empty(billListStr)){
                    billList = Util.stringSplit(billListStr,';');
                }
                __next='5';
        }
    }
}","4","Input Initiator PIN","<html>
<body>
Input Initiator PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","10444","2211","Group Query 3rd Bill And Payment","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","10445","2212","Organization Query 3rd Bill And Payment","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.sessionId = universalSessionID.channelSessionID;

__params.AccessDeviceIdentifierType = '01';   /* MSISDN */ 
 __params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
 __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */


__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","10446","2212","Organization Query 3rd Bill And Payment","var input = __input.response;

if(empty(input)){
     __next = '1';
}else{
    var orgStatus = IC.queryOrgStatusByShortCode(input);
    if(!empty(orgStatus) && orgStatus =='03'){
        __params.ReceiverPartyIdentifier = input;
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode',input);
        __next = '2';
    }else{
        __errormsg='Sorry,the third party is not in active or the third party is not exist,please try later.';
        __next='error';
    }
}","1","Input Receiver Organization Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","10447","2212","Organization Query 3rd Bill And Payment","var input = __input.response;
if(empty(input)){
    __next = '2';
}else{
    orgShortCode=IC.queryShortCodeByOperatorCode(input);

    if(empty(orgShortCode)){
        __next='2a';
    }else{

        
            __params.InitiatorIdentifier = input;
            __next='3';
       
    }
}","2","Input the Initiator Operator ID","<html>
<body>
Input the Initiator Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","10448","2212","Organization Query 3rd Bill And Payment","var input = __input.response;
if(empty(input)){
     __next = '3';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',input);
   
    __next = '4';
}","3","Input KYC Fields","<html>
<body>
Input Org Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","10449","2212","Organization Query 3rd Bill And Payment","var input = __input.response;

if(empty(input) || !Validator.isDigit(input) || size(billList)<Util.toLong(input)){
    __next='5a';
} else if(input == '0'){
    __next='cancel';
}else{

    __params.remove('TransOutgoingRequest@LIST@Param.Identifier');
    __params.remove('TransOutgoingRequest@LIST@Param.IdentifierType');
    __params.remove('TransOutgoingRequest@LIST@Param.TransTime'); 
    __params.remove('TransOutgoingRequest@LIST@Param.GenericParameters');
    __params.remove('TransOutgoingRequest@LIST@Param.ConversationID');
    __params.remove('TransOutgoingRequest@LIST@Param.ShortCode');
    __params.remove('TransOutgoingRequest@LIST@Param.OrgName');

    var paymentBill=billList.get(Util.toLong(input)-1);
    var billInfoList = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfoList ){
        tempStrList=Util.stringSplit(billInfo,':');
        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
	        __params.BillReferenceNumber=tempStrList[1];
	    }else if(billInfo.contains('BillAmount')){
	        __params.Amount=tempStrList[1];

	    }else if(billInfo.contains('CurrencyCode')){
	        __params.Currency=tempStrList[1];
	    }
        }
    }

    __next='6';
}","5","Show Bill List","<html>
<body>
$$if (empty(billList)){
Third party cannot find your bill.
$$}else{
Organization bills are as follows,please select bill to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","10450","2212","Organization Query 3rd Bill And Payment","var input = __input.response;

if(empty(input)){
	__next = '4';
}else{
        __params.PIN = input;

	__params.put('TransOutgoingRequest@LIST@Param.Identifier',orgShortCode);
	__params.put('TransOutgoingRequest@LIST@Param.IdentifierType','04');
        __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
        __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
        __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__params.sessionId);

	
	var result=AG.sendSyncTransOutgoing(__params,'52');
	
	if(empty(result) || empty(result.header)){
		__errormsg = 'Sorry, Query 3rd bill error';
		__next='error';
	}else  if(result.header.resultCode != '0'){
                __errormsg = 'Sorry, Third Party Response error,please try later.';
                __next='error';
        }else{
__params.ResultType='0';
__params.EventType='QUERY_BILL';
                __params.Reason=""Query Third Party Bills Success"";
                __params.ResultCode='0';


                TC.savingPreValidationEventLog(__params);
		billListStr = result.msgBody.GenericParameters;
                
                if(!empty(billListStr)){
                    billList = Util.stringSplit(billListStr,';');
                }
                __next='5';
        }
    }","4","Input Initiator PIN","<html>
<body>
Input Initiator Operator PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","10451","2212","Organization Query 3rd Bill And Payment","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","10459","2215","Query OD by STK","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","10460","2215","Query OD by STK","var initiator=CurReq.getIdentifierDef('Initiator');
var pin= CurReq.getValueFromBody('QueryODInformationRequest.OrgiPIN');
newPin = Util.convertMessageToObject(pin);
var resultMap = IC.verifyIdentifierPinAndStatus(CurReq.getIdentifierDef('Initiator'),newPin,'Active',null);
notificationInfoList = IC.queryNotificationMsisdn(OriginalReq,'Initiator','500000000000010001');
var resultPinStatus = IC.queryPinStatusByIdentifier(initiator.Identifier,'01');
if(resultPinStatus =='1')
{
if(resultMap.ResultCode == 'SYS00000')
{
var isActivatedOD = IC.isActivatedOD(initiator.Identifier);
if(!isActivatedOD )
{
__params.put('Common.Result.ErrorMessage','The customer has not activate the OD.');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,__params);
__next='cancel';
}
else
{
var timestamp = Util.getCurrentTime();
initiator= CurReq.getIdentifierDef('Initiator'); 
var queryType= CurReq.getValueFromBody('QueryODInformationRequest.QueryType');
newQueryType = Util.convertMessageToObject(queryType);
__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.conversationId',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.timestamp',timestamp);
__params.put('TransOutgoingRequest@LIST@Param.identifier',initiator.Identifier);


__params.put('TransOutgoingRequest@LIST@Param.queryType',newQueryType);
__params.put('TransOutgoingRequest@LIST@Param.identifierType','01');
__params.put('TransOutgoingRequest@LIST@Param.ShortCode', '780780');
AG.sendTransOutgoing(CurReq,__params,'130');
__next='end';
}
}
else if(resultMap.ResultCode == 'TP40087')
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,107000000002081039,__params);
next='cancel';
}
else if(resultMap.ResultCode == 'IC40481')
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000027,__params);
next='cancel';
}
else if(resultMap.ResultCode == 'IC40249')
{
__params.put('Common.Result.ErrorMessage','The security credential has been locked because the number of input errors has reached the upper limit.');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,__params);
next='cancel';
}
}
else
{
__params.put('Common.Result.ErrorMessage','Your PIN status is not normal.');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,__params);
next='cancel';
}","1","Initiate Transaction","Initiate Transaction",""<endrec>
"Pre-Validation","","1","10471","2219","Customer Query 3rd Bill And Payment for STK","__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;

notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","10473","2219","Customer Query 3rd Bill And Payment for STK","var flag=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'false');
if(flag){
	var resultCode = CurReq.getValueFromBody('TransactionEventRequest.ResultCode');
	if(resultCode='2'){
		 errormsgType ='5';
		__next='error';
	}
}else{
	var billsInfo=__params.billText;
	var resultValue=CurReq.getValueFromBody('TransactionEventRequest.UserResponse');

	if(!empty(resultValue) && !empty(billsInfo)){
		if(!Validator.isDigit(resultValue) || __params.billCount<Util.toLong(resultValue) || Util.toLong(resultValue)<0){
			errormsgType ='4';
			__next='error';
		}else if(resultValue=='0'){
			NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,103010700000001433,__params);
			__next='cancel';
		}else {
			billInfoList = Util.stringSplit(billsInfo,';');
			var paymentBill=billInfoList.get(resultValue-1);
			var billInfos = Util.stringSplit(paymentBill,',');
			for(var billInfo:billInfos){
				tempStrList=Util.stringSplit(billInfo,':');

				if(!empty(tempStrList) && tempStrList.size()>=2){
					if(billInfo.contains('BillReferenceNumber')){
				OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BillReferenceNumber',tempStrList[1]);
				}else if(billInfo.contains('BillAmount')){
				OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount',tempStrList[1]);


				}else if(billInfo.contains('CurrencyCode')){
				OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency',tempStrList[1]);
				}
				}
			}


			OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',__params.PIN);
			OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SessionId',__sessionId);
			OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorIdentifierType',__params.InitiatorIdentifierType);
			OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorIdentifier',__params.InitiatorIdentifier);
			OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPartyIdentifierType',__params.ReceiverPartyIdentifierType);
			OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPartyIdentifier',__params.ReceiverPartyIdentifier);

			CurResp = TargetService.invokeForScript(); 
			__next = 'end';    
		 }
	}
}","2","Pay 3rd Bill","Pay 3rd Bill",""<endrec>
"Pre-Validation","","2","10474","2219","Customer Query 3rd Bill And Payment for STK","var req=CurReq.getValueFromBody('TransactionRequest')
var initiator=req.Initiator;
var receiverParty=req.ReceiverParty;
var KYCField=req.KYCField;
var pin=req.PIN;

if(empty(pin) || !IC.verifyIdentityPIN(initiator.IdentifierType,initiator.Identifier,Util.parseEncryptByAES(pin))){
		__next='error';
}else if(IC.queryPinStatusByIdentifier(initiator.Identifier,initiator.IdentifierType) != '1'){
         errormsgType='0';
         __next='error';
}else if(empty(receiverParty.Identifier) || IC.queryOrgStatusByShortCode(receiverParty.Identifier) != '03'){
         errormsgType='3';
         __next='error';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.Identifier',initiator.Identifier);
    __params.put('TransOutgoingRequest@LIST@Param.IdentifierType',initiator.IdentifierType);
    __params.put('TransOutgoingRequest@LIST@Param.ShortCode',receiverParty.Identifier);
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',KYCField);
    __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
    __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
    __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__sessionId);
    __params.PIN=pin; 
    __params.InitiatorIdentifier=initiator.Identifier;
    __params.InitiatorIdentifierType=initiator.IdentifierType;
    __params.ReceiverPartyIdentifier=receiverParty.Identifier;

    __params.ReceiverPartyIdentifierType=receiverParty.IdentifierType;

    var result=AG.sendSyncTransOutgoing(__params,'52');

    if(empty(result) || empty(result.header)){
		errormsgType='1';
		__next='error';
	}else  if(result.header.resultCode != '0'){
		errormsgType='2'; 

		__next='error';
	}else{
                __params.ResultType='0';
                __params.EventType='QUERY_BILL';
                __params.Reason=""Query Third Party Bills Success"";
                __params.ResultCode='0';
                TC.savingPreValidationEventLog(__params);

		var billListStr = result.msgBody.GenericParameters;	
		if(!empty(billListStr)){     
			billList = Util.stringSplit(billListStr,';');
			
			var promptText = 'Your bills are as follows,please select bill to payment,enter 0 to cancel.\n' ;
			var billText='';
			var i=0;
			for(var bill:billList){
				bill=(i+1)+' : '+bill;
				promptText=promptText+bill+'\n';
                billText=billText+bill+';';
				i=i+1;
			}
			__params.billText=billText;
                        __params.billCount=i;
		}else{
			var promptText = 'Third party cannot find your bill.\n' ;
		}
		
		__params.put('TransOutgoingRequest@LIST@Param.Context',promptText);

		__params.put('TransOutgoingRequest@LIST@Param.TransId',__sessionId);   
                __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
                //__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);        

		AG.sendTransOutgoing(CurReq,__params,'99');
		__next='2';
	}
}","1","Query 3rd Bill Info","Query 3rd Bill Info",""<endrec>
"Pre-Validation","","1","10475","2220","Group Query 3rd Bill And Payment for STK","__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;

notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","10477","2220","Group Query 3rd Bill And Payment for STK","var flag=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'false');
if(flag){
	var resultCode = CurReq.getValueFromBody('TransactionEventRequest.ResultCode');
	if(resultCode='2'){
		 errormsgType ='5';
		__next='error';
	}
}else{
var billsInfo=__params.billText;
var resultValue=CurReq.getValueFromBody('TransactionEventRequest.UserResponse');

if(!empty(resultValue) && !empty(billsInfo)){
if(!Validator.isDigit(resultValue) || __params.billCount<Util.toLong(resultValue) || Util.toLong(resultValue)<0){
    errormsgType ='4';
__next='error';
}else if(resultValue=='0'){
    NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,103010700000001433,__params);
    __next='cancel';
}else {

    billInfoList = Util.stringSplit(billsInfo,';');
    var paymentBill=billInfoList.get(resultValue-1);
    var billInfos = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfos){
        tempStrList=Util.stringSplit(billInfo,':');

        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BillReferenceNumber',tempStrList[1]);
	    }else if(billInfo.contains('BillAmount')){

		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount',tempStrList[1]);

	    }else if(billInfo.contains('CurrencyCode')){
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency',tempStrList[1]);
	    }
        }
    }

	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',__params.PIN);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SessionId',__sessionId);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorIdentifierType',__params.InitiatorIdentifierType);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorIdentifier',__params.InitiatorIdentifier);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPartyIdentifierType',__params.ReceiverPartyIdentifierType);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPartyIdentifier',__params.ReceiverPartyIdentifier);

	CurResp = TargetService.invokeForScript(); 
	__next = 'end';    
    }
}
}","2","Pay 3rd Bill","Pay 3rd Bill",""<endrec>
"Pre-Validation","","2","10478","2220","Group Query 3rd Bill And Payment for STK","var req=CurReq.getValueFromBody('TransactionRequest')
var initiator=req.Initiator;
var receiverParty=req.ReceiverParty;
var KYCField=req.KYCField;
var pin=req.PIN;

if(!IC.verifyIdentityPIN(initiator.IdentifierType,initiator.Identifier,Util.parseEncryptByAES(pin))){
    __next='error';
}else if(IC.queryPinStatusByIdentifier(initiator.Identifier,initiator.IdentifierType) != '1'){
         errormsgType='0';
         __next='error';
}else if(empty(receiverParty.Identifier) || IC.queryOrgStatusByShortCode(receiverParty.Identifier) != '03'){
         errormsgType='3';
         __next='error';
}else{
	__params.put('TransOutgoingRequest@LIST@Param.Identifier',initiator.Identifier);
	__params.put('TransOutgoingRequest@LIST@Param.IdentifierType',initiator.IdentifierType);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode',receiverParty.Identifier);
	__params.put('TransOutgoingRequest@LIST@Param.KYCField',KYCField);
	__params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
	__params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
	__params.put('TransOutgoingRequest@LIST@Param.ConversationID',__sessionId);
	__params.PIN=pin; 
	__params.InitiatorIdentifier=initiator.Identifier;
	__params.InitiatorIdentifierType=initiator.IdentifierType;
	__params.ReceiverPartyIdentifier=receiverParty.Identifier;
	__params.ReceiverPartyIdentifierType=receiverParty.IdentifierType;

	
	var result=AG.sendSyncTransOutgoing(__params,'52');
	
	if(empty(result) || empty(result.header)){

		errormsgType='1';
		__next='error';
	}else  if(result.header.resultCode != '0'){
		errormsgType='2';
		__next='error';

	}else{
                __params.ResultType='0';
                __params.EventType='QUERY_BILL';
                __params.Reason=""Query Third Party Bills Success"";
                __params.ResultCode='0';
                TC.savingPreValidationEventLog(__params);

		var billListStr = result.msgBody.GenericParameters;
		if(!empty(billListStr)){
			billList = Util.stringSplit(billListStr,';');
			var promptText = 'Your bills are as follows,please select bill to payment,enter 0 to cancel.\n' ;
			var billText='';
			var i=0;
			for(var bill:billList){
				bill=(i+1)+' : '+bill;
				promptText=promptText+bill+'\n';
				billText=billText+bill+';';
				i=i+1;
			}
			__params.billText=billText;
                        __params.billCount=i;
		}else{
			var promptText = 'Third party cannot find your bill.\n' ;
		}
		
		__params.put('TransOutgoingRequest@LIST@Param.Context',promptText);
		__params.put('TransOutgoingRequest@LIST@Param.TransId',__sessionId);   
                __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

                //__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId); 

		AG.sendTransOutgoing(CurReq,__params,'99');

		__next='2';
	} 
}","1","Query 3rd Bill Info","Query 3rd Bill Info",""<endrec>
"Pre-Validation","","1","10479","2221","Organization Query 3rd Bill And Payment for STK","__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;

notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","10481","2221","Organization Query 3rd Bill And Payment for STK","var flag=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'false');
if(flag){
	var resultCode = CurReq.getValueFromBody('TransactionEventRequest.ResultCode');
	if(resultCode='2'){
		 errormsgType ='5';
		__next='error';
	}
}else{
var billsInfo=__params.billText;
var resultValue=CurReq.getValueFromBody('TransactionEventRequest.UserResponse');

if(!empty(resultValue) && !empty(billsInfo)){
if(!Validator.isDigit(resultValue) || __params.billCount<Util.toLong(resultValue) || Util.toLong(resultValue)<0){
    errormsgType ='4';
__next='error';
}else if(resultValue=='0'){
    NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,103010700000001433,__params);
    __next='cancel';
}else {

    billInfoList = Util.stringSplit(billsInfo,';');
    var paymentBill=billInfoList.get(resultValue-1);
    var billInfos = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfos){
        tempStrList=Util.stringSplit(billInfo,':');

        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BillReferenceNumber',tempStrList[1]);
	    }else if(billInfo.contains('BillAmount')){

		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount',tempStrList[1]);

	    }else if(billInfo.contains('CurrencyCode')){
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency',tempStrList[1]);
	    }
        }
    }

	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',__params.PIN);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SessionId',__sessionId);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorIdentifierType',__params.InitiatorIdentifierType);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorIdentifier',__params.InitiatorIdentifier);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPartyIdentifierType',__params.ReceiverPartyIdentifierType);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPartyIdentifier',__params.ReceiverPartyIdentifier);

	CurResp = TargetService.invokeForScript(); 
	__next = 'end';    
}
}
}","2","Pay 3rd Bill","Pay 3rd Bill",""<endrec>
"Pre-Validation","","2","10482","2221","Organization Query 3rd Bill And Payment for STK","__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;
var req=CurReq.getValueFromBody('TransactionRequest')
var initiator=req.Initiator;
var receiverParty=req.ReceiverParty;
var KYCField=req.KYCField;
var pin=req.PIN;

if(empty(initiator) || empty(receiverParty)){
    __next='error';
}else if(empty(receiverParty.Identifier) || IC.queryOrgStatusByShortCode(receiverParty.Identifier) != '03'){
         errormsgType='3';
         __next='error';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.Identifier',initiator.Identifier);
    __params.put('TransOutgoingRequest@LIST@Param.IdentifierType',initiator.IdentifierType);
    __params.put('TransOutgoingRequest@LIST@Param.ShortCode',receiverParty.Identifier);
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',KYCField);
    __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
    __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
    __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__sessionId);
    __params.PIN=pin; 
    __params.InitiatorIdentifier=initiator.Identifier;
    __params.InitiatorIdentifierType=initiator.IdentifierType;
    __params.ReceiverPartyIdentifier=receiverParty.Identifier;
    __params.ReceiverPartyIdentifierType=receiverParty.IdentifierType;

    var result=AG.sendSyncTransOutgoing(__params,'52');



    if(empty(result) || empty(result.header)){
		errormsgType='1';
		__next='error';
	}else if(result.header.resultCode != '0'){

        errormsgType='2'; 
		__next='error';
	}else{
              __params.ResultType='0';
		__params.EventType='QUERY_BILL';
		__params.Reason=""Query Third Party Bills Success"";
		__params.ResultCode='0';
		TC.savingPreValidationEventLog(__params);

		var billListStr = result.msgBody.GenericParameters;
		
		if(!empty(billListStr)){			 
			billList = Util.stringSplit(billListStr,';');
			var promptText = 'Your bills are as follows,please select bill to payment,enter 0 to cancel.\n' ;
			var billText='';
			var i=0;
			for(var bill:billList){
				bill=(i+1)+' : '+bill;
				promptText=promptText+bill+'\n';
				billText=billText+bill+';';
				i=i+1;
			}
			__params.billText=billText;
                        __params.billCount=i;

		}else{
			var promptText = 'Third party cannot find your bill.\n' ;
		}

		__params.put('TransOutgoingRequest@LIST@Param.Context',promptText);
		__params.put('TransOutgoingRequest@LIST@Param.TransId',__sessionId);   
                __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
                //__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);



		AG.sendTransOutgoing(CurReq,__params,'99');
		__next='2';
	}
}","1","Query 3rd Bill Info","Query 3rd Bill Info",""<endrec>
"Pre-Validation","","1","10492","2224","Group Pay Bill with prevalidation for STK","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
cust= IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
__params.LogId=__sessionId;
__params.IsRecordPreLog='1';
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","10493","2224","Group Pay Bill with prevalidation for STK","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc='Pre-Validation confirmation is Timeout.';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
__params.errDesc='Pre-Validation confirmation is Timeout.';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","2","10494","2224","Group Pay Bill with prevalidation for STK","if(!IC.isSupportCustomerNameSearch() || cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01')
{
__params.put('ResultType','0');
__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
CurResp = TargetService.invokeForScript(); 
TC.savingPreValidationEventLog(__params);
__next='end';
}
else
{
TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
feeInfo=budgetMap.FeeInfo;
if(budgetMap.isError == '1')
{
__params.errDesc=budgetMap.errorMsg;
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);
TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
 feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
   var promptText = '';

   promptText= promptText+'You will pay ' ;
   var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
   var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
   promptText =  promptText + IC.formatAmount(currency, amount);


   promptText  = promptText +' to organization ';

   __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);	  

   if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
   {
    var nameStr=(empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName +' ');	
    promptText = promptText + nameStr;
    if(nameStr != '')
    {
      __params.IsCNSDataDisplayed = 'Yes';
    }
   }

  promptText = promptText + ', short code ' + cust.basicIdentifier;
  promptText = promptText+'.	Charge for this transaction is:\n ';
  
  for(fee:feeList)
  {   
   promptText = promptText + ':The amount of charge is '+fee.amount;
 
   if(i < sizeLen)
   {
    promptText = promptText + ',';
   }
    i = i+1; 
  }

   taxList = budgetMap.tax;
   i = 1;

  sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  promptText != '')
   {
    promptText = promptText + ',';
   }
    promptText = promptText + ':The amount of tax is '+tax.amount;
   if(i <sizeLen)
   {
    promptText = promptText + ',';
   } 

   i = i+1;
  }

  if( promptText == '')
  {

     promptText =' No charge.';
  } 
  else
  {
    promptText =promptText +'.';
  } 
var promptText = promptText + '\n1. Yes\n2. No';
__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
accessDevice = CurReq.getIdentifierDef('AccessDevice');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
AG.sendTransOutgoing(CurReq,__params,'19');
__next = '2';
}
}","1","Do Pre-Validation","Do Pre-Validation",""<endrec>
"Pre-Validation","","3","10495","2224","Group Pay Bill with prevalidation for STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
       __params.put('ResultType','0');
	__params.Reason=""Continue Pre-Validation Transaction."";
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
        TC.savingPreValidationEventLog(__params);
	__next='end';
}
else
{ 
	var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';  
        }
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);
        TC.savingPreValidationEventLog(__params);
	__next='cancel';
 }","2","Pre-Validataion Result","Pre-Validataion Result",""<endrec>
"Pre-Validation","","4","10496","2220","Group Query 3rd Bill And Payment for STK","__params.put('Common.Result.ErrorCode','Error Informaction');
if(errormsgType =='0'){
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001436,__params);
        __params.Reason='PIN Error.';
}else if(errormsgType == '1'){
        __params.Reason='Query 3rd bill error.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001427,__params);
}else if(errormsgType == '2'){
        __params.Reason='Third Party Response error.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001428,__params);
}else if(errormsgType == '3'){
        __params.Reason='Third Party is not in active or is not exist,please try later.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001430,__params);
}else if(errormsgType == '4'){
        __params.Reason='Enter invalid Number,please try again.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001429,__params);
}else if(errormsgType == '5'){
        __params.Reason='Response Timeout.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001437,__params);
}

__params.EventType='QUERY_BILL';
__params.errCode='-1';
__params.errDesc='Request Failed.';
TC.savingPreValidationEventLog(__params);","error","information","information",""<endrec>
"Pre-Validation","","4","10497","2219","Customer Query 3rd Bill And Payment for STK","__params.put('Common.Result.ErrorCode','Error Informaction');
if(errormsgType =='0'){
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001436,__params);
        __params.Reason='PIN Error.';
}else if(errormsgType == '1'){
        __params.Reason='Query 3rd bill error.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001427,__params);
}else if(errormsgType == '2'){
        __params.Reason='Third Party Response error.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001428,__params);
}else if(errormsgType == '3'){
        __params.Reason='Third Party is not in active or is not exist,please try later.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001430,__params);
}else if(errormsgType == '4'){
        __params.Reason='Enter invalid Number,please try again.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001429,__params);
}else if(errormsgType == '5'){
        __params.Reason='Response Timeout.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001437,__params);
}

__params.EventType='QUERY_BILL';
__params.errCode='-1';
__params.errDesc='Request Failed.';
TC.savingPreValidationEventLog(__params);","error","information","information",""<endrec>
"Pre-Validation","","4","10498","2221","Organization Query 3rd Bill And Payment for STK","__params.put('Common.Result.ErrorCode','Error Informaction');
if(errormsgType =='0'){
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,208000000000001240,__params);
        __params.Reason='PIN Error.';
}else if(errormsgType == '1'){
        __params.Reason='Query 3rd bill error.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001427,__params);
}else if(errormsgType == '2'){
        __params.Reason='Third Party Response error.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001428,__params);
}else if(errormsgType == '3'){
        __params.Reason='Third Party is not in active or is not exist,please try later.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001430,__params);
}else if(errormsgType == '4'){
        __params.Reason='Enter invalid Number,please try again.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001429,__params);
}else if(errormsgType == '5'){
        __params.Reason='Response Timeout.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001437,__params);
}

__params.EventType='QUERY_BILL';
__params.errCode='-1';
__params.errDesc='Request Failed.';
TC.savingPreValidationEventLog(__params);","error","information","information",""<endrec>
"CUSTOMER","","6","10499","2210","Customer Query 3rd Bill And Payment","var input = __input.response;
if(empty(input) || !Validator.isDigit(input) || size(billList)<Util.toLong(input)){
    __next='4a';
}else if(input == '0'){
    __next='cancel';
}else{
    __params.remove('TransOutgoingRequest@LIST@Param.Identifier');
    __params.remove('TransOutgoingRequest@LIST@Param.IdentifierType');
    __params.remove('TransOutgoingRequest@LIST@Param.TransTime'); 
    __params.remove('TransOutgoingRequest@LIST@Param.GenericParameters');
    __params.remove('TransOutgoingRequest@LIST@Param.ConversationID');
    __params.remove('TransOutgoingRequest@LIST@Param.ShortCode');
    __params.remove('TransOutgoingRequest@LIST@Param.FirstName');

    var paymentBill=billList.get(Util.toLong(input)-1);
    var billInfoList = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfoList ){
        tempStrList=Util.stringSplit(billInfo,':');
        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
	        __params.BillReferenceNumber=tempStrList[1];
	    }else if(billInfo.contains('BillAmount')){
	        __params.Amount=tempStrList[1];

	    }else if(billInfo.contains('CurrencyCode')){
	        __params.Currency=tempStrList[1];
	    }
        }
    }
    
    __next='5';
}","4a","Reenter Bill No","<html>
<body>
You enter a worng bill sequence, please select bill again to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","105","1001","Deposit Money","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10500","2211","Group Query 3rd Bill And Payment","var input = __input.response;

if(empty(input) || !Validator.isDigit(input) || size(billList)<Util.toLong(input)){
    __next='5a';
}else if(input == '0'){
    __next='cancel';
}else{

    __params.remove('TransOutgoingRequest@LIST@Param.Identifier');
    __params.remove('TransOutgoingRequest@LIST@Param.IdentifierType');
    __params.remove('TransOutgoingRequest@LIST@Param.TransTime'); 
    __params.remove('TransOutgoingRequest@LIST@Param.GenericParameters');
    __params.remove('TransOutgoingRequest@LIST@Param.ConversationID');
    __params.remove('TransOutgoingRequest@LIST@Param.ShortCode');
    __params.remove('TransOutgoingRequest@LIST@Param.GroupName');


    var paymentBill=billList.get(Util.toLong(input)-1);
    var billInfoList = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfoList ){
        tempStrList=Util.stringSplit(billInfo,':');
        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
	        __params.BillReferenceNumber=tempStrList[1];
	    }else if(billInfo.contains('BillAmount')){
	        __params.Amount=tempStrList[1];

	    }else if(billInfo.contains('CurrencyCode')){
	        __params.Currency=tempStrList[1];
	    }
        }
    }
    __next='6';
}","5a","Reenter Bill No","<html>
<body>
You enter a worng bill sequence, please select bill again to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","10501","2212","Organization Query 3rd Bill And Payment","var input = __input.response;

if(empty(input) || !Validator.isDigit(input) || size(billList)<Util.toLong(input)){
    __next='5a';
} else if(input == '0'){
    __next='cancel';
}else{

    __params.remove('TransOutgoingRequest@LIST@Param.Identifier');
    __params.remove('TransOutgoingRequest@LIST@Param.IdentifierType');
    __params.remove('TransOutgoingRequest@LIST@Param.TransTime'); 
    __params.remove('TransOutgoingRequest@LIST@Param.GenericParameters');
    __params.remove('TransOutgoingRequest@LIST@Param.ConversationID');
    __params.remove('TransOutgoingRequest@LIST@Param.ShortCode');
    __params.remove('TransOutgoingRequest@LIST@Param.OrgName');

    var paymentBill=billList.get(Util.toLong(input)-1);
    var billInfoList = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfoList ){
        tempStrList=Util.stringSplit(billInfo,':');
        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
	        __params.BillReferenceNumber=tempStrList[1];
	    }else if(billInfo.contains('BillAmount')){
	        __params.Amount=tempStrList[1];

	    }else if(billInfo.contains('CurrencyCode')){
	        __params.Currency=tempStrList[1];
	    }
        }
    }

    __next='6';
}","5a","Reenter Bill No","<html>
<body>
You enter a worng bill sequence, please select bill again to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","10502","2212","Organization Query 3rd Bill And Payment","var input = __input.response;
if(empty(input)){
    __next = '2a';
}else{
    orgShortCode=IC.queryShortCodeByOperatorCode(input);

    if(empty(orgShortCode)){
        __next='2a';
    }else{

     
            __params.InitiatorIdentifier = input;
            __next='3';
       
    }
}","2a","Reenter Operator ID","<html>
<body>
The Operator ID is not exist, please input the Initiator Operator ID again<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","10505","1317","Add Group Member dont use","var input = __input.response;
cust = IC.queryIdentityName(__params.InitiatorIdentifierType,__params.InitiatorIdentifier,'01',__params.InvitedMSISDN);
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
if(!IC.isSupportCustomerNameSearch() || cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01'){
__next = '7';
}
else
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '1')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {           
	   promptText = promptText + 'The amount of charge is '+fee.amount;
	  
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';
	   }
		i = i+1;
	  }
  }
   taxList = budgetMap.tax;

   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
	   if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }
		promptText = promptText + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
  {
    promptText =' No charge.';
  } 
  else
  {
    promptText =promptText +'.';
  }

var tips = '';
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
     if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
     {
       if(cust.subType  == '1000')
       {
	 tips = tips  + 'the received customer is unregistered.' + '<br>';
       }
       else if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
       {		   
           var nameStr= (empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName +' ');

           tips = tips + 'Customer name : ' + IC.maskIdentityName(nameStr) + '<br>';
           if(nameStr != ''){
           __params.IsCNSDataDisplayed = 'Yes';
           }
       }
     }
tips = tips + 'Phone number : ' + cust.basicIdentifier;
promptText = promptText + '<br>' + tips;

__params.preValidationResult = promptText;
__next = '6';
}
}
}
else if (input == '2') {
__next = '7';
}
}
else {
 __next = '5';
}","5","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","10506","1317","Add Group Member dont use","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__next = '7';
}
else if (input == '2') {
if(__params.IsCNSDataDisplayed == 'Yes')
{
  IC.cnsCancelationProcess(__params.InitiatorIdentifierType,__params.InitiatorIdentifier);
}
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
}
else {
 __next = '6';
}","6","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10507","2225","Customer Query 3rd Bill","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.sessionId = universalSessionID.channelSessionID;

__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
kycinfo = '';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","10508","2225","Customer Query 3rd Bill","var input = __input.response;

if(empty(input)){
     __next = '1';
}else{

    var orgStatus = IC.queryOrgStatusByShortCode(input);
    if(!empty(orgStatus) && orgStatus =='03'){
        __params.ReceiverPartyIdentifier = input;
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode',input);
        __next = '2';
    }else{
        __errormsg='Sorry,the third party is not in active or the third party is not exist,please try later.';
        __next='error';
    }
}","1","Input Receiver Organization Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10509","2225","Customer Query 3rd Bill","var input = __input.response;
if(empty(input)){
     __next = '2';
}else{
    kycinfo = input;
    __next = '2a';
}","2","Input First Name","<html>
<body>
Input You First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10510","2225","Customer Query 3rd Bill","var input = __input.response;
if(empty(input) || !IC.verifyIdentityPIN(__params.InitiatorIdentifierType,__params.InitiatorIdentifier,input)){
	__next = '3';
}else{
       var pinStatus = IC.queryPinStatusByIdentifier(__params.InitiatorIdentifier,__params.InitiatorIdentifierType);
        if(empty(pinStatus) || pinStatus != '1'){
                __errormsg = 'Sorry, your pin is not in normal.';
		__next='error';
        }else{

        __params.PIN = input;
	__params.put('TransOutgoingRequest@LIST@Param.Identifier',__params.InitiatorIdentifier);
	__params.put('TransOutgoingRequest@LIST@Param.IdentifierType',__params.InitiatorIdentifierType);
        __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
        __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
        __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__params.sessionId);

	var result=AG.sendSyncTransOutgoing(__params,'52');
	if(empty(result) || empty(result.header)){
		__errormsg = 'Sorry, Query 3rd bill error';
		__next='error';
	}else  if(result.header.resultCode != '0'){
                __errormsg = 'Sorry, Third Party Response error,please try later.';
                __next='error';
        }else{
__params.ResultType='0';
                __params.EventType='QUERY_BILL';

                __params.Reason=""Query Third Party Bills Success"";

                __params.ResultCode='0';
                TC.savingPreValidationEventLog(__params);
		billListStr = result.msgBody.GenericParameters;
                
                if(!empty(billListStr)){
                    billList = Util.stringSplit(billListStr,';');
                }

                __next='4';
        }
    }
}","3","Input PIN","<html>
<body>
Input You PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","10512","2225","Customer Query 3rd Bill","var input = __input.response;

if(input == '0'){
    __errormsg='You have colsed the session.';
    __next='error';
}else{
    __next='4';
}","4","Show Bill List","<html>
<body>
$$if (empty(billList)){
Third party cannot find your bill.
$$}else{
Your bills are as follows,please enter 0 to close session.<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","10522","2228","Customer Query 3rd Bill for STK","__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;

notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","10524","2228","Customer Query 3rd Bill for STK","var req=CurReq.getValueFromBody('TransactionRequest')
var initiator=req.Initiator;
var receiverParty=req.ReceiverParty;
var KYCField=req.KYCField;
var pin=req.PIN;

if(empty(pin) || !IC.verifyIdentityPIN(initiator.IdentifierType,initiator.Identifier,Util.parseEncryptByAES(pin))){
		__next='error';
}else if(IC.queryPinStatusByIdentifier(initiator.Identifier,initiator.IdentifierType) != '1'){
         errormsgType='0';
         __next='error';
}else if(empty(receiverParty.Identifier) || IC.queryOrgStatusByShortCode(receiverParty.Identifier) != '03'){
         errormsgType='3';
         __next='error';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.Identifier',initiator.Identifier);
    __params.put('TransOutgoingRequest@LIST@Param.IdentifierType',initiator.IdentifierType);
    __params.put('TransOutgoingRequest@LIST@Param.ShortCode',receiverParty.Identifier);
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',KYCField);
    __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
    __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
    __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__sessionId);
    __params.PIN=pin; 
    __params.InitiatorIdentifier=initiator.Identifier;
    __params.InitiatorIdentifierType=initiator.IdentifierType;
    __params.ReceiverPartyIdentifier=receiverParty.Identifier;

    __params.ReceiverPartyIdentifierType=receiverParty.IdentifierType;

    var result=AG.sendSyncTransOutgoing(__params,'52');

    if(empty(result) || empty(result.header)){
		errormsgType='1';
		__next='error';
	}else  if(result.header.resultCode != '0'){
		errormsgType='2'; 

		__next='error';
	}else{
                __params.ResultType='0';
                __params.EventType='QUERY_BILL';
                __params.Reason=""Query Third Party Bills Success"";
                __params.ResultCode='0';
                TC.savingPreValidationEventLog(__params);

		var billListStr = result.msgBody.GenericParameters;	
		if(!empty(billListStr)){     
			billList = Util.stringSplit(billListStr,';');
			
			var promptText = 'Your bills are as follows.\n' ;
			var billText='';
			var i=0;
			for(var bill:billList){
				bill=(i+1)+' : '+bill;
				promptText=promptText+bill+'\n';
                billText=billText+bill+';';
				i=i+1;
			}
			__params.billText=billText;
		}else{
			var promptText = 'Third party cannot find your bill.\n' ;
		}
		
		__params.put('TransOutgoingRequest@LIST@Param.Context',promptText);
		__params.put('TransOutgoingRequest@LIST@Param.TransId',__sessionId);   
                __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

                //__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId); 
		
		AG.sendTransOutgoing(CurReq,__params,'99');
		__next='end';

	}
}","1","Query 3rd Bill Info","Query 3rd Bill Info",""<endrec>
"Pre-Validation","","3","10525","2228","Customer Query 3rd Bill for STK","__params.put('Common.Result.ErrorCode','Error Informaction');
if(errormsgType =='0'){
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001436,__params);
        __params.Reason='PIN Error.';
}else if(errormsgType == '1'){
        __params.Reason='Query 3rd bill error.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001427,__params);
}else if(errormsgType == '2'){
        __params.Reason='Third Party Response error.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001428,__params);
}else if(errormsgType == '3'){
        __params.Reason='Third Party is not in active or is not exist,please try later.';
	NC.sendPreValidationNotification(notificationInfoList, __accessChannel ,104010700000001430,__params);
}

__params.EventType='QUERY_BILL';
__params.errCode='-1';
__params.errDesc='Request Failed.';
TC.savingPreValidationEventLog(__params);","error","information","information",""<endrec>
"TILL","","6","106","1001","Deposit Money","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","6","Confirm","<html>
<body>
Fee:${chargeFee = TC.queryCustomerCharge(__params)};<br>
$$result = TC.calculateBudget(__params);
$$budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
$$var promptText = '';
$$feeList = budgetMap.fee;
$$if(!empty(feeList)){
$$	   i = 1;
$$	   sizeLen = size(feeList);
$$	  for(fee:feeList)
$$	  {
$$	   promptText = promptText+ 'The amount of charge is '+fee.amount;
$$	 
$$	   if(i < sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$		i = i+1 
$$	  }
$$}
$$   taxList = budgetMap.tax;
$$   if(!empty(taxList)){
$$	   i = 1;
$$	   sizeLen = size(taxList);
$$	  for(tax:taxList)
$$	  {
$$		 if(i ==1 &&  promptText != '')
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$
$$		promptText = promptText
$$	 + 'The amount of tax is '+tax.amount;
$$	   
$$	   if(i <sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   } 
$$	   i = i+1;
$$	  }
$$  }
Deposit Cash ${__params.ReceiverParty.Identifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10616","2250","Change Language V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = __msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = __msisdn;
__params.PrimaryIdentifierType = '01'; /* MSISDN */
__next = '1a';
__exemode='continue';","begin","set parameters","",""<endrec>
"CUSTOMER","","4","10617","2250","Change Language V2.0","var i=Util.toInt(__input.response) -1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
__phase = 0;
__locale =__tempData.languages.get(i);
__next = 'end';
} else {
  __next = '2';
}","2","Please select language","<html>
<body>
Please select language:<br>
$$languages =__tempData.languages;
$$var i = 1;
$$for (lang: languages) {
  ${i} ${lang.getDisplayName(__locale)}<br>
  $$ i = i + 1;
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>
</html>","8"<endrec>
"CUSTOMER","5","2","10618","2250","Change Language V2.0","__next  = '1b';
__exemode = 'continue';","1a","Query All Languages","Query All Languages",""<endrec>
"CUSTOMER","","3","10619","2250","Change Language V2.0","var commitResult=__input.lastCommitResult;
if (commitResult.isSucess)
{
    __tempData.languages =commitResult.result;
   if(empty(__tempData.languages)|| size(__tempData.languages)==0){
       __errormsg = 'no current languages.';
       __next = 'error';
   }else {
       __next = '2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying languages.';
   __next = 'error';
}","1b","Check Languages","Check Languages",""<endrec>
"Pre-Validation","","1","10647","2258","Customer Buy Goods With OD STK","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
accessDevice = CurReq.getIdentifierDef('AccessDevice');
var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
var currency = CurReq.getValueFromBody('TransactionRequest.Currency');
__params.currency = currency;
__params.AmountInfo =  IC.formatAmount(currency, amount);
   
__next = '1';","begin","begin set parammeters","",""<endrec>
"Pre-Validation","","7","10648","2258","Customer Buy Goods With OD STK","if(__errorCode == 'UMC64000')
{
	__params.put('Common.Result.ErrorMessage','Pre-Validation confirmation is Timeout');
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,__params);
	
	__params.errDesc='Pre-Validation Request Failed';
	__params.EventType='PRE_VALIDATION';
	TC.savingPreValidationEventLog(__params);
}
__next = 'cancel';","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","2","10649","2258","Customer Buy Goods With OD STK","__params.isSimpleCalculateFee = 'true';
    __params.isSendCalFeeNotification = 'true';
budgetMap=TC.calculateOverDraftAmount(CurReq,__params,'Initiator',__sessionId);
if(budgetMap.isError == '1')
{
    if(budgetMap.ResultCode== 'TS28009')
	{
		var tsncParams = Util.buildMap();
		NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,tsncParams);
	
		__params.errDesc= 'ODCheckBalance failed,There is an outstanding overdraft transaction.';
		__params.EventType='PRE_VALIDATION';
		TC.savingPreValidationEventLog(__params);
	}
	__next = 'end';
}
else
{
	 var isOverDraft = budgetMap.isOverDraft;
	 if(isOverDraft == 'true')
	 {
             var isActivatedOD = IC.isActivatedOD(accessDevice.identifier);
             if(!isActivatedOD)
            {var notActivatedNCParams = Util.buildMap();
		notActivatedNCParams.put('OverDraft.SendAmount',__params.AmountInfo);
		notActivatedNCParams.put('OverDraft.MMAccountBalance',budgetMap.AccountBalance);
		NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,notActivatedNCParams);
	        __next='cancel';

			}
			else
			{
                                var shortCode = Util.getSysParameter('DEFAULT_OVERDRAFT_ORGANIZATION');
				__params.IsUseOD= isOverDraft;
				__params.OverDraftAmount = budgetMap.OverDraftAmount;

                                __params.AccountBalance= budgetMap.AccountBalance;

				__params.put('TransOutgoingRequest@LIST@Param.conversationId', __sessionId);

				__params.put('TransOutgoingRequest@LIST@Param.identifierType', '01');
				__params.put('TransOutgoingRequest@LIST@Param.identifier', accessDevice.identifier);
				__params.put('TransOutgoingRequest@LIST@Param.identityType', '1000');
				__params.put('TransOutgoingRequest@LIST@Param.ShortCode', shortCode);
				__params.put('TransOutgoingRequest@LIST@Param.transactionAmount',budgetMap.OverDraftAmount);
				__params.put('TransOutgoingRequest@LIST@Param.currency', CurReq.getValueFromBody('TransactionRequest.Currency'));

				AG.sendTransOutgoing(CurReq,__params,'128');
				__next='2'; 
			 }
     } 
	 else
     {
        var transAmount = OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
	 var tillMSISDN = IC.queryTillMSISDNByTillNumber(CurReq.getIdentifierDef('ReceiverParty').Identifier); 
	 var orgName = IC.queryOrgNameByTillNumber(CurReq.getIdentifierDef('ReceiverParty').Identifier);
	 var orgShortCode = IC.queryShortCodeByTillMsisdn(tillMSISDN);

	 var promptText = 'Pay ' + orgShortCode + '-' + orgName + ' KSHS ' + transAmount + '. To STOP transaction send any letter or number with in 25 Second  cost Kshs 0. \n1. Yes\n2. No';
    __params.put('TransOutgoingRequest@LIST@Param.PromptText', promptText);

    __params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
    __params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
    AG.sendTransOutgoing(CurReq,__params,'19');
	__next='5';
     }
}","1","Check Need Use OverDraft","Check Need Use OverDraft",""<endrec>
"Pre-Validation","","3","10650","2258","Customer Buy Goods With OD STK","var successOrNot = CurReq.hasValueInBody('TransactionEventRequest.resultCode', 'SUC0000');
__params.accessFee =  CurReq.getValueFromBody('TransactionEventRequest.accessFee');
__params.interestRate =  CurReq.getValueFromBody('TransactionEventRequest.interestRate');
__params.dueDate=  CurReq.getValueFromBody('TransactionEventRequest.dueDate');
__params.debt=  CurReq.getValueFromBody('TransactionEventRequest.debt');
if (successOrNot)
{ 
    var promptText = 'Failed.Insufficient funds in your M-PESA, you are about to use Ksh ' + __params.OverDraftAmount + ' from M-PESA Overdraw at a fee of Ksh ' + __params.accessFee + ' and  daily maintenance fee ' +__params.interestRate  + '. Press YES to accept and NO to cancel.';
    __params.put('TransOutgoingRequest@LIST@Param.PromptText', promptText);
    __params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
    __params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.CommandID','useOD');
    AG.sendTransOutgoing(CurReq,__params,'19');
	__next='3';
}
else
{ 
	var resultCode = CurReq.getValueFromBody('TransactionEventRequest.resultCode');
	var resultDesc = CurReq.getValueFromBody('TransactionEventRequest.resultDesc');
        __params.balance =  CurReq.getValueFromBody('TransactionEventRequest.balance');
	var notificationText = '';
	if(resultCode == 'ERR0001')
	{
		var e0001NCParams = Util.buildMap();

        e0001NCParams.put('OverDraft.SendAmount',__params.AmountInfo);
        e0001NCParams.put('OverDraft.MMAccountBalance',__params.AccountBalance);
        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,e0001NCParams);	
	}
	else if(resultCode == 'ERR0002')
	{
		var e0002NCParams = Util.buildMap();
		var dueDate = CurReq.getValueFromBody('TransactionEventRequest.dueDate');
		var dueDateString=Util.foramtDateString('yyyyMMdd','dd/MM/yy',dueDate);
        e0002NCParams.put('OverDraft.debt', CurReq.getValueFromBody('TransactionEventRequest.debt'));
        e0002NCParams.put('OverDraft.dueDate', dueDateString);
        e0002NCParams.put('OverDraft.SendAmount',__params.AmountInfo);
		NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,e0002NCParams);
	}
	else if(resultCode == 'ERR0003')
	{
		var e0003NCParams = Util.buildMap();
        e0003NCParams.put('OverDraft.ODBalance', __params.balance);
        e0003NCParams.put('OverDraft.MMAccountBalance', __params.AccountBalance);
        e0003NCParams.put('OverDraft.SendAmount',__params.AmountInfo);
        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,e0003NCParams);
	}
	else
	{
		var e0000NCParams = Util.buildMap();
        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,e0000NCParams);
	}

	
	__params.errDesc= 'ODCheckBalance failed, OD return resultCode:' + resultCode + 'resultDesc:'+ resultDesc;
	__params.EventType='PRE_VALIDATION';
	TC.savingPreValidationEventLog(__params);
	__next='cancel';
}","2","Check ODBalance Result","Check ODBalance Result",""<endrec>
"Pre-Validation","","4","10651","2258","Customer Buy Goods With OD STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
if (confirmedOrNot || resultType == '1')
{ 
	 var transAmount = OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
	 var tillMSISDN = IC.queryTillMSISDNByTillNumber(OriginalReq.getIdentifierDef('ReceiverParty').Identifier); 
	 var orgName = IC.queryOrgNameByTillNumber(OriginalReq.getIdentifierDef('ReceiverParty').Identifier);
	 var orgShortCode = IC.queryShortCodeByTillMsisdn(tillMSISDN);
	 var promptText = 'Pay ' + orgShortCode + '-' + orgName + ' KSHS ' + transAmount + '. To STOP transaction send any letter or number with in 25 Second  cost Kshs 0. \n1. Yes\n2. No';
    __params.put('TransOutgoingRequest@LIST@Param.PromptText', promptText);
    __params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
    __params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
   __params.put('TransOutgoingRequest@LIST@Param.CommandID','');
    AG.sendTransOutgoing(CurReq,__params,'19');
	__next='4';
}
else
{ 
	var tillMSISDN = IC.queryTillMSISDNByTillNumber(OriginalReq.getIdentifierDef('ReceiverParty').Identifier); 
var orgName = IC.queryOrgNameByTillNumber(OriginalReq.getIdentifierDef('ReceiverParty').Identifier);

var nParams = Util.buildMap();

nParams.put('OverDraft.MMAccountBalance', budgetMap.AccountBalance);
nParams.put('OverDraft.SendAmount',__params.AmountInfo);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,nParams);

if(resultType == '2' || resultType == '3')
{
	__params.errDesc='Use OverDraft Confirmation Result is Rejected.';
	__params.TransactionUMCPreValidationError='Use OverDraft Confirmation Result is Rejected.';
     TC.savingPreValidationEventLog(__params);
    __next='cancel';		

}
else if(resultType == '4')
{

	__params.errDesc='Use OverDraft Confirmation Result is Timeout.';

	__params.TransactionUMCPreValidationError='Use OverDraft Confirmation Result is Timeout.';
     TC.savingPreValidationEventLog(__params);
    __next='cancel';		
}
else
{
	__params.errDesc=""Use OverDraft Confirmation Request Failed."";
	__params.TransactionUMCPreValidationError='Use OverDraft Confirmation Request Failed.';
	 TC.savingPreValidationEventLog(__params);

	__next='cancel';
}
}","3","Use OverDraft Confirmation","Use OverDraft Confirmation",""<endrec>
"Pre-Validation","","5","10652","2258","Customer Buy Goods With OD STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
if (confirmedOrNot || resultType == '1')
{ 
	__params.Reason=""Continue Use OverDraft Transaction."";
	__params.TransactionUMCPreValidationError='Continue Use OverDraft Transaction.';
        __params.CurReqConversationID=CurReq.getParamValue4RequestHeaderConversationID();
        OriginalReq.setParamValue4RequestHeaderMessageId(__params.CurReqConversationID);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.IsUseOD',__params.IsUseOD);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.OverDraftAmount',__params.OverDraftAmount);
        OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.currency',__params.currency);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.debt',__params.debt);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.dueDate',__params.dueDate);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.accessFee',__params.accessFee);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.interestRate',__params.interestRate);	
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	if(resultType == '2' || resultType == '3')
	{


		__params.errDesc='Use OverDraft Confirmation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Use OverDraft Confirmation Result is Rejected.';
         TC.savingPreValidationEventLog(__params);
        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,107000000000065047,__params); 
        __next='cancel';		

	}
	else if(resultType == '4')
	{
		__params.errDesc='Use OverDraft Confirmation Result is Timeout.';
		__params.TransactionUMCPreValidationError='Use OverDraft Confirmation Result is Timeout.';
         TC.savingPreValidationEventLog(__params);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.IsUseOD',__params.IsUseOD);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.OverDraftAmount',__params.OverDraftAmount);
        	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.currency',__params.currency);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.debt',__params.debt);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.dueDate',__params.dueDate);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.accessFee',__params.accessFee);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.interestRate',__params.interestRate);	
	CurResp = TargetService.invokeForScript(); 
	__next='end';
	}
	else
	{


		__params.errDesc=""Use OverDraft Confirmation Request Failed."";
		__params.TransactionUMCPreValidationError='Use OverDraft Confirmation Request Failed.';
		 TC.savingPreValidationEventLog(__params);
        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,107000000000065047,__params);  
		__next='cancel';
	}
}","4","Use Overdraft Confirmation Again","Use Overdraft Confirmation Again",""<endrec>
"CUSTOMER","","1","10655","2259","ATM Deposit Voucher V2.0","__params.ServiceCode = __serviceCode;
__params.VoucherServiceType = '2'; /* VoucherServiceType */
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__secure = true;
__params.ReasonTypeCode = 'Apply ATM Deposit Voucher for Customer';
__tempData.atmProviders = '';
__tempData.providerName = '';
__next = '1a';
__exemode = 'continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","7","10656","2259","ATM Deposit Voucher V2.0","var isSucess = __input.validateResult.isSucess;
var input = __input.response;
var i = Util.toInt(input) - 1;
if (isSucess)
{
    __tempData.providerName= __tempData.atmProviders.get(i);
    __params.ShortCode=__tempData.ShortCode;
    __next = '3';
}
else
{
  __next = '2';
}","2","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: __tempData.atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","10657","2259","ATM Deposit Voucher V2.0","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","10658","2259","ATM Deposit Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
ATM Provider - ${__tempData.providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","35","2","10659","2259","ATM Deposit Voucher V2.0","__next  = '1b';
__exemode = 'continue';","1a","get all ATM Providers","get all ATM Providers",""<endrec>
"CUSTOMER","","3","10660","2259","ATM Deposit Voucher V2.0","__tempData.atmProviders = __input.lastCommitResult.result;
   if (empty(__tempData.atmProviders) || size(__tempData.atmProviders) == 0) {
      __errormsg = 'Sorry, there is no atmProviders.';
      __next = 'error';
    } else {
    __tempData.providerName= __tempData.atmProviders.get(0);
       __next = '1c';
    }
__exemode = 'continue';","1b","Check selected atmProvider option","check all ATM Provide",""<endrec>
"CUSTOMER","34","4","10661","2259","ATM Deposit Voucher V2.0","__next  = '1d';
__committerParams.ProvideName=__tempData.providerName;
__exemode = 'continue';","1c","get default shortcode","get default shortcode",""<endrec>
"CUSTOMER","","5","10662","2259","ATM Deposit Voucher V2.0","__tempData.ShortCode = __input.lastCommitResult.result;
   if (empty(__tempData.ShortCode )) {
      __errormsg = 'Sorry, cannot get short code.';
      __next = 'error';
    } else {
       __next = '1e';
__exemode = 'continue';
    }","1d","Check shortCode","Check shortCode",""<endrec>
"CUSTOMER","","6","10663","2259","ATM Deposit Voucher V2.0","if(size(__tempData.atmProviders ) == 1)
   {
      __tempData.providerName= __tempData.atmProviders.get(0);
      __params.ShortCode= __tempData.ShortCode;
      __next = '3';
   }
  else
 {
       __next = '2';
 }","1e","init data","init data",""<endrec>
"CUSTOMER","","1","10664","2260","ATM withdraw Voucher V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__secure = true;
__params.ReasonTypeCode = 'CustomerApplyATMVoucher_VDF_Demo';
__next = '1a';
__exemode = 'continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","7","10665","2260","ATM withdraw Voucher V2.0","var isSucess = __input.validateResult.isSucess;
var input = __input.response;
var i = Util.toInt(input) - 1;
if (isSucess)
{
    __tempData.providerName= __tempData.atmProviders.get(i);
    __params.ShortCode=__tempData.ShortCode;
    __next = '3';
}
else
{
  __next = '2';
}","2","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: __tempData.atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","10666","2260","ATM withdraw Voucher V2.0","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","10667","2260","ATM withdraw Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
ATM Provider - ${__tempData.providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","35","2","10668","2260","ATM withdraw Voucher V2.0","__next  = '1b';
__exemode = 'continue';","1a","get all ATM Providers","get all ATM Providers",""<endrec>
"CUSTOMER","","3","10669","2260","ATM withdraw Voucher V2.0","__tempData.atmProviders = __input.lastCommitResult.result;
   if (empty(__tempData.atmProviders) || size(__tempData.atmProviders) == 0) {
      __errormsg = 'Sorry, there is no atmProviders.';
      __next = 'error';
    } else {
    __tempData.providerName= __tempData.atmProviders.get(0);
       __next = '1c';
    }
__exemode = 'continue';","1b","check all ATM Provider","check all ATM Provider",""<endrec>
"CUSTOMER","34","4","10670","2260","ATM withdraw Voucher V2.0","__next  = '1d';
__committerParams.ProvideName=__tempData.providerName;
__exemode = 'continue';","1c","get default shortcode","get default shortcode",""<endrec>
"CUSTOMER","","5","10671","2260","ATM withdraw Voucher V2.0","__tempData.ShortCode = __input.lastCommitResult.result;
   if (empty(__tempData.ShortCode )) {
      __errormsg = 'Sorry, cannot get short code.';
      __next = 'error';
    } else {
       __next = '1e';
__exemode = 'continue';
    }","1d","Check shortCode","Check shortCode",""<endrec>
"CUSTOMER","","6","10672","2260","ATM withdraw Voucher V2.0","if(size(__tempData.atmProviders ) == 1)
   {
      __tempData.providerName= __tempData.atmProviders.get(0);
      __params.ShortCode= __tempData.ShortCode;
      __next = '3';
   }
  else
 {
       __next = '2';
 }","1e","init data","init data",""<endrec>
"CUSTOMER","","1","10673","2261","ATM withdraw Voucher by short code V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
 __params.ReasonTypeCode = 'CustomerApplyATMVoucher_VDF_Demo';
 __next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","10674","2261","ATM withdraw Voucher by short code V2.0","__params.ShortCode=__input.response; 
if (!empty(__params.ShortCode)) {
      __next = '2';
   } 
 else 
   {
      __next = '1';
   }","1","Enter ATM Provider Short Code","<html>
<body>
Enter ATM Provider Short Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10675","2261","ATM withdraw Voucher by short code V2.0","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10676","2261","ATM withdraw Voucher by short code V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Short Code - ${__params.ShortCode} <br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10677","2262","Add Customer Beneficiary V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier = __msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';
__params.ActionType = 'AddCustomerBeneficiary';
__next = '1';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","10678","2262","Add Customer Beneficiary V2.0","__params.@HEAD@PIN = __input.response;
__next = 'end';","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10679","2262","Add Customer Beneficiary V2.0","var input=__input.response;
var isSucess = __input.validateResult.isSucess;

if(empty(input))
{
  __next = '3';
}
else if(isSucess)
{
 __params.BeneficiaryReference = __input.response;
 __next = '3';
}
else
{
__next = '2';
}","2","Input Reference","<html>
<body>
Input Reference:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","15"<endrec>
"CUSTOMER","","2","10680","2262","Add Customer Beneficiary V2.0","var input = __input.response;
if(!empty(input)){
   __params.BeneficiaryIdentifier= __input.response;
   __next = '2';
}else{
    __next ='1';
}","1","Input MSISDN","<html>
<body>
Input MSISDN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10688","2264","Activate Group Account V2.0","var input = __input.response;
var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
__next  = '3a';
__exemode = 'continue';
}else{
 __next  = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10689","2264","Activate Group Account V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'ActiveGroupFSIProducts';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
__params.RequesterIdentifierType = ""01"";
__params.RequesterIdentifier = __msisdn;
__params.OrgShortCode = '2001';

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","9","10690","2264","Activate Group Account V2.0","var input = __input.response;
__params.@HEAD@PIN = input;
__next = 'end';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10691","2264","Activate Group Account V2.0","var input = __input.response;
if (input == '1')
{
   __next = '2a';
}
else if (input == '2')
{
   __next = '0a';
   __exemode = 'continue';
}
else
 {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10692","2264","Activate Group Account V2.0","var isSucess = __input.validateResult.isSucess;
var input = __input.response;
var i = Util.toInt(input) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSucess)
{
 group= __tempData.groups.get(i);
 groupCode= group.groupCode;
__params.ReceiverPartyIdentifier = groupCode;
__next = '3a';
__exemode = 'continue';
}
else{
  __next = '2c';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","2","10693","2264","Activate Group Account V2.0","__next  = '0b';
__committerParams.MSISDN =__msisdn;
__exemode = 'continue';","0a","query my Groups","query my Groups",""<endrec>
"CUSTOMER","","3","10694","2264","Activate Group Account V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","0b","Check My Group","Check My Group",""<endrec>
"CUSTOMER","31","7","10695","2264","Activate Group Account V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__next='3b';
__exemode='continue';","3a","Query Group Member Role","Query Group Member Role",""<endrec>
"CUSTOMER","","7","10696","2264","Activate Group Account V2.0","__tempData.roleList = __input.lastCommitResult.result;
   if (empty(__tempData.roleList) || size(__tempData.roleList) == 0) {
      __errormsg = 'no current group member role.';
      __next = 'error';
    } else {
       __next = '4';
    }","3b","check GroupMemberRoles","check GroupMemberRoles",""<endrec>
"CUSTOMER","","1","10701","2265","Add Group Beneficiary V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier = __msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';
__params.ActionType = 'AddGroupBeneficiary';
__next = '1';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","10702","2265","Add Group Beneficiary V2.0","var input = __input.response;
if(!empty(input)){
   __params.BeneficiaryIdentifier= __input.response;
   __next = '2';
}else{
    __next ='1';
}","1","Input Group Code","<html>
<body>
Input Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10703","2265","Add Group Beneficiary V2.0","var input=__input.response;
if(empty(input))
{
  __next = '3';
}
else if(__input.validateResult.isSucess)
{
 __params.BeneficiaryReference = __input.response;
 __next = '3';
}
else
{
__next = '2';
}","2","Input Reference","<html>
<body>
Input Reference:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","15"<endrec>
"CUSTOMER","","4","10704","2265","Add Group Beneficiary V2.0","__params.@HEAD@PIN = __input.response;
__next = 'end';","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10709","2267","Add Group Member V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'AddGroupMember';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.RequesterIdentifierType = ""01"";
__params.RequesterIdentifier = __msisdn;
__next = '0';","begin","Initialization","",""<endrec>
"CUSTOMER","","3","10710","2267","Add Group Member V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
  __next = '3';
 __exemode = 'continue';
}else {
  __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","10711","2267","Add Group Member V2.0","var input = __input.response;
__params.InvitedMSISDN = input;
if (!empty(input)) {
      __next = '5';
   } 
 else 
   {
      __next = '4';
   }","4","Input Invited Group Member MSISDN","<html>
<body>
Input Invited Group Member MSISDN <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","10712","2267","Add Group Member V2.0","var input=__input.response;
if(!empty(input)){
  var i = Util.toInt(input) - 1;
  var isSuccess = __input.validateResult.isSucess;
  if (isSuccess){
     __tempData.GroupMembRoleId= __tempData.GroupMembRoles.get(i).roleId;
     __tempData.GroupMembRoleName= __tempData.GroupMembRoles.get(i).roleName;
     __next = '5a';
     __exemode='continue';
  }else {
     __next = '5';
  }
}else{
     __next = '5'; 
}","5","Select Role","<html>
<body>
Please Select Role:<br>
$$ var index = 1;
$$ for (role: __tempData.GroupMembRoles){
 ${index} ${role.roleName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","13","10713","2267","Add Group Member V2.0","var input = __input.response;
var isSucess = __input.validateResult.isSucess;
if (empty(input)|| !isSucess) {
    __next = '6';
} else {
    __params.@HEAD@PIN = input;
    __next = '6a';
    __exemode='continue';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","28","10714","2267","Add Group Member V2.0","var input = __input.response;
if (input == '1') {
 if(__tempData.isSupportCNS and __tempData.cust.initiatorCNSStatus.suspensionFlag.fieldValue != '01'){
  __params.ResultType='0';
  __params.EventType=""PRE_VALIDATION"";
  __params.Reason=""Continue Pre-Validation Transaction"";
  __next='9a0';
  __exemode='continue';
 }else{
   __next='end';
 }
} else if(input == '0') {
  if(__params.IsCNSDataDisplayed == 'Yes' )
  {
      __next='8b0';
      __exemode='continue';
  }else{
     __params.EventType=""PRE_VALIDATION"";
     __params.errDesc='Pre-Validation Result is Rejected.';
     __params.Reason=""Rejected"";
     __errormsg = 'You have chosed to reject transation,Please check notification.';
     __next='10a1';
     __exemode='continue';
     sendNotificationfor='cancel';
  }
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","10715","2267","Add Group Member V2.0","var input = __input.response;
if (input == '1') {
  __next = '1';
} else if (input == '2') {
  __exemode = 'continue';
  __next = '2'
} else {
  __next = '0';
}","0","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a></body>
</html>",""<endrec>
"CUSTOMER","","6","10716","2267","Add Group Member V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
  __params.ReceiverPartyIdentifier =  __tempData.Groups.get(i).groupCode;
  __exemode = 'continue';
  __next = '3';
}
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.Groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","10717","2267","Add Group Member V2.0","var input = __input.response;
cust = IC.queryIdentityName(__params.InitiatorIdentifierType,__params.InitiatorIdentifier,'01',__params.InvitedMSISDN);
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
if(!IC.isSupportCustomerNameSearch() || cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01'){
__next = '7';
}
else
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '1')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {           
	   promptText = promptText + 'The amount of charge is '+fee.amount;
	  
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';
	   }
		i = i+1;
	  }
  }
   taxList = budgetMap.tax;

   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
	   if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }
		promptText = promptText + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
  {
    promptText =' No charge.';
  } 
  else
  {
    promptText =promptText +'.';
  }

var tips = '';
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
     if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
     {
       if(cust.subType  == '1000')
       {
	 tips = tips  + 'the received customer is unregistered.' + '<br>';
       }
       else if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
       {		   
           var nameStr= (empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName +' ');

           tips = tips + 'Customer name : ' + IC.maskIdentityName(nameStr) + '<br>';
           if(nameStr != ''){
           __params.IsCNSDataDisplayed = 'Yes';
           }
       }
     }
tips = tips + 'Phone number : ' + cust.basicIdentifier;
promptText = promptText + '<br>' + tips;

__params.preValidationResult = promptText;
__next = '6';
}
}
}
else if (input == '2') {
__next = '7';
}
}
else {
 __next = '5';
}","5","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","4","10719","2267","Add Group Member V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__next = '2a';
__exemode = 'continue';","2","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","10720","2267","Add Group Member V2.0","if(__input.lastCommitResult.isSucess){
   __tempData.Groups = __input.lastCommitResult.result;
   if (empty(__tempData.Groups) || size(__tempData.Groups) == 0) {
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   } else {
        __next = '2b';
   }
}else{
    __errormsg = 'Sorry, error occured when querying groups.';
    __next = 'error';
}","2a","Check Groups","Check Groups",""<endrec>
"CUSTOMER","31","7","10721","2267","Add Group Member V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;

__next = '3a';
__exemode = 'continue';","3","Query Group Member Roles","Query Group Member Roles",""<endrec>
"CUSTOMER","","8","10722","2267","Add Group Member V2.0","if (__input.lastCommitResult.isSucess)
{
__tempData.GroupMembRoles = __input.lastCommitResult.result;
if (!empty(__tempData.GroupMembRoles) || size(__tempData.GroupMembRoles)) {
  __next = '4';
 } else {
   __errormsg = 'no current group member role.';
   __next = 'error';
 }
}else{
   __errormsg = 'Sorry,query group member role failed.';
   __next = 'error';
}","3a","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","32","11","10723","2267","Add Group Member V2.0","__committerParams.RoleType ='GroupMembRole';
  __committerParams.GroupMembRoleId =__tempData.GroupMembRoleId;
  __committerParams.GroupMembRoleName =__tempData.GroupMembRoleName;
__next='5b';
__exemode='continue';","5a","build role info","build role info",""<endrec>
"CUSTOMER","","12","10724","2267","Add Group Member V2.0","if (__input.lastCommitResult.isSucess)
{
 __params.MemberRole = __input.lastCommitResult.result;
 __next  = '6';
}else{
   __errormsg = 'Sorry,build group member Role failed.';
   __next = 'error';
}","5b","Get Member Role","Get Member Role",""<endrec>
"CUSTOMER","","1","10733","2269","Allow My name  be searched V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'ChangeCustCNSKYCFlag';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__params.CNSReceiverFlag='01';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","10734","2269","Allow My name  be searched V2.0","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '2';
__exemode = 'continue';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10735","2269","Allow My name  be searched V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
You are going to allow your name searchable.<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","36","3","10736","2269","Allow My name  be searched V2.0","__committerParams.params = __params;
__next = '2a';
__exemode = 'continue';","2","Build Customer Info","Build Customer Info",""<endrec>
"CUSTOMER","","4","10737","2269","Allow My name  be searched V2.0","if(__input.lastCommitResult.isSucess){
  __params.KYCInfo = __input.lastCommitResult.result;
  __next = '3';
}else{
  __errormsg = 'Sorry,build customer info failed.';
  __next = 'error';
}","2a","Get Customer Info","Get Customer Info",""<endrec>
"CUSTOMER","","1","10738","2270","Apply OTC Voucher V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReasonTypeCode = 'Aplply OTC Voucher';
__next = '1';
__exemode = 'continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","10739","2270","Apply OTC Voucher V2.0","if(__input.validateResult.isSucess)
{
  __params.VoucherSecretCode = __input.response;
  __next = '3b';
  __exemode = 'continue';
}
else
{
  __params.info = __input.validateResult.errorMsg;
  __next = '3a';
}","3a","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10740","2270","Apply OTC Voucher V2.0","var isSucess = __input.validateResult.isSucess;
var input = __input.response;
var tmp = Util.toInt(input) - 1;
if (isSucess)
{
  var type = __tempData.accountList.get(tmp);
  __params.ReceiverAccountNo= type.AccountNo;
  __secure = true;
  __next = '6';
}
else if(tmp == -1)
{
  __next = '6';
  __params.ReceiverAccountNo= '';
}
else
{
  __next = '5';
}","5","Select Account","<html>
<body>
Please select account :<br>
$$multiAccount =  __tempData.accountList;
  $$var i = 0;
 ${i} select no account<br>
 $$for(type: multiAccount ) {
 ${i+1} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","10741","2270","Apply OTC Voucher V2.0","var input = __input.response;
__params.PIN = input;
__next = '7';","6","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","10742","2270","Apply OTC Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to requests buy goods voucher?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","28","2","10743","2270","Apply OTC Voucher V2.0","__committerParams.ReasonTypeCode = __params.ReasonTypeCode;
__next = '2';
__exemode = 'continue';","1","Query IsSupportSecretCode","Query IsSupportSecretCode",""<endrec>
"CUSTOMER","","3","10744","2270","Apply OTC Voucher V2.0","var isSupportSecretCode = __input.lastCommitResult.result;
if(isSupportSecretCode)
{
  __params.info = 'Enter a secret code:';
  __next = '3a';
}
else
{
  __next = '3b';
  __exemode = 'continue';
}","2","Check isSupportSecretCode","Check isSupportSecretCode",""<endrec>
"CUSTOMER","29","5","10745","2270","Apply OTC Voucher V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';

__next = '4';
__exemode = 'continue';","3b","Query Multi Accounts","Query Multi Accounts",""<endrec>
"CUSTOMER","","6","10746","2270","Apply OTC Voucher V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
      __tempData.accountList = __input.lastCommitResult.result;
      if (!empty(__tempData.accountList) || size(__tempData.accountList)>0)
      {
            __next = '5';
      }else
      {
            __next = '6';
      }
}
else
{
    __params.ReceiverAccountNo= '';
    __next = '6';
}","4","Check Multi Accounts","Check Multi Accounts",""<endrec>
"CUSTOMER","","1","10747","2271","Apply Ticket Voucher V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReasonTypeCode = 'Aplply Buy Ticket Voucher';
__next = '1';
__exemode = 'continue';","begin","set parammeters","",""<endrec>
"CUSTOMER","","6","10748","2271","Apply Ticket Voucher V2.0","var input = __input.response;
var length = size(input);
if(length < __tempData.minLength  || length > __tempData.maxLength )
{
__params.info = 'The length of a secret code must be in the range of [' + __tempData.minLength + ',  ' + __tempData.maxLength + '], please enter secret code again!';
__next = '1';
}
else if(!empty(__tempData.rule) and input !~ __tempData.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __tempData.rule + ', please enter secret code again!';
__next = '3';
}
else
{
__params.VoucherSecretCode = input;
__next = '4';
}","3","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10749","2271","Apply Ticket Voucher V2.0","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","10750","2271","Apply Ticket Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '2') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to Apply Ticket Voucher?<br>
1 OK<br>
2 Quit<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","28","2","10751","2271","Apply Ticket Voucher V2.0","__committerParams.ReasonTypeCode = __params.ReasonTypeCode;

__next = '2';
__exemode = 'continue';","1","Query IsSupportSecretCode","Query IsSupportSecretCode",""<endrec>
"CUSTOMER","","3","10752","2271","Apply Ticket Voucher V2.0","var isSupportSecretCode = __input.lastCommitResult.result;if(isSupportSecretCode)
{
       __params.info = 'Enter a secret code:';
       __next = '3a';
       __exemode='continue';
}
else
{
       __next = '4';
}","2","Check IsSupportSecretCode","Check IsSupportSecretCode",""<endrec>
"CUSTOMER","","1","10753","2272","Approval Group Transaction V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'ApproveGroupTask';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","10754","2272","Approval Group Transaction V2.0","var input = __input.response;
if (!empty(input)) {
  __params.OrderID= input;
  __next = '2';
} else {
  __next = '1';
}","1","Input ReminderID","<html>
<body>
Please enter the ReminderID <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10755","2272","Approval Group Transaction V2.0","__params.ApproverMSISDN = __params.InitiatorIdentifier;
var input = __input.response;
if (!empty(input)) {
  __params.GroupCode = input;
  __next = '4a';
  __exemode='continue';
} else {
  __next = '3a';
}","3a","Input GroupCode","<html>
<body>
Please enter the GroupCode:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","10756","2272","Approval Group Transaction V2.0","var input = __input.response;
if (empty(__tempData.ApprovalInfo.GroupCode)) {
  __next = 'error';
} else {
if (input == '1') {
  __params.OperationType = input;
  __next = '6';
} else if( input == '0'){
__params.OperationType = input;
  __next = '6';
} else {
  __next = '5b';
}}","5a","Approve","<html>
<body>
$$approvalInfo=__tempData.ApprovalInfo;
$$if (empty(approvalInfo.GroupCode)) {
The value of GroupCode or ReminderID is incorrect.
$$}else{
Group Approval request for ${approvalInfo.TaskName};<br>
Requested by ${approvalInfo.OriginalInitiatorRole} ${approvalInfo.OriginalInitiator.Identifier};<br>
For group name ${approvalInfo.GroupName} and ID ${approvalInfo.GroupCode}; <br>
Purpose:  ${approvalInfo.Remark}; <br>
Amount: ${approvalInfo.Amount}; <br>
1 Approve<br>
0 Reject<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
$$}
</body>
</html>",""<endrec>
"CUSTOMER","","11","10757","2272","Approval Group Transaction V2.0","var input = __input.response;
if (empty(__tempData.ApprovalInfo.GroupCode)) {
  __next = 'error';
} else {
if (input == '1') {
  __params.OperationType = input;
  __next = '6';
} else if( input == '0'){
__params.OperationType = input;
  __next = '6';
} else {
  __next = '5b';
}}","5b","Approves","<html>
<body>
$$approvalInfo=__tempData.ApprovalInfo;
$$if (empty(approvalInfo.GroupCode)) {
The value of GroupCode or ReminderID is incorrect.
$$}else{
Group Approval request for ${approvalInfo.TaskName};<br>
Requested by ${approvalInfo.OriginalInitiatorRole} ${approvalInfo.OriginalInitiator.Identifier};<br>
For group name ${approvalInfo.GroupName} and ID ${approvalInfo.GroupCode}; <br>
Purpose:  ${approvalInfo.Remark}; <br>
1 Approve<br>
0 Reject<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
$$}
</body>
</html>",""<endrec>
"CUSTOMER","","12","10758","2272","Approval Group Transaction V2.0","var input = __input.response;
if (!empty(input)) {
  __params.@HEAD@PIN = input;
  __next = '7';
} else {
  __next = '6';
}","6","Input PIN","<html>
<body>
Please enter the PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","10759","2272","Approval Group Transaction V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
__next = 'cancel';
} else {
  __next = '7';
}","7","Complete","<html>
<body>
You have completed the approval please press 1 End<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10760","2272","Approval Group Transaction V2.0","var input = __input.response;
if (input == '1') {
  __next = '3a';
} else if (input == '2') {
    __next = '3b0';
    __exemode='continue';
} else {
  __next = '2';
}","2","Select Option","<html>
<body>
Please select option: <br>
1 Input GroupCode<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10761","2272","Approval Group Transaction V2.0","__params.ApproverMSISDN = __params.InitiatorIdentifier;
var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  __params.GroupCode= __tempData.groups.get(i).groupCode;
  __next = '4a';
  __exemode='continue';
}
else{
  __next = '3b';
}","3b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","5","10762","2272","Approval Group Transaction V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='3b1';
__exemode='continue';","3b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","6","10763","2272","Approval Group Transaction V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '3b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","3b1","Check My Groups","Check My Groups",""<endrec>
"CUSTOMER","","1","10770","2275","Buy Airtime V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","11","10771","2275","Buy Airtime V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
Buy Airtime ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","10772","2275","Buy Airtime V2.0","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","10773","2275","Buy Airtime V2.0","var isSucess = __input.validateResult.isSucess;
var input = __input.response;
if (isSucess) {
    __params.Amount = Util.replaceAll(input,',','.');
    __secure = true;
    __next = '7';
} else {
    __next = '6';
}","6","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","8","10774","2275","Buy Airtime V2.0","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifier = '2001'; /* China Mobile's short code */
  __next = '6';
} else {
  __next = '5';
}","5","Input MNO name","<html>
<body>
Input MNO name:<br>
1 China Mobile<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10775","2275","Buy Airtime V2.0","var isSucess = __input.validateResult.isSucess;
var input = __input.response;
var i = Util.toInt(input) - 1;
 if (isSucess){
  var beneficiary= beneficiaries.get(i);
  var beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.RechargedMSISDN = beneficiaryMsisdn ;
  __next = '5';
}
else
{
  __next = '4';
}","4","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ beneficiaries = __tmpData.beneficiaries;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","4","10776","2275","Buy Airtime V2.0","var input = __input.response;
if (!empty(input)) {
  __params.RechargedMSISDN = input;
  __next = '5';
} else {
  __next = '3a';
}","3a","Input MSISDN Number","<html>
<body>
Input MSISDN Number:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10777","2275","Buy Airtime V2.0","var input = __input.response;
if (input == 1) {
  __next = '3a';
} else if (input == '2') {
        __next = '3b';
        __exemode = 'continue';
} else {
  __next = '2';
}","2","Select option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","10778","2275","Buy Airtime V2.0","var input = __input.response;
if (input == '1') {
  __params.RechargedMSISDN = __msisdn;
  __next = '5';
} else if (input == '2') {
  __next = '2';
  __exemode = 'continue';
} else {
  __next = '1';
}","1","Select Phone","<html>
<body>
Please select phone :<br>
1 My phone<br>
2 Other phone<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","23","5","10779","2275","Buy Airtime V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__committerParams.IdentityType = __IdentityInfo.identityType;
__next  = '3c';
__exemode = 'continue';","3b","Query beneficiary","Query beneficiary",""<endrec>
"CUSTOMER","","6","10780","2275","Buy Airtime V2.0","__tempData.beneficiaries = __input.lastCommitResult.result;
if (empty(__tempData.beneficiaries) || size(__tempData.beneficiaries) == 0) {
    __errormsg = 'Sorry, there is no beneficiary.';
    __next = 'error';
}
else
{
    __next = '4';
}","3c","Check selected beneficiary option","Check selected beneficiary option",""<endrec>
"CUSTOMER","","1","10781","2276","CEB Pay Bill V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__tempData.CurrencyCode = ""USD"";
__params.Currency = ""USD"";
__params.sessionId = __sessionID.channelSessionID;
__params.TransTime=Util.getDefaultStartTime();
__next = '0';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","10782","2276","CEB Pay Bill V2.0","var input = __input.response;
if (input == '1') {
  __next = '1a';
  __exemode='continue';
} else if (input == '2') {
  __next = '2';
} else {
  __next = '0';
}","0","Selete Short Code","<html>
<body>
Please Select ShortCode :<br>
  1 Selete Beneficiary Short Code<br>
  2 Input Short Code<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10783","2276","CEB Pay Bill V2.0","var input = __input.response;
if(empty(input)){
  __next='1';
}else if (input == '0') {
  __next = '2';
} else {
	var i = Util.toInt(__input.response) - 1;
        var isSuccess = __input.validateResult.isSucess;
	if (isSuccess) {
		orgBeneficiary = __tempData.orgBeneficiaries.get(i);
		shortCode = orgBeneficiary.BeneficiaryShortCode;
		billReference = orgBeneficiary.BillReference;
		__params.ReceiverPartyIdentifier = shortCode;
		__params.BillReferenceNumber = billReference;
		__next='4a';
               __exemode='continue';
      } else {
	__next = '1';
      }
}","1","Select Beneficiary ShortCode","<html>
<body>
Please Select Beneficiary ShortCode:<br>
$$ var index = 1;
$$ for (orgBeneficiary: __tempData.orgBeneficiaries){
 ${index} ${orgBeneficiary.BeneficiaryName} ${orgBeneficiary.BeneficiaryShortCode} ${orgBeneficiary.BeneficiaryReference} ${orgBeneficiary.BillReference} <br> 
$$ index = index + 1;
$$ }
     0 Input Short Code
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","6","10784","2276","CEB Pay Bill V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
   __next = '3';","2","Input Short Code","<html>
<body>
Input Short Code<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10785","2276","CEB Pay Bill V2.0","var input = __input.response;
__params.BillReferenceNumber = input;
__next='4a';
__exemode='continue';","3","Input Bill No","<html>
<body>
Input Bill No <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","10786","2276","CEB Pay Bill V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
   __params.ReasonTypeCode = __tempData.reasonTypes.get(i).getAlias();
   __next = '5a';
   __exemode='continue';
} 
else {
   __next = '4';
}","4","Input Reason Type","<html>
<body>
Please select reason type:<br>
$$ var index = 1;
$$ for (reasonType : __tempData.reasonTypes) {
  ${index} ${reasonType.getDisplayName(__locale)}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","15","10787","2276","CEB Pay Bill V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
               type =  __tempData.multiAccount.get(tmp);
                __params.InitiatorAccountNo = type.AccountNo;;
                __next = '6';
         } else {
                __next = '5';
         }
    } else {
        __next = '5';
    }","5","Choose Inititator Account","<html>
<body>
Please Choose Inititator Account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","16","10788","2276","CEB Pay Bill V2.0","var input=__input.response;
if(empty(input))
{
__next = '6';
}
else
{
__params.PIN = input;
__params.put('TransOutgoingRequest@LIST@Param.BillReferenceNumber',__params.BillReferenceNumber);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode',__params.ReceiverPartyIdentifier);
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',__params.AccessDeviceIdentifier);
__params.put('TransOutgoingRequest@LIST@Param.TransType','PayBill_VDF_Demo');
__params.put('TransOutgoingRequest@LIST@Param.TransID',__params.sessionId);
__params.put('TransOutgoingRequest@LIST@Param.TransTime',__params.TransTime);
__next='6a';
__exemode='continue';
}","6","Input PIN","<html>
<body>
Input PIN :<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","24","10789","2276","CEB Pay Bill V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
$$formatAmount = Util.formatAmount(__tempData.CurrencyCode, __params.Amount);
$$if(empty(__tempData.chargeFee))
$${
To Pay ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${__tempData.orgName} for account number ${__params.BillReferenceNumber}.Press 1 to confirm or 0 to cancel.<br>
$$}
$$else
$${
To Pay ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${__tempData.orgName} for account number ${__params.BillReferenceNumber}, the charge is ${__tempData.chargeFee}.Press 1 to confirm or 0 to cancel.<br>
$$}
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","19","10790","2276","CEB Pay Bill V2.0","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
     __next='8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10791","2277","Cancel Reminder Schedule V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType= 'DeleteIndividualReminderSchedule';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__params.NeedConfirmation = '1';
__next = '1a';
__exemode = 'continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","10792","2277","Cancel Reminder Schedule V2.0","var isSucess = __input.validateResult.isSucess;
if (isSucess)
{
      var i = Util.toInt(__input.response) - 1;
     __tempData.selectedReminder = __tempData.reminderList.get(i);
     __params.ReminderScheduleID =  __tempData.selectedReminder.reminderId;
     __next = '3';
}
else {
  __next = '2';
}","2","Select Reminder Schedule","<html>
<body>
Please Select Cancel Reminder Schedule:<br>
$$ var index = 1;
$$reminderList=__tempData.reminderList;
$$ for (reminder : reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","10793","2277","Cancel Reminder Schedule V2.0","__params.@HEAD@PIN = __input.response;
__next = '4';","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10794","2277","Cancel Reminder Schedule V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
$$ amap = { ""1"" : ""One Off"", ""2"" : ""Daily"", ""3"" : ""Weekly"", ""4"": ""4-Weekly"" ,""5"" : ""Monthly"", ""6"" : ""Bi Monthly"", ""7"" : ""Quarterly"", ""8"": ""Half Yearly"", ""9"": ""Yearly""};
Confirm to cancel reminder schedule:<br>
$$reminder = __tempData.selectedReminder;
ReminderScheduleID:${reminder.reminderId}<br>
ReminderName:${reminder.reminderName}<br>
Description:${reminder.freeText}<br>
ServiceID:${reminder.serviceID}<br>
Start Date:${reminder.firstPaymentReminderDate}<br>
End Date:${reminder.issuePaymentReminderUntil}<br>
Frequency:${amap.get(reminder.frequency)}.<br><br>
1 OK  <br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10795","2278","Cancel Standing Order Schedule V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = __msisdn;
__params.ActionType= 'DeleteIndividualReminderSchedule';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;
__params.NeedConfirmation= '0';

__next='1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","10796","2278","Cancel Standing Order Schedule V2.0","var i = Util.toInt(__input.response) -1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
__params.ReminderScheduleID =  __tempData.reminderList.get(i).reminderId;
__params.ReminderScheduleName = __tempData.reminderList.get(i).reminderName;
__next = '3';
} else {
__next = '2';
}","2","Select Standing Order Schedule","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$reminderList=__tempData.reminderList;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","10797","2278","Cancel Standing Order Schedule V2.0","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10798","2278","Cancel Standing Order Schedule V2.0","var input = __input.response;
if (input == '1') {
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '4';
}","4","Comfirm","<html>
<body>
Confirm to cancel reminder schedule:<br>
ReminderScheduleID:${__params.ReminderScheduleID}<br>
ReminderName:${__params.ReminderScheduleName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10799","2279","Cancel Standing Order Schedule By Group V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ActionType = 'DeleteGroupReminderSchedule';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.NeedConfirmation = '0';

__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","10800","2279","Cancel Standing Order Schedule By Group V2.0","var input = __input.response;
if(!empty(input)){
        var found = '1';
         for (group: __tempData.groups) {
    if (group.groupCode == input) {
      found = '0';
    }
  }
        if (found == '1') {
    __errormsg = 'no current group or not belong to the group.';
    __next = 'error';
  } else {
     __params.ReceiverPartyIdentifier = input;
     __next='2a';
     __exemode='continue';
  }
}else {
       __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10801","2279","Cancel Standing Order Schedule By Group V2.0","var isSuccess = __input.validateResult.isSucess;
if(isSuccess){
   var i=Util.toInt(__input.response)-1;
   __params.ReminderScheduleID = __tempData.reminderList.get(i).reminderId;
   __params.ReminderScheduleName =__tempData.reminderList.get(i).reminderName;
   __next = '3';
} else {
   __next = '2';
}","2","Select Standing Order Schedule","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$reminderList=__tempData.reminderList;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","10802","2279","Cancel Standing Order Schedule By Group V2.0","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","10803","2279","Cancel Standing Order Schedule By Group V2.0","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '4';
}","4","Comfirm","<html>
<body>
Confirm to cancel reminder schedule:<br>
ReminderScheduleID:${__params.ReminderScheduleID}<br>
ReminderName:${__params.ReminderScheduleName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10804","2280","Change Group Member Role V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'ChangeGroupMemberRole';
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* MSISDN */

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","10805","2280","Change Group Member Role V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';
   }
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","10806","2280","Change Group Member Role V2.0","var input = __input.response;
if (!empty(input)) {
  __params.ChangedMSISDN = input;
  __next = '4a';
  __exemode='continue';
} else {
  __next = '3';
}","3","Enter Changed MSISDN","<html>
<body>
Enter Changed MSISDN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","10807","2280","Change Group Member Role V2.0","var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
                __tempData.RemoveRole=__tempData.listRoles.get(i);
                __params.RemoveRoleName=__tempData.RemoveRole.roleName;
                __next = '5a';
                __exemode='continue';
         } else {
                __next = '4';
         }
    } else {
        __next = '3';
    }","4","Select Remove Group Member Role","<html>
<body>
Select Remove Group Member Role:<br>
$$listRoles =__tempData.listRoles;
$$var i = 1;
$$ for(role : listRoles) {
${i} ${role.roleName}<br>
$$  i = i+1;
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","13","10808","2280","Change Group Member Role V2.0","var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
              __tempData.AddRole=__tempData.addListRoles.get(i);
              __params.AddRoleName=__tempData.AddRole.roleName;
                __next = '6';
         } else {
                __next = '5';
         }
    } else {
        __next = '4';
    }","5","Select Add Group Member Role","<html>
<body>
Select Add Group Member Role:<br>
$$addListRoles=__tempData.addListRoles;
  $$var i = 1;
  $$for(role: addListRoles) {
  ${i} ${role.roleName}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","14","10809","2280","Change Group Member Role V2.0","var input = __input.response;
if (empty(input)) {
    __next = '6';
} else {
   var isSuccess=__input.validateResult.isSucess;
   if(isSuccess){
      __params.@HEAD@PIN = input;
      __next = '7a';
      __exemode='continue';
   }else{
      __next = '6';
   }
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","21","10810","2280","Change Group Member Role V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","9","Confirm","<html>
<body>
Confirm to change group member ${__params.ChangedMSISDN} from role ${__params.RemoveRoleName} to ${__params.AddRoleName}?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","10811","2280","Change Group Member Role V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
  __next = '1a';
  __exemode='continue';
} else {
  __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10812","2280","Change Group Member Role V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  __params.ReceiverPartyIdentifier = __tempData.groups.get(i).groupCode;
  __next = '3';
}
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$groups=__tempData.groups;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","23","3","10813","2276","CEB Pay Bill V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__committerParams.IdentityType='5000';
__next='1b';
__exemode='continue';","1a","Query Organization Beneficiary","Query Organization Beneficiary",""<endrec>
"CUSTOMER","","4","10814","2276","CEB Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.orgBeneficiaries= __input.lastCommitResult.result;
   if (empty(__tempData.orgBeneficiaries) || size(__tempData.orgBeneficiaries) == 0) {
      __errormsg = 'There is no beneficiary exist.';
      __next = 'error';
    } else {
       __next = '1';
    }
}else{
   __errormsg = 'Sorry,error occured when querying organization beneficiary.';
   __next = 'error';
}","1b","Check Organization Beneficiary","Check Organization Beneficiary",""<endrec>
"CUSTOMER","70","8","10815","2276","CEB Pay Bill V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__next='4b';
__exemode='continue';","4a","query isManualSelectionMode","query isManualSelectionMode",""<endrec>
"CUSTOMER","","9","10816","2276","CEB Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
   isManual= __input.lastCommitResult.result;
   if (isManual) {
      __next = '4c';
      __exemode='continue';
    } else {
       __next = '5a';
       __exemode='continue';
    }
}else{
   __errormsg = 'Sorry,querying isManualSelectionMode failed.';
   __next = 'error';
}","4b","Check isManualSelectionMode","Check isManualSelectionMode",""<endrec>
"CUSTOMER","33","10","10817","2276","CEB Pay Bill V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__next='4d';
__exemode='continue';","4c","Query Reason Type","Query Reason Type",""<endrec>
"CUSTOMER","","10","10818","2276","CEB Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.reasonTypes= __input.lastCommitResult.result;
   if (empty(__tempData.reasonTypes) || size(__tempData.reasonTypes) == 0) {
      __errormsg = 'There is not any reason types.';
      __next = 'error';
    } else {
       __next = '4';
    }
}else{
   __errormsg = 'Sorry,error occured when querying reasonTypes.';
   __next = 'error';
}","4c","Check Reason Types","Check Reason Types",""<endrec>
"CUSTOMER","29","13","10819","2276","CEB Pay Bill V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;
__next='5b';
__exemode='continue';","5a","Query Multi Account","Query Multi Account",""<endrec>
"CUSTOMER","","14","10820","2276","CEB Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='5';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","5b","Check Multi Account","Check Multi Account",""<endrec>
"CUSTOMER","75","17","10821","2276","CEB Pay Bill V2.0","__committerParams.InterfaceCode='52';
__next='6b';
__exemode='continue';","6a","send Sync Trans Outgoing","send Sync Trans Outgoing",""<endrec>
"CUSTOMER","","18","10822","2276","CEB Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.response= __input.lastCommitResult.result;
  if(empty(__tempData.response) || empty(__tempData.response.msgBody) ||empty(__tempData.response.msgBody.getWithExpr(""C2BPaymentQueryResponse"")) || __tempData.response.msgBody.getWithExpr(""C2BPaymentQueryResponse"").IsSuccess!=""true"" )
  {	
          __errormsg = 'Sorry, Query bill Statement error';
          __next = 'error';
  }
  else
  {
         billAmount = __tempData.response.msgBody.getWithExpr(""C2BPaymentQueryResponse"").Amount;
  	 if(!empty(billAmount))
  	 {
  	      __params.Amount = billAmount;
  	      __next = '7';
  	 }
  	 else
  	 {
  	      __errormsg = 'Sorry, there is no bill amount';
              __next = 'error';
  	 }  
  }
}else{
   __errormsg = 'Sorry,send sync Trans outgoing  failed.';
   __next = 'error';
}","6b","check Response","check Response",""<endrec>
"CUSTOMER","74","20","10823","2276","CEB Pay Bill V2.0","__committerParams.ShortCode=__params.ReceiverPartyIdentifier;
__exemode='continue';
__next='8b';","8a","Query Org Name","Query Org Name",""<endrec>
"CUSTOMER","","21","10824","2276","CEB Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.orgName= __input.lastCommitResult.result;
       __next = '8c';
       __exemode='continue';
}else{
   __errormsg = 'Sorry,error occured when querying org name.';
   __next = 'error';
}","8b","Check Org Name","Check Org Name",""<endrec>
"CUSTOMER","27","22","10825","2276","CEB Pay Bill V2.0","__next='8d';
__exemode='continue';","8c","Query Customer Charge","Query Customer Charge",""<endrec>
"CUSTOMER","","23","10826","2276","CEB Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.chargeFee  = __input.lastCommitResult.result;
   __next = '8';
}else{
   __errormsg = 'Sorry,query charge failed.';
   __next = 'error';
}","8d","Check Customer Charge","Check Customer Charge",""<endrec>
"CUSTOMER","44","2","10827","2277","Cancel Reminder Schedule V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.AccessDeviceIdentifierType=__params.AccessDeviceIdentifierType;
__committerParams.AccessDeviceIdentifier=__params.AccessDeviceIdentifier;
__committerParams.NeedConfirmation=__params.NeedConfirmation;

__next = '1b';
__exemode = 'continue';","1a","Query individual remiders","",""<endrec>
"CUSTOMER","","3","10828","2277","Cancel Reminder Schedule V2.0","var commitResult = __input.lastCommitResult;
if (commitResult.isSucess)
{
      __tempData.reminderList = commitResult.result;
      if (empty(__tempData.reminderList) || size(__tempData.reminderList)==0)
      {
           __errormsg = 'no current schedules.';
           __next = 'error';
      }else{
           __next = '2';
      }
}
else
{
    __errormsg = 'Sorry,error accured when querying schedules.';
    __next = 'error';
}","1b","Checker Individual Reminders","Checker Individual Reminders",""<endrec>
"CUSTOMER","44","2","10829","2278","Cancel Standing Order Schedule V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.NeedConfirmation=__params.NeedConfirmation;
__next='1b';
__exemode='continue';","1a","Query Schedules","",""<endrec>
"CUSTOMER","","3","10830","2278","Cancel Standing Order Schedule V2.0","commitResult=__input.lastCommitResult;
if (commitResult.isSucess)
{
    __tempData.reminderList =commitResult.result;
   if(empty(__tempData.reminderList)|| size(__tempData.reminderList)==0){
       __errormsg = 'no current schedules.';
       __next = 'error';
   }else {
       __next = '2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying schedules.';
   __next = 'error';
}","1b","Check Schedules","Check Schedules",""<endrec>
"CUSTOMER","30","2","10831","2279","Cancel Standing Order Schedule By Group V2.0","__committerParams.MSISDN=__msisdn;
__next='1b';
__exemode='continue';","1a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","3","10832","2279","Cancel Standing Order Schedule By Group V2.0","if(__input.lastCommitResult.isSucess){
   __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
      __errormsg = 'no current groups.';
      __next = 'error';
}","1b","Check Query My Groups","Check Query My Groups",""<endrec>
"CUSTOMER","44","5","10833","2279","Cancel Standing Order Schedule By Group V2.0","__committerParams.ServiceCode=__params.ServiceCode;
  __committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
  __committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
  __committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
  __committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__next='2b';
__exemode='continue';","2a","Query Initiator Schedule","Query Initiator Schedule",""<endrec>
"CUSTOMER","","6","10834","2279","Cancel Standing Order Schedule By Group V2.0","var commitResult=__input.lastCommitResult;
if (commitResult.isSucess)
{
    __tempData.reminderList =commitResult.result;
   if(empty(__tempData.reminderList)|| size(__tempData.reminderList)==0){
       __errormsg = 'no current schedules.';
       __next = 'error';
   }else {
       __next = '2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying schedules.';
   __next = 'error';
}","2b","Check Schedules","Check Schedules",""<endrec>
"CUSTOMER","30","3","10835","2280","Change Group Member Role V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__next='1b';
__exemode='continue';","1a","Query Groups","Query Groups",""<endrec>
"CUSTOMER","","4","10836","2280","Change Group Member Role V2.0","if(__input.lastCommitResult.isSucess){
   __tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups) || size(__tempData.groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
}else{
    __errormsg = 'Sorry, error occured when querying groups.';
    __next = 'error';
}","1b","Check Query Group","Check Query Group",""<endrec>
"CUSTOMER","31","8","10837","2280","Change Group Member Role V2.0","__committerParams.ReceiverPartyIdentifier=__params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;

__next='4b';
__exemode='continue';","4a","Query Remove Group Member Role","Query Remove Group Member Role",""<endrec>
"CUSTOMER","","9","10838","2280","Change Group Member Role V2.0","if(__input.lastCommitResult.isSucess){
   __tempData.listRoles=__input.lastCommitResult.result;
   if (empty(__tempData.listRoles) || size(__tempData.listRoles) == 0) {
      __errormsg = 'The customer (initiator, requester, or the recharge party) has not been invited to join the group or the customer has been invited but has not confirmed the invitation.';
      __next = 'error';
    } else {
       __next = '4';
    }
}else{
     __errormsg = 'Sorry,error occured when querying current member roles.';
      __next = 'error';
}","4b","Check Remove Group Member Role","Check Remove Group Member Role",""<endrec>
"CUSTOMER","31","11","10839","2280","Change Group Member Role V2.0","__committerParams.ReceiverPartyIdentifier=__params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;

__next='5b';
__exemode='continue';","5a","Query Available Group Member Role","Query Available Group Member Role",""<endrec>
"CUSTOMER","","12","10840","2280","Change Group Member Role V2.0","if(__input.lastCommitResult.isSucess){
__tempData.addListRoles=__input.lastCommitResult.result;
   if (empty(__tempData.addListRoles) || size(__tempData.addListRoles) == 0) {
      __errormsg = 'The customer (initiator, requester, or the recharge party) has not been invited to join the group or the customer has been invited but has not confirmed the invitation.';
      __next = 'error';
    } else {
       __next = '5';
    }
}else{
     __errormsg = 'Sorry,error occured when querying available member roles.';
      __next = 'error';
}","5b","Check Available Group Member Role","Check Available Group Member Role",""<endrec>
"CUSTOMER","32","15","10841","2280","Change Group Member Role V2.0","__committerParams.RoleType = 'AddRole';
__committerParams.AddRoleId=__tempData.AddRole.roleId;
__committerParams.AddRoleName=__tempData.AddRole.roleName;
__exemode='continue';
__next='7b';","7a","Build AddMemberRole Info","Build AddMemberRole Info",""<endrec>
"CUSTOMER","","16","10842","2280","Change Group Member Role V2.0","if(__input.lastCommitResult.isSucess){
  __params.AddRoleList= __input.lastCommitResult.result;
  __next='7c';
  __exemode='continue';
}else{
   __errormsg='Sorry,build AddRole Info failed';
   __next='error';
}","7b","Get Add Member Role Info","Get Add Member Role Info",""<endrec>
"CUSTOMER","32","17","10843","2280","Change Group Member Role V2.0","__committerParams.RoleType = 'RemoveRole';
__committerParams.RemoveRoleId=__tempData.RemoveRole.roleId;
__committerParams.RemoveRoleName=__tempData.RemoveRole.roleName;
__next='7d';
__exemode='continue';","7c","Build RemoveRole Info","Build RemoveRole Info",""<endrec>
"CUSTOMER","","18","10845","2280","Change Group Member Role V2.0","if(__input.lastCommitResult.isSucess){
  __params.RemoveRoleList = __input.lastCommitResult.result;
  __next='7';
}else{
   __errormsg='Sorry,build RemoveRole Info failed';
   __next='error';
}","7d","Get Remove Role Info","Get Remove Role Info",""<endrec>
"CUSTOMER","","1","10846","2281","Confirm Group Member ship V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'ConfirmGroupMembership';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* GroupCode */

__next = '1';
__exemode = 'continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","5","10847","2281","Confirm Group Member ship V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2a","Enter Group Code","<html>
<body>
Enter Group Code<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10848","2281","Confirm Group Member ship V2.0","__params.@HEAD@PIN = __input.response;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","10849","2281","Confirm Group Member ship V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10850","2281","Confirm Group Member ship V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
  if (empty( __tempData.beneficiaries) || size( __tempData.beneficiaries) == 0) {
    __errormsg = 'Sorry, there is no beneficiary.';
    __next = 'error';
  } else {
    __next = '2b';
  }
} else {
  __next = '2';
}","2","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10851","2281","Confirm Group Member ship V2.0","var i = Util.toInt(__input.response) - 1;
if (__input.validateResult.isSucess) {
    beneficiary= __tempData.beneficiaries.get(i);
    beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
    __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
    __next = '3';
} else {
    __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary : __tempData.beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","10852","2282","Create Bank Account V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'CreateIdentityBankAccount';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__tempData.attrIndex = 0;
__next  = '0a';
__exemode = 'continue';","begin","set parammeters","",""<endrec>
"CUSTOMER","","8","10853","2282","Create Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
	__params.BankId = '-1';
	__params.BankName = 'Others';
	if (i < size(__tempData.items)) {
		item = __tempData.items.get(i);
		__params.BankId = item.value;
		__params.BankName = item.defaultName;
	}
       __exemode = 'continue';
	__next = '4a';
} else if (i ==size(__tempData.items)){
        __params.BankId = '-1';
	__params.BankName = 'Others';

        __tempData.InfoDetail= Util.createMap();
        __exemode = 'continue';
	__next = '4a';
}else{
	__next = '3';
}","3","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:__tempData.items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","10854","2282","Create Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    bank = __tempData.bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '6';
} else {
  __next = '5';
}","5","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:__tempData.bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","10855","2282","Create Bank Account V2.0","var input = __input.response;
if (!empty(input)) {
  __params.AccountName = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Account Name","<html>
<body>
Enter Account Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","10856","2282","Create Bank Account V2.0","var input = __input.response;
if (!empty(input))
{
  __params.AccountNumber = input;
  if(__tempData.IsMultiCurrency =='Y' and __params.BankId != '-1'){
    __next = '8a';
    __exemode = 'continue';
  }
  if (size(__tempData.attrList) > 0 and  __params.BankId == '-1'){
    __next = '10';
  }
  if (size(__tempData.attrList) == 0 || __params.BankId != '-1'){
    __next = '11';
  }
} else {
  __next = '7';
}","7","Enter Account Number","<html>
<body>
Enter Account Number:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","20","10857","2282","Create Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = '12';
} else if(input == '0') {
  __next = '0a';
  __exemode = 'continue';
} else {
  __next = '11';
}","11","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${__params.BankName}<br>
Branch:${__params.BranchName}<br>
Account Name:${__params.AccountName}<br>
Account Number:${__params.AccountNumber}<br>
$$ if(__tempData.IsMultiCurrency =='Y') {
Currency:${__params.Currency}<br>
$$ }
$$ if(size(__tempData.attrList) > 0 && __params.BankId == '-1') {
$$ for (detail:__params.FIAccountInfo.InfoDetail){
${detail.Key}:${detail.Value}<br>
$$ }
$$ }
<br>
1 OK<br>
0 Back<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","21","10858","2282","Create Bank Account V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!isSuccess ||  empty(input ))
{
    __next = '12';
} else {
   __params.@HEAD@PIN = input ;
    __next = '13';
}","12","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","22","10859","2282","Create Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '13';
}","13","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","10860","2282","Create Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    __params.Currency = __tempData.currencys.get(i);
    __next = '11';
} else {
  __next = '9';
}","9","Select Currency","<html>
<body>
Select Currency:<br>
$$ var index = 1;
$$ for (currency:__tempData.currencys){
 ${index} ${currency}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","17","10861","2282","Create Bank Account V2.0","var input = __input.response;
if (!empty(input)) {
  __tempData.InfoDetail[__tempData.attrList[__tempData.attrIndex]]= input;

  __tempData.attrIndex = __tempData.attrIndex + 1;
  if(__tempData.attrIndex < size(__tempData.attrList)) {
    __next = '10';
  } else {
    __exemode = 'continue';
    __next = '10a';
  }
} else {
  __next = '10';
}","10","Enter Bank Account Info","<html>
<body>
Enter ${__tempData.attrList[__tempData.attrIndex]}:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10862","2283","Create Bank Card Lookup V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'CreateIdentityBankCardLookup';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;

__exemode = 'continue';
__next = '1a';","begin","set parammeters","",""<endrec>
"CUSTOMER","","6","10863","2283","Create Bank Card Lookup V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
	__params.BankId = '-1';
	__params.BankName = 'Others';
	if (i < size(__tempData.items)) {
		item = __tempData.items.get(i);
		__params.BankId = item.value;
		__params.BankName = item.defaultName;
	}
       __exemode = 'continue';
	__next = '4a';
} else if (i ==size(__tempData.items)){
        __params.BankId = '-1';
	__params.BankName = 'Others';
        __exemode = 'continue';
	__next = '4a';
}else{
	__next = '3';
}","3","Select Bank","<html>
<body>
Select Bank1:<br>
$$ var index = 1;
$$ for (item:__tempData.items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","9","10864","2283","Create Bank Card Lookup V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    bank = __tempData.bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '6';
} else {
  __next = '5';
}","5","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:__tempData.bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","10","10865","2283","Create Bank Card Lookup V2.0","var input = __input.response;
if (!empty(input)) {
  __params.AccountName = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Lookup Name","<html>
<body>
Enter Lookup Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","10866","2283","Create Bank Card Lookup V2.0","var input = __input.response;
if (!empty(input)) {
  __params.AccountNumber = input;
  if(size(__tempData.attrList)> 0) {
    __tempData.attrIndex = 0;
    __next = '8';
  } else {
    __next = '9';
  }
} else {
  __next = '7';
}","7","Enter Lookup Card No.","<html>
<body>
Enter Lookup Card No.:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","10867","2283","Create Bank Card Lookup V2.0","var input = __input.response;
if (!empty(input)) {
  __tempData.InfoDetail[__tempData.attrList[__tempData.attrIndex]]= input;
__tempData.attrIndex= __tempData.attrIndex +1;
  if(__tempData.attrIndex < size(__tempData.attrList)) {
    __next = '8';
  } else {
    __exemode = 'continue';
    __next = '8a';
  }
} else {
  __next = '8';
}","8","Enter FI Account Info","<html>
<body>
Enter ${__tempData.attrList[__tempData.attrIndex]}:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","10868","2283","Create Bank Card Lookup V2.0","var input = __input.response;
if (input == '1') {
  __next = '10';
} else if(input == '0') {
  __next = '1';
} else {
  __next = '9';
}","9","Confirm Bank Card Lookup","<html>
<body>
Confirm Bank Card Lookup<br><br>
Bank:${__params.BankName}<br>
Bank Branch:${__params.BranchName}<br>
Lookup Name:${__params.AccountName}<br>
Lookup Card No.:${__params.AccountNumber}<br>
<br>
$$ for (detail:__params.FIAccountInfo.InfoDetail){
${detail.Key}:${detail.Value}<br>
$$ }
<br>
1 OK<br>
0 Back<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","10869","2283","Create Bank Card Lookup V2.0","var input= __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess and !empty(input)) {
 __params.@HEAD@PIN = input;
    __next = '11';
} else {
    __next = '10';
}","10","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","17","10870","2283","Create Bank Card Lookup V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","11","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10871","2284","Create Customer Bundle V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = __msisdn;
__params.InitiatorIdentifierType= '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier= __msisdn;
__params.AssignType= '1';
__params.ActionType = 'CreateCustomerBundle';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","10872","2284","Create Customer Bundle V2.0","var input = __input.response;
var isSucess =  __input.validateResult.isSucess;
if (isSucess)
{
    __params.BundleType= input ;
    __next = '2a';
    __exemode = 'continue';
} else {
    __next = '1';
}","1","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","5","10873","2284","Create Customer Bundle V2.0","var input = __input.response;
if (!empty(input))
 {
        var isSucess = __input.validateResult.isSucess;
        var tmp = Util.toInt(__input.response) - 1;
         if(isSucess ) {
               type = __tempData.BundleList.get(tmp);
                __params.BundleID = type.bundleId;
                __params.BundleName = type.bundleName;
                __params.Price= type.internalPrice;
                __params.Currency= type.Currency;
                __params.AutomaticRenewal= type.automaticRenewal;
                __params.BundleProvider= type.bundleProvider;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }","3","Select a Bundle","<html>
<body>
Please select destination bundle :<br>
  $$var i = 1;
  $$for(bundle: __tempData.BundleList) {
   ${i} ${bundle.bundleName} :(${bundle.internalPrice} ${bundle.Currency})
$$if (!empty(bundle.durationTimes)) {
 (${bundle.durationTimes} ${bundle.durationUnit})<br>
$$}else{
     <br>
$$}
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","6","10874","2284","Create Customer Bundle V2.0","var input = __input.response;
var isSucess = __input.validateResult.isSucess;
if (isSucess)
 {
    if(input =='1')
    {
           __params.EffectiveMode= '0';
            __next = '5';
    }
    else if(input =='2')
    {
            __secure = true;
            __params.EffectiveMode= '-1';
            __next = '6';
    }else {
          __next = '4';
}
}
else {
 __next = '4';
}","4","Select Effective Mode","<html>
<body>Select Effective Mode:<br>
1 Input days from today<br>
2 Next day of the same bundle expired<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","10875","2284","Create Customer Bundle V2.0","var input = __input.response;
var isSucess = __input.validateResult.isSucess;
if (isSucess) {
     __params.EffectiveMode= input;
     __next = '6';
   }
else{
    __next = '5';
}","5","Input Days From Today","<html>
<body>Input Days From Today:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","8","10876","2284","Create Customer Bundle V2.0","var input = __input.response;
if (input == '1') {
  __next = '7';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm Bundle Information","<html>
<body>
Please Confirm Bundle Information :<br>
     Bundle Name : ${__params.BundleName}<br>
$$if (!empty(__params.BundleProvider )) {
     Provider :${__params.BundleProvider}<br>
$$}
     Price : ${__params.Price} ${__params.Currency}<br>
$$if(__params.EffectiveMode=='-1'){
     Next day of the same bundle expired<br>
$$}else if(__params.EffectiveMode=='0'){
     Effective Date : Today<br>
$$}else{
     Effective Date : ${__params.EffectiveMode} days from today<br>
$$}
$$if(__params.AutomaticRenewal=='0'){
     Renewal Mode : No action<br>
$$}else if(__params.AutomaticRenewal=='1'){
     Renewal Mode : Send Reminer only<br>
$$}else if(__params.AutomaticRenewal=='2'){
     Renewal Mode : Automatically subscribe<br>
$$}
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","10877","2284","Create Customer Bundle V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
 __params.@HEAD@PIN = input;
    __next = '8a';
    __exemode = 'continue';
} else {
    __next = '7';
}","7","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","12","10878","2284","Create Customer Bundle V2.0","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel';
} else {
   __next = '9';
}","9","Confirm","<html>
<body>
Confirm to subscribe customer bundle?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","23","2","10879","2281","Confirm Group Member ship V2.0","__committerParams.MSISDN = __msisdn;
__next = '1a';
__exemode = 'continue';","1","Query Group List Beneficiary","Query Group List Beneficiary",""<endrec>
"CUSTOMER","","3","10880","2281","Confirm Group Member ship V2.0","if (__input.lastCommitResult.isSucess) {
    __tempData.beneficiaries = __input.lastCommitResult.result;
    __next = '2';
} else {
    __errormsg = 'System Error!';
    __next = 'error';
}","1a","Check Group List Beneficiary","Check Group List Beneficiary",""<endrec>
"CUSTOMER","48","2","10881","2282","Create Bank Account V2.0","__next  = '0b';
__committerParams.SystemParamCode='MULTI_CURRENCY_MODEL';
__exemode = 'continue';","0a","is Multi Currency","is Multi Currency",""<endrec>
"CUSTOMER","","3","10882","2282","Create Bank Account V2.0","__tempData.IsMultiCurrency = __input.lastCommitResult.result;
   if (empty( __tempData.IsMultiCurrency) )
   {
      __errormsg = 'Sorry, faild to get IsMultiCurrency.';
      __next = 'error';
   } else
   {
       __next = '1a';
       __exemode = 'continue';
   }","0b","check is Multi Currency","check is Multi Currency",""<endrec>
"CUSTOMER","49","4","10883","2282","Create Bank Account V2.0","__next  = '1b';
__committerParams.DataDictKey ='BANK_CATEGORY';
__exemode = 'continue';","1a","query Data DictType By Key","query Data DictType By Key",""<endrec>
"CUSTOMER","","5","10884","2282","Create Bank Account V2.0","__tempData.items   = __input.lastCommitResult.result;
   if (empty(__tempData.items ) )
   {
      __errormsg = 'Sorry, faild to get DataDictType.';
      __next = 'error';
   } else
   {
       __next = '2a';
       __exemode = 'continue';
   }","1b","check Data DictType By Key","check Data DictType By Key",""<endrec>
"CUSTOMER","50","6","10885","2282","Create Bank Account V2.0","__next  = '2b';
__committerParams.IdentityType ='1000';
__exemode = 'continue';","2a","query BankCard Attr","query BankCard Attr",""<endrec>
"CUSTOMER","","7","10886","2282","Create Bank Account V2.0","__tempData.attrList = __input.lastCommitResult.result;
   if (empty(__tempData.attrList ) || size(__tempData.attrList) == 0)
   {
      __errormsg = 'Sorry, there is no BankCard Attr.';
      __next = 'error';
   } else
   {
       __next = '3';
   }","2b","check BankCard","check BankCard",""<endrec>
"CUSTOMER","51","9","10887","2282","Create Bank Account V2.0","__next  = '4b';
__exemode = 'continue';
__committerParams.BankId =__params.BankId;","4a","query Org BankList","query Org BankList",""<endrec>
"CUSTOMER","","10","10888","2282","Create Bank Account V2.0","__tempData.bankList= __input.lastCommitResult.result;
   if (empty(__tempData.bankList) || size(__tempData.bankList) == 0) {
      __errormsg = 'Sorry, can not find bank.';
      __next = 'error';
    } else {
       __next = '5';
    }","4b","check Org BankList","check Org BankList",""<endrec>
"CUSTOMER","24","14","10889","2282","Create Bank Account V2.0","__next  = '8b';
__exemode = 'continue';","8a","getAllCurrencyList","getAllCurrencyList",""<endrec>
"CUSTOMER","","15","10890","2282","Create Bank Account V2.0","__tempData.currencys = __input.lastCommitResult.result;
  if (empty(__tempData.currencys) || size(__tempData.currencys) == 0) {
     __errormsg = 'Sorry, there is no currency.';
     __next = 'error';
   } else {
    __next = '9';
    }","8b","check All CurrencyList","check All CurrencyList",""<endrec>
"CUSTOMER","56","18","10891","2282","Create Bank Account V2.0","__next  = '10b';
__committerParams.InfoDetail=  __tempData.InfoDetail;
__exemode = 'continue';","10a","Build Bank Account Info","Build Bank Account Info",""<endrec>
"CUSTOMER","","19","10892","2282","Create Bank Account V2.0","__params.FIAccountInfo= __input.lastCommitResult.result;
   if (empty(__params.FIAccountInfo) || size(__params.FIAccountInfo) == 0)
{
      __errormsg = 'Sorry,Build account info failed.';
      __next = 'error';
}
else
{
       __next = '11';
}","10b","check Build result","check Build result",""<endrec>
"CUSTOMER","49","2","10893","2283","Create Bank Card Lookup V2.0","__next  = '1b';
__committerParams.DataDictKey ='BANK_CATEGORY';
__exemode = 'continue';","1a","query Data DictType By Key","query Data DictType By Key",""<endrec>
"CUSTOMER","","3","10894","2283","Create Bank Card Lookup V2.0","__tempData.items   = __input.lastCommitResult.result;
   if (empty(__tempData.items ) )
   {
      __errormsg = 'Sorry, faild to get DataDictType.';
      __next = 'error';
   } else
   {
       __next = '2a';
       __exemode = 'continue';
   }","1b","check Data DictType By Key","check Data DictType By Key",""<endrec>
"CUSTOMER","50","4","10895","2283","Create Bank Card Lookup V2.0","__next  = '2b';
__committerParams.IdentityType ='1000';
__exemode = 'continue';","2a","query BankCard Attr","query BankCard Attr",""<endrec>
"CUSTOMER","","5","10896","2283","Create Bank Card Lookup V2.0","__tempData.attrList = __input.lastCommitResult.result;
   if (empty(__tempData.attrList ) || size(__tempData.attrList) == 0)
   {
      __errormsg = 'Sorry, there is no dataDictType.';
      __next = 'error';
   } else
   {
       __tempData.InfoDetail= Util.createMap();
       __next = '3';
   }","2b","check BankCard","check BankCard",""<endrec>
"CUSTOMER","51","7","10897","2283","Create Bank Card Lookup V2.0","__next  = '4b';
__exemode = 'continue';
__committerParams.BankId =__params.BankId;","4a","query Org BankList","query Org BankList",""<endrec>
"CUSTOMER","","8","10898","2283","Create Bank Card Lookup V2.0","__tempData.bankList= __input.lastCommitResult.result;
   if (empty(__tempData.bankList) || size(__tempData.bankList) == 0) {
      __errormsg = 'Sorry, can not find bank.';
      __next = 'error';
    } else {
       __next = '5';
    }","4b","check Org BankList","check Org BankList",""<endrec>
"CUSTOMER","56","13","10899","2283","Create Bank Card Lookup V2.0","__next  = '8b';
__committerParams.InfoDetail=  __tempData.InfoDetail;
__exemode = 'continue';","8a","Build Bank Account Info","Build Bank Account Info",""<endrec>
"CUSTOMER","","14","10900","2283","Create Bank Card Lookup V2.0","__params.FIAccountInfo= __input.lastCommitResult.result;
   if (empty(__params.FIAccountInfo) || size(__params.FIAccountInfo) == 0)
{
      __errormsg = 'Sorry,Build bank account info failed.';
      __next = 'error';
}
else
{
       __next = '9';
}","8b","check Build result","check Build result",""<endrec>
"CUSTOMER","41","3","10901","2284","Create Customer Bundle V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__committerParams.AccessDeviceIdentifierType = __params.AccessDeviceIdentifierType;
__committerParams.AccessDeviceIdentifier = __params.AccessDeviceIdentifier;
__committerParams.BundleType = __params.BundleType;
__next  = '2b';
__exemode = 'continue';","2a","query Bundle for Interoperability","query Bundle for Interoperability",""<endrec>
"CUSTOMER","","4","10902","2284","Create Customer Bundle V2.0","__tempData.BundleList = __input.lastCommitResult.result;
   if (empty(__tempData.BundleList) || size(__tempData.BundleList) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '3';
    }","2b","check Bundle for Interoperability","check Bundle for Interoperability",""<endrec>
"CUSTOMER","42","10","10903","2284","Create Customer Bundle V2.0","__next  = '8b';
__committerParams.params =__params;
__exemode = 'continue';","8a","convertBundleInfo","convertBundleInfo",""<endrec>
"CUSTOMER","","11","10904","2284","Create Customer Bundle V2.0","__params.BundleInfo = __input.lastCommitResult.result;
   if (empty(__params.BundleInfo ) || size(__params.BundleInfo ) == 0) {
      __errormsg = 'Sorry, convertBundleInfo failed.';
      __next = 'error';
    } else {
       __next = '9';
    }","8b","check convert BundleInfo","check convert BundleInfo",""<endrec>
"CUSTOMER","","1","10905","2285","Create Customer IMT Transfer Abroad Reminder Schedule V2.0","__params.ServiceCode = __serviceCode;
__params.ServiceForInitiateTransaction = __linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01';  /* MSISDN */
__params.ExtraParameter.TransactionCategory = 'IMT';
__params.ExtraParameter.TransactionSubCategory = 'IMT_HomeSend_Remittance_Request';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","10906","2285","Create Customer IMT Transfer Abroad Reminder Schedule V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input)  and  isSuccess) {
    __params.Amount =Util.replaceAll(input,',','.');
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","10907","2285","Create Customer IMT Transfer Abroad Reminder Schedule V2.0","var input = __input.response;
if (empty(input)) { 
__next = '2';
} else {
__params.ExtraParameter.Recipient@@SPACE@@MSISDN = input;
__params.ReceiverPartyIdentifier = input;
__next = '3';
}","2","Enter Recipient MSISDN","<html>
<body>
Enter Recipient MSISDN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10908","2285","Create Customer IMT Transfer Abroad Reminder Schedule V2.0","var input = __input.response;
__params.ExtraParameter.Recipient@@SPACE@@First@@SPACE@@Name = input;
__next = '4';","3","Enter Recipient First Name","<html>
<body>
Enter Recipient First Name<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10909","2285","Create Customer IMT Transfer Abroad Reminder Schedule V2.0","var input = __input.response;
__params.ExtraParameter.Recipient@@SPACE@@Last@@SPACE@@Name = input;
__next = '5';","4","Enter Recipient Last Name","<html>
<body>
Enter Recipient Last Name<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10910","2285","Create Customer IMT Transfer Abroad Reminder Schedule V2.0","var input = __input.response;
__params.FreeText = input;
__next = '6';","5","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10911","2285","Create Customer IMT Transfer Abroad Reminder Schedule V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","10912","2285","Create Customer IMT Transfer Abroad Reminder Schedule V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '7';
} else {
 __params.FirstPaymentReminderDate=Util.convertDateFormat(input,'ddMMyyyy',null);
 __next='8';
}","7","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","9","10913","2285","Create Customer IMT Transfer Abroad Reminder Schedule V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '8';
} else {
__params.IssuePaymentReminderUntil =Util.convertDateFormat(input,'ddMMyyyy',null);
__next='9';
}","8","Enter Issue Reminder Date Unitll","<html>
<body>
Enter Issue Reminder Date Unitll(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","10","10914","2285","Create Customer IMT Transfer Abroad Reminder Schedule V2.0","var input=__input.response;
if(!empty(input)  and  (input >= 0) and (input <= 9))
{
 __params.Frequency = __input.response;
 __next = '10';
}
else
{
__next = '9';
}","9","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","10915","2285","Create Customer IMT Transfer Abroad Reminder Schedule V2.0","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '11';
} else {
  __next = '10';
}","10","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","10916","2285","Create Customer IMT Transfer Abroad Reminder Schedule V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","11","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br> Amount: ${__params.Amount}<br> Recipient MSISDN: ${__params.ExtraParameter.Recipient@@SPACE@@MSISDN}<br> Recipient First Name: ${__params.ExtraParameter.Recipient@@SPACE@@First@@SPACE@@Name}<br> Recipient Last Name: ${__params.ExtraParameter.Recipient@@SPACE@@Last@@SPACE@@Name}<br> Free Text: ${__params.FreeText}<br> Reminder Name: ${__params.ReminderScheduleName}<br> First Date: ${__params.FirstPaymentReminderDate}<br> End Date: ${__params.IssuePaymentReminderUntil}<br> Frequency: ${__params.Frequency}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10917","2286","Create Customer M-Kesho Withdraw Reminder Schedule V2.0","__params.ServiceCode = __serviceCode;
__params.ServiceForInitiateTransaction = __linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* ShortCode */
__params.ReceiverPartyIdentifier  = '1001';
__params.ExtraParameter.TransactionCategory = 'FSI';
__params.ExtraParameter.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","10918","2286","Create Customer M-Kesho Withdraw Reminder Schedule V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input)  and  isSuccess) {
     __params.Amount =Util.replaceAll(input,',','.');
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","10919","2286","Create Customer M-Kesho Withdraw Reminder Schedule V2.0","var input = __input.response;
__params.FreeText = input;
__next = '3';","2","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10920","2286","Create Customer M-Kesho Withdraw Reminder Schedule V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10921","2286","Create Customer M-Kesho Withdraw Reminder Schedule V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '4';
} else {
__params.FirstPaymentReminderDate=Util.convertDateFormat(input,'ddMMyyyy',null);
 __next='5';
}","4","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","6","10922","2286","Create Customer M-Kesho Withdraw Reminder Schedule V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '5';
} else {
    __params.IssuePaymentReminderUntil =Util.convertDateFormat(input,'ddMMyyyy',null);
    __next='6';
}","5","Enter Issue Reminder Date Unitll","<html>
<body>
Enter Issue Reminder Date Unitll(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","7","10923","2286","Create Customer M-Kesho Withdraw Reminder Schedule V2.0","var input=__input.response;
if(!empty(input)  and  (input >= 0) and (input <= 9))
{
 __params.Frequency = __input.response;
 __next = '7';
}
else
{
__next = '6';
}","6","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","10924","2286","Create Customer M-Kesho Withdraw Reminder Schedule V2.0","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","10925","2286","Create Customer M-Kesho Withdraw Reminder Schedule V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br> Amount: ${__params.Amount}<br> Free Text: ${__params.FreeText}<br> Reminder Name: ${__params.ReminderScheduleName}<br> First Date: ${__params.FirstPaymentReminderDate}<br> End Date: ${__params.IssuePaymentReminderUntil}<br> Frequency: ${__params.Frequency}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10926","2287","Create Customer M-Shwari Withdraw Reminder Schedule V2.0","__params.ServiceCode = __serviceCode;
__params.ServiceForInitiateTransaction = __linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* ShortCode */
__params.ReceiverPartyIdentifier  = '2001';
__params.ExtraParameter.TransactionCategory = 'FSI';
__params.ExtraParameter.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","10927","2287","Create Customer M-Shwari Withdraw Reminder Schedule V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input)  and  isSuccess) {
    __params.Amount =Util.replaceAll(input,',','.');
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","10928","2287","Create Customer M-Shwari Withdraw Reminder Schedule V2.0","var input = __input.response;
__params.FreeText = input;
__next = '3';","2","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10929","2287","Create Customer M-Shwari Withdraw Reminder Schedule V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10930","2287","Create Customer M-Shwari Withdraw Reminder Schedule V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '4';
} else {
  __params.FirstPaymentReminderDate=Util.convertDateFormat(input,'ddMMyyyy',null);
  __next='5';
}","4","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","6","10931","2287","Create Customer M-Shwari Withdraw Reminder Schedule V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '5';
} else {
   __params.IssuePaymentReminderUntil =Util.convertDateFormat(input,'ddMMyyyy',null);
   __next='6';
}","5","Enter Issue Reminder Date Unitll","<html>
<body>
Enter Issue Reminder Date Unitll(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","7","10932","2287","Create Customer M-Shwari Withdraw Reminder Schedule V2.0","var input=__input.response;
if(!empty(input)  and  (input >= 0) and (input <= 9))
{
 __params.Frequency = __input.response;
 __next = '7';
}
else
{
__next = '6';
}","6","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","10933","2287","Create Customer M-Shwari Withdraw Reminder Schedule V2.0","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","10934","2287","Create Customer M-Shwari Withdraw Reminder Schedule V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br> Amount: ${__params.Amount}<br> Free Text: ${__params.FreeText}<br> Reminder Name: ${__params.ReminderScheduleName}<br> First Date: ${__params.FirstPaymentReminderDate}<br> End Date: ${__params.IssuePaymentReminderUntil}<br> Frequency: ${__params.Frequency}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10935","2288","Create Customer Reminder Schedule With MSISDN V2.0","__params.ServiceCode = __serviceCode;
__params.ServiceForInitiateTransaction = __linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier =__msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01';  /* MSISDN */

__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","10936","2288","Create Customer Reminder Schedule With MSISDN V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input)||!isSuccess) {
    __next = '1';
} else {
    __params.Amount =Util.replaceAll(input,',','.');
    __next = '2';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","10937","2288","Create Customer Reminder Schedule With MSISDN V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Phone Number","<html>
<body>
Enter Phone Number:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10938","2288","Create Customer Reminder Schedule With MSISDN V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if(isSuccess)
{
 __params.FreeText = input;
 __next = '4';
}
else
{
__next = '3';
}","3","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","5","10939","2288","Create Customer Reminder Schedule With MSISDN V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10940","2288","Create Customer Reminder Schedule With MSISDN V2.0","var input = __input.response;
var isSuccess=__input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '5a';
} else {
   __params.FirstPaymentReminderDate=Util.convertDateFormat(input,'ddMMyyyy',null);
    __next='6';
}","5","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","7","10941","2288","Create Customer Reminder Schedule With MSISDN V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '6';
} else {
 __params.IssuePaymentReminderUntil=Util.convertDateFormat(input,'ddMMyyyy',null);
 __next='7'; 
}","6","Enter Issue Reminder Date Until","<html>
<body>
Enter Issue Reminder Date Until(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","8","10942","2288","Create Customer Reminder Schedule With MSISDN V2.0","var input=__input.response;
if(!empty(input)  and  (input >= 0) and (input <= 9))
{
    amap = { ""1"" : ""One Off"", ""2"" : ""Daily"", ""3"" : ""Weekly"", ""4"": ""4-Weekly"" ,""5"" : ""Monthly"", ""6"" : ""Bi Monthly"", ""7"" : ""Quarterly"", ""8"": ""Half Yearly"", ""9"": ""Yearly""};
    __params.Frequency = __input.response;
    __tempData.FrequencyName = amap.get(input);
    __next = '8';
}
else
{
    __next = '7';
}","7","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","10943","2288","Create Customer Reminder Schedule With MSISDN V2.0","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '9';
} else {
  __next = '8';
}","8","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","10944","2288","Create Customer Reminder Schedule With MSISDN V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","9","Confirm","<html>
<body>
Service: ${__params.ServiceForInitiateTransaction}<br>Amount: ${__params.Amount}<br>Phone Number: ${__params.ReceiverPartyIdentifier}<br>Free Text: ${__params.FreeText}<br>Reminder Name: ${__params.ReminderScheduleName}<br>First Date: ${__params.FirstPaymentReminderDate}<br>End Date: ${__params.IssuePaymentReminderUntil}<br>Frequency: ${__tempData.FrequencyName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10945","2289","Create Customer Reminder Schedule With Short Code V2.0","__params.ServiceCode = __serviceCode;
__params.ServiceForInitiateTransaction = __linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","10946","2289","Create Customer Reminder Schedule With Short Code V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input)||!isSuccess) {
    __next = '1';
} else {
    __params.Amount =Util.replaceAll(input,',','.');
    __next = '2';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","10947","2289","Create Customer Reminder Schedule With Short Code V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10948","2289","Create Customer Reminder Schedule With Short Code V2.0","var input = __input.response;
__params.ExtraParameter.BillReferenceNumber = input;
__next = '4';","3","Enter Bill No","<html>
<body>
Enter Bill No:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10949","2289","Create Customer Reminder Schedule With Short Code V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if(isSuccess)
{
 __params.FreeText = input;
 __next = '5';
}
else
{
__next = '4';
}","4","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","10950","2289","Create Customer Reminder Schedule With Short Code V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10951","2289","Create Customer Reminder Schedule With Short Code V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '6';
} else {
      __params.FirstPaymentReminderDate =Util.convertDateFormat(input,'ddMMyyyy',null);
   __next='7';
}","6","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","8","10952","2289","Create Customer Reminder Schedule With Short Code V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '7';
} else {
      __params.IssuePaymentReminderUntil =Util.convertDateFormat(input,'ddMMyyyy',null);
    __next='8';  
}","7","Enter Issue Reminder Date Until","<html>
<body>
Enter Issue Reminder Date Until(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","9","10953","2289","Create Customer Reminder Schedule With Short Code V2.0","var input=__input.response;
if(!empty(input)  and  (input >= 0) and (input <= 9))
{
    __params.Frequency = __input.response;
    amap = { ""1"" : ""One Off"", ""2"" : ""Daily"", ""3"" : ""Weekly"", ""4"": ""4-Weekly"" ,""5"" : ""Monthly"", ""6"" : ""Bi Monthly"", ""7"" : ""Quarterly"", ""8"": ""Half Yearly"", ""9"": ""Yearly""};
    __tempData.FrequencyName = amap.get(input);
    __next = '9';
}
else
{
   __next = '8';
}","8","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","10954","2289","Create Customer Reminder Schedule With Short Code V2.0","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '10';
} else {
  __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","10955","2289","Create Customer Reminder Schedule With Short Code V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","10","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br>Amount: ${__params.Amount}<br>Short Code: ${__params.ReceiverPartyIdentifier}<br>Bill No: ${__params.ExtraParameter.BillReferenceNumber}<br>Free Text: ${__params.FreeText}<br>Reminder Name: ${__params.ReminderScheduleName}<br>First Date: ${__params.FirstPaymentReminderDate}<br>End Date: ${__params.IssuePaymentReminderUntil}<br>Frequency: ${__tempData.FrequencyName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10956","2290","Create Customer Reminder Schedule With Short Code And MSISDN V2.0","__params.ServiceCode = __serviceCode;
__params.ServiceForInitiateTransaction = __linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel =__sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */

__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","10957","2290","Create Customer Reminder Schedule With Short Code And MSISDN V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input)||!isSuccess) {
    __next = '1';
} else {
    __params.Amount =Util.replaceAll(input,',','.');
    __next = '2';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","17"<endrec>
"CUSTOMER","","3","10958","2290","Create Customer Reminder Schedule With Short Code And MSISDN V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10959","2290","Create Customer Reminder Schedule With Short Code And MSISDN V2.0","var input = __input.response;
__params.ExtraParameter.RechargedMSISDN = input;
__next = '4';","3","Enter MSISDN Number","<html>
<body>
Enter MSISDN Number:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10960","2290","Create Customer Reminder Schedule With Short Code And MSISDN V2.0","var input = __input.response;
var isSuccess= __input.validateResult.isSucess;
if(isSuccess)
{
 __params.FreeText = input;
 __next = '5';
}
else
{
__next = '4';
}","4","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","10961","2290","Create Customer Reminder Schedule With Short Code And MSISDN V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10962","2290","Create Customer Reminder Schedule With Short Code And MSISDN V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '6';
} else {
   __params.FirstPaymentReminderDate =Util.convertDateFormat(input,'ddMMyyyy',null);
   __next='7';
}","6","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","8","10963","2290","Create Customer Reminder Schedule With Short Code And MSISDN V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '7';
} else {
   __params.IssuePaymentReminderUntil =Util.convertDateFormat(input,'ddMMyyyy',null);
   __next='8';
}","7","Enter Issue Reminder Date Until","<html>
<body>
Enter Issue Reminder Date Until(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","9","10964","2290","Create Customer Reminder Schedule With Short Code And MSISDN V2.0","var input=__input.response;
if(!empty(input)  and  (input >= 0) and (input <= 9))
{
   __params.Frequency = __input.response;
   amap = { ""1"" : ""One Off"", ""2"" : ""Daily"", ""3"" : ""Weekly"", ""4"": ""4-Weekly"" ,""5"" : ""Monthly"", ""6"" : ""Bi Monthly"", ""7"" : ""Quarterly"", ""8"": ""Half Yearly"", ""9"": ""Yearly""};
   __tempData.FrequencyName = amap.get(input);
   __next = '9';
}
else
{
   __next = '8';
}","8","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","10965","2290","Create Customer Reminder Schedule With Short Code And MSISDN V2.0","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '10';
} else {
  __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","10966","2290","Create Customer Reminder Schedule With Short Code And MSISDN V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","10","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br>Amount: ${__params.Amount}<br>Short Code: ${__params.ReceiverPartyIdentifier}<br>MSISDN Number: ${__params.ExtraParameter.RechargedMSISDN}<br>Free Text: ${__params.FreeText}<br>Reminder Name: ${__params.ReminderScheduleName}<br>First Date: ${__params.FirstPaymentReminderDate}<br>End Date: ${__params.IssuePaymentReminderUntil}<br>Frequency: ${__tempData.FrequencyName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10967","2291","Create Direct Debit Mandate by Customer V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = __msisdn;
__params.InitiatorIdentifierType= '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverPartyIdentifierType = '01';
__params.ReceiverPartyIdentifier = __msisdn;
__params.ActionType = 'CreateDirectDebitMandateByCustomer';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","10968","2291","Create Direct Debit Mandate by Customer V2.0","var input = __input.response;
if (!empty(input)) {
  __params.Identifier= input;
__params.IdentifierType = '04'; 
  __next = '2';
} else {
  __next = '1';
}","1","Enter Payee ID","<html>
<body>
Enter  Payee  ID <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10969","2291","Create Direct Debit Mandate by Customer V2.0","var input = __input.response;
var length = size(input);
if (empty(input) || length > 64) {
  __next = '2';
} else {
  __params.PayerReferenceNumber = input;
  __next = '3';
}","2","Enter Payer Unique Reference number","<html>
<body>
Enter Payer Unique Reference number <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10970","2291","Create Direct Debit Mandate by Customer V2.0","__params.AgreedTC = '1';
__next = '4';","3","Agreed TC","<html>
<body>
Please Confirm you have Agreed Terms and Conditions <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10971","2291","Create Direct Debit Mandate by Customer V2.0","var input = __input.response;
var length = size(input);
if(empty(input))
{
__next = '5';
}else if (length < 64) {
  __params.PayerAccountName= input;
__next = '5';
} else {
  __next = '4';
}","4","Enter Payer Account Instance","<html>
<body>
Enter Payer Account Instance <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10972","2291","Create Direct Debit Mandate by Customer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if(empty(input))
{
__next = '6';
}else if (isSuccess) {
__params.Frequency = input;
__next = '6';
} else {
__next = '5';
}","5","Enter Frequency","<html>
<body>
Enter Frequency <br>
01 One Off  <br>
02 Daily  <br>
03 Weekly  <br>
04 Monthly  <br>
05 Quarterly  <br>
06 Half Yearly  <br>
07 Yearly <br>
08 On Demand
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html","14"<endrec>
"CUSTOMER","","7","10973","2291","Create Direct Debit Mandate by Customer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input)  and  !isSuccess|| (__params.Frequency== '08')  and  !isSuccess){
   __next = '6';
} else {
  __params.FirstPaymentDate = Util.convertDateFormat(input,'ddMMyyyy',null);
  if(__params.Frequency == '08')
  {
    __next = '9';
  }else {
    __next = '7';
  }
}","6","Enter First Payment Date","<html>
<body>
Enter First Payment Date(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","8","10974","2291","Create Direct Debit Mandate by Customer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if(empty(input) )
{
  __next = '8';
}
else if(isSuccess)
{
   __next = '8';
   __params.StartRangeOfDays = input;

}else
{
    __next = '7';
}","7","Enter Start of Range of days","<html>
<body>
Enter Start of Range of days <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html","14"<endrec>
"CUSTOMER","","9","10975","2291","Create Direct Debit Mandate by Customer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if(empty(input) )
{
  __next = '9';
}
else if(isSuccess)
{
   __next = '9';
__params.EndRangeOfDays = input;

}else
{
    __next = '8';
}","8","Enter End of Range of days","<html>
<body>
Enter End of Range of days <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","11","10976","2291","Create Direct Debit Mandate by Customer V2.0","var input = __input.response;
if (!empty(input) ) {
    __params.@HEAD@PIN = input;
    __next = '11a';
    __exemode='continue';
} else {
    __next = '10';
}","10","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","10977","2291","Create Direct Debit Mandate by Customer V2.0","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel';
} else {
   __next = '11';
}","11","Confirm","<html>
<body>
Confirm to Create Direct Debit Mandate?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","10978","2291","Create Direct Debit Mandate by Customer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input)  and  !isSuccess){
   __next = '9';
} else {
    __params.ExpiryDate =Util.convertDateFormat(input,'ddMMyyyy',null);
    __next = '10';
}","9","Enter Expiry Date","<html>
<body>
Enter Expiry Date(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","1","10979","2292","Create Direct Debit Mandate by Group V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.RequesterIdentifierType = ""01"";
__params.RequesterIdentifier = __msisdn;
__params.ActionType = 'CreateDirectDebitMandateByGroup';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/

__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","10980","2292","Create Direct Debit Mandate by Group V2.0","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
  for (group: __tempData.groups) {
    if (group.groupCode == input) {
      found = '0';
    }
  }
  if (found == '1') {
    __errormsg = 'no current group or not belong to the group.';
    __next = 'error';
  } else {
    __next = '2';
  }
} else {
  __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10981","2292","Create Direct Debit Mandate by Group V2.0","var input = __input.response;
if (!empty(input)) {
  __params.Identifier= input;
__params.IdentifierType = '04'; 
  __next = '3';
} else {
  __next = '2';
}","2","Enter Payee ID","<html>
<body>
Enter  Payee  ID <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10982","2292","Create Direct Debit Mandate by Group V2.0","var input = __input.response;
var length = size(input);
if (empty(input) || length > 64) {
  __next = '3';
} else {
  __params.PayerReferenceNumber = input;
  __next = '4';
}","3","Enter Payer Unique Reference number","<html>
<body>
Enter Payer Unique Reference number <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","10983","2292","Create Direct Debit Mandate by Group V2.0","__params.AgreedTC = '1';
__next = '5';","4","Agreed TC","<html>
<body>
Please Confirm you have Agreed Terms and Conditions <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","10984","2292","Create Direct Debit Mandate by Group V2.0","var input = __input.response;
var length = size(input);
if(empty(input))
{
__next = '6';
}else if (length < 64) {
  __params.PayerAccountName= input;
__next = '6';
} else {
  __next = '5';
}","5","Enter Payer Account Instance","<html>
<body>
Enter Payer Account Instance <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","10985","2292","Create Direct Debit Mandate by Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if(empty(input))
{
__next = '7';
}else if (isSuccess) {
__params.Frequency = input;
__next = '7';
} else {
__next = '6';
}","6","Enter Frequency","<html>
<body>
Enter Frequency <br>
01 One Off  <br>
02 Daily  <br>
03 Weekly  <br>
04 Monthly  <br>
05 Quarterly  <br>
06 Half Yearly  <br>
07 Yearly <br>
08 On Demand
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html","14"<endrec>
"CUSTOMER","","10","10986","2292","Create Direct Debit Mandate by Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input)  and  !isSuccess|| (__params.Frequency == '08')  and  !isSuccess){
  __next = '7';
} else {
     __params.FirstPaymentDate = Util.convertDateFormat(input,'ddMMyyyy',null);
  if(__params.Frequency == '08')
  {
    __next = '10';
  }else {
    __next = '8';
  }
}","7","Enter First Payment Date","<html>
<body>
Enter First Payment Date(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","11","10987","2292","Create Direct Debit Mandate by Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if(empty(input) )
{
  __next = '9';
}
else if(isSuccess)
{
   __next = '9';
   __params.StartRangeOfDays= input;
}else
{
    __next = '8';
}","8","Enter Start of Range of days","<html>
<body>
Enter Start of Range of days <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","12","10988","2292","Create Direct Debit Mandate by Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if(empty(input) )
{
  __next = '10';
}
else if(isSuccess)
{
   __next = '10';
__params.EndRangeOfDays= input;

}else
{
    __next = '9';
}","9","Enter End of Range of days","<html>
<body>
Enter End of Range of days <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","14","10989","2292","Create Direct Debit Mandate by Group V2.0","var input = __input.response;
if (!empty(input) ) {
 __params.@HEAD@PIN = input;
    __next = '11a';
    __exemode='continue';
} else {
    __next = '11';
}","11","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","19","10990","2292","Create Direct Debit Mandate by Group V2.0","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel';
} else {
   __next = '12';
}","12","Confirm","<html>
<body>
Confirm to Create Direct Debit Mandate?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","10991","2292","Create Direct Debit Mandate by Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess){
   __next = '10';
} else {
    __params.ExpiryDate =Util.convertDateFormat(input,'ddMMyyyy',null);
    __next = '11';
}","10","Enter Expiry Date","<html>
<body>
Enter Expiry Date(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","1","10992","2293","Create Group V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'CreateGroup';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.RequesterIdentifier = __msisdn;
__params.GroupType = '10000169';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","10993","2293","Create Group V2.0","var input = __input.response;
var length = size(input);
if(length > 64)
{
__next = '1';
}
else
{
__params.GroupCode = input;
__next = '2';
}","1","Enter Group Code","<html>
<body>
Enter Group Code<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","10994","2293","Create Group V2.0","var input = __input.response;
if (!empty(input)) {
  __params.GroupName = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Group Name","<html>
<body>
Enter Group Name<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","10995","2293","Create Group V2.0","var input = __input.response;
__params.GroupDescription = input;
__next = '4';","3","Enter Group Description","<html>
<body>
Enter Group Description<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","10996","2293","Create Group V2.0","var input = __input.response;
__params.GroupSponsor = input;
__next = '5';","4","Enter Group Sponsor","<html>
<body>
Enter Group Sponsor<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","10997","2293","Create Group V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html><body>New Group ${__params.RequesterIdentifier}, ${__params.GroupName},${__params.GroupDescription}, ${__params.GroupSponsor}, ${__params.GroupCode}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","10998","2293","Create Group V2.0","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '6';
__exemode = 'continue';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","10999","2294","Create Group Bank Account V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'CreateIdentityBankAccount';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.RequesterIdentifierType = ""01"";
__params.RequesterIdentifier = __msisdn;
__tempData.attrIndex = 0;
__exemode = 'continue';
__next = '1a';","begin","set parammeters","",""<endrec>
"CUSTOMER","","8","11000","2294","Create Group Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = '5';
} else if (input == '2') {
  __next = '7'
} else {
  __next = '1a';
}","4","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11001","2294","Create Group Bank Account V2.0","var input = __input.response;
var found = '0';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: __tempData.groups){
if(group.groupCode == input)
{
  found = '1';
}
}
if ( found == '0') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
__exemode = 'continue';
   __next = '6a';
}
}
 else {
      __next = '5';
}","5","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","11002","2294","Create Group Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
__exemode = 'continue';
  __next = '6a';
}
else{
  __next = '7';
}","7","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","15","11003","2294","Create Group Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
	__params.BankId = '-1';
	__params.BankName = 'Others';
	if (i < size(__tempData.items)) {
		item = __tempData.items.get(i);
		__params.BankId = item.value;
		__params.BankName = item.defaultName;
	}
       __exemode = 'continue';
	__next = '10a';
} else if (i ==size(__tempData.items)){
        __params.BankId = '-1';
	__params.BankName = 'Others';
        __tempData.InfoDetail= Util.createMap();
        __exemode = 'continue';
	__next = '10a';
}else{
	__next = '9';
}","9","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:__tempData.items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","18","11004","2294","Create Group Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    bank = __tempData.bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '12';
} else {
  __next = '11';
}","11","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:__tempData.bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","19","11005","2294","Create Group Bank Account V2.0","var input = __input.response;
if (!empty(input)) {
  __params.AccountName = input;
  __next = '13';
} else {
  __next = '12';
}","12","Enter Account Name","<html>
<body>
Enter Account Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","20","11006","2294","Create Group Bank Account V2.0","var input = __input.response;

if (!empty(input))
{
  __params.AccountNumber = input;

if(__params.BankId != '-1' &&__tempData.IsMultiCurrency =='Y')
{
 __next = '14a';
}
if (size(__tempData.attrList) > 0 && __params.BankId == '-1')
{
    __next = '16';
}
if (size(__tempData.attrList) == 0 || __params.BankId != '-1')
{
  __next = '17';
}
} else {
  __next = '13';
}","13","Enter Account Number","<html>
<body>
Enter Account Number:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","23","11007","2294","Create Group Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    __params.Currency = __tempData.currencys.get(i);
    __next = '17';
} else {
  __next = '15';
}","15","Select Currency","<html>
<body>
Select Currency:<br>
$$ var index = 1;
$$ for (currency:__tempData.currencys){
 ${index} ${currency}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","24","11008","2294","Create Group Bank Account V2.0","var input = __input.response;
if (!empty(input)) {
  __tempData.InfoDetail[__tempData.attrList[__tempData.attrIndex]]= input;
  __tempData.attrIndex = __tempData.attrIndex + 1;
  if(__tempData.attrIndex < size(__tempData.attrList)) {
    __next = '16';
  } else {
    __exemode = 'continue';
    __next = '16a';
  }
} else {
  __next = '16';
}","16","Enter Bank Account Info","<html>
<body>
Enter ${__tempData.attrList[__tempData.attrIndex]}:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","27","11009","2294","Create Group Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = '18';
} else if(input == '0') {
  __next = '1a';
} else {
  __next = '17';
}","17","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${__params.BankName}<br>
Branch:${__params.BranchName}<br>
Account Name:${__params.AccountName}<br>
Account Number:${__params.AccountNumber}<br>
$$ if(__tempData.IsMultiCurrency =='Y') {
Currency:${__params.Currency}<br>
$$ }
$$ if(size(__tempData.attrList) > 0 && __params.BankId == '-1') {
$$ for (detail:__params.FIAccountInfo.InfoDetail){
${detail.Key}:${detail.Value}<br>
$$ }
$$ }
<br>
1 OK<br>
0 Back<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","1101","1011","Customer Change Secret Word","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ChangeSecretWord';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__secure = true;
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","28","11010","2294","Create Group Bank Account V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!isSuccess ||  empty(input ))
{
    __next = '18';
} else {
   __params.@HEAD@PIN = input ;
    __next = '19';
}","18","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","29","11011","2294","Create Group Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '19';
}","19","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11012","2295","Create Group Bank Card Lookup V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'CreateIdentityBankCardLookup';
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01';    /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15';     /* SHORT_CODE */
__params.RequesterIdentifierType  = '01';    /* MSISDN */
__params.RequesterIdentifier = __msisdn;

__next = '1';
__exemode = 'continue';","begin","set parammeters","",""<endrec>
"CUSTOMER","","8","11013","2295","Create Group Bank Card Lookup V2.0","var input = __input.response;
if (input == '1') {
  __next = '5';
} else if (input == '2') {
       __next = '6';
} else {
   __next = '1';
}","4","Please select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11014","2295","Create Group Bank Card Lookup V2.0","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifier = input;
    __next = '7';
}else {
    __next = '5';
}","5","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11015","2295","Create Group Bank Card Lookup V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '7';
}
else{
  __next = '6';
}","6","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","11016","2295","Create Group Bank Card Lookup V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
	__params.BankId = '-1';
	__params.BankName = 'Others';
	if (i < size(__tempData.items)) {
		item = __tempData.items.get(i);
		__params.BankId = item.value;
		__params.BankName = item.defaultName;
	}
       __exemode = 'continue';
	__next = '8';
} else if (i ==size(__tempData.items)){
        __params.BankId = '-1';
	__params.BankName = 'Others';
        __exemode = 'continue';
	__next = '8';
}else{
	__next = '7';
}","7","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:__tempData.items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","14","11017","2295","Create Group Bank Card Lookup V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    bank = __tempData.bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '10';
} else {
  __next = '9';
}","9","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:__tempData.bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","15","11018","2295","Create Group Bank Card Lookup V2.0","var input = __input.response;
if (!empty(input)) {
  __params.AccountName = input;
  __next = '11';
} else {
  __next = '10';
}","10","Enter Lookup Name","<html>
<body>
Enter Lookup Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","11019","2295","Create Group Bank Card Lookup V2.0","var input = __input.response;
if (!empty(input)) {
  __params.AccountNumber = input;
  if(size(__tempData.attrList) > 0) {
    __tempData.attrIndex = 0;
    __next = '12';
  } else {
    __next = '13';
  }
} else {
  __next = '11';
}","11","Enter Lookup Card No","<html>
<body>
Enter Lookup Card No.:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","1102","1011","Customer Change Secret Word","var input = __input.response;
__params.NewSecretWord = input;
__secure = true;
__next = '2';
","1","Enter new secret word","<html>
<body>
Enter new secret word<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","17","11020","2295","Create Group Bank Card Lookup V2.0","var input = __input.response;
if (!empty(input)) {
__tempData.InfoDetail[__tempData.attrList[__tempData.attrIndex]]= input;

__tempData.attrIndex = __tempData.attrIndex + 1;
  if(  __tempData.attrIndex < size(__tempData.attrList)) {
    __next = '12';
  } else {
    __next = '12a';
    __exemode = 'continue';
  }
} else {
  __next = '12';
}","12","Enter FI Account Info","<html>
<body>
Enter ${__tempData.attrList[__tempData.attrIndex]}:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","20","11021","2295","Create Group Bank Card Lookup V2.0","var input = __input.response;
if (input == '1') {
  __next = '14';
} else if(input == '0') {
  __next = '7';
} else {
  __next = '13';
}","13","Confirm Bank Card Lookup","<html>
<body>
Confirm Bank Card Lookup<br><br>
Bank:${__params.BankName}<br>
Bank Branch:${__params.BranchName}<br>
Lookup Name:${__params.AccountName}<br>
Lookup Card No.:${__params.AccountNumber}<br>
<br>
$$ for (obj:__params.FIAccountInfo.InfoDetail){
${obj.Key}:${obj.Value}<br>
$$ }
<br>
1 OK<br>
0 Back<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","21","11022","2295","Create Group Bank Card Lookup V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!isSuccess ||  empty(input ))
{
    __next = '14';
} else {
   __params.@HEAD@PIN = input ;
    __next = '15';
}","14","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","22","11023","2295","Create Group Bank Card Lookup V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '15';
}","15","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11024","2296","Create Group Bundle V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'CreateGroupBundle';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.RequesterIdentifierType = ""01"";
__params.RequesterIdentifier = __msisdn;
__params.AssignType = '1';

__next = '1';
__exemode = 'continue';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","11025","2296","Create Group Bundle V2.0","var input = __input.response;

if (input == '1') {
    __next = '2a';
} else if (input == '2') {
    if (empty(__tempData.groups) || size(__tempData.groups) == 0) {
        __errormsg = 'Sorry, there is no groups.';
        __next = 'error';
    } else {
        __next = '2b';
    }
} else {
	__next = '0';
}","2","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11026","2296","Create Group Bundle V2.0","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
    for(group : __tempData.groups) {
        if(group.groupCode == input)
        {
              found = '0';
        }
    }
    if ( found == '1') {
       __errormsg = 'no current group or not belong to the group.';
       __next = 'error';
    } else {
       __next = '3';
    }
} else {
      __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11027","2296","Create Group Bundle V2.0","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(__tempData.groups)) {
    group = __tempData.groups.get(i);
    __params.ReceiverPartyIdentifier = group.groupCode;
    __next = '2c';
    __exemode = 'continue';
} else {
    __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group : __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","41","10","11028","2296","Create Group Bundle V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__committerParams.AccessDeviceIdentifierType = __params.AccessDeviceIdentifierType;
__committerParams.AccessDeviceIdentifier = __params.AccessDeviceIdentifier;
__committerParams.BundleType = __params.BundleType;
__next = '4b';","4a","Query Bundle For Interoperability","Query Bundle For Interoperability",""<endrec>
"CUSTOMER","","9","11029","2296","Create Group Bundle V2.0","var input = __input.response;
var isSucess =  __input.validateResult.isSucess;
if (isSucess)
{
    __params.BundleType= input ;
    __secure = true;
    __next = '4';
    __exemode = 'continue';
} else {
    __next = '3';
}","3","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","3","1103","1011","Customer Change Secret Word","var input = __input.response;
if(__params.NewSecretWord == input)
{
__secure = true;
__next = '3';
}
else
{
__next = '1';  
}","2","Confirm secret word","<html>
<body>
Confirm secret word<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","11030","2296","Create Group Bundle V2.0","var input = __input.response;
var isSucess = __input.validateResult.isSucess;
if (isSucess) {
    if(input =='1') {
            __next = '6';
    } else if(input =='2') {
            __params.EffectiveMode= '-1';
            __next = '7';
    } else {
          __next = '5';
    }
} else {
    __next = '4';
}","5","Select Effective Mode","<html>
<body>Select Effective Mode:<br>
1 Input days from today<br>
2 Next day of the same bundle expired<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","14","11031","2296","Create Group Bundle V2.0","var input = __input.response;
var isSucess =  __input.validateResult.isSucess;
if (isSucess) {
     __params.EffectiveMode= input;
     __next = '7';
} else {
    __next = '6';
}","6","Input Days From Today","<html>
<body>Input days from today:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","15","11032","2296","Create Group Bundle V2.0","var input = __input.response;
if (input == '1') {
  __next = '8';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm bundle information","<html>
<body>
Please Confirm Bundle Information :<br>
     Bundle Name : ${__params.BundleName}<br>
     Provider :${__params.BundleProvider==null?'':__params.BundleProvider}<br>
     Price : ${__params.Price} ${__params.Currency==null?'':__params.Currency}<br>
$$if(__params.EffectiveMode=='-1'){
     Next day of the same bundle expired<br>
$$}else if(__params.EffectiveMode=='0'){
     Effective Date : Today<br>
$$}else{
     Effective Date : ${__params.EffectiveMode} days from today<br>
$$}
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","11033","2296","Create Group Bundle V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
 __params.@HEAD@PIN = input;
    __next = '9';
    __exemode = 'continue';
} else {
    __next = '8';
}","8","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","19","11034","2296","Create Group Bundle V2.0","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '10';
}","10","Confirm","<html>
<body>
Confirm to subscribe group bundle?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11035","2297","Create Standing Order Schedule With Short Code V2.0","__params.ServiceCode = __serviceCode;
__params.ServiceForInitiateTransaction = __linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */
__params.NeedConfirmation = '0';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11036","2297","Create Standing Order Schedule With Short Code V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input)) {
    __next = '1';
} else if(isSuccess){
    __params.Amount =input.replaceAll(',','.');
    __next = '2';
}else{
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","17"<endrec>
"CUSTOMER","","3","11037","2297","Create Standing Order Schedule With Short Code V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","11038","2297","Create Standing Order Schedule With Short Code V2.0","var input = __input.response;
__params.ExtraParameter.BillReferenceNumber = input;
__next = '4';","3","Enter Bill No","<html>
<body>
Enter Bill No:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11039","2297","Create Standing Order Schedule With Short Code V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if(isSuccess)
{
 __params.FreeText = input;
 __next = '5';
}
else
{
__next = '4';
}","4","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","4","1104","1011","Customer Change Secret Word","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '4';
","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11040","2297","Create Standing Order Schedule With Short Code V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","11041","2297","Create Standing Order Schedule With Short Code V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '6';
} else {
   __params.FirstPaymentReminderDate=Util.convertDateFormat(input,'ddMMyyyy',null);
   __next='7';
}","6","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","8","11042","2297","Create Standing Order Schedule With Short Code V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '7';
} else {
    __params.IssuePaymentReminderUntil =Util.convertDateFormat(input,'ddMMyyyy',null);
    __next='8';
}","7","Enter Issue Reminder Date Until","<html>
<body>
Enter Issue Reminder Date Until(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","9","11043","2297","Create Standing Order Schedule With Short Code V2.0","var input=__input.response;
if(!empty(input)  and  (input >= 0) and (input <= 9))
{
  __params.Frequency = __input.response;
  amap = { ""1"" : ""One Off"", ""2"" : ""Daily"", ""3"" : ""Weekly"", ""4"": ""4-Weekly"" ,""5"" : ""Monthly"", ""6"" : ""Bi Monthly"", ""7"" : ""Quarterly"", ""8"": ""Half Yearly"", ""9"": ""Yearly""};
  __tempData.FrequencyName = amap.get(input);
  __next = '9';
}
else
{
  __next = '8';
}","8","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11044","2297","Create Standing Order Schedule With Short Code V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess)
{
 __params.SendNotification = input ;
  if(input =='0')
 {
  __next = '11';
 }
 else
 {
   __next = '10';
 }
}
else {
 __next = '9';
}","9","Sending Pre-warning Notification","<html>
<body>
Sending Pre-warning Notification<br>
0 No<br>
1 Yes<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","12","11045","2297","Create Standing Order Schedule With Short Code V2.0","var input = __input.response;
if (!empty(input)) {
__params.Period = input;
  __next = '11';
} else {
  __next = '10';
}","10","Enter Pre-warning Period","<html>
<body>
Enter Pre-warning Period:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","11046","2297","Create Standing Order Schedule With Short Code V2.0","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next ='12'
} else {
  __next = '11';
}","11","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","11047","2297","Create Standing Order Schedule With Short Code V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","12","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br>Amount: ${__params.Amount}<br>Short Code: ${__params.ReceiverPartyIdentifier}<br>Bill No: ${__params.ExtraParameter.BillReferenceNumber}<br>Free Text: ${__params.FreeText}<br>Reminder Name: ${__params.ReminderScheduleName}<br>First Date: ${__params.FirstPaymentReminderDate}<br>End Date: ${__params.IssuePaymentReminderUntil}<br>Frequency: ${__tempData.FrequencyName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11048","2298","Create Standing Order Schedule With Short Code By Group V2.0","__params.ServiceCode = __serviceCode;
__params.ServiceForInitiateTransaction = __linkedServiceCode;
__params.ActionType = 'CreateGroupReminderSchedule';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* Short Code */
__params.NeedConfirmation = '0';
__params.RequesterIdentifierType = '15'; /* Group Code */
__params.NeedConfirmation = '0';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11049","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input)||!isSuccess) {
    __next = '1';
} else {
    __params.Amount =Util.replaceAll(input,',','.');
    __next = '2';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","17"<endrec>
"CUSTOMER","","5","1105","1011","Customer Change Secret Word","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to Change Secret Word?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","11050","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","11051","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input = __input.response;
__params.ExtraParameter.BillReferenceNumber = input;
__next = '4';","3","Enter Bill No","<html>
<body>
Enter Bill No:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11052","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if(isSuccess)
{
 __params.FreeText = input;
 __next = '5';
}
else
{
__next = '4';
}","4","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","11053","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","11054","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input = __input.response;
 var isSuccess = __input.validateResult.isSucess;
if (empty(input)||!isSuccess) {
    __next = '6';
} else {
   __params.FirstPaymentReminderDate=Util.convertDateFormat(input,'ddMMyyyy',null);
   __next='7';
}","6","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","8","11055","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '7';
} else {
   __params.IssuePaymentReminderUntil =Util.convertDateFormat(input,'ddMMyyyy',null);
   __next='8';
}","7","Enter Issue Reminder Date Until","<html>
<body>
Enter Issue Reminder Date Until(DDMMYYYY)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","9","11056","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input=__input.response;
if(!empty(input)  and  (input >= 0) and (input <= 9))
{
   __params.Frequency = __input.response;
   amap = {
  ""1"": ""One Off"",
  ""2"": ""Daily"",
  ""3"": ""Weekly"",
  ""4"": ""4-Weekly"",
  ""5"": ""Monthly"",
  ""6"": ""Bi Monthly"",
  ""7"": ""Quarterly"",
  ""8"": ""Half Yearly"",
  ""9"": ""Yearly""
   };
   __tempData.FrequencyName = amap.get(input);
   __next = '9';
}
else
{
   __next = '8';
}","8","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","11057","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input = __input.response;
if (!empty(input)) {
 __params.SendNotification = input ;
  if(input =='0'){
     __next = '11a';
   __exemode='continue';
  }else{
   __next = '10';
  }
} else {
   __next = '9';
}","9","Sending Pre-warning Notification","<html>
<body>
Sending Pre-warning Notification<br>
0 No<br>
1 Yes<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","12","11058","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input = __input.response;
if (!empty(input)) {
   __params.Period = input;
   __next = '11a';
   __exemode='continue';
} else {
   __next = '10';
}","10","Enter Pre-warning Period","<html>
<body>
Enter Pre-warning Period:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","11059","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input = __input.response;
__params.RequesterIdentifier = input;
if (!empty(input)) {
      var found = '1';
      for (group : __tempData.groups ) {
    if (group.groupCode == input) {
      found = '0';
    }
       }
  if (found == '1') {
    __errormsg = 'no current group or not belong to the group.';
    __next = 'error';
  } else {
    __next = '12';
  }
} else {
      __next = '11c';
}","11c","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","11060","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '13';
} else {
  __next = '12';
}","12","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","17","11061","2298","Create Standing Order Schedule With Short Code By Group V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","13","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br>Amount: ${__params.Amount}<br>Short Code: ${__params.ReceiverPartyIdentifier}<br>Bill No: ${__params.ExtraParameter.BillReferenceNumber}<br>Free Text: ${__params.FreeText}<br>Reminder Name: ${__params.ReminderScheduleName}<br>First Date: ${__params.FirstPaymentReminderDate}<br>End Date: ${__params.IssuePaymentReminderUntil}<br>Frequency: ${__tempData.FrequencyName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","53","12","11062","2291","Create Direct Debit Mandate by Customer V2.0","__committerParams.params=__params;
__next='11b';
__exemode='continue';","11a","Build Payer Info","Build Payer Info",""<endrec>
"CUSTOMER","","13","11063","2291","Create Direct Debit Mandate by Customer V2.0","if (__input.lastCommitResult.isSucess)
{
   __params.Payee = __input.lastCommitResult.result;
   __next='11c';
    __exemode='continue';
}else{
   __errormsg = 'build direct debit payer information failed.';
   __next = 'error';
}","11b","Get Direct Debit Payer Info","Get Direct Debit Payer Info",""<endrec>
"CUSTOMER","52","14","11064","2291","Create Direct Debit Mandate by Customer V2.0","__committerParams.params=__params;
__next='11d';
__exemode='continue';","11c","build Direct Debit Mandate Info","build Direct Debit Mandate Info",""<endrec>
"CUSTOMER","","15","11065","2291","Create Direct Debit Mandate by Customer V2.0","if (__input.lastCommitResult.isSucess)
{
   __params.DirectDebitMandateInfo  = __input.lastCommitResult.result;
   __next='11';
}else{
   __errormsg = 'build direct debit mandate information failed.';
   __next = 'error';
}","11d","Get Direct Debit Mandate Info","Get Direct Debit Mandate Info",""<endrec>
"CUSTOMER","30","2","11066","2292","Create Direct Debit Mandate by Group V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='1b';
__exemode='continue';","1a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","3","11067","2292","Create Direct Debit Mandate by Group V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","1b","Check My Groups","Check My Groups",""<endrec>
"CUSTOMER","53","15","11068","2292","Create Direct Debit Mandate by Group V2.0","__committerParams.params=__params;
__next='11b';
__exemode='continue';","11a","Build Payer","Build Payer",""<endrec>
"CUSTOMER","","16","11069","2292","Create Direct Debit Mandate by Group V2.0","if(__input.lastCommitResult.isSucess){
    __params.Payee = __input.lastCommitResult.result;
    __next = '11c';
    __exemode='continue';
}else{
    __errormsg = 'Sorry, build direct debit payer failed.';
    __next = 'error';
}","11b","Get Payer Info","Get Payer Info",""<endrec>
"CUSTOMER","52","17","11070","2292","Create Direct Debit Mandate by Group V2.0","__committerParams.params=__params;
__next='11d';
__exemode='continue';","11c","Build Mandate Info","Build Mandate Info",""<endrec>
"CUSTOMER","","18","11071","2292","Create Direct Debit Mandate by Group V2.0","if(__input.lastCommitResult.isSucess){
    __params.DirectDebitMandateInfo = __input.lastCommitResult.result;
    __next = '12';
}else{
    __errormsg = 'Sorry, build direct debit mandate information failed.';
    __next = 'error';
}","11d","Get Direct Debit Mandate Info","Get Direct Debit Mandate Info",""<endrec>
"CUSTOMER","48","2","11072","2294","Create Group Bank Account V2.0","__next  = '1b';
__committerParams.SystemParamCode='MULTI_CURRENCY_MODEL';
__exemode = 'continue';","1a","is Multi Currency","is Multi Currency",""<endrec>
"CUSTOMER","","3","11073","2294","Create Group Bank Account V2.0","__tempData.IsMultiCurrency = __input.lastCommitResult.result;
   if (empty( __tempData.IsMultiCurrency) )
   {
      __errormsg = 'Sorry, faild to get IsMultiCurrency.';
      __next = 'error';
   } else
   {
       __next = '2a';
       __exemode = 'continue';
   }","1b","check is Multi Currency","check is Multi Currency",""<endrec>
"CUSTOMER","49","4","11074","2294","Create Group Bank Account V2.0","__next  = '2b';
__committerParams.DataDictKey ='BANK_CATEGORY';
__exemode = 'continue';","2a","query Data DictType By Key","query Data DictType By Key",""<endrec>
"CUSTOMER","","5","11075","2294","Create Group Bank Account V2.0","__tempData.items   = __input.lastCommitResult.result;
   if (empty(__tempData.items ) )
   {
      __errormsg = 'Sorry, faild to get DataDictType.';
      __next = 'error';
   } else
   {
       __next = '3a';
       __exemode = 'continue';
   }","2a","check Data DictType By Key","check Data DictType By Key",""<endrec>
"CUSTOMER","30","6","11076","2294","Create Group Bank Account V2.0","__next  = '3b';
__committerParams.MSISDN=__msisdn;
__exemode = 'continue';","3a","query My Groups","query My Groups",""<endrec>
"CUSTOMER","","7","11077","2294","Create Group Bank Account V2.0","__tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups ) || size(__tempData.groups ) == 0)
   {
      __errormsg = 'Sorry, you have no groups .';
      __next = 'error';
   } else
   {
       __next = '4';
   }","3b","check My Group","check My Group",""<endrec>
"CUSTOMER","31","10","11078","2294","Create Group Bank Account V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__next = '6b';
__exemode = 'continue';","6a","Query Group Member Roles","Query Group Member Roles",""<endrec>
"CUSTOMER","","11","11079","2294","Create Group Bank Account V2.0","__tempData.roleList = __input.lastCommitResult.result;

if (!empty(__tempData.roleList ) || size(__tempData.roleList )) {
  __next = '8a';
__exemode = 'continue';
 } else {
   __errormsg = 'no current group member role.';
   __next = 'error';
 }","6b","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","50","13","11080","2294","Create Group Bank Account V2.0","__next  = '8b';
__exemode = 'continue';
__committerParams.IdentityType ='7000';","8a","query BankCard Attr","query BankCard Attr",""<endrec>
"CUSTOMER","","14","11081","2294","Create Group Bank Account V2.0","__tempData.attrList = __input.lastCommitResult.result;
   if (empty(__tempData.attrList ) || size(__tempData.attrList) == 0)
   {
      __errormsg = 'Sorry, there is no BankCard Attr .';
      __next = 'error';
   } else
   {
       __next = '9';
   }","8b","check BankCard Attr","check BankCard Attr",""<endrec>
"CUSTOMER","51","16","11082","2294","Create Group Bank Account V2.0","__next  = '10b';
__exemode = 'continue';
__committerParams.BankId =__params.BankId;","10a","query Org BankList","query Org BankList",""<endrec>
"CUSTOMER","","17","11083","2294","Create Group Bank Account V2.0","__tempData.bankList= __input.lastCommitResult.result;
   if (empty(__tempData.bankList) || size(__tempData.bankList) == 0) {
      __errormsg = 'Sorry, can not find bank.';
      __next = 'error';
    } else {
       __next = '11';
    }","10b","check Org BankList","check Org BankList",""<endrec>
"CUSTOMER","24","21","11084","2294","Create Group Bank Account V2.0","__next  = '14b';
__exemode = 'continue';","14a","getAllCurrencyList","getAllCurrencyList",""<endrec>
"CUSTOMER","","22","11085","2294","Create Group Bank Account V2.0","__tempData.currencys = __input.lastCommitResult.result;
  if (empty(__tempData.currencys) || size(__tempData.currencys) == 0) {
     __errormsg = 'Sorry, there is no currency.';
     __next = 'error';
   } else {
    __next = '15';
    }","14b","check All CurrencyList","check All CurrencyList",""<endrec>
"CUSTOMER","56","25","11086","2294","Create Group Bank Account V2.0","__next  = '16b';
__committerParams.InfoDetail=  __tempData.InfoDetail;
__exemode = 'continue';","16a","Build Bank Account Info","Build Bank Account Info",""<endrec>
"CUSTOMER","","26","11087","2294","Create Group Bank Account V2.0","__params.FIAccountInfo= __input.lastCommitResult.result;
   if (empty(__params.FIAccountInfo) || size(__params.FIAccountInfo) == 0)
{
      __errormsg = 'Sorry,Build account info failed.';
      __next = 'error';
}
else
{
       __next = '17';
}","16b","check Build result","check Build result",""<endrec>
"CUSTOMER","30","2","11088","2295","Create Group Bank Card Lookup V2.0","__next  = '1a';
__committerParams.MSISDN=__msisdn;
__exemode = 'continue';","1","query My Group","query My Group",""<endrec>
"CUSTOMER","","3","11089","2295","Create Group Bank Card Lookup V2.0","__tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups ) || size(__tempData.groups ) == 0)
   {
      __errormsg = 'Sorry, you have no groups .';
      __next = 'error';
   } else
   {
__exemode = 'continue';
       __next = '2';
   }","1a","check My Group","check My Group",""<endrec>
"CUSTOMER","49","4","11090","2295","Create Group Bank Card Lookup V2.0","__next  = '2a';
__committerParams.DataDictKey ='BANK_CATEGORY';
__exemode = 'continue';","2","query Data DictType By Key","query Data DictType By Key",""<endrec>
"CUSTOMER","","5","11091","2295","Create Group Bank Card Lookup V2.0","__tempData.items   = __input.lastCommitResult.result;
   if (empty(__tempData.items ) )
   {
      __errormsg = 'Sorry, faild to get DataDictType.';
      __next = 'error';
   } else
   {
       __next = '3';
       __exemode = 'continue';
   }","2a","check Data DictType By Key","check Data DictType By Key",""<endrec>
"CUSTOMER","50","6","11092","2295","Create Group Bank Card Lookup V2.0","__next  = '3a';
__exemode = 'continue';
__committerParams.IdentityType ='7000';","3","query BankCard Attr","query BankCard Attr",""<endrec>
"CUSTOMER","","7","11093","2295","Create Group Bank Card Lookup V2.0","__tempData.attrList = __input.lastCommitResult.result;
   if (empty(__tempData.attrList ) || size(__tempData.attrList) == 0)
   {
      __errormsg = 'Sorry, there is no BankCard Attr .';
      __next = 'error';
   } else
   {
       __tempData.InfoDetail= Util.createMap();
       __next = '4';
   }","3a","check BankCard Attr","check BankCard Attr",""<endrec>
"CUSTOMER","51","12","11094","2295","Create Group Bank Card Lookup V2.0","__next  = '8a';
__exemode = 'continue';
__committerParams.BankId =__params.BankId;","8","query Org BankList","query Org BankList",""<endrec>
"CUSTOMER","","13","11095","2295","Create Group Bank Card Lookup V2.0","__tempData.bankList= __input.lastCommitResult.result;
   if (empty(__tempData.bankList) || size(__tempData.bankList) == 0) {
      __errormsg = 'Sorry, can not find bank.';
      __next = 'error';
    } else {
       __next = '9';
    }","8a","check Org BankList","check Org BankList",""<endrec>
"CUSTOMER","56","18","11096","2295","Create Group Bank Card Lookup V2.0","__next  = '12b';
__committerParams.InfoDetail=  __tempData.InfoDetail;
__exemode = 'continue';","12a","Build Bank Account Info","Build Bank Account Info",""<endrec>
"CUSTOMER","","19","11097","2295","Create Group Bank Card Lookup V2.0","__params.FIAccountInfo= __input.lastCommitResult.result;
   if (empty(__params.FIAccountInfo) || size(__params.FIAccountInfo) == 0)
{
      __errormsg = 'Sorry,Build account info failed.';
      __next = 'error';
}
else
{
       __next = '13';
}","12b","check Build result","check Build result",""<endrec>
"CUSTOMER","","11","11098","2296","Create Group Bundle V2.0","if(__input.lastCommitResult.isSucess){  
  __tempData.BundleList = __input.lastCommitResult.result;
  if (empty(__tempData.BundleList )||size(__tempData.BundleList )==0) {
     __errormsg='You have no bundle to subscribe';
     __next='error';
  } else {
     __next='4';
  }
}else{
     __errormsg='Sorry,failed to query bundles';
     __next='error';
}","4b","Check Bundle List","Check Bundle List",""<endrec>
"CUSTOMER","","12","11099","2296","Create Group Bundle V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
               type = __tempData.BundleList.get(tmp);
                __params.BundleID = type.bundleId;
                __params.BundleName = type.bundleName;
                __params.Price= type.internalPrice;
                __params.Currency= type.Currency;
                __params.AutomaticRenewal= type.automaticRenewal;
                __params.BundleProvider= type.bundleProvider;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }","4","Select a Bundle","<html>
<body>
Please select destination bundle :<br>
$$var i = 1;
$$for(bundle: __tempData.BundleList ) {
   ${i} ${bundle.bundleName} :(${bundle.internalPrice} ${bundle.Currency})
$$if (!empty(bundle.durationTimes)) {
 (${bundle.durationTimes} ${bundle.durationUnit})<br>
$$}else{
     <br>
$$}
$$  i = i+1;
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","42","17","11100","2296","Create Group Bundle V2.0","__committerParams.params = __params;
__next = '9a';
__exemode='continue';","9","Convert Bundle Info","Convert Bundle Info",""<endrec>
"CUSTOMER","30","2","11101","2296","Create Group Bundle V2.0","__committerParams.MSISDN = __msisdn;
__next = '1a';
__exemode = 'continue';","1","Select Option","",""<endrec>
"CUSTOMER","","3","11102","2296","Create Group Bundle V2.0","__tempData.groups = __input.lastCommitResult.result;
__next = '2';","1a","Check Groups","Check Groups",""<endrec>
"CUSTOMER","31","7","11103","2296","Create Group Bundle V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;

__next  = '2d';
__exemode = 'continue';","2c","Query Group Member Roles","Query Group Member Roles",""<endrec>
"CUSTOMER","","8","11104","2296","Create Group Bundle V2.0","roleList = __input.lastCommitResult.result;

if ( !empty(roleList) || size(roleList)>0) {
  __next = '3';
} else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}","2d","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","38","7","11105","2293","Create Group V2.0","__committerParams.params = __params;
__next = '6a';
__exemode = 'continue';","6","Build Group KYC Info","Build Group KYC Info",""<endrec>
"CUSTOMER","37","8","11106","2293","Create Group V2.0","__params.KYCInfo = __input.lastCommitResult.result;
__committerParams.params = __params;
__next = '6b';
__exemode = 'continue';","6a","Build Group Product Info","Build Group Product Info",""<endrec>
"CUSTOMER","39","9","11107","2293","Create Group V2.0","__params.ProductList = __input.lastCommitResult.result;
__committerParams.params = __params;
__next = '6c';
__exemode = 'continue';","6b","Build Group Identifier List Info","Build Group Identifier List Info",""<endrec>
"CUSTOMER","40","10","11108","2293","Create Group V2.0","__params.IdentifierList = __input.lastCommitResult.result;
__committerParams.params = __params;
__next = '6d';
__exemode = 'continue';","6c","Build Group Basic Info","Build Group Basic Info",""<endrec>
"CUSTOMER","","11","11109","2293","Create Group V2.0","__params.GroupBasicInfo = __input.lastCommitResult.result;
__next = '7';","6d","Get Group Basic Info","Get Group Basic Info",""<endrec>
"CUSTOMER","30","13","11110","2298","Create Standing Order Schedule With Short Code By Group V2.0","__committerParams.MSISDN=__msisdn;
__next='11b';
__exemode = 'continue';","11a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","14","11111","2298","Create Standing Order Schedule With Short Code By Group V2.0","var isSucess=__input.lastCommitResult.isSucess;
if (isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if (!empty(__tempData.groups ))
    {
          __next = '11c';
   }
   else
   {
           __errormsg = 'can not found any available group.';
           __next = 'error';
   }
}
else
{
     __errormsg = 'can not found any available group.';
     __next = 'error';
}","11b","Check Query Groups Result","Check Query Groups Result",""<endrec>
"CUSTOMER","","1","11112","2299","Customer Activate Card V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'CustomerActivateCard';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;

__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11113","2299","Customer Activate Card V2.0","var input = __input.response;
if (empty(input)) {
  __next = '1c';
} else {
  var isSuccess = __input.validateResult.isSucess;
  if (isSuccess) {
               var tmp = Util.toInt(input) - 1;
    cardType = __tempData.cardTypes.get(tmp);
    __params.CardType = cardType.code;
                __tempData.cardNumbers =cardType.cardNumbers;
    __next = '2';
  } else {
    __next = '1c';
  }
}","1c","Select Card Type","<html>
<body>
Select Card Type :<br>
$$cardTypes=__tempData.cardTypes;
$$var i = 1;
$$for(cardType:cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11114","2299","Customer Activate Card V2.0","var input = __input.response;
if (empty(input))
{
__next = '2';
}
else
{
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
             var tmp = Util.toInt(input) - 1;
             __params.CardNumber = __tempData.cardNumbers.get(tmp);
              __next = '3';
         } else {
              __next = '2';
         }
}","2","Select Card Number","<html>
<body>
Select Card Number :<br>
$$cardNumbers = __tempData.cardNumbers;
$$if (empty(cardNumbers)||size(cardNumbers)==0) {
  You have no Card Number.
$$} else {
  $$var i = 1;
  $$for(cardNumber: cardNumbers ) {
  ${i} ${cardNumber}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","7","11115","2299","Customer Activate Card V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Activate Customer Card.Card Type: ${__params.CardType}, Card Number:${__params.CardNumber}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11116","2299","Customer Activate Card V2.0","var input = __input.response;
var isSuccess=__input.validateResult.isSucess;
if (!empty(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","1","11117","2300","Customer Activate Direct Debit Mandate V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = __msisdn;
__params.InitiatorIdentifierType= '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier= __msisdn;
__params.ActionType = 'ActivateCustomerDirectDebitMandate';
__params.MandateStatus = '02';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11118","2300","Customer Activate Direct Debit Mandate V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
__params.MandateID =  __tempData.mandateList.get(i).mandateId;
__next = '2';
} else {
__next = '1';
}","1","Enter Mandate ID","<html>
<body>
Select Mandate ID<br>
$$ var index = 1;
$$ for (mandate: __tempData.mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11119","2300","Customer Activate Direct Debit Mandate V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess)
{
__params.AgreedTC= input ;
 __next = '3';
}
else {
 __next = '2';
}","2","Select AgreedTC","<html>
<body>
Select Agreed Terms and Conditions<br>
0 No<br>
1 Yes<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","11120","2300","Customer Activate Direct Debit Mandate V2.0","var input = __input.response;
if(empty(input))
{
__next = '4';
}else if (size(input) < 64) {
 __params.PayerAccountName = input;
__next = '4';
} else {
  __next = '3';
}","3","Enter Payer Account Name","<html>
<body>Enter Payer Account Name<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","11121","2300","Customer Activate Direct Debit Mandate V2.0","var input = __input.response;
if (!empty(input) ) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __next = '4';
}","4","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","11122","2300","Customer Activate Direct Debit Mandate V2.0","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '5';
}","5","Confirm","<html>
<body>
Confirm to Activate Direct Debit Mandate?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11123","2301","Customer Apply Group Buy Goods Voucher V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '15'; /*GROUP_CODE */
__params.RequesterIdentifier = __msisdn;
__params.VoucherTypeCode = 'Group Buy Goods with Voucher';
__exemode = 'continue';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","11124","2301","Customer Apply Group Buy Goods Voucher V2.0","var input =__input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
     __params.ReceiverPartyIdentifier = input;
     __next = '5';
  }
else{
    __next = '3';
}","3","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11125","2301","Customer Apply Group Buy Goods Voucher V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.VoucherAmount =Util.replaceAll(input,',','.');
    __next = '6';
} else {
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","8","11126","2301","Customer Apply Group Buy Goods Voucher V2.0","var input = __input.response;
__params.PIN = input;
__next = '7';","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11127","2301","Customer Apply Group Buy Goods Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to Request Group Buy Goods Voucher?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","11128","2301","Customer Apply Group Buy Goods Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = '3';
} else if (input == '2') {
  __next = '4'
} else {
  __next = '2';
}","2","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11129","2301","Customer Apply Group Buy Goods Voucher V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '5';
}
else{
  __next = '4';
}","4","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11130","2302","Customer Apply Group Deposit Voucher V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '15'; /*GROUP_CODE */
__params.RequesterIdentifier = __msisdn;
__params.VoucherTypeCode = 'Group Deposit Voucher';

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","11131","2302","Customer Apply Group Deposit Voucher V2.0","var input =__input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
     __params.ReceiverPartyIdentifier = input;
     __next = '5';
  }
else{
    __next = '2';
}","2","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11132","2302","Customer Apply Group Deposit Voucher V2.0","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","11133","2302","Customer Apply Group Deposit Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to Request Customer Apply Group Deposit Voucher?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","11134","2302","Customer Apply Group Deposit Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input == '2') {
  __exemode = 'continue';
   __next = '3'
} else {
  __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11135","2302","Customer Apply Group Deposit Voucher V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
  beneficiary= __tempData.beneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
  __next = '5';
}
else{
  __next = '4';
}","4","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: __tempData.beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11136","2303","Customer Apply Group Withdraw Voucher V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '15'; /*GROUP_CODE */
__params.RequesterIdentifier = __msisdn;
__params.VoucherTypeCode = 'Group Withdraw Voucher';
__exemode = 'continue';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","11137","2303","Customer Apply Group Withdraw Voucher V2.0","var input =__input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
     __params.ReceiverPartyIdentifier = input;
     __next = '5';
  }
else{
    __next = '3';
}","3","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11138","2303","Customer Apply Group Withdraw Voucher V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.VoucherAmount =Util.replaceAll(input,',','.');
    __next = '6';
} else {
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","8","11139","2303","Customer Apply Group Withdraw Voucher V2.0","var input = __input.response;
__params.PIN = input;
__next = '7';","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11140","2303","Customer Apply Group Withdraw Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to Request Group Withdraw Voucher?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","11141","2303","Customer Apply Group Withdraw Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = '3';
} else if (input == '2') {
  __next = '4'
} else {
  __next = '2';
}","2","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11142","2303","Customer Apply Group Withdraw Voucher V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '5';
}
else{
  __next = '4';
}","4","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11143","2304","Customer Buy Foreign Currency V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '11'; /* SP SHORT CODE */
__params.ReceiverPartyIdentifier = '1';
__params.TransactionCategory = 'FX';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11144","2304","Customer Buy Foreign Currency V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
                __params.DestinationCurrency =__tempData.multiCurrencyCode.get(tmp);
                __next = '2a';
                __exemode='continue';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }","1","Select Currency","<html>
<body>
Select the Foreign Currency to Buy :<br>
$$multiCurrencyCode =__tempData.multiCurrencyCode;
$$if (empty(multiCurrencyCode)) {
  You have no currencyCode to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","7","11145","2304","Customer Buy Foreign Currency V2.0","var input = __input.response;
if (input == '1') {
        __params.Currency = __params.DestinationCurrency;
  __params.BaseCurrency = __params.DestinationCurrency;
  __next = '3';
} else if (input == '2') {
        __params.Currency =  __tempData.defaultCurrencyCode ;
  __params.BaseCurrency = __tempData.defaultCurrencyCode ;
  __next = '3';
} else {
  __next = '2';
}","2","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.DestinationCurrency} <br>
2 Input the amount in ${__tempData.defaultCurrencyCode}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","11146","2304","Customer Buy Foreign Currency V2.0","__params.SourceCurrency =  __tempData.defaultCurrencyCode ;
var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
  __params.BaseAmount = Util.replaceAll(input,',','.');
  __next = '4a';
  __exemode='continue';
}
else {
 __next = '3';
}","3","Input Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","11","11147","2304","Customer Buy Foreign Currency V2.0","var input = __input.response;
  if (!empty(input)) {
    var tmp = Util.toInt(input) - 1;
                var isSuccess = __input.validateResult.isSucess;
    if (isSuccess) {
      type = __tempData.multiAccount.get(tmp);
      __params.SourceAccount = type.AccountNo;
      __next = '5';
    } else {
      __next = '4';
    }
  } else {
    __next = '4';
  }","4","Select account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","11148","2304","Customer Buy Foreign Currency V2.0","var input = __input.response;
__params.PIN = input;
__next = '6a';
__exemode='continue';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","11149","2304","Customer Buy Foreign Currency V2.0","if (__tempData.rateInfo.formatRate == null) {
  __next = 'error';
} else {
  var input = __input.response;
  if (input == '1') {
      __next = 'end';
  } else if(input == '0') {
      __next = 'cancel';
  } else {
      __next = '6';
  }
}","6","Confirm","<html>
<body>
$$rateInfo =__tempData.rateInfo ;
You are going to buy [${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}],[${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}] will be debited from your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11156","2306","Customer Buy Goods via m-pesa V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11157","2306","Customer Buy Goods via m-pesa V2.0","var input = __input.response;
    if (empty(input)) {
     __next = '1';
    } else if (input == '1') {
        __params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
        __tips = 'Till no';
        __next = '2';
    } else if (input == '2') {
        __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
        __tips = 'Short code';
        __next = '2';
    } else {
     __next = '1';
    }","1","Select Till no or Short code","<html>
<body>
Select Till no or Short code<br>
1 Till no<br>
2 Short code<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","11158","2306","Customer Buy Goods via m-pesa V2.0","var input = __input.response;
if (empty(input)) {
__next = '2';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '3';
__exemode = 'continue';
}","2","Enter Till no or Short code","<html>
<body>
Enter ${__tips}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11159","2306","Customer Buy Goods via m-pesa V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    __params.Currency = __tempData.currencys.get(i);
    __next = '5';
} else {
  __next = '4';
}","4","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
  $$var i = 1;
  $$for(type: __tempData.currencys ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","7","11160","2306","Customer Buy Goods via m-pesa V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.Amount=Util.replaceAll(input,',','.');
    __next = '6';
    __exemode='continue';
} else {
    __next = '5';
}","5","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","10","11161","2306","Customer Buy Goods via m-pesa V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
      type = __tempData.multiAccount.get(i);
     __params.InitiatorAccountNo= type.AccountNo;
  __next = '8';
}
else{
  __next = '7';
}","7","Choose Initiator AccountNo","<html>
<body>
Please select Initiator account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","11162","2306","Customer Buy Goods via m-pesa V2.0","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","11163","2306","Customer Buy Goods via m-pesa V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Buy Goods - ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","11164","2306","Customer Buy Goods via m-pesa V2.0","var input = __input.response;
var length = size(input);
if (length > 255)
{
    __next = '9';
}
else
{
     __referenceData.Comment2Customer = input;
    __next = '10';
}","9","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11165","2307","Customer Cancel Card V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'CustomerCancelCard';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;

__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11166","2307","Customer Cancel Card V2.0","var input = __input.response;
if (empty(input)) {
  __next = '1';
} else {
  var tmp = Util.toInt(input) - 1;
        var isSuccess = __input.validateResult.isSucess;
  if (isSuccess) {
                cardType=__tempData.cardTypes.get(tmp);
    __params.CardType =cardType.code;
                __tempData.cardNumbers=cardType.cardNumbers;
    __next = '2';
  } else {
    __next = '1';
  }
}","1","Select Card Type","<html>
<body>
Select Card Type :<br>
$$cardTypes=__tempData.cardTypes;
  $$var i = 1;
  $$for(cardType: cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11167","2307","Customer Cancel Card V2.0","var input = __input.response;
if (empty(input))
{
__next = '2';
}
else
{
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
                __params.CardNumber =__tempData.cardNumbers.get(tmp);
                __next = '3';
         } else {
                __next = '2';
         }
}","2","Select Card Number","<html>
<body>
Select Card Number :<br>
$$ cardNumbers =__tempData.cardNumbers;
$$if (empty(cardNumbers)) {
  You have no Card Number.
$$} else {
  $$var i = 1;
  $$for(cardNumber: cardNumbers ) {
  ${i} ${cardNumber}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","7","11168","2307","Customer Cancel Card V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Cancel Customer Card. Card Type:${__params.CardType}, Card Number:${__params.CardNumber}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11169","2307","Customer Cancel Card V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input)) {
    __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","1","11170","2308","Customer Cancel Direct Debit Mandate V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = __msisdn;
__params.ActionType= 'CancelCustomerDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;
__params.MandateStatus = '02,03';
 __next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11171","2308","Customer Cancel Direct Debit Mandate V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
__params.MandateID =  __tempData.mandateList.get(i).mandateId;
__params.PayeeName = __tempData.mandateList.get(i).payeeName;
__next = '2';
} else {
__next = '1';
}","1","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$mandateList=__tempData.mandateList;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11172","2308","Customer Cancel Direct Debit Mandate V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '2';
} else {
    __params.@HEAD@PIN = input;
    __next = '3';
}","2","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","11173","2308","Customer Cancel Direct Debit Mandate V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11174","2309","Customer Change Language V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'ChangeLanguage';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier =__msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11175","2309","Customer Change Language V2.0","var i = Util.toInt(__input.response) - 1;
var isSucess = __input.validateResult.isSucess;
if (isSucess)
{
  __params.@BODY@LanguageCode = __tempData.languages.get(i).toString();
  __next = '3';
} else {
  __next = '2';
}","2","Select Language","<html>
<body>
Please select language:<br>
$$languages =__tempData.languages;
$$var i = 1;
$$for (lang: languages) {
  ${i} ${lang.getDisplayName(__locale)}<br>
  $$ i = i + 1;
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11176","2309","Customer Change Language V2.0","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11177","2309","Customer Change Language V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Do you confirm to change language to ${__params.@BODY@LanguageCode}?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11178","2310","Customer Change Secret Word V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'ChangeSecretWord';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11179","2310","Customer Change Secret Word V2.0","var input = __input.response;
__params.NewSecretWord = input;
__next = '2';","1","Enter new secret word","<html>
<body>
Enter new secret word<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","11180","2310","Customer Change Secret Word V2.0","var input = __input.response;
if(__params.NewSecretWord == input)
{
__next = '3';
}
else
{
__next = '1';  
}","2","Confirm secret word","<html>
<body>
Confirm secret word<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","11181","2310","Customer Change Secret Word V2.0","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11182","2310","Customer Change Secret Word V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to Change Secret Word?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11183","2311","Customer Close Account V2.0","__params.ServiceCode = __serviceCode;
__params.Channel =  __sessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier = __msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';
__params.ActionType = 'CloseCustAdditionalAccountStatus';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;
__params.Status ='1006';
__next = '1a';
__exemode='continue';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","11184","2311","Customer Close Account V2.0","var isSucess = __input.validateResult.isSucess;
var input = __input.response;
var i= Util.toInt(input) - 1;
if (isSucess)
{
   accountType =  __tempData.accountList.get(i);
  __params.AccountNo = accountType.AccountNo;
  __params.AccountName = accountType.AccountName;
   __next = '3';
}
else{
  __next = '2';
}","2","Select Account","<html>
<body>
Please Select Account:<br>
$$ accountTypes = __tempData.accountList;
$$if (empty(accountTypes )) {
  You have no account type exist !
$$} else {
  $$var index = 1;
  $$for(accountType: accountTypes ) {
  ${index} ${accountType.AccountName}(${accountType.AccountType.AccountTypeAlias})<br>
  $$  index = index+1;
  $$}
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11185","2311","Customer Close Account V2.0","__params.@HEAD@PIN = __input.response;
__next = '4';","3","Enter PIN","<html>
<body>
 Enter PIN :<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11186","2311","Customer Close Account V2.0","var input = __input.response;
if(input == 1) {
 __next = 'end';
}else if(input == 0){
 __next = 'cancel';
}else{
 __next = '4';
}","4","Confirm","<html>
<body>
 Confirm to close account ${__params.AccountName}<br>
1 OK  <br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11187","2312","Customer Create Account V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier = __msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';
__params.ActionType = 'CreateAccount';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;
__params.Currency= 'USD';
__next = '1a';
__exemode='continue';","begin","set parammeters","",""<endrec>
"CUSTOMER","","6","11188","2312","Customer Create Account V2.0","__params.@HEAD@PIN = __input.response;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11189","2312","Customer Create Account V2.0","var isSucess = __input.validateResult.isSucess;
if (isSucess)
{
 __params.AccountName = __input.response;
 __next = '4';
}
else
{
__next = '3';
}","3","Enter Account Name","<html>
<body>
Enter Account Name:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","9"<endrec>
"CUSTOMER","","4","11190","2312","Customer Create Account V2.0","var i = Util.toInt(__input.response)-1;
var isSucess = __input.validateResult.isSucess;
if (isSucess)
{
   var accountType = __tempData.accTypeList.get(i);
  __params.AccountType = accountType.AccountTypeId;
   __next = '3';
}
else{
  __next = '2';
}","2","Select Account Type","<html>
<body>
Please Select Account Type:<br>
$$var accountTypes = __tempData.accTypeList;
$$ var index = 1;
$$ for (accountType: accountTypes){
 ${index}  ${accountType.AccountTypeAlias} <br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","7","11191","2312","Customer Create Account V2.0","var input = __input.response;
if(input == 1) {
 __next = 'end';
}else if(input == 0) {
 __next = 'cancel';
}else{
  __next = '5';
}","5","Confirm","<html>
<body>
 Confirm to create ${__params.AccountName} account <br>
1 OK  <br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11192","2313","Customer Edit Direct Debit Mandate V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = __msisdn;
__params.ActionType= 'EditCustomerDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;
__params.MandateStatus = '02,03';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11193","2313","Customer Edit Direct Debit Mandate V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
__params.MandateID =  __tempData.mandateList.get(i).mandateId;
__params.PayeeName =  __tempData.mandateList.get(i).payeeName;
__next = '2';
} else {
__next = '1';
}","1","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate:__tempData.mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11194","2313","Customer Edit Direct Debit Mandate V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess)
{
  __params.AgreedTC = input;
  __next = '3';
}
else {
  __next = '2';
}","2","Agreed TC","<html>
<body>Please Select you have Agreed T:<br>
1 yes<br>
0 no<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","11195","2313","Customer Edit Direct Debit Mandate V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '3';
} else {
    __params.@HEAD@PIN = input;
    __next = '4';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11196","2313","Customer Edit Direct Debit Mandate V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11197","2314","Customer Get Start PIN V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'CustomerGetStartPIN';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11198","2314","Customer Get Start PIN V2.0","if(__input.validateResult.isSucess)
 {
  __params.Birthday = Util.convertorDateFormat(input, 'yyyyMMdd',null);
  __next = '2a';
  __exemode = 'continue';
} else {
  __next = '1';
}","1","Enter Date of Birth","<html>
<body>
Enter Date of Birth(yyyyMMdd)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","5","11199","2314","Customer Get Start PIN V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html><body>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11200","2315","Customer Initiate Reversal Request V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","11201","2315","Customer Initiate Reversal Request V2.0","var input = __input.response;
if (!empty(input)) {
  __params.OriginalReceiptNumber= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Transaction ID","<html>
<body>
Enter Transaction ID<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","11202","2315","Customer Initiate Reversal Request V2.0","var input = __input.response;
if (!empty(input)) {
__params.PIN = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","11203","2315","Customer Initiate Reversal Request V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input != '1') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","You are going to initiate reversal request","<html>
<body>
You are going to initiate reversal request. Press 1 to continue and other numbers to cancel.<br>
1 OK<br>
 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","11204","2316","Customer Intra-Account Transfer Saving to Saving V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
  __params.Amount = Util.replaceAll(input,',','.');
  __next = '2a';
  __exemode='continue';
}
else {
  __next = '1';
}","1","Input Amount","<html>
<body>Input Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","5","11205","2316","Customer Intra-Account Transfer Saving to Saving V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
                __params.Currency = __tempData.multiCurrencyCode.get(tmp);
                __next = '3a';
                __exemode='continue';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","11206","2316","Customer Intra-Account Transfer Saving to Saving V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess=__input.validateResult.isSucess;
         if(isSuccess) {
                __params.PrimaryAccountNo= __tempData.multiAccount.get(tmp).AccountNo;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }","3","Choose From AccountNo","<html>
<body>
Please select Origin account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","9","11207","2316","Customer Intra-Account Transfer Saving to Saving V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess=__input.validateResult.isSucess;
         if(isSuccess) {
                __params.ReceiverAccountNo= __tempData.multiAccount.get(tmp).AccountNo;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }","4","Choose To AccountNo","<html>
<body>
Please select Destination account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11208","2316","Customer Intra-Account Transfer Saving to Saving V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","10","11209","2316","Customer Intra-Account Transfer Saving to Saving V2.0","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","11210","2316","Customer Intra-Account Transfer Saving to Saving V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to Intra_Account Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","11211","2316","Customer Intra-Account Transfer Saving to Saving V2.0","var input = __input.response;
if(empty(input)||size(input)>255){
    __next = '6';
}else
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11236","2320","Customer Online Cash In V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01';   /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SP_ID */
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11237","2320","Customer Online Cash In V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.Amount = Util.replaceAll(input,',','.');
    __next = '2a';
    __exemode='continue';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","7","11238","2320","Customer Online Cash In V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if(isSuccess){
   bankAccounts=__tempData.bankAccounts;
   __params.BankCardID= bankAccounts.get(i).bankCardId;
   __params.BankAccountName= bankAccounts.get(i).accountName + '/' + bankAccounts.get(i).accountNumber + '(' + bankAccounts.get(i).bankName  + ')';
   __params.Currency=bankAccounts.get(i).currency;
   __next = '3';
} else {
   __next = '2';
}","2","Select Bank Card ID","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: __tempData.bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","11239","2320","Customer Online Cash In V2.0","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11240","2320","Customer Online Cash In V2.0","var input = __input.response;
if (!empty(input) and size(input) > 255)
{
    __next = '4';
}
else
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11241","2320","Customer Online Cash In V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Cash In Amount : ${__params.Amount}<br>
Bank Account: ${__params.BankAccountName}<br>
1 OK <br>
0 Cancel <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11242","2321","Customer Payment With Foreign Exchange V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.TransactionCategory = 'FX';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11243","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifierType = '01';
  __next = '2a';
  __exemode='continue';
} else if(input == '2') {
  __params.ReceiverPartyIdentifierType = '15';
  __next = '3a';
  __exemode='continue';
} else if(input == '3') {
  __params.ReceiverPartyIdentifierType = '04';
  __next = '4';
} else {
  __next = '1';
}","1","Select Receiver Type","<html>
<body>
Please select the receiver type: <br>
1 Customer <br>
2 Group <br>
3 Organization <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11244","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
if (input == '1') {
  __next = '5a';
} else if (input == '2') {
  __next = '5b';
} else {
  __next = '2';
}","2","Customer Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","11245","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
if (input == '1') {
  __next = '6a';
} else if (input == '2') {
        __next = '6b';
} else {
  __next = '3';
}","3","Select Group Option","<html>
<body>
Please select option: <br>
1 Enter Recipient Group Code<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11246","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
if (empty(input)) {
__next = '4';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '7a';
__exemode='continue';
}","4","Input Org Short Code","<html>
<body>
Please enter organization short code<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11247","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
if (empty(input)) {
  __next = '5a';
} else {
  __params.ReceiverPartyIdentifier = input;
  __next = '7a';
  __exemode='continue';
}","5a","Input Msisdn","<html>
<body>
Enter customer msisdn<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","11248","2321","Customer Payment With Foreign Exchange V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  beneficiary= __tempData.customerBeneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '7a';
  __exemode='continue';
}
else{
  __next = '5b';
}","5b","Select Customer","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: __tempData.customerBeneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","11249","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
     __params.ReceiverPartyIdentifier = input;
  __next = '7a';
  __exemode='continue';
}
else{
    __next = '6a';
}","6a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","13","11250","2321","Customer Payment With Foreign Exchange V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  beneficiary= __tempData.groupBeneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
  __next = '7a';
  __exemode='continue';
}
else{
  __next = '6b';
}","6b","Select Group","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: __tempData.groupBeneficiaries ){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","16","11251","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
  if (!empty(input)) {
    var tmp = Util.toInt(input) - 1;
                var isSuccess = __input.validateResult.isSucess;
    if (isSuccess) {
      __params.DestinationCurrency= __tempData.multiCurrencyCode.get(tmp);
                        __next='8a';
                        __exemode='continue';
    } else {
      __next = '7';
    }
  } else {
    __next = '7';
  }","7","Select Dest Currency","<html>
<body>
Select the destination currency you want to pay :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","19","11252","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
if (empty(input) || input=='1') {
__params.SourceCurrency = __tempData.defaultCurrencyCode;
__next = '11';
} else {
__next = '9';
}","9","Select Source Currency","<html>
<body>
Select the source currency to pay from:<br>
1 ${__tempData.defaultCurrencyCode}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","22","11253","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
               type = __tempData.multiForeignCurrencyCode.get(tmp);
                __params.SourceCurrency = type;
                __next = '11';
         } else {
                __next = '10';
         }
    } else {
        __next = '10';
    }","10","Select Foreign Source Currency","<html>
<body>
Select the source currency to pay from:<br>
  $$var i = 1;
  $$for(type: __tempData.multiForeignCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","23","11254","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
if (input == '1') {
  __params.BaseCurrency = __params.SourceCurrency ;
  __params.Currency = __params.BaseCurrency;
  __next = '12';
} else if(input == '2') {
  __params.BaseCurrency = __params.DestinationCurrency ;
  __params.Currency = __params.BaseCurrency;
   __next = '12';
} else {
  __next = '11';
}","11","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.SourceCurrency} <br>
2 Input the amount in ${__params.DestinationCurrency}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","24","11255","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
 __params.BaseAmount = Util.replaceAll(input,',','.');
 __next = '13a';
 __exemode='continue';
}
else {
 __next = '12';
}","12","Input Base Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","27","11256","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
  if (isSuccess) {
               type = __tempData.multiAccount.get(tmp);
                __params.SourceAccount = type.AccountNo;
                __next = '14';
         } else {
                __next = '13';
         }
    } else {
        __next = '13';
    }","13","Select Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","62","28","11257","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
__params.PIN = input;

__committerParams.SourceCurrency=__params.SourceCurrency;
__committerParams.DestinationCurrency=__params.DestinationCurrency;
__committerParams.BaseCurrency=__params.BaseCurrency;
__committerParams.BaseAmount=__params.BaseAmount;
__next = '15a';
__exemode='continue';","14","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","30","11258","2321","Customer Payment With Foreign Exchange V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '15';
}","15","Confirm","<html>
<body>
$$rateInfo = __tempData.rateInfo;
You are going to pay [${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}] to ${__params.ReceiverPartyIdentifier},[${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}] will be debited from your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11259","2322","Customer Query an Account Balance via Handset V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11260","2322","Customer Query an Account Balance via Handset V2.0","var input = __input.response;
  var i = Util.toInt(input) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    accountTypes=__tempData.accountTypeList.get(i);
    __params.AccountTypeCode = accountTypes;
    __next = '2';
  } else {
    __next = '1';
  }","1","Choose Account Type","<html>
<body>
Please select account:<br>
  $$var i = 1;
  $$for(type: __tempData.accountTypeList) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11261","2322","Customer Query an Account Balance via Handset V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.PIN = input;
    __next = '3';
} else {
    __next = '2a';
}","2","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","11262","2322","Customer Query an Account Balance via Handset V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.PIN = input;
    __next = '3';
} else {
    __next = '2a';
}","2a","Reenter pin","<html>
<body>
Reenter pin<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11263","2322","Customer Query an Account Balance via Handset V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","46","2","11264","2299","Customer Activate Card V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__committerParams.AccessDeviceIdentifier = __params.AccessDeviceIdentifier;
__committerParams.AccessDeviceIdentifierType = __params.AccessDeviceIdentifierType;
__committerParams.queryCardType = '1';  /* activate */
__next='1b';
__exemode='continue';","1a","Query Activate Card Type Infos","Query Activate Card Type Infos",""<endrec>
"CUSTOMER","","3","11265","2299","Customer Activate Card V2.0","__tempData.cardTypes =__input.lastCommitResult.result;
   if(empty(__tempData.cardTypes)|| size(__tempData.cardTypes)==0){
       __errormsg = 'You have no Card Type.';
       __next = 'error';
   }else {
       __next = '1c';
   }","1b","Check Card Types","Check Card Types",""<endrec>
"CUSTOMER","54","2","11266","2300","Customer Activate Direct Debit Mandate V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.AccessDeviceIdentifierType=__params.AccessDeviceIdentifierType;
__committerParams.AccessDeviceIdentifier=__params.AccessDeviceIdentifier;
__committerParams.MandateStatus=__params.MandateStatus;
__next='1b';
__exemode='continue';","1a","Query Direct Debit Mandates","Query Direct Debit Mandates",""<endrec>
"CUSTOMER","","3","11267","2300","Customer Activate Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.mandateList =__input.lastCommitResult.result;
   if(empty(__tempData.mandateList )||size(__tempData.mandateList )==0){
       __errormsg = 'No Available Mandates.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying direct debit mandates.';
   __next = 'error';
}","1b","Check Direct Debit Mandates","Check Direct Debit Mandates",""<endrec>
"CUSTOMER","30","2","11268","2301","Customer Apply Group Buy Goods Voucher V2.0","__next  = '1a';
__committerParams.MSISDN=__msisdn;
__exemode = 'continue';","1","query My Groups","query My Groups",""<endrec>
"CUSTOMER","","3","11269","2301","Customer Apply Group Buy Goods Voucher V2.0","__tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups ) || size(__tempData.groups ) == 0)
   {
      __errormsg = 'Sorry, you have no groups .';
      __next = 'error';
   } else
   {
       __next = '2';
   }","1a","check My Group","check My Group",""<endrec>
"CUSTOMER","23","4","11270","2302","Customer Apply Group Deposit Voucher V2.0","__next  = '3a';
__committerParams.MSISDN = __IdentityInfo.msisdn;
   __committerParams.IdentityType='7000';
__exemode = 'continue';","3","query beneficiary","query beneficiary",""<endrec>
"CUSTOMER","","5","11271","2302","Customer Apply Group Deposit Voucher V2.0","__tempData.beneficiarys = __input.lastCommitResult.result;
   if (empty(__tempData.beneficiarys ) || size(__tempData.beneficiarys ) == 0)
   {
      __errormsg = 'Sorry, you have no group beneficiary .';
      __next = 'error';
   } else
   {
       __next = '4';
   }","3a","check beneficiary","check beneficiary",""<endrec>
"CUSTOMER","30","2","11272","2303","Customer Apply Group Withdraw Voucher V2.0","__next  = '1a';
__committerParams.MSISDN=__msisdn;
__exemode = 'continue';","1","query My Groups","query My Groups",""<endrec>
"CUSTOMER","","3","11273","2303","Customer Apply Group Withdraw Voucher V2.0","__tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups ) || size(__tempData.groups ) == 0)
   {
      __errormsg = 'Sorry, you have no groups .';
      __next = 'error';
   } else
   {
       __next = '2';
   }","1a","check My Group","check My Group",""<endrec>
"CUSTOMER","58","2","11274","2304","Customer Buy Foreign Currency V2.0","__next='1b';
__exemode='continue';","1a","Query All Foreign Currency","Query All Foreign Currency",""<endrec>
"CUSTOMER","","3","11275","2304","Customer Buy Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying foreign currencyCode.';
   __next = 'error';
}","1b","Check Foreign Currency","Check Foreign Currency",""<endrec>
"CUSTOMER","59","5","11276","2304","Customer Buy Foreign Currency V2.0","__next='2b';
__exemode='continue';","2a","Query Default Currency Code","Query Default Currency Code",""<endrec>
"CUSTOMER","","6","11277","2304","Customer Buy Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.defaultCurrencyCode =__input.lastCommitResult.result;
    __next='2';
}else{
   __errormsg = 'Sorry,error occured when querying defaultCurrencyCode.';
   __next = 'error';
}","2b","Check Default Currency","Check Default Currency",""<endrec>
"CUSTOMER","29","9","11278","2304","Customer Buy Foreign Currency V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;
__next='4b';
__exemode='continue';","4a","Query Multi Account","Query Multi Account",""<endrec>
"CUSTOMER","","10","11279","2304","Customer Buy Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='4';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","4b","Check Multi Account","Check Multi Account",""<endrec>
"CUSTOMER","62","13","11280","2304","Customer Buy Foreign Currency V2.0","__committerParams.SourceCurrency=__params.SourceCurrency;
__committerParams.DestinationCurrency=__params.DestinationCurrency;
__committerParams.BaseCurrency=__params.BaseCurrency;
__committerParams.BaseAmount=__params.BaseAmount;
__next='6b';
__exemode='continue';","6a","Query Fx Rate and Amount","Query Fx Rate and Amount",""<endrec>
"CUSTOMER","","14","11281","2304","Customer Buy Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.rateInfo=__input.lastCommitResult.result;
    __next='6';
}else{
   __errormsg = 'Sorry,error occured when querying rateInfo.';
   __next = 'error';
}","6b","Check Fx RateInfo","Check Fx RateInfo",""<endrec>
"CUSTOMER","24","4","11282","2306","Customer Buy Goods via m-pesa V2.0","__next  = '3a';
__exemode = 'continue';","3","Query Currency List","Query Currency List",""<endrec>
"CUSTOMER","","5","11283","2306","Customer Buy Goods via m-pesa V2.0","__tempData.currencys = __input.lastCommitResult.result;
  if (empty(__tempData.currencys) || size(__tempData.currencys) == 0) {
     __errormsg = 'Sorry, there is no currency.';
     __next = 'error';
   } else {
    __next = '4';
    }","3a","check All CurrencyList","check All CurrencyList",""<endrec>
"CUSTOMER","29","8","11284","2306","Customer Buy Goods via m-pesa V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;
__next='6a';
__exemode='continue';","6","query Multi Accounts","query Multi Accounts",""<endrec>
"CUSTOMER","","9","11285","2306","Customer Buy Goods via m-pesa V2.0","__tempData.multiAccount= __input.lastCommitResult.result;
   if (empty(__tempData.multiAccount) || size(__tempData.multiAccount) == 0)
   {
      __errormsg = 'Sorry, you have no groups .';
      __next = 'error';
   } else if(1 == size(__tempData.multiAccount))
   {
    type = __tempData.multiAccount.get(0);
    if(type.defaultFlag == 'true')
    {
      __next = '8';
    }
   }else
    {
       __next = '7';
    }","6a","check Multi Accounts","check Multi Accounts",""<endrec>
"CUSTOMER","46","2","11286","2307","Customer Cancel Card V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__committerParams.AccessDeviceIdentifier = __params.AccessDeviceIdentifier;
__committerParams.AccessDeviceIdentifierType = __params.AccessDeviceIdentifierType;
__committerParams.queryCardType = '2';  /* cancel */
__next='1b';
__exemode='continue';","1a","Query Cancel Card Type Infos","Query Cancel Card Type Infos",""<endrec>
"CUSTOMER","","3","11287","2307","Customer Cancel Card V2.0","__tempData.cardTypes =__input.lastCommitResult.result;
   if(empty(__tempData.cardTypes)|| size(__tempData.cardTypes)==0){
       __errormsg = 'You have no Card Type.';
       __next = 'error';
   }else {
       __next = '1';
   }","1b","Check Card Types","Check Card Types",""<endrec>
"CUSTOMER","54","2","11288","2308","Customer Cancel Direct Debit Mandate V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.MandateStatus=__params.MandateStatus;
__next='1b';
__exemode='continue';","1a","Query Direct Debit Mandates","Query Direct Debit Mandates",""<endrec>
"CUSTOMER","","3","11289","2308","Customer Cancel Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.mandateList =__input.lastCommitResult.result;
   if(empty(__tempData.mandateList )||size(__tempData.mandateList )==0){
       __errormsg = 'No Available Mandates.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying direct debit mandates.';
   __next = 'error';
}","1b","Check Direct Debit Mandates","Check Direct Debit Mandates",""<endrec>
"CUSTOMER","5","2","11290","2309","Customer Change Language V2.0","__next  = '1b';
__exemode = 'continue';","1a","Query All Languages","Query All Languages",""<endrec>
"CUSTOMER","","3","11291","2309","Customer Change Language V2.0","var commitResult=__input.lastCommitResult;
if(commitResult.isSucess){
   __tempData.languages = commitResult.result;
   if (empty(__tempData.languages) || size(__tempData.languages) == 0) {
      __errormsg = 'Sorry, there is no language.';
      __next = 'error';
    } else {
       __next = '2';
    }
}else{
    __errormsg = 'Sorry, error occured when querying languages.';
    __next = 'error';
}","1b","Check Languages","Check Languages",""<endrec>
"CUSTOMER","29","2","11292","2311","Customer Close Account V2.0","__committerParams.IdentityType= __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;

__next = '1b';
__exemode = 'continue';","1a","Query Identity Accounts","Query Identity Accounts",""<endrec>
"CUSTOMER","","3","11293","2311","Customer Close Account V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
      __tempData.accountList = __input.lastCommitResult.result;
}
__next = '2';","1b","Checker Identity Accounts","Checker Identity Accounts",""<endrec>
"CUSTOMER","43","2","11294","2312","Customer Create Account V2.0","__committerParams.Flag = 'Customer';
__next = '1b';
__exemode = 'continue';","1a","Query Account Type","Query Account Type",""<endrec>
"CUSTOMER","","3","11295","2312","Customer Create Account V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
     __tempData.accTypeList= __input.lastCommitResult.result;
}
__next = '2';","1b","Checker Account Type List","Checker Account Type List",""<endrec>
"CUSTOMER","54","2","11296","2313","Customer Edit Direct Debit Mandate V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.MandateStatus=__params.MandateStatus;
__next='1b';
__exemode='continue';","1a","Query Direct Debit Mandates","Query Direct Debit Mandates",""<endrec>
"CUSTOMER","","3","11297","2313","Customer Edit Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.mandateList =__input.lastCommitResult.result;
   if(empty(__tempData.mandateList )||size(__tempData.mandateList )==0){
       __errormsg = 'No Available Mandates.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying direct debit mandates.';
   __next = 'error';
}","1b","Check Direct Debit Mandates","Check Direct Debit Mandates",""<endrec>
"CUSTOMER","36","3","11298","2314","Customer Get Start PIN V2.0","__next = '2b';
__exemode = 'continue';","2a","Build Customer Info","Build Customer Info",""<endrec>
"CUSTOMER","","4","11299","2314","Customer Get Start PIN V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
     __params.KYCInfo= __input.lastCommitResult.result;
}

__next = '3';","2b","Checker Customer Info","Checker Customer Info",""<endrec>
"CUSTOMER","24","3","11300","2316","Customer Intra-Account Transfer Saving to Saving V2.0","__next='2b';
__exemode='continue';","2a","Query All Currency","Query All Currency",""<endrec>
"CUSTOMER","","4","11301","2316","Customer Intra-Account Transfer Saving to Saving V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying currencyCodes.';
   __next = 'error';
}","2b","Check All Currency","Check All Currency",""<endrec>
"CUSTOMER","29","6","11302","2316","Customer Intra-Account Transfer Saving to Saving V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'Saving accounts';
__committerParams.Currency = __params.Currency;
__next='3b';
__exemode='continue';","3a","Query Multi Accounts","Query Multi Accounts",""<endrec>
"CUSTOMER","","7","11303","2316","Customer Intra-Account Transfer Saving to Saving V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","3b","Check Mutil Accounts","Check Mutil Accounts",""<endrec>
"CUSTOMER","","2","11304","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
  __params.Amount = Util.replaceAll(input,',','.');
  __next = '2a';
  __exemode='continue';
}
else {
  __next = '1';
}","1","Input Amount","<html>
<body>Input Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","5","11305","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
                __params.Currency = __tempData.multiCurrencyCode.get(tmp);
                __next = '3a';
                __exemode='continue';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","11306","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess=__input.validateResult.isSucess;
         if(isSuccess) {
                __params.PrimaryAccountNo= __tempData.multiAccount.get(tmp).AccountNo;
                __next = '4a';
                __exemode='continue';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }","3","Choose From AccountNo","<html>
<body>
Please select Origin account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","11307","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess=__input.validateResult.isSucess;
         if(isSuccess) {
                __params.ReceiverAccountNo= __tempData.multiAccount.get(tmp).AccountNo;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }","4","Choose To AccountNo","<html>
<body>
Please select Destination account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11308","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","12","11309","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","11310","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to Intra_Account Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","11311","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","var input = __input.response;
if(empty(input)||size(input)>255){
    __next = '6';
}else
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","24","3","11312","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","__next='2b';
__exemode='continue';","2a","Query All Currency","Query All Currency",""<endrec>
"CUSTOMER","","4","11313","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying currencyCodes.';
   __next = 'error';
}","2b","Check All Currency","Check All Currency",""<endrec>
"CUSTOMER","29","6","11314","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'Saving accounts';
__committerParams.Currency = __params.Currency;
__next='3b';
__exemode='continue';","3a","Query Saving Accounts","Query Saving Accounts",""<endrec>
"CUSTOMER","","7","11315","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no saving account to query.';
       __next = 'error';
   }else {
      __next='3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","3b","Check Saving Accounts","Check Saving Accounts",""<endrec>
"CUSTOMER","","2","11316","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
  __params.Amount = Util.replaceAll(input,',','.');
  __next = '2a';
  __exemode='continue';
}
else {
  __next = '1';
}","1","Input Amount","<html>
<body>Input Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","5","11317","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
                __params.Currency = __tempData.multiCurrencyCode.get(tmp);
                __next = '3a';
                __exemode='continue';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","11318","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess=__input.validateResult.isSucess;
         if(isSuccess) {
                __params.PrimaryAccountNo= __tempData.multiAccount.get(tmp).AccountNo;
                __next = '4a';
                __exemode='continue';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }","3","Choose From AccountNo","<html>
<body>
Please select Origin account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","11319","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess=__input.validateResult.isSucess;
         if(isSuccess) {
                __params.ReceiverAccountNo= __tempData.multiAccount.get(tmp).AccountNo;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }","4","Choose To AccountNo","<html>
<body>
Please select Destination account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11320","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","12","11321","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","11322","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to Intra_Account Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","11323","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","var input = __input.response;
if(empty(input)||size(input)>255){
    __next = '6';
}else
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","24","3","11324","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","__next='2b';
__exemode='continue';","2a","Query All Currency","Query All Currency",""<endrec>
"CUSTOMER","","4","11325","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying currencyCodes.';
   __next = 'error';
}","2b","Check All Currency","Check All Currency",""<endrec>
"CUSTOMER","29","6","11326","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;
__next='3b';
__exemode='continue';","3a","Query M-pesa Accounts","Query M-pesa Accounts",""<endrec>
"CUSTOMER","","7","11327","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no m-pesa account to query.';
       __next = 'error';
   }else {
      __next='3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","3b","Check M-pesa Accounts","Check M-pesa Accounts",""<endrec>
"CUSTOMER","","2","11328","2325","Customer Intra-Account Transfer m-pesae to m-pesae V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
  __params.Amount = Util.replaceAll(input,',','.');
  __next = '2a';
  __exemode='continue';
}
else {
  __next = '1';
}","1","Input Amount","<html>
<body>Input Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","5","11329","2325","Customer Intra-Account Transfer m-pesae to m-pesae V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
                __params.Currency = __tempData.multiCurrencyCode.get(tmp);
                __next = '3a';
                __exemode='continue';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","11330","2325","Customer Intra-Account Transfer m-pesae to m-pesae V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess=__input.validateResult.isSucess;
         if(isSuccess) {
                __params.PrimaryAccountNo= __tempData.multiAccount.get(tmp).AccountNo;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }","3","Choose From AccountNo","<html>
<body>
Please select Origin account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","9","11331","2325","Customer Intra-Account Transfer m-pesae to m-pesae V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess=__input.validateResult.isSucess;
         if(isSuccess) {
                __params.ReceiverAccountNo= __tempData.multiAccount.get(tmp).AccountNo;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }","4","Choose To AccountNo","<html>
<body>
Please select Destination account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11332","2325","Customer Intra-Account Transfer m-pesae to m-pesae V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","10","11333","2325","Customer Intra-Account Transfer m-pesae to m-pesae V2.0","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","11334","2325","Customer Intra-Account Transfer m-pesae to m-pesae V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to Intra_Account Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","11335","2325","Customer Intra-Account Transfer m-pesae to m-pesae V2.0","var input = __input.response;
if(empty(input)||size(input)>255){
    __next = '6';
}else
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","24","3","11336","2325","Customer Intra-Account Transfer m-pesae to m-pesae V2.0","__next='2b';
__exemode='continue';","2a","Query All Currency","Query All Currency",""<endrec>
"CUSTOMER","","4","11337","2325","Customer Intra-Account Transfer m-pesae to m-pesae V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying currencyCodes.';
   __next = 'error';
}","2b","Check All Currency","Check All Currency",""<endrec>
"CUSTOMER","29","6","11338","2325","Customer Intra-Account Transfer m-pesae to m-pesae V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;
__next='3b';
__exemode='continue';","3a","Query Multi Accounts","Query Multi Accounts",""<endrec>
"CUSTOMER","","7","11339","2325","Customer Intra-Account Transfer m-pesae to m-pesae V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","3b","Check Mutil Accounts","Check Mutil Accounts",""<endrec>
"CUSTOMER","29","9","11340","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;
__next='4b';
__exemode='continue';","4a","Query M-pesa Accounts","Query M-pesa Accounts",""<endrec>
"CUSTOMER","","10","11341","2323","Customer Intra-Account Transfer Saving to m-pesae V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no m-pesa account to query.';
       __next = 'error';
   }else {
      __next='4';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","4b","Check M-pesa Accounts","Check M-pesa Accounts",""<endrec>
"CUSTOMER","29","9","11342","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'Saving accounts';
__committerParams.Currency = __params.Currency;
__next='4b';
__exemode='continue';","4a","Query Saving Accounts","Query Saving Accounts",""<endrec>
"CUSTOMER","","10","11343","2324","Customer Intra-Account Transfer m-pesae  to Saving V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no saving account to query.';
       __next = 'error';
   }else {
      __next='4';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","4b","Check Saving Accounts","Check Saving Accounts",""<endrec>
"CUSTOMER","63","2","11344","2320","Customer Online Cash In V2.0","__next='1b';
__exemode='continue';","1a","Query Defaul Sp Id","Query Defaul Sp Id",""<endrec>
"CUSTOMER","","3","11345","2320","Customer Online Cash In V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.defaultSpId=__input.lastCommitResult.result;
    __params.ReceiverPartyIdentifier = __tempData.defaultSpId;
    __next='1';
}else{
   __errormsg = 'Sorry,error occured when querying default Sp Id.';
   __next = 'error';
}","1b","Get Default Sp Id","Get Default Sp Id",""<endrec>
"CUSTOMER","55","5","11346","2320","Customer Online Cash In V2.0","__committerParams.IdentifierType=__params.InitiatorIdentifierType;
   __committerParams.IdentifierValue=__params.InitiatorIdentifier;
   __committerParams.PartnerBank='1';
   __next='2b';
   __exemode='continue';","2a","Query Bank Account List","Query Bank Account List",""<endrec>
"CUSTOMER","","6","11347","2320","Customer Online Cash In V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.bankAccounts=__input.lastCommitResult.result;
   if(empty(__tempData.bankAccounts)|| size(__tempData.bankAccounts)==0){
       __errormsg = 'Sorry, there is not any bank account.';
       __next = 'error';
   }else {
       __next = '2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying bank account.';
   __next = 'error';
}","2b","Check Bank Accounts List","Check Bank Accounts List",""<endrec>
"CUSTOMER","23","3","11348","2321","Customer Payment With Foreign Exchange V2.0","__committerParams.MSISDN =__IdentityInfo.msisdn;
__committerParams.IdentityType ='1000';
__next='2b';
__exemode='continue';","2a","Query Customer Beneficiary","Query Customer Beneficiary",""<endrec>
"CUSTOMER","","4","11349","2321","Customer Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.customerBeneficiaries= __input.lastCommitResult.result;
   if (empty(__tempData.customerBeneficiaries) || size(__tempData.customerBeneficiaries) == 0) {
      __errormsg = 'There is no beneficiary exist.';
      __next = 'error';
    } else {
       __next = '2';
    }
}else{
   __errormsg = 'Sorry,error occured when querying customer beneficiary.';
   __next = 'error';
}","2b","Check Customer Beneficiary","Check Customer Beneficiary",""<endrec>
"CUSTOMER","23","6","11350","2321","Customer Payment With Foreign Exchange V2.0","__committerParams.MSISDN =__IdentityInfo.msisdn;
__committerParams.IdentityType ='7000';
__next='3b';
__exemode='continue';","3a","Query Group Beneficiary","Query Group Beneficiary",""<endrec>
"CUSTOMER","","7","11351","2321","Customer Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.groupBeneficiaries= __input.lastCommitResult.result;
   if (empty(__tempData.groupBeneficiaries) || size(__tempData.groupBeneficiaries) == 0) {
      __errormsg = 'There is no beneficiary exist.';
      __next = 'error';
    } else {
       __next = '3';
    }
}else{
   __errormsg = 'Sorry,error occured when querying group beneficiary.';
   __next = 'error';
}","3b","Check Group Beneficiary","Check Group Beneficiary",""<endrec>
"CUSTOMER","24","14","11352","2321","Customer Payment With Foreign Exchange V2.0","__next='7b';
__exemode='continue';","7a","Query All Currency","Query All Currency",""<endrec>
"CUSTOMER","","15","11353","2321","Customer Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='7';
   }
}else{
   __errormsg = 'Sorry,error occured when querying foreign currencyCode.';
   __next = 'error';
}","7b","Check All Currency","Check All Currency",""<endrec>
"CUSTOMER","59","17","11354","2321","Customer Payment With Foreign Exchange V2.0","__next='8';
__exemode='continue';","8a","Query Default Currency","Query Default Currency",""<endrec>
"CUSTOMER","","18","11355","2321","Customer Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.defaultCurrencyCode =__input.lastCommitResult.result;
  if (__tempData.defaultCurrencyCode == __params.DestinationCurrency) {
    __next = '10a';
                __exemode='continue';
  } else {
    __next = '9';
  }
}else{
   __errormsg = 'Sorry,error occured when querying defaultCurrencyCode.';
   __next = 'error';
}","8","Check Select Currency","Check Select Currency",""<endrec>
"CUSTOMER","58","20","11356","2321","Customer Payment With Foreign Exchange V2.0","__next='10b';
__exemode='continue';","10a","Query Foreign Currency","Query Foreign Currency",""<endrec>
"CUSTOMER","","21","11357","2321","Customer Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiForeignCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiForeignCurrencyCode )|| size(__tempData.multiForeignCurrencyCode )==0){
       __errormsg = 'You have no currency to query.';
       __next = 'error';
   }else {
      __next='10';
   }
}else{
   __errormsg = 'Sorry,error occured when querying foreign currency.';
   __next = 'error';
}","10b","Check Foreign Currency","Check Foreign Currency",""<endrec>
"CUSTOMER","29","25","11358","2321","Customer Payment With Foreign Exchange V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;
__next='13b';
__exemode='continue';","13a","Query Multi Account","Query Multi Account",""<endrec>
"CUSTOMER","","26","11359","2321","Customer Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='13';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","13b","Check Multi Account","Check Multi Account",""<endrec>
"CUSTOMER","","29","11360","2321","Customer Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.rateInfo=__input.lastCommitResult.result;
    __next='15';
}else{
   __errormsg = 'Sorry,error occured when querying rateInfo.';
   __next = 'error';
}","15a","Check Fx Rate and Amount","Check Fx Rate and Amount",""<endrec>
"CUSTOMER","29","2","11361","2322","Customer Query an Account Balance via Handset V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.isForType=true;
__next='1b';
__exemode='continue';","1a","Query All Accounts","Query All Accounts",""<endrec>
"CUSTOMER","","3","11362","2322","Customer Query an Account Balance via Handset V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.accountTypeList = __input.lastCommitResult.result;
   if(empty(__tempData.accountTypeList )|| size(__tempData.accountTypeList )==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","1b","Check All Accounts","Check All Accounts",""<endrec>
"CUSTOMER","","1","11363","2326","Customer Reactivate Direct Debit Mandate V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = __msisdn;
__params.ActionType= 'ReactivateCustomerDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;
__params.MandateStatus = '04';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11364","2326","Customer Reactivate Direct Debit Mandate V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
__params.MandateID =  __tempData.mandateList.get(i).mandateId;
__params.PayeeName = __tempData.mandateList.get(i).payeeName;
__next = '2';
} else {
__next = '1';
}","1","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$mandateList=__tempData.mandateList;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11365","2326","Customer Reactivate Direct Debit Mandate V2.0","var input = __input.response;
var isSuccess=__input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '2';
} else {
    __params.@HEAD@PIN = input;
    __next = '3';
}","2","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","11366","2326","Customer Reactivate Direct Debit Mandate V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11371","2328","Customer Register Card V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'CustomerRegisterCard';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11372","2328","Customer Register Card V2.0","var input = __input.response;
if (empty(input)) {
    __next = '2';
} else {
  var isSuccess = __input.validateResult.isSucess;
        if (isSuccess) {
    var tmp = Util.toInt(input) - 1;
    __params.CardType = __tempData.cardTypes.get(tmp).code;
    __next = '3';
  } else {
    __next = '2';
  }
}","2","Select Card Type","<html>
<body>
Select Card Type :<br>
$$cardTypes=__tempData.cardTypes;
  $$var i = 1;
  $$for(cardType: cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11373","2328","Customer Register Card V2.0","var input = __input.response;
if (empty(input))
{
     __next = '3';
}
else
{
     __params.CardNumber = input;
     __next = '4';
}","3","Enter Card Number","<html>
<body>
Enter Card Number :<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11374","2328","Customer Register Card V2.0","var input = __input.response;
__params.CardExpiry = input;
__next = '5';","4","Enter Card Expiry","<html>
<body>
Enter Card Expiry :<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","11375","2328","Customer Register Card V2.0","var input = __input.response;
__params.CardHolderName = input;
__next = '6';","5","Enter Card Holder Name","<html>
<body>
Enter Card Holder Name :<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","11376","2328","Customer Register Card V2.0","var input = __input.response;
__params.CardIssueNumber = input;
__next = '7';","6","Enter Card Issue Number","<html>
<body>
Enter Card Issue Number:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11377","2328","Customer Register Card V2.0","var input = __input.response;
__params.ValidFrom = input;
__next = '8';","7","Enter Valid From","<html>
<body>
Enter Valid From:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11378","2328","Customer Register Card V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input)) {
    __params.@HEAD@PIN = input;
    __next = '9a';
    __exemode='continue';
} else {
    __next = '8';
}","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","13","11379","2328","Customer Register Card V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Register Customer Card.Card Type: ${__params.CardType}, Card Number:${__params.CardNumber}, Card Expiry:${__params.CardExpiry}, Card Holder Name:${__params.CardHolderName}, Card Issue Number:${__params.CardIssueNumber}, Valid From:${__params.ValidFrom}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11380","2329","Customer Remit V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = ""01"";
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = ""01"";
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = ""01"";
__next = '1';","begin","set parameters","",""<endrec>
"CUSTOMER","","2","11381","2329","Customer Remit V2.0","var input = __input.response;
if (!empty(input)) {
__params.RemitterCNIC=input;
__next='2';
} else {
  __next = '1';
}","1","Input Your CNIC","<html>
<body>Please Input Your CNIC:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","11382","2329","Customer Remit V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
__next = '3';
} else {
  __next = '2';
}","2","Input Remittee Phone Number","<html>
<body>
Please Input Remittee Phone Number:<br>
<a href=""|| chr(36) ||{__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","11383","2329","Customer Remit V2.0","var input = __input.response;
if (!empty(input)) {
__params.RemitteeCNIC = input;
__next = '4';
} else {
  __next = '4';
}","3","Input Remittee CNIC","<html>
<body>
Please Input Remittee CNIC:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11384","2329","Customer Remit V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess)
{
 __params.Amount = Util.replaceAll(input,',','.');
 __next = '5a';
 __exemode='continue';
}else {
 __next = '4';
}","4","Input Remit Amount","<html>
<body>
Input Remitt Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","8","11385","2329","Customer Remit V2.0","var input = __input.response;
if (!empty(input)) 
{
  var tmp = Util.toInt(input) - 1;
  var isSuccess = __input.validateResult.isSucess;
  if (isSuccess){
     type = __tempData.multiAccount.get(tmp);
     __params.InitiatorAccountNo= type.AccountNo;
     __next = '6';
  } else {
     __next = '5';
  }
}else{
   __next = '5';
}","5","Select Your Account","<html>
<body>
Please select Remitter account :<br>
$$var i = 1;
$$for(type: __tempData.multiAccount ) {
${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
$$  i = i+1;
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","9","11386","2329","Customer Remit V2.0","var input = __input.response;
__params.PIN = input;
__next = '7';","6","Input Your PIN","<html>
<body>
Input Your PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","11387","2329","Customer Remit V2.0","var input = __input.response;
if (input == '1') 
{
   __next = 'end';
}else if (input == '0') {
   __next = 'cancel';
} else {
   __next = '8';
}","8","Confirm","<html>
<body>Send Money ${__params.Amount} to ${__params.ReceiverPartyIdentifier}(CNIC:${__params.RemitteeCNIC}) <br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11388","2329","Customer Remit V2.0","var input = __input.response;
if (!empty(input) and size(input)> 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11389","2330","Customer Self Update KYC V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'ChangeCustKYC';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__tempData.ChangeLastName=false;  
__tempData.ChangeDOB=false;
__tempData.ChangeIDDetails=false;
__params.KYCInfo = Util.createMap();
__tempData.KYCMapRule = Util.createMap();
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11390","2330","Customer Self Update KYC V2.0","var input = __input.response;
if (input == '1') {
  __tempData.ChangeLastName=true;  
  __next = '2';
} else if (input == '2') {
  __tempData.ChangeDOB=true;
  __next = '3';
}else if (input == '3') {
  __tempData.ChangeIDDetails=true;
  __next = '4';
}else {
  __next = '1';
}","1","Select Update KYC","<html>
<body>
Select Receiver Type:<br>
1 LastName <br>
2 DOB <br>
3 ID Details <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","11391","2330","Customer Self Update KYC V2.0","var input = __input.response;
__tempData.LastName= input;
__params.KYCInfo.LastName = input;
__tempData.KYCMapRule.@simpleKYCFieldMap@1@key = 'LastName';
__tempData.KYCMapRule.@simpleKYCFieldMap@1@value = '[Personal Details][Last Name]';
__next = '6';","2","Enter Last Name","<html>
<body>
Enter Last Name<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","11392","2330","Customer Self Update KYC V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
   __tempData.Birthday= Util.convertDateFormat(input,'yyyyMMdd',null);
   __params.KYCInfo.Birthday =__tempData.Birthday;
   __tempData.KYCMapRule.@simpleKYCFieldMap@2@key = 'Birthday';
   __tempData.KYCMapRule.@simpleKYCFieldMap@2@value = '[Personal Details][Date of Birth]';
   __next='6';
} else {
  __next = '3';
}","3","Enter Date of Birth","<html>
<body>
Enter Date of Birth(yyyyMMdd)<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","12"<endrec>
"CUSTOMER","","5","11393","2330","Customer Self Update KYC V2.0","var input = __input.response;
if (input == '1') {
  __tempData.CertificateType = '01';
  __params.KYCInfo.CertificateType = '01'; /* National ID */
  __next = '5';
} else if (input == '2') {
  __tempData.CertificateType = '05';
  __params.KYCInfo.CertificateType = '05'; /* Passport */
  __next = '5';
} else {
  __next = '4';
}","4","Identification Type","<html>
<body>
Identification Type<br>
1  National ID<br>
2  Passport<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11394","2330","Customer Self Update KYC V2.0","var input = __input.response;
__tempData.CertificateNumber = input;
__params.KYCInfo.CertificateNumber = input;
__params.KYCInfo.isCondition = 'true';
 __tempData.KYCMapRule.@multipleKYCFieldMap@1@key = 'CertificateType';
 __tempData.KYCMapRule.@multipleKYCFieldMap@1@value = '[ID Details][ID Type]';
 __tempData.KYCMapRule.@multipleKYCFieldMap@2@key = 'CertificateNumber';
 __tempData.KYCMapRule.@multipleKYCFieldMap@2@value = '[ID Details][ID Number]';
__next = '6';","5","Enter ID Number","<html>
<body>
Enter ID Number<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","11395","2330","Customer Self Update KYC V2.0","var input = __input.response;
if (input == '1') {
  __next = '1';
} else if (input == '0') {
  __next = '7';
} else {
  __next = '6';
}","6","Continue Update Other KYC","<html><body>Continue Update Other KYC:<br>
1 YES<br>
0 NO<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","25","8","11396","2330","Customer Self Update KYC V2.0","var input = __input.response;
__params.@HEAD@PIN = input;
__committerParams.KYCMapRule = __tempData.KYCMapRule;
__committerParams.KYCInfo = __params.KYCInfo;
__next = '8a';
__exemode='continue';","7","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11397","2330","Customer Self Update KYC V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html><body>Customer ${__tempData.ChangeLastName==false?' ':__tempData.LastName}, ${__tempData.ChangeDOB==false?' ':__tempData.Birthday}, ${__tempData.ChangeIDDetails==false?' ':__tempData.CertificateNumber}<br>
${__params.KYCInfo}
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11398","2331","Customer Sell Foreign Currency V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '11'; /* SP SHORT CODE */
__params.ReceiverPartyIdentifier = '1';
__params.TransactionCategory = 'FX';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11399","2331","Customer Sell Foreign Currency V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
                __params.SourceCurrency =__tempData.multiCurrencyCode.get(tmp);
                __next = '2a';
                __exemode='continue';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }","1","Select Currency","<html>
<body>
Select the Foreign Currency to Sell :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","7","11400","2331","Customer Sell Foreign Currency V2.0","var input = __input.response;
if (input == '1') {
        __params.Currency = __params.SourceCurrency;
  __params.BaseCurrency = __params.SourceCurrency;
  __next = '3';
} else if (input == '2') {
        __params.Currency =  __tempData.defaultCurrencyCode ;
  __params.BaseCurrency = __tempData.defaultCurrencyCode ;
  __next = '3';
} else {
  __next = '2';
}","2","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.SourceCurrency} <br>
2 Input the amount in ${__tempData.defaultCurrencyCode}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","11401","2331","Customer Sell Foreign Currency V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
  __params.BaseAmount = Util.replaceAll(input,',','.');
  __next = '4a';
  __exemode='continue';
}
else {
 __next = '3';
}","3","Input Base Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","11","11402","2331","Customer Sell Foreign Currency V2.0","var input = __input.response;
  if (!empty(input)) {
    var tmp = Util.toInt(input) - 1;
                var isSuccess = __input.validateResult.isSucess;
    if (isSuccess) {
      type = __tempData.multiAccount.get(tmp);
      __params.SourceAccount = type.AccountNo;
      __next = '5';
    } else {
      __next = '4';
    }
  } else {
    __next = '4';
  }","4","Select Paying Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","11403","2331","Customer Sell Foreign Currency V2.0","__params.DestinationCurrency = __tempData.defaultCurrencyCode;
var input = __input.response;
__params.PIN = input;
__next = '6a';
__exemode='continue';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","11404","2331","Customer Sell Foreign Currency V2.0","if (__tempData.rateInfo.formatRate == null) {
  __next = 'error';
} else {
  var input = __input.response;
  if (input == '1') {
      __next = 'end';
  } else if(input == '0') {
      __next = 'cancel';
  } else {
      __next = '6';
  }
}","6","Confirm","<html>
<body>
$$rateInfo = __tempData.rateInfo;
You are going to sell [${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}],[${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}] will be credit to your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11405","2332","Customer Transfer from Bank to M-Pesa V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.BankCardOwnerInputType = '01'; /* MSISDN */
__params.BankCardOwnerInputValue = __msisdn;
__params.PrimaryPartyIdentifierType = '04';
__params.TransactionCategory = 'Bank_Card_Service';
__params.TransactionSubCategory = '0';
__params.QueryIdentifierType = '01'; /* MSISDN */
__params.QueryIdentifierValue = __msisdn;

__next = '1';
__exemode = 'continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11406","2332","Customer Transfer from Bank to M-Pesa V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
	__params.ShortCode = __tempData.fiOrgList.get(i).shortCode;
	__params.PrimaryPartyIdentifier = __params.ShortCode;
	__params.FIOrgIdentityId = __tempData.fiOrgList.get(i).identityId;
	__next = '3';
       __exemode = 'continue';
} else {
	__next = '2';
}","2","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: __tempData.fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","6","11407","2332","Customer Transfer from Bank to M-Pesa V2.0","if(__input.lastCommitResult.isSucess)
   {
     var isEnterBankAccount = __input.lastCommitResult.result;
      if (isEnterBankAccount) {
	__params.isEnterBankAccount = '2 Enter bank card <br>';
      } else {
	__params.isEnterBankAccount = '';
     }
    __next = '4';
   } else
   {
    __errormsg = 'Sorry, faild to check is allowed unlinked bank card.';
    __next = 'error'
   }","3a","check FIBankCardCheck","check FIBankCardCheck",""<endrec>
"CUSTOMER","","10","11408","2332","Customer Transfer from Bank to M-Pesa V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
   __params.BankCardId = __tempData.bankAccounts.get(i).bankCardId;
  __tempData.BankCardId = __params.BankCardId;
   __next = '10';
} else {
   __next = '6';
}","6","Select Bank Account","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: __tempData.bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","13","11409","2332","Customer Transfer from Bank to M-Pesa V2.0","__params.BankAccountNo = __input.response;
__tempData.BankCardId= __params.BankAccountNo;
bankCardAttrLisSize = size(__tempData.attrList );

if (bankCardAttrLisSize > 0)
{
  __tempData.attrIndex= 1;
  __tempData.InfoDetail= Util.createMap();
  __next = '9';
}
else
{
__next = '10';
}","8","Enter Bank Account","<html>
<body>
Enter Bank Account<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","18","11410","2332","Customer Transfer from Bank to M-Pesa V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '12';","11","Enter Receiver","<html>
<body>
Enter Receiver ${__tempData.identifierTypeName}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","19","11411","2332","Customer Transfer from Bank to M-Pesa V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input)||!isSuccess) {
    __next = '12';
} else {
       __params.Amount =Util.replaceAll(input,',','.');
    __next = '13';
}","12","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","20","11412","2332","Customer Transfer from Bank to M-Pesa V2.0","var input = __input.response;
__params.PIN = input;
__next = '14';","13","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","21","11413","2332","Customer Transfer from Bank to M-Pesa V2.0","var input = __input.response;
var length = size(input);
if (length > 255)
{
    __next = '14';
}
else
{
     __referenceData.Comment2Customer = input;
    __next = '15';
}","14","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","22","11414","2332","Customer Transfer from Bank to M-Pesa V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '15';
}","15","Confirm","<html>
<body>
Deposit Amount : ${__params.Amount}<br>
Bank Account :${__tempData.BankCardId}<br>
Reciever : ${__params.ReceiverPartyIdentifier}<br>
1 OK <br>
0 Cancel <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","11415","2332","Customer Transfer from Bank to M-Pesa V2.0","var input = __input.response;
if (!empty(input)) {
  __tempData.InfoDetail[__tempData.attrList[__tempData.attrIndex]]= input;

  __tempData.attrIndex = __tempData.attrIndex + 1;
  if(__tempData.attrIndex < size(__tempData.attrList)) {
    __next = '9';
  } else {
    __exemode = 'continue';
    __next = '9a';
  }
} else {
  __next = '9';
}","9","Enter Bank Card Attr","<html>
<body>
Enter ${__tempData.attrList[__tempData.attrIndex]}:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","17","11416","2332","Customer Transfer from Bank to M-Pesa V2.0","var input = __input.response;
if (input == '1') {
  __tempData.identifierTypeName = 'MSISDN';
  __params.ReceiverPartyIdentifierType = '01';   /* MSISDN */
  __next = '11';
} else if (input == '2') {
  __tempData.identifierTypeName = 'Organization Short Code';
  __params.ReceiverPartyIdentifierType = '04';   /* SHORT_CODE*/
  __next = '11';
}else if (input == '3') {
  __tempData.identifierTypeName = 'Group Code';
  __params.ReceiverPartyIdentifierType = '15';   /* GROUP_CODE*/
  __next = '11';
}  else {
  __next = '10';
}","10","Select Receiver Type","<html>
<body>
Select Receiver Type:<br>
1 Customer <br>
2 Organization <br>
3 Group <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11417","2333","Customer Transfer from M-Pesa to Bank V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '01';
__params.PrimaryPartyIdentifier = __msisdn;
__params.QueryIdentifierType = '01'; /* MSISDN */
__params.QueryIdentifierValue = __msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE*/
__params.TransactionCategory = 'Bank_Card_Service';
__params.TransactionSubCategory = '1';

__next = '1';
__exemode = 'continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","21","11426","2333","Customer Transfer from M-Pesa to Bank V2.0","var input = __input.response;
var length = size(input);
if (length > 255)
{
    __next = '14';
}
else
{
     __referenceData.Comment2Customer = input;
    __next = '15';
}","14","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html",""<endrec>
"CUSTOMER","","22","11427","2333","Customer Transfer from M-Pesa to Bank V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '15';
}","15","Confirm","<html>
<body>
Deposit Amount : ${__params.Amount}<br>
Bank Account :${__tempData.BankCardId}<br>
Reciever : ${__params.ReceiverPartyIdentifier}<br>
1 OK <br>
0 Cancel <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11429","2334","Customer change PIN V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'ChangePIN';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11430","2334","Customer change PIN V2.0","var input = __input.response;
__params.OldPIN = input;
__params.@HEAD@PIN = input;
__next = '2';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","11431","2334","Customer change PIN V2.0","var input = __input.response;
__params.NewPIN = input;
__next = '3';","2","Enter New PIN","<html>
<body>
Enter New PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","11432","2334","Customer change PIN V2.0","var input = __input.response;
if(__params.NewPIN == input)
{
__next = '4';
}
else
{
__next = '2';
}","3","Confirm new PIN","<html>
<body>
Confirm new PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11433","2334","Customer change PIN V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to change PIN?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11434","2335","Customer online withdraw e-money from float to bank account via handset V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01';   /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SP_ID */
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11435","2335","Customer online withdraw e-money from float to bank account via handset V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.Amount = Util.replaceAll(input,',','.');
    __next = '2a';
    __exemode='continue';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","7","11436","2335","Customer online withdraw e-money from float to bank account via handset V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if(isSuccess){
   bankAccounts=__tempData.bankAccounts;
   __params.BankCardID= bankAccounts.get(i).bankCardId;
   __params.BankAccountName= bankAccounts.get(i).accountName + '/' + bankAccounts.get(i).accountNumber + '(' + bankAccounts.get(i).bankName  + ')';
   __params.Currency=bankAccounts.get(i).currency;
   __next = '3';
} else {
   __next = '2';
}","2","Select Bank Card ID","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: __tempData.bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","11437","2335","Customer online withdraw e-money from float to bank account via handset V2.0","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11438","2335","Customer online withdraw e-money from float to bank account via handset V2.0","var input = __input.response;
if (!empty(input) and size(input) > 255)
{
    __next = '4';
}
else
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11439","2335","Customer online withdraw e-money from float to bank account via handset V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Withdraw Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountName}<br>
1 OK <br>
0 Cancel <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11440","2336","Customer pay bill V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
 __params.Currency = """";

__next = '0';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","11441","2336","Customer pay bill V2.0","__tempData.map=null;
var input = __input.response;
if (input == '1') {
  __next = '1a0';
  __exemode='continue';
} else if (input == '2') {
  __next = '2';
} else {
  __next = '0';
}","0","Selete Option","<html>
<body>
Please Select ShortCode :<br>
  1 Selete Beneficiary Short Code<br>
  2 Input Short Code<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","11442","2336","Customer pay bill V2.0","var input = __input.response;
 if (input != '0') {
	var i = Util.toInt(__input.response) - 1;
	var isSuccess = __input.validateResult.isSucess;
	if (isSuccess) {
		shortCode = __tempData.orglist.get(i);
		__params.ReceiverPartyIdentifier = shortCode;
                beforeCheckManual='SelectBeneficiaryShortCode';
		__next='3a';
        __exemode='continue';		
	}
} else {
	__next = '1';
}","1","Select Beneficiary ShortCode","<html>
<body>
Please Select Beneficiary ShortCode:<br>
$$ var index = 1;
$$ for (i: __tempData.orglist){
 ${index} : ${__tempData.orglist.get(index-1)} <br>
$$ index = index + 1;
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","11443","2336","Customer pay bill V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
   __next = '5';","2","Input Short Code","<html>
<body>
Input Short Code<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","75","16","11444","2336","Customer pay bill V2.0","var input = __input.response;
__params.BillReferenceNumber = input;
__params.put('TransOutgoingRequest@LIST@Param.BillReferenceNumber',__params.BillReferenceNumber);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode',__params.ReceiverPartyIdentifier);
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',__params.AccessDeviceIdentifier);

__committerParams.InterfaceCode='52';
__committerParams.ResponseCode='GOAQueryPayBillBillResponse';
__next='5a';
__exemode='continue';","5","Input Bill No","<html>
<body>
Input Bill No <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","18","11445","2336","Customer pay bill V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
   __params.ReasonTypeCode = reasonTypes.get(i).getAlias();
   __next = '7a';
   __exemode='continue';
} 
else {
   __next = '6';
}","6","Input Reason Type","<html>
<body>
$$test =empty(__tempData.map)?'':__tempData.map.get('test');
${test} Please select reason type:<br>
$$ var index = 1;
$$ for (reasonType : __tempData.reasonTypes) {
  ${index} ${reasonType.getDisplayName(__locale)}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","21","11446","2336","Customer pay bill V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
               type = __tempData.multiCurrencyCode.get(tmp);
                CurrencyCode =  type;
                __params.Currency = type;
                __next = '8';
         } else {
                __next = '7';
         }
    } else {
        __next = '7';
    }","7","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","22","11447","2336","Customer pay bill V2.0","var input = __input.response;
 var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    __params.Amount = Util.replaceAll(input,',','.');
    __next='9a';
    __exemode='continue';
} else {
    __next = '8';
}","8","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","25","11448","2336","Customer pay bill V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
               type = multiAccount.get(tmp);
                __params.InitiatorAccountNo = type.AccountNo;
                __next = '10';
         } else {
                __next = '9';
         }
    } else {
        __next = '9';
    }","9","Choose Inititator Account","<html>
<body>
Please Choose Inititator Account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","26","11449","2336","Customer pay bill V2.0","var input = __input.response;
__params.PIN = input;
__next = '11';","10","Input PIN","<html>
<body>
Input PIN :<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","33","11450","2336","Customer pay bill V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '12c';
}","12c","Confirm without Charge","<html>
<body>
$$formatAmount = Util.formatAmount(__params.Currency, __params.Amount);
To Pay ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${__tempData.orgName} for account number ${__params.BillReferenceNumber}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","27","11451","2336","Customer pay bill V2.0","var input = __input.response;
if (!empty(input) and size(input) > 255) 
{
    __next = '11';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '12a0';
    __exemode='continue';
}","11","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","11452","2336","Customer pay bill V2.0","var input = __input.response;
 if (!empty(input)) {
	var i = Util.toInt(__input.response) - 1;
	var isSuccess = __input.validateResult.isSucess;
	if (isSuccess) {
           orgBeneficiary= __tempData.orgBeneficiaries.get(i);
            __params.BillReferenceNumber = orgBeneficiary.BillReference;
            __next = '7a';
            __exemode='continue';	
	}
} else {
     __next = '4';
}","4","Select BillReference","<html>
<body>
Please Select Organization Beneficiary:<br>
$$ var index = 1;
$$ for (orgBeneficiary: __tempData.orgBeneficiaries){
 ${index} : ${orgBeneficiary.BeneficiaryShortCode} ${orgBeneficiary.BillReference} ${orgBeneficiary.BeneficiaryReference} <br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11453","2337","Customer query mini statements V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11454","2337","Customer query mini statements V2.0","var input = __input.response;
  var i = Util.toInt(input) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    accountTypes=__tempData.multiAccount.get(i);
    __params.AccountTypeCode = accountTypes.AccountType.AccountTypeAlias;
    __next = '2';
  } else {
    __next = '1';
  }","1","Select Account Type","<html>
<body>
Please select account:<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount) {
  ${i} ${type.AccountType.AccountTypeAlias}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11455","2337","Customer query mini statements V2.0","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11456","2337","Customer query mini statements V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11457","2338","Customer requests buy goods voucher V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReasonTypeCode = 'CustomerApplyBuyGoodsVoucher'; 
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","6","11458","2338","Customer requests buy goods voucher V2.0","var input = __input.response;
if(!empty(input) and (size(input)< __params.minLength  || size(input)> __params.maxLength))
{
__params.info = 'The length of a secret code must be in the range of [' + __params.minLength + ',' + __params.maxLength + '], please enter secret code again!';
__next = '1';
}
else if(!empty(__params.rule) and input !~ __params.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __params.rule + ', please enter secret code again!';
__next = '1';
}
else
{
__params.VoucherSecretCode = input;
__next = '2a';
__exemode='continue';
}","1","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11459","2338","Customer requests buy goods voucher V2.0","var input = __input.response;
if (!empty(input)) {
 var tmp = Util.toInt(input) - 2;
 if(tmp == '-1') {
    __next = '3';
    __params.ReceiverAccountNo= '';
 }else if(tmp>=0 and tmp<size(__tempData.multiAccount)) {
    type = __tempData.multiAccount.get(tmp);
    __params.ReceiverAccountNo= type.AccountNo;
    __next = '3';
 } else{
    __next = '2';
 }
} else {
  __next = '2';
}","2","Select Account","<html>
<body>
Please select account :<br>
 $$var i = 1;
 ${i} select no account<br>
 $$  i = i+1;
 $$for(type: __tempData.multiAccount ) {
 ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11460","2338","Customer requests buy goods voucher V2.0","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","11461","2338","Customer requests buy goods voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","4","Confirm","<html>
<body>
Confirm to requests buy goods voucher?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11462","2339","Customer withdraw e-money from float to bank account via handset V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01';   /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SP_ID */
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11463","2339","Customer withdraw e-money from float to bank account via handset V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.Amount = Util.replaceAll(input,',','.');
    __next = '2a';
    __exemode='continue';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","7","11464","2339","Customer withdraw e-money from float to bank account via handset V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if(isSuccess){
   bankAccounts=__tempData.bankAccounts;
   __params.BankCardID= bankAccounts.get(i).bankCardId;
   __params.BankAccountName= bankAccounts.get(i).accountName + '/' + bankAccounts.get(i).accountNumber + '(' + bankAccounts.get(i).bankName  + ')';
   __params.Currency=bankAccounts.get(i).currency;
   __next = '3';
} else {
   __next = '2';
}","2","Enter Bank Card ID","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: __tempData.bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","11465","2339","Customer withdraw e-money from float to bank account via handset V2.0","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11466","2339","Customer withdraw e-money from float to bank account via handset V2.0","var input = __input.response;
if (!empty(input) and size(input) > 255)
{
    __next = '4';
}
else
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11467","2339","Customer withdraw e-money from float to bank account via handset V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Withdraw Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountName}<br>
1 OK <br>
0 Cancel <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11468","2340","Delete Bank Account V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'DeleteIdentityBankAccount';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__exemode = 'continue';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","11469","2340","Delete Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = '4';
} else if(input == '0') {
  __next = '1';
} else {
  __next = '3';
}","3","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${__tempData.bankAccount.bankName}<br>
Branch:${__tempData.bankAccount.branchName}<br>
Account Name:${__tempData.bankAccount.accountName}<br>
Account Number:${__tempData.bankAccount.accountNumber}<br>
Currency:${__tempData.bankAccount.Currency}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","11470","2340","Delete Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
  __tempData.bankAccount =__tempData.bankAccountList.get(i);
  __params.BankCardId = __tempData.bankAccount.bankCardId;
  __next = '3';
} else {
  __next = '2';
}","2","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankAccount:__tempData.bankAccountList){
 ${index} ${bankAccount.accountName}/${bankAccount.accountNumber}(${bankAccount.Currency},${bankAccount.branchName})<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","6","11471","2340","Delete Bank Account V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!isSuccess ||  empty(input ))
{
    __next = '4';
} else {
   __params.@HEAD@PIN = input ;
    __next = '5';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11472","2340","Delete Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11473","2341","Delete Bank Card Lookup V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'DeleteIdentityBankCardLookup';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;

__params.QueryIdentifierType = '01';
__params.QueryIdentifierValue = __msisdn;

__exemode = 'continue';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","11474","2341","Delete Bank Card Lookup V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
	__tempData.bankLookup=__tempData.bankLookupList.get(i);
	__params.BankCardId = __tempData.bankLookup.BankCardId;
	__next = '3';
} else {
	__next = '2';
}","2","Select Bank Card Lookup","<html>
<body>
Select Bank Card Lookup:<br>
$$ var index = 1;
$$ for (bankLookup:__tempData.bankLookupList){
 ${index} ${bankLookup.AccountName}/${bankLookup.AccountNumber}(${bankLookup.BankBranchName})<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11475","2341","Delete Bank Card Lookup V2.0","var input = __input.response;
if (input == '1') {
  __next = '4';
} else if(input == '0') {
  __next = '2';
} else {
  __next = '3';
}","3","Confirm Bank Card Lookup","<html>
<body>
Confirm Bank Card Lookup<br><br>
Bank:${__tempData.bankLookup.BankName}<br>
Bank Branch:${__tempData.bankLookup.BankBranchName}<br>
Lookup Name:${__tempData.bankLookup.AccountName}<br>
Lookup Card No.:${__tempData.bankLookup.AccountNumber}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11476","2341","Delete Bank Card Lookup V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!isSuccess ||  empty(input ))
{
    __next = '4';
} else {
   __params.@HEAD@PIN = input ;
    __next = '5';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11477","2341","Delete Bank Card Lookup V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11478","2342","Delete Beneficiary V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier =__msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.ActionType= 'DeleteCustomerBeneficiary';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;
__next = '1a';
__exemode='continue';","begin","set parammeters","",""<endrec>
"CUSTOMER","","11","11479","2342","Delete Beneficiary V2.0","var input = __input.response;
if(input == 1) {
 __next = 'end';
}else {
 __next = 'cancel';
}","6","Confirm","<html>
<body>
 Confirm to delete beneficiary ${__params.BeneficiaryName}<br>
1 OK  <br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11480","2342","Delete Beneficiary V2.0","__params.@HEAD@PIN = __input.response;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11481","2342","Delete Beneficiary V2.0","var i = Util.toInt(__input.response) - 1;
var custBenefSize=size(__tempData.custBeneficiaries);
var orgBenefSize=size(__tempData.orgBeneficiaries);
var groupBenefSize=size(__tempData.groupBeneficiaries);

 if (i >= 0 and i < custBenefSize){
    __tempData.beneficiary= __tempData.custBeneficiaries.get(i);
    __params.ActionType= 'DeleteCustomerBeneficiary';
    __params.BeneficiaryIdentifier = __tempData.beneficiary.BeneficiaryMsisdn;
    __params.BeneficiaryName= __tempData.beneficiary.BeneficiaryName;
    __params.BeneficiaryReference = __tempData.beneficiary.BeneficiaryReference;
    __next = '5';
 }
 else if (i >= custBenefSize  and  i < orgBenefSize + custBenefSize){
    __tempData.beneficiary= __tempData.orgBeneficiaries.get(i - custBenefSize);
    __params.ActionType= 'DeleteOrgBeneficiary';
	__params.BillReference = __tempData.beneficiary.BillReference;
    __params.BeneficiaryIdentifier =__tempData.beneficiary.BeneficiaryShortCode;
	__params.BeneficiaryName= __tempData.beneficiary.BeneficiaryName;
    __params.BeneficiaryReference = __tempData.beneficiary.BeneficiaryReference;
	__next = '5';
 }
 else if (i >= orgBenefSize + custBenefSize  and  i < orgBenefSize + custBenefSize +  groupBenefSize){
    __tempData.beneficiary= __tempData.groupBeneficiaries.get(i - custBenefSize - orgBenefSize);
    __params.ActionType= 'DeleteGroupBeneficiary';
    __params.BeneficiaryIdentifier = __tempData.beneficiary.BeneficiaryGroupCode;

	__params.BeneficiaryName= __tempData.beneficiary.BeneficiaryName;
    __params.BeneficiaryReference = __tempData.beneficiary.BeneficiaryReference;
    __next = '5';
 }else {
    __next = '4';
}","4","Select Beneficiaries","<html>
<body>
Please Select Beneficiary:<br>
$$ var index = 1;
$$custBeneficiaries=__tempData.custBeneficiaries;
$$orgBeneficiaries=__tempData.orgBeneficiaries;
$$groupBeneficiaries=__tempData.groupBeneficiaries;
$$if(!empty(custBeneficiaries) and size(custBeneficiaries)>0){
   $$ for (custBeneficiary:custBeneficiaries){
    ${index} ${custBeneficiary.BeneficiaryName} ${custBeneficiary.BeneficiaryMsisdn} ${custBeneficiary.BeneficiaryReference}<br>
   $$ index = index + 1;
   $$ }
$$}
$$if(!empty(orgBeneficiaries) and size(orgBeneficiaries)>0){
   $$ for (orgBeneficiary: orgBeneficiaries){
    ${index} ${orgBeneficiary.BeneficiaryName} ${orgBeneficiary.BillReference} ${orgBeneficiary.BeneficiaryReference}<br>
   $$ index = index + 1;
   $$ }
$$}
$$if(!empty(groupBeneficiaries) and size(groupBeneficiaries)>0){
   $$ for (groupBeneficiary: groupBeneficiaries){
    ${index} ${groupBeneficiary.BeneficiaryName} ${groupBeneficiary.BeneficiaryGroupCode} ${groupBeneficiary.BeneficiaryReference}<br>
   $$ index = index + 1;
   $$ }
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11482","2343","Delete Group Bank Account V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'DeleteIdentityBankAccount';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__exemode = 'continue';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","11483","2343","Delete Group Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = '3';
} else if (input == '2') {
  __next = '4'
} else {
  __next = '2';
}","2","Select Group Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11484","2343","Delete Group Bank Account V2.0","var input = __input.response;
var found = '0';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: __tempData.groups){
if(group.groupCode == input)
{
  found = '1';
}
}
if ( found == '0') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   __exemode = 'continue';
   __next = '5';
}
}
 else {
      __next = '3';
}","3","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","11485","2343","Delete Group Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
	__tempData.bankAccount =__tempData.bankAccountList.get(i);
	    __params.BankCardId = __tempData.bankAccount.bankCardId;
	__next = '8';
} else {
	__next = '7';
}","7","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankAccount:__tempData.bankAccountList){
 ${index} ${bankAccount.accountName}/${bankAccount.accountNumber}(${bankAccount.Currency},${bankAccount.branchName})<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","6","11486","2343","Delete Group Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __exemode = 'continue';
  __next = '5';
}
else{
  __next = '4';
}","4","Select Group","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","11487","2343","Delete Group Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = '9';
} else if(input == '0') {
  __next = '7';
} else {
  __next = '8';
}","8","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${__tempData.bankAccount.bankName}<br>
Branch:${__tempData.bankAccount.branchName}<br>
Account Name:${__tempData.bankAccount.accountName}<br>
Account Number:${__tempData.bankAccount.accountNumber}<br>
Currency:${__tempData.bankAccount.Currency}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","11488","2343","Delete Group Bank Account V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!isSuccess ||  empty(input ))
{
    __next = '9';
} else {
   __params.@HEAD@PIN = input ;
    __next = '10';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","14","11489","2343","Delete Group Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11490","2344","Disable CNS V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'ChangeCustCNSKYCFlag';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__params.CNSInitiatorFlag='02';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11491","2344","Disable CNS V2.0","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '2';
__exemode = 'continue';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11492","2344","Disable CNS V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
You are going to disable customer name search feature.<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11493","2345","Enable CNS V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'ChangeCustCNSKYCFlag';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__params.CNSInitiatorFlag='01';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11494","2345","Enable CNS V2.0","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '2';
__exemode = 'continue';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11495","2345","Enable CNS V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
You are going to enable customer name search feature.<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11496","2346","Group ATM Deposit Voucher V2.0","__params.ServiceCode = __serviceCode;
__params.VoucherServiceType = '2'; /* VoucherServiceType */ 
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group*/ 
__params.ReasonTypeCode = 'Apply Group ATM Deposit Voucher'; 
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","11497","2346","Group ATM Deposit Voucher V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.ReceiverPartyIdentifier = input;
    __next = '2a'; 
    __exemod='continue';
} 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","5","11498","2346","Group ATM Deposit Voucher V2.0","var input=__input.response;
 var isSuccess = __input.validateResult.isSucess;
if(!empty(input)){
   var i = Util.toInt(input) - 1;
   if (isSuccess){
     __tempData.providerName= __tempData.atmProviders.get(i);
     __next = '2c';
     __exemode='continue';
  } else {
     __next = '2';
  }
}else{
  __next='2';
}","2","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: __tempData.atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","11499","2346","Group ATM Deposit Voucher V2.0","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11500","2346","Group ATM Deposit Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
ATM Provider - ${__tempData.providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11501","2347","Group ATM Withdraw Voucher V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group */ 
__params.ReasonTypeCode = 'Apply Group ATM Withdraw Voucher'; 
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","11502","2347","Group ATM Withdraw Voucher V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.ReceiverPartyIdentifier = input;
    __next = '2a'; 
    __exemod='continue';
} 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","5","11503","2347","Group ATM Withdraw Voucher V2.0","var input=__input.response;
if(!empty(input)){
   var i = Util.toInt(input) - 1;
   var isSuccess = __input.validateResult.isSucess;
   if (isSuccess){
     __tempData.providerName= __tempData.atmProviders.get(i);
     __next = '2c';
     __exemode='continue';
  } else {
     __next = '2';
  }
}else{
  __next='2';
}","2","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: __tempData.atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","11504","2347","Group ATM Withdraw Voucher V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.VoucherAmount=input;
    __next = '4';
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","10","11505","2347","Group ATM Withdraw Voucher V2.0","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","11506","2347","Group ATM Withdraw Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
ATM Provider - ${__tempData.providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11507","2347","Group ATM Withdraw Voucher V2.0","var input = __input.response;
__params.Remark = input;
__next = '5';","4","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11508","2348","Group Activate Card V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ActionType = 'GroupActivateCard';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;

__next = '1a';
__exemode = 'continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11509","2348","Group Activate Card V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
  if (empty(__tempData.groups) || size(__tempData.groups) == 0) {
    __errormsg = 'Sorry, there is no groups.';
    __next = 'error';
  } else {
    __next = '2b';
  }
} else {
  __next = '2';
}","2","select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11510","2348","Group Activate Card V2.0","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
    for(group: __tempData.groups) {
        if(group.groupCode == input) {
            found = '0';
        }
    }
    if ( found == '1') {
        __errormsg = 'No current group or not belong to the group.';
        __next = 'error';
    } else {
        __next = '2c';
        __exemode = 'continue';
    }
} else {
        __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11511","2348","Group Activate Card V2.0","var i = Util.toInt(__input.response) - 1;
var isSucess = __input.validateResult.isSucess;
 if (isSucess) {
    var group = __tempData.groups.get(i);
    var groupCode = group.groupCode;
    __params.ReceiverPartyIdentifier = groupCode;
    __next = '2c';
    __exemode = 'continue';
} else {
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","11512","2348","Group Activate Card V2.0","var input = __input.response;
var isSucess = __input.validateResult.isSucess;

if (empty(input)) {
    __next = '4';
} else {
    var tmp = Util.toInt(input) - 1;
    if(isSucess) {
        __tempData.cardType = __tempData.cardTypes.get(tmp);
        var code = __tempData.cardType.code;
        __params.CardType = code;
        __secure = true;
        __next = '5';
    } else {
        __next = '4';
    }
}","4","Select Card Type","<html>
<body>
Select Card Type :<br>
  $$var i = 1;
  $$for(cardType : __tempData.cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","13","11513","2348","Group Activate Card V2.0","var input = __input.response;
var isSucess = __input.validateResult.isSucess;
if (!empty(input) and isSucess) {
 __params.@HEAD@PIN = input;
    __next = '7';
} else {
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","14","11514","2348","Group Activate Card V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html><body>Activate Group Card.Card Type: ${__params.CardType},Card Number: ${__params.CardNumber}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","11515","2348","Group Activate Card V2.0","var input = __input.response;
var isSucess = __input.validateResult.isSucess;
if (empty(input)) {
     __next = '5';
} else {
     var tmp = Util.toInt(input) - 1;
     if(isSucess) {
         var cardNumber = __tempData.cardNumbers.get(tmp);
         __params.CardNumber = cardNumber;
         __next = '6';
     } else {
          __next = '5';
     }
}","5","Select Card Number","<html>
<body>
Select Card Number :<br>
$$ __tempData.cardNumbers = __tempData.cardType.cardNumbers;
$$if (empty(__tempData.cardNumbers)) {
  You have no Card Number.
$$} else {
  $$var i = 1;
  $$for(cardNumber: __tempData.cardNumbers) {
  ${i} ${cardNumber}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11516","2349","Group Activate Direct Debit Mandate V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.RequesterIdentifierType = ""01"";
__params.RequesterIdentifier = __msisdn;
__params.ActionType = 'ActivateGroupDirectDebitMandate';
__params.MandateStatus = '02';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11517","2349","Group Activate Direct Debit Mandate V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if(!empty(input)){
   var found = '1';
   for (group: __tempData.groups) {
    if (group.groupCode == input) {
      found = '0';
    }
  }
    if (found == '1') {
    __errormsg = 'no current group or not belong to the group.';
    __next = 'error';
  } else {
    __next='2a';
                __exemode='continue';
  }
}else {
       __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","11518","2349","Group Activate Direct Debit Mandate V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
__params.MandateID =  __tempData.mandateList.get(i).mandateId;
__next = '3';
} else {
__next = '2';
}","2","Enter Mandate ID","<html>
<body>
Select Mandate ID<br>
$$ var index = 1;
$$ for (mandate: __tempData.mandateList) {
    ${index}  ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","11519","2349","Group Activate Direct Debit Mandate V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess)
{
__params.AgreedTC= input ;
 __next = '4';
}
else {
 __next = '3';
}","3","Select AgreedTC","<html>
<body>
Select Agreed Terms and Conditions<br>
0 No<br>
1 Yes<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","9","11520","2349","Group Activate Direct Debit Mandate V2.0","var input = __input.response;
if(empty(input))
{
__next = '5';
}else if (size(input) < 64) {
 __params.PayerAccountName = input;
__next = '5';
} else {
  __next = '4';
}","4","Enter Payer Account Name","<html>
<body>Enter Payer Account Name<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11521","2349","Group Activate Direct Debit Mandate V2.0","var input = __input.response;
if (!empty(input) ) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else { 
    __next = '5';
}","5","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html",""<endrec>
"CUSTOMER","","11","11522","2349","Group Activate Direct Debit Mandate V2.0","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '6';
}","6","Confirm","<html>
<body>
Confirm to Activate Direct Debit Mandate?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11523","2350","Group Buy Foreign Currency V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '11'; /* SP SHORT CODE */
__params.ReceiverPartyIdentifier = '1';
__params.TransactionCategory = 'FX';

__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11524","2350","Group Buy Foreign Currency V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
  __next = '1a';
  __exemode='continue';
} else {
  __next = '1';
}","1","Group","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11525","2350","Group Buy Foreign Currency V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
     __params.PrimaryPartyIdentifier = input;
     __next = '3a';
     __exemode='continue';
   }
else{
    __next = '2a';
}","2a","Input Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","11526","2350","Group Buy Foreign Currency V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3a';
  __exemode='continue';
}
else{
  __next = '2b';
}","2b","Select My Group","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","9","11527","2350","Group Buy Foreign Currency V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
                __params.DestinationCurrency =__tempData.multiCurrencyCode.get(tmp);
                __next = '4a';
                __exemode='continue';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }","3","Select Currency","<html>
<body>
Select the Foreign Currency to Buy :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","11528","2350","Group Buy Foreign Currency V2.0","var input = __input.response;
if (input == '1') {
        __params.Currency = __params.DestinationCurrency;
  __params.BaseCurrency = __params.DestinationCurrency;
  __next = '5';
} else if (input == '2') {
        __params.Currency =  __tempData.defaultCurrencyCode ;
  __params.BaseCurrency = __tempData.defaultCurrencyCode ;
  __next = '5';
} else {
  __next = '4';
}","4","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.DestinationCurrency} <br>
2 Input the amount in ${__tempData.defaultCurrencyCode}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","11529","2350","Group Buy Foreign Currency V2.0","__params.SourceCurrency =  __tempData.defaultCurrencyCode ;
var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
  __params.BaseAmount = Util.replaceAll(input,',','.');
  __next = '6a';
  __exemode='continue';
}
else {
 __next = '5';
}","5","Input Base Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","16","11530","2350","Group Buy Foreign Currency V2.0","var input = __input.response;
  if (!empty(input)) {
    var tmp = Util.toInt(input) - 1;
                var isSuccess = __input.validateResult.isSucess;
    if (isSuccess) {
      type = __tempData.multiAccount.get(tmp);
      __params.SourceAccount = type.AccountNo;
      __next = '7';
    } else {
      __next = '6';
    }
  } else {
    __next = '6';
  }","6","Select Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","17","11531","2350","Group Buy Foreign Currency V2.0","var input = __input.response;
__params.PIN = input;
__next = '8a';
__exemode='continue';","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","20","11532","2350","Group Buy Foreign Currency V2.0","if (__tempData.rateInfo.formatRate == null) {
  __next = 'error';
} else {
var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}
}","8","Confirm","<html>
<body>
$$rateInfo = __tempData.rateInfo;
You are going to buy [${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}],[${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}] will be debited from your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11533","2351","Group Cancel Card V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ActionType = 'GroupCancelCard';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;

__next = '1a';
__exemode = 'continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11534","2351","Group Cancel Card V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
  if (empty(__tempData.groups) || size(__tempData.groups) == 0) {
    __errormsg = 'Sorry, there is no groups.';
    __next = 'error';
  } else {
    __next = '2b';
  }
} else {
  __next = '2';
}","2","select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11535","2351","Group Cancel Card V2.0","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
    for(group: __tempData.groups) {
        if(group.groupCode == input) {
            found = '0';
        }
    }
    if ( found == '1') {
        __errormsg = 'No current group or not belong to the group.';
        __next = 'error';
    } else {
        __next = '2c';
        __exemode = 'continue';
    }
} else {
        __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11536","2351","Group Cancel Card V2.0","var i = Util.toInt(__input.response) - 1;
var isSucess = __input.validateResult.isSucess;
 if (isSucess) {
    var group = __tempData.groups.get(i);
    var groupCode = group.groupCode;
    __params.ReceiverPartyIdentifier = groupCode;
    __next = '2c';
    __exemode = 'continue';
} else {
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","11537","2351","Group Cancel Card V2.0","var input = __input.response;
var isSucess = __input.validateResult.isSucess;
if (empty(input)) {
    __next = '4';
} else {
    var tmp = Util.toInt(input) - 1;
    if(isSucess) {
        __tempData.cardType = __tempData.cardTypes.get(tmp);
        var code = __tempData.cardType.code;
        __params.CardType = code;
        __next = '5';
    } else {
        __next = '4';
    }
}","4","Select Card Type","<html>
<body>
Select Card Type :<br>
  $$var i = 1;
  $$for(cardType : __tempData.cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","13","11538","2351","Group Cancel Card V2.0","var input = __input.response;
var isSucess = __input.validateResult.isSucess;

if (!empty(input) and isSucess) {
 __params.@HEAD@PIN = input;
    __next = '7';
} else {
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","14","11539","2351","Group Cancel Card V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html><body>Cancel Group Card.Card Type: ${__params.CardType},Card Number: ${__params.CardNumber}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","11540","2351","Group Cancel Card V2.0","var input = __input.response;
var isSucess = __input.validateResult.isSucess;
if (empty(input)) {
     __next = '5';
} else {
     var tmp = Util.toInt(input) - 1;
     if(isSucess) {
         var cardNumber = __tempData.cardNumbers.get(tmp);
         __params.CardNumber = cardNumber;
         __next = '6';
     } else {
          __next = '5';
     }
}","5","Select Card Number","<html>
<body>
Select Card Number :<br>
$$ __tempData.cardNumbers = __tempData.cardType.cardNumbers;
$$if (empty(__tempData.cardNumbers)) {
  You have no Card Number.
$$} else {
  $$var i = 1;
  $$for(cardNumber: __tempData.cardNumbers) {
  ${i} ${cardNumber}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11541","2352","Group Cancel Direct Debit Mandate V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = __msisdn;
__params.ActionType = 'CancelGroupDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.RequesterIdentifierType = ""01"";
__params.RequesterIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.MandateStatus = '02,03';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11542","2352","Group Cancel Direct Debit Mandate V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
  __next = '1a';
  __exemode='continue';
} else {
  __next = '1';
}","1","select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11543","2352","Group Cancel Direct Debit Mandate V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if(!empty(input)){
   var found = '1';
   for (group: __tempData.groups) {
    if (group.groupCode == input) {
      found = '0';
    }
  }
    if (found == '1') {
    __errormsg = 'no current group or not belong to the group.';
    __next = 'error';
  } else {
    __next='4a';
    __exemode='continue';
  }
}else {
       __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11544","2352","Group Cancel Direct Debit Mandate V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.ReceiverPartyIdentifier = __tempData.groups.get(i).groupCode;
    __next='3a';
    __exemode='continue';
}
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","11545","2352","Group Cancel Direct Debit Mandate V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
__params.MandateID =  __tempData.mandateList.get(i).mandateId;
__params.PayeeName =  __tempData.mandateList.get(i).payeeName;
__next = '6';
} else {
__next = '5';
}","5","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: __tempData.mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","11546","2352","Group Cancel Direct Debit Mandate V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '6';
} else {
    __params.@HEAD@PIN = input;
    __next = '7';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","13","11547","2352","Group Cancel Direct Debit Mandate V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11548","2353","Group Edit Direct Debit Mandate V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = __msisdn;
__params.ActionType = 'EditGroupDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.RequesterIdentifierType = ""01"";
__params.RequesterIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.MandateStatus = '02,03';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11549","2353","Group Edit Direct Debit Mandate V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
  __next = '2b';
} else {
  __next = '1';
}","1","select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11550","2353","Group Edit Direct Debit Mandate V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if(!empty(input)){
   var found = '1';
   for (group: __tempData.groups) {
    if (group.groupCode == input) {
      found = '0';
    }
  }
    if (found == '1') {
    __errormsg = 'no current group or not belong to the group.';
    __next = 'error';
  } else {
    __next='4a';
    __exemode='continue';
  }
}else {
       __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11551","2353","Group Edit Direct Debit Mandate V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.ReceiverPartyIdentifier = __tempData.groups.get(i).groupCode;
    __next='3a';
    __exemode='continue';
}
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","11552","2353","Group Edit Direct Debit Mandate V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
__params.MandateID =  __tempData.mandateList.get(i).mandateId;
__params.PayeeName =  __tempData.mandateList.get(i).payeeName;
__next = '6';
} else {
__next = '5';
}","5","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: __tempData.mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","13","11553","2353","Group Edit Direct Debit Mandate V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '7';
} else {
    __params.@HEAD@PIN = input;
    __next = '8';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","14","11554","2353","Group Edit Direct Debit Mandate V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","11555","2353","Group Edit Direct Debit Mandate V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '6';
} else {
    __params.AgreedTC = input;
    __next = '7';
}","6","Agreed TC","<html>
<body>Please Select you have Agreed T:<br>
1 yes<br>
0 no<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","1","11577","2357","Group G2G Transfer V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group Code */
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","11578","2357","Group G2G Transfer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
     __params.PrimaryPartyIdentifier= input;
     __next = '3';
}
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","8","11579","2357","Group G2G Transfer V2.0","var input = __input.response;
 var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
     __params.ReceiverPartyIdentifier = input;
     __next = '5';
   }
else{
    __next = '4a';
}","4a","Enter Recipient Group Code","<html>
<body>
Enter Recipient Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","12","11580","2357","Group G2G Transfer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.Amount =input;
    __next = '6';
} else {
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","13","11581","2357","Group G2G Transfer V2.0","var input = __input.response;
__params.Remark = input;
__next = '7';","6","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","11582","2357","Group G2G Transfer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.PIN = input;
    __next = '8';
} else {
    __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","16","11583","2357","Group G2G Transfer V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","11584","2357","Group G2G Transfer V2.0","var input = __input.response;
if (!empty(input) and size(input)> 255)
{
    __next = '8';
}
else
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","11585","2357","Group G2G Transfer V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
  __next = '2b0';
        __exemode='continue';
} else {
  __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11586","2357","Group G2G Transfer V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group=  __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier= groupCode;
  __next = '3';
}
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","7","11587","2357","Group G2G Transfer V2.0","var input = __input.response;
if (input == '1') {
  __next = '4a';
} else if (input == '2') {
  __next = '4b0';
  __exemode='continue';
} else {
  __next = '3';
}","3","Select Option(Recipient)","<html>
<body>
Please select option: <br>
1 Enter Recipient Group Code<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","11588","2357","Group G2G Transfer V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  beneficiary= __tempData.beneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
  __next = '5';
}
else{
  __next = '4b';
}","4b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: __tempData.beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11589","2358","Group G2G Transfer With Prevalidation V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group Code */
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","11590","2358","Group G2G Transfer With Prevalidation V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
     __params.PrimaryPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","8","11591","2358","Group G2G Transfer With Prevalidation V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
     __params.ReceiverPartyIdentifier = input;
     __next = '5';     
   } 
else{
    __next = '4a';
}","4a","Enter Recipient Group Code","<html>
<body>
Enter Recipient Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","12","11592","2358","Group G2G Transfer With Prevalidation V2.0","var input = __input.response;
var isSuccess=__input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.Amount = input;
    __next = '6';
} else {
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","13","11593","2358","Group G2G Transfer With Prevalidation V2.0","var input = __input.response;
__params.Remark = input;
__next = '7';","6","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","11594","2358","Group G2G Transfer With Prevalidation V2.0","var input = __input.response;
if (!empty(input) and size(input) > 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","11595","2358","Group G2G Transfer With Prevalidation V2.0","var input = __input.response;
if (input == '1') {
   __next = '2a';
} else if (input == '2') {
   __next = '2b0';
   __exemode='continue'; 
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11596","2358","Group G2G Transfer With Prevalidation V2.0","var input=__input.response;
if(!empty(input)){
 var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}
}else{
  __next='2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","7","11597","2358","Group G2G Transfer With Prevalidation V2.0","var input = __input.response;
if (input == '1') {
  __next = '4a';
} else if (input == '2') {
  __next = '4b0';
  __exemode='continue';
} else {
  __next = '3';
}","3","Select Option(Recipient)","<html>
<body>
Please select option: <br>
1 Enter Recipient Group Code<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","11598","2358","Group G2G Transfer With Prevalidation V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
  beneficiary= __tempData.beneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
  __next = '5';
} 
else{
  __next = '4b';
}","4b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: __tempData.beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","15","11599","2358","Group G2G Transfer With Prevalidation V2.0","var input = __input.response;
if (input == '1') {
  __next = '9';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm Information","<html>
<body>
Transaction Information:<br>
Group Code : ${__params.PrimaryPartyIdentifier}<br>
Recipient Group Code : ${__params.ReceiverPartyIdentifier}<br>
Amount : ${__params.Amount}<br>
Remark : ${__params.Remark}<br>
Comment  : ${__referenceData.Comment2Customer}<br>
Press 1 to confirm or 0 to cancel:<br>
1 Submit <br>
0 Cancel <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","11600","2358","Group G2G Transfer With Prevalidation V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.PIN = input;
    __next = '10';
} else {
    __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","17","11601","2358","Group G2G Transfer With Prevalidation V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
__tempData.notificationParams = Util.createMap();
if (isSuccess){
  if (input == '1'){
    __next='10a';
    __exemode='continue';
  }else if (input == '2') {
    __next = '12';
  }
}else{
  __next = '10';
}","10","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","24","11602","2358","Group G2G Transfer With Prevalidation V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
  __params.OperationType= input ;
  if(input == '1'){
     __next = '12';
  }else if (input == '2') {
     __params.EventType=""PRE_VALIDATION"";
     __params.Reason=""Rejected"";
     __errormsg = 'You have chosed to reject transation,Please check notification.';
     __next='11a1';
     __exemode='continue';
  }
}else{
  __next = '11';
}","11","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__tempData.promptMsg}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","28","11603","2358","Group G2G Transfer With Prevalidation V2.0","var input = __input.response;
if (input == '1') {
  __params.EventType=""PRE_VALIDATION"";
  __params.Reason=""Continue Pre-Validation Transaction"";
  __next = '11a';
  __exemode='continue';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '12';
}","12","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","30","11604","2358","Group G2G Transfer With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
    __next = 'error';
}else{
   __errormsg = 'Sorry,send pre-validation notification failed.';
   __next = 'error';
}","13b","Check Send PreValidation Notification","Check Send PreValidation Notification",""<endrec>
"CUSTOMER","","1","11605","2359","Group G2P Transfer V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","11606","2359","Group G2P Transfer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
     __params.PrimaryPartyIdentifier = input;
     __next = '3';
}
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11607","2359","Group G2P Transfer V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '4';","3","Enter Recipient MSISDN","<html>
<body>
Enter Recipient MSISDN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","11608","2359","Group G2P Transfer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.Amount = input;
    __next = '5';
} else {
    __next = '4';
}","4","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","9","11609","2359","Group G2P Transfer V2.0","var input = __input.response;
__params.Remark = input;
__next = '6';","5","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11610","2359","Group G2P Transfer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.PIN = input;
    __next = '7';
} else {
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","12","11611","2359","Group G2P Transfer V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","11612","2359","Group G2P Transfer V2.0","var input = __input.response;
if (!empty(input) and size(input) > 255)
{
    __next = '7';
}
else
{
     __referenceData.Comment2Customer = input;
    __next = '8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","11613","2359","Group G2P Transfer V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
  __next = '2b0';
  __exemode='continue';
} else {
  __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11614","2359","Group G2P Transfer V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group=  __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3';
}
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11615","2360","Group P2G Transfer V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group Code */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","11616","2360","Group P2G Transfer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.ReceiverPartyIdentifier = input;
    __next = '3';
}
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11617","2360","Group P2G Transfer V2.0","var input = __input.response;
__params.Remark = input;
__next = '4';","3","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","11618","2360","Group P2G Transfer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.Amount= input;
    __next = '5';
} else {
    __next = '4';
}","4","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","9","11619","2360","Group P2G Transfer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.PIN = input;
    __next = '6';
} else {
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","11","11620","2360","Group P2G Transfer V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11621","2360","Group P2G Transfer V2.0","var input = __input.response;
if (!empty(input) and size(input)> 255)
{
    __next = '6';
}
else
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","11622","2360","Group P2G Transfer V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
  __next = '2b0';
  __exemode='continue';
} else {
  __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11623","2360","Group P2G Transfer V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  beneficiary=  __tempData.beneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
  __next = '3';
}
else{
  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: __tempData.beneficiaries){
 ${index} ${beneficiary.BeneficiaryName}
 ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","11624","2361","Group Pay Bill V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__tempData.CurrencyCode = """";
__next = '0';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","11625","2361","Group Pay Bill V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
__params.PrimaryPartyIdentifier = input;
__next = '2';
}else{
__next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11626","2361","Group Pay Bill V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
   __next = '3';","2","Input Bill Issuer ShortCode","<html>
<body>
Input Bill Issuer Short Code<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","11627","2361","Group Pay Bill V2.0","var input = __input.response;
__params.BillReferenceNumber = input;
   __next = '4';","3","Bill Reference Number","<html>
<body>
Input Bill No <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11628","2361","Group Pay Bill V2.0","var input = __input.response;
__params.Remark = input;
__next = '5';","4","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","11629","2361","Group Pay Bill V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.Amount= input;
    __next = '6';
} else {
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","11","11630","2361","Group Pay Bill V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.PIN = input;
    __next = '7';
} else {
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","23","11631","2361","Group Pay Bill V2.0","var input = __input.response;
if (input == '1') {
  if(__tempData.isSupportCNS and __tempData.cust.initiatorCNSStatus.suspensionFlag.fieldValue != '01'){
    __params.ResultType='0';
    __params.EventType=""PRE_VALIDATION"";
    __params.Reason=""Continue Pre-Validation Transaction"";
    __next='11a';
    __exemode='continue';
  }else{
    __next='end';
  }
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","11632","2361","Group Pay Bill V2.0","var input = __input.response;
if (!empty(input) and size(input) > 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8a';
    __exemode='continue';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","11633","2361","Group Pay Bill V2.0","var input = __input.response;
if (input == '1') {
	__next = '1a';
} else if (input == '2') {
	__next = '1b0';
        __exemode='continue';
} else {
	__next = '0';
}","0","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11634","2361","Group Pay Bill V2.0","var input=__input.response;
if(!empty(input)){
  var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '2';
} 
else{
  __next = '1b';
}
}else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","17","11635","2361","Group Pay Bill V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if(isSuccess){
   if(input == '1'){
      if(__tempData.isSupportCNS==false||__tempData.cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01')
     {
          __next = '10';
      }else{
          __tempData.notificationParams = Util.createMap();
          __next='9a';
          __exemode='continue';
      }
   }else if(input == '2'){
      __next='10';
   }
}else{
  __next='8';
}","8","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","22","11636","2361","Group Pay Bill V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
  __params.OperationType= input ;
  if(input == '1'){
     __next = '10';
  }else if (input == '2') {
     __params.EventType=""PRE_VALIDATION"";
     __params.errDesc='Pre-Validation Result is Rejected.';
     __params.Reason=""Rejected"";
     __errormsg = 'You have chosed to reject transation,Please check notification.';
     __next='11a1';
     __exemode='continue';
  }
}else{
  __next = '9';
}","9","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__tempData.promptMsg}<br>
${__tempData.tips}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","1","11637","2362","Group Payment With Foreign Exchange V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.TransactionCategory = 'FX';
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","11638","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
if (input == '1') {
   __next = '3';
} else if (input == '2') {
   __next = '2a';
   __exemode='continue'; 
} else {
   __next = '0';
}","1","My Group Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11639","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
     __params.PrimaryPartyIdentifier = input;
     __next = '4';
   }
else{
    __next = '3';
}","3","Enter My Group Code","<html>
<body>
Enter group code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","5","11640","2362","Group Payment With Foreign Exchange V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '4';
}
else{
  __next = '2';
}","2","Select My Group","<html>
<body>
Select my group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","7","11641","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifierType = '01';
  __next = '5';
} else if(input == '2') {
  __params.ReceiverPartyIdentifierType = '15';
  __next = '6';
} else if(input == '3') {
  __params.ReceiverPartyIdentifierType = '04';
  __next = '7';
} else {
  __next = '4';
}","4","Select Receiver Type","<html>
<body>
Please select the receiver type: <br>
1 Customer <br>
2 Group <br>
3 Organization <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","11642","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
if (input == '1') {
  __next = '5a';
} else if (input == '2') {
  __next = '5b0';
        __exemode='continue';
} else {
  __next = '5';
}","5","Select Customer Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","11643","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
if (input == '1') {
  __next = '6a';
} else if (input == '2') {
  __next = '6b0';
       __exemode='continue';
} else {
  __next = '6';
}","6","Select Recipient Group Option","<html>
<body>
Please select option: <br>
1 Enter Recipient Group Code<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","18","11644","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
if (empty(input)) {
__next = '7';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '8a';
__exemode='continue';
}","7","Enter Org Short Code","<html>
<body>
Please enter organization short code<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11645","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
if (empty(input)) {
__next = '5a';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '8a';
__exemode='continue';
}","5a","Enter Customer Msisdn","<html>
<body>
Enter customer msisdn<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","11646","2362","Group Payment With Foreign Exchange V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if(isSuccess) {
  beneficiary= __tempData.customerBeneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '8a';
  __exemode='continue';
}
else{
  __next = '5b2';
}","5b2","Select Customer","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: __tempData.customerBeneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","14","11647","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
     __params.ReceiverPartyIdentifier = input;
     __next = '8a';
     __exemode='continue';
   }
else{
    __next = '6a';
}","6a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","17","11648","2362","Group Payment With Foreign Exchange V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if(isSuccess) {
  beneficiary= __tempData.groupBeneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
  __next = '8a';
  __exemode='continue';
}
else{
  __next = '6b2';
}","6b2","Select Receiver Group","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: __tempData.groupBeneficiaries ){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","23","11649","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
  if (!empty(input)) {
    var tmp = Util.toInt(input) - 1;
                var isSuccess = __input.validateResult.isSucess;
    if (isSuccess) {
      __params.DestinationCurrency= __tempData.multiCurrencyCode.get(tmp);
            if (__tempData.defaultCurrencyCode == __params.DestinationCurrency) {
            __next = '10a';
                         __exemode='continue';
             } else {
            __next = '9';
             }
    }
  } else {
    __next = '8';
  }","8","Select Dest Currency","<html>
<body>
Select the destination currency you want to pay :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","24","11650","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
if (empty(input) || input=='1') {
__params.SourceCurrency = __tempData.defaultCurrencyCode;
__next = '11';
} else {
__next = '9';
}","9","Select Source Currency","<html>
<body>
Select the source currency to pay from:<br>
1 ${__tempData.defaultCurrencyCode}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","27","11651","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
               type = __tempData.multiForeignCurrencyCode.get(tmp);
                __params.SourceCurrency = type;
                __next = '11';
         } else {
                __next = '10';
         }
    } else {
        __next = '10';
    }","10","Select Foreign Source Currency","<html>
<body>
Select the source currency to pay from:<br>
  $$var i = 1;
  $$for(type: __tempData.multiForeignCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","28","11652","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
if (input == '1') {
  __params.BaseCurrency = __params.SourceCurrency ;
  __next = '12';
} else if(input == '2') {
  __params.BaseCurrency = __params.DestinationCurrency ;
   __next = '12';
} else {
  __next = '11';
}","11","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.SourceCurrency} <br>
2 Input the amount in ${__params.DestinationCurrency}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","29","11653","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
 __params.BaseAmount = Util.replaceAll(input,',','.');
 __next = '13a';
 __exemode='continue';
}
else {
 __next = '12';
}","12","Input Base Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","32","11654","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
  if (isSuccess) {
               type = __tempData.multiAccount.get(tmp);
                __params.SourceAccount = type.AccountNo;
                __next = '14';
         } else {
                __next = '13';
         }
    } else {
        __next = '13';
    }","13","Select Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","62","33","11655","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
__params.PIN = input;

__committerParams.SourceCurrency=__params.SourceCurrency;
__committerParams.DestinationCurrency=__params.DestinationCurrency;
__committerParams.BaseCurrency=__params.BaseCurrency;
__committerParams.BaseAmount=__params.BaseAmount;
__next = '15a';
__exemode='continue';","14","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","35","11656","2362","Group Payment With Foreign Exchange V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '15';
}","15","Confirm","<html>
<body>
$$rateInfo = __tempData.rateInfo;
You are going to pay [${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}] to ${__params.ReceiverPartyIdentifier},[${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}] will be debited from your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11657","2363","Group Reactivate Direct Debit Mandate V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = __msisdn;
__params.ActionType= 'ReactivateGroupDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.MandateStatus = '04';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","11658","2363","Group Reactivate Direct Debit Mandate V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   __next = '3a';
} else {
   __next = '1';
}","1","select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","11659","2363","Group Reactivate Direct Debit Mandate V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if(!empty(input)){
   var found = '1';
   for (group: __tempData.groups) {
    if (group.groupCode == input) {
      found = '0';
    }
  }
    if (found == '1') {
    __errormsg = 'no current group or not belong to the group.';
    __next = 'error';
  } else {
    __next='4a';
                __exemode='continue';
  }
}else {
       __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11660","2363","Group Reactivate Direct Debit Mandate V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.ReceiverPartyIdentifier = __tempData.groups.get(i).groupCode;
    __committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
    __committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
    __committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
    __committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
    __next='3b';
    __exemode='continue';
}
else{
  __next = '3a';
}","3a","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","10","11661","2363","Group Reactivate Direct Debit Mandate V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
__params.MandateID =  __tempData.mandateList.get(i).mandateId;
__params.PayeeName =  __tempData.mandateList.get(i).payeeName;
__next = '6';
} else {
__next = '5';
}","5","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: __tempData.mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","11662","2363","Group Reactivate Direct Debit Mandate V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '6';
} else {
    __params.@HEAD@PIN = input;
    __next = '7';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","12","11663","2363","Group Reactivate Direct Debit Mandate V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","11733","2370","Group FSI Loan For M-Shwari V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.Amount = '0';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Request';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","11734","2370","Group FSI Loan For M-Shwari V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.PrimaryPartyIdentifier = input;
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11735","2370","Group FSI Loan For M-Shwari V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __referenceData.RequestBalance = Util.replaceAll(input,',','.');
    __next = '4';
} else {
    __next = '3';
}","3","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","8","11736","2370","Group FSI Loan For M-Shwari V2.0","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11737","2370","Group FSI Loan For M-Shwari V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Request ${__params.ReceiverPartyIdentifier} ${__referenceData.RequestBalance} loans?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","11738","2370","Group FSI Loan For M-Shwari V2.0","var input = __input.response;
if (input == '1') {
	__next = '2a';
} else if (input == '2') {
	__next = '2b0';
        __exemode='continue';
} else {
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11739","2370","Group FSI Loan For M-Shwari V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group=  __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier= groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","4","11740","2370","Group FSI Loan For M-Shwari V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b1';
__exemode='continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","11741","2370","Group FSI Loan For M-Shwari V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check My Groups","Check My Groups",""<endrec>
"CUSTOMER","","1","11742","2371","Group FSI Loan Repayment For M-Shwari V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Repayment';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","11743","2371","Group FSI Loan Repayment For M-Shwari V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.PrimaryPartyIdentifier = input;
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11744","2371","Group FSI Loan Repayment For M-Shwari V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __referenceData.RequestBalance = Util.replaceAll(input,',','.');
    __params.Amount = __referenceData.RequestBalance;
    __next = '4';
} else {
    __next = '3';
}","3","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","8","11745","2371","Group FSI Loan Repayment For M-Shwari V2.0","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","11746","2371","Group FSI Loan Repayment For M-Shwari V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Pay ${__params.Amount} loans?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","11747","2371","Group FSI Loan Repayment For M-Shwari V2.0","var input = __input.response;
if (input == '1') {
	__next = '2a';
} else if (input == '2') {
	__next = '2b0';
        __exemode='continue';
} else {
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11748","2371","Group FSI Loan Repayment For M-Shwari V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group=  __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier= groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","4","11749","2371","Group FSI Loan Repayment For M-Shwari V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b1';
__exemode='continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","11750","2371","Group FSI Loan Repayment For M-Shwari V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check My Groups","Check My Groups",""<endrec>
"CUSTOMER","","1","11751","2372","Group FSI Loan Repayment from Savings For M-Shwari V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.Amount = '0';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Payment_from_Savings';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","11752","2372","Group FSI Loan Repayment from Savings For M-Shwari V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.PrimaryPartyIdentifier = input;
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","11753","2372","Group FSI Loan Repayment from Savings For M-Shwari V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __referenceData.RequestBalance = Util.replaceAll(input,',','.');
    __params.Amount = __referenceData.RequestBalance;
    __next = '4';
} else {
    __next = '3';
}","3","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","8","11754","2372","Group FSI Loan Repayment from Savings For M-Shwari V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
 __params.PIN = input;
    __next = '5';
} else {
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","9","11755","2372","Group FSI Loan Repayment from Savings For M-Shwari V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Pay ${__referenceData.RequestBalance} loans from group savings?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","11756","2372","Group FSI Loan Repayment from Savings For M-Shwari V2.0","var input = __input.response;
if (input == '1') {
	__next = '2a';
} else if (input == '2') {
	__next = '2b0';
        __exemode='continue';
} else {
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11757","2372","Group FSI Loan Repayment from Savings For M-Shwari V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group=  __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier= groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","4","11758","2372","Group FSI Loan Repayment from Savings For M-Shwari V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b1';
__exemode='continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","11759","2372","Group FSI Loan Repayment from Savings For M-Shwari V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check My Groups copy","Check My Groups",""<endrec>
"CUSTOMER","54","2","11760","2326","Customer Reactivate Direct Debit Mandate V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.MandateStatus=__params.MandateStatus;
__next='1b';
__exemode='continue';","1a","Query Direct Debit Mandates","Query Direct Debit Mandates",""<endrec>
"CUSTOMER","","3","11761","2326","Customer Reactivate Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.mandateList =__input.lastCommitResult.result;
   if(empty(__tempData.mandateList )||size(__tempData.mandateList )==0){
       __errormsg = 'No Available Mandates.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying direct debit mandates.';
   __next = 'error';
}","1b","Check Direct Debit Mandates","Check Direct Debit Mandates",""<endrec>
"CUSTOMER","45","11","11762","2328","Customer Register Card V2.0","__committerParams.params = __params;
__next='9b';
__exemode='continue';","9a","Build Additional Card Info","Build Additional Card Info",""<endrec>
"CUSTOMER","","12","11763","2328","Customer Register Card V2.0","if( __input.lastCommitResult.isSucess){
  __params.AdditionalCardInfos = __input.lastCommitResult.result;
  __next='10';
}else{
  __errormsg= 'Sorry,build Additional Card Info failed ';
  __next='error';
}","9b","Get Additional Card Info","Get Additional Card Info",""<endrec>
"CUSTOMER","46","2","11764","2328","Customer Register Card V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__committerParams.AccessDeviceIdentifier = __params.AccessDeviceIdentifier;
__committerParams.AccessDeviceIdentifierType = __params.AccessDeviceIdentifierType;
__committerParams.queryCardType = '0';  /* register */
__next='1b';
__exemode='continue';","1a","Query Register Card Types","Query Register Card Types",""<endrec>
"CUSTOMER","","3","11765","2328","Customer Register Card V2.0","__tempData.cardTypes=__input.lastCommitResult.result;
if(empty(__tempData.cardTypes)||size(__tempData.cardTypes)==0){
   __errormsg = 'You have no Card Type.';
   __next = 'error';
}else{
   __next='2';
}","1b","Check Register Card Types","Check Register Card Types",""<endrec>
"CUSTOMER","29","6","11766","2329","Customer Remit V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__next='5b';
__exemode='continue';","5a","Query Multi Account","Query Multi Account",""<endrec>
"CUSTOMER","","7","11767","2329","Customer Remit V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      if(1 == size(__tempData.multiAccount)){
          type = __tempData.multiAccount.get(0);
          if(empty(type.defaultFlag) ||  type.defaultFlag == ""true"")
          {
              __next = '6';
          }
       }else{
              __next = '5';          
       }
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","5b","Check Multi Account","Check Multi Account",""<endrec>
"CUSTOMER","","9","11768","2330","Customer Self Update KYC V2.0","if (__input.lastCommitResult.isSucess)
{
    __params.KYCInfo =__input.lastCommitResult.result;
    __next = '8';
}else{
   __errormsg = 'Sorry,build Customer Info failed.';
   __next = 'error';
}","8a","Get Customer Info","Get Customer Info",""<endrec>
"CUSTOMER","62","13","11769","2331","Customer Sell Foreign Currency V2.0","__committerParams.SourceCurrency=__params.SourceCurrency;
__committerParams.DestinationCurrency=__params.DestinationCurrency;
__committerParams.BaseCurrency=__params.BaseCurrency;
__committerParams.BaseAmount=__params.BaseAmount;
__next='6b';
__exemode='continue';","6a","Query Fx Rate and Amount","Query Fx Rate and Amount",""<endrec>
"CUSTOMER","","14","11770","2331","Customer Sell Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.rateInfo=__input.lastCommitResult.result;
    __next='6';
}else{
   __errormsg = 'Sorry,error occured when querying rateInfo.';
   __next = 'error';
}","6b","Check Fx Rate and Amount","Check Fx Rate and Amount",""<endrec>
"CUSTOMER","58","2","11771","2331","Customer Sell Foreign Currency V2.0","__next='1b';
__exemode='continue';","1a","Query All Foreign Currency","Query All Foreign Currency",""<endrec>
"CUSTOMER","","3","11772","2331","Customer Sell Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying foreign currencyCode.';
   __next = 'error';
}","1b","Check All Foreign Currency","Check All Foreign Currency",""<endrec>
"CUSTOMER","59","5","11773","2331","Customer Sell Foreign Currency V2.0","__next='2b';
__exemode='continue';","2a","Query Default Currency","Query Default Currency",""<endrec>
"CUSTOMER","","6","11774","2331","Customer Sell Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.defaultCurrencyCode =__input.lastCommitResult.result;
    __next='2';
}else{
   __errormsg = 'Sorry,error occured when querying defaultCurrencyCode.';
   __next = 'error';
}","2b","Check Default Currency","Check Default Currency",""<endrec>
"CUSTOMER","29","9","11776","2331","Customer Sell Foreign Currency V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;
__next='4b';
__exemode='continue';","4a","Query Multi Account","Query Multi Account",""<endrec>
"CUSTOMER","","10","11777","2331","Customer Sell Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='4';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","4b","Check Multi Accounts","Check Multi Accounts",""<endrec>
"CUSTOMER","66","2","11778","2332","Customer Transfer from Bank to M-Pesa V2.0","__next  = '1a';
__committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__exemode = 'continue';","1","Query FiOrg List","Query FiOrg List",""<endrec>
"CUSTOMER","","3","11779","2332","Customer Transfer from Bank to M-Pesa V2.0","__tempData.fiOrgList= __input.lastCommitResult.result;
   if (empty(__tempData.fiOrgList) || size(__tempData.fiOrgList) == 0)
   {
      __errormsg = 'Sorry, there is no FI Organization.';
      __next = 'error';
   } else
   {
      __next = '2';
   }","1a","check fiorgList","check fiorgList",""<endrec>
"CUSTOMER","67","5","11780","2332","Customer Transfer from Bank to M-Pesa V2.0","__next  = '3a';
__committerParams.FIOrgIdentityId=__params.FIOrgIdentityId;
__committerParams.BankCardOwnerInputType=__params.BankCardOwnerInputType;
__exemode = 'continue';","3","Query FIBankCardCheck","Query FIBankCardCheck",""<endrec>
"CUSTOMER","","7","11781","2332","Customer Transfer from Bank to M-Pesa V2.0","var input = __input.response;
if (input == '1') {
  __exemode = 'continue';
  __next = '5';
} else if (input == '2') {
  __exemode = 'continue';
  __next = '7';
}","4","Select or Enter Bank Account","<html>
<body>
1 Select form list <br>
${__params.isEnterBankAccount}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","55","8","11782","2332","Customer Transfer from Bank to M-Pesa V2.0","__next  = '5a';
__committerParams.IdentifierType=__params.QueryIdentifierType;
__committerParams.IdentifierValue=__params.QueryIdentifierValue;
__committerParams.FIOrgIdentityId=__params.FIOrgIdentityId;
__exemode = 'continue';","5","QueryBankAccListByIdenAndBank","QueryBankAccListByIdenAndBank",""<endrec>
"CUSTOMER","","9","11783","2332","Customer Transfer from Bank to M-Pesa V2.0","__tempData.bankAccounts= __input.lastCommitResult.result;
   if (empty(__tempData.bankAccounts) || size(__tempData.bankAccounts) == 0)
   {
      __errormsg = 'Sorry, there is no bankAccount.';
      __next = 'error';
   } else
   {
       __next = '6';
   }","5a","check BankAccListByIdenAndBank","check BankAccListByIdenAndBank",""<endrec>
"CUSTOMER","50","11","11784","2332","Customer Transfer from Bank to M-Pesa V2.0","__next  = '7a';
__committerParams.IdentityType ='1000';
__exemode = 'continue';","7","query BankCard Attr","query BankCard Attr",""<endrec>
"CUSTOMER","","12","11785","2332","Customer Transfer from Bank to M-Pesa V2.0","__tempData.attrList = __input.lastCommitResult.result;
   if (empty(__tempData.attrList ) || size(__tempData.attrList) == 0)
   {
      __errormsg = 'Sorry, there is no BankCard Attr.';
      __next = 'error';
   } else
   {
       __next = '8';
   }","7a","check attrList","check attrList",""<endrec>
"CUSTOMER","56","15","11786","2332","Customer Transfer from Bank to M-Pesa V2.0","__next  = '9b';
__committerParams.InfoDetail=  __tempData.InfoDetail;
__exemode = 'continue';","9a","Build Bank Account Info","Build Bank Account Info",""<endrec>
"CUSTOMER","","16","11787","2332","Customer Transfer from Bank to M-Pesa V2.0","__params.FIAccountInfo= __input.lastCommitResult.result;
   if (empty(__params.FIAccountInfo) || size(__params.FIAccountInfo) == 0)
{
      __errormsg = 'Sorry,Build account info failed.';
      __next = 'error';
}
else
{
       __next = '10';
}","9b","check Build result","check Build result",""<endrec>
"CUSTOMER","","19","11788","2333","Customer Transfer from M-Pesa to Bank V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input)||!isSuccess) {
    __next = '12';
} else {
       __params.Amount =Util.replaceAll(input,',','.');
    __next = '13';
}","12","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","20","11789","2333","Customer Transfer from M-Pesa to Bank V2.0","var input = __input.response;
__params.PIN = input;
__next = '14';","13","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","66","2","11790","2333","Customer Transfer from M-Pesa to Bank V2.0","__next  = '1a';
__committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__exemode = 'continue';","1","Query FiOrg List","Query FiOrg List",""<endrec>
"CUSTOMER","","3","11791","2333","Customer Transfer from M-Pesa to Bank V2.0","__tempData.fiOrgList= __input.lastCommitResult.result;
   if (empty(__tempData.fiOrgList) || size(__tempData.fiOrgList) == 0)
   {
      __errormsg = 'Sorry, there is no FI Organization.';
      __next = 'error';
   } else
   {
      __next = '2';
   }","1a","check fiorgList","check fiorgList",""<endrec>
"CUSTOMER","","4","11792","2333","Customer Transfer from M-Pesa to Bank V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
	__params.ShortCode = __tempData.fiOrgList.get(i).shortCode;
	__params.PrimaryPartyIdentifier = __params.ShortCode;
	__params.FIOrgIdentityId = __tempData.fiOrgList.get(i).identityId;
	__next = '3';
} else {
	__next = '2';
}","2","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: __tempData.fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","11793","2333","Customer Transfer from M-Pesa to Bank V2.0","var input = __input.response;
if (input == '1') {
  __tempData.identifierTypeName = 'MSISDN';
  __params.BankCardOwnerInputType = '01';   /* MSISDN */
  __next = '4';
} else if (input == '2') {
  __tempData.identifierTypeName = 'Organization Short Code';
  __params.BankCardOwnerInputType = '04';   /* SHORT_CODE*/
  __next = '4';
}else if (input == '3') {
  __tempData.identifierTypeName = 'Group Code';
  __params.BankCardOwnerInputType = '15';   /* GROUP_CODE*/
  __next = '4';
}  else {
  __next = '3';
}","3","Select Receiver Type","<html>
<body>
Select Receiver Type:<br>
1 Customer <br>
2 Organization <br>
3 Group <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","11794","2333","Customer Transfer from M-Pesa to Bank V2.0","var input = __input.response;
__params.BankCardOwnerInputValue= input;
__params.ReceiverPartyIdentifier=input;
__exemode = 'continue';
__next = '5';","4","Enter Receiver","<html>
<body>
Enter Receiver ${__tempData.identifierTypeName}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","67","7","11795","2333","Customer Transfer from M-Pesa to Bank V2.0","__next  = '5a';
__committerParams.FIOrgIdentityId=__params.FIOrgIdentityId;
__committerParams.BankCardOwnerInputType=__params.BankCardOwnerInputType;
__exemode = 'continue';","5","Query FIBankCardCheck","Query FIBankCardCheck",""<endrec>
"CUSTOMER","","8","11796","2333","Customer Transfer from M-Pesa to Bank V2.0","if(__input.lastCommitResult.isSucess)
   {
     var isEnterBankAccount = __input.lastCommitResult.result;
      if (isEnterBankAccount) {
	__params.isEnterBankAccount = '2 Enter bank card <br>';
      } else {
	__params.isEnterBankAccount = '';
     }
    __next = '6';
   } else
   {
    __errormsg = 'Sorry, faild to check is allowed unlinked bank card.';
    __next = 'error'
   }","5a","check FIBankCardCheck","check FIBankCardCheck",""<endrec>
"CUSTOMER","","9","11797","2333","Customer Transfer from M-Pesa to Bank V2.0","var input = __input.response;
if (input == '1') {
  __exemode = 'continue';
  __next = '7';
} else if (input == '2') {
  __exemode = 'continue';
  __next = '9';
}","6","Select or Enter Bank Account","<html>
<body>
1 Select form list <br>
${__params.isEnterBankAccount}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","60","10","11798","2333","Customer Transfer from M-Pesa to Bank V2.0","__next  = '7a';
__committerParams.QueryIdentifierType= __params.QueryIdentifierType;
__committerParams.QueryIdentifierValue= __params.QueryIdentifierValue;
__committerParams.BranchOrFIOrgId=__params.FIOrgIdentityId;
__exemode = 'continue';","7","queryBankLookupList","queryBankLookupList",""<endrec>
"CUSTOMER","","11","11799","2333","Customer Transfer from M-Pesa to Bank V2.0","__tempData.bankLookupList= __input.lastCommitResult.result;
   if (empty(__tempData.bankLookupList) || size(__tempData.bankLookupList) == 0)
   {
      __errormsg = 'Sorry, there is no bankLookupList.';
      __next = 'error';
   } else
   {
       __next = '8';
   }","7a","Check Bank Look Up List","Check Bank Look Up List",""<endrec>
"CUSTOMER","","12","11800","2333","Customer Transfer from M-Pesa to Bank V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
   __params.BankCardId = __tempData.bankLookupList.get(i).BankCardId;
  __tempData.BankCardId = __params.BankCardId;
   __next = '12';
} else {
   __next = '8';
}","8","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankLookup:__tempData.bankLookupList){
 ${index} ${bankLookup.AccountName}/${bankLookup.AccountNumber}(${bankLookup.BankBranchName})<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","50","13","11801","2333","Customer Transfer from M-Pesa to Bank V2.0","__next  = '9a';
__committerParams.IdentityType ='1000';
__exemode = 'continue';","9","query BankCard Attr","query BankCard Attr",""<endrec>
"CUSTOMER","","14","11802","2333","Customer Transfer from M-Pesa to Bank V2.0","__tempData.attrList = __input.lastCommitResult.result;
   if (empty(__tempData.attrList ) || size(__tempData.attrList) == 0)
   {
      __errormsg = 'Sorry, there is no BankCard Attr.';
      __next = 'error';
   } else
   {
       __next = '10';
   }","9a","check attrList","check attrList",""<endrec>
"CUSTOMER","","15","11803","2333","Customer Transfer from M-Pesa to Bank V2.0","__params.BankAccountNo = __input.response;
__tempData.BankCardId= __params.BankAccountNo;
bankCardAttrLisSize = size(__tempData.attrList );
if (bankCardAttrLisSize > 0)
{
  __tempData.attrIndex= 1;
  __tempData.InfoDetail= Util.createMap();
  __next = '11';
}
else
{
__next = '14';
}","10","Enter Bank Account","<html>
<body>
Enter Bank Account<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","11804","2333","Customer Transfer from M-Pesa to Bank V2.0","var input = __input.response;
if (!empty(input)) {
  __tempData.InfoDetail[__tempData.attrList[__tempData.attrIndex]]= input;

  __tempData.attrIndex = __tempData.attrIndex + 1;
  if(__tempData.attrIndex < size(__tempData.attrList)) {
    __next = '11';
  } else {
    __exemode = 'continue';
    __next = '11a';
  }
} else {
  __next = '11';
}","11","Enter Bank Card Attr","<html>
<body>
Enter ${__tempData.attrList[__tempData.attrIndex]}:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","56","17","11805","2333","Customer Transfer from M-Pesa to Bank V2.0","__next  = '11b';
__committerParams.InfoDetail=  __tempData.InfoDetail;
__exemode = 'continue';","11a","Build Bank Account Info","Build Bank Account Info",""<endrec>
"CUSTOMER","","18","11806","2333","Customer Transfer from M-Pesa to Bank V2.0","__params.FIAccountInfo= __input.lastCommitResult.result;
   if (empty(__params.FIAccountInfo) || size(__params.FIAccountInfo) == 0)
{
      __errormsg = 'Sorry,Build account info failed.';
      __next = 'error';
}
else
{
       __next = '12';
}","11b","check Build result","check Build result",""<endrec>
"CUSTOMER","63","2","11807","2335","Customer online withdraw e-money from float to bank account via handset V2.0","__next='1b';
__exemode='continue';","1a","Query Defaul Sp Id","Query Defaul Sp Id",""<endrec>
"CUSTOMER","","3","11808","2335","Customer online withdraw e-money from float to bank account via handset V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.defaultSpId=__input.lastCommitResult.result;
    __params.ReceiverPartyIdentifier = __tempData.defaultSpId;
    __next='1';
}else{
   __errormsg = 'Sorry,error occured when querying default Sp Id.';
   __next = 'error';
}","1b","Get Default Sp Id","Get Default Sp Id",""<endrec>
"CUSTOMER","55","5","11809","2335","Customer online withdraw e-money from float to bank account via handset V2.0","__committerParams.IdentifierType=__params.InitiatorIdentifierType;
   __committerParams.IdentifierValue=__params.InitiatorIdentifier;
   __committerParams.PartnerBank='1';
   __next='2b';
   __exemode='continue';","2a","Query  Bank Account List","Query  Bank Account List",""<endrec>
"CUSTOMER","","6","11810","2335","Customer online withdraw e-money from float to bank account via handset V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.bankAccounts=__input.lastCommitResult.result;
   if(empty(__tempData.bankAccounts)|| size(__tempData.bankAccounts)==0){
       __errormsg = 'Sorry, there is not any bank account.';
       __next = 'error';
   }else {
       __next = '2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying bank account.';
   __next = 'error';
}","2b","Check Bank Accounts List","Query  Bank Account List",""<endrec>
"CUSTOMER","","32","11811","2336","Customer pay bill V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '12';
}","12","Confirm with Charge","<html>
<body>
$$formatAmount = Util.formatAmount(__params.Currency, __params.Amount);
To Pay ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${__tempData.orgName} for account number ${__params.BillReferenceNumber}, the charge is ${__tempData.chargeFee}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","17","11812","2336","Customer pay bill V2.0","if (__input.lastCommitResult.isSucess)
{
       __tempData.map=__input.lastCommitResult.result;
       beforeCheckManual='InputBillNo';
       __next = '3a';
       __exemode='continue';
}else{
   __errormsg = 'Failed to send TransOutgoing message.';
   __next = 'error';
}","5a","Get Response","Get Response",""<endrec>
"CUSTOMER","23","3","11813","2336","Customer pay bill V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__committerParams.IdentityType = '5000';
__next='1a1';
__exemode='continue';","1a0","Query Organization Beneficiary","Query Organization Beneficiary",""<endrec>
"CUSTOMER","","4","11814","2336","Customer pay bill V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.orgBeneficiaries= __input.lastCommitResult.result;
   if (empty(__tempData.orgBeneficiaries) || size(__tempData.orgBeneficiaries) == 0) {
      __errormsg = 'There is no beneficiary exist.';
      __next = 'error';
    } else {
       __next = '1b0';
       __exemode='continue';
    }
}else{
   __errormsg = 'Sorry,error occured when querying beneficiary.';
   __next = 'error';
}","1a1","Check Organization Beneficiary","Check Organization Beneficiary",""<endrec>
"CUSTOMER","69","5","11815","2336","Customer pay bill V2.0","__committerParams.OrgBeneficiaries=__tempData.orgBeneficiaries;
__next='1b1';
__exemode='continue';","1b0","Query Beneficiary Org List","Query Beneficiary Org List",""<endrec>
"CUSTOMER","","6","11816","2336","Customer pay bill V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.orglist= __input.lastCommitResult.result;
   if (empty(__tempData.orglist) || size(__tempData.orglist) == 0) {
      __errormsg = 'There is no organization benediciary exist.';
      __next = 'error';
    } else {
       __next = '1';
    }
}else{
   __errormsg = 'Sorry,error occured when querying organization beneficiary.';
   __next = 'error';
}","1b1","Check Org List","Check Org List",""<endrec>
"CUSTOMER","70","9","11817","2336","Customer pay bill V2.0","__committerParams.ServiceCode=__params.ReceiverPartyIdentifier;
__next='3b';
__exemode='continue';","3a","Query isManualSelectionMode","Query isManualSelectionMode",""<endrec>
"CUSTOMER","","10","11818","2336","Customer pay bill V2.0","if (__input.lastCommitResult.isSucess)
{
     isManual  = __input.lastCommitResult.result;
   if (isManual) {
	__next='4a0';
	__exemode='continue';
     } else {
        if( beforeCheckManual=='SelectBeneficiaryShortCode'){
             __next = '4b0';
             __exemode='continue';
        }else if(beforeCheckManual=='InputBillNo'){
             __next = '7a';
             __exemode='continue';
        }else{
             __next = 'error';
        }
	__exemode='continue';
     }
}else{
   __errormsg = 'Sorry,error occured when querying Manual Selection Mode.';
   __next = 'error';
}","3b","Check Is Manual Selection Mode","Check Is Manual Selection Mode",""<endrec>
"CUSTOMER","33","11","11819","2336","Customer pay bill V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__next='4a1';
__exemode='continue';","4a0","Query Reason Types","Query Reason Types",""<endrec>
"CUSTOMER","","12","11820","2336","Customer pay bill V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.reasonTypes  = __input.lastCommitResult.result;
   if (empty(__tempData.reasonTypes ) || size(__tempData.reasonTypes ) == 0) {
      __errormsg = 'There is no reason type fit.';
      __next = 'error';
    } else {
       __next = '6';
    }
}else{
   __errormsg = 'Sorry,error occured when querying reason types.';
   __next = 'error';
}","4a1","Check Reason Types","Check Reason Types",""<endrec>
"CUSTOMER","71","13","11821","2336","Customer pay bill V2.0","__committerParams.ShortCode=__params.ReceiverPartyIdentifier;
__committerParams.OrgBeneficiaries=__tempData.orgBeneficiaries;
__next='4b1';
__exemode='continue';","4b0","Query Org List by Short Code","Query Org List by Short Code",""<endrec>
"CUSTOMER","","14","11822","2336","Customer pay bill V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.orgBeneficiaries= __input.lastCommitResult.result;
   if (empty(__tempData.orgBeneficiaries) || size(__tempData.orgBeneficiaries) == 0) {
      __errormsg = 'There is no beneficiary exist.';
      __next = 'error';
    } else {
       __next = '4';
    }
}else{
   __errormsg = 'Sorry,error occured when querying customer beneficiary.';
   __next = 'error';
}","4b1","Check Beneficiry for Org","Check Beneficiry for Org",""<endrec>
"CUSTOMER","24","19","11823","2336","Customer pay bill V2.0","__next='7b';
__exemode='continue';","7a","Query All Currency","Query All Currency",""<endrec>
"CUSTOMER","","20","11824","2336","Customer pay bill V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='7';
   }
}else{
   __errormsg = 'Sorry,error occured when querying foreign currencyCode.';
   __next = 'error';
}","7b","Check All Currency","Check All Currency",""<endrec>
"CUSTOMER","29","23","11825","2336","Customer pay bill V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;
__next='9b';
__exemode='continue';","9a","Query Multi Account","Query Multi Account",""<endrec>
"CUSTOMER","","24","11826","2336","Customer pay bill V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else if(1 == size(__tempData.multiAccount)){
        type = __tempData.multiAccount .get(0);
        if('true' == type.defaultFlag){
             __next = '10';
        }else{
             __next = '9';
        }
   }else{
         __next = '9';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","9b","Check Multi Accounts","Check Multi Accounts",""<endrec>
"CUSTOMER","74","28","11827","2336","Customer pay bill V2.0","__committerParams.ShortCode=__params.ReceiverPartyIdentifier;
__next='12a1';
__exemode='continue';","12a0","Query Org Name","Query Org Name",""<endrec>
"CUSTOMER","","29","11828","2336","Customer pay bill V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.orgName = __input.lastCommitResult.result;
    __next='12b0';
    __exemode='continue';
}else{
   __errormsg = 'Sorry,error occured when querying Org Name.';
   __next = 'error';
}","12a1","Check Org Name","Check Org Name",""<endrec>
"CUSTOMER","27","30","11829","2336","Customer pay bill V2.0","__committerParams.InitiatorIdentityInfo=__IdentityInfo;
__next='12b1';
__exemode='continue';","12b0","Query Charge Fee","Query Charge Fee",""<endrec>
"CUSTOMER","","31","11830","2336","Customer pay bill V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.chargeFee = __input.lastCommitResult.result;
   if(empty(__tempData.chargeFee )){
       __next = '12c';
   }else {
      __next='12';
   }
}else{
   __errormsg = 'Calculate fee failed.';
   __next = 'error';
}","12b1","Check Charge Fee","Check Charge Fee",""<endrec>
"CUSTOMER","29","2","11831","2337","Customer query mini statements V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__next='1b';
__exemode='continue';","1a","Query All Accounts","Query All Accounts",""<endrec>
"CUSTOMER","","3","11832","2337","Customer query mini statements V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","1b","Check All Accounts","Check All Accounts",""<endrec>
"CUSTOMER","28","2","11833","2338","Customer requests buy goods voucher V2.0","__committerParams.ReasonTypeCode=__params.ReasonTypeCode;
__next='1b';
__exemode='continue';","1a","Is Support Secret Code","Is Support Secret Code",""<endrec>
"CUSTOMER","","3","11834","2338","Customer requests buy goods voucher V2.0","if(__input.lastCommitResult.isSucess){
    var isSupportSecretCode = __input.lastCommitResult.result;
    if(isSupportSecretCode==true){
        __next = '1c';
        __exemode='continue';
    }
    else{
       __next = '2a';
       __exemode='continue';
    }
}else{
   __errormsg = 'Sorry,check isSupportSecretCode faild.';
   __next = 'error';
}","1b","Check Is Support Secret Code","Check Is Support Secret Code",""<endrec>
"CUSTOMER","68","4","11835","2338","Customer requests buy goods voucher V2.0","__next='1d';
__exemode='continue';","1c","Query Secret Code Rule","Query Secret Code Rule",""<endrec>
"CUSTOMER","","5","11836","2338","Customer requests buy goods voucher V2.0","if (__input.lastCommitResult.isSucess)
{
    secretCodeRule =__input.lastCommitResult.result;
   if(empty(secretCodeRule )){
       __errormsg = 'The Secret Code Rule is empty.';
       __next = 'error';
   }else {
__params.minLength = secretCodeRule.getMinLength();
__params.maxLength = secretCodeRule.getMaxLength();
__params.rule = secretCodeRule.getRule();
__params.info = 'Enter a secret code:';
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying Secret Code Rule.';
   __next = 'error';
}","1d","Check Secret Code Rule","Check Secret Code Rule",""<endrec>
"CUSTOMER","57","7","11837","2338","Customer requests buy goods voucher V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__next='2b';
__exemode='continue';","2a","Query Multi Account","Query Multi Account",""<endrec>
"CUSTOMER","","8","11838","2338","Customer requests buy goods voucher V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
        __next = '3';
        __params.ReceiverAccountNo= ''; 
   }else {
      __next='2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","2b","Check Multi Account","Check Multi Account",""<endrec>
"CUSTOMER","63","2","11839","2339","Customer withdraw e-money from float to bank account via handset V2.0","__next='1b';
__exemode='continue';","1a","Query Defaul Sp Id","",""<endrec>
"CUSTOMER","","3","11840","2339","Customer withdraw e-money from float to bank account via handset V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.defaultSpId=__input.lastCommitResult.result;
    __params.ReceiverPartyIdentifier = __tempData.defaultSpId;
    __next='1';
}else{
   __errormsg = 'Sorry,error occured when querying default Sp Id.';
   __next = 'error';
}","1b","Get Default Sp Id","Get Default Sp Id",""<endrec>
"CUSTOMER","55","5","11841","2339","Customer withdraw e-money from float to bank account via handset V2.0","__committerParams.IdentifierType=__params.InitiatorIdentifierType;
   __committerParams.IdentifierValue=__params.InitiatorIdentifier;
   __committerParams.PartnerBank='0';
   __next='2b';
   __exemode='continue';","2a","Query  Bank Account List","Query  Bank Account List",""<endrec>
"CUSTOMER","","6","11842","2339","Customer withdraw e-money from float to bank account via handset V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.bankAccounts=__input.lastCommitResult.result;
   if(empty(__tempData.bankAccounts)|| size(__tempData.bankAccounts)==0){
       __errormsg = 'Sorry, there is not any bank account.';
       __next = 'error';
   }else {
       __next = '2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying bank account.';
   __next = 'error';
}","2b","Check Bank Accounts List","Check Bank Accounts List",""<endrec>
"CUSTOMER","55","1","11843","2340","Delete Bank Account V2.0","__next  = '1a';
__committerParams.IdentifierType='01';
__committerParams.IdentifierValue=__msisdn;
__committerParams.PartnerBank='';
__exemode = 'continue';","1","Query Bank Account List","Query Bank Account List",""<endrec>
"CUSTOMER","","3","11844","2340","Delete Bank Account V2.0","__tempData.bankAccountList= __input.lastCommitResult.result;
   if (empty( __tempData.bankAccountList) || size(__tempData.bankAccountList) == 0)
   {
      __errormsg = 'Sorry, faild to get bankAccountList.';
      __next = 'error';
   } else
   {
       __next = '2';
   }","1a","check Bank Account List","check Bank Account List",""<endrec>
"CUSTOMER","60","2","11845","2341","Delete Bank Card Lookup V2.0","__next  = '1a';
__committerParams.QueryIdentifierType= __params.QueryIdentifierType;
__committerParams.QueryIdentifierValue= __params.QueryIdentifierValue;
__exemode = 'continue';","1","Query Bank Look up List","Query Bank Look up List",""<endrec>
"CUSTOMER","","3","11846","2341","Delete Bank Card Lookup V2.0","__tempData.bankLookupList = __input.lastCommitResult.result;
   if (empty( __tempData.bankLookupList ) || size(__tempData.bankLookupList ) == 0)
   {
      __errormsg = 'Sorry, faild to get bankAccountList.';
      __next = 'error';
   } else
   {
       __next = '2';
   }","1a","Check Bank Look Up List","Check Bank Look Up List",""<endrec>
"CUSTOMER","23","2","11847","2342","Delete Beneficiary V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__committerParams.IdentityType='1000';
__next='1b';
__exemode='continue';","1a","Query Customer Beneficiary","Query Customer Beneficiary",""<endrec>
"CUSTOMER","","3","11848","2342","Delete Beneficiary V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.custBeneficiaries = __input.lastCommitResult.result;
   __next='2a';
   __exemode='continue';
}else{
   __errormsg = 'Sorry,error occured when querying customer beneficiary.';
   __next = 'error';
}","1b","Check Customer Beneficiary","Check Customer Beneficiary",""<endrec>
"CUSTOMER","23","4","11849","2342","Delete Beneficiary V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__committerParams.IdentityType='5000';
__next='2b';
__exemode='continue';","2a","Query Organization Beneficiary","Query Organization Beneficiary",""<endrec>
"CUSTOMER","","5","11850","2342","Delete Beneficiary V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.orgBeneficiaries=__input.lastCommitResult.result;
   __next='3a';
   __exemode='continue';
}else{
   __errormsg = 'Sorry,error occured when querying organization beneficiary.';
   __next = 'error';
}","2b","Check Organization Beneficiary","Check Organization Beneficiary",""<endrec>
"CUSTOMER","23","6","11851","2342","Delete Beneficiary V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
   __committerParams.IdentityType='7000';
   __next='3b';
   __exemode='continue';","3a","Query Group Beneficiary","Query Group Beneficiary",""<endrec>
"CUSTOMER","","7","11852","2342","Delete Beneficiary V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.groupBeneficiaries=__input.lastCommitResult.result;
   __next='4a';
   __exemode='continue';
}else{
   __errormsg = 'Sorry,error occured when querying group beneficiary.';
   __next = 'error';
}","3b","Check Group Beneficiary","Check Group Beneficiary",""<endrec>
"CUSTOMER","","8","11853","2342","Delete Beneficiary V2.0","if ((!empty(__tempData.custBeneficiaries) and size(__tempData.custBeneficiaries)>0)
        ||(!empty(__tempData.groupBeneficiaries) and size(__tempData.groupBeneficiaries)>0)
		||(!empty(__tempData.orgBeneficiaries) and size(__tempData.orgBeneficiaries)>0))
    {
      __next = '4';
    } else {
      __errormsg = 'There is no beneficiary exist.';
      __next = 'error';
    }","4a","Check All Beneficiaries","Check All Beneficiaries",""<endrec>
"CUSTOMER","30","2","11854","2343","Delete Group Bank Account V2.0","__next  = '1a';
__committerParams.MSISDN=__msisdn;
__exemode = 'continue';","1","query My Groups","query My Groups",""<endrec>
"CUSTOMER","","3","11855","2343","Delete Group Bank Account V2.0","__tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups ) || size(__tempData.groups ) == 0)
   {
      __errormsg = 'Sorry, you have no groups .';
      __next = 'error';
   } else
   {
       __next = '2';
   }","1a","check My Group","check My Group",""<endrec>
"CUSTOMER","31","7","11856","2343","Delete Group Bank Account V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__next = '5a';
__exemode = 'continue';","5","Query Group Member Roles","Query Group Member Roles",""<endrec>
"CUSTOMER","","8","11857","2343","Delete Group Bank Account V2.0","__tempData.roleList = __input.lastCommitResult.result;

if (!empty(__tempData.roleList ) || size(__tempData.roleList )>0) {
  __next = '6';
__exemode = 'continue';
 } else {
   __errormsg = 'no current group member role.';
   __next = 'error';
 }","5a","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","55","9","11858","2343","Delete Group Bank Account V2.0","__next  = '6a';
__committerParams.IdentifierType='15';
__committerParams.IdentifierValue=__params.ReceiverPartyIdentifier ;
__committerParams.PartnerBank='';
__exemode = 'continue';","6","query Bank Account","query Bank Account",""<endrec>
"CUSTOMER","","10","11859","2343","Delete Group Bank Account V2.0","__tempData.bankAccountList= __input.lastCommitResult.result;
   if (empty( __tempData.bankAccountList) || size(__tempData.bankAccountList) == 0)
   {
      __errormsg = 'Sorry, you have no bankAccount.';
      __next = 'error';
   } else
   {
       __next = '7';
   }","6a","check Bank Account List","check Bank Account List",""<endrec>
"CUSTOMER","36","3","11860","2344","Disable CNS V2.0","__committerParams.params = __params;
__next = '2a';
__exemode = 'continue';","2","Build Customer Info","Build Customer Info",""<endrec>
"CUSTOMER","","4","11861","2344","Disable CNS V2.0","__params.KYCInfo = __input.lastCommitResult.result;
__next = '3';","2a","Get Customer Info","Get Customer Info",""<endrec>
"CUSTOMER","36","3","11862","2345","Enable CNS V2.0","__committerParams.params = __params;
__next = '2a';
__exemode = 'continue';","2","Build Customer Info","Build Customer Info",""<endrec>
"CUSTOMER","","4","11863","2345","Enable CNS V2.0","__params.KYCInfo = __input.lastCommitResult.result;
__next = '3';","2a","Get Customer Info","Get Customer Info",""<endrec>
"CUSTOMER","72","3","11864","2346","Group ATM Deposit Voucher V2.0","__next='2b';
__exemode='continue';","2a","Query ATM Provider of Deposit","Query ATM Provider of Deposit",""<endrec>
"CUSTOMER","","4","11865","2346","Group ATM Deposit Voucher V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.providerName='';
    __tempData.atmProviders = __input.lastCommitResult.result;
   if(empty(__tempData.atmProviders )|| size(__tempData.atmProviders )==0){
       __errormsg = 'Sorry, there is not any ATM providers.';
       __next = 'error';
   }else if(size(__tempData.atmProviders ) == 1) 
   {
      __tempData.providerName= atmProviders.get(0);
      __next = '2c';
      __exemode='continue';
   } else{
       __next = '2';
   }
}else{
   __errormsg = 'Query ATM Provider for Deposit failed.';
   __next = 'error';
}","2b","Check ATM Provider of Deposit","Check ATM Provider of Deposit",""<endrec>
"CUSTOMER","34","6","11866","2346","Group ATM Deposit Voucher V2.0","__committerParams.ProvideName=__tempData.providerName;
__next='2d';
__exemode='continue';","2c","Query Short Code By Name","Query Short Code By Name",""<endrec>
"CUSTOMER","","7","11867","2346","Group ATM Deposit Voucher V2.0","if (__input.lastCommitResult.isSucess)
{
    __params.ShortCode= __input.lastCommitResult.result;
    __next='3';
}else{
   __errormsg = 'Sorry,error occured when querying short code by name.';
   __next = 'error';
}","2d","Check Short Code","Check Short Code",""<endrec>
"CUSTOMER","35","3","11868","2347","Group ATM Withdraw Voucher V2.0","__next='2b';
__exemode='continue';","2a","Query All ATM Provider","Query All ATM Provider",""<endrec>
"CUSTOMER","","4","11869","2347","Group ATM Withdraw Voucher V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.providerName='';
    __tempData.atmProviders = __input.lastCommitResult.result;
   if(empty(__tempData.atmProviders )|| size(__tempData.atmProviders )==0){
       __errormsg = 'Sorry, there is not any ATM providers.';
       __next = 'error';
   }else if(size(__tempData.atmProviders ) == 1) 
   {
      __tempData.providerName= atmProviders.get(0);
      __next = '2c';
      __exemode='continue';
   } else{
       __next = '2';
   }
}else{
   __errormsg = 'Query ATM Provider for Deposit failed.';
   __next = 'error';
}","2b","Check ATM Provider of Deposit","Check ATM Provider of Deposit",""<endrec>
"CUSTOMER","34","6","11870","2347","Group ATM Withdraw Voucher V2.0","__committerParams.ProvideName=__tempData.providerName;
__next='2d';
__exemode='continue';","2c","Query Short Code By Name","Query Short Code By Name",""<endrec>
"CUSTOMER","","7","11871","2347","Group ATM Withdraw Voucher V2.0","if (__input.lastCommitResult.isSucess)
{
    __params.ShortCode= __input.lastCommitResult.result;
    __next='3';
}else{
   __errormsg = 'Sorry,error occured when querying short code by name.';
   __next = 'error';
}","2d","Check Short Code","Check Short Code",""<endrec>
"CUSTOMER","30","2","11872","2348","Group Activate Card V2.0","__committerParams.MSISDN = __msisdn;
__next = '1b';
__exemode = 'continue';","1a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","3","11873","2348","Group Activate Card V2.0","__tempData.groups = __input.lastCommitResult.result;
__next = '2';","1b","Query My Groups copy","Query My Groups",""<endrec>
"CUSTOMER","31","7","11874","2348","Group Activate Card V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;

__next = '2d';
__exemode = 'continue';","2c","Query Group Member Roles","Query Group Member Roles",""<endrec>
"CUSTOMER","","8","11875","2348","Group Activate Card V2.0","var result = __input.lastCommitResult.result;
if (empty(result) || size(result) == 0) {
    __errormsg = 'no current group member role.';
    __next = 'error';
} else {
    __next = '3a';
    __exemode = 'continue';
}","2d","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","46","9","11876","2348","Group Activate Card V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__committerParams.AccessDeviceIdentifier = __params.AccessDeviceIdentifier;
__committerParams.AccessDeviceIdentifierType = __params.AccessDeviceIdentifierType;
__committerParams.queryCardType = '1';  /* activate */

__next = '3b';
__exemode = 'continue';","3a","Query Activate Card Type Infos","Query Activate Card Type Infos",""<endrec>
"CUSTOMER","","10","11877","2348","Group Activate Card V2.0","__tempData.cardTypes = __input.lastCommitResult.result;

if (empty(__tempData.cardTypes)) {
    __errormsg = 'You have no Card Type.';
    __next = 'error'
} else {
    __next = '4';
}","3b","Check Card Type","Check Card Type",""<endrec>
"CUSTOMER","30","2","11878","2349","Group Activate Direct Debit Mandate V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='1b';
__exemode='continue';","1a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","3","11879","2349","Group Activate Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","1b","Check Groups","Check Groups",""<endrec>
"CUSTOMER","54","5","11880","2349","Group Activate Direct Debit Mandate V2.0","__committerParams.ServiceCode=__params.ServiceCode;
       __committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
       __committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
       __committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
       __committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
       __committerParams.AccessDeviceIdentifier=__params.AccessDeviceIdentifier;
       __committerParams.AccessDeviceIdentifierType=__params.AccessDeviceIdentifierType;
       __committerParams.MandateStatus=__params.MandateStatus;

__next='2b';
__exemode='continue';","2a","Query Direct Debit Mandates","Query Direct Debit Mandates",""<endrec>
"CUSTOMER","","6","11881","2349","Group Activate Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.mandateList =__input.lastCommitResult.result;
   if(empty(__tempData.mandateList )||size(__tempData.mandateList )==0){
       __errormsg = 'No Available Mandates.';
       __next = 'error';
   }else {
       __next = '2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying direct debit mandates.';
   __next = 'error';
}","2b","Check Direct Debit Mandates","Check Direct Debit Mandates",""<endrec>
"CUSTOMER","30","3","11882","2350","Group Buy Foreign Currency V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='1b';
__exemode='continue';","1a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","4","11883","2350","Group Buy Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","1b","Check Groups","Check Groups",""<endrec>
"CUSTOMER","59","10","11884","2350","Group Buy Foreign Currency V2.0","__next='4b';
__exemode='continue';","4a","Query Default Currency","Query Default Currency",""<endrec>
"CUSTOMER","58","7","11885","2350","Group Buy Foreign Currency V2.0","__next='3b';
__exemode='continue';","3a","Query All Foreign Currency","Query All Foreign Currency",""<endrec>
"CUSTOMER","","8","11886","2350","Group Buy Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying foreign currencyCode.';
   __next = 'error';
}","3b","Check All Foreign Currency","Check All Foreign Currency",""<endrec>
"CUSTOMER","","11","11887","2350","Group Buy Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.defaultCurrencyCode =__input.lastCommitResult.result;
    __next='4';
}else{
   __errormsg = 'Sorry,error occured when querying defaultCurrencyCode.';
   __next = 'error';
}","4b","Get Default Currency","Get Default Currency",""<endrec>
"CUSTOMER","29","14","11888","2350","Group Buy Foreign Currency V2.0","__committerParams.IdentityType = '7000';
__committerParams.IdentityId = __params.PrimaryPartyIdentifier;
__committerParams.IdentifierType=__params.PrimaryPartyIdentifierType;
__committerParams.AccountTypeAlias = 'Group float';
__committerParams.Currency = __params.SourceCurrency;
__next='6b';
__exemode='continue';","6a","Query Group Multi Accounts","Query Group Multi Accounts",""<endrec>
"CUSTOMER","","15","11889","2350","Group Buy Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='6';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","6b","Check Group Multi Accounts","Check Group Multi Accounts",""<endrec>
"CUSTOMER","62","18","11890","2350","Group Buy Foreign Currency V2.0","__committerParams.SourceCurrency=__params.SourceCurrency;
__committerParams.DestinationCurrency=__params.DestinationCurrency;
__committerParams.BaseCurrency=__params.BaseCurrency;
__committerParams.BaseAmount=__params.BaseAmount;
__next='8b';
__exemode='continue';","8a","Query Fx Rate and Amount","Query Fx Rate and Amount",""<endrec>
"CUSTOMER","","19","11891","2350","Group Buy Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.rateInfo=__input.lastCommitResult.result;
    __next='8';
}else{
   __errormsg = 'Sorry,error occured when querying rateInfo.';
   __next = 'error';
}","8b","Get Fx Rate and Amount","Get Fx Rate and Amount",""<endrec>
"CUSTOMER","30","2","11892","2351","Group Cancel Card V2.0","__committerParams.MSISDN = __msisdn;
__next = '1b';
__exemode = 'continue';","1a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","3","11893","2351","Group Cancel Card V2.0","__tempData.groups = __input.lastCommitResult.result;
__next = '2';","1b","Get My Groups","Get My Groups",""<endrec>
"CUSTOMER","31","7","11894","2351","Group Cancel Card V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;

__next = '2d';
__exemode = 'continue';","2c","Query Group Member Roles","Query Group Member Roles",""<endrec>
"CUSTOMER","","8","11895","2351","Group Cancel Card V2.0","var result = __input.lastCommitResult.result;
if (empty(result) || size(result) == 0) {
    __errormsg = 'no current group member role.';
    __next = 'error';
} else {
    __next = '3a';
    __exemode = 'continue';
}","2d","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","46","9","11896","2351","Group Cancel Card V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__committerParams.AccessDeviceIdentifier = __params.AccessDeviceIdentifier;
__committerParams.AccessDeviceIdentifierType = __params.AccessDeviceIdentifierType;
__committerParams.queryCardType = '2';  /* cancel */

__next = '3b';
__exemode = 'continue';","3a","Query Cancel Card Type Infos","Query Cancel Card Type Infos",""<endrec>
"CUSTOMER","","10","11897","2351","Group Cancel Card V2.0","__tempData.cardTypes = __input.lastCommitResult.result;

if (empty(__tempData.cardTypes)) {
    __errormsg = 'You have no Card Type.';
    __next = 'error'
} else {
    __next = '4';
}","3b","Check Card Type","Check Card Type",""<endrec>
"CUSTOMER","30","3","11898","2352","Group Cancel Direct Debit Mandate V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='1b';
__exemode='continue';","1a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","4","11899","2352","Group Cancel Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","1b","Check Groups","Check Groups",""<endrec>
"CUSTOMER","31","7","11900","2352","Group Cancel Direct Debit Mandate V2.0","__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
    __committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
    __committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
    __committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
    __next='3b';
   __exemode='continue';","3a","Query Group Member Role","Query Group Member Role",""<endrec>
"CUSTOMER","","8","11901","2352","Group Cancel Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.roleList =__input.lastCommitResult.result;
   if(empty(__tempData.roleList)|| size(__tempData.roleList)==0){
       __errormsg = 'no current group member role.';
       __next = 'error';
   }else {
       __next = '4a';
       __exemode='continue';
   }
}else{
   __errormsg = 'Sorry,error occured when querying current group member role.';
   __next = 'error';
}","3b","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","54","9","11902","2352","Group Cancel Direct Debit Mandate V2.0","__committerParams.ServiceCode=__params.ServiceCode;
       __committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
       __committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
       __committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
       __committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
       __committerParams.AccessDeviceIdentifier=__params.AccessDeviceIdentifier;
       __committerParams.AccessDeviceIdentifierType=__params.AccessDeviceIdentifierType;
       __committerParams.MandateStatus=__params.MandateStatus;

__next='4b';
__exemode='continue';","4a","Query Direct Debit Mandates","Query Direct Debit Mandates",""<endrec>
"CUSTOMER","","10","11903","2352","Group Cancel Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.mandateList =__input.lastCommitResult.result;
   if(empty(__tempData.mandateList )||size(__tempData.mandateList )==0){
       __errormsg = 'No Available Mandates.';
       __next = 'error';
   }else {
       __next = '5';
   }
}else{
   __errormsg = 'Sorry,error occured when querying direct debit mandates.';
   __next = 'error';
}","4b","Check Direct Debit Mandates","Check Direct Debit Mandates",""<endrec>
"CUSTOMER","30","2","11904","2353","Group Edit Direct Debit Mandate V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='1b';
__exemode='continue';","1a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","3","11905","2353","Group Edit Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","1b","Check Groups","Check Groups",""<endrec>
"CUSTOMER","31","7","11906","2353","Group Edit Direct Debit Mandate V2.0","__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
    __committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
    __committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
    __committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
   __next='3b';
   __exemode='continue';","3a","Query Group Member Role","Query Group Member Role",""<endrec>
"CUSTOMER","","8","11907","2353","Group Edit Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.roleList =__input.lastCommitResult.result;
   if(empty(__tempData.roleList)|| size(__tempData.roleList)==0){
       __errormsg = 'no current group member role.';
       __next = 'error';
   }else {
       __next = '4a';
       __exemode='continue';
   }
}else{
   __errormsg = 'Sorry,error occured when querying current group member role.';
   __next = 'error';
}","3b","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","54","9","11908","2353","Group Edit Direct Debit Mandate V2.0","__committerParams.ServiceCode=__params.ServiceCode;
    __committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
    __committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
    __committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
    __committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
       __committerParams.AccessDeviceIdentifier=__params.AccessDeviceIdentifier;
       __committerParams.AccessDeviceIdentifierType=__params.AccessDeviceIdentifierType;
       __committerParams.MandateStatus=__params.MandateStatus;

__next='4b';
__exemode='continue';","4a","Query Direct Debit Mandates","Query Direct Debit Mandates",""<endrec>
"CUSTOMER","","10","11909","2353","Group Edit Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.mandateList =__input.lastCommitResult.result;
   if(empty(__tempData.mandateList )||size(__tempData.mandateList )==0){
       __errormsg = 'No Available Mandates.';
       __next = 'error';
   }else {
       __next = '5';
   }
}else{
   __errormsg = 'Sorry,error occured when querying direct debit mandates.';
   __next = 'error';
}","4b","Check Direct Debit Mandates","Check Direct Debit Mandates",""<endrec>
"CUSTOMER","79","29","11910","2358","Group G2G Transfer With Prevalidation V2.0","__committerParams.notificationParams = __tempData.notificationParams;
__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.recipientList;
__committerParams.Channel = __params.Channel;
__next='13b';
__exemode='continue';","13a","send PreValidation Notification","send PreValidation Notification",""<endrec>
"CUSTOMER","30","4","11911","2358","Group G2G Transfer With Prevalidation V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b1';
__exemode='continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","11912","2358","Group G2G Transfer With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check groups","Check groups",""<endrec>
"CUSTOMER","23","9","11913","2358","Group G2G Transfer With Prevalidation V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__committerParams.IdentityType ='7000';
__next='4b1';
__exemode='continue';","4b0","Query Group Beneficiary","Query Group Beneficiary",""<endrec>
"CUSTOMER","","10","11914","2358","Group G2G Transfer With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.beneficiaries = __input.lastCommitResult.result;
   if (empty(__tempData.beneficiaries ) || size(__tempData.beneficiaries ) == 0) {
      __errormsg = 'There is no beneficiary exist.';
      __next = 'error';
    } else {
       __next = '4b';
    }
}else{
   __errormsg = 'Sorry,error occured when querying group beneficiary.';
   __next = 'error';
}","4b1","Check Group Beneficiary","Check Group Beneficiary",""<endrec>
"CUSTOMER","77","18","11915","2358","Group G2G Transfer With Prevalidation V2.0","__committerParams.IdentityType ='1000';
__committerParams.Identifier = __msisdn;
__committerParams.IdentifierType = '01';
__committerParams.queryType = 0;
__next='10b';
__exemode='continue';","10a","Query Pre-Validation Notification Info","Query Pre-Validation Notification Info",""<endrec>
"CUSTOMER","","19","11916","2358","Group G2G Transfer With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.recipientList=__input.lastCommitResult.result;
    __next = '10c';
    __exemode='continue';
}else{
   __errormsg = 'Sorry,query Pre-Validation Notification Info failed.';
   __next = 'error';
}","10b","Get Recipient List","Get Recipient List",""<endrec>
"CUSTOMER","76","20","11917","2358","Group G2G Transfer With Prevalidation V2.0","__next='10d';
__exemode='continue';","10c","Calculate PreValidation Fee","Calculate PreValidation Fee",""<endrec>
"CUSTOMER","","21","11918","2358","Group G2G Transfer With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.budgetMap =__input.lastCommitResult.result;
   if(empty(__tempData.budgetMap)){
       __errormsg = 'budget map is empty.';
       __next = 'error'; 
   }else{    
       __next = '10d0';
       __exemode='continue';
   }
}else{
   __errormsg = 'Pre-Validation is failed,Please check notification.';
   __tempData.notificationParams.TransactionUMCPreValidationEvent='Failed';
   __tempData.notificationParams.TransactionUMCPreValidationError=__input.lastCommitResult.errorMessage;
   __tempData.notificationParams.put('Common.Result.ErrorCode','TS28009');
   __tempData.notificationParams.errDesc='Pre-Validation Failed.';
   if (empty(__tempData.recipientList)) {
     __errormsg = 'The recipient is null and send notification failed.';
     __next='error';
   } else {
      __next = '13a';
      __exemode='continue';
   }
}","10d","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"CUSTOMER","80","22","11919","2358","Group G2G Transfer With Prevalidation V2.0","__committerParams.Category = 'PayBillPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.TaxMsgFormat = ':The amount of tax is: %s';
__committerParams.ItemSeperator = '<br>';
__committerParams.ShowPublicName = true;
__committerParams.FeeInfo = __tempData.budgetMap;

__next = '10d1';
__exemode = 'continue';","10d0","Prepare Confirm Messsage","Prepare Confirm Messsage",""<endrec>
"CUSTOMER","","23","11920","2358","Group G2G Transfer With Prevalidation V2.0","var isSuccess = __input.lastCommitResult.isSucess;
if(isSuccess)
{
    __tempData.promptMsg =  __input.lastCommitResult.result.FeeInfoMSG;
    __next = '11';
}
else
{
    __next  = 'error';
}","10d1","Check Confirm Messsage","Check Confirm Messsage",""<endrec>
"CUSTOMER","78","25","11921","2358","Group G2G Transfer With Prevalidation V2.0","__committerParams.EventType=__params.EventType;
__committerParams.Channel =  __params.Channel;
__committerParams.ResultCode ='0';
__committerParams.ResultType='1';
__committerParams.Reason = 'Continue Pre-Validation Transaction.  ChannelSessionID=' + __sessionID;
previousSavingLog='continue';
__next='11b';
__exemode='continue';","11a","Saving PreValidation Event Log for continue","Saving PreValidation Event Log for continue",""<endrec>
"CUSTOMER","78","26","11922","2358","Group G2G Transfer With Prevalidation V2.0","__committerParams.EventType=__params.EventType;
__committerParams.Channel =  __params.Channel;
__committerParams.ResultCode ='1';
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __sessionID;
previousSavingLog='rejected';
__next='11b';
__exemode='continue';","11a1","Saving PreValidation Event Log for Reject","Saving PreValidation Event Log for Reject",""<endrec>
"CUSTOMER","","27","11923","2358","Group G2G Transfer With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
   if(previousSavingLog=='rejected'){
      __tempData.notificationParams.TransactionUMCPreValidationEvent='Rejected';
      __tempData.notificationParams.TransactionUMCPreValidationError='Choosing Reject';
     __tempData.notificationParams.put('Common.Result.ErrorCode','TS28009');
     __tempData.notificationParams.errDesc='Pre-Validation Result is Rejected.';
     if (empty(__tempData.recipientList)) {
       __errormsg = 'The recipient is null and send notification failed.';
       __next='error';
     } else {
       __next='13a';
       __exemode='continue';
     }
   }else{
       __next = 'end';
   }
}else{
   __errormsg = 'Sorry,saved pre-validation event log failed';
   __next = 'error';
}","11b","Check Saving Log","Check Saving Log",""<endrec>
"CUSTOMER","30","4","11924","2357","Group G2G Transfer V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b1';
__exemode='continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","11925","2357","Group G2G Transfer V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check Groups","Check Groups",""<endrec>
"CUSTOMER","23","9","11927","2357","Group G2G Transfer V2.0","__committerParams.MSISDN =__msisdn;
__committerParams.IdentityType ='7000';
__next='4b1';
__exemode='continue';","4b0","Query Group Beneficiary","Query Group Beneficiary",""<endrec>
"CUSTOMER","","10","11928","2357","Group G2G Transfer V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.beneficiaries= __input.lastCommitResult.result;
   if (empty(__tempData.beneficiaries) || size(__tempData.beneficiaries) == 0) {
      __errormsg = 'There is no beneficiary exist.';
      __next = 'error';
    } else {
       __next = '4b';
    }
}else{
   __errormsg = 'Sorry,error occured when querying group beneficiary.';
   __next = 'error';
}","4b1","Check Group Beneficiary","Check Group Beneficiary",""<endrec>
"CUSTOMER","30","4","11929","2359","Group G2P Transfer V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b1';
__exemode='continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","11930","2359","Group G2P Transfer V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check Groups","Check Groups",""<endrec>
"CUSTOMER","23","4","11931","2360","Group P2G Transfer V2.0","__committerParams.MSISDN =__msisdn;
__committerParams.IdentityType ='7000';
__next='2b1';
__exemode='continue';","2b0","Query Group Beneficiary","Query Group Beneficiary",""<endrec>
"CUSTOMER","","5","11932","2360","Group P2G Transfer V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.beneficiaries= __input.lastCommitResult.result;
   if (empty(__tempData.beneficiaries) || size(__tempData.beneficiaries) == 0) {
      __errormsg = 'There is no beneficiary exist.';
      __next = 'error';
    } else {
       __next = '2b';
    }
}else{
   __errormsg = 'Sorry,error occured when querying group beneficiary.';
   __next = 'error';
}","2b1","Check Group Beneficiary","Check Group Beneficiary",""<endrec>
"CUSTOMER","30","4","11933","2361","Group Pay Bill V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='1b1';
__exemode='continue';","1b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","11934","2361","Group Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '1b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","1b1","Check groups","Check groups",""<endrec>
"CUSTOMER","81","13","11935","2361","Group Pay Bill V2.0","__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.ReceiverPartyIdentifier=__params.ReceiverPartyIdentifier;
__next='8b';
__exemode='continue';","8a","Query Identity Name","Query Identity Name",""<endrec>
"CUSTOMER","","14","11936","2361","Group Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.cust= __input.lastCommitResult.result;
   if(empty(__tempData.cust)){
       __errormsg = 'Sorry,query identity info failed.';
       __next = 'error';
   }else {
       __next = '8c';
       __exemode='continue';
   }
}else{
   __errormsg = 'Sorry,query identity info failed.';
   __next = 'error';
}","8b","Check Identity Name","Check Identity Name",""<endrec>
"CUSTOMER","48","15","11937","2361","Group Pay Bill V2.0","__committerParams.SystemParamCode='SUPPORT_CNS_USSD_PUSH';
__next='8d';
__exemode='continue';","8c","Query isSupportCNS","Query isSupportCNS",""<endrec>
"CUSTOMER","","16","11938","2361","Group Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.isSupportCNS =__input.lastCommitResult.result=='1';
    __next='8';
}else{
   __errormsg = 'Sorry,check isSupportCNS failed.';
   __next = 'error';
}","8d","Get isSupportCNS","Get isSupportCNS",""<endrec>
"CUSTOMER","77","18","11939","2361","Group Pay Bill V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.Identifier = __msisdn;
__committerParams.IdentifierType = '01';
__committerParams.queryType = 0;
__next='9b';
__exemode='continue';","9a","Query Pre-Validation Notification Info","Query Pre-Validation Notification Info",""<endrec>
"CUSTOMER","","19","11940","2361","Group Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.recipientList =__input.lastCommitResult.result;
    __next = '9c';
    __exemode='continue';
}else{
   __errormsg = 'Sorry,query Pre-Validation Notification Info failed.';
   __next = 'error';
}","9b","Get Recipient List","Get Recipient List",""<endrec>
"CUSTOMER","76","20","11941","2361","Group Pay Bill V2.0","__next='9d';
__exemode='continue';","9c","Calculate PreValidation Fee","Calculate PreValidation Fee",""<endrec>
"CUSTOMER","","21","11942","2361","Group Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.budgetMap =__input.lastCommitResult.result;
   if(empty(__tempData.budgetMap)){
       __errormsg = 'Pre-Validation Result is empty.';
       __next = 'error';
   }else{
       __next='13a';
       __exemode='continue';
   }
}else{
        __errormsg = 'Pre-Validation is failed,Please check notification.';
        __tempData.notificationParams.TransactionUMCPreValidationEvent='Failed';
        __tempData.notificationParams.TransactionUMCPreValidationError=__input.lastCommitResult.errorMessage;
        __tempData.notificationParams.put('Common.Result.ErrorCode','TS28009');
        __tempData.notificationParams.errDesc='Pre-Validation Failed.';
       if (empty(__tempData.recipientList)) {
        __errormsg = 'The recipient is null and send notification failed.';
        __next='error';
       } else {
          __next = '12a';
          __exemode='continue';
       }
}","9d","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"CUSTOMER","78","24","11943","2361","Group Pay Bill V2.0","__committerParams.EventType=__params.EventType;
__committerParams.Channel =  __params.Channel;
__committerParams.ResultCode ='0';
__committerParams.ResultType='1';
__committerParams.Reason = 'Continue Pre-Validation Transaction.  ChannelSessionID=' + __sessionID;
previousSavingLog='continue';
__next='11b';
__exemode='continue';","11a","Saving PreValidation Event Log for continue","Saving PreValidation Event Log for continue",""<endrec>
"CUSTOMER","78","25","11944","2361","Group Pay Bill V2.0","__committerParams.EventType=__params.EventType;
__committerParams.Channel =  __params.Channel;
__committerParams.ResultCode ='1';
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __sessionID;
previousSavingLog='rejected';
__next='11b';
__exemode='continue';","11a1","Saving PreValidation Event Log for Reject","Saving PreValidation Event Log for Reject",""<endrec>
"CUSTOMER","","26","11945","2361","Group Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
   if(previousSavingLog=='rejected'){
      __tempData.notificationParams.TransactionUMCPreValidationEvent='Rejected';
      __tempData.notificationParams.TransactionUMCPreValidationError='Choosing Reject';
     __tempData.notificationParams.put('Common.Result.ErrorCode','TS28009');
     __tempData.notificationParams.errDesc='Pre-Validation Result is Rejected.';
     if (empty(__tempData.recipientList)) {
       __errormsg = 'The recipient is null and send notification failed.';
       __next='error';
     } else {
       __next='12a';
       __exemode='continue';
     }
   }else{
       __next = 'end';
   }
}else{
   __errormsg = 'Sorry,saving log failed.';
   __next = 'error';
}","11b","Check Saving Log","Check Saving Log",""<endrec>
"CUSTOMER","79","27","11946","2361","Group Pay Bill V2.0","__committerParams.notificationParams = __tempData.notificationParams;
__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.recipientList;
__committerParams.Channel = __params.Channel;

__next='12b';
__exemode='continue';","12a","Send PreValidation Notification","Send PreValidation Notification",""<endrec>
"CUSTOMER","","28","11947","2361","Group Pay Bill V2.0","if (__input.lastCommitResult.isSucess)
{
   if(__tempData.notificationParams.TransactionUMCPreValidationEvent=='Failed'){
       __next='10';
   }else if(__tempData.notificationParams.TransactionUMCPreValidationEvent=='Rejected'){
       __next = 'error';
   }
}else{
   __errormsg = 'Sorry,send pre-validation notification failed.';
   __next = 'error';
}","12b","Check Send PreValidation Notification","Check Send PreValidation Notification",""<endrec>
"CUSTOMER","80","29","11948","2361","Group Pay Bill V2.0","__committerParams.Category = 'PayBillPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.TaxMsgFormat = ':The amount of tax is: %s';
__committerParams.ItemSeperator = '<br>';
__committerParams.ShowPublicName = true;
__committerParams.FeeInfo = __tempData.budgetMap;

__next = '13b';
__exemode = 'continue';","13a","Prepare Confirm Messsage","Prepare Confirm Messsage",""<endrec>
"CUSTOMER","","30","11949","2361","Group Pay Bill V2.0","var isSucess = __input.lastCommitResult.isSucess;

if(isSucess)
{
    __tempData.promptMsg =  __input.lastCommitResult.result.FeeInfoMSG;

       var tips = '';
       __params.put('InitiatorCNSStatus',__tempData.cust.initiatorCNSStatus);
       __params.put('ReceiverCNSStatus',__tempData.cust.receiverCNSStatus);
       if(__tempData.cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' and __tempData.cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
      {
         firstname=empty(__tempData.cust.firstName)?'':__tempData.cust.firstName+' ';
         middleName=empty(__tempData.cust.middleName)?'':__tempData.cust.middleName+' ';
         lastName=empty(__tempData.cust.lastName)?'':__tempData.cust.lastName+' ';
         nameStr= firstname+middleName+lastName;	
	 tips = tips + 'Organization name : ' + nameStr + '<br>';
         if(nameStr != ''){
             __params.IsCNSDataDisplayed = 'Yes';
         }
       }
       tips = tips + 'Short code : ' +__tempData.cust.basicIdentifier;
       __tempData.tips=tips;

    __next = '9';
}
else
{
    __next  = 'error';
}","13b","Check Confirm Messsage","Check Confirm Messsage",""<endrec>
"CUSTOMER","","34","11950","2362","Group Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.rateInfo=__input.lastCommitResult.result;
    __next='15';
}else{
   __errormsg = 'Sorry,error occured when querying rateInfo.';
   __next = 'error';
}","15a","Check Fx Rate and Amount","Check Fx Rate and Amount",""<endrec>
"CUSTOMER","23","10","11953","2362","Group Payment With Foreign Exchange V2.0","__committerParams.MSISDN =__IdentityInfo.msisdn;
__committerParams.IdentityType ='1000';
__next='5b1';
__exemode='continue';","5b0","Query Customer Beneficiary","Query Customer Beneficiary",""<endrec>
"CUSTOMER","","11","11954","2362","Group Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.customerBeneficiaries= __input.lastCommitResult.result;
   if (empty(__tempData.customerBeneficiaries) || size(__tempData.customerBeneficiaries) == 0) {
      __errormsg = 'There is no beneficiary exist.';
      __next = 'error';
    } else {
       __next = '5b2';
    }
}else{
   __errormsg = 'Sorry,error occured when querying customer beneficiary.';
   __next = 'error';
}","5b1","Check Customer Beneficiary","Check Customer Beneficiary",""<endrec>
"CUSTOMER","30","3","11955","2362","Group Payment With Foreign Exchange V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b';
__exemode='continue';","2a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","4","11956","2362","Group Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b","Check My Group","Check My Group",""<endrec>
"CUSTOMER","23","15","11957","2362","Group Payment With Foreign Exchange V2.0","__committerParams.MSISDN =__IdentityInfo.msisdn;
__committerParams.IdentityType ='7000';
__next='6b1';
__exemode='continue';","6b0","Query Group Beneficiary","Query Group Beneficiary",""<endrec>
"CUSTOMER","","16","11958","2362","Group Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.groupBeneficiaries= __input.lastCommitResult.result;
   if (empty(__tempData.groupBeneficiaries) || size(__tempData.groupBeneficiaries) == 0) {
      __errormsg = 'There is no beneficiary exist.';
      __next = 'error';
    } else {
       __next = '6b2';
    }
}else{
   __errormsg = 'Sorry,error occured when querying group beneficiary.';
   __next = 'error';
}","6b1","Check Group Beneficiary","Check Group Beneficiary",""<endrec>
"CUSTOMER","24","19","11960","2362","Group Payment With Foreign Exchange V2.0","__next = '8b';
__exemode='continue';","8a","Query All Currency","Query All Currency",""<endrec>
"CUSTOMER","","20","11961","2362","Group Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='8c';
      __exemode='continue';
   }
}else{
   __errormsg = 'Sorry,error occured when querying foreign currencyCode.';
   __next = 'error';
}","8b","Check All Currency","Check All Currency",""<endrec>
"CUSTOMER","59","21","11962","2362","Group Payment With Foreign Exchange V2.0","__next='8d';
__exemode='continue';","8c","Query Default Currency","Query Default Currency",""<endrec>
"CUSTOMER","","22","11963","2362","Group Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.defaultCurrencyCode =__input.lastCommitResult.result;
   __next = '8';
}else{
   __errormsg = 'Sorry,error occured when querying defaultCurrencyCode.';
   __next = 'error';
}","8d","Check Default Currency","Check Default Currency",""<endrec>
"CUSTOMER","58","25","11964","2362","Group Payment With Foreign Exchange V2.0","__next='10b';
__exemode='continue';","10a","Query Foreign Currency","Query Foreign Currency",""<endrec>
"CUSTOMER","","26","11965","2362","Group Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiForeignCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiForeignCurrencyCode )|| size(__tempData.multiForeignCurrencyCode )==0){
       __errormsg = 'You have no currency to query.';
       __next = 'error';
   }else {
      __next='10';
   }
}else{
   __errormsg = 'Sorry,error occured when querying foreign currency.';
   __next = 'error';
}","10b","Check Foreign Currency","Check Foreign Currency",""<endrec>
"CUSTOMER","29","30","11966","2362","Group Payment With Foreign Exchange V2.0","__committerParams.IdentityType ='7000';
__committerParams.IdentifierType= __params.PrimaryPartyIdentifierType;
__committerParams.IdentityId = __params.PrimaryPartyIdentifier;
__committerParams.AccountTypeAlias = 'Group float';
__committerParams.Currency = __params.SourceCurrency;
__next='13b';
__exemode='continue';","13a","Query Multi Account","Query Multi Account",""<endrec>
"CUSTOMER","","31","11967","2362","Group Payment With Foreign Exchange V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='13';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","13b","Check Multi Account","Check Multi Account",""<endrec>
"TILL","","1","1201","1012","Operator change secret word","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ChangeSecretWord';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","1202","1012","Operator change secret word","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '2';
","1","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","1203","1012","Operator change secret word","var input = __input.response;
__params.NewSecretWord = input;
__secure = true;
__next = '3';
","2","Enter new secret word","<html>
<body>
Enter new secret word<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12035","2384","Buy Airtime from Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__params.BankCardOwnerInputType = '01'; /* MSISDN */
__params.BankCardOwnerInputValue = msisdn;
__params.QueryIdentifierType = '01'; /* MSISDN */
__params.QueryIdentifierValue = msisdn;
fiOrgList = IC.queryFiOrgList(__params);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","9","12036","2384","Buy Airtime from Bank Account","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '7';
} else {
    __next = '6';
}","6","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12037","2384","Buy Airtime from Bank Account","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifier = '2001'; /* China Mobile's short code */
  __next = '6';
} else {
  __next = '5';
}","5","Input MNO name","<html>
<body>
Input MNO name:<br>
1 China Mobile<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","12038","2384","Buy Airtime from Bank Account","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.RechargedMSISDN = beneficiaryMsisdn ;
  __next = '5';
} 
else{

  __next = '4b';
}","4b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12039","2384","Buy Airtime from Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.RechargedMSISDN = input;
  __next = '5';
} else {
  __next = '4a';
}","4a","Input MSISDN  Number","<html>
<body>
Input MSISDN Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","1204","1012","Operator change secret word","var input = __input.response;
if(__params.NewSecretWord == input)
{
__secure = true;
__next = '4';
}
else
{
__next = '2';
}","3","Confirm secret word","<html>
<body>
Confirm secret word<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12040","2384","Buy Airtime from Bank Account","beneficiaries = IC.queryCustListBeneficiary(msisdn);
var input = __input.response;
if (input == 1) {
	__next = '4a';
} else if (input == '2') {
	if (empty(beneficiaries) || size(beneficiaries) == 0) {
		__errormsg = 'Sorry, there is no beneficiary.';
		__next = 'error';
	} else {
		__next = '4b';
	}
} else {
	__next = '4';
}","4","Select option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12041","2384","Buy Airtime from Bank Account","var input = __input.response;
if (input == '1') {
  __params.RechargedMSISDN = msisdn;
  __next = '5';
} else if (input == '2') {
  __next = '4';
} else {
  __next = '3';
}","3","Select Phone","<html>
<body>
Please select phone :<br>
1 My phone<br>
2 Other phone<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","12042","2384","Buy Airtime from Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccounts)) {
   __params.BankCardId = bankAccounts.get(i).bankCardId;
  __params.BankAccountNo= bankAccounts.get(i).notMaskAccountNumber;
   __secure = true;
   __next = '3';
} else {
   __next = '2';
}","2","Select Bank Account","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","12043","2384","Buy Airtime from Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(fiOrgList)) {
	__params.ShortCode = fiOrgList.get(i).shortCode;
	__params.FIOrgIdentityId = fiOrgList.get(i).identityId;
        bankAccounts = IC.queryBankAccListByIdenAndBank(__params);
	__next = '2';
} else {
	__next = '1';
}","1","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","1205","1012","Operator change secret word","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '5';
","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","12057","2384","Buy Airtime from Bank Account","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","12058","2384","Buy Airtime from Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
Buy Airtime ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","1206","1012","Operator change secret word","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to Change secret word?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","12075","2391","Buy Airtime from Org Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */
__params.PrimaryPartyIdentifierType = '04'; /* SHORT_CODE*/
shortCode = IC.queryShortCodeByTillMsisdn(Util.toLong(msisdn));
  __params.PrimaryPartyIdentifier = shortCode;
  __params.QueryIdentifierType =  '04'; /* SHORT_CODE*/
  __params.QueryIdentifierValue = shortCode;
fiOrgList = IC.queryFiOrgList(__params);
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","12076","2391","Buy Airtime from Org Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(fiOrgList)) {
	__params.ShortCode = fiOrgList.get(i).shortCode;
	__params.FIOrgIdentityId = fiOrgList.get(i).identityId;
        bankAccounts = IC.queryBankAccListByIdenAndBank(__params);
	__next = '2';
} else {
	__next = '1';
}","1","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","12077","2391","Buy Airtime from Org Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccounts)) {
   __params.BankCardId = bankAccounts.get(i).bankCardId;
  __params.BankAccountNo= bankAccounts.get(i).notMaskAccountNumber;
   __secure = true;
   __next = '3';
} else {
   __next = '2';
}","2","Select Bank Account","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","12078","2391","Buy Airtime from Org Bank Account","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifier = '2001'; /* China Mobile's short code */
  __next = '5';
} else {
  __next = '4';
}","4","Enter MNO name","<html>
<body>
Enter MNO <br>
1 China Mobile<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","12079","2391","Buy Airtime from Org Bank Account","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Enter amount","<html>
<body>
Enter amount <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","12080","2391","Buy Airtime from Org Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","12081","2391","Buy Airtime from Org Bank Account","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","12082","2391","Buy Airtime from Org Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '9';
}","8","Confirm","<html><body>Buy Airtime ${__params.RechargedMSISDN} ${__params.Amount}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","12083","2391","Buy Airtime from Org Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.RechargedMSISDN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Input MSISDN Number","<html>
<body>
Input MSISDN Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12094","2395","ChangeCustomerQA","__params.ActionType='ChangeCustQA';
__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
questionPolicy = IC.queryQuestionPolicy();
minquestnum = questionPolicy.getQuestionNumber();
num = 1;
__tempData = __params;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12095","2395","ChangeCustomerQA","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(question.getItems())){
  __tempData.selectQuestion = question.getItems().get(i).getDefaultName();
  if(Validator.checkQuestion(__tempData)){
    __tempData.QuestionCode=question.getItems().get(i).getDefaultName();
    __next = '2';
  }	
} 
else {
  __next = '1';
}","1","Select Question","<html>
<body>
Question ${num}:<br>
$$question = Util.queryDataDictTypeByKey('CPS_SYSTEM_QUESTIONS')
$$var i = 1;
$$for (ques: question.getItems()) {
  ${i} ${ques.getDefaultName()}<br>
$$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12096","2395","ChangeCustomerQA","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to change your Question?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12097","2395","ChangeCustomerQA","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","12098","2395","ChangeCustomerQA","var input = __input.response;
if (Validator.checkQAAnser(input)) {
  __tempData.Answer = input;
  __next = '3';
}else {
  __next = '2';
}","2","Enter Answer","<html>
<body>
Enter Answer ${num}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12099","2395","ChangeCustomerQA","var input = __input.response;
if (input == '1' && num < minquestnum) {
  num = num+1;
  __tempData.QAListFirst = IC.bulidQAListInfo(__tempData);
  __next = '1';
}else if(input == '1' && num == minquestnum){
  __params.QAList = IC.bulidQAListInfo(__tempData);
  __next = '4';
} else if(input == '0') {
  __next = '1';
} else {
  __next = '3';
}","3","Confirm Answer","<html>
<body>
Confirm your answer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12112","2399","Customer Forget PIN","__params.ActionType='CustForgetPin';
__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__params.IgnorePIN='True';
custQuestion = IC.queryCustQuestion(identity.identityId);
num = 1;
__tempData = __params;
if ( size(custQuestion)>0) {
  __next = '1';
}else {
   __errormsg = 'There is no Question exist!';
   __next = 'error';
}","begin","Initialization","",""<endrec>
"CUSTOMER","","4","12114","2399","Customer Forget PIN","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to reset your PIN?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","12116","2399","Customer Forget PIN","var input = __input.response;
if (Validator.checkQAAnser(input)) {
  __tempData.QuestionCode = custQuestion.get(num-1);
  __tempData.Answer = input;
  __next = '2';
}else {
  __next = '1';
}","1","Enter Answer","<html>
<body>
Question ${num}:<br>
${custQuestion.get(num-1)}<br>
Enter Answer ${num}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","12117","2399","Customer Forget PIN","var input = __input.response;
if (input == '1' && num < size(custQuestion)) {
  num = num+1;
  __tempData.QAListFirst = IC.bulidQAListInfo(__tempData);
  __next = '1';
}else if(input == '1' && num == size(custQuestion)){
  __params.QAList = IC.bulidQAListInfo(__tempData);
  __next = '3';
} else if(input == '0') {
  __next = '1';
} else {
  __next = '2';
}","2","Confirm Answer","<html>
<body>
Confirm your answer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","12118","1009","Activate customer","questionPolicy = IC.queryQuestionPolicy();
minquestnum = questionPolicy.getQuestionNumber();
num = 1;
var input = __input.response;
__tempData = __params;
if (input == '1') {
  __next = '7';
} else if(input == '0') {
  __next = '10';
} else {
  __next = '6';
}","6","Set QA or not","<html>
<body>
Set Question and Answer?<br>
1 Yes<br>
0 No<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12119","1009","Activate customer","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(question.getItems())){
  __tempData.selectQuestion = question.getItems().get(i).getDefaultName();
  if(Validator.checkQuestion(__tempData)){
    __tempData.QuestionCode=question.getItems().get(i).getDefaultName();
    __next = '8';
  }	
} 
else {
  __next = '7';
}","7","Select Question","<html>
<body>
Question ${num}:<br>
$$question = Util.queryDataDictTypeByKey('CPS_SYSTEM_QUESTIONS')
$$var i = 1;
$$for (ques: question.getItems()) {
  ${i} ${ques.getDefaultName()}<br>
$$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","12120","1009","Activate customer","var input = __input.response;
if (Validator.checkQAAnser(input)) {
  __tempData.Answer = input;
  __next = '9';
}else {
  __next = '8';
}","8","Enter Answer","<html>
<body>
Enter Answer ${num}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","12121","1009","Activate customer","var input = __input.response;
if (input == '1' && num < minquestnum) {
  num = num+1;
  __tempData.QAListFirst = IC.bulidQAListInfo(__tempData);
  __next = '7';
}else if(input == '1' && num == minquestnum){
  __params.QAList = IC.bulidQAListInfo(__tempData);
  __next = '10';
} else if(input == '0') {
  __next = '7';
} else {
  __next = '9';
}","9","Confirm Answer","<html>
<body>
Confirm your answer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","2","12141","2363","Group Reactivate Direct Debit Mandate V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='1b';
__exemode='continue';","1a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","3","12142","2363","Group Reactivate Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","1b","Check Groups","Check Groups",""<endrec>
"CUSTOMER","","7","12143","2363","Group Reactivate Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.roleList =__input.lastCommitResult.result;
   if(empty(__tempData.roleList)|| size(__tempData.roleList)==0){
       __errormsg = 'no current group member role.';
       __next = 'error';
   }else {
       __next = '4a';
       __exemode='continue';
   }
}else{
   __errormsg = 'Sorry,error occured when querying current group member role.';
   __next = 'error';
}","3b","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","54","8","12144","2363","Group Reactivate Direct Debit Mandate V2.0","__committerParams.ServiceCode=__params.ServiceCode;
       __committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
       __committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
       __committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
       __committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
       __committerParams.AccessDeviceIdentifier=__params.AccessDeviceIdentifier;
       __committerParams.AccessDeviceIdentifierType=__params.AccessDeviceIdentifierType;
       __committerParams.MandateStatus=__params.MandateStatus;

__next='4b';
__exemode='continue';","4a","Query Direct Debit Mandates","Query Direct Debit Mandates",""<endrec>
"CUSTOMER","","9","12145","2363","Group Reactivate Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.mandateList =__input.lastCommitResult.result;
   if(empty(__tempData.mandateList )||size(__tempData.mandateList )==0){
       __errormsg = 'No Available Mandates.';
       __next = 'error';
   }else {
       __next = '5';
   }
}else{
   __errormsg = 'Sorry,error occured when querying direct debit mandates.';
   __next = 'error';
}","b","Check Direct Debit Mandates","Check Direct Debit Mandates",""<endrec>
"CUSTOMER","","1","12146","2406","Group Register Card V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ActionType= 'GroupRegisterCard';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;

__next = '0';
__exemode = 'continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","12147","2406","Group Register Card V2.0","var input =  __input.response;

if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(__tempData.groups) || size(__tempData.groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '1';
}","1","select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12148","2406","Group Register Card V2.0","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
    for(group: __tempData.groups){
        if(group.groupCode == input)
        {
             found = '0';
        }
    }
    if ( found == '1') {
         __errormsg = 'No current group or not belong to the group.';
         __next = 'error';
    } else {
         __next = '1c';
         __exemode='continue';
    }
} else {
         __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12149","2406","Group Register Card V2.0","var i = Util.toInt(__input.response) - 1;
var isSucess = __input.validateResult.isSucess;

if (isSucess) {
  var group = __tempData.groups.get(i);
  var groupCode = group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '1c';
  __exemode = 'continue';
} else {
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group : __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","12150","2406","Group Register Card V2.0","var input = __input.response;
if (empty(input)) {
    __next = '2b';
} else {
    var tmp = Util.toInt(input) - 1;
    var isSucess = __input.validateResult.isSucess;
    if(isSucess) {
        var cardType = __tempData.cardTypes.get(tmp);
        var code = cardType.code;
        __params.CardType = code;
        __next = '3';
    } else {
        __next = '2b';
    }
}","2b","Select Card Type","<html>
<body>
Select Card Type :<br>
  $$var i = 1;
  $$for(cardType : __tempData.cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","12151","2406","Group Register Card V2.0","var input = __input.response;
if (empty(input)) {
     __next = '3';
} else {
     __params.CardNumber = input;
     __next = '4';
}","3","Enter Card Number","<html>
<body>
Enter Card Number :<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","12152","2406","Group Register Card V2.0","var input = __input.response;
if (empty(input)) {
    __next = '4';
} else {
    __params.CardExpiry = input;
    __next = '5';
}","4","Enter Card Expiry","<html>
<body>
Enter Card Expiry :<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","12153","2406","Group Register Card V2.0","var input = __input.response;
if (empty(input)) {
    __next = '5';
} else {
    __params.CardHolderName = input;
    __next = '6';
}","5","Enter Card Holder Name","<html>
<body>
Enter Card Holder Name :<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","12154","2406","Group Register Card V2.0","var input = __input.response;
if (empty(input)) {
    __next = '6';
} else {
    __params.CardIssueNumber = input;
    __next = '7';
}","6","Enter Card Issue Number","<html>
<body>
Enter Card Issue Number:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","12155","2406","Group Register Card V2.0","var input = __input.response;
if (empty(input)) {
    __next = '7'
} else {
    __params.ValidFrom = input;
    __next = '8';
}","7","Enter Valid From","<html>
<body>
Enter Valid From:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","17","12156","2406","Group Register Card V2.0","var input = __input.response;
var isSucess = __input.validateResult.isSucess;
if (!empty(input)  and isSucess) {
    __params.@HEAD@PIN = input;
    __next = '9';
    __exemode = 'continue';
} else {
    __next = '8';
}","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","20","12157","2406","Group Register Card V2.0","var input = __input.response;

if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html><body>Register Group Card.Card Type: ${__params.CardType}, Card Number:${__params.CardNumber}, Card Expiry:${__params.CardExpiry}, Card Holder Name:${__params.CardHolderName}, Card Issue Number:${__params.CardIssueNumber}, Valid From:${__params.ValidFrom}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","2","12159","2406","Group Register Card V2.0","__committerParams.MSISDN = __msisdn;
__next = '0a';
__exemode = 'continue';","0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","3","12160","2406","Group Register Card V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","0a","Get My Groups","Get My Groups",""<endrec>
"CUSTOMER","31","7","12161","2406","Group Register Card V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;

__next = '1d';
__exemode = 'continue';","1c","Query Group Member Roles","Query Group Member Roles",""<endrec>
"CUSTOMER","","8","12162","2406","Group Register Card V2.0","var result = __input.lastCommitResult.result;
if (empty(result) || size(result) == 0) {
    __errormsg = 'no current group member role.';
    __next = 'error';
} else {
    __next = '2';
    __exemode = 'continue';
}","1d","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","46","9","12163","2406","Group Register Card V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__committerParams.AccessDeviceIdentifier = __params.AccessDeviceIdentifier;
__committerParams.AccessDeviceIdentifierType = __params.AccessDeviceIdentifierType;
__committerParams.queryCardType = '0';  /* register */

__next = '2a';
__exemode = 'continue';","2","Query Register Card Type Info","Query Register Card Type Info",""<endrec>
"CUSTOMER","","10","12164","2406","Group Register Card V2.0","__tempData.cardTypes = __input.lastCommitResult.result;

if (empty(__tempData.cardTypes)) {
    __errormsg = 'You have no Card Type.';
    __next = 'error'
} else {
    __next = '2b';
}","2a","Check Card Type","Check Card Type",""<endrec>
"CUSTOMER","45","18","12165","2406","Group Register Card V2.0","__committerParams.params = __params;
__next = '9a';
__exemode = 'continue';","9","Build Additional Card Infos","Build Additional Card Infos",""<endrec>
"CUSTOMER","","19","12166","2406","Group Register Card V2.0","__params.AdditionalCardInfos = __input.lastCommitResult.result;
__next = '10';","9a","Get Addtional Card Infos","Get Addtional Card Infos",""<endrec>
"CUSTOMER","","1","12167","2407","Group Sell Foreign Currency V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '11'; /* SP SHORT CODE */
__params.ReceiverPartyIdentifier = '1';
__params.TransactionCategory = 'FX';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","12168","2407","Group Sell Foreign Currency V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
  __next = '2b';
} else {
  __next = '1';
}","1","Group Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12169","2407","Group Sell Foreign Currency V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
     __params.PrimaryPartyIdentifier = input;
     __next = '3a';
     __exemode='continue';
   }
else{
    __next = '2a';
}","2a","Enter Group","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","12170","2407","Group Sell Foreign Currency V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3a';
  __exemode='continue';
}
else{
  __next = '2b';
}","2b","Select Group","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","9","12171","2407","Group Sell Foreign Currency V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
               type = __tempData.multiCurrencyCode.get(tmp);
                __params.SourceCurrency = type;
                __next = '4a';
                __exemode='continue';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }","3","Select Foreign Currency","<html>
<body>
Select the Foreign Currency to Sell :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","12172","2407","Group Sell Foreign Currency V2.0","var input = __input.response;
if (input == '1') {
        __params.Currency = __params.SourceCurrency;
  __params.BaseCurrency = __params.SourceCurrency;
  __next = '5';
} else if (input == '2') {
        __params.Currency = __tempData.defaultCurrencyCode;
  __params.BaseCurrency = __tempData.defaultCurrencyCode;
  __next = '5';
} else {
  __next = '4';
}","4","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.SourceCurrency} <br>
2 Input the amount in ${__tempData.defaultCurrencyCode}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","12173","2407","Group Sell Foreign Currency V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
  __params.BaseAmount = Util.replaceAll(input,',','.');
  __next = '6a';
  __exemode='continue';
}
else {
 __next = '5';
}","5","Input Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","16","12174","2407","Group Sell Foreign Currency V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
          var isSuccess = __input.validateResult.isSucess;
    if (isSuccess) {
         type = __tempData.multiAccount.get(tmp);
    __params.SourceAccount = type.AccountNo;
                __next = '7';
         } else {
                __next = '6';
         }
    } else {
        __next = '6';
    }","6","Select Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","17","12175","2407","Group Sell Foreign Currency V2.0","__params.DestinationCurrency = __tempData.defaultCurrencyCode;
var input = __input.response;
__params.PIN = input;
__next = '8a';
__exemode='continue';","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","20","12176","2407","Group Sell Foreign Currency V2.0","var input = __input.response;
  if (input == '1') {
      __next = 'end';
  } else if(input == '0') {
      __next = 'cancel';
  } else {
      __next = '8';
  }","8","Confirm","<html>
<body>
$$rateInfo = __tempData.rateInfo;
You are going to sell [${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}],[${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}] will be credited to your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","2","12177","2407","Group Sell Foreign Currency V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='1b';
__exemode='continue';","1a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","3","12178","2407","Group Sell Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","1b","Check Groups","Check Groups",""<endrec>
"CUSTOMER","58","7","12179","2407","Group Sell Foreign Currency V2.0","__next='3b';
__exemode='continue';","3a","Query All Foreign Currency","Query All Foreign Currency",""<endrec>
"CUSTOMER","","8","12180","2407","Group Sell Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying foreign currencyCode.';
   __next = 'error';
}","3b","Check Foreign Currency","Check Foreign Currency",""<endrec>
"CUSTOMER","59","10","12181","2407","Group Sell Foreign Currency V2.0","__next='4b';
__exemode='continue';","4a","Query Default Currency","Query Default Currency",""<endrec>
"CUSTOMER","","11","12182","2407","Group Sell Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.defaultCurrencyCode =__input.lastCommitResult.result;
    __next='4';
}else{
   __errormsg = 'Sorry,error occured when querying defaultCurrencyCode.';
   __next = 'error';
}","4b","Check Default Currency","Check Default Currency",""<endrec>
"CUSTOMER","29","14","12183","2407","Group Sell Foreign Currency V2.0","__committerParams.IdentityType = '7000';
__committerParams.IdentityId = __params.PrimaryPartyIdentifier;
__committerParams.IdentifierType=__params.PrimaryPartyIdentifierType;
__committerParams.AccountTypeAlias = 'Group float';
__committerParams.Currency = __params.SourceCurrency;
__next='6b';
__exemode='continue';","6a","Query Group Multi Account","Query Group Multi Account",""<endrec>
"CUSTOMER","","15","12184","2407","Group Sell Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='6';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","6b","Check Group Multi Account","Check Group Multi Account",""<endrec>
"CUSTOMER","62","18","12185","2407","Group Sell Foreign Currency V2.0","__committerParams.SourceCurrency=__params.SourceCurrency;
__committerParams.DestinationCurrency=__params.DestinationCurrency;
__committerParams.BaseCurrency=__params.BaseCurrency;
__committerParams.BaseAmount=__params.BaseAmount;
__next='8b';
__exemode='continue';","8a","Query Fx Rate and Amount","Query Fx Rate and Amount",""<endrec>
"CUSTOMER","","19","12186","2407","Group Sell Foreign Currency V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.rateInfo=__input.lastCommitResult.result;
    __next='8';
}else{
   __errormsg = 'Sorry,error occured when querying rateInfo.';
   __next = 'error';
}","8b","Check Fx Rate and Amount","Check Fx Rate and Amount",""<endrec>
"CUSTOMER","","1","12187","2408","Group Transfer from Bank to M-Pesa V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.BankCardOwnerInputType = '15'; /* GROUP_CODE*/
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.RequesterIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '04';
__params.TransactionCategory = 'Bank_Card_Service';
__params.TransactionSubCategory = '0'; 
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12188","2408","Group Transfer from Bank to M-Pesa V2.0","var input = __input.response;
if (input == '1') {
	__next = '2';
} else if (input == '2') {
	__next='3a';
        __exemode='continue';
} else {
	__next = '1';
}","1","Select Option For Group","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","12189","2408","Group Transfer from Bank to M-Pesa V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
     __params.BankCardOwnerInputValue = input;
     __next = '4a';     
     __exemode='continue';
}else{
    __next = '2';
}","2","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","12190","2408","Group Transfer from Bank to M-Pesa V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.BankCardOwnerInputValue = groupCode;
  __next = '4a';
  __exemode='continue';
} 
else{
  __next = '3';
}","3","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","9","12191","2408","Group Transfer from Bank to M-Pesa V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
	__params.ShortCode = __tempData.fiOrgList.get(i).shortCode;
	__params.PrimaryPartyIdentifier = __params.ShortCode;
	__params.FIOrgIdentityId = __tempData.fiOrgList.get(i).identityId;
	__next = '5a';
        __exemode='continue';
} else {
	__next = '4';
}","4","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: __tempData.fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","12192","2408","Group Transfer from Bank to M-Pesa V2.0","var input = __input.response;
if (input == '1') {
  __tempData.isSelectBankAccount=true;
  __params.QueryIdentifierType = __params.BankCardOwnerInputType;
  __params.QueryIdentifierValue = __params.BankCardOwnerInputValue;
  __next = '6a';
  __exemode='continue';
} else if (input == '2') {
  __tempData.isSelectBankAccount=false;
  __next = '7';
}else{
  __next = '5';
}","5","Select or Enter Bank Account","<html>
<body>
1 Select form list <br>
${__params.isEnterBankAccount}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","12193","2408","Group Transfer from Bank to M-Pesa V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
   __params.BankCardId = __tempData.bankAccounts.get(i).bankCardId;
   __next = '9';
} else {
   __next = '6';
}","6","Select Bank Account","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: __tempData.bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","18","12194","2408","Group Transfer from Bank to M-Pesa V2.0","var input = __input.response;
if(!empty(input)){
__tempData.InfoDetail[__tempData.attrList[__tempData.attrIndex]]= input;
__tempData.attrIndex = __tempData.attrIndex + 1;
if (__tempData.attrIndex < size(__tempData.attrList)){
    __next = '8';
}else{
  __next = '8a';
  __exemode='continue';
}
}else{
  __next='8';
}","8","Enter Bank Card Attr","<html>
<body>
Enter ${__tempData.attrList[__tempData.attrIndex]}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","21","12195","2408","Group Transfer from Bank to M-Pesa V2.0","var input = __input.response;
if (input == '1') {
   __tempData.identifierTypeName = 'MSISDN';
  __params.ReceiverPartyIdentifierType = '01';   /* MSISDN */
  __next = '10';
} else if (input == '2') {
  __tempData.identifierTypeName = 'Organization Short Code';
  __params.ReceiverPartyIdentifierType = '04';   /* SHORT_CODE*/
  __next = '10';
}else if (input == '3') {
   __tempData.identifierTypeName = 'Group Code';
  __params.ReceiverPartyIdentifierType = '15';   /* GROUP_CODE*/
  __next = '10';
}  else {
  __next = '9';
}","9","Select Receiver Type","<html>
<body>
Select Receiver Type:<br>
1 Customer <br>
2 Organization <br>
3 Group <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","22","12196","2408","Group Transfer from Bank to M-Pesa V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '11';","10","Enter Receiver","<html>
<body>
Enter Receiver ${__tempData.identifierTypeName}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","23","12197","2408","Group Transfer from Bank to M-Pesa V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.Amount = Util.replaceAll(input,',','.');
    __next = '12';
} else {
    __next = '11';
}","11","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","24","12198","2408","Group Transfer from Bank to M-Pesa V2.0","var input = __input.response;
__params.PIN = input;
__next = '13';","12","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","25","12199","2408","Group Transfer from Bank to M-Pesa V2.0","var input = __input.response;
if (!empty(input) and size(input)> 255) 
{
    __next = '13';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '14';
}","13","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","26","12200","2408","Group Transfer from Bank to M-Pesa V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '14';
}","14","Confirm","<html>
<body>
Deposit Amount : ${__params.Amount}<br>
Bank Account : ${__tempData.isSelectBankAccount==false?__params.BankAccountNo:__params.BankCardId}<br>
Reciever : ${__params.ReceiverPartyIdentifier}<br>
1 OK <br>
0 Cancel <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","50","16","12201","2408","Group Transfer from Bank to M-Pesa V2.0","__params.BankAccountNo= __input.response;
__committerParams.IdentityType ='1000';
__next='7a';
__exemode='continue';","7","Enter Bank Account","<html>
<body>
Enter Bank Account<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","4","12202","2408","Group Transfer from Bank to M-Pesa V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='3b';
__exemode='continue';","3a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","12203","2408","Group Transfer from Bank to M-Pesa V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","3b","Check Groups","Check Groups",""<endrec>
"CUSTOMER","66","7","12204","2408","Group Transfer from Bank to M-Pesa V2.0","__committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__next  = '4b';
__exemode = 'continue';","4a","Query FI Org","Query FI Org",""<endrec>
"CUSTOMER","","8","12205","2408","Group Transfer from Bank to M-Pesa V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.fiOrgList= __input.lastCommitResult.result;
   if (empty(__tempData.fiOrgList) || size(__tempData.fiOrgList) == 0)
   {
      __errormsg = 'Sorry, there is no FI Organization.';
      __next = 'error';
   } else
   {
      __next = '4';
   }
}else{
   __errormsg = 'Sorry,error occured when querying FI Org.';
   __next = 'error';
}","4b","Check FI Org List","Check FI Org List",""<endrec>
"CUSTOMER","67","10","12206","2408","Group Transfer from Bank to M-Pesa V2.0","__committerParams.FIOrgIdentityId=__params.FIOrgIdentityId ;
__committerParams.BankCardOwnerInputType=__params.BankCardOwnerInputType;
__committerParams.IdentityType='7000';
__next  = '5b';
__exemode = 'continue';","5a","Query FIBankCardCheck","Query FIBankCardCheck",""<endrec>
"CUSTOMER","","11","12207","2408","Group Transfer from Bank to M-Pesa V2.0","if(__input.lastCommitResult.isSucess)
   {
     var isEnterBankAccount = __input.lastCommitResult.result;
      if (isEnterBankAccount) {
	__params.isEnterBankAccount = '2 Enter bank card <br>';
      } else {
	__params.isEnterBankAccount = '';
     }
    __next = '5';
   } else
   {
    __errormsg = 'Sorry, faild to check is allowed unlinked bank card.';
    __next = 'error'
   }","5b","Check FIBankCardCheck","Check FIBankCardCheck",""<endrec>
"CUSTOMER","55","13","12208","2408","Group Transfer from Bank to M-Pesa V2.0","__committerParams.IdentifierType= __params.QueryIdentifierType;
__committerParams.IdentifierValue= __params.QueryIdentifierValue;
__committerParams.FIOrgIdentityId=__params.FIOrgIdentityId;
__next  = '6b';
__exemode = 'continue';","6a","Query Bank Account","Query Bank Account",""<endrec>
"CUSTOMER","","14","12209","2408","Group Transfer from Bank to M-Pesa V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.bankAccounts =__input.lastCommitResult.result;
   if(empty(__tempData.bankAccounts )|| size(__tempData.bankAccounts )==0){
       __errormsg = 'no current bank Account.';
       __next = 'error';
   }else {
       __next = '6';
   }
}else{
   __errormsg = 'Sorry,error occured when querying bank accounts.';
   __next = 'error';
}","6b","Check Bank Accounts List","Check Bank Accounts List",""<endrec>
"CUSTOMER","","17","12210","2408","Group Transfer from Bank to M-Pesa V2.0","if(__input.lastCommitResult.isSucess){
      __tempData.attrList = __input.lastCommitResult.result;
      __tempData.attrIndex= 0;
      if (!empty(__tempData.attrList ) and size(__tempData.attrList )>0) {
        __tempData.InfoDetail= Util.createMap();
	__next = '8';
      } else {
	__next = '9';
     }
} else {
    __errormsg = 'Sorry, faild to check is allowed unlinked bank card.';
    __next = 'error'
}","7a","Check Bank Card Attr List","Check Bank Card Attr List",""<endrec>
"CUSTOMER","56","19","12211","2408","Group Transfer from Bank to M-Pesa V2.0","__committerParams.InfoDetail=  __tempData.InfoDetail;
__next='8b';
__exemode='continue';","8a","Build FI Account Info","Build FI Account Info",""<endrec>
"CUSTOMER","","20","12212","2408","Group Transfer from Bank to M-Pesa V2.0","if (__input.lastCommitResult.isSucess)
{
   __params.FIAccountInfo= __input.lastCommitResult.result;
   if(empty(__params.FIAccountInfo)|| size(__params.FIAccountInfo)==0){
       __errormsg = 'Sorry,Build account info failed.';
       __next = 'error';
   }else {
       __next = '9';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","8b","Check Build Result","Check Build Result",""<endrec>
"CUSTOMER","","1","12213","2409","Group Two Part Buy Goods V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
CurrencyCode = """";

__next = '0';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","12214","2409","Group Two Part Buy Goods V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
__params.PrimaryPartyIdentifier = input;
__next = '2';
}else{
__next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","12215","2409","Group Two Part Buy Goods V2.0","var input = __input.response;
    if (empty(input)) {
     __next = '2';
    } else if (input == '1') {
        __params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
        __tempData.tips = 'Till no';
        __next = '3';
    } else if (input == '2') {
        __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
        __tempData.tips = 'Short code';
        __next = '3';
    } else {
     __next = '2';
    }","2","Select Till no or Short code","<html>
<body>
Select Till no or Short code<br>
1 Till no<br>
2 Short code<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12216","2409","Group Two Part Buy Goods V2.0","var input = __input.response;
if (empty(input)) {
__next = '3';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '4';
}","3","Enter Till no or Short code","<html>
<body>
Enter ${__tempData.tips}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","24","9","12217","2409","Group Two Part Buy Goods V2.0","var input = __input.response;
__params.OtherTwoPartyVoucherReceiver = input;
__next = '5a';
__exemode='continue';","4","Enter OtherTwoPartyVoucherReceiver","<html>
<body>
Enter OtherTwoPartyVoucherReceiver<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","12218","2409","Group Two Part Buy Goods V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if (isSuccess){
               type = __tempData.multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __next = '6';
         } else {
                __next = '5';
         }
    } else {
        __next = '5';
    }","5","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","12219","2409","Group Two Part Buy Goods V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.Amount= Util.replaceAll(input,',','.');
    __next = '7';
} else {
    __next = '6';
}","6","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","14","12220","2409","Group Two Part Buy Goods V2.0","var input = __input.response;
if (!empty(input) and size(input)> 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","12221","2409","Group Two Part Buy Goods V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.PIN = input;
    __next = '8';
} else {
    __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","2","12222","2409","Group Two Part Buy Goods V2.0","var input = __input.response;
if (input == '1') {
	__next = '1a';
} else if (input == '2') {
	__next = '1b0';
        __exemode='continue';
} else {
	__next = '0';
}","0","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12223","2409","Group Two Part Buy Goods V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '2';
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","15","12224","2409","Group Two Part Buy Goods V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","4","12225","2409","Group Two Part Buy Goods V2.0","__committerParams.MSISDN=__msisdn;
__next='1b1';
__exemode='continue';","1b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","12226","2409","Group Two Part Buy Goods V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '1b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","1b1","Check Groups","Check Groups",""<endrec>
"CUSTOMER","","10","12227","2409","Group Two Part Buy Goods V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='5';
   }
}else{
   __errormsg = 'Sorry,error occured when querying currencyCode.';
   __next = 'error';
}","5a","Check All Currency","Check All Currency",""<endrec>
"CUSTOMER","","1","12228","2410","IMT Request Quote V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.TransactionCategory = 'IMT';
__params.TransactionSubCategory = 'IMT_HomeSend_AdviceOfCharge_Request';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12229","2410","IMT Request Quote V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.Amount = 0;
    __params.AdditionalDataItemPrinciple_Amount = Util.replaceAll(input,',','.');
    __next = '2';
} else {
    __next = '1';
}","1","Enter the Amount to be Transfered","<html>
<body>
Enter the Amount to be Transfered<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","17"<endrec>
"CUSTOMER","","3","12230","2410","IMT Request Quote V2.0","var input = __input.response;
if (empty(input)) { 
__next = '2';
} else {
__params.AdditionalDataItemRecipient@@SPACE@@MSISDN = input;
__next = '3';
}","2","Enter Recipient MSISDN","<html>
<body>
Enter Recipient MSISDN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12231","2410","IMT Request Quote V2.0","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name = input;
__next = '4';","3","Enter Recipient First Name","<html>
<body>
Enter Recipient First Name<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12232","2410","IMT Request Quote V2.0","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name = input;
__next = '5';","4","Enter Recipient Last Name","<html>
<body>
Enter Recipient Last Name<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12233","2410","IMT Request Quote V2.0","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","12234","2410","IMT Request Quote V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
REQUEST QUOTE FOR SENDING MONEY TO [${__params.AdditionalDataItemRecipient@@SPACE@@MSISDN}] [${__params.AdditionalDataItemPrinciple_Amount}]<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12235","2410","IMT Request Quote V2.0","var input = __input.response;
if (empty(input)) { 
__next = '6';
} else {
__params.IMTRoutingFactor = input;
__next = '6';
}","5","Enter IMTRoutingFactor","<html>
<body>
Enter IMTRoutingFactor<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","12236","2410","IMT Request Quote V2.0","var input = __input.response;
if (empty(input)) { 
__next = '7';
} else {
__params.OtherURI = input;
__next = '7';
}","6","Enter OtherURI","<html>
<body>
Enter OtherURI<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12237","2411","IMT Transfer Abroad V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.TransactionCategory = 'IMT';
__params.TransactionSubCategory = 'IMT_HomeSend_AdviceOfCharge_Request';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12238","2411","IMT Transfer Abroad V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.Amount = 0;
    __params.AdditionalDataItemPrinciple_Amount = Util.replaceAll(input,',','.');
    __next = '2';
} else {
    __next = '1';
}","1","Enter Transfer Amount","<html>
<body>
Enter Transfer Amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","17"<endrec>
"CUSTOMER","","3","12239","2411","IMT Transfer Abroad V2.0","var input = __input.response;
if (empty(input)) { 
__next = '2';
} else {
__params.AdditionalDataItemRecipient@@SPACE@@MSISDN = input;
__next = '3';
}","2","Enter Recipient MSISDN","<html>
<body>
Enter Recipient MSISDN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12240","2411","IMT Transfer Abroad V2.0","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name = input;
__next = '4';","3","Enter Recipient First Name","<html>
<body>
Enter Recipient First Name<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12241","2411","IMT Transfer Abroad V2.0","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name = input;
__next = '5';","4","Enter Recipient Last Name","<html>
<body>
Enter Recipient Last Name<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12242","2411","IMT Transfer Abroad V2.0","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","12243","2411","IMT Transfer Abroad V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
REQUEST QUOTE FOR SENDING MONEY TO [${__params.AdditionalDataItemRecipient@@SPACE@@MSISDN}] [${__params.AdditionalDataItemPrinciple_Amount}]<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12244","2411","IMT Transfer Abroad V2.0","var input = __input.response;
if (empty(input)) { 
__next = '6';
} else {
__params.IMTRoutingFactor = input;
__next = '6';
}","5","Enter IMTRoutingFactor","<html>
<body>
Enter IMTRoutingFactor<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","12245","2411","IMT Transfer Abroad V2.0","var input = __input.response;
if (empty(input)) { 
__next = '7';
} else {
__params.OtherURI = input;
__next = '7';
}","6","Enter OtherURI","<html>
<body>
Enter OtherURI<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12251","2413","Initiate Reversal Transaction V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ActionType = 'TransactionReversal';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12252","2413","Initiate Reversal Transaction V2.0","var input = __input.response;
if (!empty(input)) {
  __params.OriginalOrderId= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Transaction ID or Request ID","<html>
<body>
Enter Transaction ID or Request ID:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","12253","2413","Initiate Reversal Transaction V2.0","var input = __input.response;
if (!empty(input)) {
  __params.PIN = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Pin","<html>
<body>
Enter Pin <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12254","2413","Initiate Reversal Transaction V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input != '1'){
  __next = 'cancel';
}","4","Confirm","<html><body>You are going to reverse transaction ${__params.OriginalOrderId}. Press 1 to continue and other numbers to cancel.<br>
1 OK <br>
 Cancel <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12255","2413","Initiate Reversal Transaction V2.0","var input = __input.response;
if (!empty(input) and size(input)> 255) 
{
    __next = '3';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '4';
}","3","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12529","2464","Service Purchase V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12530","2464","Service Purchase V2.0","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","12531","2464","Service Purchase V2.0","__tempData.serviceName1= 'supercheka';
__tempData.amout1= '5000';
__tempData.amout2= '2000';
__tempData.amout3= '1000';
var input = __input.response;
if (input == '1') {
  __params.RechargedMSISDN = __msisdn;
  __next = '4';
} else if (input == '2') {
  __next = '3';
} else {
  __next = '2';
}","2","Select Phone","<html>
<body>
Please select phone :<br>
1 My phone<br>
2 Other phone<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12532","2464","Service Purchase V2.0","var input = __input.response;
if (!empty(input)) {
  __params.RechargedMSISDN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Input MSISDN Number","<html>
<body>
Input MSISDN Number:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12533","2464","Service Purchase V2.0","var input = __input.response;
if(!empty(input)){
 if (input == '4') {
 __next = '5';
 } else {
   if (input == '1') {
      __tempData.Amount = __tempData.amout1;
   }else if (input == '2'){
      __tempData.Amount = __tempData.amout2;
   }else if (input == '3'){
      __tempData.Amount= __tempData.amout3;
   }
     __params.BillReferenceNumber = __tempData.serviceName1;
      __params.Amount = Util.replaceAll(__tempData.Amount,',','.');
       __next='6';  
  }
}else{
  __next = '4';
}","4","Select Amount","<html>
<body>
Please select amount:<br>
1 ${__tempData.serviceName1} ${__tempData.amout1}<br>
2 ${__tempData.serviceName1} ${__tempData.amout2}<br>
3 ${__tempData.serviceName1} ${__tempData.amout3}<br>
4 ${__tempData.serviceName1}  <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12534","2464","Service Purchase V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
    __params.Amount = Util.replaceAll(input,',','.');
 __next = '6';
  } else {
  __next = '5';
}","5","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","7","12535","2464","Service Purchase V2.0","var input = __input.response;
if (!empty(input)) {
  __params.PIN = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","12536","2464","Service Purchase V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
Service Purchase ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","12537","2464","Service Purchase V2.0","var input = __input.response;
if (!empty(input) and size(input) > 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12538","2465","Issue Voucher V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.IS_RESOLVE_RECEIVER_BY_INITIATOR = '1';  
__params.ReasonTypeCode = 'CustomerIssueVoucher';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","12539","2465","Issue Voucher V2.0","var input = __input.response;
if(!empty(input)){
__params.Msisdn = __input.response;
__next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the receiving Msisdn:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","12540","2465","Issue Voucher V2.0","var input = __input.response;
__params.ShortCode = input;
__next = '3';","2","Input short Code","<html>
<body>
Please input the redeeming organization short Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12541","2465","Issue Voucher V2.0","var input = __input.response;
if(!empty(input)){
__params.VoucherAmount = __input.response;
__next = '4';
}else{
    __next ='3';
}","3","Input amount","<html>
<body>
Please input the amount of the voucher:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12542","2465","Issue Voucher V2.0","var input = __input.response;
__params.ValidityPeriod = input;
__next = '5';","4","Input validity period","<html>
<body>
Please input the validity period:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12543","2465","Issue Voucher V2.0","var input = __input.response;
__params.Extra1 = input;
__next = '6';","5","Input description 1","<html>
<body>
Please input the description 1 of the voucher:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","12544","2465","Issue Voucher V2.0","var input = __input.response;
__params.Extra2 = input;
__next = '7';","6","Input description 2","<html>
<body>
Please input the description 2 of the voucher:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12545","2465","Issue Voucher V2.0","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '8';
}else{
    __next ='7';
}","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","12546","2465","Issue Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
You will issue a voucher to  ${__params.Msisdn},the amount is ${__params.VoucherAmount},the Redeeming org short code is ${__params.ShortCode}<br>
1 Confirm<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12547","2466","M-Kesho Bank Balance V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='1001';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = __msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Saving_Account_Balance';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12548","2466","M-Kesho Bank Balance V2.0","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12549","2467","M-Kesho Deposit V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '1001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Deposit';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12550","2467","M-Kesho Deposit V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.Amount=Util.replaceAll(input,',','.');
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","12551","2467","M-Kesho Deposit V2.0","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12552","2467","M-Kesho Deposit V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Deposit ${__params.Amount} in bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12553","2468","M-Kesho Mini Statement V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='1001';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = __msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Loan_Mini_Statement';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12554","2468","M-Kesho Mini Statement V2.0","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12557","2470","M-Kesho Request Insurance V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '1001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Insurance_Request';
__params.Amount = '0';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12558","2470","M-Kesho Request Insurance V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
  __next = '2';
   }
else{
     __referenceData.InsuranceTypeCode = input;
     __next = '3';
}","1","Enter InsuranceTypeCode","<html>
<body>
Enter InsuranceTypeCode<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","3","12559","2470","M-Kesho Request Insurance V2.0","var input = __input.response;
if (input == '1') {
  __next = '1';
} else if(input == '0') {
  __next = 'cancel';
}","2","Input Error","<html>
<body>
The value cannot contain the following special characters: <>!#%""*='? and <br>
1 Input again<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12560","2470","M-Kesho Request Insurance V2.0","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12561","2470","M-Kesho Request Insurance V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Request insurance?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12562","2471","M-Kesho Request Loan Terms and Conditions V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType ='SetConditionRead';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = __msisdn;
__params.OrgShortCode = '1001';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12563","2471","M-Kesho Request Loan Terms and Conditions V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
}","1","Terms and Conditions","<html>
<body>
Please read and confirm<br>
Please read and confirm the contents to Request Loan:<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>",""<endrec>
"CUSTOMER","","1","12564","2472","M-Kesho Request Loan V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '1001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Request';
__params.Amount = '0';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12565","2472","M-Kesho Request Loan V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess){
    __referenceData.RequestBalance=Util.replaceAll(input,',','.');
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","12566","2472","M-Kesho Request Loan V2.0","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12567","2472","M-Kesho Request Loan V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Request ${__params.ReceiverPartyIdentifier} ${__referenceData.RequestBalance} loans?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12568","2473","M-Kesho Withdraw V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '1001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12569","2473","M-Kesho Withdraw V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input)  and  isSuccess) {
    __params.Amount=Util.replaceAll(input,',','.');
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","12570","2473","M-Kesho Withdraw V2.0","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12571","2473","M-Kesho Withdraw V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Withdraw ${__params.Amount} from bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12572","2474","M-Shwari Activate Account V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType ='ActiveFSIProducts';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* ShortCode*/
__params.ReceiverPartyIdentifier = __msisdn;
__params.OrgShortCode = '2001';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12573","2474","M-Shwari Activate Account V2.0","var input = __input.response;
__params.@HEAD@PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12574","2475","M-Shwari Bank Balance for Group V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '04';
__params.PrimaryPartyIdentifier = '2001';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Saving_Account_Balance';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","12575","2475","M-Shwari Bank Balance for Group V2.0","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifier = input;
    __next='3a';
    __exemode='continue';
}else {
      __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","12576","2475","M-Shwari Bank Balance for Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.PIN = input;
    __next = '4';
} else {
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","10","12577","2475","M-Shwari Bank Balance for Group V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
M-Shwari Bank Balance for Group - Group Code - ${__params.ReceiverPartyIdentifier}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","12578","2475","M-Shwari Bank Balance for Group V2.0","var input = __input.response;
if (input == '1') {
	__next = '2a';
} else if (input == '2') {
	__next = '2b0';
        __exemode='continue';
} else {
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12579","2475","M-Shwari Bank Balance for Group V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next='3a';
  __exemode='continue';
}else{
    __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","4","12580","2475","M-Shwari Bank Balance for Group V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__next='2b1';
__exemode='continue';","2b0","Query Groups","Query Groups",""<endrec>
"CUSTOMER","","5","12581","2475","M-Shwari Bank Balance for Group V2.0","if(__input.lastCommitResult.isSucess){
   __tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups) || size(__tempData.groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
}else{
    __errormsg = 'Sorry, error occured when querying groups.';
    __next = 'error';
}","2b1","Check Groups","Check Groups",""<endrec>
"CUSTOMER","31","7","12582","2475","M-Shwari Bank Balance for Group V2.0","__committerParams.ReceiverPartyIdentifier=__params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;

__next='3b';
__exemode='continue';","3a","Query Group Member Role","Query Group Member Role",""<endrec>
"CUSTOMER","","8","12583","2475","M-Shwari Bank Balance for Group V2.0","if(__input.lastCommitResult.isSucess){
   roleList=__input.lastCommitResult.result;
   if (empty(roleList) || size(roleList) == 0) {
      __errormsg = 'no current group member role.';
      __next = 'error';
    } else {
       __next = '3';
    }
}else{
     __errormsg = 'Sorry,error occured when querying current member roles.';
      __next = 'error';
}","3b","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","","1","12584","2476","M-Shwari Bank Balance V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='2001';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = __msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Saving_Account_Balance';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12585","2476","M-Shwari Bank Balance V2.0","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12586","2477","M-Shwari Deposit for Group V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Deposit';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","12587","2477","M-Shwari Deposit for Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.PrimaryPartyIdentifier = input;
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","12588","2477","M-Shwari Deposit for Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.Amount = Util.replaceAll(input,',','.');
    __next = '4';
} else {
    __next = '3';
}","3","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","8","12589","2477","M-Shwari Deposit for Group V2.0","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","12590","2477","M-Shwari Deposit for Group V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Deposit ${__params.Amount} in bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","12591","2477","M-Shwari Deposit for Group V2.0","var input = __input.response;
if (input == '1') {
	__next = '2a';
} else if (input == '2') {
	__next = '2b0';
        __exemode='continue';
} else {
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12592","2477","M-Shwari Deposit for Group V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group=  __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier= groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","12593","2478","M-Shwari Deposit V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Deposit';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12594","2478","M-Shwari Deposit V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.Amount=Util.replaceAll(input,',','.');
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","12595","2478","M-Shwari Deposit V2.0","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12596","2478","M-Shwari Deposit V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Deposit ${__params.Amount} in bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","12597","2479","M-Shwari FSI Mini Statement for Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.PIN = input;
    __next = '4';
} else {
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","3","12598","2479","M-Shwari FSI Mini Statement for Group V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
   __next='3a';
   __exemode='continue';
}else {
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12599","2479","M-Shwari FSI Mini Statement for Group V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '04';
__params.PrimaryPartyIdentifier = '2001';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Mini_Statement';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","10","12600","2479","M-Shwari FSI Mini Statement for Group V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
M-Shwari FSI Mini Statement for Group - Group Code - ${__params.ReceiverPartyIdentifier}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","12601","2479","M-Shwari FSI Mini Statement for Group V2.0","var input = __input.response;
if (input == '1') {
	__next = '2a';
} else if (input == '2') {
	__next = '2b0';
        __exemode='continue';
} else {
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12602","2479","M-Shwari FSI Mini Statement for Group V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next='3a';
  __exemode='continue';
}else{
    __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","4","12603","2479","M-Shwari FSI Mini Statement for Group V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__next='2b1';
__exemode='continue';","2b0","Query Groups","Query Groups",""<endrec>
"CUSTOMER","","5","12604","2479","M-Shwari FSI Mini Statement for Group V2.0","if(__input.lastCommitResult.isSucess){
   __tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups) || size(__tempData.groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
}else{
    __errormsg = 'Sorry, error occured when querying groups.';
    __next = 'error';
}","2b1","Check Groups","Check Groups",""<endrec>
"CUSTOMER","31","7","12605","2479","M-Shwari FSI Mini Statement for Group V2.0","__committerParams.ReceiverPartyIdentifier=__params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;

__next='3b';
__exemode='continue';","3a","Query Group Member Role","Query Group Member Role",""<endrec>
"CUSTOMER","","8","12606","2479","M-Shwari FSI Mini Statement for Group V2.0","if(__input.lastCommitResult.isSucess){
   roleList=__input.lastCommitResult.result;
   if (empty(roleList) || size(roleList) == 0) {
      __errormsg = 'no current group member role.';
      __next = 'error';
    } else {
       __next = '3';
    }
}else{
     __errormsg = 'Sorry,error occured when querying current member roles.';
      __next = 'error';
}","3b","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","","1","12607","2480","M-Shwari Loan Mini Statement V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='2001';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = __msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Loan_Mini_Statement';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12608","2480","M-Shwari Loan Mini Statement V2.0","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12609","2481","M-Shwari Pay Loan from Savings V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier =__msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Payment_from_Savings';
__params.Amount = '0';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12610","2481","M-Shwari Pay Loan from Savings V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  __referenceData.RequestBalance = Util.replaceAll(input,',','.');    
  __params.Amount = __referenceData.RequestBalance; 
  __next = '2';
} else {    
__next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","12611","2481","M-Shwari Pay Loan from Savings V2.0","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12612","2481","M-Shwari Pay Loan from Savings V2.0","var input = __input.response;
if (input == '1') { 
 __next = 'end';
} else if (input == '0') {  
__next = 'cancel';
} else {  
__next = '3';
}","3","Confirm","<html>
<body>
Pay ${__referenceData.RequestBalance} loans from savings?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12613","2482","M-Shwari Pay Loan V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Repayment';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12614","2482","M-Shwari Pay Loan V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __referenceData.RequestBalance = Util.replaceAll(input,',','.');
    __params.Amount = __referenceData.RequestBalance;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","12615","2482","M-Shwari Pay Loan V2.0","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12616","2482","M-Shwari Pay Loan V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Pay ${__params.Amount} loans?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12617","2483","M-Shwari Query Group Loan Credit Limit V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '04';
__params.PrimaryPartyIdentifier = '2001';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Eligible_Credit_Limit';
__next = '1';","begin","set parameters","",""<endrec>
"CUSTOMER","","3","12618","2483","M-Shwari Query Group Loan Credit Limit V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess ) {
    __params.ReceiverPartyIdentifier = input;
    __next='3';
}else {
     __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","12619","2483","M-Shwari Query Group Loan Credit Limit V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (!empty(input) and isSuccess) {
 __params.PIN = input;
 __next = '4';
 } 
 else {
 __next = '3';
 }","3","Enter PIN","<html>
 <body>
 Enter PIN:<br>
 <a href=""${__mobilemoneyURL}"" default=""yes""></a>
 </body>
 </html>","14"<endrec>
"CUSTOMER","","8","12620","2483","M-Shwari Query Group Loan Credit Limit V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Query group loan credit limit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","12621","2483","M-Shwari Query Group Loan Credit Limit V2.0","var input = __input.response;
if (input == '1') {
	__next = '2a';
} else if (input == '2') {
	__next = '2b0';
        __exemode='continue';
} else {
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12622","2483","M-Shwari Query Group Loan Credit Limit V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group=  __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier= groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","4","12623","2483","M-Shwari Query Group Loan Credit Limit V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b1';
__exemode='continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","12624","2483","M-Shwari Query Group Loan Credit Limit V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check Groups","Check Groups",""<endrec>
"CUSTOMER","","1","12625","2484","M-Shwari Query Group Loan Mini Statement V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '04';
__params.PrimaryPartyIdentifier = '2001';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Loan_Mini_Statement';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","12626","2484","M-Shwari Query Group Loan Mini Statement V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.PrimaryPartyIdentifier = input;
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","12627","2484","M-Shwari Query Group Loan Mini Statement V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
__params.PIN = input;
__next = '4';
} 
else {
__next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","8","12628","2484","M-Shwari Query Group Loan Mini Statement V2.0","var input = __input.response;
if (input == '1') {
__next = 'end';
} 
else if(input == '0') {
__next = 'cancel';
} 
else {
__next = '4';
}","4","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","12629","2484","M-Shwari Query Group Loan Mini Statement V2.0","var input = __input.response;
if (input == '1') {
	__next = '2a';
} else if (input == '2') {
	__next = '2b0';
        __exemode='continue';
} else {
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12630","2484","M-Shwari Query Group Loan Mini Statement V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group=  __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier= groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","4","12631","2484","M-Shwari Query Group Loan Mini Statement V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b1';
__exemode='continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","12632","2484","M-Shwari Query Group Loan Mini Statement V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check Groups","Check Groups",""<endrec>
"CUSTOMER","","1","12633","2485","M-Shwari Request Loan V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Request';
__params.Amount = '0';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12634","2485","M-Shwari Request Loan V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __referenceData.RequestBalance = Util.replaceAll(input,',','.');
    __params.Amount=  __referenceData.RequestBalance;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","12635","2485","M-Shwari Request Loan V2.0","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12636","2485","M-Shwari Request Loan V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Request ${__params.ReceiverPartyIdentifier} ${__referenceData.RequestBalance} loans?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12637","2486","M-Shwari Withdraw for Group V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","12638","2486","M-Shwari Withdraw for Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.PrimaryPartyIdentifier = input;
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","12639","2486","M-Shwari Withdraw for Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
     __params.Amount  = Util.replaceAll(input,',','.');
    __next = '4';
} else {
    __next = '3';
}","3","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","8","12640","2486","M-Shwari Withdraw for Group V2.0","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","12641","2486","M-Shwari Withdraw for Group V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Withdraw ${__params.Amount} from bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","12642","2486","M-Shwari Withdraw for Group V2.0","var input = __input.response;
if (input == '1') {
	__next = '2a';
} else if (input == '2') {
	__next = '2b0';
        __exemode='continue';
} else {
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12643","2486","M-Shwari Withdraw for Group V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group=  __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier= groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","4","12647","2486","M-Shwari Withdraw for Group V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b1';
__exemode='continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","12648","2486","M-Shwari Withdraw for Group V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check Groups","Check Groups",""<endrec>
"CUSTOMER","","1","12649","2488","M-Shwari Request Loan Terms and Conditions For Group V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType ='SetConditionRead';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '15'; 
__params.OrgShortCode = '2001';
__next = '1';","begin","set parameters","",""<endrec>
"CUSTOMER","","2","12650","2488","M-Shwari Request Loan Terms and Conditions For Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.ReceiverPartyIdentifier = input;
    __next = '2'; 
} 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","3","12651","2488","M-Shwari Request Loan Terms and Conditions For Group V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
}else{
  __next='3';
}","2","Terms and Conditions","<html>
<body>
Please read and confirm<br>
Please read and confirm the contents to Request Loan:<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>",""<endrec>
"CUSTOMER","","1","12657","2490","M-Shwari Withdraw V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12658","2490","M-Shwari Withdraw V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.Amount=Util.replaceAll(input,',','.');
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","3","12659","2490","M-Shwari Withdraw V2.0","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12660","2490","M-Shwari Withdraw V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Withdraw ${__params.Amount} from bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12661","2491","Not allow My name be searched V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'ChangeCustCNSKYCFlag';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__params.CNSReceiverFlag='02';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12662","2491","Not allow My name be searched V2.0","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '2';
__exemode = 'continue';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12663","2491","Not allow My name be searched V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
You are going to not allow your name searchable.<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","36","3","12668","2491","Not allow My name be searched V2.0","__committerParams.params = __params;
__next = '2a';
__exemode = 'continue';","2","Build Customer Info","Build Customer Info",""<endrec>
"CUSTOMER","","4","12669","2491","Not allow My name be searched V2.0","__params.KYCInfo = __input.lastCommitResult.result;
__next = '3';","2a","Get Customer Info","Get Customer Info",""<endrec>
"CUSTOMER","","1","12670","2493","Purchase Airtime via m-pesa V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","12671","2493","Purchase Airtime via m-pesa V2.0","var input = __input.response;
if (input == '1') {
  __params.RechargedMSISDN = __msisdn;
  __next = '3';
} else if (input == '2') {
  __next = '2';
} else {
  __next = '1';
}","1","Select Phone","<html>
<body>
Please select phone :<br>
1 My phone<br>
2 Other phone<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","12672","2493","Purchase Airtime via m-pesa V2.0","var input = __input.response;
if (input == 1) {
	__next = '3a';
} else if (input == '2') {
        __next = '3b';
        __exemode = 'continue';
} else {
	__next = '2';
}","2","Select option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12673","2493","Purchase Airtime via m-pesa V2.0","var input = __input.response;
if (!empty(input)) {
  __params.RechargedMSISDN = input;
  __next = '5';
} else {
  __next = '3a';
}","3a","Input MSISDN Number","<html>
<body>
Input MSISDN Number:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","12674","2493","Purchase Airtime via m-pesa V2.0","var isSucess = __input.validateResult.isSucess;
var input = __input.response;
var i = Util.toInt(input) - 1;
 if (isSucess){
  var beneficiary= beneficiaries.get(i);
  var beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.RechargedMSISDN = beneficiaryMsisdn ;
  __next = '5';
}
else
{
  __next = '4';
}","4","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ beneficiaries = __tmpData.beneficiaries;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","12675","2493","Purchase Airtime via m-pesa V2.0","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifier = '2001'; /* China Mobile's short code */
  __next = '6';
  __exemode='continue';
} else {
  __next = '5';
}","5","Input MNO name","<html>
<body>
Input MNO name:<br>
1 China Mobile<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","12676","2493","Purchase Airtime via m-pesa V2.0","var input = __input.response;
  if (!empty(input)) {
      var tmp = Util.toInt(input) - 1;
      var isSuccess = __input.validateResult.isSucess;
      if (isSuccess){ 
         type = __tempData.multiCurrencyCode.get(tmp);
         __params.Currency =  type;
         __next = '7';
      }else{
         __next = '6b';
      }
   } else {
         __next = '6b';
   }","6b","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$if (empty( __tempData.multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type :  __tempData.multiCurrencyCode) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","12677","2493","Purchase Airtime via m-pesa V2.0","var isSucess = __input.validateResult.isSucess;
var input = __input.response;
if (isSucess) {
    __params.Amount = Util.replaceAll(input,',','.');
    __next = '8';
    __exemode = 'continue';
} else {
    __next = '6';
}","7","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","15","12678","2493","Purchase Airtime via m-pesa V2.0","var isSucess = __input.validateResult.isSucess;
var input = __input.response;
var i = Util.toInt(input) - 1;
 if (isSucess){
     type = multiAccount.get(tmp);
     __params.InitiatorAccountNo= type.AccountNo;
     __next = '9';
  } else {
   __next = '8b';
  }","8b","Choose Initiator AccountNo","<html>
<body>
Please select Initiator account :<br>
$$multiAccount = __tmpData.accountList;
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","16","12679","2493","Purchase Airtime via m-pesa V2.0","var input = __input.response;
__params.PIN = input;
__next = '10';","9","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","22","12680","2493","Purchase Airtime via m-pesa V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '13a';
}","13a","Confirm1","<html>
<body>
Customer ${__params.ReceiverPartyIdentifier} does not exist on the system or is not registered.<br>
To buy airtime of ${__tempData.formatAmount} for ${__params.RechargedMSISDN}, the charge is ${ __tempData.chargeFee==null?'': __tempData.chargeFee}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","17","12681","2493","Purchase Airtime via m-pesa V2.0","var input = __input.response;
if (!empty(input) and size(input)>255)
{
   __next = '10';
}else
{
    __referenceData.Comment2Customer = input;
    __next = '11a';
    __exemode='continue';
}","10","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","23","5","12682","2493","Purchase Airtime via m-pesa V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__committerParams.IdentityType = __IdentityInfo.identityType;
__next  = '3c';
__exemode = 'continue';","3b","Query beneficiary","Query beneficiary",""<endrec>
"CUSTOMER","","6","12683","2493","Purchase Airtime via m-pesa V2.0","__tempData.beneficiaries = __input.lastCommitResult.result;
if (empty(__tempData.beneficiaries) || size(__tempData.beneficiaries) == 0) {
    __errormsg = 'Sorry, there is no beneficiary.';
    __next = 'error';
}
else
{
    __next = '4';
}","3c","Check selected beneficiary option","Check selected beneficiary option",""<endrec>
"CUSTOMER","24","9","12684","2493","Purchase Airtime via m-pesa V2.0","__next = '6a';
__exemode = 'continue';","6","Query available currencode","Query available currencode",""<endrec>
"CUSTOMER","","10","12685","2493","Purchase Airtime via m-pesa V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='6b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying foreign currencyCode.';
   __next = 'error';
}","6a","Check Query available currencycode","Check Query available currencycode",""<endrec>
"CUSTOMER","29","13","12686","2493","Purchase Airtime via m-pesa V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;

__next = '8a';
__exemode = 'continue';","8","Query Multi Accounts","Query Multi Accounts",""<endrec>
"CUSTOMER","","14","12687","2493","Purchase Airtime via m-pesa V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
      __tempData.accountList = __input.lastCommitResult.result;
      if (!empty(__tempData.accountList) || size(__tempData.accountList)>0)
      {
            __next = '9';
      }else
      {
            __next = 'error';
      }
}
else
{
    __next = 'error';
}","8a","Checker Multi Accounts","Checker Multi Accounts",""<endrec>
"CUSTOMER","26","18","12688","2493","Purchase Airtime via m-pesa V2.0","__committerParams.MSISDN = __params.RechargedMSISDN;
__next = '11b';
__exemode = 'continue';","11a","Query Customer Name","Query Customer Name",""<endrec>
"CUSTOMER","","19","12689","2493","Purchase Airtime via m-pesa V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    __tempData.customerNameAndTypeMap = __input.lastCommitResult.result;
    __next = '12a';
    __exemode = 'continue'; 
}else{
    __errormsg='Sorry,query customer info faild.';
    __next='error';
}","11b","Check Customer Name","Check Customer Name",""<endrec>
"CUSTOMER","27","20","12690","2493","Purchase Airtime via m-pesa V2.0","__next = '12b';
__exemode = 'continue';","12a","Query Customer Charge","Query Customer Charge",""<endrec>
"CUSTOMER","","21","12691","2493","Purchase Airtime via m-pesa V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    __tempData.chargeFee = __input.lastCommitResult.result;
}

__tempData.formatAmount = Util.formatAmount(__params.Currency, __params.Amount);

if(empty( __tempData.customerNameAndTypeMap)){
   __next = '13a';
}else{
   __tempData.customerFirstName =  __tempData.customerNameAndTypeMap.get(""firstName"");
    __tempData.customerMiddleName =  __tempData.customerNameAndTypeMap.get(""middleName"");
    __tempData.customerLastName =  __tempData.customerNameAndTypeMap.get(""lastName"");
    customerType =  __tempData.customerNameAndTypeMap.get(""customerType"");
    if(customerType == ""1001""){
        __next = '13b';
    }else{
        __next='13c';
    }
}","12b","Check Query Charge Info Result","Check Query Charge Info Result",""<endrec>
"CUSTOMER","","1","12692","2494","Query Bank Account V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'QueryIdentityBankAccount';
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;

__exemode = 'continue';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","12693","2494","Query Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
	__params.BankId = '-1';
	__params.BankName = 'Others';
	if (i < size(__tempData.items)) {
		item = __tempData.items.get(i);
		__params.BankId = item.value;
		__params.BankName = item.defaultName;
	}
       __exemode = 'continue';
	__next = '3';
} else if (i ==size(__tempData.items)){
        __params.BankId = '-1';
	__params.BankName = 'Others';
        __exemode = 'continue';
	__next = '3';
}else{
	__next = '2';
}","2","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:__tempData.items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","7","12694","2494","Query Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    bank = __tempData.bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '5';
} else {
  __next = '4';
}","4","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:__tempData.bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","12695","2494","Query Bank Account V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!isSuccess ||  empty(input ))
{
    __next = '5';
} else {
   __params.@HEAD@PIN = input ;
    __next = '6';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","9","12696","2494","Query Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","49","2","12697","2494","Query Bank Account V2.0","__next  = '1a';
__committerParams.DataDictKey ='BANK_CATEGORY';
__exemode = 'continue';","1","query Data DictType By Key","query Data DictType By Key",""<endrec>
"CUSTOMER","","3","12698","2494","Query Bank Account V2.0","__tempData.items   = __input.lastCommitResult.result;
   if (empty(__tempData.items ) )
   {
      __errormsg = 'Sorry, faild to get bank category.';
      __next = 'error';
   } else
   {
       __next = '2';
   }","1a","check Data DictType By Key","check Data DictType By Key",""<endrec>
"CUSTOMER","51","5","12699","2494","Query Bank Account V2.0","__next  = '3a';
__exemode = 'continue';
__committerParams.BankId =__params.BankId;","3","query Org BankList","query Org BankList",""<endrec>
"CUSTOMER","","6","12700","2494","Query Bank Account V2.0","__tempData.bankList= __input.lastCommitResult.result;
   if (empty(__tempData.bankList) || size(__tempData.bankList) == 0) {
      __errormsg = 'Sorry, can not find bank.';
      __next = 'error';
    } else {
       __next = '4';
    }","3a","check Org BankList","check Org BankList",""<endrec>
"CUSTOMER","","1","12701","2495","Query Bank Card Lookup V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'QueryIdentityBankCardLookup';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__next = '1';
__exemode = 'continue';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","12702","2495","Query Bank Card Lookup V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {

		item = __tempData.items.get(i);
		__params.BankId = item.value;
       __exemode = 'continue';
	__next = '3';
} else if (i ==size(__tempData.items)){
        __params.BankId = '-1';
        __exemode = 'continue';
	__next = '3';
}else{
	__next = '2';
}","2","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:__tempData.items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","7","12703","2495","Query Bank Card Lookup V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    bank = __tempData.bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __next = '5';
} else {
  __next = '4';
}","4","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:__tempData.bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","12704","2495","Query Bank Card Lookup V2.0","var input= __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess and !empty(input)) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","9","12705","2495","Query Bank Card Lookup V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","49","2","12715","2495","Query Bank Card Lookup V2.0","__next  = '1a';
__committerParams.DataDictKey ='BANK_CATEGORY';
__exemode = 'continue';","1","query Data DictType By Key","query Data DictType By Key",""<endrec>
"CUSTOMER","","3","12716","2495","Query Bank Card Lookup V2.0","__tempData.items   = __input.lastCommitResult.result;
   if (empty(__tempData.items ) )
   {
      __errormsg = 'Sorry, faild to get DataDictType.';
      __next = 'error';
   } else
   {
       __next = '2';
   }","1a","check Data DictType By Key","check Data DictType By Key",""<endrec>
"CUSTOMER","51","5","12717","2495","Query Bank Card Lookup V2.0","__next  = '3a';
__exemode = 'continue';
__committerParams.BankId =__params.BankId;","3","query Org BankList","query Org BankList",""<endrec>
"CUSTOMER","","6","12718","2495","Query Bank Card Lookup V2.0","__tempData.bankList= __input.lastCommitResult.result;
   if (empty(__tempData.bankList) || size(__tempData.bankList) == 0) {
      __errormsg = 'Sorry, can not find bank.';
      __next = 'error';
    } else {
       __next = '4';
    }","3a","check Org BankList","check Org BankList",""<endrec>
"CUSTOMER","","1","12719","2499","Query CustomerFF V2.0","__params.ActionType='QueryCustomerFF';
__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12720","2499","Query CustomerFF V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess){
 __params.@HEAD@PIN = input;
    __next = '2';
} else {
    __next = '1';
}","1","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","3","12721","2499","Query CustomerFF V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12730","2501","Query Group Account Balance V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group Code */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","12731","2501","Query Group Account Balance V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
     __params.ReceiverPartyIdentifier = input;
     __next = '3a';  
     __exemode='continue';   
}else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","9","12732","2501","Query Group Account Balance V2.0","var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if (isSuccess){
                __params.AccountTypeCode =  __tempData.accountTypes.get(i);
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }","3","Select Account Type","<html>
<body>
Please select account:<br>
  $$var i = 1;
  $$for(type: __tempData.accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","10","12733","2501","Query Group Account Balance V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess){
    __params.PIN = input;
    __next = '5';
} else {
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","11","12734","2501","Query Group Account Balance V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","12735","2501","Query Group Account Balance V2.0","var input = __input.response;
if (input == '1') {
	__next = '2a';
} else if (input == '2') {
	__next = '2b0';
        __exemode='continue';
} else {
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12736","2501","Query Group Account Balance V2.0","var input=__input.response;
if(!empty(input)){
   var i = Util.toInt(input) - 1;
 var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3a';
  __exemode='continue';
 }else{
  __next = '2b';
 }
}else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","1","12737","2502","Manage CustomerFF V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12738","2502","Manage CustomerFF V2.0","var input = __input.response;
if (input == '1') {
__params.ActionType = 'AddCustomerFF';
__next = '2';
} else if (input == '2') {
__params.ActionType = 'ModifyCustomerFF';
__next = '2';
}else if (input == '3') {
__params.ActionType = 'DeleteCustomerFF';
__next = '2';
}else{
__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Add CustomerFF<br>
2 Modify CustomerFF<br>
3 Delete CustomerFF<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","12739","2502","Manage CustomerFF V2.0","var input = __input.response;
__params.FFMSISDN = input;
if(__params.ActionType == 'AddCustomerFF'){
__next = '4';
}else if(__params.ActionType == 'DeleteCustomerFF'){
__next = '6';
}else{
__next = '3';
}","2","Enter MSISDN","<html>
<body>
Enter MSISDN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","12740","2502","Manage CustomerFF V2.0","var input = __input.response;
__params.FFTargetMSISDN = input;
__next = '5';","3","Enter New MSISDN","<html>
<body>
Enter new MSISDN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12741","2502","Manage CustomerFF V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to change?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12742","2502","Manage CustomerFF V2.0","var input = __input.response;
__params.FFNameList = input;
if(__params.ActionType == 'AddCustomerFF'){
__next = '6';
}else{
__next = '5';
}","4","Enter FnFNickName","<html>
<body>
Enter FnFNickName
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12743","2502","Manage CustomerFF V2.0","var input = __input.response;
__params.FFTargetNameList = input;
__next = '6';","5","Enter New FnFNickName","<html>
<body>
Enter new FnFNickName
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","12744","2502","Manage CustomerFF V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess){
   __params.@HEAD@PIN = input;
    __next = '7';
} else {
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","30","4","12745","2501","Query Group Account Balance V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b1';
__exemode='continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","12746","2501","Query Group Account Balance V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check Groups","Check Groups",""<endrec>
"CUSTOMER","29","7","12747","2501","Query Group Account Balance V2.0","__committerParams.IdentityId=__params.ReceiverPartyIdentifier;
__committerParams.IdentityType='7000';
__committerParams.IdentifierType='15';
__committerParams.isForType=true;
__next='3b';
__exemode='continue';","3a","Query Account Type","Query Account Type",""<endrec>
"CUSTOMER","","8","12748","2501","Query Group Account Balance V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.accountTypes=__input.lastCommitResult.result;
   if(empty(__tempData.accountTypes)|| size(__tempData.accountTypes)==0){
       __errormsg = 'no accouYou have no account to query.';
       __next = 'error';
   }else {
       __next = '3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying account types.';
   __next = 'error';
}","3b","Check Acoount Types","Check Acoount Types",""<endrec>
"CUSTOMER","","1","12749","2503","Query Group Bank Account V2.0","__params.ServiceCode = __serviceCode;
__params.Channel =__sessionID.channelType;
__params.ActionType = 'QueryIdentityBankAccount';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.RequesterIdentifierType = ""01"";
__params.RequesterIdentifier = __msisdn;
__exemode = 'continue';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","12750","2503","Query Group Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = '3';
} else if (input == '2') {
  __next = '4'
} else {
  __next = '2';
}","2","Select Group","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12751","2503","Query Group Bank Account V2.0","var input = __input.response;
var found = '0';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: __tempData.groups){
if(group.groupCode == input)
{
  found = '1';
}
}
if ( found == '0') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   __exemode = 'continue';
   __next = '5';
}
}
 else {
      __next = '3';
}","3","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12752","2503","Query Group Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __exemode = 'continue';
  __next = '5';
}
else{
  __next = '4';
}","4","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","12753","2503","Query Group Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
	__params.BankId = '-1';
	__params.BankName = 'Others';
	if (i < size(__tempData.items)) {
		item = __tempData.items.get(i);
		__params.BankId = item.value;
		__params.BankName = item.defaultName;
	}
       __exemode = 'continue';
	__next = '8';
} else if (i ==size(__tempData.items)){
        __params.BankId = '-1';
	__params.BankName = 'Others';
        __exemode = 'continue';
	__next = '8';
}else{
	__next = '7';
}","7","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:__tempData.items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","14","12754","2503","Query Group Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    bank = __tempData.bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '10';
} else {
  __next = '9';
}","9","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:__tempData.bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","15","12755","2503","Query Group Bank Account V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!isSuccess ||  empty(input ))
{
    __next = '10';
} else {
   __params.@HEAD@PIN = input ;
    __next = '11';
}","10","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","16","12756","2503","Query Group Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","11","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","2","12757","2503","Query Group Bank Account V2.0","__next  = '1a';
__committerParams.MSISDN=__msisdn;
__exemode = 'continue';","1","query My Groups","query My Groups",""<endrec>
"CUSTOMER","","3","12758","2503","Query Group Bank Account V2.0","__tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups ) || size(__tempData.groups ) == 0)
   {
      __errormsg = 'Sorry, you have no groups .';
      __next = 'error';
   } else
   {
       __next = '2';
   }","1a","check My Group","check My Group",""<endrec>
"CUSTOMER","31","7","12759","2503","Query Group Bank Account V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__next = '5a';
__exemode = 'continue';","5","Query Group Member Roles","Query Group Member Roles",""<endrec>
"CUSTOMER","","8","12760","2503","Query Group Bank Account V2.0","__tempData.roleList = __input.lastCommitResult.result;

if (!empty(__tempData.roleList ) || size(__tempData.roleList )>0) {
  __next = '6';
__exemode = 'continue';
 } else {
   __errormsg = 'no current group member role.';
   __next = 'error';
 }","5a","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","49","9","12761","2503","Query Group Bank Account V2.0","__next  = '6a';
__committerParams.DataDictKey ='BANK_CATEGORY';
__exemode = 'continue';","6","query Data DictType By Key","query Data DictType By Key",""<endrec>
"CUSTOMER","","10","12762","2503","Query Group Bank Account V2.0","__tempData.items   = __input.lastCommitResult.result;
   if (empty(__tempData.items ) )
   {
      __errormsg = 'Sorry, faild to get bank category.';
      __next = 'error';
   } else
   {
       __next = '7';
   }","6a","check Data DictType By Key","check Data DictType By Key",""<endrec>
"CUSTOMER","51","12","12763","2503","Query Group Bank Account V2.0","__next  = '8a';
__exemode = 'continue';
__committerParams.BankId =__params.BankId;","8","query Org BankList","query Org BankList",""<endrec>
"CUSTOMER","","13","12764","2503","Query Group Bank Account V2.0","__tempData.bankList= __input.lastCommitResult.result;
   if (empty(__tempData.bankList) || size(__tempData.bankList) == 0) {
      __errormsg = 'Sorry, can not find bank.';
      __next = 'error';
    } else {
       __next = '9';
    }","8a","check Org BankList","check Org BankList",""<endrec>
"CUSTOMER","","1","12765","2504","Query Group Bank Card Lookup V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'QueryIdentityBankCardLookup';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.RequesterIdentifierType = ""01""; /* MSISDN */
__params.RequesterIdentifier = __msisdn;
__next = '1';
__exemode = 'continue';","begin","set parammeters","",""<endrec>
"CUSTOMER","","6","12766","2504","Query Group Bank Card Lookup V2.0","var input = __input.response;
if (input == '1') {
  __next = '4';
} else if (input == '2') {
       __next = '5';
} else {
   __next = '3';
}","3","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","12767","2504","Query Group Bank Card Lookup V2.0","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifier = input;
    __next = '6';
}else {
    __next = '4';
}","4","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12768","2504","Query Group Bank Card Lookup V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '6';
}
else{
  __next = '5';
}","5","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","9","12769","2504","Query Group Bank Card Lookup V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {

          item = __tempData.items.get(i);
        __params.BankId = item.value;
       __exemode = 'continue';
  __next = '7';
} else if (i ==size(__tempData.items)){
        __params.BankId = '-1';
        __exemode = 'continue';
  __next = '7';
}else{
  __next = '6';
}","6","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:__tempData.items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","12770","2504","Query Group Bank Card Lookup V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    bank = __tempData.bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '9';
} else {
  __next = '10';
}","8","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:__tempData.bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","13","12771","2504","Query Group Bank Card Lookup V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!isSuccess ||  empty(input ))
{
    __next = '9';
} else {
   __params.@HEAD@PIN = input ;
    __next = '10';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","14","12772","2504","Query Group Bank Card Lookup V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","2","12773","2504","Query Group Bank Card Lookup V2.0","__next  = '1a';
__committerParams.MSISDN=__msisdn;
__exemode = 'continue';","1","query My Groups","query My Groups",""<endrec>
"CUSTOMER","","3","12774","2504","Query Group Bank Card Lookup V2.0","__tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups ) || size(__tempData.groups ) == 0)
   {
      __errormsg = 'Sorry, you have no groups .';
      __next = 'error';
   } else
   {
       __exemode='continue';
       __next = '2';
   }","1a","check My Group","check My Group",""<endrec>
"CUSTOMER","49","4","12775","2504","Query Group Bank Card Lookup V2.0","__next  = '2a';
__committerParams.DataDictKey ='BANK_CATEGORY';
__exemode = 'continue';","2","query Bank Category","query Bank Category",""<endrec>
"CUSTOMER","","5","12776","2504","Query Group Bank Card Lookup V2.0","__tempData.items   = __input.lastCommitResult.result;
   if (empty(__tempData.items ) )
   {
      __errormsg = 'Sorry, faild to get Bank Category.';
      __next = 'error';
   } else
   {
       __next = '3';
   }","2a","check Bank Category","check Bank Category",""<endrec>
"CUSTOMER","51","10","12777","2504","Query Group Bank Card Lookup V2.0","__next  = '7a';
__exemode = 'continue';
__committerParams.BankId =__params.BankId;","7","query Org BankLis","query Org BankLis",""<endrec>
"CUSTOMER","","11","12778","2504","Query Group Bank Card Lookup V2.0","__tempData.bankList= __input.lastCommitResult.result;
   if (empty(__tempData.bankList) || size(__tempData.bankList) == 0) {
      __errormsg = 'Sorry, can not find bank.';
      __next = 'error';
    } else {
       __next = '8';
    }","7a","check Org BankLis","check Org BankLis",""<endrec>
"CUSTOMER","","1","12779","2505","Query Group List V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'QueryGroupList';
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","12780","2505","Query Group List V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input)  and  isSuccess) {
    __params.@HEAD@PIN = input;
    __next = '2';
} else {
    __next = '1';
}","1","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","3","12781","2505","Query Group List V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12782","2506","Query Group Mini Statement V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group Code */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","12783","2506","Query Group Mini Statement V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
     __params.ReceiverPartyIdentifier = input;
     __next = '3a';  
     __exemode='continue';   
}else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","9","12784","2506","Query Group Mini Statement V2.0","var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if (isSuccess){
                __params.AccountTypeCode =  __tempData.accountTypes.get(i);
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }","3","Select Account Type","<html>
<body>
Please select account:<br>
  $$var i = 1;
  $$for(type: __tempData.accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","10","12785","2506","Query Group Mini Statement V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess){
    __params.PIN = input;
    __next = '5';
} else {
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","11","12786","2506","Query Group Mini Statement V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","12787","2506","Query Group Mini Statement V2.0","var input = __input.response;
if (input == '1') {
	__next = '2a';
} else if (input == '2') {
	__next = '2b0';
        __exemode='continue';
} else {
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12788","2506","Query Group Mini Statement V2.0","var input=__input.response;
if(!empty(input)){
   var i = Util.toInt(input) - 1;
 var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3a';
  __exemode='continue';
 }else{
  __next = '2b';
 }
}else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","4","12789","2506","Query Group Mini Statement V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b1';
__exemode='continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","12790","2506","Query Group Mini Statement V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check Groups","Check Groups",""<endrec>
"CUSTOMER","29","7","12791","2506","Query Group Mini Statement V2.0","__committerParams.IdentityId=__params.ReceiverPartyIdentifier;
__committerParams.IdentityType='7000';
__committerParams.IdentifierType='15';
__committerParams.isForType=true;
__next='3b';
__exemode='continue';","3a","Query All Account Type","Query All Account Type",""<endrec>
"CUSTOMER","","8","12792","2506","Query Group Mini Statement V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.accountTypes=__input.lastCommitResult.result;
   if(empty(__tempData.accountTypes)|| size(__tempData.accountTypes)==0){
       __errormsg = 'no accouYou have no account to query.';
       __next = 'error';
   }else {
       __next = '3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying account types.';
   __next = 'error';
}","3b","Check Acoount Types","Check Acoount Types",""<endrec>
"CUSTOMER","","1","12793","2507","Query My Group Bundles V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'QueryGroupIdentityBundleDetails';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.RequesterIdentifierType = ""01"";
__params.RequesterIdentifier = __msisdn;
__exemode = 'continue';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","12794","2507","Query My Group Bundles V2.0","var input = __input.response;
if (input == '1') {
  __next = '3';
} else if (input == '2') {
  __next = '4'
} else {
  __next = '2';
}","2","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","12795","2507","Query My Group Bundles V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess)
{
__params.BundleType= input ;
 __next = '7';
__exemode = 'continue';
}
else {
 __next = '1';
}","6","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","12","12796","2507","Query My Group Bundles V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
   type = __tempData.BundleList.get(i);
  __params.IdentityBundleId = type.identityBundleId;
       __next = '9';
    } else {
        __next = '8';
    }","8","Select Destination Bundle","<html>
<body>
Please select Destination bundle:<br>
  $$var i = 1;
  $$for(bundle: __tempData.BundleList ) {
  ${i}  ${bundle['identityBundleId']} :${bundle['bundleName']} ${bundle['internalPrice']} ${bundle['Currency']}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","13","12797","2507","Query My Group Bundles V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess  and !empty(input) ) {
 __params.@HEAD@PIN = input;
    __next = '10';
} else {
    __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","14","12798","2507","Query My Group Bundles V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12799","2507","Query My Group Bundles V2.0","var input = __input.response;
var found = '0';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: __tempData.groups){
if(group.groupCode == input)
{
  found = '1';
}
}
if ( found == '0') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
__exemode = 'continue';
   __next = '5';
}
}
 else {
      __next = '3';
}","3","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12800","2507","Query My Group Bundles V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
__exemode = 'continue';
  __next = '5';
}
else{
  __next = '4';
}","4","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","2","12801","2507","Query My Group Bundles V2.0","__next  = '1a';
__committerParams.MSISDN=__msisdn;
__exemode = 'continue';","1","query My Groups","query My Groups",""<endrec>
"CUSTOMER","","3","12802","2507","Query My Group Bundles V2.0","__tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups ) || size(__tempData.groups ) == 0)
   {
      __errormsg = 'Sorry, you have no groups .';
      __next = 'error';
   } else
   {
       __next = '2';
   }","1a","check My Group","check My Group",""<endrec>
"CUSTOMER","31","7","12803","2507","Query My Group Bundles V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__next = '5a';
__exemode = 'continue';","5","Query Group Member Roles","Query Group Member Roles",""<endrec>
"CUSTOMER","","8","12804","2507","Query My Group Bundles V2.0","__tempData.roleList = __input.lastCommitResult.result;

if (!empty(__tempData.roleList ) || size(__tempData.roleList )) {
  __next = '6';
 } else {
   __errormsg = 'no current group member role.';
   __next = 'error';
 }","5a","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","64","10","12805","2507","Query My Group Bundles V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier ;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType ;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier ;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType ;
__committerParams.AccessDeviceIdentifierType = __params.AccessDeviceIdentifierType ;
__committerParams.AccessDeviceIdentifier = __params.AccessDeviceIdentifier ;
__committerParams.BundleType = __params.BundleType;
__next  = '7a';
__exemode = 'continue';","7","query Bundle","query Bundle",""<endrec>
"CUSTOMER","","11","12806","2507","Query My Group Bundles V2.0","__tempData.BundleList = __input.lastCommitResult.result;
   if (empty(__tempData.BundleList) || size(__tempData.BundleList) == 0) {
      __errormsg = 'Sorry, No bundle you have subscribed.';
      __next = 'error';
    } else {
       __next = '8';
    }","7a","check Bundle","check Bundle",""<endrec>
"CUSTOMER","","1","12807","2508","Query My Own Bundles V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'QueryCustomerIdentityBundleDetails';
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = __msisdn;
__params.InitiatorIdentifierType= '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier= __msisdn;
__params.PrimaryIdentifierType= '04'; /* SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","12808","2508","Query My Own Bundles V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess)
{
__params.BundleType= input ;
 __next = '2';
__exemode = 'continue';
}
else {
 __next = '1';
}","1","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","5","12809","2508","Query My Own Bundles V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
   type = __tempData.BundleList.get(i);
       __params.IdentityBundleId = type.identityBundleId;
       __next = '4';
    } else {
        __next = '3';
    }","3","Select Destination Bundle","<html>
<body>
Please select Destination bundle:<br>
  $$var i = 1;
  $$for(bundle: __tempData.BundleList ) {
  ${i}  ${bundle['identityBundleId']} :${bundle['bundleName']} ${bundle['internalPrice']} ${bundle['Currency']}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","6","12810","2508","Query My Own Bundles V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess  and !empty(input) ) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","12811","2508","Query My Own Bundles V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","64","3","12812","2508","Query My Own Bundles V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__committerParams.AccessDeviceIdentifierType = __params.InitiatingDeviceType;
__committerParams.AccessDeviceIdentifier = __params.InitiatingDeviceValue;
__committerParams.BundleType = __params.BundleType;
__next  = '2a';
__exemode = 'continue';","2","query Bundle","query Bundle",""<endrec>
"CUSTOMER","","4","12813","2508","Query My Own Bundles V2.0","__tempData.BundleList = __input.lastCommitResult.result;
   if (empty(__tempData.BundleList) || size(__tempData.BundleList) == 0) {
      __errormsg = 'Sorry, No bundle you have subscribed..';
      __next = 'error';
    } else {
       __next = '3';
    }","2a","check Identity Bundle","check Identity Bundle",""<endrec>
"CUSTOMER","","1","12814","2509","Remove Group Member V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'RemoveGroupMember';
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn; /* MSISDN */
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn; /* MSISDN */
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","12815","2509","Remove Group Member V2.0","var input = __input.response;
 if (__input.validateResult.isSucess) {
     __params.ReceiverPartyIdentifier = input;
     __next = '3';
} else {
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","12816","2509","Remove Group Member V2.0","var input = __input.response;
if (!empty(input)) {
    __params.RemovedMSISDN = input;
    __next = '4';
} else {
    __next = '3';
}","3","Enter Removed Customer MSISDN","<html>
<body>
Enter Removed Customer MSISDN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12817","2509","Remove Group Member V2.0","var input = __input.response;
var isSucess = __input.validateResult.isSucess;
if (!empty(input)  and  isSucess) {
    __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","9","12818","2509","Remove Group Member V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to remove group member ${__params.RemovedMSISDN}?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","12819","2509","Remove Group Member V2.0","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
    __next = '2b0';
    __exemode = 'continue';
} else {
  __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12820","2509","Remove Group Member V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
    group = __tempData.groups.get(i);
    groupCode = group.groupCode;
    __params.ReceiverPartyIdentifier = groupCode;
    __next = '3';
} else {
    __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","4","12821","2509","Remove Group Member V2.0","__committerParams.MSISDN = __msisdn;
__next = '2b1';
__exemode = 'continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","12822","2509","Remove Group Member V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'Sorry, there is no groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check Groups","Check Groups",""<endrec>
"CUSTOMER","","1","12823","2510","Request Deposit Voucher V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReasonTypeCode = 'CustomerApplyDepositVoucher';  
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","6","12824","2510","Request Deposit Voucher V2.0","var input = __input.response;
if(!empty(input) and (size(input)< __params.minLength  || size(input)> __params.maxLength))
{
__params.info = 'The length of a secret code must be in the range of [' + __params.minLength + ',' + __params.maxLength + '], please enter secret code again!';
__next = '1';
}
else if(!empty(__params.rule) and input !~ __params.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __params.rule + ', please enter secret code again!';
__next = '1';
}
else
{
__params.VoucherSecretCode = input;
__next = '2';
}","1","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","12825","2510","Request Deposit Voucher V2.0","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12826","2510","Request Deposit Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '2') {
  __next = 'cancel';
} else {
  __next = '2';
}","3","Confirm","<html>
<body>
Confirm to Request Deposit Voucher?<br>
1 OK<br>
2 Quit<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","28","2","12827","2510","Request Deposit Voucher V2.0","__committerParams.ReasonTypeCode=__params.ReasonTypeCode;
__next='1b';
__exemode='continue';","1a","Query isSupportSecretCode","Query isSupportSecretCode",""<endrec>
"CUSTOMER","","3","12828","2510","Request Deposit Voucher V2.0","if (__input.lastCommitResult.isSucess)
{
    var isSupportSecretCode = __input.lastCommitResult.result;
  if(isSupportSecretCode)
  {
   __next = '1c';
   __exemode='continue';
  }else{
  __next = '2';
  }
}else{
   __errormsg = 'Sorry,error occured when querying isSupportSecretCode.';
   __next = 'error';
}","1b","Check isSupportSecretCode","Check isSupportSecretCode",""<endrec>
"CUSTOMER","68","4","12829","2510","Request Deposit Voucher V2.0","__next='1d';
__exemode='continue';","1c","Query Secret Code Rule","Query Secret Code Rule",""<endrec>
"CUSTOMER","","5","12830","2510","Request Deposit Voucher V2.0","if (__input.lastCommitResult.isSucess)
{
    secretCodeRule =__input.lastCommitResult.result;
   if(empty(secretCodeRule )){
       __errormsg = 'The Secret Code Rule is empty.';
       __next = 'error';
   }else {
__params.minLength = secretCodeRule.getMinLength();
__params.maxLength = secretCodeRule.getMaxLength();
__params.rule = secretCodeRule.getRule();
__params.info = 'Enter a secret code:';
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying Secret Code Rule.';
   __next = 'error';
}","1d","Check Secret Code Rule","Check Secret Code Rule",""<endrec>
"CUSTOMER","","1","12831","2511","Request Withdraw Voucher V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReasonTypeCode = 'CustomerApplyWithdrawVoucher'; 
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","6","12832","2511","Request Withdraw Voucher V2.0","var input = __input.response;
if(!empty(input) and (size(input)< __params.minLength  || size(input)> __params.maxLength))
{
__params.info = 'The length of a secret code must be in the range of [' + __params.minLength + ',' + __params.maxLength + '], please enter secret code again!';
__next = '1';
}
else if(!empty(__params.rule) and input !~ __params.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __params.rule + ', please enter secret code again!';
__next = '1';
}
else
{
__params.VoucherSecretCode = input;
__next = '2';
}","1","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","12833","2511","Request Withdraw Voucher V2.0","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12834","2511","Request Withdraw Voucher V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '2') {
  __next = 'cancel';
} else {
  __next = '2';
}","3","Confirm","<html>
<body>
Confirm to Request Withdraw Voucher?<br>
1 OK<br>
2 Quit<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","28","2","12835","2511","Request Withdraw Voucher V2.0","__committerParams.ReasonTypeCode=__params.ReasonTypeCode;
__next='1b';
__exemode='continue';","1a","Query isSupportSecretCode","Query isSupportSecretCode",""<endrec>
"CUSTOMER","","3","12836","2511","Request Withdraw Voucher V2.0","if (__input.lastCommitResult.isSucess)
{
    var isSupportSecretCode = __input.lastCommitResult.result;
  if(isSupportSecretCode)
  {
   __next = '1c';
   __exemode='continue';
  }else{
  __next = '2';
  }
}else{
   __errormsg = 'Sorry,error occured when querying isSupportSecretCode.';
   __next = 'error';
}","1b","Check isSupportSecretCode","Check isSupportSecretCode",""<endrec>
"CUSTOMER","68","4","12837","2511","Request Withdraw Voucher V2.0","__next='1d';
__exemode='continue';","1c","Query Secret Code Rule","Query Secret Code Rule",""<endrec>
"CUSTOMER","","5","12838","2511","Request Withdraw Voucher V2.0","if (__input.lastCommitResult.isSucess)
{
    secretCodeRule =__input.lastCommitResult.result;
   if(empty(secretCodeRule )){
       __errormsg = 'The Secret Code Rule is empty.';
       __next = 'error';
   }else {
__params.minLength = secretCodeRule.getMinLength();
__params.maxLength = secretCodeRule.getMaxLength();
__params.rule = secretCodeRule.getRule();
__params.info = 'Enter a secret code:';
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying Secret Code Rule.';
   __next = 'error';
}","1d","Check Secret Code Rule","Check Secret Code Rule",""<endrec>
"CUSTOMER","","1","12839","2512","Send Money via m-pesa With Prevalidation V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","9","12840","2512","Send Money via m-pesa With Prevalidation V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
                __params.Currency =__tempData.multiCurrencyCode.get(tmp);
                __next = '4a';
                __exemode='continue';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","13","12841","2512","Send Money via m-pesa With Prevalidation V2.0","var input = __input.response;
  if (!empty(input)) {
    var tmp = Util.toInt(input) - 1;
    var isSuccess = __input.validateResult.isSucess;
    if(isSuccess) {
       type = __tempData.multiAccount.get(tmp);
     __params.InitiatorAccountNo= type.AccountNo;
     __next = '6';
    } else {
     __next = '5';
    }
  } else {
   __next = '5';
  }","5","Choose Initiator AccountNo","<html>
<body>
Please select Initiator account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","2","12842","2512","Send Money via m-pesa With Prevalidation V2.0","var input = __input.response;
if (input == '1') {
   __next = '2a';
} else if (input == '2') {
  __next = '2b0';
  __exemode='continue';
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","12843","2512","Send Money via m-pesa With Prevalidation V2.0","var input = __input.response;
if(empty(input)){
  __next='2a';
}else{
  __params.ReceiverPartyIdentifier = input;
  __next = '3a';
  __exemode='continue';
}","2a","Input Phone Number","<html>
<body>
Input Phone Number:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12844","2512","Send Money via m-pesa With Prevalidation V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  beneficiary= __tempData.beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3a';
  __exemode='continue';
}
else{
  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: __tempData.beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","12845","2512","Send Money via m-pesa With Prevalidation V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    __params.Amount = Util.replaceAll(input,',','.');
    __next = '5';
  if(1 == size(__tempData.multiAccount) )
  {
    type = __tempData.multiAccount.get(0);
    if(empty(type.defaultFlag) ||  type.defaultFlag == 'true')
    {
      __next = '6';
    }
  }
} else {
    __next = '4';
}","4","Input Amount","<html>
<body>
Input Amount:<br>
$$multiAccount = __tempData.multiAccount;
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","14","12846","2512","Send Money via m-pesa With Prevalidation V2.0","var input = __input.response;
if (!empty(input) and size(input)> 255)
{
    __next = '6';
}
else
{
    __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","12847","2512","Send Money via m-pesa With Prevalidation V2.0","var input = __input.response;
if (input == '1') {
  __next = '8';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm Information","<html>
<body>
Transaction Information:<br>
Phone Number : ${__params.ReceiverPartyIdentifier}<br>
CurrencyCode : ${__params.Currency}<br>
Amount : ${__params.Amount}<br>
Comment  : ${__referenceData.Comment2Customer}<br>
Press 1 to confirm or 0 to cancel:<br>
1 Submit <br>
0 Cancel <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","12848","2512","Send Money via m-pesa With Prevalidation V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.PIN = input;
    __next = '8a';
    __exemode='continue';
} else {
    __next = '8';
}","8","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","21","12849","2512","Send Money via m-pesa With Prevalidation V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
__params.IsCNSDataDisplayed = 'false';
__tempData.notificationParams= Util.createMap();
if(isSuccess){
   if(input == '1'){
       if(__tempData.isSupportCNS==false || __tempData.cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01'){
          __next='11';
        }else{
          __next='9c';
          __exemode='continue';
        }
   }else{
      __next = '11';
   }
}else{
   __next='9';
}","9","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","28","12850","2512","Send Money via m-pesa With Prevalidation V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess)
{
   __params.OperationType= input ;
   if (input == '1')
   {
      __next = '11';
   }else if (input == '2') {
      sendNotificationfor='reject';
      __exemode='continue';
      __next='10b0';      
   }
}
else {
   __next = '10';
}","10","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__tempData.promptMsg}<br>
${__tempData.tips}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","31","12851","2512","Send Money via m-pesa With Prevalidation V2.0","var input = __input.response;
if (input == '1') {
 if(__tempData.isSupportCNS){
  __params.ResultType='0';
  __params.EventType=""PRE_VALIDATION"";
  __params.Reason=""Continue Pre-Validation Transaction"";
  __next='11a0';
  __exemode='continue';
 }else{
   __next='end';
 }
} else if(input == '0') {
  if(__params.IsCNSDataDisplayed == 'Yes'  and  __tempData.cust.initiatorCNSStatus.suspensionFlag.fieldValue != '01')
  {
      __next='10b0';
      __exemode='continue';
  }else{
     __params.EventType=""PRE_VALIDATION"";
     __params.errDesc='Pre-Validation Result is Rejected.';
     __params.Reason=""Rejected"";
     __errormsg = 'You have chosed to reject transation,Please check notification.';
     __next='12a1';
     __exemode='continue';
     sendNotificationfor='cancel';
  }
} else {
  __next = '11';
}","11","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","83","32","12852","2512","Send Money via m-pesa With Prevalidation V2.0","__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
 __committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
__next='11a1';
__exemode='continue';","11a0","cns Confirm Process","cns Confirm Process",""<endrec>
"CUSTOMER","","33","12853","2512","Send Money via m-pesa With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
    __next='12a';
    __exemode='continue';
}else{
   __errormsg = 'Sorry,error occured when processing CNS Cancelation.';
   __next = 'error';
}","11a1","check cns Confirm Process","check cns Confirm Process",""<endrec>
"CUSTOMER","78","34","12854","2512","Send Money via m-pesa With Prevalidation V2.0","__committerParams.EventType=__params.EventType;
__committerParams.Channel =  __params.Channel;
__committerParams.ResultCode ='0';
__committerParams.ResultType='1';
__committerParams.Reason = 'Continue Pre-Validation Transaction.  ChannelSessionID=' + __sessionID;
previousSavingLog='continue';
__next='12b';
__exemode='continue';","12a","Saving PreValidation Event Log","Saving PreValidation Event Log",""<endrec>
"CUSTOMER","78","35","12855","2512","Send Money via m-pesa With Prevalidation V2.0","__committerParams.EventType=__params.EventType;
__committerParams.Channel =  __params.Channel;
__committerParams.ResultCode ='1';
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __sessionID;
previousSavingLog='rejected';
__next='12b';
__exemode='continue';","12a1","Saving PreValidation Event Log for Reject","Saving PreValidation Event Log for Reject",""<endrec>
"CUSTOMER","","36","12856","2512","Send Money via m-pesa With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
   if(previousSavingLog=='rejected'){
    __tempData.notificationParams.TransactionUMCPreValidationEvent='Rejected';
     __tempData.notificationParams.TransactionUMCPreValidationError='Choosing Reject';
     __tempData.notificationParams.put('Common.Result.ErrorCode','TS28009');
     __tempData.notificationParams.errDesc='Pre-Validation Result is Rejected.';
      if (empty(__tempData.recipientList)) {
       __errormsg = 'The recipient is null and send notification failed.';
       __next='error';
     } else {
       __next='13a';
       __exemode='continue';
     }
   }else{
       __next = 'end';
   }
}else{
   __errormsg = 'Sorry,saved pre-validation event log failed';
   __next = 'error';
}","12b","Check Saving PreValidation Event Log","Check Saving PreValidation Event Log",""<endrec>
"CUSTOMER","79","37","12857","2512","Send Money via m-pesa With Prevalidation V2.0","__committerParams.notificationParams = __tempData.notificationParams;
__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.recipientList;
__committerParams.Channel = __params.Channel;
__next='13b';
__exemode='continue';","13a","send PreValidation Notification","send PreValidation Notification",""<endrec>
"CUSTOMER","","38","12858","2512","Send Money via m-pesa With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
   if(__tempData.notificationParams.TransactionUMCPreValidationEvent=='Failed'){
       __next='error';
   }else if(previousSavingLog=='rejected'){
       if(sendNotificationfor=='cancel'){
          __next = 'cancel';
       }else{
          __next='error';
       }
   }
}else{
   __errormsg = 'Sorry,send pre-validation notification failed.';
   __next = 'error';
}","13b","Check sending Pre-validation Notification","Check sending Pre-validation Notification",""<endrec>
"CUSTOMER","23","4","12859","2512","Send Money via m-pesa With Prevalidation V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__committerParams.IdentityType = __IdentityInfo.identityType;
__next='2b1';
__exemode='continue';","2b0","Query Customer Beneficiary","Query Customer Beneficiary",""<endrec>
"CUSTOMER","","5","12860","2512","Send Money via m-pesa With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.beneficiaries = __input.lastCommitResult.result;
   if (empty(__tempData.beneficiaries) || size(__tempData.beneficiaries) == 0) {
      __errormsg = 'Sorry,there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
}else{
   __errormsg = 'Sorry,error occured when querying customer beneficiary.';
   __next = 'error';
}","2b1","Check Customer Beneficiary","Check Customer Beneficiary",""<endrec>
"CUSTOMER","24","7","12861","2512","Send Money via m-pesa With Prevalidation V2.0","__next='3b';
__exemode='continue';","3a","Query All Currency","Query All Currency",""<endrec>
"CUSTOMER","","8","12862","2512","Send Money via m-pesa With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying all currency.';
   __next = 'error';
}","3b","Check All Currency","Check All Currency",""<endrec>
"CUSTOMER","29","10","12863","2512","Send Money via m-pesa With Prevalidation V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;
__next='4b';
__exemode='continue';","4a","Query Multi Account","Query Multi Account",""<endrec>
"CUSTOMER","","11","12864","2512","Send Money via m-pesa With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='4';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","4b","Check Multi Account","Check Multi Account",""<endrec>
"CUSTOMER","48","17","12865","2512","Send Money via m-pesa With Prevalidation V2.0","__committerParams.SystemParamCode='SUPPORT_CNS_USSD_PUSH';
__next='8b';
__exemode='continue';","8a","Query isSupportCNS","Query isSupportCNS",""<endrec>
"CUSTOMER","","18","12866","2512","Send Money via m-pesa With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.isSupportCNS =__input.lastCommitResult.result=='1';
    __next='8c';
    __exemode='continue';
}else{
   __errormsg = 'Sorry,check isSupportCustomerNameSearch faild.';
   __next = 'error';
}","8b","Get isSupportCNS","Get isSupportCNS",""<endrec>
"CUSTOMER","81","19","12867","2512","Send Money via m-pesa With Prevalidation V2.0","__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__next='8d';
__exemode='continue';","8c","Query Identity Name","Query Identity Name",""<endrec>
"CUSTOMER","","20","12868","2512","Send Money via m-pesa With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.cust =__input.lastCommitResult.result;
   if(empty(__tempData.cust)){
       __errormsg = 'identity info is null.';
       __next = 'error';
   }else {
       __exemode='continue';
       __next='9a';
   }
}else{
   __errormsg = 'Sorry,error occured when querying identity info.';
   __next = 'error';
}","8d","Check Identity Name","Check Identity Name",""<endrec>
"CUSTOMER","77","22","12869","2512","Send Money via m-pesa With Prevalidation V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.Identifier = __msisdn;
__committerParams.IdentifierType = '01';
__committerParams.queryType = 0;
__next='9b';
__exemode='continue';","9a","Query Notification recipientList","Query Notification recipientList",""<endrec>
"CUSTOMER","","23","12870","2512","Send Money via m-pesa With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.recipientList= __input.lastCommitResult.result;
    __next='9';
}else{
   __errormsg = 'Sorry,query recipientList failed.';
   __next = 'error';
}","9b","Get Notification recipientList","Get Notification recipientList",""<endrec>
"CUSTOMER","76","24","12871","2512","Send Money via m-pesa With Prevalidation V2.0","__next='9d';
__exemode='continue';","9c","Calculate PreValidation Fee","Calculate PreValidation Fee",""<endrec>
"CUSTOMER","","25","12872","2512","Send Money via m-pesa With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.budgetMap =__input.lastCommitResult.result;
   if(empty(__tempData.budgetMap)){
       __errormsg = 'budget map is empty.';
       __next = 'error';
   }else{   
       __next = '10a0';
       __exemode='continue';
   }
}else{
   __errormsg = 'Pre-Validation is failed,Please check notification.';
   __tempData.notificationParams.TransactionUMCPreValidationEvent='Failed';
   __tempData.notificationParams.TransactionUMCPreValidationError=__input.lastCommitResult.errorMessage;
   __tempData.notificationParams.put('Common.Result.ErrorCode','TS28009');
   __tempData.notificationParams.errDesc='Pre-Validation Failed.';
   if (empty(__tempData.recipientList)) {
     __errormsg = 'The recipient is null and send notification failed.';
     __next='error';
   } else {
      __next = '13a';
      __exemode='continue';
   }
}","9d","Get PreValidation Result","Get PreValidation Result",""<endrec>
"CUSTOMER","80","26","12873","2512","Send Money via m-pesa With Prevalidation V2.0","__committerParams.Category = 'PayBillPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.TaxMsgFormat = ':The amount of tax is: %s';
__committerParams.ItemSeperator = '<br>';
__committerParams.ShowPublicName = true;
__committerParams.FeeInfo = __tempData.budgetMap;
__next='10a1';
__exemode='continue';","10a0","Prepare Confirm Messsage","Prepare Confirm Messsage",""<endrec>
"CUSTOMER","","27","12874","2512","Send Money via m-pesa With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
      __tempData.promptMsg =  __input.lastCommitResult.result.FeeInfoMSG;

       var tips = 'You will send ' + Util.formatAmount(__params.Currency,__params.Amount) + ' to Customer ';
       __params.put('InitiatorCNSStatus',__tempData.cust.initiatorCNSStatus);
       __params.put('ReceiverCNSStatus',__tempData.cust.receiverCNSStatus);
       if(__tempData.cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' and __tempData.cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
      {
         if(__tempData.cust.subType  == '1000')
         {
	    tips = tips  + 'is unregistered.' + '<br>';
         } else if(!empty(__tempData.cust.receiverCNSStatus) and __tempData.cust.receiverCNSStatus.receiverFlag.fieldValue == '01' and __tempData.cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
        {	
           nameStr=Util.maskIdentityName(__tempData.cust.firstName,__tempData.cust.middleName,__tempData.cust.lastName);	
	   tips = tips + 'Organization name : ' + nameStr + '<br>';
           if(nameStr != ''){
             __params.IsCNSDataDisplayed = 'Yes';
           }
         }
       }
       tips = tips + ',Phone number ' +__tempData.cust.basicIdentifier+ '.';
       __tempData.tips=tips;
       __next='10';
}else{
   __next = 'error';
}","10a1","Check Confirm Messsage","Check Confirm Messsage",""<endrec>
"CUSTOMER","82","29","12875","2512","Send Money via m-pesa With Prevalidation V2.0","__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
   __committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
   __next='10b1';
   __exemode='continue';","10b0","CNS cancel process","CNS cancel process",""<endrec>
"CUSTOMER","","30","12876","2512","Send Money via m-pesa With Prevalidation V2.0","if (__input.lastCommitResult.isSucess)
{
  __params.EventType=""PRE_VALIDATION"";
  __params.errDesc='Pre-Validation Result is Rejected.';
  __params.Reason=""Rejected"";
  __errormsg = 'You have chosed to reject transation,Please check notification.';
  __next='12a1';
  __exemode='continue';
}else{
   __errormsg = 'Sorry,cns cancelation Process failed.';
   __next = 'error';
}","10b01","Check cns cancelation","Check cns cancelation",""<endrec>
"CUSTOMER","","1","12877","2513","Send Money via m-pesa V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","9","12878","2513","Send Money via m-pesa V2.0","var input = __input.response;
if (!empty(input)) {
     var tmp = Util.toInt(input) - 1;
     var isSuccess = __input.validateResult.isSucess;
     if(isSuccess) {
           type = __tempData.multiCurrencyCode.get(tmp);
             __params.Currency =  type;
            __next = '4a';
            __exemode = 'continue';
     }else {
            __next = '3';
     }
} else {
    __next = '3';
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
  $$var i = 1;
  $$for(type :  __tempData.multiCurrencyCode) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
Input * to return to the previous step.<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","13","12879","2513","Send Money via m-pesa V2.0","var input = __input.response;
if (!empty(input)) {
    var tmp = Util.toInt(input) - 1;
    var isSuccess = __input.validateResult.isSucess;
    if (isSuccess){
       type = __tempData.multiAccount.get(tmp);
         __params.InitiatorAccountNo= type.AccountNo;
         __next = '6';
    }else {
        __next = '5';
    }
}
else {
    __next = '5';
}","5","Choose Initiator AccountNo","<html>
<body>
Please select Initiator account :<br>
$$if (empty(__tempData.multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for( type: __tempData.multiAccount) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
Input * to return to the previous step.<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","2","12880","2513","Send Money via m-pesa V2.0","var input = __input.response;
if (input == '1') {
    __next = '2a';
}
else if (input == '2') {
   __next = '1a';
   __exemode = 'continue';
}
else
{
    __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12881","2513","Send Money via m-pesa V2.0","var input = __input.response;
   var input = __input.response;
   __params.ReceiverPartyIdentifier = input;
   __next = '3a';
   __exemode = 'continue';","2a","Input Phone Number","<html>
<body>
Input Phone Number:<br>
Input * to return to the previous step.<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12882","2513","Send Money via m-pesa V2.0","var input = __input.response;
var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
  var beneficiary = __tempData.beneficiaries.get(i);
  var beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3a';
  __exemode = 'continue';
}
else{
  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: __tempData.beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
Input * to return to the previous step.<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","12883","2513","Send Money via m-pesa V2.0","var input=__input.response;
var isSucess = __input.validateResult.isSucess;
 if (isSucess){
    __params.Amount = Util.replaceAll(input,',','.');
    __next = '5';
    if(1 == size(__tempData.multiAccount))
    {
        type = __tempData.multiAccount.get(0);
        if(empty(type.defaultFlag) ||  type.defaultFlag == 'true')
        {
              __next = '6';
        }
    }
}else
{
    __next = '4';
}","4","Input Amount","<html>
<body>
Input Amount:<br>
Input * to return to the previous step.<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","14","12884","2513","Send Money via m-pesa V2.0","if (__input.validateResult.isSucess)
{
    __params.PIN = __input.response;
    __next =  '7';
}
else
{
    __next = '6';
}","6","Input PIN","<html>
<body>
Input PIN:<br>
Input * to return to the previous step.<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","20","12885","2513","Send Money via m-pesa V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
}else {
  __next = '10a';
}","10a","Confirm with Charge","<html>
<body>
$$customerNameAndTypeMap=__tempData.customerNameAndTypeMap;
$$ if (!empty(customerNameAndTypeMap))
$$ {
$$      customerFirstName = customerNameAndTypeMap.get(""firstName"");
$$      customerMiddleName = customerNameAndTypeMap.get(""middleName"");
$$      customerLastName = customerNameAndTypeMap.get(""lastName"");
$$      customerType = customerNameAndTypeMap.get(""customerType"");
$$ }
$$chargeFee=__tempData.chargeFee;
$$formatAmount = Util.formatAmount(__params.Currency, __params.Amount);
$$if (empty(customerNameAndTypeMap)){
Customer ${__params.ReceiverPartyIdentifier} does not exist on the system or is not registered.<br>
To send ${formatAmount} to ${__params.ReceiverPartyIdentifier}, the charge is ${chargeFee}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
$$} else if (!empty(customerNameAndTypeMap)  and  customerType == ""1001""){
Customer ${__params.ReceiverPartyIdentifier} does not exist on the system or is not registered.<br>
To send ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${customerFirstName} ${customerMiddleName} ${customerLastName}, the charge is ${chargeFee}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
$$} else {
To send ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${customerFirstName} ${customerMiddleName} ${customerLastName}, the charge is ${chargeFee}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
$$}
Input * to return to the previous step.<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","12886","2513","Send Money via m-pesa V2.0","var input = __input.response;
var length = size(input);
if (length > 255)
{
    __next = '7';
}else {
    __referenceData.Comment2Customer = input;
    __next = '8a';
    __exemode = 'continue';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
Input * to return to the previous step.<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","21","12887","2513","Send Money via m-pesa V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
}else {
  __next = '10b';
}","10b","Confirm without Charge","<html>
<body>
$$customerNameAndTypeMap=__tempData.customerNameAndTypeMap;
$$ if (!empty(customerNameAndTypeMap))
$$ {
$$      customerFirstName = customerNameAndTypeMap.get(""firstName"");
$$      customerMiddleName = customerNameAndTypeMap.get(""middleName"");
$$      customerLastName = customerNameAndTypeMap.get(""lastName"");
$$      customerType = customerNameAndTypeMap.get(""customerType"");
$$ }
$$formatAmount = Util.formatAmount(__params.Currency, __params.Amount);
$$if (empty(customerNameAndTypeMap)){
Customer ${__params.ReceiverPartyIdentifier} does not exist on the system or is not registered.<br>
To send ${formatAmount} to ${__params.ReceiverPartyIdentifier}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
$$} else if (!empty(customerNameAndTypeMap)  and  customerType == ""1001""){
Customer ${__params.ReceiverPartyIdentifier} does not exist on the system or is not registered.<br>
To send ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${customerFirstName} ${customerMiddleName} ${customerLastName}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
$$} else {
To send ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${customerFirstName} ${customerMiddleName} ${customerLastName}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
$$}
Input * to return to the previous step.<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","23","3","12888","2513","Send Money via m-pesa V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__committerParams.IdentityType = __IdentityInfo.identityType;
__next  = '1b';

__exemode = 'continue';","1a","Query beneficiary","Query beneficiary",""<endrec>
"CUSTOMER","","4","12889","2513","Send Money via m-pesa V2.0","var input = __input.response;
  __tempData.beneficiaries = __input.lastCommitResult.result;
   if (empty(__tempData.beneficiaries) || size(__tempData.beneficiaries) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }","1b","Check selected beneficiary option","Check selected beneficiary option",""<endrec>
"CUSTOMER","24","7","12890","2513","Send Money via m-pesa V2.0","__next = '3b';
__exemode = 'continue';","3a","Query available currencode","Query available currencode",""<endrec>
"CUSTOMER","","8","12891","2513","Send Money via m-pesa V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currencyCode to query.';
       __next = 'error';
   }else {
      __next='3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying currencyCodes.';
   __next = 'error';
}","3b","Check Query available currencycode","Check Query available currencycode",""<endrec>
"CUSTOMER","29","10","12892","2513","Send Money via m-pesa V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;
__next = '4b';
__exemode = 'continue';","4a","Query Customer Account","Query Customer Account",""<endrec>
"CUSTOMER","","11","12893","2513","Send Money via m-pesa V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
      __next='4';
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","4b","Check Query Customer Account Result","Check Query Customer Account Result",""<endrec>
"CUSTOMER","26","16","12894","2513","Send Money via m-pesa V2.0","__committerParams.MSISDN = __params.ReceiverPartyIdentifier;
__next = '8b';
__exemode = 'continue';","8a","Query Receiver Name","Query Receiver Name",""<endrec>
"CUSTOMER","","17","12895","2513","Send Money via m-pesa V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
     __tempData.customerNameAndTypeMap= __input.lastCommitResult.result;
}
else
{
   __tempData.customerNameAndTypeMap = Util.createMap();
}
__next = '9a';
__exemode = 'continue';","8b","Check Query Receiver Name Result","Check Query Receiver Name Result",""<endrec>
"CUSTOMER","27","18","12896","2513","Send Money via m-pesa V2.0","__next = '9b';
__exemode = 'continue';","9a","Query Charge Information","Query Charge Information",""<endrec>
"CUSTOMER","","19","12897","2513","Send Money via m-pesa V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    __tempData.chargeFee = __input.lastCommitResult.result;
    __next = '10a';
}
else
{
    __next = '10b';
}","9b","Check Query Charge Info Result","Check Query Charge Info Result",""<endrec>
"CUSTOMER","","1","12898","2514","Send Money V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","9","12899","2514","Send Money V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
IC.cnsCancelationProcess(__params.InitiatorIdentifierType,__params.InitiatorIdentifier);
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>Send Money to ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12900","2514","Send Money V2.0","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","18"<endrec>
"CUSTOMER","","7","12901","2514","Send Money V2.0","var input=__input.response;
var isSucess = __input.validateResult.isSucess;
 if (isSucess){
    __params.Amount = Util.replaceAll(input,',','.');
    __next = '4';
}else
{
    __next = '3';
}","3","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","6","12902","2514","Send Money V2.0","var input = __input.response;
var i = Util.toInt(__input.response) - 1;
 if (i >= 0 and i < size(__tempData.beneficiaries)) {
  var beneficiary = __tempData.beneficiaries.get(i);
  var beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3';
}
else{
  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: __tempData.beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12903","2514","Send Money V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2a","Input Phone Number","<html>
<body>
Input Phone Number:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","12904","2514","Send Money V2.0","var input = __input.response;
if (input == '1') {
    __next = '2a';
}
else if (input == '2') {
   __next = '1a';
   __exemode = 'continue';
}
else
{
    __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","23","3","12905","2514","Send Money V2.0","__committerParams.MSISDN = __IdentityInfo.msisdn;
__committerParams.IdentityType = __IdentityInfo.identityType;
__next  = '1b';

__exemode = 'continue';","1a","Query beneficiary","Query beneficiary",""<endrec>
"CUSTOMER","","4","12906","2514","Send Money V2.0","var input = __input.response;
  __tempData.beneficiaries = __input.lastCommitResult.result;
   if (empty(__tempData.beneficiaries) || size(__tempData.beneficiaries) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }","1b","Check selected beneficiary option","Check selected beneficiary option",""<endrec>
"CUSTOMER","","1","12907","2515","Set Default Bank Account V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'SetIdentityBankAccount';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = __msisdn;
__exemode = 'continue';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","12908","2515","Set Default Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
	__tempData.bankAccount =__tempData.bankAccountList.get(i);
	__params.BankCardId =__tempData.bankAccount.bankCardId ;
	__next = '3';
} else {
	__next = '2';
}","2","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankAccount:__tempData.bankAccountList){
 ${index} ${bankAccount.accountName}/${bankAccount.accountNumber}(${bankAccount.Currency},${bankAccount.branchName})<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","12909","2515","Set Default Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = '4';
} else if(input == '0') {
  __next = '2';
} else {
  __next = '3';
}","3","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${__tempData.bankAccount.bankName}<br>
Branch:${__tempData.bankAccount.branchName}<br>
Account Name:${__tempData.bankAccount.accountName}<br>
Account Number:${__tempData.bankAccount.accountNumber}<br>
Currency:${__tempData.bankAccount.Currency}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12910","2515","Set Default Bank Account V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!isSuccess ||  empty(input ))
{
    __next = '4';
} else {
   __params.@HEAD@PIN = input ;
    __next = '5';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","12911","2515","Set Default Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","61","2","12912","2515","Set Default Bank Account V2.0","__next  = '1a';
__committerParams.IdentifierType='01';
__committerParams.IdentifierValue=__msisdn;
__committerParams.PartnerBank='';
__exemode = 'continue';","1","Query Bank Account List","Query Bank Account List",""<endrec>
"CUSTOMER","","3","12913","2515","Set Default Bank Account V2.0","__tempData.bankAccountList= __input.lastCommitResult.result;
   if (empty( __tempData.bankAccountList) || size(__tempData.bankAccountList) == 0)
   {
      __errormsg = 'Sorry, faild to get bankAccountList.';
      __next = 'error';
   } else
   {
       __next = '2';
   }","1a","check Bank Account List","check Bank Account List",""<endrec>
"CUSTOMER","","1","12914","2516","Set Default Group Bank Account V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'SetIdentityBankAccount';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__exemode = 'continue';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","12915","2516","Set Default Group Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = '3';
} else if (input == '2') {
  __next = '4'
} else {
  __next = '2';
}","2","select Group option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12916","2516","Set Default Group Bank Account V2.0","var input = __input.response;
var found = '0';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: __tempData.groups){
if(group.groupCode == input)
{
  found = '1';
}
}
if ( found == '0') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   __exemode = 'continue';
   __next = '5';
}
}
 else {
      __next = '3';
}","3","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12917","2516","Set Default Group Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess ){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __exemode = 'continue';
  __next = '5';
}
else{
  __next = '4';
}","4","Select From My Group","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","11","12918","2516","Set Default Group Bank Account V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
	__tempData.bankAccount=__tempData.bankAccountList.get(i);
	   __params.BankCardId =__tempData.bankAccount.bankCardId ;
	__next = '8';
} else {
	__next = '7';
}","7","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankAccount:__tempData.bankAccountList){
 ${index} ${bankAccount.accountName}/${bankAccount.accountNumber}(${bankAccount.Currency},${bankAccount.branchName})<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","12919","2516","Set Default Group Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = '9';
} else if(input == '0') {
  __next = '7';
} else {
  __next = '8';
}","8","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${__tempData.bankAccount.bankName}<br>
Branch:${__tempData.bankAccount.branchName}<br>
Account Name:${__tempData.bankAccount.accountName}<br>
Account Number:${__tempData.bankAccount.accountNumber}<br>
Currency:${__tempData.bankAccount.Currency}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","12920","2516","Set Default Group Bank Account V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!isSuccess ||  empty(input ))
{
    __next = '9';
} else {
   __params.@HEAD@PIN = input ;
    __next = '10';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","14","12921","2516","Set Default Group Bank Account V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","2","12931","2516","Set Default Group Bank Account V2.0","__next  = '1a';
__committerParams.MSISDN=__msisdn;
__exemode = 'continue';","1","query My Groups","query My Groups",""<endrec>
"CUSTOMER","","3","12932","2516","Set Default Group Bank Account V2.0","__tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups ) || size(__tempData.groups ) == 0)
   {
      __errormsg = 'Sorry, you have no groups .';
      __next = 'error';
   } else
   {
       __next = '2';
   }","1a","check My Group","check My Group",""<endrec>
"CUSTOMER","31","7","12933","2516","Set Default Group Bank Account V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__next = '5a';
__exemode = 'continue';","5","Query Group Member Roles","Query Group Member Roles",""<endrec>
"CUSTOMER","","8","12934","2516","Set Default Group Bank Account V2.0","__tempData.roleList = __input.lastCommitResult.result;

if (!empty(__tempData.roleList ) || size(__tempData.roleList )>0) {
  __next = '6';
__exemode = 'continue';
 } else {
   __errormsg = 'no current group member role.';
   __next = 'error';
 }","5a","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","61","9","12935","2516","Set Default Group Bank Account V2.0","__next  = '6a';
__committerParams.IdentifierType='15';
__committerParams.IdentifierValue=__params.ReceiverPartyIdentifier ;
__committerParams.PartnerBank='';
__exemode = 'continue';","6","query Bank Account","query Bank Account",""<endrec>
"CUSTOMER","","10","12936","2516","Set Default Group Bank Account V2.0","__tempData.bankAccountList= __input.lastCommitResult.result;
   if (empty( __tempData.bankAccountList) || size(__tempData.bankAccountList) == 0)
   {
      __errormsg = 'Sorry, you have no bankAccount.';
      __next = 'error';
   } else
   {
       __next = '7';
   }","6a","check Bank Account List","check Bank Account List",""<endrec>
"CUSTOMER","","1","12937","2518","Subscribe Saving Plan For Customer V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'SubscribeSavingPlanForCustomer';
__params.Channel =  __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.InitiatorIdentityType = __IdentityInfo.identityType;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */ 
__params.ReceiverPartyIdentifier = __msisdn;
__params.InitiatorIdentityType = __IdentityInfo.identityType;
__next = '1';
__exemode = 'continue';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","12938","2518","Subscribe Saving Plan For Customer V2.0","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '3';
} else {
    __next = '2';
}","2","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12939","2518","Subscribe Saving Plan For Customer V2.0","var input = __input.response;
__params.AccountTypeID = input;
__next = '4';","3","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12940","2518","Subscribe Saving Plan For Customer V2.0","var input = __input.response;
 __params.AccountNo = input;
__next = '5';","4","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","12941","2518","Subscribe Saving Plan For Customer V2.0","var input = __input.response;
var isDigit = __input.validateResult.isSucess;
if (!empty(input)  and  isDigit) {
    __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","18","12942","2518","Subscribe Saving Plan For Customer V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '12';
}","12","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12943","2518","Subscribe Saving Plan For Customer V2.0","var input = __input.response;
if(input == '1')
{
    __next = '7';
    __exemode = 'continue';
}
else  if(input == '2')
{
    __next = '12';
}
else
{
    __next = '6';
}","6","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","12944","2518","Subscribe Saving Plan For Customer V2.0","var input = __input.response;
if(input == '1')
{
    __next = '10a';
    __exemode = 'continue';
}
else  if(input == '2')
{
    __next = '10b';
    __exemode = 'continue';
}
else
{
    __next = '9';
}","9","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__tempData.promptMsg}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","77","2","12946","2518","Subscribe Saving Plan For Customer V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.Identifier = __msisdn;
__committerParams.IdentifierType = '01';
__committerParams.queryType = 0;

__next = '1a';
__exemode = 'continue';","1","Query Prevalidation Notification","Query Prevalidation Notification",""<endrec>
"CUSTOMER","","3","12947","2518","Subscribe Saving Plan For Customer V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.notificationList = __input.lastCommitResult.result;
    __next = '2';
}
else
{
    __next = 'error';
}","1a","Checker Prevalidation Notification","Checker Prevalidation Notification",""<endrec>
"CUSTOMER","76","9","12948","2518","Subscribe Saving Plan For Customer V2.0","__next = '7a';
__exemode = 'continue';","7","Calculate Prevalidation","Calculate Prevalidation",""<endrec>
"CUSTOMER","","10","12949","2518","Subscribe Saving Plan For Customer V2.0","var isSucess = __input.lastCommitResult.isSucess;

if (isSucess)
{
    __tempData.preValidationResult = __input.lastCommitResult.result;
    __next = '8';
    __exemode = 'continue';
}
else
{
    __errormsg = 'Pre-Validation is failed,Please check notification.';
    __tempData.errorMessage=__input.lastCommitResult.errorMessage;
    if (empty(__tempData.notificationList)) 
    {
        __errormsg = 'The recipient is null and send notification failed.';
        __next = 'error';
    } 
    else 
    {
        __next = '11a';
        __exemode = 'continue';
    }
}","7a","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"CUSTOMER","80","11","12950","2518","Subscribe Saving Plan For Customer V2.0","__committerParams.Category = 'SavingPlanPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.ItemSeperator = '<br>';
__committerParams.ShowPublicName = true;
__committerParams.FeeInfo = __tempData.preValidationResult;

__next = '8a';
__exemode = 'continue';","8","Prepare Confirm Messsage","Prepare Confirm Messsage",""<endrec>
"CUSTOMER","","12","12951","2518","Subscribe Saving Plan For Customer V2.0","var isSucess = __input.lastCommitResult.isSucess;
if(isSucess)
{
    __tempData.promptMsg =  __input.lastCommitResult.result.FeeInfoMSG;
    __next = '9';
}
else
{
    __next  = 'error';
}","8a","Check Confirm Messsage","Check Confirm Messsage",""<endrec>
"CUSTOMER","78","14","12952","2518","Subscribe Saving Plan For Customer V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '0';
__committerParams.ResultType='1';
__committerParams.Channel =  __params.Channel;
__committerParams.Reason = 'Continue Pre-Validation Transaction.  ChannelSessionID=' + __sessionID;

__next = '12';","10a","Save PreValidation EventLog for Confirm","Save PreValidation EventLog for Confirm",""<endrec>
"CUSTOMER","78","15","12953","2518","Subscribe Saving Plan For Customer V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __params.Channel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __sessionID;

__next = '11b';
__exemode = 'continue';","10b","Save PreValidation EventLog for Reject","Save PreValidation EventLog for Reject",""<endrec>
"CUSTOMER","79","16","12954","2518","Subscribe Saving Plan For Customer V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Failed';
notificationParams .TransactionUMCPreValidationError=__tempData.errorMessage;
notificationParams .errDesc='Pre-Validation Failed.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;
__errormsg = 'Pre-Validation is failed,Please check notification.';
__next = 'error';","11a","Send PreValidation Notification for CalFee Failed","Send PreValidation Notification for CalFee Failed",""<endrec>
"CUSTOMER","79","17","12955","2518","Subscribe Saving Plan For Customer V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Rejected';
notificationParams .TransactionUMCPreValidationError='Choosing Reject';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__errormsg = 'You have chosed to reject transation,Please check notification.';
__next = 'cancel';","11b","Send PreValidation Notification for Reject","Send PreValidation Notification for Reject",""<endrec>
"CUSTOMER","","1","12956","2519","Withdraw money V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","12957","2519","Withdraw money V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';","1","Enter till no","<html>
<body>
Enter till no<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","12958","2519","Withdraw money V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
    __params.Amount = Util.replaceAll(input,',','.');
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","4","12959","2519","Withdraw money V2.0","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter pin","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","12960","2519","Withdraw money V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Withdraw cash from ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","12961","2519","Withdraw money V2.0","var input = __input.response;
if (!empty(input) and size(input)> 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","12974","2521","Subscribe Saving Plan For Group V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'SubscribeSavingPlanForGroup';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.InitiatorIdentityType = __IdentityInfo.identityType;
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
__next = '1';
__exemode = 'continue';","begin","set parammeters","",""<endrec>
"CUSTOMER","","6","12975","2521","Subscribe Saving Plan For Group V2.0","var input = __input.response;
if (input == '1') {
  __next = '4a';
} 
else if (input == '2') 
{
    if (empty(__tempData.groups) || size(__tempData.groups) == 0) 
    {
        __errormsg = 'Sorry, there is no groups.';
        __next = 'error';
    } 
    else 
    {
       __next = '4b';
    }
}
else 
{
   __next = '3';
}","3","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","12976","2521","Subscribe Saving Plan For Group V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;

if (!empty(input)) 
{
    __next = '5';
    __exemode = 'continue';
}
else 
{
    __next = '4a';
}","4a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","12977","2521","Subscribe Saving Plan For Group V2.0","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '7';
} else {
    __next = '6';
}","6","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","25","12978","2521","Subscribe Saving Plan For Group V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '16';
}","16","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","12979","2521","Subscribe Saving Plan For Group V2.0","var input = __input.response;
__params.AccountTypeID = input;
__next = '8';","7","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","12980","2521","Subscribe Saving Plan For Group V2.0","var input = __input.response;
 __params.AccountNo = input;
__next = '9';","8","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","12981","2521","Subscribe Saving Plan For Group V2.0","if (__input.validateResult.isSucess)
{
    var i = Util.toInt(__input.response) - 1;
    var group= __tempData.groups.get(i);
    var groupCode= group.groupCode;
    __params.ReceiverPartyIdentifier = groupCode;
    __next = '5';
    __exemode = 'continue';
} 
else
{
    __next = '4b';
}","4b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","14","12982","2521","Subscribe Saving Plan For Group V2.0","var input = __input.response;
var isDigit = __input.validateResult.isSucess;
if (!empty(input)  and  isDigit) {
    __params.@HEAD@PIN = input;
    __next = '10';
} else {
    __secure = true;
    __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","15","12983","2521","Subscribe Saving Plan For Group V2.0","var input = __input.response;
if(input == '1')
{
    __next = '11';
    __exemode = 'continue';
}
else  if(input == '2')
{
    __next = '16';
}
else
{
    __next = '10';
}","10","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","20","12984","2521","Subscribe Saving Plan For Group V2.0","var input = __input.response;
if(input == '1')
{
    __next = '14a';
    __exemode = 'continue';
}
else  if(input == '2')
{
    __next = '14b';
    __exemode = 'continue';
}
else
{
    __next = '13';
}","13","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__tempData.promptMsg}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","2","12996","2521","Subscribe Saving Plan For Group V2.0","__committerParams.MSISDN = __msisdn;
__next = '1a';
__exemode = 'continue';","1","Query My Group","Query My Group",""<endrec>
"CUSTOMER","","3","12997","2521","Subscribe Saving Plan For Group V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.groups = __input.lastCommitResult.result;
    __next = '2';
    __exemode = 'continue';
}
else
{
    __next = 'error';
}","1a","Check My Group","Check My Group",""<endrec>
"CUSTOMER","77","4","12998","2521","Subscribe Saving Plan For Group V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.Identifier = __msisdn;
__committerParams.IdentifierType = '01';
__committerParams.queryType = 0;

__next = '2a';
__exemode = 'continue';","2","Query Prevalidation Notification","Query Prevalidation Notification",""<endrec>
"CUSTOMER","","5","12999","2521","Subscribe Saving Plan For Group V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.notificationList = __input.lastCommitResult.result;
    __next = '3';
}
else
{
    __next = 'error';
}","2a","Checker Prevalidation Notification","Checker Prevalidation Notification",""<endrec>
"CUSTOMER","31","9","13000","2521","Subscribe Saving Plan For Group V2.0","__next = '5a';
__exemode = 'continue';","5","Query Group Role List","Query Group Role List",""<endrec>
"CUSTOMER","","10","13001","2521","Subscribe Saving Plan For Group V2.0","var isSucess = __input.lastCommitResult.isSucess
if(isSucess)
{
   var groupRoleList = __input.lastCommitResult.result;
    if(empty(groupRoleList) || size(groupRoleList) == 0)
    {
        __errormsg = 'no current group member role.';
        __next = 'error';
    }
    else
    {
    __next = '6';
    }
}
else
{
    __errormsg = 'no current group member role.';
    __next = 'error';
}","5a","Check Group Role List","Check Group Role List",""<endrec>
"CUSTOMER","76","16","13002","2521","Subscribe Saving Plan For Group V2.0","__next = '11a';
__exemode = 'continue';","11","Calculate Prevalidation","Calculate Prevalidation",""<endrec>
"CUSTOMER","","17","13003","2521","Subscribe Saving Plan For Group V2.0","var isSucess = __input.lastCommitResult.isSucess;

if (isSucess)
{
    __tempData.preValidationResult = __input.lastCommitResult.result;
    __next = '12';
    __exemode = 'continue';
}
else
{
    __errormsg = 'Pre-Validation is failed,Please check notification.';
    __tempData.errorMessage=__input.lastCommitResult.errorMessage;
    if (empty(__tempData.notificationList)) 
    {
        __errormsg = 'The recipient is null and send notification failed.';
    } 
    else 
    {
        __next = '15a';
        __exemode = 'continue';
    }
}","11a","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"CUSTOMER","80","18","13004","2521","Subscribe Saving Plan For Group V2.0","__committerParams.Category = 'SavingPlanPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.ItemSeperator = '<br>';
__committerParams.ShowPublicName = true;
__committerParams.FeeInfo = __tempData.preValidationResult;

__next = '12a';
__exemode = 'continue';","12","Prepare Confirm Messsage","Prepare Confirm Messsage",""<endrec>
"CUSTOMER","","19","13005","2521","Subscribe Saving Plan For Group V2.0","var isSucess = __input.lastCommitResult.isSucess;

if(isSucess)
{
    __tempData.promptMsg =  __input.lastCommitResult.result.FeeInfoMSG;
    __next = '13';
}
else
{
    __next  = 'error';
}","12a","Check Confirm Messsage","Check Confirm Messsage",""<endrec>
"CUSTOMER","78","21","13006","2521","Subscribe Saving Plan For Group V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '0';
__committerParams.ResultType='1';
__committerParams.Channel =  __params.Channel;
__committerParams.Reason = 'Continue Pre-Validation Transaction.  ChannelSessionID=' + __sessionID;

__next = '16';","14a","Save PreValidation EventLog for Confirm","Save PreValidation EventLog for Confirm",""<endrec>
"CUSTOMER","78","22","13007","2521","Subscribe Saving Plan For Group V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __params.Channel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __sessionID;

__next = '15b';
__exemode = 'continue'","14b","Save PreValidation EventLog for Reject","Save PreValidation EventLog for Reject",""<endrec>
"CUSTOMER","79","23","13008","2521","Subscribe Saving Plan For Group V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Failed';
notificationParams .TransactionUMCPreValidationError=__tempData.errorMessage;
notificationParams .errDesc='Pre-Validation Failed.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__errormsg = 'Pre-Validation is failed,Please check notification.';

__next = 'error';","15a","Send PreValidation Notification for CalFee Failed","Send PreValidation Notification for CalFee Failed",""<endrec>
"CUSTOMER","79","24","13009","2521","Subscribe Saving Plan For Group V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Rejected';
notificationParams .TransactionUMCPreValidationError='Choosing Reject';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;
__errormsg = 'You have chosed to reject transation,Please check notification.';
__next = 'cancel';","15b","Send PreValidation Notification for Reject","Send PreValidation Notification for Reject",""<endrec>
"CUSTOMER","","1","1301","1013","Customer Change Language","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ChangeLanguage';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */ 
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","1","13010","2523","Two Part Buy Goods V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.OtherTwoPartyVoucherReceiver='86812530002';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13011","2523","Two Part Buy Goods V2.0","var input = __input.response;
    if (empty(input)) {
     __next = '1';
    } else if (input == '1') {
        __params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
        __tips = 'Till no';
        __next = '2';
    } else if (input == '2') {
        __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
        __tips = 'Short code';
        __next = '2';
    } else {
     __next = '1';
    }","1","Select Till no or Short code","<html>
<body>
Select Till no or Short code<br>
1 Till no<br>
2 Short code<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13012","2523","Two Part Buy Goods V2.0","var input = __input.response;
if (empty(input)) {
__next = '2';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '3a';
__exemode='continue';
}","2","Enter Till no or Short code","<html>
<body>
Enter ${__tips}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","13013","2523","Two Part Buy Goods V2.0","var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         var isSuccess = __input.validateResult.isSucess;
         if(isSuccess) {
               type = __tempData.multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
  $$var i = 1;
  $$for(type: __tempData.multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","7","13014","2523","Two Part Buy Goods V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess){
   __params.Amount = Util.replaceAll(input,',','.');
   __next = '4a';
   __exemode='continue';
} else {
    __next = '4';
}","4","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","10","13015","2523","Two Part Buy Goods V2.0","var input = __input.response;
  if (!empty(input)) {
    var tmp = Util.toInt(input) - 1;
    var isSuccess = __input.validateResult.isSucess;
    if(isSuccess) {
       type = __tempData.multiAccount.get(tmp);
     __params.InitiatorAccountNo= type.AccountNo;
     __next = '6';
    } else {
     __next = '5';
    }
  } else {
   __next = '5';
  }","5","Choose Initiator AccountNo","<html>
<body>
Please select Initiator account :<br>
  $$var i = 1;
  $$for(type: __tempData.multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","12","13016","2523","Two Part Buy Goods V2.0","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","13017","2523","Two Part Buy Goods V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Buy Goods - ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","13018","2523","Two Part Buy Goods V2.0","var input = __input.response;
if (!empty(input) and size(input) > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","13019","2523","Two Part Buy Goods V2.0","var input = __input.response;
__params.OtherTwoPartyVoucherReceiver = input;
__next = '7';","6","Enter OtherTwoPartyVoucherReceiver","<html>
<body>
Enter OtherTwoPartyVoucherReceiver<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","1302","1013","Customer Change Language","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(languages)) {
  __params.@BODY@LanguageCode = languages.get(i).toString();
  __secure = true;
  __next = '2';
} else {
  __next = '1';
}
","1","Select Language","<html>
<body>
Language<br>
$$languages = IC.queryAllLanguages();
$$var i = 1;
$$for (lang: languages) {
  ${i} ${lang.getDisplayName(identity.locale)}<br>
  $$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","24","4","13026","2523","Two Part Buy Goods V2.0","__exemode='continue';
__next='3b';","3a","Query All Currency","Query All Currency",""<endrec>
"CUSTOMER","","5","13027","2523","Two Part Buy Goods V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiCurrencyCode =__input.lastCommitResult.result;
   if(empty(__tempData.multiCurrencyCode)|| size(__tempData.multiCurrencyCode)==0){
       __errormsg = 'You have no currency to query.';
       __next = 'error';
   }else {
      __next='3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying currency.';
   __next = 'error';
}","3b","Check All Currency","Check All Currency",""<endrec>
"CUSTOMER","29","8","13028","2523","Two Part Buy Goods V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.IdentityId = __IdentityInfo.identityId;
__committerParams.AccountTypeAlias = 'm-pesa';
__committerParams.Currency = __params.Currency;
__next='4b';
__exemode='continue';","4a","Query Multi Account","Query Multi Account",""<endrec>
"CUSTOMER","","9","13029","2523","Two Part Buy Goods V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.multiAccount = __input.lastCommitResult.result;
   if(empty(__tempData.multiAccount)|| size(__tempData.multiAccount)==0){
       __errormsg = 'You have no account to query.';
       __next = 'error';
   }else {
       __next='5';
       type=__tempData.multiAccount.get(0);
       if(1 == size( __tempData.multiAccount) and type.defaultFlag == 'true')
      {
          __params.InitiatorAccountNo=type.AccountNo;
          __next = '6';
       }  
   }
}else{
   __errormsg = 'Sorry,error occured when querying accounts.';
   __next = 'error';
}","4b","Check Accounts","Check Accounts",""<endrec>
"CUSTOMER","","3","1303","1013","Customer Change Language","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '3';
","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","13030","2525","Two Part Payment Confirm V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13031","2525","Two Part Payment Confirm V2.0","var input = __input.response;
if (!empty(input)) {
  __params.TransactionId= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Transaction ID","<html>
<body>
Enter Transaction ID<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13032","2525","Two Part Payment Confirm V2.0","var input = __input.response;
if (!empty(input)) {
  __params.TwoPartPaymentVoucher= input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Two Part Payment Voucher","<html>
<body>
Enter Two Part Payment Voucher:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","13033","2525","Two Part Payment Confirm V2.0","var input = __input.response;
if (!empty(input)) {
  __params.PIN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter PIN","<html>
<body>
Enter Pin <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","13034","2525","Two Part Payment Confirm V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else{
  __next = 'cancel';
}","5","Confirm","<html><body>You are going to initiate two part payment confirm. Press 1 to continue and other numbers to cancel.<br>
1 OK <br>
 Cancel <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","13035","2525","Two Part Payment Confirm V2.0","var input = __input.response;
if (!empty(input) and size(input) > 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","1304","1013","Customer Change Language","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to Change Language?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","13046","2527","UnSubscribe Saving Plan For Customer V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'UnSubscribeSavingPlanForCustomer';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.InitiatorIdentityType = __IdentityInfo.identityType;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */ 
__params.ReceiverPartyIdentifier = __msisdn;
__params.ReceiverPartyIdentityType = __IdentityInfo.identityType;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","13047","2527","UnSubscribe Saving Plan For Customer V2.0","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '2';
} else {
    __next = '1';
}","1","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13048","2527","UnSubscribe Saving Plan For Customer V2.0","var input = __input.response;
__params.AccountTypeID = input;
__next = '3';","2","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","13049","2527","UnSubscribe Saving Plan For Customer V2.0","var input = __input.response;
 __params.AccountNo = input;
__next = '4';","3","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","13050","2527","UnSubscribe Saving Plan For Customer V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (!empty(input) and isSuccess) {
    __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","13051","2527","UnSubscribe Saving Plan For Customer V2.0","var input = __input.response;

if(input == '1')
{
   __next='6';
   __exemode='continue';
}
else if(input == '2')
{
   __next='12';
}
else
{
  __next='5';
}","5","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","13052","2527","UnSubscribe Saving Plan For Customer V2.0","var input = __input.response;
if(input == '1')
{
    __next = '10a';
    __exemode = 'continue';
}
else  if(input == '2')
{
    __next = '10b';
    __exemode = 'continue';
}
else
{
    __next = '9';
}","9","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__tempData.promptMsg}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","18","13053","2527","UnSubscribe Saving Plan For Customer V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '12';
}","12","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","77","7","13055","2527","UnSubscribe Saving Plan For Customer V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.Identifier = __msisdn;
__committerParams.IdentifierType = '01';
__committerParams.queryType = 0;
__next='6a';
__exemode='continue';","6","Query Prevalidation Notification","Query Prevalidation Notification",""<endrec>
"CUSTOMER","","8","13068","2527","UnSubscribe Saving Plan For Customer V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.notificationList = __input.lastCommitResult.result;
    __next = '7';
    __exemode = 'continue';
}
else
{
    __next = 'error';
}","6a","Checker Prevalidation Notification","Checker Prevalidation Notification",""<endrec>
"CUSTOMER","76","9","13069","2527","UnSubscribe Saving Plan For Customer V2.0","__next='7a';
__exemode='continue';","7","Calculate PreValidation Fee","Calculate PreValidation Fee",""<endrec>
"CUSTOMER","","10","13070","2527","UnSubscribe Saving Plan For Customer V2.0","var isSucess = __input.lastCommitResult.isSucess;

if (isSucess)
{
    __tempData.preValidationResult = __input.lastCommitResult.result;
    __next = '8';
    __exemode = 'continue';
}
else
{
    __errormsg = 'Pre-Validation is failed,Please check notification.';
    __tempData.errorMessage=__input.lastCommitResult.errorMessage;
    if (empty(__tempData.notificationList)) 
    {
        __errormsg = 'The recipient is null and send notification failed.';
    } 
    else 
    {
        __next = '11a';
        __exemode = 'continue';
    }
}","7a","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"CUSTOMER","80","11","13071","2527","UnSubscribe Saving Plan For Customer V2.0","__committerParams.Category = 'SavingPlanPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.ItemSeperator = '<br>';
__committerParams.ShowPublicName = true;
__committerParams.FeeInfo = __tempData.preValidationResult;

__next = '8a';
__exemode = 'continue';","8","Prepare Confirm Messsage","Prepare Confirm Messsage",""<endrec>
"CUSTOMER","","12","13072","2527","UnSubscribe Saving Plan For Customer V2.0","var isSucess = __input.lastCommitResult.isSucess;

if(isSucess)
{
    __tempData.promptMsg =  __input.lastCommitResult.result.FeeInfoMSG;
    __next = '9';
}
else
{
    __next  = 'error';
}","8a","Check Confirm Messsage","Check Confirm Messsage",""<endrec>
"CUSTOMER","78","14","13073","2527","UnSubscribe Saving Plan For Customer V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '0';
__committerParams.ResultType='1';
__committerParams.Channel =  __params.Channel;
__committerParams.Reason = 'Continue Pre-Validation Transaction.  ChannelSessionID=' + __sessionID;

__next = '12';","10a","Save PreValidation EventLog for Confirm","Save PreValidation EventLog for Confirm",""<endrec>
"CUSTOMER","78","15","13074","2527","UnSubscribe Saving Plan For Customer V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __params.Channel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __sessionID;

__next = '11b';
__exemode = 'continue';","10b","Save PreValidation EventLog for Reject","Save PreValidation EventLog for Reject",""<endrec>
"CUSTOMER","79","16","13075","2527","UnSubscribe Saving Plan For Customer V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Failed';
notificationParams .TransactionUMCPreValidationError=__tempData.errorMessage;
notificationParams .errDesc='Pre-Validation Failed.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__errormsg = 'Pre-Validation is failed,Please check notification.';

__next = 'error';","11a","Send PreValidation Notification for CalFee Failed","Send PreValidation Notification for CalFee Failed",""<endrec>
"CUSTOMER","79","17","13076","2527","UnSubscribe Saving Plan For Customer V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Rejected';
notificationParams .TransactionUMCPreValidationError='Choosing Reject';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;
__errormsg = 'You have chosed to reject transation,Please check notification.';
__next = 'cancel';","11b","Send PreValidation Notification for Reject","Send PreValidation Notification for Reject",""<endrec>
"CUSTOMER","","1","13077","2529","UnSubscribe Saving Plan For Group V2.0","__params.ServiceCode = __serviceCode;
__params.ActionType = 'SubscribeSavingPlanForGroup';
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.InitiatorIdentityType = __IdentityInfo.identityType;
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
__next = '1';
__exemode = 'continue';","begin","set parammeters","",""<endrec>
"CUSTOMER","","6","13078","2529","UnSubscribe Saving Plan For Group V2.0","var input = __input.response;
if (input == '1') {
  __next = '4a';
} 
else if (input == '2') 
{
    if (empty(__tempData.groups) || size(__tempData.groups) == 0) 
    {
        __errormsg = 'Sorry, there is no groups.';
        __next = 'error';
    } 
    else 
    {
       __next = '4b';
    }
}
else 
{
   __next = '3';
}","3","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","13079","2529","UnSubscribe Saving Plan For Group V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;

if (!empty(input)) 
{
    __next = '5';
    __exemode = 'continue';
}
else 
{
    __next = '4a';
}","4a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","13080","2529","UnSubscribe Saving Plan For Group V2.0","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '7';
} else {
    __next = '6';
}","6","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","13081","2529","UnSubscribe Saving Plan For Group V2.0","var input = __input.response;
__params.AccountTypeID = input;
__next = '8';","7","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","13082","2529","UnSubscribe Saving Plan For Group V2.0","var input = __input.response;
 __params.AccountNo = input;
__next = '9';","8","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","13083","2529","UnSubscribe Saving Plan For Group V2.0","if (__input.validateResult.isSucess)
{
    var i = Util.toInt(__input.response) - 1;
    var group= __tempData.groups.get(i);
    var groupCode= group.groupCode;
    __params.ReceiverPartyIdentifier = groupCode;
    __next = '5';
    __exemode = 'continue';
} 
else
{
    __next = '4b';
}","4b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","14","13084","2529","UnSubscribe Saving Plan For Group V2.0","var input = __input.response;
var isDigit = __input.validateResult.isSucess;
if (!empty(input)  and  isDigit) {
    __params.@HEAD@PIN = input;
    __next = '10';
} else {
    __secure = true;
    __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","15","13085","2529","UnSubscribe Saving Plan For Group V2.0","var input = __input.response;
if(input == '1')
{
    __next = '11';
    __exemode = 'continue';
}
else  if(input == '2')
{
    __next = '16';
}
else
{
    __next = '10';
}","10","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","20","13086","2529","UnSubscribe Saving Plan For Group V2.0","var input = __input.response;
if(input == '1')
{
    __next = '14a';
    __exemode = 'continue';
}
else  if(input == '2')
{
    __next = '14b';
    __exemode = 'continue';
}
else
{
    __next = '13';
}","13","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__tempData.promptMsg}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","25","13087","2529","UnSubscribe Saving Plan For Group V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '16';
}","16","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","78","21","13088","2529","UnSubscribe Saving Plan For Group V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '0';
__committerParams.ResultType='1';
__committerParams.Channel =  __params.Channel;
__committerParams.Reason = 'Continue Pre-Validation Transaction.  ChannelSessionID=' + __sessionID;

__next = '16';","14a","Save PreValidation EventLog for Confirm","Save PreValidation EventLog for Confirm",""<endrec>
"CUSTOMER","30","2","13094","2529","UnSubscribe Saving Plan For Group V2.0","__committerParams.MSISDN = __msisdn;
__next = '1a';
__exemode = 'continue';","1","Query My Group","Query My Group",""<endrec>
"CUSTOMER","","3","13095","2529","UnSubscribe Saving Plan For Group V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.groups = __input.lastCommitResult.result;
    __next = '2';
    __exemode = 'continue';
}
else
{
    __next = 'error';
}","1a","Check My Group","Check My Group",""<endrec>
"CUSTOMER","77","4","13096","2529","UnSubscribe Saving Plan For Group V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.Identifier = __msisdn;
__committerParams.IdentifierType = '01';
__committerParams.queryType = 0;

__next = '2a';
__exemode = 'continue';","2","Query Prevalidation Notification","Query Prevalidation Notification",""<endrec>
"CUSTOMER","","5","13097","2529","UnSubscribe Saving Plan For Group V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.notificationList = __input.lastCommitResult.result;
    __next = '3';
}
else
{
    __next = 'error';
}","2a","Checker Prevalidation Notification","Checker Prevalidation Notification",""<endrec>
"CUSTOMER","31","9","13098","2529","UnSubscribe Saving Plan For Group V2.0","__next = '5a';
__exemode = 'continue';","5","Query Group Role List","Query Group Role List",""<endrec>
"CUSTOMER","","10","13099","2529","UnSubscribe Saving Plan For Group V2.0","var isSucess = __input.lastCommitResult.isSucess
if(isSucess)
{
   var groupRoleList = __input.lastCommitResult.result;
    if(empty(groupRoleList) || size(groupRoleList) == 0)
    {
        __errormsg = 'no current group member role.';
        __next = 'error';
    }
    else
    {
    __next = '6';
    }
}
else
{
    __errormsg = 'no current group member role.';
    __next = 'error';
}","5a","Check Group Role List","Check Group Role List",""<endrec>
"CUSTOMER","76","16","13100","2529","UnSubscribe Saving Plan For Group V2.0","__next = '11a';
__exemode = 'continue';","11","Calculate Prevalidation","Calculate Prevalidation",""<endrec>
"CUSTOMER","","17","13101","2529","UnSubscribe Saving Plan For Group V2.0","var isSucess = __input.lastCommitResult.isSucess;

if (isSucess)
{
    __tempData.preValidationResult = __input.lastCommitResult.result;
    __next = '12';
    __exemode = 'continue';
}
else
{
    __errormsg = 'Pre-Validation is failed,Please check notification.';
    __tempData.errorMessage=__input.lastCommitResult.errorMessage;
    if (empty(__tempData.notificationList)) 
    {
        __errormsg = 'The recipient is null and send notification failed.';
    } 
    else 
    {
        __next = '15a';
        __exemode = 'continue';
    }
}","11a","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"CUSTOMER","80","18","13102","2529","UnSubscribe Saving Plan For Group V2.0","__committerParams.Category = 'SavingPlanPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.ItemSeperator = '<br>';
__committerParams.ShowPublicName = true;
__committerParams.FeeInfo = __tempData.preValidationResult;

__next = '12a';
__exemode = 'continue';","12","Prepare Confirm Messsage","Prepare Confirm Messsage",""<endrec>
"CUSTOMER","","19","13103","2529","UnSubscribe Saving Plan For Group V2.0","var isSucess = __input.lastCommitResult.isSucess;

if(isSucess)
{
    __tempData.promptMsg =  __input.lastCommitResult.result.FeeInfoMSG;
    __next = '13';
}
else
{
    __next  = 'error';
}","12a","Check Confirm Messsage","Check Confirm Messsage",""<endrec>
"CUSTOMER","78","22","13104","2529","UnSubscribe Saving Plan For Group V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __params.Channel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __sessionID;

__next = '15b';
__exemode = 'continue'","14b","Save PreValidation EventLog for Reject","Save PreValidation EventLog for Reject",""<endrec>
"CUSTOMER","79","23","13105","2529","UnSubscribe Saving Plan For Group V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Failed';
notificationParams .TransactionUMCPreValidationError=__tempData.errorMessage;
notificationParams .errDesc='Pre-Validation Failed.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__errormsg = 'Pre-Validation is failed,Please check notification.';

__next = 'error';","15a","Send PreValidation Notification for CalFee Failed","Send PreValidation Notification for CalFee Failed",""<endrec>
"CUSTOMER","79","24","13109","2529","UnSubscribe Saving Plan For Group V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Rejected';
notificationParams .TransactionUMCPreValidationError='Choosing Reject';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;
__errormsg = 'You have chosed to reject transation,Please check notification.';
__next = 'cancel';","15b","Send PreValidation Notification for Reject","Send PreValidation Notification for Reject",""<endrec>
"CUSTOMER","","1","13113","2534","View Customer Bundles V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'QueryCustomerBundleDetails';
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = __msisdn;
__params.InitiatorIdentifierType= '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* SP_ID */
__params.ReceiverPartyIdentifier= __msisdn;
__params.PrimaryIdentifierType= '04'; /* SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","13114","2534","View Customer Bundles V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess)
{
__params.BundleType= input ;
 __next = '2a';
__exemode = 'continue';
}
else {
 __next = '1';
}","1","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","5","13115","2534","View Customer Bundles V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
   type = __tempData.BundleList.get(i);
 __params.BundleId = type.bundleId ;
       __next = '4';
    } else {
        __next = '3';
    }","3","Select Destination Bundle","<html>
<body>
Please select Destination bundle:<br>
  $$var i = 1;
  $$for(bundle: __tempData.BundleList ) {
  ${i} ${bundle['bundleName']} : ${bundle['internalPrice']} ${bundle['Currency']} ${bundle['durationTimes']} ${bundle['durationUnit']}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","6","13116","2534","View Customer Bundles V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess  and !empty(input) ) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","7","13117","2534","View Customer Bundles V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","41","3","13123","2534","View Customer Bundles V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__committerParams.AccessDeviceIdentifierType = __params.InitiatingDeviceType;
__committerParams.AccessDeviceIdentifier = __params.InitiatingDeviceValue;
__committerParams.BundleType = __params.BundleType;
__next  = '2b';
__exemode = 'continue';","2a","query Bundle","query Bundle",""<endrec>
"CUSTOMER","","4","13124","2534","View Customer Bundles V2.0","__tempData.BundleList = __input.lastCommitResult.result;
   if (empty(__tempData.BundleList) || size(__tempData.BundleList) == 0) {
      __errormsg = 'Sorry, there is no Bundle.';
      __next = 'error';
    } else {
       __next = '3';
    }","2b","check Bundle","check Bundle",""<endrec>
"CUSTOMER","","1","13125","2536","View Direct Debit Mandate V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = __msisdn;
__params.ActionType= 'ViewDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;
__params.MandateStatus = '03';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","13126","2536","View Direct Debit Mandate V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
__params.MandateID =  __tempData.mandateList.get(i).mandateId;
__params.PayeeName =  __tempData.mandateList.get(i).payeeName;
__next = '2';
} else {
__next = '1';
}","1","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: __tempData.mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","13127","2536","View Direct Debit Mandate V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '2';
} else {
    __params.@HEAD@PIN = input;
    __next = '3';
}","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","13128","2536","View Direct Debit Mandate V2.0","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '3';
}","3","Comfirm","<html>
<body>
 Direct Debit Mandate  - ${__params.PayeeName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","13143","2541","View Direct Debit Mandate By Group V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ActionType = 'ViewDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.MandateStatus = '03';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","13144","2541","View Direct Debit Mandate By Group V2.0","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
var found = '1';
if(!empty(input)){
       for (group: __tempData.groups) {
    if (group.groupCode == input) {
      found = '0';
    }
  }
        if (found == '1') {
    __errormsg = 'no current group or not belong to the group.';
    __next = 'error';
  } else {
    __params.ReceiverPartyIdentifier= input;
    __next='2a';
    __exemode='continue';
  }
}else {
       __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","13145","2541","View Direct Debit Mandate By Group V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
__params.MandateID =  __tempData.mandateList.get(i).mandateId;
__params.PayeeName =  __tempData.mandateList.get(i).payeeName;
__next = '3';
} else {
__next = '2';
}","2","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: __tempData.mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","13146","2541","View Direct Debit Mandate By Group V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (empty(input) || !isSuccess) {
    __next = '3';
} else {
    __params.@HEAD@PIN = input;
    __next = '4';
}","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","9","13147","2541","View Direct Debit Mandate By Group V2.0","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '4';
}","4","Comfirm","<html>
<body>
 Direct Debit Mandate  - ${__params.PayeeName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","54","2","13156","2536","View Direct Debit Mandate V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.MandateStatus=__params.MandateStatus;
__next='1b';
__exemode='continue';","1a","Query Direct Debit Mandates","Query Direct Debit Mandates",""<endrec>
"CUSTOMER","","3","13157","2536","View Direct Debit Mandate V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.mandateList =__input.lastCommitResult.result;
   if(empty(__tempData.mandateList )||size(__tempData.mandateList )==0){
       __errormsg = 'No Available Mandates.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying direct debit mandates.';
   __next = 'error';
}","1b","Check Direct Debit Mandates","Check Direct Debit Mandates",""<endrec>
"CUSTOMER","30","2","13158","2541","View Direct Debit Mandate By Group V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='1b';
__exemode='continue';","1a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","3","13159","2541","View Direct Debit Mandate By Group V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups .';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","1b","Check Groups","Check Groups",""<endrec>
"CUSTOMER","54","5","13160","2541","View Direct Debit Mandate By Group V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.MandateStatus=__params.MandateStatus;
__next='2b';
__exemode='continue';","2a","Query Direct Debit Mandate by Payer","Query Direct Debit Mandate by Payer",""<endrec>
"CUSTOMER","","6","13161","2541","View Direct Debit Mandate By Group V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.mandateList =__input.lastCommitResult.result;
   if(empty(__tempData.mandateList )||size(__tempData.mandateList )==0){
       __errormsg = 'No Available Mandates.';
       __next = 'error';
   }else {
       __next = '2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying direct debit mandates.';
   __next = 'error';
}","2b","Check Direct Debit Mandates","Check Direct Debit Mandates",""<endrec>
"CUSTOMER","","1","13162","2543","View Group Bundles V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.ActionType = 'QueryGroupBundleDetails';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.RequesterIdentifierType = ""01"";
__params.RequesterIdentifier = __msisdn;
__exemode = 'continue';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","13163","2543","View Group Bundles V2.0","var input = __input.response;
if (input == '1') {
  __next = '3';
} else if (input == '2') {
  __next = '4'
} else {
  __next = '2';
}","2","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","13164","2543","View Group Bundles V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess)
{
__params.BundleType= input ;
 __next = '7a';
__exemode = 'continue';
}
else {
 __next = '1';
}","6","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","12","13165","2543","View Group Bundles V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
   type = __tempData.BundleList.get(i);
 __params.BundleId = type.bundleId ;
       __next = '9';
    } else {
        __next = '8';
    }","8","Select Destination Bundle","<html>
<body>
Please select Destination bundle:<br>
  $$var i = 1;
  $$for(bundle: __tempData.BundleList ) {
  ${i} ${bundle['bundleName']} : ${bundle['internalPrice']} ${bundle['Currency']} ${bundle['durationTimes']} ${bundle['durationUnit']}<br>
  $$  i = i+1;
  $$}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","13","13166","2543","View Group Bundles V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess  and !empty(input) ) {
 __params.@HEAD@PIN = input;
    __next = '10';
} else {
    __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","14","13167","2543","View Group Bundles V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","13168","2543","View Group Bundles V2.0","var input = __input.response;
var found = '0';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: __tempData.groups){
if(group.groupCode == input)
{
  found = '1';
}
}
if ( found == '0') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
__exemode = 'continue';
   __next = '5a';
}
}
 else {
      __next = '3';
}","3","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","13169","2543","View Group Bundles V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
__exemode = 'continue';
  __next = '5a';
}
else{
  __next = '4';
}","4","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","30","2","13170","2543","View Group Bundles V2.0","__next  = '1a';
__committerParams.MSISDN=__msisdn;
__exemode = 'continue';","1","query My Groups","query My Groups",""<endrec>
"CUSTOMER","","3","13171","2543","View Group Bundles V2.0","__tempData.groups = __input.lastCommitResult.result;
   if (empty(__tempData.groups ) || size(__tempData.groups ) == 0)
   {
      __errormsg = 'Sorry, you have no groups .';
      __next = 'error';
   } else
   {
       __next = '2';
   }","1a","check My Group","check My Group",""<endrec>
"CUSTOMER","31","7","13172","2543","View Group Bundles V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType;
__next = '5b';
__exemode = 'continue';","5a","Query Group Member Roles","Query Group Member Roles",""<endrec>
"CUSTOMER","","8","13173","2543","View Group Bundles V2.0","__tempData.roleList = __input.lastCommitResult.result;
if (!empty(__tempData.roleList ) || size(__tempData.roleList )) {
  __next = '6';
 } else {
   __errormsg = 'no current group member role.';
   __next = 'error';
 }","5b","Check Group Member Roles","Check Group Member Roles",""<endrec>
"CUSTOMER","41","10","13174","2543","View Group Bundles V2.0","__committerParams.ReceiverPartyIdentifier = __params.ReceiverPartyIdentifier ;
__committerParams.ReceiverPartyIdentifierType = __params.ReceiverPartyIdentifierType ;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier ;
__committerParams.InitiatorIdentifierType = __params.InitiatorIdentifierType ;
__committerParams.AccessDeviceIdentifierType = __params.AccessDeviceIdentifierType ;
__committerParams.AccessDeviceIdentifier = __params.AccessDeviceIdentifier ;
__committerParams.BundleType = __params.BundleType;
__next  = '7b';
__exemode = 'continue';","7a","query Bundle","query Bundle",""<endrec>
"CUSTOMER","","11","13175","2543","View Group Bundles V2.0","if(__input.lastCommitResult.isSucess){
   __tempData.BundleList = __input.lastCommitResult.result;
   if (empty(__tempData.BundleList) || size(__tempData.BundleList) == 0) {
      __errormsg = 'Sorry, there is no Bundle.';
      __next = 'error';
    } else {
       __next = '8';
    }
}else{
    __errormsg='sorry,query bundle failed.';
    __next='error';
}","7b","check Bundle","check Bundle",""<endrec>
"CUSTOMER","","1","13176","2544","View Reminder Schedules V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier =__msisdn;
__params.ActionType= 'QueryIndividualReminderScheduleDetails';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;
__params.NeedConfirmation= '1';
 __next = '1a';
 __exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","13177","2544","View Reminder Schedules V2.0","var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
var i = Util.toInt(__input.response) - 1;
__params.ReminderScheduleID =__tempData.reminderList.get(i).reminderId;
__params.ReminderScheduleName =__tempData.reminderList.get(i).reminderName;
__next = '3';
} else {
__next = '2';
}","2","Select Reminder Schedules","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$reminderList=__tempData.reminderList;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","13178","2544","View Reminder Schedules V2.0","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","13179","2544","View Reminder Schedules V2.0","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '4';
}","4","Comfirm","<html>
<body>
Reminder Schedule  - ${__params.ReminderScheduleName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","44","2","13180","2544","View Reminder Schedules V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.NeedConfirmation=__params.NeedConfirmation;
__next='1b';
__exemode='continue';","1a","Query Reminder Schedules","Query Reminder Schedules",""<endrec>
"CUSTOMER","","3","13181","2544","View Reminder Schedules V2.0","var commitResult=__input.lastCommitResult;
if (commitResult.isSucess)
{
    __tempData.reminderList =commitResult.result;
   if(empty(__tempData.reminderList)|| size(__tempData.reminderList)==0){
       __errormsg = 'no current schedules.';
       __next = 'error';
   }else {
       __next = '2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying schedules.';
   __next = 'error';
}","1b","Check Reminder Schedules","Check Reminder Schedules",""<endrec>
"CUSTOMER","","1","13182","2545","View Standing Order Schedule V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= __msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier =__msisdn;
__params.ActionType= 'QueryIndividualReminderScheduleDetails';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = __msisdn;
__params.NeedConfirmation= '0';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","13183","2545","View Standing Order Schedule V2.0","var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
  var i = Util.toInt(__input.response) - 1;
  __params.ReminderScheduleID = __tempData.reminderList.get(i).reminderId;
  __params.ReminderScheduleName =__tempData.reminderList.get(i).reminderName;
  __next = '3';
} else {
  __next = '2';
}","2","Select Standing Order Schedules","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$reminderList=__tempData.reminderList;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","5","13184","2545","View Standing Order Schedule V2.0","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","13185","2545","View Standing Order Schedule V2.0","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '4';
}","4","Comfirm","<html>
<body>
Reminder Schedule  - ${__params.ReminderScheduleName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","44","2","13186","2545","View Standing Order Schedule V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.NeedConfirmation=__params.NeedConfirmation;
__next='1b';
__exemode='continue';","1a","Query Standing Order Schedules","Query Standing Order Schedules",""<endrec>
"CUSTOMER","","3","13187","2545","View Standing Order Schedule V2.0","var commitResult=__input.lastCommitResult;
if (commitResult.isSucess)
{
    __tempData.reminderList =commitResult.result;
   if(empty(__tempData.reminderList)|| size(__tempData.reminderList)==0){
       __errormsg = 'no current schedules.';
       __next = 'error';
   }else {
       __next = '2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying schedules.';
   __next = 'error';
}","1b","Check Schedules","Check Schedules",""<endrec>
"CUSTOMER","","1","13188","2546","View Standing Order Schedule By Group V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.ActionType = 'QueryIndividualReminderScheduleDetails';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.NeedConfirmation = '0';
__next = '1a';
__exemode='continue';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","13189","2546","View Standing Order Schedule By Group V2.0","var input = __input.response;
if(!empty(input)){
       var found = '1';
       for (group: __tempData.groups) {
    if (group.groupCode == input) {
      found = '0';
    }
     }
       if (found == '1') {
       __errormsg = 'no current group or not belong to the group.';
       __next = 'error';
     } else {
        __params.ReceiverPartyIdentifier= input;        
        __next='2a';
        __exemode='continue';
    }
}else {
       __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","13190","2546","View Standing Order Schedule By Group V2.0","var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
 var i = Util.toInt(__input.response) - 1;
 __params.ReminderScheduleID = __tempData.reminderList.get(i).reminderId;
 __params.ReminderScheduleName = __tempData.reminderList.get(i).reminderName;
 __next = '3';
} else {
  __next = '2';
}","2","Select Standing Order Schedule","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$reminderList=__tempData.reminderList;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ }
<a href=""${__mobilemoneyURL}""  default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","8","13191","2546","View Standing Order Schedule By Group V2.0","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","13192","2546","View Standing Order Schedule By Group V2.0","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '4';
}","4","Comfirm","<html>
<body>
Reminder Schedule  - ${__params.ReminderScheduleName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","2","13193","2546","View Standing Order Schedule By Group V2.0","__committerParams.MSISDN = __msisdn;
__next='1b';
__exemode='continue';","1a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","3","13194","2546","View Standing Order Schedule By Group V2.0","if(__input.lastCommitResult.isSucess){
   __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '1';
   }
}else{
      __errormsg = 'no current groups.';
      __next = 'error';
}","1b","Check Groups","Check Groups",""<endrec>
"CUSTOMER","44","5","13195","2546","View Standing Order Schedule By Group V2.0","__committerParams.ServiceCode=__params.ServiceCode;
__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__committerParams.NeedConfirmation=__params.NeedConfirmation;
__next='2b';
__exemode='continue';","2a","Query Initiator Schedules","Query Initiator Schedules",""<endrec>
"CUSTOMER","","6","13196","2546","View Standing Order Schedule By Group V2.0","var commitResult=__input.lastCommitResult;
if (commitResult.isSucess)
{
    __tempData.reminderList =commitResult.result;
   if(empty(__tempData.reminderList)|| size(__tempData.reminderList)==0){
       __errormsg = 'no current schedules.';
       __next = 'error';
   }else {
       __next = '2';
   }
}else{
   __errormsg = 'Sorry,error occured when querying schedules.';
   __next = 'error';
}","2b","Check Schedules","Check Schedules",""<endrec>
"Pre-Validation","","1","13221","2553","Customer Deposit Money With Prevalidation for API V2.0","__params.Channel = __accessChannel;
__next = '1';
__exemode='continue';","begin","set parammeters","",""<endrec>
"Pre-Validation","8","4","13222","2553","Customer Deposit Money With Prevalidation for API V2.0","__next = '3a';
__exemode = 'continue';","3","Calculate Fee for Pre-Validation","Calculate Fee for Pre-Validation",""<endrec>
"Pre-Validation","19","2","13223","2553","Customer Deposit Money With Prevalidation for API V2.0","__committerParams.IdentifierType = 'Initiator';
__committerParams.Role = '500000000000010001';
__next = '2';
__exemode = 'continue';","1","Query Notification Msisdn","Query Notification Msisdn",""<endrec>
"Pre-Validation","","3","13224","2553","Customer Deposit Money With Prevalidation for API V2.0","__tempData.notificationList = __input.lastCommitResult.result;
var isNeedPrevalidation = __input.validateResult.isSucess;
if (isNeedPrevalidation)
{
     __next = '3';
     __exemode = 'continue';
}
else
{
      __next = '11';
      __exemode = 'continue';
}","2","Check Pre-validation or not","Check whether need to Pre-validation and confirm with Customer","10"<endrec>
"CUSTOMER","","1","13231","2556","KCB Bank Balance","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='10239';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_KCB_Query_Saving_Account_Balance';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13232","2556","KCB Bank Balance","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","13233","2557","M-Shwari FSI Mini StatementCopy","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='2001';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Mini_Statement';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13234","2557","M-Shwari FSI Mini StatementCopy","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","13235","2558","KCB FSI Mini Statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='10239';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_KCB_Query_Mini_Statement';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13236","2558","KCB FSI Mini Statement","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","13239","2560","KCB Query Eligible Credit Limit","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='10239';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_KCB_Query_Eligible_Credit_Limit';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13240","2560","KCB Query Eligible Credit Limit","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","5","13243","2553","Customer Deposit Money With Prevalidation for API V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    __tempData.preValidationResult = __input.lastCommitResult.result;
    __next = '4a';
    __exemode = 'continue';
}
else
{
    __tempData.preValidationResult.errorCode = __input.lastCommitResult.errorCode;
    __tempData.preValidationResult.errorMsg = __input.lastCommitResult.errorMessage ;
     __next = '4b';
    __exemode = 'continue';
}","3a","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"Pre-Validation","92","6","13244","2553","Customer Deposit Money With Prevalidation for API V2.0","__committerParams.Initiator = 'Initiator';
__committerParams.Receiver = 'ReceiverParty';

__next = '4c';
__exemode = 'continue';","4a","Query Identity Name","Query Identity Name",""<endrec>
"Pre-Validation","17","7","13245","2553","Customer Deposit Money With Prevalidation for API V2.0","__committerParams.BudgetResult = '1';
__committerParams.ResultCode = '1';
__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ErrorCode = '2';
__committerParams.ErrorDesc = 'Pre-Validation Request Failed.';
__committerParams.Channel =  __accessChannel;
var realErrorCode = __tempData.preValidationResult.errorCode;
var realErrorMsg = __tempData.preValidationResult.errorMsg;
__committerParams.Reason = 'Failed. Calculate fee failed for channelSessionID=' + __channelSessionID + ', cause: ' + realErrorCode + ',' + realErrorMsg;

__tempData.ResultCode = __tempData.preValidationResult.errorCode;
__tempData.ResultMsg= __tempData.preValidationResult.errorMsg;

__next = '13';
__exemode = 'continue';","4b","Record Pre-Validation for calculate fee failed","Record Pre-Validation for calculate fee failed",""<endrec>
"Pre-Validation","21","8","13246","2553","Customer Deposit Money With Prevalidation for API V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.IdentityInfo = __input.lastCommitResult.result;
}

__committerParams.SystemParamCode = 'SUPPORT_CNS_USSD_PUSH';
__next = '5';
__exemode = 'continue';","4c","Check Identity Name","Check Identity Name",""<endrec>
"Pre-Validation","16","9","13247","2553","Customer Deposit Money With Prevalidation for API V2.0","__committerParams.Category = 'DepositWithPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.TaxMsgFormat = ':The amount of tax is: %s';
__committerParams.FeeInfo = __tempData.preValidationResult;
__committerParams.IdentityInfo = __tempData.IdentityInfo ;

var isSupportCustomerNameSearch = __input.lastCommitResult.result;
var cust = __tempData.IdentityInfo;
if (isSupportCustomerNameSearch == '1' and !cust.receiverCNSStatus.suspensionFlag.fieldValue == '01')
{
    if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' and cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
    {
        __committerParams.MaskMode = '0';
    }
}
else
{
    __committerParams.MaskMode = '2';
}

__next = '6';
__exemode = 'continue';","5","Prepare Confirm Information for Pre-Validation","Prepare Confirm Information for Pre-Validation",""<endrec>
"Pre-Validation","15","23","13248","2553","Customer Deposit Money With Prevalidation for API V2.0","__committerParams.ResultCode = 'TS28009';
__committerParams.@ResultParam@ResultMsg='Pre-Validation Result is Rejected.';
__next = 'end';","cancel","Cancel current request","Cancel current request",""<endrec>
"Pre-Validation","15","10","13249","2553","Customer Deposit Money With Prevalidation for API V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
   var confirmMsgParam = __input.lastCommitResult.result;
    /*format message*/
    var confirmMsgFormat = 'Customer %s, Phone number %s  will deposit %s. Respond with. Charge for this transaction is:\n %s.';

    __committerParams.@ResultParam@ResultMsg = Util.formatMessage(confirmMsgFormat, confirmMsgParam.ReceiverMaskName, confirmMsgParam.ReceiverMSISDN, confirmMsgParam.AmountCurrency, confirmMsgParam.FeeInfoMSG);
   __committerParams.FeeInfo = __tempData.preValidationResult;

    __next = '7';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","6","Send Pre-Validation to Customer","Send Pre-Validation to Customer",""<endrec>
"Pre-Validation","","11","13250","2553","Customer Deposit Money With Prevalidation for API V2.0","var confirmedOrNot = __input.validateResult.isSucess;
if (confirmedOrNot)
{
     __next = '7a';
     __exemode = 'continue';
}
else
{
         __next = '7b';
         __exemode = 'continue';
}","7","Wait for Customer confirmation","Wait for Customer confirmation","10"<endrec>
"Pre-Validation","91","12","13251","2553","Customer Deposit Money With Prevalidation for API V2.0","__committerParams.IdentifierRole = 'Initiator';
__committerParams.IdentifierType = '05';

__next = '10';
__exemode = 'continue';","7a","CNS Confirmation Process","CNS Confirmation Process",""<endrec>
"Pre-Validation","90","13","13252","2553","Customer Deposit Money With Prevalidation for API V2.0","__committerParams.IdentifierRole = 'Initiator';
__committerParams.IdentifierType = '05';

__next = '8';
__exemode = 'continue';","7b","CNS Cancelation Process","CNS Cancelation Process",""<endrec>
"Pre-Validation","20","14","13253","2553","Customer Deposit Money With Prevalidation for API V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='You rejected initiate transaction!';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = '9';
__exemode = 'continue';","8","Send Cancel Notification","Send Cancel Notification",""<endrec>
"Pre-Validation","17","15","13254","2553","Customer Deposit Money With Prevalidation for API V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __channelSessionID;

__next = 'cancel';
__exemode = 'continue';","9","Record Pre-Validtion event for Cancel","Record Pre-Validtion event for Cancel",""<endrec>
"Pre-Validation","17","16","13255","2553","Customer Deposit Money With Prevalidation for API V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '0';
__committerParams.ResultType='1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Continue Pre-Validation Transaction.  ChannelSessionID=' + __channelSessionID;

__next = '11';
__exemode='continue';","10","Record Pre-Validation event log for confirm","Record Pre-Validation event log for confirm",""<endrec>
"Pre-Validation","14","17","13256","2553","Customer Deposit Money With Prevalidation for API V2.0","__committerParams.Reason = 'Forward request to backend server directly sync.';
__next = '11a';
__exemode = 'continue';","11","Forward request  to backend server directly","Forward request  to backend server directly",""<endrec>
"Pre-Validation","","18","13257","2553","Customer Deposit Money With Prevalidation for API V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
   __params.CurResp= __input.lastCommitResult.result;
   __next = '12';
   __exemode = 'continue';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","11a","Check transaction final result","Check transaction final result",""<endrec>
"Pre-Validation","15","19","13258","2553","Customer Deposit Money With Prevalidation for API V2.0","__committerParams.ResultCode = '0';
__committerParams.ResultType = '0';
__committerParams.@ResultParam@ResultMsg='You confirm initiate transaction';
__next = 'end';","12","Send Confirm Message to API","Send Confirm Message to API",""<endrec>
"Pre-Validation","15","20","13259","2553","Customer Deposit Money With Prevalidation for API V2.0","__committerParams.ResultCode = '0';
__committerParams.ResultType = '0';
__committerParams.@ResultParam@ResultMsg='Pre-Validation Failed';
__next = 'end';","13","Send Failed APIResult to 3rd","Send Failed APIResult to 3rd",""<endrec>
"Pre-Validation","20","21","13260","2553","Customer Deposit Money With Prevalidation for API V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Request Failed';
notificationParams .errDesc='Pre-Validation Request Failed';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = 'end';","error","Error occurred","error occurred when executing current flow",""<endrec>
"Pre-Validation","18","22","13261","2553","Customer Deposit Money With Prevalidation for API V2.0","__next = 'end';","timeout","Session timeout","Session timeout",""<endrec>
"Pre-Validation","","1","13313","2564","Customer Deposit Money With Prevalidation for STK V2.0","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
__next = '1';
__exemode='continue';","begin","set parammeters","",""<endrec>
"Pre-Validation","92","4","13314","2564","Customer Deposit Money With Prevalidation for STK V2.0","__committerParams.Initiator = 'ReceiverParty';
__committerParams.Receiver = 'ReceiverParty';
__next = '2a';
__exemode = 'continue';","2","Query Identity Name","Query Identity Name",""<endrec>
"Pre-Validation","19","2","13315","2564","Customer Deposit Money With Prevalidation for STK V2.0","__committerParams.IdentifierType = 'ReceiverParty';
__committerParams.AccessDevice= 'AccessDevice';

__next = '1a';
__exemode = 'continue';","1","Query Notification Msisdn","Query Notification Msisdn",""<endrec>
"Pre-Validation","","3","13316","2564","Customer Deposit Money With Prevalidation for STK V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.notificationList = __input.lastCommitResult.result;
}
__next = '2';
__exemode = 'continue';","1a","Check Notification Msisdn","Check Notification Msisdn",""<endrec>
"Pre-Validation","21","5","13317","2564","Customer Deposit Money With Prevalidation for STK V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.IdentityInfo = __input.lastCommitResult.result;
}
__committerParams.SystemParamCode = 'SUPPORT_CNS_USSD_PUSH';
__next = '2c';
__exemode = 'continue';","2a","Check Identity Name","Check Identity Name",""<endrec>
"Pre-Validation","","6","13318","2564","Customer Deposit Money With Prevalidation for STK V2.0","var isSupportCustomerNameSearch = __input.lastCommitResult.result;
var cust = __tempData.IdentityInfo;
if(isSupportCustomerNameSearch != '1' || cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01')
{
    __params.put('ResultType','0');
    __params.Reason=""Continue Pre-Validation Transaction."";
    __params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
    __next='2d';
    __exemode = 'continue';
}else
{
    __next='3';
    __exemode = 'continue';
}","2c","Check isSupportCustomerNameSearch","Check isSupportCustomerNameSearch",""<endrec>
"Pre-Validation","91","7","13319","2564","Customer Deposit Money With Prevalidation for STK V2.0","__committerParams.IdentifierRole= 'Initiator';
__committerParams.IdentifierType = '05';

__next = '8';
__exemode = 'continue';","2d","CNS Comfirmation","CNS Comfirmation",""<endrec>
"Pre-Validation","","8","13320","2564","Customer Deposit Money With Prevalidation for STK V2.0","var needDisplayFeeConfirmation = __input.validateResult.isSucess;
if (needDisplayFeeConfirmation )
{
     __next = '4';
     __exemode = 'continue';
}
else
{
      __next = '8';
      __exemode = 'continue';
}","3","Check needDisplayFeeConfirmation or not","Check needDisplayFeeConfirmation or not","10"<endrec>
"Pre-Validation","8","9","13321","2564","Customer Deposit Money With Prevalidation for STK V2.0","__next = '4a';
__exemode = 'continue';","4","Calculate Fee for Pre-Validation","Calculate Fee for Pre-Validation",""<endrec>
"Pre-Validation","18","23","13322","2564","Customer Deposit Money With Prevalidation for STK V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.errDesc='Pre-Validation confirmation is Timeout';
__committerParams.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
__next = 'timeout';","timeout","Session timeout","current session is timeout",""<endrec>
"Pre-Validation","","10","13323","2564","Customer Deposit Money With Prevalidation for STK V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    __tempData.preValidationResult = __input.lastCommitResult.result;
    __next = '5a';
    __exemode = 'continue';
}
else
{
     __next = '5b';
    __exemode = 'continue';
}","4a","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"Pre-Validation","16","11","13324","2564","Customer Deposit Money With Prevalidation for STK V2.0","var cust = __tempData.IdentityInfo;
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);

__committerParams.Category = 'SendMoneyWithPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.TaxMsgFormat = ':The amount of tax is: %s';
__committerParams.FeeInfo = __tempData.preValidationResult;
__committerParams.IdentityInfo = __tempData.IdentityInfo;

if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' and cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
{
    __committerParams.MaskMode = '0';
}
else
{
    __committerParams.MaskMode = '2';
}

__next = '6';
__exemode = 'continue';","5a","Prepare Confirm Information for Pre-Validation","Prepare Confirm Information for Pre-Validation",""<endrec>
"Pre-Validation","17","12","13325","2564","Customer Deposit Money With Prevalidation for STK V2.0","__params.errDesc=budgetMap.errorMsg;
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');

__next = 'end';","5b","Record Pre-Validation for calculate fee failed","Record Pre-Validation for calculate fee failed",""<endrec>
"Pre-Validation","12","13","13326","2564","Customer Deposit Money With Prevalidation for STK V2.0","var isSucess = __input.lastCommitResult.isSucess;
var cust = __tempData.IdentityInfo;
if (isSucess)
{
    var confirmMsgParam = __input.lastCommitResult.result;
    var confirmMsgFormat = 'You will pay %s to ';
    if(cust.SubType == '1000')
    {
        confirmMsgFormat = confirmMsgFormat + 'the unregistered Customer';
    }
    else
    {
        confirmMsgFormat = confirmMsgFormat + 'Customer %s';
    }
    confirmMsgFormat = confirmMsgFormat + ', Phone number %s. Charge for this transaction is:\n %s.';
    var promptText = Util.formatMessage(confirmMsgFormat, confirmMsgParam.AmountCurrency, confirmMsgParam.ReceiverMaskName, confirmMsgParam.ReceiverMSISDN, confirmMsgParam.FeeInfoMSG);
    var cust =  __tempData.IdentityInfo;

    __committerParams.InterfaceCode = '19';
    __committerParams.put('TransOutgoingRequest@LIST@Param.PromptText', promptText);
    __committerParams.put('TransOutgoingRequest@LIST@Param.MSISDN', __tempData.notificationList[0].recipients);
    __committerParams.put('TransOutgoingRequest@LIST@Param.TransactionID', __channelSessionID);

    __next = '7';
}
else
{
    __next = 'error';
}","6","Send Pre-Validation to Customer","Send Pre-Validation to Customer",""<endrec>
"Pre-Validation","","14","13327","2564","Customer Deposit Money With Prevalidation for STK V2.0","var confirmedOrNot = __input.validateResult.isSucess;
if (confirmedOrNot)
{
     __next = '8';
     __exemode = 'continue';
}
else
{
         __next = '9a';
         __exemode = 'continue';
}","7","Wait for Customer confirmation","Wait for Customer confirmation","10"<endrec>
"Pre-Validation","14","15","13328","2564","Customer Deposit Money With Prevalidation for STK V2.0","__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';

__next = 'end';","8","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","16","13329","2564","Customer Deposit Money With Prevalidation for STK V2.0","if (__input.validateResult.isSucess)
{
    __params.errDesc='Pre-Validation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';

    __next = '10';
    __exemode = 'continue';
}
else
{
    __next = '9b';
    __exemode = 'continue';
}","9a","Cancel Transaction 1","Cancel Transaction","10"<endrec>
"Pre-Validation","","17","13330","2564","Customer Deposit Money With Prevalidation for STK V2.0","if (__input.validateResult.isSucess)
{
    __params.errDesc='Pre-Validation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';

    __next = '10';
    __exemode = 'continue';
}
else
{
    __next = '9c';
    __exemode = 'continue';
}","9b","Cancel Transaction 2","Cancel Transaction","10"<endrec>
"Pre-Validation","","18","13331","2564","Customer Deposit Money With Prevalidation for STK V2.0","if (__input.validateResult.isSucess)
{
    __next = 'timeout';
}
else
{
    __next = 'error';
}","9c","Check comfirm timeout","Check comfirm timeout","10"<endrec>
"Pre-Validation","90","19","13332","2564","Customer Deposit Money With Prevalidation for STK V2.0","__committerParams.IdentifierRole = 'Initiator';
__committerParams.IdentifierType = '05';
__next = '11';
__exemode = 'continue';","10","CNS Cancelation Process","CNS Cancelation Process",""<endrec>
"Pre-Validation","20","20","13333","2564","Customer Deposit Money With Prevalidation for STK V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = '12';
__exemode = 'continue';","11","Send Cancel Notification","Send Cancel Notification",""<endrec>
"Pre-Validation","17","21","13334","2564","Customer Deposit Money With Prevalidation for STK V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __channelSessionID;

__next = 'end';","12","Record Pre-Validtion event for Cancel","Record Pre-Validtion event for Cancel",""<endrec>
"Pre-Validation","20","22","13335","2564","Customer Deposit Money With Prevalidation for STK V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Request Failed';
notificationParams .errDesc='Pre-Validation Request Failed';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = 'error';","error","Error occurred","Error occurred",""<endrec>
"Pre-Validation","","1","13336","2565","Customer Deposit Money With Prevalidation for WEB V2.0","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
__next = '1';
__exemode = 'continue';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","13337","2565","Customer Deposit Money With Prevalidation for WEB V2.0","var isNeedPrevalidation = __input.validateResult.isSucess;
if (isNeedPrevalidation)
{
     __next = '3';
     __exemode = 'continue';
}
else
{
      __next = '8';
      __exemode = 'continue';
}","2","Check Pre-validation or not","Check Pre-validation or not","10"<endrec>
"Pre-Validation","92","2","13338","2565","Customer Deposit Money With Prevalidation for WEB V2.0","__committerParams.IdentifierType = 'Initiator';
__committerParams.Role = '500000000000010001';
__next = '1a';
__exemode = 'continue';","1","Query Notification Msisdn","Query Notification Msisdn",""<endrec>
"Pre-Validation","","3","13339","2565","Customer Deposit Money With Prevalidation for WEB V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.notificationList = __input.lastCommitResult.result;
}

__next = '2';
__exemode = 'continue';","1a","Check Notification Msisdn","Check Notification Msisdn",""<endrec>
"Pre-Validation","22","5","13340","2565","Customer Deposit Money With Prevalidation for WEB V2.0","__next = '3a';
__exemode = 'continue';","3","Calculate Fee for Pre-Validation","Calculate Fee for Pre-Validation",""<endrec>
"Pre-Validation","","6","13341","2565","Customer Deposit Money With Prevalidation for WEB V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    __params.CurResp= __input.lastCommitResult.result;
    __next = '4';
    __exemode = 'continue';
}
else
{
     __next = 'error';
    __exemode = 'continue';
}","3a","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"Pre-Validation","92","7","13342","2565","Customer Deposit Money With Prevalidation for WEB V2.0","__committerParams.Initiator = 'PrimaryParty';
__committerParams.Receiver = 'ReceiverParty';
__next = '4a';
__exemode = 'continue';","4","Query Identity Name","Query Identity Name",""<endrec>
"Pre-Validation","21","8","13343","2565","Customer Deposit Money With Prevalidation for WEB V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.IdentityInfo = __input.lastCommitResult.result;
}

__committerParams.SystemParamCode = 'SUPPORT_CNS_USSD_PUSH';
__next = '5';
__exemode = 'continue';","4a","Check Identity Name","Check Identity Name",""<endrec>
"Pre-Validation","16","9","13344","2565","Customer Deposit Money With Prevalidation for WEB V2.0","__committerParams.Category = 'PrevalidationForWeb';
__committerParams.IdentityInfo = __tempData.IdentityInfo;

var isSupportCustomerNameSearch = __input.lastCommitResult.result;
var cust = __tempData.IdentityInfo;
if (isSupportCustomerNameSearch == '1' and cust.receiverCNSStatus.suspensionFlag.fieldValue == '02')
{
    if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' and cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
    {
        __committerParams.MaskMode = '0';
    }
}
else
{
    __committerParams.MaskMode = '2';
}

__next = '6';
__exemode = 'continue';","5","Prepare Confirm Information for Pre-Validation","Prepare Confirm Information for Pre-Validation",""<endrec>
"Pre-Validation","","10","13346","2565","Customer Deposit Money With Prevalidation for WEB V2.0","if(__input.lastCommitResult.isSucess)
{
    var params= __input.lastCommitResult.result;
    var tips = 'Customer '+ params.ReceiverMaskName+' Phone number '+params.ReceiverMSISDN+' will deposit '+params.AmountCurrency;
    var respParams = Util.createMap();
    respParams.put('CalculateFeeResponse.tips',tips);
    __params.ResponseParams = respParams;
    __next = '7';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","6","Put Pre-validation Result to Response","Put Pre-validation Result to Response",""<endrec>
"Pre-Validation","","11","13347","2565","Customer Deposit Money With Prevalidation for WEB V2.0","__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

var confirmedOrNot = __input.validateResult.isSucess;
if (confirmedOrNot)
{
     __params.ResultType = '0';
     __next = '8';
     __exemode = 'continue';
}
else
{
      __next = '9a';
      __exemode = 'continue';
}","7","Check Comfirm Result","Check Comfirm Result","10"<endrec>
"Pre-Validation","14","12","13348","2565","Customer Deposit Money With Prevalidation for WEB V2.0","__next = '8a';
__exemode='continue';","8","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","13","13349","2565","Customer Deposit Money With Prevalidation for WEB V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
   __params.CurResp= __input.lastCommitResult.result;
   __next = 'end';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","8a","Check transaction final result","Check transaction final result",""<endrec>
"Pre-Validation","","14","13350","2565","Customer Deposit Money With Prevalidation for WEB V2.0","if (__input.validateResult.isSucess)
{
    __params.errDesc='Pre-Validation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';

    __next = '10';
    __exemode = 'continue';
}
else
{
    __next = '9b';
    __exemode = 'continue';
}","9a","Cancel Transaction 1","ResultType = 2, Cancel Transaction.","10"<endrec>
"Pre-Validation","","15","13351","2565","Customer Deposit Money With Prevalidation for WEB V2.0","if (__input.validateResult.isSucess)
{
    __params.errDesc='Pre-Validation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';

    __next = '10';
    __exemode = 'continue';
}
else
{
    __next = '9c';
    __exemode = 'continue';
}","9b","Cancel Transaction 2","ResultType = 3, Cancel Transaction.","10"<endrec>
"Pre-Validation","","16","13352","2565","Customer Deposit Money With Prevalidation for WEB V2.0","if (__input.validateResult.isSucess)
{
    __next = 'timeout';
}
else
{
    __next = 'error';
}","9c","Check comfirm timeout","Check comfirm timeout","10"<endrec>
"Pre-Validation","20","17","13353","2565","Customer Deposit Money With Prevalidation for WEB V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = '11';
__exemode = 'continue';","10","Send Cancel Notification","Send Cancel Notification",""<endrec>
"Pre-Validation","17","18","13354","2565","Customer Deposit Money With Prevalidation for WEB V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __channelSessionID;

__next = 'end';","11","Record Pre-Validtion event for Cancel","Record Pre-Validtion event for Cancel",""<endrec>
"Pre-Validation","20","19","13357","2565","Customer Deposit Money With Prevalidation for WEB V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Request Failed';
notificationParams .errDesc='Pre-Validation Request Failed';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = 'error';","error","Error occurred","error occurred when executing current flow",""<endrec>
"Pre-Validation","18","20","13358","2565","Customer Deposit Money With Prevalidation for WEB V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.errDesc='Pre-Validation confirmation is Timeout';
__committerParams.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
__next = 'timeout';","timeout","Session Timeout","current session is timeout",""<endrec>
"Pre-Validation","","1","13457","2570","Send Money With Prevalidation for WEB V2.0","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
__next = '1';
__exemode='continue';","begin","set parammeters","",""<endrec>
"Pre-Validation","17","18","13458","2570","Send Money With Prevalidation for WEB V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __channelSessionID;

__next = 'end';","11","Record Pre-Validtion event for Cancel","Record Pre-Validtion event for Cancel",""<endrec>
"Pre-Validation","19","2","13459","2570","Send Money With Prevalidation for WEB V2.0","__committerParams.IdentifierType = 'Initiator';
__committerParams.Role = '500000000000010001';
__next = '1a';
__exemode = 'continue';","1","Query Notification Msisdn","Query Notification Msisdn",""<endrec>
"Pre-Validation","","3","13460","2570","Send Money With Prevalidation for WEB V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.notificationList = __input.lastCommitResult.result;
    __next = '2';
    __exemode = 'continue';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","1a","Check Notification Msisdn","Check Notification Msisdn",""<endrec>
"Pre-Validation","20","19","13461","2570","Send Money With Prevalidation for WEB V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Request Failed';
notificationParams .errDesc='Pre-Validation Request Failed';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = 'error';","error","Error occurred","error occurred when executing current flow",""<endrec>
"Pre-Validation","18","20","13462","2570","Send Money With Prevalidation for WEB V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.errDesc='Pre-Validation confirmation is Timeout';
__committerParams.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
__next = 'timeout';","timeout","Session timeout","current session is timeout",""<endrec>
"Pre-Validation","92","7","13463","2570","Send Money With Prevalidation for WEB V2.0","__committerParams.Initiator = 'Initiator';
__committerParams.Receiver = 'ReceiverParty';
__next = '4a';
__exemode = 'continue';","4","Query Identity Name","Query Identity Name",""<endrec>
"Pre-Validation","21","8","13464","2570","Send Money With Prevalidation for WEB V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.IdentityInfo = __input.lastCommitResult.result;
}

__committerParams.SystemParamCode = 'SUPPORT_CNS_USSD_PUSH';
__next = '5';
__exemode = 'continue';","4a","Check Identity Name","Check Identity Name",""<endrec>
"Pre-Validation","","4","13467","2570","Send Money With Prevalidation for WEB V2.0","var isNeedPrevalidation = __input.validateResult.isSucess;
if (isNeedPrevalidation)
{
     __next = '3';
     __exemode = 'continue';
}
else
{
      __next = '8';
      __exemode = 'continue';
}","2","Check Pre-validation or not","Check Pre-validation or not","10"<endrec>
"Pre-Validation","22","5","13468","2570","Send Money With Prevalidation for WEB V2.0","__next = '3a';
__exemode = 'continue';","3","Calculate Fee for Pre-Validation","Calculate Fee for Pre-Validation",""<endrec>
"Pre-Validation","16","9","13470","2570","Send Money With Prevalidation for WEB V2.0","__committerParams.Category = 'PrevalidationForWeb';
__committerParams.IdentityInfo = __tempData.IdentityInfo;

var isSupportCustomerNameSearch = __input.lastCommitResult.result;
var cust = __tempData.IdentityInfo;
if (isSupportCustomerNameSearch == '1' and cust.receiverCNSStatus.suspensionFlag.fieldValue == '02')
{
    if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' and cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
    {
        __committerParams.MaskMode = '0';
    }
}
else
{
    __committerParams.MaskMode = '2';
}

__next = '6';
__exemode = 'continue';","5","Prepare Confirm Information for Pre-Validation","Prepare Confirm Information for Pre-Validation",""<endrec>
"Pre-Validation","","10","13471","2570","Send Money With Prevalidation for WEB V2.0","if(__input.lastCommitResult.isSucess)
{
    var params= __input.lastCommitResult.result;
    var tips = 'You will send '+params.AmountCurrency+'to customer '+ params.ReceiverMaskName+' ,phone number '+params.ReceiverMSISDN;
    var respParams = Util.createMap();
    respParams.put('CalculateFeeResponse.tips',tips);
    __params.ResponseParams = respParams;
    __next = '7';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","6","Put Pre-validation Result to Response","Put Pre-validation Result to Response",""<endrec>
"Pre-Validation","","11","13472","2570","Send Money With Prevalidation for WEB V2.0","__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

var confirmedOrNot = __input.validateResult.isSucess;
if (confirmedOrNot)
{
     __params.ResultType = '0';
     __next = '8';
     __exemode = 'continue';
}
else
{
      __next = '9a';
      __exemode = 'continue';
}","7","Check Comfirm Result","Check Comfirm Result","10"<endrec>
"Pre-Validation","14","12","13473","2570","Send Money With Prevalidation for WEB V2.0","__next = '8a';
__exemode='continue';","8","Forward request  to backend server","Forward request  to backend server",""<endrec>
"Pre-Validation","","6","13474","2570","Send Money With Prevalidation for WEB V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    __params.CurResp= __input.lastCommitResult.result;
    __next = '4';
    __exemode = 'continue';
}
else
{
     __next = 'error';
    __exemode = 'continue';
}","3a","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"Pre-Validation","","13","13475","2570","Send Money With Prevalidation for WEB V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
   __params.CurResp= __input.lastCommitResult.result;
   __next = 'end';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","8a","Check transaction final result","Check transaction final result",""<endrec>
"Pre-Validation","","14","13476","2570","Send Money With Prevalidation for WEB V2.0","if (__input.validateResult.isSucess)
{
    __params.errDesc='Pre-Validation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';

    __next = '10';
    __exemode = 'continue';
}
else
{
    __next = '9b';
    __exemode = 'continue';
}","9a","Cancel Transaction 1","ResultType = 2, Cancel Transaction.","10"<endrec>
"Pre-Validation","","15","13477","2570","Send Money With Prevalidation for WEB V2.0","if (__input.validateResult.isSucess)
{
    __params.errDesc='Pre-Validation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';

    __next = '10';
    __exemode = 'continue';
}
else
{
    __next = '9c';
    __exemode = 'continue';
}","9b","Cancel Transaction 2","ResultType = 3, Cancel Transaction.","10"<endrec>
"Pre-Validation","","16","13478","2570","Send Money With Prevalidation for WEB V2.0","if (__input.validateResult.isSucess)
{
    __next = 'timeout';
    __exemode = 'continue';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","9c","Check comfirm timeout","Check comfirm timeout","10"<endrec>
"Pre-Validation","20","17","13480","2570","Send Money With Prevalidation for WEB V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;
__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = '11';
__exemode = 'continue';","10","Send Cancel Notification","Send Cancel Notification",""<endrec>
"Pre-Validation","","1","13501","2572","Withdraw At Agent With Prevalidation for API V2.0","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
__next = '1';
__exemode='continue';","begin","set parammeters","",""<endrec>
"Pre-Validation","15","20","13502","2572","Withdraw At Agent With Prevalidation for API V2.0","__committerParams.ResultCode = 'TS28009';
__committerParams.@ResultParam@ResultMsg='Pre-Validation Result is Rejected.';
__next = 'cancel';","cancel","Cancel current request","Cancel current request",""<endrec>
"Pre-Validation","19","2","13503","2572","Withdraw At Agent With Prevalidation for API V2.0","__committerParams.IdentifierType = 'Initiator';
__committerParams.Role = '500000000000010001';
__next = '2';
__exemode = 'continue';","1","Query Notification Msisdn","Query Notification Msisdn",""<endrec>
"Pre-Validation","","3","13504","2572","Withdraw At Agent With Prevalidation for API V2.0","__tempData.notificationList = __input.lastCommitResult.result;
var isNeedPrevalidation = __input.validateResult.isSucess;
if (isNeedPrevalidation)
{
     __next = '3';
     __exemode = 'continue';
}
else
{
      __next = '10';
      __exemode = 'continue';
}","2","Check Pre-validation or not","Check whether need to Pre-validation and confirm with Customer","10"<endrec>
"Pre-Validation","15","18","13505","2572","Withdraw At Agent With Prevalidation for API V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Request Failed';
notificationParams .errDesc='Pre-Validation Request Failed';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = 'error';","error","Error occurred","error occurred when executing current flow",""<endrec>
"Pre-Validation","18","19","13506","2572","Withdraw At Agent With Prevalidation for API V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.errDesc='Pre-Validation confirmation is Timeout';
__committerParams.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
__next = 'timeout';","timeout","Session timeout","current session is timeout",""<endrec>
"Pre-Validation","92","6","13507","2572","Withdraw At Agent With Prevalidation for API V2.0","__committerParams.Initiator = 'Initiator';
__committerParams.Receiver = 'Initiator';

__next = '5';
__exemode = 'continue';","4a","Query Identity Name","Query Identity Name",""<endrec>
"Pre-Validation","16","8","13508","2572","Withdraw At Agent With Prevalidation for API V2.0","__committerParams.Category = 'WithdrawWithPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.TaxMsgFormat = ':The amount of tax is: %s';
__committerParams.FeeInfo = __tempData.preValidationResult;
__committerParams.IdentityInfo = __input.lastCommitResult.result;
__committerParams.MaskMode = '1';
__next = '6';
__exemode = 'continue';","5","Prepare Confirm Information for Pre-Validation","Prepare Confirm Information for Pre-Validation",""<endrec>
"Pre-Validation","8","4","13509","2572","Withdraw At Agent With Prevalidation for API V2.0","__next = '4';
__exemode = 'continue';","3","Calculate Fee for Pre-Validation","Calculate Fee for Pre-Validation",""<endrec>
"Pre-Validation","17","7","13510","2572","Withdraw At Agent With Prevalidation for API V2.0","__committerParams.BudgetResult = '1';
__committerParams.ResultCode = '1';
__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ErrorCode = '2';
__committerParams.ErrorDesc = 'Pre-Validation Request Failed.';
__committerParams.Channel =  __accessChannel;
var realErrorCode = __tempData.preValidationResult.errorCode;
var realErrorMsg = __tempData.preValidationResult.errorMsg;
__committerParams.Reason = 'Failed. Calculate fee failed for channelSessionID=' + __channelSessionID + ', cause: ' + realErrorCode + ',' + realErrorMsg;

__tempData.ResultCode = __tempData.preValidationResult.errorCode;
__tempData.ResultMsg = __tempData.preValidationResult.errorMsg;

__next = 'error';
__exemode = 'continue';","4b","Record Pre-Validation for calculate fee failed","Record Pre-Validation for calculate fee failed",""<endrec>
"Pre-Validation","15","9","13511","2572","Withdraw At Agent With Prevalidation for API V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
   var confirmMsgParam = __input.lastCommitResult.result;
    /*format message*/
    var confirmMsgFormat = 'You will withdraw %s from %s, Phone number %s. Charge for this transaction is:\n %s.';

    __committerParams.@ResultParam@ResultMsg = Util.formatMessage(confirmMsgFormat, confirmMsgParam.AmountCurrency, confirmMsgParam.ReceiverMaskName, confirmMsgParam.ReceiverMSISDN, confirmMsgParam.FeeInfoMSG);
   __committerParams.FeeInfo = __tempData.preValidationResult;

    /*Util.cleanTempData(__tempData, nullpreValidationResult');*/
    __next = '7';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","6","Send Pre-Validation to Customer","Send Pre-Validation to Customer",""<endrec>
"Pre-Validation","","10","13512","2572","Withdraw At Agent With Prevalidation for API V2.0","var confirmedOrNot = __input.validateResult.isSucess;
if (confirmedOrNot)
{
     __next = '7a';
     __exemode = 'continue';
}
else
{
         __next = '7b';
         __exemode = 'continue';
}","7","Wait for Customer confirmation","Wait for Customer confirmation","10"<endrec>
"Pre-Validation","17","11","13513","2572","Withdraw At Agent With Prevalidation for API V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '0';
__committerParams.ResultType='1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Continue Pre-Validation Transaction.  ChannelSessionID=' + __channelSessionID;

__next = '10';
__exemode='continue';","7a","Record Pre-Validation event log for confirm","Record Pre-Validation event log for confirm",""<endrec>
"Pre-Validation","90","12","13514","2572","Withdraw At Agent With Prevalidation for API V2.0","__committerParams.IdentifierRole = 'Initiator';
__committerParams.IdentifierType = '01';

__next = '8';
__exemode = 'continue';","7b","CNS Cancelation Process","CNS Cancelation Process",""<endrec>
"Pre-Validation","","5","13515","2572","Withdraw At Agent With Prevalidation for API V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    __tempData.preValidationResult = __input.lastCommitResult.result;
    __next = '4a';
    __exemode = 'continue';
}
else
{
    __next = '4b';
    __exemode = 'continue';
}","4","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"Pre-Validation","20","13","13516","2572","Withdraw At Agent With Prevalidation for API V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='You rejected initiate transaction!';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = '9';
__exemode = 'continue';","8","Send Cancel Notification","Send Cancel Notification",""<endrec>
"Pre-Validation","17","14","13517","2572","Withdraw At Agent With Prevalidation for API V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __channelSessionID;

__next = 'cancel';
__exemode='continue';","9","Record Pre-Validtion event for Cancel","Record Pre-Validtion event for Cancel",""<endrec>
"Pre-Validation","14","15","13518","2572","Withdraw At Agent With Prevalidation for API V2.0","__committerParams.Reason = 'Forward request to backend server directly sync.';
__next = '10a';
__exemode = 'continue';","10","Forward request  to backend server directly","Forward request  to backend server directly",""<endrec>
"Pre-Validation","","16","13519","2572","Withdraw At Agent With Prevalidation for API V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
   __params.CurResp= __input.lastCommitResult.result;
   __next = '12';
   __exemode = 'continue';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","10a","Check transaction final result","Check transaction final result",""<endrec>
"Pre-Validation","15","17","13520","2572","Withdraw At Agent With Prevalidation for API V2.0","__committerParams.ResultCode = '0';
__committerParams.ResultType = '0';
__committerParams.@ResultParam@ResultMsg='You confirm initiate transaction';
__next = 'end';","12","Send Confirm Message to API","Send Confirm Message to API",""<endrec>
"Pre-Validation","","1","13541","2574","Withdraw At Agent With Prevalidation for STK V2.0","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
__next = '1';
__exemode='continue';","begin","set parammeters","",""<endrec>
"Pre-Validation","14","20","13542","2574","Withdraw At Agent With Prevalidation for STK V2.0","__committerParams.Reason = 'Forward request to backend server directly sync.';
__next = 'end';","14","Forward request  to backend server directly","Forward request  to backend server directly",""<endrec>
"Pre-Validation","19","2","13543","2574","Withdraw At Agent With Prevalidation for STK V2.0","__committerParams.IdentifierType = 'Initiator';
__committerParams.Role = '500000000000010001';
__next = '1a';
__exemode = 'continue';","1","Query Notification Msisdn","Query Notification Msisdn",""<endrec>
"Pre-Validation","","3","13544","2574","Withdraw At Agent With Prevalidation for STK V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.notificationList = __input.lastCommitResult.result;
}
__next = '2';
__exemode = 'continue';","1a","Check Notification Msisdn","Check Notification Msisdn",""<endrec>
"Pre-Validation","20","22","13545","2574","Withdraw At Agent With Prevalidation for STK V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Request Failed';
notificationParams .errDesc='Pre-Validation Request Failed';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = 'end';","error","Error occurred","error occurred when executing current flow",""<endrec>
"Pre-Validation","18","23","13546","2574","Withdraw At Agent With Prevalidation for STK V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.errDesc='Pre-Validation confirmation is Timeout';
__committerParams.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
__next = 'timeout';","timeout","Session timeout","current session is timeout",""<endrec>
"Pre-Validation","","6","13547","2574","Withdraw At Agent With Prevalidation for STK V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    __tempData.preValidationResult = __input.lastCommitResult.result;
    __next = '4';
    __exemode = 'continue';
}
else
{
     __next = '12';
    __exemode = 'continue';
}","3a","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"Pre-Validation","92","7","13548","2574","Withdraw At Agent With Prevalidation for STK V2.0","__committerParams.Initiator = 'ReceiverParty';
__committerParams.Receiver = 'Initiator';
__next = '4a';
__exemode = 'continue';","4","Query Identity Name","Query Identity Name",""<endrec>
"Pre-Validation","","4","13549","2574","Withdraw At Agent With Prevalidation for STK V2.0","var needDisplayFeeConfirmation = __input.validateResult.isSucess;
if (needDisplayFeeConfirmation )
{
     __next = '3';
     __exemode = 'continue';
}
else
{
      __next = '14';
      __exemode = 'continue';
}","2","Check needDisplayFeeConfirmation or not","Check needDisplayFeeConfirmation or not","10"<endrec>
"Pre-Validation","17","17","13550","2574","Withdraw At Agent With Prevalidation for STK V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __channelSessionID;

__next = 'end';","11","Record Pre-Validtion event for Cancel","Record Pre-Validtion event for Cancel",""<endrec>
"Pre-Validation","","8","13551","2574","Withdraw At Agent With Prevalidation for STK V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.IdentityInfo = __input.lastCommitResult.result;
    __next = '5';
}
else
{
    __next = 'error';
}
__exemode = 'continue';","4a","Check Identity Name","Check Identity Name",""<endrec>
"Pre-Validation","16","9","13552","2574","Withdraw At Agent With Prevalidation for STK V2.0","__committerParams.Category = 'SendMoneyWithPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.TaxMsgFormat = ':The amount of tax is: %s';
__committerParams.FeeInfo = __tempData.preValidationResult;
__committerParams.IdentityInfo = __tempData.IdentityInfo;
__committerParams.MaskMode = '1';
__next = '6';
__exemode = 'continue';","5","Prepare Confirm Information for Pre-Validation","Prepare Confirm Information for Pre-Validation",""<endrec>
"Pre-Validation","17","19","13553","2574","Withdraw At Agent With Prevalidation for STK V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '0';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Pre-Validation Result is confirmed.  ChannelSessionID=' + __channelSessionID;
__next='end';","13","Record Pre-Validation event log for confirm","Record Pre-Validation event log for confirm",""<endrec>
"Pre-Validation","12","10","13554","2574","Withdraw At Agent With Prevalidation for STK V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    var confirmMsgParam = __input.lastCommitResult.result;
    var confirmMsgFormat = 'you will withdraw %s from Customer %s, Phone number %s. Charge for this transaction is:\n %s. \n1. Yes\n2. No';
    var promptText = Util.formatMessage(confirmMsgFormat, confirmMsgParam.AmountCurrency, confirmMsgParam.ReceiverMaskName, confirmMsgParam.ReceiverMSISDN, confirmMsgParam.FeeInfoMSG);
    var cust =  __tempData.IdentityInfo;

    __committerParams.InterfaceCode = '19';
    __committerParams.put('TransOutgoingRequest@LIST@Param.PromptText', promptText);
    __committerParams.put('TransOutgoingRequest@LIST@Param.MSISDN', __tempData.notificationList[0].recipients);
    __committerParams.put('TransOutgoingRequest@LIST@Param.TransactionID', __channelSessionID);

    __next = '7';
}
else
{
    __next = 'error';
}","6","Send Pre-Validation to Customer","Send Pre-Validation to Customer",""<endrec>
"Pre-Validation","8","5","13555","2574","Withdraw At Agent With Prevalidation for STK V2.0","__next = '3a';
__exemode = 'continue';","3","Calculate Fee for Pre-Validation","Calculate Fee for Pre-Validation",""<endrec>
"Pre-Validation","","13","13556","2574","Withdraw At Agent With Prevalidation for STK V2.0","if (__input.validateResult.isSucess)
{
    __params.errDesc='Pre-Validation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';

    __next = '10';
    __exemode = 'continue';
}
else
{
    __next = '9b';
    __exemode = 'continue';
}","9a","Cancel Transaction 1","Cancel Transaction","10"<endrec>
"Pre-Validation","17","18","13557","2574","Withdraw At Agent With Prevalidation for STK V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Pre-Validation Result is Failed.  ChannelSessionID=' + __channelSessionID;

__next = 'end';","12","Record Pre-Validation for calculate fee failed","Record Pre-Validation for calculate fee failed",""<endrec>
"Pre-Validation","","11","13558","2574","Withdraw At Agent With Prevalidation for STK V2.0","var confirmedOrNot = __input.validateResult.isSucess;
if (confirmedOrNot)
{
     __next = '8';
     __exemode = 'continue';
}
else
{
         __next = '9a';
         __exemode = 'continue';
}","7","Wait for Customer confirmation","Wait for Customer confirmation","10"<endrec>
"Pre-Validation","","21","13559","2574","Withdraw At Agent With Prevalidation for STK V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
   __params.CurResp= __input.lastCommitResult.result;
   __next = '13';
   __exemode = 'continue';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","14a","Check transaction final result","Check transaction final result",""<endrec>
"Pre-Validation","","15","13560","2574","Withdraw At Agent With Prevalidation for STK V2.0","if (__input.validateResult.isSucess)
{
    __next = 'timeout';
    __exemode = 'continue';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","9c","Check comfirm timeout","Check comfirm timeout","10"<endrec>
"Pre-Validation","","1","13581","2576","Withdraw At Agent With Prevalidation for WEB V2.0","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
__next = '1';
__exemode = 'continue';","begin","set parammeters","",""<endrec>
"Pre-Validation","17","18","13582","2576","Withdraw At Agent With Prevalidation for WEB V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __channelSessionID;
__next = 'end';","11","Record Pre-Validtion event for Cancel","Record Pre-Validtion event for Cancel",""<endrec>
"Pre-Validation","19","2","13583","2576","Withdraw At Agent With Prevalidation for WEB V2.0","__committerParams.IdentifierType = 'PrimaryParty';
__committerParams.Role = '500000000000010001';
__next = '1a';
__exemode = 'continue';","1","Query Notification Msisdn","Query Notification Msisdn",""<endrec>
"Pre-Validation","","3","13584","2576","Withdraw At Agent With Prevalidation for WEB V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.notificationList = __input.lastCommitResult.result;
}
__next = '2';
__exemode = 'continue';","1a","Check Notification Msisdn","Check Notification Msisdn",""<endrec>
"Pre-Validation","20","19","13585","2576","Withdraw At Agent With Prevalidation for WEB V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Request Failed';
notificationParams .errDesc='Pre-Validation Request Failed';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = 'error';","error","Error occurred","error occurred when executing current flow",""<endrec>
"Pre-Validation","18","20","13586","2576","Withdraw At Agent With Prevalidation for WEB V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.errDesc='Pre-Validation confirmation is Timeout';
__committerParams.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
__next = 'timeout';","timeout","Session timeout","current session is timeout",""<endrec>
"Pre-Validation","","6","13587","2576","Withdraw At Agent With Prevalidation for WEB V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    __params.CurResp= __input.lastCommitResult.result;
    __next = '4';
    __exemode = 'continue';
}
else
{
     __next = 'error';
    __exemode = 'continue';
}","3a","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"Pre-Validation","","8","13588","2576","Withdraw At Agent With Prevalidation for WEB V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.IdentityInfo = __input.lastCommitResult.result;
}

__next = '5';
__exemode = 'continue';","4a","Check Identity Name","Check Identity Name",""<endrec>
"Pre-Validation","","4","13589","2576","Withdraw At Agent With Prevalidation for WEB V2.0","var isNeedPrevalidation = __input.validateResult.isSucess;
if (isNeedPrevalidation)
{
     __next = '3';
     __exemode = 'continue';
}
else
{
      __next = '8';
      __exemode = 'continue';
}","2","Check Pre-validation or not","Check Pre-validation or not","10"<endrec>
"Pre-Validation","92","7","13590","2576","Withdraw At Agent With Prevalidation for WEB V2.0","__committerParams.Initiator = 'Initiator';
__committerParams.Receiver = 'PrimaryParty';
__next = '4a';
__exemode = 'continue';","4","Query Identity Name","Query Identity Name",""<endrec>
"Pre-Validation","16","9","13591","2576","Withdraw At Agent With Prevalidation for WEB V2.0","__committerParams.Category = 'PrevalidationForWeb';
__committerParams.IdentityInfo = __input.lastCommitResult.result;
__committerParams.MaskMode = '1';
__next = '6';
__exemode = 'continue';","5","Prepare Confirm Information for Pre-Validation","Prepare Confirm Information for Pre-Validation",""<endrec>
"Pre-Validation","","10","13592","2576","Withdraw At Agent With Prevalidation for WEB V2.0","if(__input.lastCommitResult.isSucess)
{
    var params= __input.lastCommitResult.result;
    var tips = 'You will withdraw '+params.AmountCurrency+'from '+ params.ReceiverMaskName+' ,phone number '+params.ReceiverMSISDN;
    var respParams = Util.createMap();
    respParams.put('CalculateFeeResponse.tips',tips);
    __params.ResponseParams = respParams;
    __next = '7';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","6","Put Pre-validation Result to Response","Put Pre-validation Result to Response",""<endrec>
"Pre-Validation","","11","13593","2576","Withdraw At Agent With Prevalidation for WEB V2.0","__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

var confirmedOrNot = __input.validateResult.isSucess;
if (confirmedOrNot)
{
     __params.ResultType = '0';
     __next = '8';
     __exemode = 'continue';
}
else
{
      __next = '9a';
      __exemode = 'continue';
}","7","Check Comfirm Result","Check Comfirm Result","10"<endrec>
"Pre-Validation","14","12","13594","2576","Withdraw At Agent With Prevalidation for WEB V2.0","__next = '8a';
__exemode='continue';","8","Forward request  to backend server","Forward request  to backend server",""<endrec>
"Pre-Validation","22","5","13595","2576","Withdraw At Agent With Prevalidation for WEB V2.0","__next = '3a';
__exemode = 'continue';","3","Calculate Fee for Pre-Validation","Calculate Fee for Pre-Validation",""<endrec>
"Pre-Validation","","13","13596","2576","Withdraw At Agent With Prevalidation for WEB V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
   __params.CurResp= __input.lastCommitResult.result;
   __next = 'end';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","8a","Check transaction final result","Check transaction final result",""<endrec>
"Pre-Validation","","14","13597","2576","Withdraw At Agent With Prevalidation for WEB V2.0","if (__input.validateResult.isSucess)
{
    __params.errDesc='Pre-Validation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';

    __next = '10';
    __exemode = 'continue';
}
else
{
    __next = '9b';
    __exemode = 'continue';
}","9a","Cancel Transaction 1","Cancel Transaction 1","10"<endrec>
"Pre-Validation","","15","13598","2576","Withdraw At Agent With Prevalidation for WEB V2.0","if (__input.validateResult.isSucess)
{
    __params.errDesc='Pre-Validation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';

    __next = '10';
    __exemode = 'continue';
}
else
{
    __next = '9c';
    __exemode = 'continue';
}","9b","Cancel Transaction 2","Cancel Transaction 2","10"<endrec>
"Pre-Validation","","16","13599","2576","Withdraw At Agent With Prevalidation for WEB V2.0","if (__input.validateResult.isSucess)
{
    __next = 'timeout';
    __exemode = 'continue';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","9c","Check comfirm timeout","Check comfirm timeout","10"<endrec>
"Pre-Validation","20","17","13600","2576","Withdraw At Agent With Prevalidation for WEB V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = '11';
__exemode = 'continue';","10","Send Cancel Notification","Send Cancel Notification",""<endrec>
"Pre-Validation","20","16","13601","2574","Withdraw At Agent With Prevalidation for STK V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = '11';
__exemode = 'continue';","10","Send Cancel Notification","Send Cancel Notification",""<endrec>
"Pre-Validation","14","12","13602","2574","Withdraw At Agent With Prevalidation for STK V2.0","__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';

__next = '14a';
__exemode = 'continue';","8","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","14","13603","2574","Withdraw At Agent With Prevalidation for STK V2.0","if (__input.validateResult.isSucess)
{
    __params.errDesc='Pre-Validation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';

    __next = '10';
    __exemode = 'continue';
}
else
{
    __next = '9c';
    __exemode = 'continue';
}","9b","Cancel Transaction 2","Cancel Transaction 2","10"<endrec>
"CUSTOMER","","25","13615","2267","Add Group Member V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess)
{
   __params.OperationType= input ;
   if (input == '1')
   {
      __next = '9';
   }else if (input == '2') {
      sendNotificationfor='reject';
      __exemode='continue';
      __next='8b0';      
   }
}
else {
   __next = '8';
}","8","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__tempData.promptMsg}<br>
${__tempData.tips}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","1","13616","2580","KCB Activate Account","__params.ServiceCode = __service.serviceCode;
__params.ActionType ='ActiveFSIProducts';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* ShortCode*/
__params.ReceiverPartyIdentifier = msisdn;
__params.OrgShortCode = '10239';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13617","2580","KCB Activate Account","var input = __input.response;
__params.@HEAD@PIN = input;
__next = 'end';
__endmsg='Your request was sent for processing. Wait for KCB to reply with an SMS for confirmation.';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","48","14","13621","2267","Add Group Member V2.0","__committerParams.SystemParamCode='SUPPORT_CNS_USSD_PUSH';
__next='6b';
__exemode='continue';","6a","Query isSupportCNS","Query isSupportCNS",""<endrec>
"CUSTOMER","","1","13622","2582","KCB Deposit","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '10239';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Deposit';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13623","2582","KCB Deposit","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13624","2582","KCB Deposit","var input = __input.response;
__params.PIN = input;
__next = 'end';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","13625","2267","Add Group Member V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.isSupportCNS =__input.lastCommitResult.result=='1';
    __next='6c';
    __exemode='continue';
}else{
   __errormsg = 'Sorry,check isSupportCustomerNameSearch faild.';
   __next = 'error';
}","6b","Get isSupportCNS","Get isSupportCNS",""<endrec>
"CUSTOMER","81","16","13626","2267","Add Group Member V2.0","__committerParams.InitiatorIdentifier = __params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__committerParams.ReceiverPartyIdentifier= __params.ReceiverPartyIdentifier;
__committerParams.ReceiverPartyIdentifierType=__params.ReceiverPartyIdentifierType;
__next='6d';
__exemode='continue';","6c","Query Identity Name","Query Identity Name",""<endrec>
"CUSTOMER","","17","13627","2267","Add Group Member V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.cust =__input.lastCommitResult.result;
    __exemode='continue';
    __next='7a';
}else{
   __errormsg = 'Sorry,error occured when querying identity info.';
   __next = 'error';
}","6d","Check Identity Name","Check Identity Name",""<endrec>
"CUSTOMER","","20","13630","2267","Add Group Member V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
__params.IsCNSDataDisplayed = 'false';
__tempData.notificationParams= Util.createMap();
if(isSuccess){
   if(input == '1'){
       if(__tempData.isSupportCNS==false || __tempData.cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01'){
          __next='9';
        }else{
          __next='7c';
          __exemode='continue';
        }
   }else{
      __next = '9';
   }
}else{
   __next='7';
}","7","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","77","18","13631","2267","Add Group Member V2.0","__committerParams.IdentityType = __IdentityInfo.identityType;
__committerParams.Identifier = __msisdn;
__committerParams.IdentifierType = '01';
__committerParams.queryType = 0;
__next='7b';
__exemode='continue';","7a","Query Notification recipientList","Query Notification recipientList",""<endrec>
"CUSTOMER","","19","13632","2267","Add Group Member V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.recipientList= __input.lastCommitResult.result;
    __next='7';
}else{
   __errormsg = 'Sorry,query recipientList failed.';
   __next = 'error';
}","7b","Get Notification recipientList","Get Notification recipientList",""<endrec>
"CUSTOMER","76","21","13633","2267","Add Group Member V2.0","__next='7d';
__exemode='continue';","7c","Calculate PreValidation Fee","Calculate PreValidation Fee",""<endrec>
"CUSTOMER","","22","13634","2267","Add Group Member V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.budgetMap =__input.lastCommitResult.result;
   if(empty(__tempData.budgetMap)){
       __errormsg = 'budget map is empty.';
       __next = 'error';
   }else{   
       __next = '8a0';
       __exemode='continue';
   }
}else{
   __errormsg = 'Pre-Validation is failed,Please check notification.';
   __tempData.notificationParams.TransactionUMCPreValidationEvent='Failed';
   __tempData.notificationParams.TransactionUMCPreValidationError=__input.lastCommitResult.errorMessage;
   __tempData.notificationParams.put('Common.Result.ErrorCode','TS28009');
   __tempData.notificationParams.errDesc='Pre-Validation Failed.';
   if (empty(__tempData.recipientList)) {
     __errormsg = 'The recipient is null and send notification failed.';
     __next='error';
   } else {
      __next = '11a';
      __exemode='continue';
   }
}","7d","Get PreValidation Result","Get PreValidation Result",""<endrec>
"CUSTOMER","80","23","13635","2267","Add Group Member V2.0","__committerParams.Category = 'PayBillPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.TaxMsgFormat = ':The amount of tax is: %s';
__committerParams.ItemSeperator = '<br>';
__committerParams.ShowPublicName = true;
__committerParams.FeeInfo = __tempData.budgetMap;
__next='8a1';
__exemode='continue';","8a0","Prepare Confirm Messsage","Prepare Confirm Messsage",""<endrec>
"CUSTOMER","","24","13636","2267","Add Group Member V2.0","if (__input.lastCommitResult.isSucess)
{
      __tempData.promptMsg =  __input.lastCommitResult.result.FeeInfoMSG;
     var tips = '';
   initiatorCNSStatus=__tempData.cust['initiatorCNSStatus'];
   receiverCNSStatus=__tempData.cust['receiverCNSStatus'];
    __params.put('InitiatorCNSStatus',initiatorCNSStatus);
    __params.put('ReceiverCNSStatus',receiverCNSStatus);
    if(initiatorCNSStatus!=null and initiatorCNSStatus['initiatorFlag']!=null and initiatorCNSStatus['initiatorFlag']['fieldValue'] == '01' and initiatorCNSStatus['initiatorBlock']!=null and initiatorCNSStatus['initiatorBlock']['fieldValue'] == '02')
   {
      if(__tempData.cust['subType']== '1000')
      {
        tips = tips  + 'the received customer is unregistered.'+ '<br>';
      } else if(receiverCNSStatus!=null and receiverCNSStatus['receiverFlag']!=null and receiverCNSStatus['receiverFlag']['fieldValue'] == '01' and receiverCNSStatus['receiverBlock']!=null and receiverCNSStatus['receiverBlock']['fieldValue'] == '02')
     {
        nameStr=Util.maskIdentityName(__tempData.cust['firstName'],__tempData.cust['middleName'],__tempData.cust['lastName']);
        tips = tips + 'Customer name : ' + nameStr + '<br>';
        if(nameStr != ''){
          __params.IsCNSDataDisplayed = 'Yes';
        }
      }
    }
    tips = tips + 'Phone number : ' +__tempData.cust['basicIdentifier'];
    __tempData.tips=tips;
   __next='8';
}else{
   __next = 'error';
}","8a1","Check Confirm Messsage","Check Confirm Messsage",""<endrec>
"CUSTOMER","82","26","13637","2267","Add Group Member V2.0","__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
   __committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
   __next='8b1';
   __exemode='continue';","8b0","CNS cancel process","CNS cancel process",""<endrec>
"CUSTOMER","","27","13638","2267","Add Group Member V2.0","if (__input.lastCommitResult.isSucess)
{
  __params.EventType=""PRE_VALIDATION"";
  __params.errDesc='Pre-Validation Result is Rejected.';
  __params.Reason=""Rejected"";
  __errormsg = 'You have chosed to reject transation,Please check notification.';
  __next='10a1';
  __exemode='continue';
}else{
   __errormsg = 'Sorry,cns cancelation Process failed.';
   __next = 'error';
}","8b1","Check cns cancelation","Check cns cancelation",""<endrec>
"CUSTOMER","83","29","13639","2267","Add Group Member V2.0","__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
 __committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
__next='9a1';
__exemode='continue';","9a0","cns Confirm Process","cns Confirm Process",""<endrec>
"CUSTOMER","","30","13640","2267","Add Group Member V2.0","if (__input.lastCommitResult.isSucess)
{
    __next='10a';
    __exemode='continue';
}else{
   __errormsg = 'Sorry,error occured when processing CNS Cancelation.';
   __next = 'error';
}","9a1","check cns Confirm Process","check cns Confirm Process",""<endrec>
"CUSTOMER","78","31","13641","2267","Add Group Member V2.0","__committerParams.EventType=__params.EventType;
__committerParams.Channel =  __params.Channel;
__committerParams.ResultCode ='0';
__committerParams.ResultType='1';
__committerParams.Reason = 'Continue Pre-Validation Transaction.  ChannelSessionID=' + __sessionID;
previousSavingLog='continue';
__next='10b';
__exemode='continue';","10a","Saving PreValidation Event Log","Saving PreValidation Event Log",""<endrec>
"CUSTOMER","","1","13645","2585","KCB Withdraw","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '10239';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13646","2585","KCB Withdraw","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13647","2585","KCB Withdraw","var input = __input.response;
__params.PIN = input;
__next = 'end';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","78","32","13648","2267","Add Group Member V2.0","__committerParams.EventType=__params.EventType;
__committerParams.Channel =  __params.Channel;
__committerParams.ResultCode ='1';
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __sessionID;
previousSavingLog='rejected';
__next='10b';
__exemode='continue';","10a1","Saving PreValidation Event Log for Reject","Saving PreValidation Event Log for Reject",""<endrec>
"CUSTOMER","","33","13649","2267","Add Group Member V2.0","if (__input.lastCommitResult.isSucess)
{
   if(previousSavingLog=='rejected'){
    __tempData.notificationParams.TransactionUMCPreValidationEvent='Rejected';
     __tempData.notificationParams.TransactionUMCPreValidationError='Choosing Reject';
     __tempData.notificationParams.put('Common.Result.ErrorCode','TS28009');
     __tempData.notificationParams.errDesc='Pre-Validation Result is Rejected.';
      if (empty(__tempData.recipientList)) {
       __errormsg = 'The recipient is null and send notification failed.';
       __next='error';
     } else {
       __next='11a';
       __exemode='continue';
     }
   }else{
       __next = 'end';
   }
}else{
   __errormsg = 'Sorry,saved pre-validation event log failed';
   __next = 'error';
}","10b","Check Saving PreValidation Event Log","Check Saving PreValidation Event Log",""<endrec>
"CUSTOMER","79","34","13650","2267","Add Group Member V2.0","__committerParams.notificationParams = __tempData.notificationParams;
__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.recipientList;
__committerParams.Channel = __params.Channel;
__next='11b';
__exemode='continue';","11a","send PreValidation Notification","send PreValidation Notification",""<endrec>
"CUSTOMER","","35","13651","2267","Add Group Member V2.0","if (__input.lastCommitResult.isSucess)
{
   if(__tempData.notificationParams.TransactionUMCPreValidationEvent=='Failed'){
       __next='error';
   }else if(previousSavingLog=='rejected'){
       if(sendNotificationfor=='cancel'){
          __next = 'cancel';
       }else{
          __next='error';
       }
   }
}else{
   __errormsg = 'Sorry,send pre-validation notification failed.';
   __next = 'error';
}","11b","Check sending Pre-validation Notification","Check sending Pre-validation Notification",""<endrec>
"CUSTOMER","","1","13656","2594","KCB Target Deposit Savings","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '10239';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Deposit';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13657","2594","KCB Target Deposit Savings","var input = __input.response;
if (input == '1') {
  __params.TOPUP_ACCOUNT = ""Vooma"";
  __next = '2';
} else if (input == '2') {
  __params.TOPUP_ACCOUNT = ""Mpesa"";
  __next = '2';
} else {
  __next = '1';
}","1","Select Vooma or MPESA","<html>
<body>
Please Select:<br>
  1 Vooma<br>
  2 MPESA<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13658","2594","KCB Target Deposit Savings","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '3';
} else {
    __next = '2';
}","2","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","13659","2594","KCB Target Deposit Savings","var input = __input.response;
__params.PIN = input;
__next = 'end';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","13662","2596","KCB Target Deposit Close","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '10239';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13663","2596","KCB Target Deposit Close","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","13668","2599","KCB Target First Deposit Savings","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '10239';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Deposit';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13669","2599","KCB Target First Deposit Savings","var input = __input.response;
if (Validator.isAmount(input) && !empty(input)) {
    __params.TARGET_AMOUNT= TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Target Amount","<html>
<body>
Enter Target Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13670","2599","KCB Target First Deposit Savings","var input = __input.response;
if (Validator.isDigit(input) && !empty(input)){
    __params.TERM= input;
    __secure = true;
    __next = '3';
} else {
    __next = '2';
}","2","Period(Month)","<html>
<body>
Period(Month)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","13671","2599","KCB Target First Deposit Savings","var input = __input.response;
__params.PIN = input;
__next = 'end';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","13676","2599","KCB Target First Deposit Savings","var input = __input.response;
if (Validator.isAmount(input) && !empty(input)) {
    __params.Amount= TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","13697","2606","M-Shwari Pay LoanCopy","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Repayment';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13698","2606","M-Shwari Pay LoanCopy","var input = __input.response;
if (Validator.isAmount(input)) {
    __referenceData.RequestBalance = TC.convertAmountFormat(input);
__params.Amount = __referenceData.RequestBalance;
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13699","2606","M-Shwari Pay LoanCopy","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","13700","2606","M-Shwari Pay LoanCopy","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Pay ${__params.Amount} loans?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","68","4","13705","2271","Apply Ticket Voucher V2.0","__next='3b';
__exemode='continue';","3a","Query Secret Code Rule","Query Secret Code Rule",""<endrec>
"CUSTOMER","","5","13706","2271","Apply Ticket Voucher V2.0","if (__input.lastCommitResult.isSucess)
{
    secretCodeRule =__input.lastCommitResult.result;
    __tempData.minLength = secretCodeRule.getMinLength();
    __tempData.maxLength = secretCodeRule.getMaxLength();
    __tempData.rule = secretCodeRule.getRule();
    __next = '3';
}else{
   __errormsg = 'Sorry,error occured when querying Secret Code Rule.';
   __next = 'error';
}","3b","get Secret Code Rule","get Secret Code Rule",""<endrec>
"CUSTOMER","65","8","13707","2272","Approval Group Transaction V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__committerParams.OrderID=__params.OrderID;
__committerParams.GroupCode=__params.GroupCode;
__next='4b';
__exemode='continue';","4a","Query Approval Info","Query Approval Info",""<endrec>
"CUSTOMER","","9","13708","2272","Approval Group Transaction V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.ApprovalInfo=__input.lastCommitResult.result;
   if(empty(__tempData.ApprovalInfo)){
       __errormsg = 'Approval Info is empty.';
       __next = 'error';
   }else {
       __tempData.amount=__tempData.ApprovalInfo.amount;
       if (!empty(__tempData.amount)) {
            __next = '5a';
       } else {
            __next = '5b';
       }
   }
}else{
   __errormsg = 'Sorry,query Approval Info failed.';
   __next = 'error';
}","4b","Check Approval Info","Check Approval Info",""<endrec>
"CUSTOMER","","18","13709","2296","Create Group Bundle V2.0","if (__input.lastCommitResult.isSucess)
{
   __params.BundleInfo = __input.lastCommitResult.result;
   __next='10';
}else{
   __errormsg = 'Sorry,Build Bundle Info failed.';
   __next = 'error';
}","9a","Get Bundle Info","Get Bundle Info",""<endrec>
"CUSTOMER","","1","13710","2608","KCB Activate AccountCopy","__params.ServiceCode = __service.serviceCode;
__params.ActionType ='ActiveFSIProducts';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* ShortCode*/
__params.ReceiverPartyIdentifier = msisdn;
__params.OrgShortCode = '10239';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13711","2608","KCB Activate AccountCopy","var input = __input.response;
__params.@HEAD@PIN = input;
__next = 'end';
__endmsg='Your request was sent for processing. Wait for KCB to reply with an SMS for confirmation.';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","13712","2609","KCB Fix First Deposit Savings","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '10239';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Deposit';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13713","2609","KCB Fix First Deposit Savings","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount= TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13714","2609","KCB Fix First Deposit Savings","var input = __input.response;
if ((!empty(input)) && Validator.isDigit(input)){
    __params.TERM= input;
    __secure = true;
    __next = '3';
} else {
    __next = '2';
}","2","Period(Month)","<html>
<body>
Period(Month)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","13715","2609","KCB Fix First Deposit Savings","var input = __input.response;
if ((!empty(input)) &&Validator.isDigit(input)){ 
	if (input == '1') {
	  __params.INITIAL_AMOUNT_SOURCE= 'Vooma';
	  __next = '4';
	} else {
	  __next = '3';
	}
} else {
    __next = '3';
}","3","Select Amount Source","<html>
<body>
Please Select:<br>
  1 Vooma<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","13716","2609","KCB Fix First Deposit Savings","var input = __input.response;
__params.PIN = input;
__next = 'end';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","13742","2611","Group Transfer from M-Pesa to Bank V2.0","__params.ServiceCode = __serviceCode;
__params.Channel = __sessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = __msisdn;
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.RequesterIdentifier = __msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* GROUP_CODE*/
__params.ReceiverPartyIdentifierType = '04'; /* SHORT CODE */
__params.TransactionCategory = 'Bank_Card_Service';
__params.TransactionSubCategory = '1';

__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13743","2611","Group Transfer from M-Pesa to Bank V2.0","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input == '2') {
  __next='3a';
        __exemode='continue';
} else {
  __next = '1';
}","1","Select Option For Group","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13744","2611","Group Transfer from M-Pesa to Bank V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
     __params.PrimaryPartyIdentifier= input;
     __next = '4a';
     __exemode='continue';
}else{
    __next = '2';
}","2","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","14"<endrec>
"CUSTOMER","","6","13745","2611","Group Transfer from M-Pesa to Bank V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  group= __tempData.groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier= groupCode;
  __next = '4a';
  __exemode='continue';
}
else{
  __next = '3';
}","3","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: __tempData.groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","9","13746","2611","Group Transfer from M-Pesa to Bank V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
  __params.ShortCode = __tempData.fiOrgList.get(i).shortCode;
  __params.ReceiverPartyIdentifier= __params.ShortCode;
  __params.FIOrgIdentityId = __tempData.fiOrgList.get(i).identityId;
  __next = '5';
} else {
  __next = '4';
}","4","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: __tempData.fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","","10","13747","2611","Group Transfer from M-Pesa to Bank V2.0","var input = __input.response;
if (input == '1') {
  __tempData.identifierTypeName = 'MSISDN';
  __params.BankCardOwnerInputType  = '01';   /* MSISDN */
  __tempData.IdentityType='1000';
  __next = '6';
} else if (input == '2') {
  __tempData.identifierTypeName = 'Organization Short Code';
  __params.BankCardOwnerInputType = '04';   /* SHORT_CODE*/
  __tempData.IdentityType='5000';
  __next = '6';
}else if (input == '3') {
  __tempData.identifierTypeName = 'Group Code';
  __params.BankCardOwnerInputType = '15';   /* GROUP_CODE*/
  __tempData.IdentityType='7000';
  __next = '6';
}  else {
  __next = '5';
}","5","Select Receiver Type","<html>
<body>
Select Receiver Type:<br>
1 Customer <br>
2 Organization <br>
3 Group <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","67","11","13748","2611","Group Transfer from M-Pesa to Bank V2.0","var input = __input.response;
__params.BankCardOwnerInputValue = input;
__committerParams.FIOrgIdentityId=__params.FIOrgIdentityId ;
__committerParams.BankCardOwnerInputType=__params.PrimaryPartyIdentifierType;
__committerParams.IdentityType=__tempData.IdentityType;
__next  = '7a';
__exemode = 'continue';","6","Enter Receiver","<html>
<body>
Enter Receiver ${__tempData.identifierTypeName}<br><a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","13749","2611","Group Transfer from M-Pesa to Bank V2.0","var input = __input.response;
if (input == '1') {
  __tempData.isSelectBankAccount=true;
  __params.QueryIdentifierType = __params.PrimaryPartyIdentifierType;
  __params.QueryIdentifierValue = __params.PrimaryPartyIdentifier;
  __next = '8a';
  __exemode='continue';
} else if (input == '2') {
  __tempData.isSelectBankAccount=false;
  __next = '9';
}else{
  __next = '7';
}","7","Select or Enter Bank Account","<html>
<body>
1 Select form list <br>
${__params.isEnterBankAccount}
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","13750","2611","Group Transfer from M-Pesa to Bank V2.0","var i = Util.toInt(__input.response) - 1;
var isSuccess = __input.validateResult.isSucess;
 if (isSuccess){
   bankLookup=__tempData.bankLookupList.get(i);
   __params.BankCardId= bankLookup.BankCardId;
   __next = '11';
} else {
   __next = '8';
}","8","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankLookup:__tempData.bankLookupList){
 ${index} ${bankLookup.AccountName}/${bankLookup.AccountNumber}<br>
$$ index = index + 1;
$$ }
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","8"<endrec>
"CUSTOMER","50","17","13751","2611","Group Transfer from M-Pesa to Bank V2.0","__params.BankAccountNo= __input.response;
__committerParams.IdentityType ='1000';
__next='10a';
__exemode='continue';","9","Enter Bank Account","<html>
<body>
Enter Bank Account<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","19","13752","2611","Group Transfer from M-Pesa to Bank V2.0","var input = __input.response;
if (!empty(input)) {
__tempData.InfoDetail[__tempData.attrList[__tempData.attrIndex]]= input;
__tempData.attrIndex = __tempData.attrIndex + 1;
if (__tempData.attrIndex < size(__tempData.attrList)){
    __next = '10';
}else{
  __next = '10b';
  __exemode='continue';
}
} else {
  __next = '10';
}","10","Enter Bank Card Attr","<html>
<body>
Enter ${__tempData.attrList[__tempData.attrIndex]}<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","22","13753","2611","Group Transfer from M-Pesa to Bank V2.0","var input = __input.response;
var isSuccess = __input.validateResult.isSucess;
if (isSuccess) {
    __params.Amount =Util.replaceAll(input,',','.');
    __next = '12';
} else {
    __next = '11';
}","11","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","13"<endrec>
"CUSTOMER","","23","13754","2611","Group Transfer from M-Pesa to Bank V2.0","var input = __input.response;
__params.PIN = input;
__next = '13';","12","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","24","13755","2611","Group Transfer from M-Pesa to Bank V2.0","var input = __input.response;
if (!empty(input) and size(input) > 255)
{
    __next = '13';
}
else
{
     __referenceData.Comment2Customer = input;
    __next = '14';
}","13","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","25","13756","2611","Group Transfer from M-Pesa to Bank V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '14';
}","14","Confirm","<html>
<body>
Deposit Amount : ${__params.Amount}<br>
Bank Account : ${__tempData.isSelectBankAccount==false?__params.BankAccountNo:__params.BankCardId}<br>
Reciever : ${__params.ReceiverPartyIdentifier}<br>
1 OK <br>
0 Cancel <br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","4","13757","2611","Group Transfer from M-Pesa to Bank V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='3b';
__exemode='continue';","3a","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","13758","2611","Group Transfer from M-Pesa to Bank V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '3';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","3b","Check Groups","Check Groups",""<endrec>
"CUSTOMER","66","7","13759","2611","Group Transfer from M-Pesa to Bank V2.0","__committerParams.InitiatorIdentifier=__params.InitiatorIdentifier;
__committerParams.InitiatorIdentifierType=__params.InitiatorIdentifierType;
__next  = '4b';
__exemode = 'continue';","4a","Query FI Org","Query FI Org",""<endrec>
"CUSTOMER","","8","13760","2611","Group Transfer from M-Pesa to Bank V2.0","if (__input.lastCommitResult.isSucess)
{
   __tempData.fiOrgList= __input.lastCommitResult.result;
   if (empty(__tempData.fiOrgList) || size(__tempData.fiOrgList) == 0)
   {
      __errormsg = 'Sorry, there is no FI Organization.';
      __next = 'error';
   } else
   {
      __next = '4';
   }
}else{
   __errormsg = 'Sorry,error occured when querying FI Org.';
   __next = 'error';
}","4b","Check FI Org List","Check FI Org List",""<endrec>
"CUSTOMER","","12","13761","2611","Group Transfer from M-Pesa to Bank V2.0","if(__input.lastCommitResult.isSucess)
   {
     var isEnterBankAccount = __input.lastCommitResult.result;
      if (isEnterBankAccount) {
  __params.isEnterBankAccount = '2 Enter bank card <br>';
      } else {
  __params.isEnterBankAccount = '';
     }
    __next = '7';
   } else
   {
    __errormsg = 'Sorry, faild to check is allowed unlinked bank card.';
    __next = 'error'
   }","7a","Check allowUnlinkedBankAccount","Check allowUnlinkedBankAccount",""<endrec>
"CUSTOMER","60","14","13762","2611","Group Transfer from M-Pesa to Bank V2.0","__committerParams.QueryIdentifierType= __params.QueryIdentifierType;
__committerParams.QueryIdentifierValue= __params.QueryIdentifierValue;
__committerParams.BranchOrFIOrgId=__params.FIOrgIdentityId;
__next  = '8b';
__exemode = 'continue';","8a","Query Bank Look Up List","Query Bank Look Up List",""<endrec>
"CUSTOMER","","15","13763","2611","Group Transfer from M-Pesa to Bank V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.bankLookupList=__input.lastCommitResult.result;
   if(empty(__tempData.bankLookupList)|| size(__tempData.bankLookupList)==0){
       __errormsg = 'no current bank LookUpList.';
       __next = 'error';
   }else {
       __next = '8';
   }
}else{
   __errormsg = 'Sorry,error occured when querying bank LookUpList.';
   __next = 'error';
}","8b","Check Bank Look Up List","Check Bank Look Up List",""<endrec>
"CUSTOMER","","18","13764","2611","Group Transfer from M-Pesa to Bank V2.0","if(__input.lastCommitResult.isSucess){
       __tempData.attrList = __input.lastCommitResult.result;
      __tempData.attrIndex= 0;
      if (!empty(__tempData.attrList ) and size(__tempData.attrList )>0) {
        __tempData.InfoDetail= Util.createMap();
  __next = '10';
      } else {
  __next = '11';
     }
} else {
    __errormsg = 'Sorry, faild to check is allowed unlinked bank card.';
    __next = 'error'
}","10a","Check Bank Card Attr List","Check Bank Card Attr List",""<endrec>
"CUSTOMER","56","20","13765","2611","Group Transfer from M-Pesa to Bank V2.0","__committerParams.InfoDetail=  __tempData.InfoDetail;
__next='10c';
__exemode='continue';","10b","Build FI Account Info","Build FI Account Info",""<endrec>
"CUSTOMER","","21","13766","2611","Group Transfer from M-Pesa to Bank V2.0","if (__input.lastCommitResult.isSucess)
{
   __params.FIAccountInfo= __input.lastCommitResult.result;
   if(empty(__params.FIAccountInfo)|| size(__params.FIAccountInfo)==0){
       __errormsg = 'Sorry,Build account info failed.';
       __next = 'error';
   }else {
       __next = '11';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","10c","Check Build Result","Check Build Result",""<endrec>
"CUSTOMER","","2","13767","2607","KCB Pay Loan","var input = __input.response;
if (input == '1') {
  __params.ProductType = '2001';
}
if(input != '2' && input != '1' )
{
__next = '1';
}else
{
 __params.put('TransOutgoingRequest@LIST@Param.Identifier',msisdn);
    __params.put('TransOutgoingRequest@LIST@Param.IdentifierType','01');
    __params.put('TransOutgoingRequest@LIST@Param.BankShortCode',Util.getSysParameter('SHORTCODE_OF_DEFAULT_SAVING_LOAN_SYSTEM'));
    __params.put('TransOutgoingRequest@LIST@Param.MobileNumber',msisdn);
    __params.put('TransOutgoingRequest@LIST@Param.ProductType',__params.ProductType);
	__params.put('TransOutgoingRequest@LIST@Param.ussd','true');
    __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__sessionId);
	    var result=IC.queryLonAccountList(__params,'150');
	if(empty(result) || result.isSuccess != '0'){
		__next='2.0';
	}else
	{		
		loanAccountList = result.loanAccountList;
                  __next = '2';
	}
}","1","Select Product Type","<html>
<body>
Select Product Type:<br>
1 kcb loan product<br>
2 all product<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","13768","2607","KCB Pay Loan","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(loanAccountList)) {
	__params.productType = loanAccountList.get(i).productType;
	__next = '3';
} else {
	__next = '2';
}","2","Select Loan Account","<html>
<body>
Select Loan Account:<br>
$$ var index = 1;
$$ for (loanAccount: loanAccountList) {
  ${index} ${loanAccount.productType} - ${loanAccount.loanAccountName} - ${loanAccount.loanAccount} - ${loanAccount.outstandingAmount} - ${loanAccount.currency}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13769","2607","KCB Pay Loan","__next = '2.0';","2.0","Query Loan Account Error","<html>
<body>
Query customer loan account failed.
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","30","4","13770","2477","M-Shwari Deposit for Group V2.0","__committerParams.MSISDN=__params.InitiatorIdentifier;
__next='2b1';
__exemode='continue';","2b0","Query My Groups","Query My Groups",""<endrec>
"CUSTOMER","","5","13771","2477","M-Shwari Deposit for Group V2.0","if (__input.lastCommitResult.isSucess)
{
    __tempData.groups =__input.lastCommitResult.result;
   if(empty(__tempData.groups)|| size(__tempData.groups)==0){
       __errormsg = 'no current groups.';
       __next = 'error';
   }else {
       __next = '2b';
   }
}else{
   __errormsg = 'Sorry,error occured when querying groups.';
   __next = 'error';
}","2b1","Check Group","Check Group",""<endrec>
"CUSTOMER","","23","13772","2493","Purchase Airtime via m-pesa V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '13b';
}","13b","Confirm2","<html>
<body>
Customer ${__params.RechargedMSISDN} does not exist on the system or is not registered.<br>
To buy airtime of ${__tempData.formatAmount} for ${__params.RechargedMSISDN}  
${__tempData.customerFirstName} 
${__tempData['customerMiddleName']}
${__tempData.customerLastName}, the charge is ${ __tempData['chargeFee']}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","24","13773","2493","Purchase Airtime via m-pesa V2.0","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '13c';
}","13c","Confirm3","<html>
<body>
To buy airtime of ${__tempData.formatAmount} for ${__params.RechargedMSISDN} 
${__tempData.customerFirstName} 
${__tempData['customerMiddleName']}
${__tempData.customerLastName}, the charge is ${ __tempData['chargeFee']}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","13777","2613","Query OD by API","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","13778","2613","Query OD by API","var initiator = CurReq.getIdentifierDef('Initiator');
var pin = CurReq.getValueFromBody('ODQueryRequest.Initiator.SecurityCredential');
newPin = Util.convertMessageToObject(pin);
var resultMap = IC.verifyIdentifierPinAndStatus(CurReq.getIdentifierDef('Initiator'),newPin,'Active',null,CurReq,""true"");
notificationInfoList = IC.queryNotificationMsisdn(OriginalReq, 'Initiator', '500000000000010001');
if (resultMap.ResultCode == 'SYS00000') 
{
	var isActivatedOD = IC.isActivatedOD(initiator.Identifier);
	if (!isActivatedOD) {
  __params.put('Common.Result.ErrorCode','ERR0017');
   __params.ResultCode='0';
    AG.sendNotifyAPIResult(OriginalReq,__params,__sessionId,null); 
		__params.put('Common.Result.ErrorMessage', 'The customer has not activate the OD.');
		NC.sendPreValidationNotification(notificationInfoList, __accessChannel, 103000000000000039, __params);
		__next = 'cancel';
	} else {
		var timestamp = Util.getCurrentTime();
		initiator = CurReq.getIdentifierDef('Initiator');
		var queryType = CurReq.getValueFromBody('ODQueryRequest.QueryType');
		newQueryType = Util.convertMessageToObject(queryType);
		var shortCode = Util.getSysParameter('DEFAULT_OVERDRAFT_ORGANIZATION');
		__params.__sessionId = __sessionId;
		__params.Channel = __accessChannel;
		__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId', __sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.conversationId', __sessionId);

		__params.put('TransOutgoingRequest@LIST@Param.timestamp', timestamp);
		__params.put('TransOutgoingRequest@LIST@Param.identifier', initiator.Identifier);
		__params.put('TransOutgoingRequest@LIST@Param.queryType', newQueryType);
		__params.put('TransOutgoingRequest@LIST@Param.identifierType', '01');
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode', shortCode);
		AG.sendTransOutgoing(CurReq, __params, '130');
		__next = '2';
	}
} else {
	var notificationId = '';
	if (resultMap.ResultCode == 'TP40087') {
		notificationId = '107000000002085041';
	}else if (resultMap.ResultCode == 'TP40113') {
	  notificationId = '107000000002085042';
	}else if (resultMap.ResultCode == 'TP40098') {
	  notificationId = 107000000002085043;
	} else if (resultMap.ResultCode == 'IC40481') {
	    notificationId = '107000000002085040';	
	} else if (resultMap.ResultCode == 'IC40249') {
	   notificationId = '103000000000000039';
	}else {
	 notificationId = 107000000002085043;
	}
	__params.put('Common.Result.ErrorCode',resultMap.ResultCode);
	__params.ResultCode='0';
       NC.sendPreValidationNotification(notificationInfoList, __accessChannel, notificationId, __params);
	AG.sendNotifyAPIResult(OriginalReq,__params,__sessionId,null); 	
	next = 'cancel'; 
}","1","Initiate Transaction","Initiate Transaction",""<endrec>
"Pre-Validation","","3","13779","2613","Query OD by API","var resultCode = CurReq.getValueFromBody('TransactionEventRequest.resultCode');
if(resultCode=='SUC0010'||resultCode=='SUC0011'||resultCode=='SUC0012'||resultCode=='SUC0013'||resultCode=='SUC0014'||resultCode=='SUC0015')
{
var limit= CurReq.getValueFromBody('TransactionEventRequest.limit');
var balance= CurReq.getValueFromBody('TransactionEventRequest.balance');
var principal= CurReq.getValueFromBody('TransactionEventRequest.principal');
var accessFee= CurReq.getValueFromBody('TransactionEventRequest.accessFee');
var interest= CurReq.getValueFromBody('TransactionEventRequest.interest');
var penalty= CurReq.getValueFromBody('TransactionEventRequest.penalty');
var debt= CurReq.getValueFromBody('TransactionEventRequest.debt');
var dueDate= CurReq.getValueFromBody('TransactionEventRequest.dueDate');
var currency= CurReq.getValueFromBody('TransactionEventRequest.currency');
var crbStatus= CurReq.getValueFromBody('TransactionEventRequest.crbStatus');
__params.put('limit',limit);
__params.put('balance',balance);
__params.put('principal',principal);
__params.put('accessFee',accessFee);
__params.put('interest',interest);
__params.put('penalty',penalty);
__params.put('debt',debt);
__params.put('dueDate',dueDate);
__params.put('currency',currency);
__params.put('crbStatus',crbStatus);
AG.sendNotifyAPIResult(OriginalReq,__params,__sessionId,null);
__next='end';
}
else
{


        __params.ResultCode='0';
        __params.put('Common.Result.ErrorCode',resultCode);
        AG.sendNotifyAPIResult(OriginalReq,__params,__sessionId,null); 
        __next='cancel';
}","2","confirmed","confirmed",""<endrec>
"Pre-Validation","","1","13785","2615","Customer Buy Goods With OD API","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
var initiator=CurReq.getIdentifierDef('Initiator');
var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
var currency = CurReq.getValueFromBody('TransactionRequest.Currency');
__params.AmountInfo =  IC.formatAmount(currency, amount);
 
__next = '1';","begin","begin set parammeters","",""<endrec>
"Pre-Validation","","6","13786","2615","Customer Buy Goods With OD API","if(__errorCode == 'UMC64000')
{
	__params.put('Common.Result.ErrorMessage','Pre-Validation confirmation is Timeout');
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,107000000002088075,__params);
	
	__params.errDesc='Pre-Validation Request Failed';
	__params.EventType='PRE_VALIDATION';
	TC.savingPreValidationEventLog(__params);

   __params.ResultCode='0';
	__params.put('Common.Result.ErrorCode','UMC64000');
    AG.sendNotifyAPIResult(OriginalReq,__params,__sessionId,null);
}
__next = 'cancel';","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","2","13787","2615","Customer Buy Goods With OD API","__params.isSimpleCalculateFee = 'true';
__params.isSendCalFeeNotification = 'true';


// Judge the actual debit party
var initiatorIdentifierType = CurReq.getValueFromBody('TransactionRequest.Initiator.IdentifierType');
var initiatorIdentifierTypeName
if(initiatorIdentifierType=='13')
{
    initiatorIdentifierTypeName = 'PrimaryParty'
}else
{
    initiatorIdentifierTypeName = 'Initiator'
}

// Calculate OverDraft Amount, Gather parameters
budgetMap=TC.calculateOverDraftAmount(CurReq,__params,'Initiator',__sessionId);

// If there is error occoured, notify and stop running script
if(budgetMap.isError == '1')
{
    if(budgetMap.resultCode == 'TS28009')
	{
		var tsncParams = Util.buildMap();
		NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,107000000002088075,tsncParams);
	}
	var tsapiParams = Util.buildMap();
	tsapiParams.ResultCode='0';
	tsapiParams.put('Common.Result.ErrorCode',budgetMap.resultCode);
    tsapiParams.errDesc=budgetMap.errorMsg;
    tsapiParams.EventType='PRE_VALIDATION';
    TC.savingPreValidationEventLog(__params);
    AG.sendNotifyAPIResult(OriginalReq,tsapiParams,__sessionId,'0');
	__next = 'end';
}
else
{
	 var isOverDraft = budgetMap.isOverDraft;
	 if(isOverDraft == 'true')
	 {

	  var isActivatedOD = IC.isActivatedOD(CurReq.getValueFromBody('TransactionRequest.Initiator.Identifier'));
             if(!isActivatedOD)
            {
		// Not Activated OD yet
		var notActivatedNCParams = Util.buildMap();
		notActivatedNCParams.put('OverDraft.SendAmount',__params.AmountInfo);
		notActivatedNCParams.put('OverDraft.MMAccountBalance',__params.AccountBalance);
		NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,107000000002088075,notActivatedNCParams);
		
		var apiResultParams = Util.buildMap();
		__params.ResultCode='0';
		apiResultParams.ResultCode=__params.ResultCode;
		__params.put('Common.Result.ErrorCode','TS28009');
		apiResultParams.put('Common.Result.ErrorCode', __params.get('Common.Result.ErrorCode'));
		__params.errDesc='Dear Customer, you have an outstanding overdraft transaction, Please visit a Safaricom shop for assistance.';
		apiResultParams.errDesc=__params.errDesc;
		__params.EventType='PRE_VALIDATION';
		apiResultParams.EventType=__params.EventType;
        TC.savingPreValidationEventLog(__params);
        AG.sendNotifyAPIResult(OriginalReq,apiResultParams,__sessionId,'0');
	        __next='cancel';
			}
			else
			{
             var shortCode = Util.getSysParameter('DEFAULT_OVERDRAFT_ORGANIZATION');
			
				__params.IsUseOD = isOverDraft;
				__params.OverDraftAmount = budgetMap.OverDraftAmount;

                                __params.AccountBalance= budgetMap.AccountBalance;
				__params.put('TransOutgoingRequest@LIST@Param.conversationId', __sessionId);

				__params.put('TransOutgoingRequest@LIST@Param.identifierType', '01');
				__params.put('TransOutgoingRequest@LIST@Param.identifier', CurReq.getValueFromBody('TransactionRequest.Initiator.Identifier'));
				__params.put('TransOutgoingRequest@LIST@Param.identityType', '1000');

				__params.put('TransOutgoingRequest@LIST@Param.ShortCode', shortCode);

				__params.put('TransOutgoingRequest@LIST@Param.transactionAmount',budgetMap.OverDraftAmount);

				__params.put('TransOutgoingRequest@LIST@Param.currency', CurReq.getValueFromBody('TransactionRequest.Currency'));

				AG.sendTransOutgoing(CurReq,__params,'128');
				__next='2'; 
			}
     } 
	 else
     {
       var sufficientNCParams = Util.buildMap();
sufficientNCParams.Charge = budgetMap.ChargeAmount;
sufficientNCParams.currency = CurReq.getValueFromBody('TransactionRequest.Currency');
sufficientNCParams.ResultCode='0';
sufficientNCParams.put('Common.Result.ErrorCode','E0020');
AG.sendNotifyAPIResult(OriginalReq,sufficientNCParams,__sessionId,'1');
__next='4';
     }
}","1","Check Need Use OverDraft","Check Need Use OverDraft",""<endrec>
"Pre-Validation","","3","13788","2615","Customer Buy Goods With OD API","var successOrNot = CurReq.hasValueInBody('TransactionEventRequest.resultCode', 'SUC0000');
if (successOrNot)
{ 
__params.accessFee =  CurReq.getValueFromBody('TransactionEventRequest.accessFee');
__params.interestRate =  CurReq.getValueFromBody('TransactionEventRequest.interestRate');
__params.dueDate =  CurReq.getValueFromBody('TransactionEventRequest.dueDate');
__params.debt =  CurReq.getValueFromBody('TransactionEventRequest.debt');
__params.currency=  CurReq.getValueFromBody('TransactionEventRequest.currency');
__params.transactionID=  CurReq.getValueFromBody('TransactionEventRequest.orderId');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',CurReq.getValueFromBody('TransactionRequest.Initiator.Identifier'));
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
var apiResultParams = Util.buildMap();
apiResultParams.ResultCode='0';
apiResultParams.accessFee = __params.accessFee;
apiResultParams.interestRate = __params.interestRate;
apiResultParams.currency = __params.currency;
apiResultParams.OverDraftAmount = __params.OverDraftAmount;
AG.sendNotifyAPIResult(OriginalReq,apiResultParams,__sessionId,""1"");
__next='3';
}
else
{ 
var resultCode = CurReq.getValueFromBody('TransactionEventRequest.resultCode');
var resultDesc = CurReq.getValueFromBody('TransactionEventRequest.resultDesc');
__params.balance =  CurReq.getValueFromBody('TransactionEventRequest.balance');
var notificationText = '';

if(resultCode == 'ERR0001')
{
var e0001APIParams = Util.buildMap();
e0001APIParams.ResultCode='0';
e0001APIParams.put('Common.Result.ErrorCode','ERR0001');
AG.sendNotifyAPIResult(OriginalReq,e0001APIParams,__sessionId,'0');
var e0001NCParams = Util.buildMap();
e0001NCParams.put('OverDraft.SendAmount',__params.AmountInfo);
e0001NCParams.put('OverDraft.MMAccountBalance',__params.AccountBalance);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,107000000002088075,e0001NCParams);
}
else if(resultCode == 'ERR0002')
{
var e0002APIParams = Util.buildMap();
e0002APIParams.ResultCode='0';
e0002APIParams.put('Common.Result.ErrorCode','ERR0002');
e0002APIParams.currency = CurReq.getValueFromBody('TransactionEventRequest.currency');
e0002APIParams.debt = CurReq.getValueFromBody('TransactionEventRequest.debt');
e0002APIParams.dueDate = CurReq.getValueFromBody('TransactionEventRequest.dueDate');
AG.sendNotifyAPIResult(OriginalReq,e0002APIParams,__sessionId,'0');
var e0002NCParams = Util.buildMap();
e0002NCParams.put('OverDraft.debt', CurReq.getValueFromBody('TransactionEventRequest.debt'));
e0002NCParams.put('OverDraft.dueDate', CurReq.getValueFromBody('TransactionEventRequest.dueDate'));
e0002NCParams.put('OverDraft.SendAmount',__params.AmountInfo);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,107000000002088075,e0002NCParams);
}
else if(resultCode == 'ERR0003')

{
var e0003APIParams = Util.buildMap();
e0003APIParams.ResultCode='0';
e0003APIParams.put('Common.Result.ErrorCode','ERR0003');
AG.sendNotifyAPIResult(OriginalReq,e0003APIParams,__sessionId,'0');
var e0003NCParams = Util.buildMap();
e0003NCParams.put('OverDraft.ODBalance', __params.balance);
e0003NCParams.put('OverDraft.MMAccountBalance', __params.AccountBalance);
e0003NCParams.put('OverDraft.SendAmount',__params.AmountInfo);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,107000000002088075,e0003NCParams);
}
else
{
var e0000APIParams = Util.buildMap();
e0000APIParams.ResultCode='0';
e0000APIParams.put('Common.Result.ErrorCode','ERR0000');
AG.sendNotifyAPIResult(OriginalReq,e0000APIParams,__sessionId,'0');
var e0000NCParams = Util.buildMap();
notificationText =  'Dear Customer, we are unable to process your Okoa M-PESA Opt in request due to some reason.';
e0000NCParams.put('Common.Result.ErrorCode',resultCode);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,107000000002088075,e0000NCParams);
}
TC.savingPreValidationEventLog(__params);
__next='cancel';
}","2","Check ODBalance Result","Check ODBalance Result",""<endrec>
"Pre-Validation","","4","13789","2615","Customer Buy Goods With OD API","var successOrNot = CurReq.hasValueInHeader('TransactionEventRequest.channelSessionId');
 var useOD  = CurReq.getValueFromBody('TransactionRequest.RequestContext.Parameter.UseOD');
if (useOD  == '1' && successOrNot )
{ 
	__params.Reason=""Continue Use OverDraft Transaction."";
	__params.TransactionUMCPreValidationError='Continue Use OverDraft Transaction.';
    __params.CurReqConversationID=CurReq.getParamValue4RequestHeaderConversationID();
    OriginalReq.setParamValue4RequestHeaderMessageId(__params.CurReqConversationID);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.IsUseOD',__params.IsUseOD);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.OverDraftAmount',__params.OverDraftAmount);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.currency',__params.currency);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.debt',__params.debt);
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.transactionID',__params.transactionID);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.dueDate',__params.dueDate);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.accessFee',__params.accessFee);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.interestRate',__params.interestRate);	
	CurResp = TargetService.invokeForScript();

	__next='end';
}
else

{
    __params.errDesc='Use OverDraft Confirmation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Use OverDraft Confirmation Result is Rejected.';
    __params.ResultCode='0';
    __params.put('Common.Result.ErrorCode', 'BCS50327');
    TC.savingPreValidationEventLog(__params);
    __next='cancel';
}","3","Use OverDraft Confirmation","Use OverDraft Confirmation",""<endrec>
"CUSTOMER","","1","13801","2619","KCB Loan Request","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '10239';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_KCB_Loan_Request';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13802","2619","KCB Loan Request","var input = __input.response;
if (Validator.isAmount(input) && !empty(input)) {
    __params.LoanAmount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13803","2619","KCB Loan Request","var input = __input.response;
if (Validator.isDigit(input) && !empty(input)){
    __params.LoanTerm = input;
    __secure = true;
    __next = '3';
} else {
    __next = '2';
}","2","Term(Year)","<html>
<body>
Term(Year)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","13804","2619","KCB Loan Request","var input = __input.response;
__params.PIN = input;
__next = 'end';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","13809","2622","Send Money via m-pesa With Prevalidation for STK V2.0","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
__next = '1';
__exemode='continue';","begin","set parammeters","",""<endrec>
"Pre-Validation","17","22","13810","2622","Send Money via m-pesa With Prevalidation for STK V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __channelSessionID;

__next = 'end';","12","Record Pre-Validtion event for Cancel","Record Pre-Validtion event for Cancel",""<endrec>
"Pre-Validation","19","2","13811","2622","Send Money via m-pesa With Prevalidation for STK V2.0","__committerParams.IdentifierType = 'Initiator';
__committerParams.Role = '500000000000010001';
__next = '1a';
__exemode = 'continue';","1","Query Notification Msisdn","Query Notification Msisdn",""<endrec>
"Pre-Validation","","3","13812","2622","Send Money via m-pesa With Prevalidation for STK V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.notificationList = __input.lastCommitResult.result;
    __next = '2';
    __exemode = 'continue';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","1a","Check Notification Msisdn","Check Notification Msisdn",""<endrec>
"Pre-Validation","20","23","13813","2622","Send Money via m-pesa With Prevalidation for STK V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Request Failed';
notificationParams .errDesc='Pre-Validation Request Failed';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = 'error';","error","Error occurred","error occurred when executing current flow",""<endrec>
"Pre-Validation","18","24","13814","2622","Send Money via m-pesa With Prevalidation for STK V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.errDesc='Pre-Validation confirmation is Timeout';
__committerParams.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
__next = 'timeout';","timeout","Session timeout","current session is timeout",""<endrec>
"Pre-Validation","92","4","13815","2622","Send Money via m-pesa With Prevalidation for STK V2.0","__committerParams.Initiator = 'Initiator';
__committerParams.Receiver = 'ReceiverParty';
__next = '2a';
__exemode = 'continue';","2","Query Identity Name","Query Identity Name",""<endrec>
"Pre-Validation","21","5","13816","2622","Send Money via m-pesa With Prevalidation for STK V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.IdentityInfo = __input.lastCommitResult.result;
}
__committerParams.SystemParamCode = 'SUPPORT_CNS_USSD_PUSH';
__next = '2c';
__exemode = 'continue';","2a","Check Identity Name","Check Identity Name",""<endrec>
"Pre-Validation","","6","13817","2622","Send Money via m-pesa With Prevalidation for STK V2.0","var isSupportCustomerNameSearch = __input.lastCommitResult.result;
var cust = __tempData.IdentityInfo;
if(isSupportCustomerNameSearch != '1' || cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01')
{
    __params.put('ResultType','0');
    __params.Reason=""Continue Pre-Validation Transaction."";
    __params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
    __next='2d';
    __exemode = 'continue';
}else
{
    __next='3';
    __exemode = 'continue';
}","2c","Check isSupportCustomerNameSearch","Check isSupportCustomerNameSearch",""<endrec>
"Pre-Validation","91","7","13818","2622","Send Money via m-pesa With Prevalidation for STK V2.0","__committerParams.IdentifierRole= 'Initiator';
__committerParams.IdentifierType = '01';
__next = '8';
__exemode = 'continue';","2d","CNS Comfirmation","CNS Comfirmation",""<endrec>
"Pre-Validation","","8","13819","2622","Send Money via m-pesa With Prevalidation for STK V2.0","var needDisplayFeeConfirmation = __input.validateResult.isSucess;
if (needDisplayFeeConfirmation )
{
     __next = '4';
     __exemode = 'continue';
}
else
{
      __next = '8';
      __exemode = 'continue';
}","3","Check needDisplayFeeConfirmation or not","Check needDisplayFeeConfirmation or not","10"<endrec>
"Pre-Validation","8","9","13820","2622","Send Money via m-pesa With Prevalidation for STK V2.0","__next = '4a';
__exemode = 'continue';","4","Calculate Fee for Pre-Validation","Calculate Fee for Pre-Validation",""<endrec>
"Pre-Validation","","10","13821","2622","Send Money via m-pesa With Prevalidation for STK V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    __tempData.preValidationResult = __input.lastCommitResult.result;
    __next = '5a';
    __exemode = 'continue';
}
else
{
     __next = '5b';
    __exemode = 'continue';
}","4a","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"Pre-Validation","16","11","13822","2622","Send Money via m-pesa With Prevalidation for STK V2.0","var cust = __tempData.IdentityInfo;

__committerParams.Category = 'SendMoneyWithPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.TaxMsgFormat = ':The amount of tax is: %s';
__committerParams.FeeInfo = __tempData.preValidationResult;
__committerParams.IdentityInfo = __tempData.IdentityInfo;

if (cust.initiatorCNSStatus.suspensionFlag.fieldValue == '02')
{
    if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' and cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02'
      && cust.receiverCNSStatus.receiverFlag.fieldValue == '01' and cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
    {
        __committerParams.MaskMode = '0';
    }
}
else
{
    __committerParams.MaskMode = '2';
}
__next = '6';
__exemode = 'continue';","5a","Prepare Confirm Information for Pre-Validation","Prepare Confirm Information for Pre-Validation",""<endrec>
"Pre-Validation","17","12","13823","2622","Send Money via m-pesa With Prevalidation for STK V2.0","__params.errDesc=budgetMap.errorMsg;
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');

__next = 'end';","5b","Record Pre-Validation for calculate fee failed","Record Pre-Validation for calculate fee failed",""<endrec>
"Pre-Validation","12","13","13824","2622","Send Money via m-pesa With Prevalidation for STK V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
    var confirmMsgParam = __input.lastCommitResult.result;
    var confirmMsgFormat = 'you will send %s to Customer %s, Phone number %s. Charge for this transaction is:\n %s.';
    var promptText = Util.formatMessage(confirmMsgFormat, confirmMsgParam.AmountCurrency, confirmMsgParam.ReceiverMaskName, confirmMsgParam.ReceiverMSISDN, confirmMsgParam.FeeInfoMSG);
    var cust =  __tempData.IdentityInfo;

    __committerParams.InterfaceCode = '19';
    __committerParams.put('TransOutgoingRequest@LIST@Param.PromptText', promptText);
    __committerParams.put('TransOutgoingRequest@LIST@Param.MSISDN', __tempData.notificationList[0].recipients);
    __committerParams.put('TransOutgoingRequest@LIST@Param.TransactionID', __channelSessionID);

    __next = '7';
}
else
{
    __next = 'error';
}","6","Send Pre-Validation to Customer","Send Pre-Validation to Customer",""<endrec>
"Pre-Validation","","14","13825","2622","Send Money via m-pesa With Prevalidation for STK V2.0","var confirmedOrNot = __input.validateResult.isSucess;
if (confirmedOrNot)
{
     __next = '8';
     __exemode = 'continue';
}
else
{
         __next = '9a';
         __exemode = 'continue';
}","7","Wait for Customer confirmation","Wait for Customer confirmation","10"<endrec>
"Pre-Validation","14","15","13826","2622","Send Money via m-pesa With Prevalidation for STK V2.0","__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';

__next = '8a';
__exemode = 'continue';","8","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","16","13827","2622","Send Money via m-pesa With Prevalidation for STK V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
   __params.CurResp= __input.lastCommitResult.result;
   __next = 'end';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","8a","Check transaction final result","Check transaction final result",""<endrec>
"Pre-Validation","","17","13828","2622","Send Money via m-pesa With Prevalidation for STK V2.0","if (__input.validateResult.isSucess)
{
    __params.errDesc='Pre-Validation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';

    __next = '10';
    __exemode = 'continue';
}
else
{
    __next = '9b';
    __exemode = 'continue';
}","9a","Cancel Transaction 1","Cancel Transaction","10"<endrec>
"Pre-Validation","","18","13829","2622","Send Money via m-pesa With Prevalidation for STK V2.0","if (__input.validateResult.isSucess)
{
    __params.errDesc='Pre-Validation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';

    __next = '10';
    __exemode = 'continue';
}
else
{
    __next = '9c';
    __exemode = 'continue';
}","9b","Cancel Transaction 2","Cancel Transaction","10"<endrec>
"Pre-Validation","","19","13830","2622","Send Money via m-pesa With Prevalidation for STK V2.0","if (__input.validateResult.isSucess)
{
    __next = 'timeout';
}
else
{
    __next = 'error';
}","9c","Check comfirm timeout","Check comfirm timeout","10"<endrec>
"Pre-Validation","90","20","13831","2622","Send Money via m-pesa With Prevalidation for STK V2.0","__committerParams.IdentifierRole = 'Initiator';
__committerParams.IdentifierType = '01';
__next = '11';
__exemode = 'continue';","10","CNS Cancelation Process","CNS Cancelation Process",""<endrec>
"Pre-Validation","20","21","13832","2622","Send Money via m-pesa With Prevalidation for STK V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = '12';
__exemode = 'continue';","11","Send Cancel Notification","Send Cancel Notification",""<endrec>
"Pre-Validation","","1","13857","2624","Send Money With Prevalidation for API V2.0","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
__next = '1';
__exemode='continue';","begin","set parammeters","",""<endrec>
"Pre-Validation","20","22","13858","2624","Send Money With Prevalidation for API V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='Pre-Validation Request Failed';
notificationParams .errDesc='Pre-Validation Request Failed';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = 'end';","error","Error occurred","error occurred when executing current flow",""<endrec>
"Pre-Validation","19","2","13859","2624","Send Money With Prevalidation for API V2.0","__committerParams.IdentifierType = 'Initiator';
__committerParams.Role = '500000000000010001';
__next = '1a';
__exemode = 'continue';","1","Query Notification Msisdn","Query Notification Msisdn",""<endrec>
"Pre-Validation","","3","13860","2624","Send Money With Prevalidation for API V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.notificationList = __input.lastCommitResult.result;
    __next = '2';
    __exemode = 'continue';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","1a","Check Notification Msisdn","Check Notification Msisdn",""<endrec>
"Pre-Validation","18","23","13861","2624","Send Money With Prevalidation for API V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.errDesc='Pre-Validation confirmation is Timeout';
__committerParams.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
__next = 'end';","timeout","Session timeout","current session is timeout",""<endrec>
"Pre-Validation","15","24","13862","2624","Send Money With Prevalidation for API V2.0","__committerParams.ResultCode = 'TS28009';
__committerParams.@ResultParam@ResultMsg='Pre-Validation Result is Rejected.';
__next = 'end';","cancel","Cancel current request","Cancel current request",""<endrec>
"Pre-Validation","","4","13863","2624","Send Money With Prevalidation for API V2.0","var isNeedPrevalidation = __input.validateResult.isSucess;
if (isNeedPrevalidation)
{
     __next = '3';
     __exemode = 'continue';
}
else
{
      __next = '11';
      __exemode = 'continue';
}","2","Check Pre-validation or not","Check whether need to Pre-validation and confirm with Customer","10"<endrec>
"Pre-Validation","8","5","13864","2624","Send Money With Prevalidation for API V2.0","__next = '4';
__exemode = 'continue';","3","Calculate Fee for Pre-Validation","Calculate Fee for Pre-Validation",""<endrec>
"Pre-Validation","","6","13865","2624","Send Money With Prevalidation for API V2.0","var isSucess = __input.lastCommitResult.isSucess;

if (isSucess)
{
    __tempData.preValidationResult = __input.lastCommitResult.result;
    __next = '4a';
    __exemode = 'continue';
}
else
{
    __tempData.preValidationResult.errorCode = __input.lastCommitResult.errorCode;
    __tempData.preValidationResult.errorMsg = __input.lastCommitResult.errorMessage ;
    __next = '4b';
    __exemode = 'continue';
}","4","Check Pre-Validation Result","Check Pre-Validation Result",""<endrec>
"Pre-Validation","92","7","13866","2624","Send Money With Prevalidation for API V2.0","__committerParams.Initiator = 'Initiator';
__committerParams.Receiver = 'ReceiverParty';
__next = '4c';
__exemode = 'continue';","4a","Query Identity Name","Query Identity Name",""<endrec>
"Pre-Validation","17","8","13867","2624","Send Money With Prevalidation for API V2.0","__committerParams.BudgetResult = '1';
__committerParams.ResultCode = '1';
__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ErrorCode = '2';
__committerParams.ErrorDesc = 'Pre-Validation Request Failed.';
__committerParams.Channel =  __accessChannel;
var realErrorCode = __tempData.preValidationResult.errorCode;
var realErrorMsg = __tempData.preValidationResult.errorMsg;
__committerParams.Reason = 'Failed. Calculate fee failed for channelSessionID=' + __channelSessionID + ', cause: ' + realErrorCode + ',' + realErrorMsg;

__tempData.ResultCode = __tempData.preValidationResult.errorCode;
__tempData.ResultMsg = __tempData.preValidationResult.errorMsg;

__next = '13';
__exemode = 'continue';","4b","Record Pre-Validation for calculate fee failed","Record Pre-Validation for calculate fee failed",""<endrec>
"Pre-Validation","21","9","13868","2624","Send Money With Prevalidation for API V2.0","if(__input.lastCommitResult.isSucess)
{
    __tempData.IdentityInfo = __input.lastCommitResult.result;
}

__committerParams.SystemParamCode = 'SUPPORT_CNS_USSD_PUSH';
__next = '5';
__exemode = 'continue';","4c","Check Identity Name","Check Identity Name",""<endrec>
"Pre-Validation","16","10","13869","2624","Send Money With Prevalidation for API V2.0","__committerParams.Category = 'SendMoneyWithPrevalidation';
__committerParams.ChargeMsgFormat = ':The amount of charge is: %s';
__committerParams.TaxMsgFormat = ':The amount of tax is: %s';
__committerParams.FeeInfo = __tempData.preValidationResult;
__committerParams.IdentityInfo = __tempData.IdentityInfo;

var isSupportCustomerNameSearch = __input.lastCommitResult.result;
var cust = __tempData.IdentityInfo;
if (isSupportCustomerNameSearch == '1' and cust.initiatorCNSStatus.suspensionFlag.fieldValue == '02' and cust.receiverCNSStatus.suspensionFlag.fieldValue == '02')
{
    if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' and cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02'
	 && cust.receiverCNSStatus.receiverFlag.fieldValue == '01' and cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
    {
        __committerParams.MaskMode = '0';
    }
}
else
{
    __committerParams.MaskMode = '2';
}

__next = '6';
__exemode = 'continue';","5","Prepare Confirm Information for Pre-Validation","Prepare Confirm Information for Pre-Validation",""<endrec>
"Pre-Validation","10","11","13870","2624","Send Money With Prevalidation for API V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
   var confirmMsgParam = __input.lastCommitResult.result;
    /*format message*/
    var confirmMsgFormat = 'you will send %s to Customer %s, Phone number %s. Charge for this transaction is:\n %s.';

    __committerParams.@ResultParam@ResultMsg = Util.formatMessage(confirmMsgFormat, confirmMsgParam.AmountCurrency, confirmMsgParam.ReceiverMaskName, confirmMsgParam.ReceiverMSISDN, confirmMsgParam.FeeInfoMSG);
   __committerParams.FeeInfo = __tempData.preValidationResult;

    /*Util.cleanTempData(__tempData, nullpreValidationResult');*/
    __next = '7';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","6","Send Pre-Validation to Customer","Send Pre-Validation to Customer",""<endrec>
"Pre-Validation","","12","13871","2624","Send Money With Prevalidation for API V2.0","var confirmedOrNot = __input.validateResult.isSucess;
if (confirmedOrNot)
{
     __next = '7a';
     __exemode = 'continue';
}
else
{
         __next = '7b';
         __exemode = 'continue';
}","7","Wait for Customer confirmation","Wait for Customer confirmation","10"<endrec>
"Pre-Validation","91","13","13872","2624","Send Money With Prevalidation for API V2.0","__committerParams.IdentifierRole = 'Initiator';
__committerParams.IdentifierType = '01';

__next = '9';
__exemode = 'continue';","7a","CNS Confirmation Process","CNS Confirmation Process",""<endrec>
"Pre-Validation","90","14","13873","2624","Send Money With Prevalidation for API V2.0","__committerParams.IdentifierRole = 'Initiator';
__committerParams.IdentifierType = '01';

__next = '8';
__exemode = 'continue';","7b","CNS Cancelation Process","CNS Cancelation Process",""<endrec>
"Pre-Validation","20","15","13874","2624","Send Money With Prevalidation for API V2.0","var notificationParams = Util.createMap();
notificationParams .TransactionUMCPreValidationEvent='Pre-Validation';
notificationParams .TransactionUMCPreValidationError='You rejected initiate transaction!';
notificationParams .errDesc='Pre-Validation Result is Rejected.';
notificationParams .put('Common.Result.ErrorCode','TS28009');
__committerParams.notificationParams = notificationParams;

__committerParams.notificationTemplate = '101000000000001078';
__committerParams.notificationInfoList = __tempData.notificationList;
__committerParams.Channel = __params.Channel;

__next = '10';
__exemode = 'continue';","8","Send Cancel Notification","Send Cancel Notification",""<endrec>
"Pre-Validation","17","16","13875","2624","Send Money With Prevalidation for API V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '0';
__committerParams.ResultType='1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Continue Pre-Validation Transaction.  ChannelSessionID=' + __channelSessionID;

__next = '11';
__exemode='continue';","9","Record Pre-Validation event log for confirm","Save event log for confirm",""<endrec>
"Pre-Validation","17","17","13876","2624","Send Money With Prevalidation for API V2.0","__committerParams.EventType= 'PRE_VALIDATION';
__committerParams.ResultCode = '1';
__committerParams.Channel =  __accessChannel;
__committerParams.Reason = 'Pre-Validation Result is Rejected.  ChannelSessionID=' + __channelSessionID;

__next = 'cancel';
__exemode='continue';","10","Record Pre-Validtion event for Cancel","Record Pre-Validtion event for Cancel",""<endrec>
"Pre-Validation","14","18","13877","2624","Send Money With Prevalidation for API V2.0","__committerParams.Reason = 'Forward request to backend server directly sync.';
__next = '11a';
__exemode = 'continue';","11","Forward request  to backend server directly","Forward request  to backend server directly",""<endrec>
"Pre-Validation","","19","13878","2624","Send Money With Prevalidation for API V2.0","var isSucess = __input.lastCommitResult.isSucess;
if (isSucess)
{
   __params.CurResp= __input.lastCommitResult.result;
   __next = '12';
   __exemode = 'continue';
}
else
{
    __next = 'error';
    __exemode = 'continue';
}","11a","Check transaction final result","Check transaction final result",""<endrec>
"Pre-Validation","15","20","13879","2624","Send Money With Prevalidation for API V2.0","__committerParams.ResultCode = '0';
__committerParams.ResultType = '0';
__committerParams.@ResultParam@ResultMsg='You confirm initiate transaction';
__next = 'end';","12","Send Confirm APIResult to 3rd","Send Confirm APIResult to 3rd",""<endrec>
"Pre-Validation","15","21","13880","2624","Send Money With Prevalidation for API V2.0","__committerParams.ResultCode = '0';
__committerParams.ResultType = '0';
__committerParams.@ResultParam@ResultMsg='Pre-Validation Failed';
__next = 'end';","13","Send Failed APIResult to 3rd","Send Failed APIResult to 3rd",""<endrec>
"CUSTOMER","","11","13881","1009","Activate customer","var input = __input.response;
__params.KYCInfo = IC.buildCustomerInfo(__params);
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Confirm to Activate?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","6","13910","2258","Customer Buy Goods With OD STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
var resultCode= CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultCode');
var interactionStatus= CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.InteractionStatus');


__params.ResultType=resultType;
__params.ResultCode=resultCode;
__params.IsRecordTransLog='1';
__params.ConfirmedOrNot=confirmedOrNot;
__params.InteractionStatus=interactionStatus;

if (confirmedOrNot || resultType == '1')
{ 
	__params.Reason=""Continue Pre-Validation Transaction."";
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
        TC.savingPreValidationEventLog(__params);
	__next='end';
}
else
{ 
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
               TC.savingPreValidationEventLog(__params);

	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';


                __params.put('ExpiredPolicy','3');
               TC.savingPreValidationEventLog(__params);
	        CurResp = TargetService.invokeForScript(); 
	        __next='end';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
               TC.savingPreValidationEventLog(__params);
	}
        if('3' != __params.get('ExpiredPolicy'))
        {
            var account = IC.queryAccountByIdentifierDef('M-PESA Account','KES',OriginalReq.getIdentifierDef('Initiator'));
			var balance = IC.formatCurrency('KES',account.balance);
            IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
            __params.put('Transaction.Debit.IdentityAccountBalance',balance);
			__params.put('Transaction.FeeInfo.OrgAmount',__params.AmountInfo);
             var notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010028');
	        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,107000000000065047,__params);
         }
	__next='cancel';
 }","5","No Overdraft USSD Push Confirm","No Overdraft USSD Push Confirm",""<endrec>
"TILL","","4","13917","1870","Transfer Loyalty Points","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifierType = '05'; /* OPERATOR_ID*/
  __params.InitiatorIdentifier = input;
  __next = '2';
} else {
  __next = '1a';
}","1a","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","13918","1870","Transfer Loyalty Points","var input = __input.response;
  __params.PointTypeId = input;
  __next = '2';","1.2","Enter Point Type","<html>
<body>
Enter Point Type:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","13928","30301","Customer Send Money With OD API","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
__params.isSimpleCalculateFee = 'true';
__params.isSendCalFeeNotification = 'true';

accessDevice = CurReq.getIdentifierDef('AccessDevice');
initiator = CurReq.getIdentifierDef('Initiator');
receiver = CurReq.getIdentifierDef('ReceiverParty');
var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
currency = CurReq.getValueFromBody('TransactionRequest.Currency');
__params.currency = currency;
__params.AmountInfo =  IC.formatAmount(currency, amount);

__params.LogId=__sessionId;
__params.IsRecordTransLog='0';
__params.IsRecordPreLog='1';

notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
var shortCode = Util.getSysParameter('DEFAULT_OVERDRAFT_ORGANIZATION');
__params.put('TransOutgoingRequest@LIST@Param.conversationId', __sessionId);
__params.put('TransOutgoingRequest@LIST@Param.identifierType', '01');
__params.put('TransOutgoingRequest@LIST@Param.identifier', accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.identityType', '1000');
__params.put('TransOutgoingRequest@LIST@Param.currency', currency);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode', shortCode);

__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
 

__next = '1';","begin","begin set parammeters","",""<endrec>
"Pre-Validation","","7","13929","30301","Customer Send Money With OD API","if(__errorCode == 'UMC64000')
{
	__params.put('Common.Result.ErrorMessage','Pre-Validation confirmation is Timeout');
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,__params);
	
	__params.errDesc='Pre-Validation Request Failed';
	__params.EventType='PRE_VALIDATION';
	TC.savingPreValidationEventLog(__params);

   __params.ResultCode='0';
	__params.put('Common.Result.ErrorCode','UMC64000');
    AG.sendNotifyAPIResult(OriginalReq,__params,__sessionId,null);
}
__next = 'cancel';","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","3","13930","30301","Customer Send Money With OD API","__params.isSimpleCalculateFee = 'true';
__params.isSendCalFeeNotification = 'true';


var initiatorIdentifierType = CurReq.getValueFromBody('TransactionRequest.Initiator.IdentifierType');
var initiatorIdentifierTypeName
if(initiatorIdentifierType=='13')
{
initiatorIdentifierTypeName = 'PrimaryParty'
}else
{
initiatorIdentifierTypeName = 'Initiator'
}


budgetMap=TC.calculateOverDraftAmount(CurReq,__params,initiatorIdentifierTypeName,__sessionId);


if(budgetMap.isError == '1')
{
if(budgetMap.resultCode == 'TS28009')
{
var tsncParams = Util.buildMap();
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,tsncParams);
}
var tsapiParams = Util.buildMap();
tsapiParams.ResultCode='0';
tsapiParams.put('Common.Result.ErrorCode',budgetMap.resultCode);
tsapiParams.errDesc=budgetMap.errorMsg;
tsapiParams.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
AG.sendNotifyAPIResult(OriginalReq,tsapiParams,__sessionId,'0');
__next = 'end';
}
else
{
var isOverDraft = budgetMap.isOverDraft;

if(isOverDraft == 'true')
{

var isActivatedOD = IC.isActivatedOD(CurReq.getValueFromBody('TransactionRequest.'+initiatorIdentifierTypeName+'.Identifier'));

if(!isActivatedOD)
{


var notActivatedNCParams = Util.buildMap();
notActivatedNCParams.put('OverDraft.SendAmount',__params.AmountInfo);
notActivatedNCParams.put('OverDraft.MMAccountBalance',budgetMap.AccountBalance);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,notActivatedNCParams);

var apiResultParams = Util.buildMap();
__params.ResultCode='0';
apiResultParams.ResultCode=__params.ResultCode;
__params.put('Common.Result.ErrorCode','TS28009');
apiResultParams.put('Common.Result.ErrorCode', __params.get('Common.Result.ErrorCode'));
__params.errDesc='Dear Customer, you have an outstanding overdraft transaction, Please visit a Safaricom shop for assistance.';
apiResultParams.errDesc=__params.errDesc;
__params.EventType='PRE_VALIDATION';
apiResultParams.EventType=__params.EventType;
TC.savingPreValidationEventLog(__params);
AG.sendNotifyAPIResult(OriginalReq,apiResultParams,__sessionId,'0');
__next='cancel';
}
else
{

var shortCode = Util.getSysParameter('DEFAULT_OVERDRAFT_ORGANIZATION');
__params.IsUseOD = isOverDraft;
__params.OverDraftAmount = budgetMap.OverDraftAmount;
__params.AccountBalance= budgetMap.AccountBalance;
__params.ChargeAmount = budgetMap.ChargeAmount;
__params.MMBalance = budgetMap.BalanceAmount;
__params.put('TransOutgoingRequest@LIST@Param.conversationId', __sessionId);

__params.put('TransOutgoingRequest@LIST@Param.identifierType', '01');
__params.put('TransOutgoingRequest@LIST@Param.identifier', CurReq.getValueFromBody('TransactionRequest.'+initiatorIdentifierTypeName+'.Identifier'));
__params.put('TransOutgoingRequest@LIST@Param.identityType', '1000');
__params.put('TransOutgoingRequest@LIST@Param.ShortCode', shortCode);
__params.put('TransOutgoingRequest@LIST@Param.transactionAmount',budgetMap.OverDraftAmount);
__params.put('TransOutgoingRequest@LIST@Param.currency', CurReq.getValueFromBody('TransactionRequest.Currency'));

AG.sendTransOutgoing(CurReq,__params,'128');
__next='2'; 
}
} 

else
{
var sufficientNCParams = Util.buildMap();
sufficientNCParams.Charge = budgetMap.ChargeAmount;
sufficientNCParams.currency = CurReq.getValueFromBody('TransactionRequest.Currency');
sufficientNCParams.ResultCode='0';
sufficientNCParams.put('Common.Result.ErrorCode','E0020');
AG.sendNotifyAPIResult(OriginalReq,sufficientNCParams,__sessionId,'1');
__next='4';
}
}","11","Check Need Use OverDraft","Check Need Use OverDraft",""<endrec>
"Pre-Validation","","4","13931","30301","Customer Send Money With OD API","var successOrNot=CurReq.hasValueInBody('TransactionEventRequest.resultCode', 'SUC0000');
if (successOrNot){ __params.accessFee =CurReq.getValueFromBody('TransactionEventRequest.accessFee');
__params.interestRate =CurReq.getValueFromBody('TransactionEventRequest.interestRate');
__params.dueDate =CurReq.getValueFromBody('TransactionEventRequest.dueDate');
__params.debt =CurReq.getValueFromBody('TransactionEventRequest.debt');
__params.currency=CurReq.getValueFromBody('TransactionEventRequest.currency');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',CurReq.getValueFromBody('TransactionRequest.Initiator.Identifier'));
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
__params.balance=CurReq.getValueFromBody('TransactionEventRequest.balance');
var apiResultParams=Util.buildMap();
apiResultParams.ResultCode='0';
apiResultParams.put('Common.Result.ErrorCode','E0020');
apiResultParams.accessFee=__params.accessFee;
apiResultParams.interestRate=__params.interestRate;
apiResultParams.currency=__params.currency;
apiResultParams.OverDraftAmount=__params.OverDraftAmount;
apiResultParams.Charge=__params.ChargeAmount;
AG.sendNotifyAPIResult(OriginalReq,apiResultParams,__sessionId,'1');
__next='3';
}else{ var resultCode=CurReq.getValueFromBody('TransactionEventRequest.resultCode');
var resultDesc=CurReq.getValueFromBody('TransactionEventRequest.resultDesc');
__params.limit =CurReq.getValueFromBody('TransactionEventRequest.limit');

var notificationText='';
if(resultCode == 'ERR0001'){var e1a=Util.buildMap();
e1a.ResultCode='0';
e1a.put('Common.Result.ErrorCode','ERR0001');
e1a.currency=__params.currency;
e1a.Charge=__params.ChargeAmount;
e1a.MMBalance=__params.MMBalance;
AG.sendNotifyAPIResult(OriginalReq,e1a,__sessionId,'0');
var e1n=Util.buildMap();
e1n.put('OverDraft.SendAmount',__params.AmountInfo);
e1n.put('OverDraft.MMAccountBalance',budgetMap.AccountBalance);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,e1n);
}else if(resultCode == 'ERR0002'){var e2a=Util.buildMap();
e2a.ResultCode='0';
e2a.put('Common.Result.ErrorCode','ERR0002');
e2a.currency=__params.currency;
e2a.debt=CurReq.getValueFromBody('TransactionEventRequest.debt');
e2a.dueDate=CurReq.getValueFromBody('TransactionEventRequest.dueDate');
e2a.Charge=__params.ChargeAmount;
AG.sendNotifyAPIResult(OriginalReq,e2a,__sessionId,'0');
var e2n=Util.buildMap();
e2n.put('OverDraft.debt', CurReq.getValueFromBody('TransactionEventRequest.debt'));
e2n.put('OverDraft.dueDate', CurReq.getValueFromBody('TransactionEventRequest.dueDate'));
e2n.put('OverDraft.SendAmount',__params.AmountInfo);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,e2n);
}else if(resultCode == 'ERR0003'){var e3a=Util.buildMap();
e3a.ResultCode='0';
e3a.put('Common.Result.ErrorCode','ERR0003');

e3a.currency=__params.currency;
e3a.balance=CurReq.getValueFromBody('TransactionEventRequest.balance');
e3a.MMBalance=__params.MMBalance;
e3a.Charge=__params.ChargeAmount;
AG.sendNotifyAPIResult(OriginalReq,e3a,__sessionId,'0');
var e3n=Util.buildMap();
e3n.put('OverDraft.ODBalance', __params.balance);
e3n.put('OverDraft.MMAccountBalance', budgetMap.AccountBalance);
e3n.put('OverDraft.SendAmount',__params.AmountInfo);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,e3n);
}else{var e0a=Util.buildMap();
e0a.ResultCode='0';
e0a.put('Common.Result.ErrorCode','ERR0000');
AG.sendNotifyAPIResult(OriginalReq,e0a,__sessionId,'0');
var e0000NCParams=Util.buildMap();
notificationText ='Dear Customer, we are unable to process your Okoa M-PESA Opt in request due to some reason.';
e0000NCParams.put('Common.Result.ErrorCode',resultCode);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,e0000NCParams);
}TC.savingPreValidationEventLog(__params);
__next='cancel';
}","12","Check ODBalance Result","Check ODBalance Result",""<endrec>
"Pre-Validation","","5","13932","30301","Customer Send Money With OD API","var successOrNot = CurReq.hasValueInHeader('TransactionEventRequest.channelSessionId');
var useOD  = CurReq.getValueFromBody('TransactionRequest.RequestContext.Parameter.UseOD');
DEBUG.error('useod',useOD);
DEBUG.error('successOrnot',successOrNot );
if (useOD  == '1' && successOrNot )
{

	__params.Reason=""Continue Use OverDraft Transaction."";
	__params.TransactionUMCPreValidationError='Continue Use OverDraft Transaction.';
    __params.CurReqConversationID=CurReq.getParamValue4RequestHeaderConversationID();
    OriginalReq.setParamValue4RequestHeaderMessageId(__params.CurReqConversationID);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.IsUseOD',__params.IsUseOD);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.OverDraftAmount',__params.OverDraftAmount);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.currency',__params.currency);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.debt',__params.debt);
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.transactionID',__params.transactionID);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.dueDate',__params.dueDate);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.accessFee',__params.accessFee);
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.interestRate',__params.interestRate);

	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.balance',__params.balance);
    OriginalReq.putToBodyForce('TransactionRequest.Initiator.Identifier',OriginalReq.getValueFromBody('TransactionRequest.PrimaryParty.Identifier'));
    OriginalReq.putToBodyForce('TransactionRequest.Initiator.IdentifierType',OriginalReq.getValueFromBody('TransactionRequest.PrimaryParty.IdentifierType'));
OriginalReq.setOrigConversationID(CurReq.getOrigConversationID());    
CurResp = TargetService.invokeForScript();
	__next='end';
}
else
{
    __params.errDesc='Use OverDraft Confirmation Result is Rejected.';
    __params.TransactionUMCPreValidationError='Use OverDraft Confirmation Result is Rejected.';
    __params.ResultCode='0';
    __params.put('Common.Result.ErrorCode', 'BCS50327');
    TC.savingPreValidationEventLog(__params);
    __next='cancel';
}","13","Use OverDraft Confirmation","Use OverDraft Confirmation",""<endrec>
"Pre-Validation","","1","13933","2639","Send Money With Prevalidation STK","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
__params.isSimpleCalculateFee = 'true';
__params.isSendCalFeeNotification = 'true';

accessDevice = CurReq.getIdentifierDef('AccessDevice');
initiator = CurReq.getIdentifierDef('Initiator');
receiver = CurReq.getIdentifierDef('ReceiverParty');
var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
currency = CurReq.getValueFromBody('TransactionRequest.Currency');
__params.currency = currency;
__params.AmountInfo =  IC.formatAmount(currency, amount);

__params.LogId=__sessionId;
__params.IsRecordTransLog='0';
__params.IsRecordPreLog='1';

var shortCode = Util.getSysParameter('DEFAULT_OVERDRAFT_ORGANIZATION');
__params.put('TransOutgoingRequest@LIST@Param.conversationId', __sessionId);
__params.put('TransOutgoingRequest@LIST@Param.identifierType', '01');
__params.put('TransOutgoingRequest@LIST@Param.identifier', accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.identityType', '1000');
__params.put('TransOutgoingRequest@LIST@Param.currency', currency);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode', shortCode);

__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","begin set parammeters","",""<endrec>
"Pre-Validation","","6","13934","2639","Send Money With Prevalidation STK","__params.ResultType='5';
__params.InteractionStatus='2';
__params.IsRecordTransLog='1';

if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
__params.put('ExpiredPolicy','3');
CurResp = TargetService.invokeForScript(); 
__next='end';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
__params.put('Common.Result.ErrorMessage','Pre-Validation Request Failed');
var notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010028');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","2","13935","2639","Send Money With Prevalidation STK","budgetMap=TC.calculateOverDraftAmount(CurReq,__params,'Initiator',__sessionId);
if(budgetMap.isError == '1')
{
   if(budgetMap.ResultCode== 'TS28009')
   {
var tsncParams = Util.buildMap();
		NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,tsncParams);
   __params.errDesc= 'ODCheckBalance failed,There is an outstanding overdraft transaction.';
   __params.EventType='PRE_VALIDATION';
   TC.savingPreValidationEventLog(__params);
   }
   __next = 'end';
}
else
{
   var isOverDraft = budgetMap.isOverDraft;
  if(isOverDraft == 'true')
  { 
   var isActivatedOD = IC.isActivatedOD(accessDevice.identifier);
   if(!isActivatedOD)
   {
var notActivatedNCParams = Util.buildMap();
        	notActivatedNCParams.put('OverDraft.SendAmount',__params.AmountInfo);
        	notActivatedNCParams.put('OverDraft.MMAccountBalance',budgetMap.AccountBalance);
		NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,notActivatedNCParams);
     __next='cancel';
   }
   else
   {
     __params.IsUseOD= isOverDraft;
     __params.OverDraftAmount = budgetMap.OverDraftAmount;

     __params.AccountBalance= budgetMap.AccountBalance;
     __params.put('TransOutgoingRequest@LIST@Param.transactionAmount',budgetMap.OverDraftAmount);
     AG.sendTransOutgoing(CurReq,__params,'128');

     __next='2'; 
   }
 } 
 else 
 {
   if(IC.isSupportCustomerNameSearch())
   {
      var promptText = '';
      var cust = IC.queryIdentityName(initiator,receiver);
      __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
      __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
     if (cust.initiatorCNSStatus.suspensionFlag.fieldValue == '02')
     {
     if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
     {  
        var languageCode = cust.InitiatorLanguageCode;
     if(cust.subType  == '1002')
     {
       if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01'&& cust.receiverCNSStatus.receiverBlock.fieldValue == '02') { promptText = cust.basicIdentifier + '. '  +cust.identityName;}  else { promptText = cust.basicIdentifier + '. '; } if(languageCode == 'sw_KE')  { promptText = promptText + ' atapokea '; }  else  { promptText = promptText + ' will receive '; }
     } 
     else

      { if(languageCode == 'sw_KE') { promptText = 'Nambari ' + cust.basicIdentifier+ ' haijasajiliwa kwa M-PESA. M-PESA itatuma ' ; } else  { promptText = 'Subscriber ' + cust.basicIdentifier+ ' is not registered on M-PESA hence name not found. M-PESA will send ' ; }}
      promptText =  promptText+ __params.AmountInfo;

      var promptPrefix = '. To STOP this transaction, send any letter or number within 25 Seconds.';
      if(languageCode == 'sw_KE') { promptPrefix = '. KUZUIA pesa zisitumwe kimakosa, jibu kwa kubonyeza nambari yoyote na utume ndani ya sekunde 25.'; }
      var promptText = promptText + promptPrefix;
      __params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
      AG.sendTransOutgoing(CurReq,__params,'19');
      TC.savingPreValidationEventLog(__params);
      __next = '4';
     }else { CurResp = TargetService.invokeForScript();  __next='end';  }
     } else{  CurResp = TargetService.invokeForScript();  __next='end'; }         
   }  else  {  CurResp = TargetService.invokeForScript();   __next='end'; }
 }
}","1","Check Need Use OverDraft","Check Need Use OverDraft",""<endrec>
"Pre-Validation","","3","13936","2639","Send Money With Prevalidation STK","var successOrNot = CurReq.hasValueInBody('TransactionEventRequest.resultCode', 'SUC0000');
__params.accessFee =  CurReq.getValueFromBody('TransactionEventRequest.accessFee');
__params.interestRate =  CurReq.getValueFromBody('TransactionEventRequest.interestRate');
__params.dueDate=  CurReq.getValueFromBody('TransactionEventRequest.dueDate');
__params.debt=  CurReq.getValueFromBody('TransactionEventRequest.debt');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.IsUseOD',__params.IsUseOD);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.OverDraftAmount',__params.OverDraftAmount);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.currency',__params.currency);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.debt',__params.debt);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.dueDate',__params.dueDate);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.accessFee',__params.accessFee);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.interestRate',__params.interestRate);	
if (successOrNot)
{ 
    var promptText = 'Failed.Insufficient funds in your M-PESA, you are about to use Ksh ' + __params.OverDraftAmount + ' from M-PESA Overdraw at a fee of Ksh ' + __params.accessFee + ' and  daily maintenance fee ' +__params.interestRate  + '. Press YES to accept and NO to cancel.';
    __params.put('TransOutgoingRequest@LIST@Param.PromptText', promptText);

    __params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
    __params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.CommandID','useOD');
    AG.sendTransOutgoing(CurReq,__params,'19');
	__next='3';
}
else
{ 
	var resultCode = CurReq.getValueFromBody('TransactionEventRequest.resultCode');
	var resultDesc = CurReq.getValueFromBody('TransactionEventRequest.resultDesc');
        __params.limit =  CurReq.getValueFromBody('TransactionEventRequest.limit');
	var notificationText = '';
	if(resultCode == 'ERR0001')
	{
        var e0001NCParams = Util.buildMap();
        e0001NCParams.put('OverDraft.SendAmount',__params.AmountInfo);
        e0001NCParams.put('OverDraft.MMAccountBalance',__params.AccountBalance);
        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,e0001NCParams);
	}
	else if(resultCode == 'ERR0002')
	{
        var e0002NCParams = Util.buildMap();
        e0002NCParams.put('OverDraft.debt', CurReq.getValueFromBody('TransactionEventRequest.debt'));
        e0002NCParams.put('OverDraft.dueDate', CurReq.getValueFromBody('TransactionEventRequest.dueDate'));
        e0002NCParams.put('OverDraft.SendAmount',__params.AmountInfo);
        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,e0002NCParams);
	}

	else if(resultCode == 'ERR0003')
	{
		var e0003NCParams = Util.buildMap();
        e0003NCParams.put('OverDraft.ODBalance', CurReq.getValueFromBody('TransactionEventRequest.balance'));
        e0003NCParams.put('OverDraft.MMAccountBalance', __params.AccountBalance);
        e0003NCParams.put('OverDraft.SendAmount',__params.AmountInfo);
        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,e0003NCParams);
	}
	else
	{
		var e0000NCParams = Util.buildMap();
        notificationText =  'Dear Customer, we are unable to process your Okoa M-PESA Opt in request due to some reason.';
        e0000NCParams.put('Common.Result.ErrorCode',notificationText);
        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,e0000NCParams);
	}
	__params.errDesc= 'ODCheckBalance failed, OD return resultCode:' + resultCode + 'resultDesc:'+ resultDesc;
	__params.EventType='PRE_VALIDATION';
	TC.savingPreValidationEventLog(__params);
	__next='cancel';
}","2","Check ODBalance Result","Check ODBalance Result",""<endrec>
"Pre-Validation","","4","13937","2639","Send Money With Prevalidation STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
if (confirmedOrNot || resultType == '1')
{ 
if(IC.isSupportCustomerNameSearch())
   {
      var promptText = '';
      var cust = IC.queryIdentityName(initiator,receiver);
      __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
      __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
     if (cust.initiatorCNSStatus.suspensionFlag.fieldValue == '02')
     {
     if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
     {  
        var languageCode = cust.InitiatorLanguageCode;
     if(cust.subType  == '1002')
     {
       if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01'&& cust.receiverCNSStatus.receiverBlock.fieldValue == '02') { promptText = cust.basicIdentifier + '. '  +cust.identityName;}  else { promptText = cust.basicIdentifier + '. '; } if(languageCode == 'sw_KE')  { promptText = promptText + ' atapokea '; }  else  { promptText = promptText + ' will receive '; }
     } 
     else
      { if(languageCode == 'sw_KE') { promptText = 'Nambari ' + cust.basicIdentifier+ ' haijasajiliwa kwa M-PESA. M-PESA itatuma ' ; } else  { promptText = 'Subscriber ' + cust.basicIdentifier+ ' is not registered on M-PESA hence name not found. M-PESA will send ' ; }}

      promptText =  promptText+ __params.AmountInfo;
      var promptPrefix = '. To STOP this transaction, send any letter or number within 25 Seconds.';
      if(languageCode == 'sw_KE') { promptPrefix = '. KUZUIA pesa zisitumwe kimakosa, jibu kwa kubonyeza nambari yoyote na utume ndani ya sekunde 25.'; }
      var promptText = promptText + promptPrefix;
      __params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
	  __params.put('TransOutgoingRequest@LIST@Param.CommandID','');
      AG.sendTransOutgoing(CurReq,__params,'19');
      TC.savingPreValidationEventLog(__params);
      __next = '4';
     }else { CurResp = TargetService.invokeForScript();  __next='end';  }
     } else{  CurResp = TargetService.invokeForScript();  __next='end'; }         
   }  else  {  CurResp = TargetService.invokeForScript();   __next='end'; }
}
else
{ 
    var nParams = Util.buildMap();
        nParams.put('OverDraft.MMAccountBalance', budgetMap.AccountBalance);
        nParams.put('OverDraft.SendAmount',__params.AmountInfo);
        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,103000000000000039,nParams);

if(resultType == '2' || resultType == '3')
{
	__params.errDesc='Use OverDraft Confirmation Result is Rejected.';
	__params.TransactionUMCPreValidationError='Use OverDraft Confirmation Result is Rejected.';
    TC.savingPreValidationEventLog(__params);
    __next='cancel';		


}
else if(resultType == '4')
{
	__params.errDesc='Use OverDraft Confirmation Result is Timeout.';
	__params.TransactionUMCPreValidationError='Use OverDraft Confirmation Result is Timeout.';
     TC.savingPreValidationEventLog(__params);
    __next='cancel';		
}
else
{
	__params.errDesc=""Use OverDraft Confirmation Request Failed."";
	__params.TransactionUMCPreValidationError='Use OverDraft Confirmation Request Failed.';
	 TC.savingPreValidationEventLog(__params);
	__next='cancel';
}
}","3","Use OverDraft Confirmation","Use OverDraft Confirmation",""<endrec>
"Pre-Validation","","5","13938","2639","Send Money With Prevalidation STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
var resultCode= CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultCode');
var interactionStatus= CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.InteractionStatus');


__params.ResultType=resultType;
__params.ResultCode=resultCode;
__params.IsRecordTransLog='1';
__params.ConfirmedOrNot=confirmedOrNot;
__params.InteractionStatus=interactionStatus;

if (confirmedOrNot || resultType == '1')
{ 
	__params.Reason=""Continue Pre-Validation Transaction."";
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';


	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
                __params.put('ExpiredPolicy','3');

	        CurResp = TargetService.invokeForScript(); 

	        __next='end';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
        if('3' != __params.get('ExpiredPolicy'))
        {
            var account = IC.queryAccountByIdentifierDef('M-PESA Account','KES',OriginalReq.getIdentifierDef('Initiator'));
			var balance = IC.formatCurrency('KES',account.balance);
            IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
            __params.put('Transaction.Debit.IdentityAccountBalance',balance);
			__params.put('Transaction.FeeInfo.OrgAmount',__params.AmountInfo);
             var notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010028');
	        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,107000000000065047,__params);
         }
	__next='cancel';
 }


TC.savingPreValidationEventLog(__params);","4","Pre-Validataion Result","Pre-Validataion Result",""<endrec>
"Pre-Validation","","7","13947","30301","Customer Send Money With OD API","OriginalReq=CurReq;
CurResp = TargetService.invokeForScript(); 
__next='end';","14","MMSufficient invoke service","MMSufficient invoke service",""<endrec>
"Pre-Validation","","6","13948","2615","Customer Buy Goods With OD API","OriginalReq=CurReq;
CurResp = TargetService.invokeForScript(); 
__next='end';","4","MMSufficient invoke service","MMSufficient invoke service",""<endrec>
"CUSTOMER","","1","13979","1152","KCB Target First Deposit Savings","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '10239';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Deposit';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","13980","1152","KCB Target First Deposit Savings","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.TARGET_AMOUNT= TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Target Amount","<html>
<body>
Enter Target Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","13981","1152","KCB Target First Deposit Savings","var input = __input.response;
if (Validator.isDigit(input)){
    __params.TERM= input;
    __secure = true;
    __next = '3';
} else {
    __next = '2';
}","2","Period(Month)","<html>
<body>
Period(Month)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","13982","1152","KCB Target First Deposit Savings","var input = __input.response;
__params.PIN = input;
__next = 'end';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","1401","1014","Operator change Till Language","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ChangeLanguage';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */ 
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","1402","1014","Operator change Till Language","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(languages)) {
  __params.@BODY@LanguageCode = languages.get(i).toString();
  __next = '2';
} else {
  __next = '1';
}","1","Select Language","<html>
<body>
Language<br>
$$languages = IC.queryAllLanguages();
$$var i = 1;
$$for (lang: languages) {
  ${i} ${lang.getDisplayName(identity.locale)}<br>
  $$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","1403","1014","Operator change Till Language","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';
","2","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","1404","1014","Operator change Till Language","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","1405","1014","Operator change Till Language","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to change Till Language?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","1501","1015","Customer change PIN","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ChangePIN';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__secure = true;
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","1502","1015","Customer change PIN","var input = __input.response;
__params.OldPIN = input;
__params.@HEAD@PIN = input;
__secure = true;
__next = '2';","1","Enter PIN","<html>
<body>
Enter old PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","1503","1015","Customer change PIN","var input = __input.response;
__params.NewPIN = input;
__secure = true;
__next = '4';","3","Enter New PIN","<html>
<body>
Enter New PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","1504","1015","Customer change PIN","var input = __input.response;
if(__params.NewPIN == input)
{
__next = '5';
}
else
{
__next = '3';
}","4","Confirm new PIN","<html>
<body>
Confirm new PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","1505","1015","Customer change PIN","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to change PIN?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","1601","1016","Operator Change PIN","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ChangePIN';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","1602","1016","Operator Change PIN","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '2';
","1","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","1603","1016","Operator Change PIN","var input = __input.response;
__params.OldPIN = input;
__params.@HEAD@PIN = input;
__secure = true;
__next = '3';
","2","Enter old PIN","<html>
<body>
Enter old PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","1604","1016","Operator Change PIN","var input = __input.response;
__params.NewPIN = input;
__secure = true;
__next = '4';","3","Enter New PIN","<html>
<body>
Enter New PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","1605","1016","Operator Change PIN","var input = __input.response;
if(__params.NewPIN == input)
{
__next = '5';
}
else
{
__next = '3';
}","4","Confirm new PIN","<html>
<body>
Confirm new PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","1606","1016","Operator Change PIN","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to Change PIN?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","1701","1017","Operator query cash up statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","1702","1017","Operator query cash up statement","var input = __input.response;
if (Validator.isDate(input, 'yyyyMMddHHmmss')) {
  __params.StartTime = input;
  __next = '2';
} else if (empty(input)) {
  __params.StartTime = Util.getDefaultStartTime();
  __next = '2'; 
} else {
  __next = '1'; 
}
","1","Enter Begin time","<html>
<body>
Enter Begin time.<br>
format YYYYMMDDHHMMSS. The default time is last midnight<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","1703","1017","Operator query cash up statement","var input = __input.response;
if (Validator.isDate(input, 'yyyyMMddHHmmss')) {
  __params.EndTime = input;
  __next = '3';
} else if (empty(input)) {
  __params.EndTime = Util.getDefalutEndTime();
  __next = '3'; 
} else {
  __next = '2';
}","2","Enter End time","<html>
<body>
Enter End time.<br>
format YYYYMMDDHHMMSS. The default time is current time<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","1704","1017","Operator query cash up statement","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';
","3","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","1705","1017","Operator query cash up statement","var input = __input.response;
__params.PIN = input;
__next = '5';
","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","1706","1017","Operator query cash up statement","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}
","5","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","1801","1018","Customer Query an Account Balance via Handset","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","0","5","1803","1018","Customer Query an Account Balance via Handset","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
    __params.PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3a';
}","3","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"CUSTOMER","0","6","1804","1018","Customer Query an Account Balance via Handset","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
    __params.PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3a';
}","3a","Reenter pin","<html>
<body>
Reenter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"CUSTOMER","0","7","1805","1018","Customer Query an Account Balance via Handset","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
$$result = TC.calculateBudget(__params);
$$budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
$$var promptText = '';
$$feeList = budgetMap.fee;
$$if(!empty(feeList)){
$$	   i = 1;
$$	   sizeLen = size(feeList);
$$	  for(fee:feeList)
$$	  {
$$	   promptText = promptText+ 'The amount of charge is '+fee.amount;
$$	 
$$	   if(i < sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$		i = i+1 
$$	  }
$$}
$$   taxList = budgetMap.tax;
$$   if(!empty(taxList)){
$$	   i = 1;
$$	   sizeLen = size(taxList);
$$	  for(tax:taxList)
$$	  {
$$		 if(i ==1 &&  promptText != '')
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$
$$		promptText = promptText
$$	 + 'The amount of tax is '+tax.amount;
$$	   
$$	   if(i <sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   } 
$$	   i = i+1;
$$	  }
$$  }
Confirm to query? <br>
${promptText} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","","4","1904","20212","Operator query balances","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';","3","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","1905","20212","Operator query balances","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","1906","20212","Operator query balances","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","2","1000","Buy Airtime","var input = __input.response;
if (input == '1') {
  __params.RechargedMSISDN = msisdn;
  __next = '3';
} else if (input == '2') {
  __next = '2';
} else {
  __next = '1';
}","1","Select phone","<html>
<body>
Please select phone :<br>
1 My phone<br>
2 Other phone<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","20002","20001","M-Shwari Loan Mini Statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='262626';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Loan_Mini_Statement';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","20003","20001","M-Shwari Loan Mini Statement","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","20009","20204","Customer Intra-Account Transfer m-pesa to m-pesa","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                CurrencyCode =  type;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","2001","1020","Customer query mini statements","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","4","20010","20204","Customer Intra-Account Transfer m-pesa to m-pesa","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.PrimaryAccountNo= type.AccountNo;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose From AccountNo","<html>
<body>
Please select Origin account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","20011","20204","Customer Intra-Account Transfer m-pesa to m-pesa","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.ReceiverAccountNo = type.AccountNo;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Choose To AccountNo","<html>
<body>
Please select Destination account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","20012","20204","Customer Intra-Account Transfer m-pesa to m-pesa","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","20013","20204","Customer Intra-Account Transfer m-pesa to m-pesa","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","6","Confirm","<html>
<body>
Confirm to Intra_Account Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","20014","20013","Customer Intra-Account Transfer Saving to m-pesae","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
CurrencyCode = '';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","20015","20013","Customer Intra-Account Transfer Saving to m-pesae","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                CurrencyCode =  type;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","20016","20013","Customer Intra-Account Transfer Saving to m-pesae","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.PrimaryAccountNo= type.AccountNo;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose From AccountNo","<html>
<body>
Please select Origin account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Savings Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","20017","20013","Customer Intra-Account Transfer Saving to m-pesae","var input = __input.response;
if (Validator.isAmount(input)) {
__params.Amount = TC.convertAmountFormat(input);
__secure = true;
 __next = '2';
}
else {
 __next = '1';
}","1","Input Amount","<html>
<body>Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","20018","20013","Customer Intra-Account Transfer Saving to m-pesae","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.ReceiverAccountNo = type.AccountNo;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Choose To AccountNo","<html>
<body>
Please select Destination account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","20019","20013","Customer Intra-Account Transfer Saving to m-pesae","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","2002","1020","Customer query mini statements","if (empty(accountTypes)) {
  __next = 'error';
} else {
  var input = __input.response;
  var i = Util.toInt(input) - 1;
  if (i >= 0 && i < size(accountTypes)) {
    __params.AccountTypeCode = accountTypes.get(i);
    __secure = true;
    __next = '2';
  } else {
    __next = '1';
  }
}
","1","Select Account Type","<html>
<body>
$$accountTypes = IC.queryAllAccounts(identity.identityType, identity.identityId);
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
    ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20024","20023","Operator Commission payable accounts Transfer via Till","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.PrimaryPartyIdentifierType = '04'; /* SHORT_CODE */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__params.CurrencyCode = 'USD'; 
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","1","20029","20028","Customer Intra-Account Transfer m-pesae  to Saving","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
CurrencyCode = '';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","2003","1020","Customer query mini statements","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","20030","20028","Customer Intra-Account Transfer m-pesae  to Saving","var input = __input.response;
if (Validator.isAmount(input)) {
__params.Amount = TC.convertAmountFormat(input);
__secure = true;
 __next = '2';
}
else {
 __next = '1';
}","1","Input Amount","<html>
<body>Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","20031","20028","Customer Intra-Account Transfer m-pesae  to Saving","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                CurrencyCode =  type;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","20032","20028","Customer Intra-Account Transfer m-pesae  to Saving","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.PrimaryAccountNo= type.AccountNo;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose From AccountNo","<html>
<body>
Please select Origin account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","20033","20023","Operator Commission payable accounts Transfer via Till","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
Move Funds from ${__params.PrimaryPartyIdentifier} to ${__params.ReceiverPartyIdentifier}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","20034","20023","Operator Commission payable accounts Transfer via Till","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20035","20023","Operator Commission payable accounts Transfer via Till","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    if(1 == size(multiAccount)){
        accountType= multiAccount .get(0)
        if('true' == accountType.defaultFlag){
             __next = '6';
        }else{
             __next = '5';
        }
    }else{
   __next = '5';
}
} else {
    __next = '4';
}","4","Enter Amount","<html>
<body>
Enter Amount<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Commission payable',CurrencyCode);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20036","20023","Operator Commission payable accounts Transfer via Till","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '7';","6","Enter Receiver Short Code","<html>
<body>
Enter Receiver Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20037","20023","Operator Commission payable accounts Transfer via Till","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
       var i = Util.toInt(input) - 1;
      if(i >=0 && i < size(multiAccount)) {
      accountType = multiAccount.get(i);
      __params.InitiatorAccountNo= accountType .AccountNo;
       __secure = true;
          __next = '6';
         } else {
    __next = '5';
    }
    } else {
        __next = '5';
    }
}","5","Select Sender Account No","<html>
<body>
Please Select Sender Account No :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Commission payable',CurrencyCode);
$$if (empty(multiAccount )) {
 You have no account type exist !
$$} else {
  $$var index = 1;
  $$for(accountType: multiAccount ) {
  ${index} ${accountType.AccountName}(${accountType.AccountType.AccountTypeAlias})(${accountType.Currency.CurrencyCode})<br>
  $$  index = index+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20039","20023","Operator Commission payable accounts Transfer via Till","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(multiCurrencyCode)) {
               currencyCode = multiCurrencyCode.get(i);
                CurrencyCode =  currencyCode;
__params.Currency = currencyCode;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Currency Code","<html>
<body>
Select Currency Code :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currency code is exist !
$$} else {
  $$var index = 1;
  $$for(currencyCode: multiCurrencyCode ) {
  ${index} ${currencyCode}<br>
  $$ index= index + 1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","2004","1020","Customer query mini statements","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20041","20023","Operator Commission payable accounts Transfer via Till","var input = __input.response;
__params.InitiatorIdentifier = input;
__next = '3';","2","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","20042","20023","Operator Commission payable accounts Transfer via Till","var input = __input.response;
__params.PrimaryPartyIdentifier = input;
__next = '2';","1","Enter Sender Short Code","<html>
<body>
Enter Sender Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20051","20050","Operator from float to working account transfer via Handset","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.IsIntra = '1';
__params.CurrencyCode = 'USD';
__params.ReasonTypeCode = 'Float2Working';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","1","20053","20052","Operator from working to float account transfer via Handset","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.IsIntra = '1';
__params.CurrencyCode = 'TZS';
 __params.ReasonTypeCode = 'Organization Intra Transfer from work to float';
__next = '2';","begin","set parammeters","",""<endrec>
"TILL","","7","20054","20050","Operator from float to working account transfer via Handset","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Move Funds ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20055","20050","Operator from float to working account transfer via Handset","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20056","20050","Operator from float to working account transfer via Handset","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(multiAccount)) {
               accountType = multiAccount.get(i);
                __params.PrimaryAccountNo= accountType .AccountNo;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Select Initiator Account No","<html>
<body>
Please select Origin account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Float Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20057","20050","Operator from float to working account transfer via Handset","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    if(1 == size(multiAccount)){
        accountType= multiAccount .get(0)
        if('true' == accountType.defaultFlag){
             __next = '5';
        }else{
             __next = '4';
        }
    }else{
   __next = '4';
}
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'org float',CurrencyCode);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20058","20050","Operator from float to working account transfer via Handset","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(multiCurrencyCode)) {
               currencyCode = multiCurrencyCode.get(i);
                CurrencyCode =  currencyCode;
__params.Currency = currencyCode;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Select Currency Code","<html>
<body>
Select Currency Code :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currency code is exist !
$$} else {
  $$var index = 1;
  $$for(currencyCode: multiCurrencyCode ) {
  ${index} ${currencyCode}<br>
  $$ index= index + 1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","20059","20050","Operator from float to working account transfer via Handset","var input = __input.response;
__params.InitiatorIdentifier = input;
__next = '2';","1","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20060","20052","Operator from working to float account transfer via Handset","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Move Funds ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20061","20052","Operator from working to float account transfer via Handset","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20062","20052","Operator from working to float account transfer via Handset","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(multiAccount)) {
               accountType = multiAccount.get(i);
                __params.PrimaryAccountNo= accountType .AccountNo;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Select Initiator Account No","<html>
<body>
Please select Origin account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Working account',CurrencyCode);
$$if (empty(multiAccount )) {
 You have no account type exist !
$$} else {
  $$var index = 1;
  $$for(accountType: multiAccount ) {
  ${index} ${accountType.AccountName}(${accountType.AccountType.AccountTypeAlias})(${accountType.Currency.CurrencyCode})<br>
  $$  index = index+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20063","20052","Operator from working to float account transfer via Handset","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    if(1 == size(multiAccount)){
        accountType= multiAccount .get(0)
        if('true' == accountType.defaultFlag){
             __next = '5a';
        }else{
             __next = '4';
        }
    }else{
   __next = '4';
}
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',CurrencyCode);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20064","20052","Operator from working to float account transfer via Handset","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(multiCurrencyCode)) {
               currencyCode = multiCurrencyCode.get(i);
                CurrencyCode =  currencyCode;
__params.Currency = currencyCode;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Select Currency Code","<html>
<body>
Select Currency Code :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currency code is exist !
$$} else {
  $$var index = 1;
  $$for(currencyCode: multiCurrencyCode ) {
  ${index} ${currencyCode}<br>
  $$ index= index + 1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","20065","20052","Operator from working to float account transfer via Handset","var input = __input.response;
__params.InitiatorIdentifier = input;
__next = '5';","5a","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","201","1002","Request Deposit Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.VoucherTypeCode = 'Deposit Voucher For Customer';  
__secure = true;
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","7","20102","20013","Customer Intra-Account Transfer Saving to m-pesae","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","6","Confirm","<html>
<body>
Confirm to Intra_Account Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","20103","20102","Customer Create Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier = msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__params.ActionType = 'CreateAccount';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.Currency= 'TZS';
__params.DefaultFlag= 'N';
accountTypes = IC.queryAccountTypeList('Customer');
if ( size(accountTypes )>0) {
  __next = '1';
}else {
   __errormsg = 'There is no account type exist!';
   __next = 'error';
}","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","20104","20102","Customer Create Account","__params.@HEAD@PIN = __input.response;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","20105","20102","Customer Create Account","var input=__input.response;
if(!empty(input) && Validator.checkAccountNameLength(input)){
 __params.AccountName = __input.response;
 __next = '3';
}
else
{
__next = '2';
}","2","Enter Account Name","<html>
<body>
Enter Account Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","20107","20102","Customer Create Account","var i = Util.toInt(__input.response)-1;
if (i >= 0 && i < size(accountTypes)){
   accountType = accountTypes.get(i);
  __params.AccountType = accountType.AccountTypeId;
   __next = '2';
}
else{
  __next = '1';
}","1","Select Account Type","<html>
<body>
Please Select Account Type:<br>
$$ var index = 1;
$$ for (accountType: accountTypes){
	${index}  ${accountType.AccountTypeAlias} <br> 
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","20108","20107","Customer Intra-Account Transfer Saving to Saving","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
CurrencyCode = '';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","20113","20028","Customer Intra-Account Transfer m-pesae  to Saving","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.ReceiverAccountNo = type.AccountNo;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Choose To AccountNo","<html>
<body>
Please select Destination account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Savings Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20119","20118","IdentifyCustomer","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ActionType = 'CCHIdentifyCustomer';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","1","20121","20120","Identify Assistant","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CCHIdentifyOrgOperator';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '05'; /* SP_ID */
__params.CheckOrgHierarchy='0';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","8","20122","20120","Identify Assistant","var input = __input.response;
if (input == null || empty(input)) {
    __next = '1';
} else {
    __params.ReceiverPartyIdentifier= input;
    __next = '2';
}","1","Enter Ass.ID","<html>
<body>
Enter Ass.ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","20123","20120","Identify Assistant","var input = __input.response;
if (empty(input)) {
    __next = '2';
} else if (input == '1') {
    __tips = 'Till no';
    __next = '3a';
} else if (input == '2') {
    __tips = 'Short code';
    __next = '3b';
} else {
    __next = '2';
}","2","Enter Till Shortcode","<html>
<body>
Select Till no or Short code<br>
1 Till no<br>
2 Short code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","20124","20120","Identify Assistant","var input = __input.response;
if (empty(input)) {
    __next = '3a';
} else {
    __params.ReceiverPartyTillNumber= input;
    __next = '4';
}","3a","Enter Till Number","<html>
<body>
Enter ${__tips}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20125","20120","Identify Assistant","var input = __input.response;
if (input == null || empty(input)) {
    __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '4';
} else {
    __next = '5';
}","4","Enter DoB","<html>
<body>
Enter DoB<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20126","20120","Identify Assistant","var input = __input.response;
if (input == null || empty(input)) {
    __next = '5';
} else {
    __params.InitiatorIdentifier= input;
    __next = '6';
}","5","Enter CCH Assistant ID","<html>
<body>
Enter CCH Assistant ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20127","20120","Identify Assistant","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '7';","6","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20128","20120","Identify Assistant","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Submit","<html>
<body>
Identify Assistant - ${__params.ReceiverParty.Identifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20130","20129","Send Start Key for New PIN","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ResetOrgOperatorPIN';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '05'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.CheckOrgHierarchy='0';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","6","20131","20129","Send Start Key for New PIN","var input = __input.response;
if (input == null || empty(input)) {
    __next = '1';
} else {
    __params.ReceiverParty.Identifier= input;
    __next = '2';
}","1","Enter Ass.ID","<html>
<body>
Enter Ass.ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20132","20129","Send Start Key for New PIN","var input = __input.response;
if (empty(input)) {
    __next = '2';
} else if (input == '1') {
    __params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
    __tips = 'Till no';
    __next = '3';
} else if (input == '2') {
    __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
    __tips = 'Short code';
    __next = '3';
} else {
    __next = '2';
}","2","Enter TillShortcode","<html>
<body>
Select Till no or Short code<br>
1 Till no<br>
2 Short code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20133","20118","IdentifyCustomer","var input = __input.response;
if (input == null || empty(input)) {
    __next = '1';
} else {
    __params.ReceiverPartyIdentifier= input;
    __next = '2';
}","1","Enter Phone Number","<html>
<body>
Enter Phone Number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20134","20129","Send Start Key for New PIN","var input = __input.response;
if (empty(input)) {
    __next = '3';
} else {
    __params.ReceiverParty.TillNumber= input;
    __next = '4';
}","3","Enter ID Number","<html>
<body>
Enter ${__tips}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20135","20129","Send Start Key for New PIN","var input = __input.response;
if (input == null || empty(input)) {
    __next = '4';
} else {
    __params.Initiator.Identifier= input;
    __next = '5';
}","4","Enter CCH Assistant ID","<html>
<body>
Enter CCH Assistant ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20136","20118","IdentifyCustomer","var input = __input.response;
if (input == '1') {
  __params.CertificateType = '01'; /* National ID */
  __next = '3';
} else if (input == '2') {
  __params.CertificateType = '02'; /* Military ID*/
  __next = '3';
} else if (input == '3') {
  __params.CertificateType = '03'; /*Alien ID */
  __next = '2';
} else if (input == '4') {
  __params.CertificateType = '04'; /* Diplomatic ID  */
  __next = '3';
} else if (input == '5') {
  __params.CertificateType = '05'; /* Passport */
  __next = '3';
}  else {
  __next = '2';
}","2","Enter ID Type","<html>
<body>
Identification Type<br>
1  National ID<br>
2  Military ID<br>
3  Alien ID<br>
4  Diplomatic ID<br>
5  Passport<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20137","20129","Send Start Key for New PIN","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20138","20118","IdentifyCustomer","var input = __input.response;
__params.CertificateNumber = input;
__next = '4';","3","Enter New ID Number","<html>
<body>
Enter New ID Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","20139","20129","Send Start Key for New PIN","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Submit","<html>
<body>
Business Withdraw - ${__params.ReceiverParty.Identifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20141","20140","Send Start Key for Free PIN","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CCHResetOrgOperatorPIN';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '05'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.CheckOrgHierarchy='0';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","20142","20118","IdentifyCustomer","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter CCH Assistant ID","<html>
<body>
Enter CCH Assistant ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20143","20140","Send Start Key for Free PIN","var input = __input.response;
if (input == null || empty(input)) {
    __next = '1';
} else {
    __params.ReceiverParty.Identifier= input;
    __next = '2';
}","1","Enter Ass.ID","<html>
<body>
Enter Ass.ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20144","20140","Send Start Key for Free PIN","var input = __input.response;
if (empty(input)) {
    __next = '2';
} else if (input == '1') {
    __params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
    __tips = 'Till no';
    __next = '3';
} else if (input == '2') {
    __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
    __tips = 'Short code';
    __next = '3';
} else {
    __next = '2';
}","2","Enter TillShortcode","<html>
<body>
Select Till no or Short code<br>
1 Till no<br>
2 Short code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20145","20140","Send Start Key for Free PIN","var input = __input.response;
if (empty(input)) {
    __next = '3';
} else {
    __params.ReceiverParty.TillNumber= input;
    __next = '4';
}","3","Enter ID Number","<html>
<body>
Enter ${__tips}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20146","20118","IdentifyCustomer","var input = __input.response;
__params.@HEAD@PIN=input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20147","20140","Send Start Key for Free PIN","var input = __input.response;
if (input == null || empty(input)) {
    __next = '4';
} else {
    __params.Initiator.Identifier= input;
    __next = '5';
}","4","Enter CCH Assistant ID","<html>
<body>
Enter CCH Assistant ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","20148","20118","IdentifyCustomer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to Change secret word?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20149","20140","Send Start Key for Free PIN","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20151","20150","Request Reversal","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ActionType = CCHFlag;
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","20152","20140","Send Start Key for Free PIN","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Submit","<html>
<body>
Business Withdraw - ${__params.ReceiverParty.Identifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20154","20153","Collect DoB","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ActionType = 'CCHChangeCustKYC';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","6","20155","20153","Collect DoB","var input = __input.response;
if (input == null || empty(input)) {
    __next = '1';
} else {
    __params.ReceiverPartyIdentifier= input;
    __next = '2';
}","1","Enter Phone Number","<html>
<body>
Enter Phone Number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20156","20153","Collect DoB","var input = __input.response;
if (input == null || empty(input)) {
    __next = '2';
} else {
    __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '3';
}","2","Enter DoB","<html>
<body>
Enter DoB <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20157","20153","Collect DoB","var input = __input.response;
__params.InitiatorIdentifier = input;
__next = '4';","3","Enter CCH Assistant ID","<html>
<body>
Enter CCH Assistant ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","20158","20153","Collect DoB","var input = __input.response;
__params.@HEAD@PIN=input;
__params.KYCInfo = IC.buildCustomerInfo(__params);
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20159","20153","Collect DoB","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","5","Confirm","<html>
<body>
Confirm to Change secret word?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20161","20160","Unlock PIN","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CCHUnlockCustPIN';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","4","20162","20160","Unlock PIN","var input = __input.response;
if (input == null || empty(input)) {
    __next = '1';
} else {
    __params.ReceiverPartyIdentifier= input;
    __next = '2a';
}","1","Enter Phone Number","<html>
<body>
Enter Phone Number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20164","20163","Unlock PIN for Org","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CCHUnlockOrgOperatorPIN';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '05'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.CheckOrgHierarchy='0';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","20165","20163","Unlock PIN for Org","var input = __input.response;
if (input == null || empty(input)) {
    __next = '1';
} else {
    __params.ReceiverParty.Identifier= input;
    __next = '2';
}","1","Enter Ass.ID","<html>
<body>
Enter Ass.ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20166","20163","Unlock PIN for Org","var input = __input.response;
if (empty(input)) {
    __next = '2';
} else if (input == '1') {
    __params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
    __tips = 'Till no';
    __next = '3';
} else if (input == '2') {
    __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
    __tips = 'Short code';
    __next = '3';
} else {
    __next = '2';
}","2","Enter TillShortcode","<html>
<body>
Select Till no or Short code<br>
1 Till no<br>
2 Short code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20167","20163","Unlock PIN for Org","var input = __input.response;
if (empty(input)) {
    __next = '3';
} else {
    __params.ReceiverParty.TillNumber= input;
    __next = '4';
}","3","Enter ID Number","<html>
<body>
Enter ${__tips}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20168","20163","Unlock PIN for Org","var input = __input.response;
if (input == null || empty(input)) {
    __next = '4';
} else {
    __params.Initiator.Identifier= input;
    __next = '5';
}","4","Enter CCH Assistant ID","<html>
<body>
Enter CCH Assistant ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20169","20163","Unlock PIN for Org","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20170","20163","Unlock PIN for Org","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Submit","<html>
<body>
Unlock Pin for Org - ${__params.ReceiverParty.Identifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20171","20160","Unlock PIN","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __secure = true;
  __next = '3';
} else {
  __next = '2';
}","2","Enter CCH Assistant ID","<html>
<body>
Enter CCH Assistant ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20172","20160","Unlock PIN","var input = __input.response;
__params.@HEAD@PIN=input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
${__params.Birthday}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","20173","20160","Unlock PIN","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to Change secret word?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20175","20174","Send Start Key for Customer New PIN","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CCHResetCustPIN';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.CheckOrgHierarchy='0';
__params.Birthday='19700101';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","20176","20150","Request Reversal","var input = __input.response;
if (input == null || empty(input)) {
    __next = '1';
} else {
    __params.ReceiverParty.Identifier= input;
    __next = '2';
}","1","Enter Phone Number","<html>
<body>
Enter Phone Number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20177","20150","Request Reversal","var input = __input.response;
if (input == null || empty(input)) {
    __next = '2';
} else {
    __params.OriginalOrderId= input;
    __next = '3';
}","2","Enter Receipt ID","<html>
<body>
Enter Receipt ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20178","20150","Request Reversal","var input = __input.response;
__params.Initiator.Identifier = input;
__secure = true;
__next = '4';","3","Enter CCH Assistant ID","<html>
<body>
Enter CCH Assistant ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20179","20150","Request Reversal","var input = __input.response;
__params.@HEAD@PIN=input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","20180","20174","Send Start Key for Customer New PIN","var input = __input.response;
if (input == null || empty(input)) {
    __next = '1';
} else {
    __params.ReceiverPartyIdentifier= input;
    __next = '1b';
}","1","Enter Phone Number","<html>
<body>
Enter Phone Number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20181","20150","Request Reversal","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to Change secret word?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20182","20174","Send Start Key for Customer New PIN","var input = __input.response;
__params.InitiatorIdentifier =input ;
__secure = true;
__next = '3';","2","Enter CCH Assistant ID","<html>
<body>
Enter CCH Assistant ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20183","20174","Send Start Key for Customer New PIN","var input = __input.response;
__params.@HEAD@PIN=input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20184","20174","Send Start Key for Customer New PIN","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to Change secret word?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20186","20185","Send Start Key  for Customer Free PIN","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CCHResetCustPIN';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.CheckOrgHierarchy='0';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","20187","20185","Send Start Key  for Customer Free PIN","var input = __input.response;
if (input == null || empty(input)) {
    __next = '1';
} else {
    __params.ReceiverParty.Identifier= input;
    __next = '2';
}","1","Enter Phone Number","<html>
<body>
Enter Phone Number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20189","20185","Send Start Key  for Customer Free PIN","var input = __input.response;
__params.Initiator.Identifier = input;
__secure = true;
__next = '3';","2","Enter CCH Assistant ID","<html>
<body>
Enter CCH Assistant ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20190","20185","Send Start Key  for Customer Free PIN","var input = __input.response;
__params.@HEAD@PIN=input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20191","20185","Send Start Key  for Customer Free PIN","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to Change secret word?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","202","1002","Request Deposit Voucher","var input = __input.response;
__params.PIN = input;
__next = '2';
","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","20202","20201","Add Customer Beneficiary","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier = msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__params.ActionType = 'AddCustomerBeneficiary';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","7","20203","20107","Customer Intra-Account Transfer Saving to Saving","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","6","Confirm","<html>
<body>
Confirm to Intra_Account Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20204","20203","Org Intra Account org float to org float","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
CurrencyCode = '';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","1","20205","20204","Customer Intra-Account Transfer m-pesa to m-pesa","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
CurrencyCode = '';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","20206","20204","Customer Intra-Account Transfer m-pesa to m-pesa","var input = __input.response;
if (Validator.isAmount(input)) {
__params.Amount = TC.convertAmountFormat(input);
__secure = true;
 __next = '2';
}
else {
 __next = '1';
}","1","Input Amount","<html>
<body>Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","20207","20203","Org Intra Account org float to org float","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20208","20203","Org Intra Account org float to org float","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                CurrencyCode =  type;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20209","20203","Org Intra Account org float to org float","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.PrimaryAccountNo= type.AccountNo;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose From AccountNo","<html>
<body>
Please select Origin account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Float Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20210","20203","Org Intra Account org float to org float","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.ReceiverAccountNo = type.AccountNo;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Choose To AccountNo","<html>
<body>
Please select Destination account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Float Account' ,CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20211","20203","Org Intra Account org float to org float","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
}
__next = '6';","5","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20212","20203","Org Intra Account org float to org float","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '7';","6","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20213","20212","Operator query balances","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.AccountTypeCode='Float Account';/* ACCOUNT TYPE CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","9","20214","20203","Org Intran_Account  org float to org float","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
Confirm to Intra_Account Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","20215","20008","Customer Close Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier = msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__params.ActionType = 'CloseCustAdditionalAccountStatus';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.Status ='1006';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","20216","20008","Customer Close Account","var i = Util.toInt(__input.response)-1;
if (i >= 0 && i < size(accountTypes)){
   accountType = accountTypes.get(i);
  __params.AccountNo = accountType.AccountNo;
  __params.AccountName = accountType.AccountName;
   __next = '2';
}
else{
  __next = '1';
}","1","Select Account","<html>
<body>
Please Select Account:<br>
$$ accountTypes = IC.queryAccountInstance(identity.identityType, identity.identityId);
$$if (empty(accountTypes )) {
  You have no account type exist !
$$} else {
  $$var index = 1;
  $$for(accountType: accountTypes ) { 
  ${index} ${accountType.AccountName}(${accountType.AccountType.AccountTypeAlias})<br>
  $$  index = index+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","20217","20008","Customer Close Account","__params.@HEAD@PIN = __input.response;
__next = '3';","2","Enter PIN","<html>
<body>
 Enter PIN :<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","20218","20008","Customer Close Account","var input = __input.response;
if(input == 1) {
 __next = 'end';
}else {
 __next = 'cancel';
}","3","Confirm","<html>
<body>
 Confirm to close account ${__params.AccountName}<br>
1 OK  <br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20219","20112","Operator Close Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';  /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '04'; /* SP_ID */
__params.VoucherTypeCode = 'Deposit Voucher';
__params.ActionType = 'CloseOrgAdditionalAcctStatus';
__params.Status= '1006';
 __next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","20220","20112","Operator Close Account","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifier=input;  
    
    accountTypes = IC.queryAccountInstanceByShortCode(input);
}
else
{
    accountTypes = IC.queryAccountInstanceByTillId(identity.identityId);
}
__next = '2';","1","Enter Organization Short Code","<html>
<body>
Enter Organization Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20221","20112","Operator Close Account","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';","2","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20222","20112","Operator Close Account","var i = Util.toInt(__input.response)-1;
if (i >= 0 && i < size(accountTypes)){
   accountType = accountTypes.get(i);
  __params.AccountNo = accountType.AccountNo;
  __params.AccountName = accountType.AccountName;
   __next = '4';
}
else{
  __next = '3';
}","3","Selcet Account","<html>
<body>
Please Select Account:<br>
$$if (empty(accountTypes )) {
  You have no account type exist !
$$} else {
  $$var index = 1;
  $$for(accountType: accountTypes ) { 
  ${index} ${accountType.AccountName}(${accountType.AccountType.AccountTypeAlias})<br>
  $$  index = index+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20223","20112","Operator Close Account","__params.@HEAD@PIN = __input.response;
__next = '5';","4","Enter PIN","<html>
<body>
 Enter PIN :<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","20224","20112","Operator Close Account","var input = __input.response;
if(input == 1) {
 __next = 'end';
}else {
 __next = 'cancel';
}","5","Confirm","<html>
<body>
 Confirm to close account ${__params.AccountName}<br>
1 OK  <br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20225","20227","Organization Intra-Account Transfer For Org float to Working account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
CurrencyCode = '';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","20226","20227","Organization Intra-Account Transfer For Org float to Working account","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20227","20227","Organization Intra-Account Transfer For Org float to Working account","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                CurrencyCode =  type;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20228","20227","Organization Intra-Account Transfer For Org float to Working account","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.PrimaryAccountNo= type.AccountNo;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose From AccountNo","<html>
<body>
Please select Origin account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Float Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20229","20227","Organization Intra-Account Transfer For Org float to Working account","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.ReceiverAccountNo = type.AccountNo;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Choose To AccountNo","<html>
<body>
Please select Destination account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account' ,CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20230","20227","Organization Intra-Account Transfer For Org float to Working account","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
}
__next = '6';","5","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20231","20227","Organization Intra-Account Transfer For Org float to Working account","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '7';","6","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","20232","20227","Organization Intra-Account Transfer For Org float to Working account","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Enter PIN","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","20233","20227","Organization Intra-Account Transfer For Org float to Working account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
Confirm to Intra_Account Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","20234","20201","Add Customer Beneficiary","var input = __input.response;
if (input == '1') {
__next = 'end';
} else if (input == '0') {
__next = 'cancel';
} else {
__next = '4';
}","4","Confirm","<html>
<body>
Confirm you will add ${__params.BeneficiaryIdentifier} with reference ${__params.BeneficiaryReference}<br> name ${disName2} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","203","1002","Request Deposit Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '2') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Confirm to Request Deposit Voucher?<br>
1 OK<br>
2 Quit<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20305","20304","Airtime Purchase","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.RequesterIdentifierType = '01';
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","9","20306","20304","Airtime Purchase","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '3';
} else {
  __next = '1';
}","1","Enter Requester phone no","<html>
<body>
Enter Requester phone no <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","20307","20304","Airtime Purchase","var input = __input.response;
__params.ReferenceDataItem@LSB@KYC@RSB@@LSB@Personal@@SPACE@@Details@RSB@@LSB@First@@SPACE@@Name@RSB@ = input;
__next = '3';","2","Enter First Name","<html>
<body>
Enter First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20308","20304","Airtime Purchase","var input = __input.response;
if (!empty(input)) {
__params.RechargedMSISDN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Recharged MSISDN","<html>
<body>
Enter Recharged MSISDN <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20309","20304","Airtime Purchase","__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
      __next = '5';
   } 
 else 
   {
      __next = '4';
   }","4","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20310","20304","Airtime Purchase","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Enter amount","<html>
<body>
Enter amount <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20311","20304","Airtime Purchase","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20312","20304","Airtime Purchase","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter Pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","20313","20304","Airtime Purchase","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html><body>
$$chargeFee = TC.queryCustomerCharge(__params);
$$result = TC.calculateBudget(__params);
$$budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
$$var promptText = '';
$$feeList = budgetMap.fee;
$$if(!empty(feeList)){
$$	   i = 1;
$$	   sizeLen = size(feeList);
$$	  for(fee:feeList)
$$	  {
$$	   promptText = promptText+ 'The amount of charge is '+fee.amount;
$$	 
$$	   if(i < sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$		i = i+1 
$$	  }
$$}
$$   taxList = budgetMap.tax;
$$   if(!empty(taxList)){
$$	   i = 1;
$$	   sizeLen = size(taxList);
$$	  for(tax:taxList)
$$	  {
$$		 if(i ==1 &&  promptText != '')
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$
$$		promptText = promptText
$$	 + 'The amount of tax is '+tax.amount;
$$	   
$$	   if(i <sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   } 
$$	   i = i+1;
$$	  }
$$  }
Buy Airtime ${__params.RechargedMSISDN} ${__params.Amount}<br>
${promptText } <br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20315","20314","Pay Bill","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
 __params.AccessDeviceIdentifierType = '01';   /* MSISDN */ 
 __params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
 __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
 __params.RequesterIdentifierType = '01';
__next = '1'","begin","set parammeters","",""<endrec>
"TILL","","11","20316","20314","Pay Bill","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
$$orgName = IC.queryOrgName(__params.ReceiverPartyIdentifier);
$$formatAmount = IC.formatAmount(__params.Currency, __params.Amount);
Fee:${chargeFee = TC.queryCustomerCharge(__params)};<br>
To Pay Bill ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${orgName} for account number ${__params.BillReferenceNumber}, the charge is ${chargeFee}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","20317","20314","Pay Bill","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter PIN","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","20318","20314","Pay Bill","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","20319","20314","Pay Bill","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20320","20314","Pay Bill","var input = __input.response;
__params.BillReferenceNumber = input;
__next = '5';","4","Enter Business no","<html>
<body>
Enter Business No.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20321","20314","Pay Bill","__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
      __next = '4';
   } 
 else 
   {
      __next = '3';
   }","3","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20323","20314","Pay Bill","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '3';
} else {
  __next = '1';
}","1","Enter phone no","<html>
<body>
Enter phone no <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","20327","20326","IMT Request Quote","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.TransactionCategory = 'IMT';
__params.TransactionSubCategory = 'IMT_HomeSend_AdviceOfCharge_Request';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","20329","20326","IMT Request Quote","var input = __input.response;
if (empty(input)) { 
__next = '2';
} else {
__params.AdditionalDataItemRecipient@@SPACE@@MSISDN = input;
__next = '3';
}","2","Enter Recipient MSISDN","<html>
<body>
Enter Recipient MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","20330","20326","IMT Request Quote","var input = __input.response;
if (Validator.isMatchRegex(input,""^([\D]){0,128}$"")) {
__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name = input;
__next = '4';
}
else{
__next = '3';}","3","Enter Recipient First Name","<html>
<body>
Enter Recipient First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","20331","20326","IMT Request Quote","var input = __input.response;
if (Validator.isMatchRegex(input,""^([\D]){0,128}$"")) {
__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name = input;
__next = '5';
}
else{
__next = '4';}","4","Enter Recipient Last Name","<html>
<body>
Enter Recipient Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","20332","20326","IMT Request Quote","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","20333","20326","IMT Request Quote","var input = __input.response;
if (Validator.isNonzeroAmount(input)) {
    __params.Amount = 0;
    __params.AdditionalDataItemPrinciple_Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter the Amount to be Transfered","<html>
<body>
Enter the Amount to be Transfered<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","20334","20326","IMT Request Quote","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
REQUEST QUOTE FOR SENDING MONEY TO [${__params.AdditionalDataItemRecipient@@SPACE@@MSISDN}] [${__params.AdditionalDataItemPrinciple_Amount}]<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","20336","20335","IMT Transfer Abroad","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.TransactionCategory = 'IMT';
__params.TransactionSubCategory = 'IMT_HomeSend_Remittance_Request';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","20337","20335","IMT Transfer Abroad","var input = __input.response;
if (Validator.isNonzeroAmount(input)) {
    var amount = TC.convertAmountFormat(input);
    __params.Amount = amount;
    __params.AdditionalDataItemPrinciple_Amount = amount;
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Transfer Amount","<html>
<body>
Enter Transfer Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","20338","20335","IMT Transfer Abroad","var input = __input.response;
if (empty(input)) { 
__next = '2';
} else {
__params.AdditionalDataItemRecipient@@SPACE@@MSISDN = input;
__next = '3';
}","2","Enter Recipient MSISDN","<html>
<body>
Enter Recipient MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","20339","20335","IMT Transfer Abroad","var input = __input.response;
if (Validator.isMatchRegex(input,""^([\D]){0,128}$"")) {
__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name = input;
__next = '4';
}
else{
__next = '3';}","3","Enter Recipient First Name","<html>
<body>
Enter Recipient First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","20340","20335","IMT Transfer Abroad","var input = __input.response;
if (Validator.isMatchRegex(input,""^([\D]){0,128}$"")) {
__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name = input;
__next = '5';
}
else{
__next = '4';}","4","Enter Recipient Last Name","<html>
<body>
Enter Recipient Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","20341","20335","IMT Transfer Abroad","var input = __input.response;
__params.PIN = input;
__next = '10';","9","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","20342","20335","IMT Transfer Abroad","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
SEND MONEY TO [${__params.AdditionalDataItemRecipient@@SPACE@@MSISDN}] [${__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name}] [${__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name}] [${__params.AdditionalDataItemPrinciple_Amount}] <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","20408","20407","Delete Beneficiary","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier =msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.ActionType= 'DeleteCustomerBeneficiary';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
custBeneficiaries = IC.queryCustListBeneficiary(msisdn);
orgBeneficiaries = IC.queryOrgListBeneficiary(msisdn);
groupBeneficiaries = IC.queryGroupListBeneficiary(msisdn);
if ( size(custBeneficiaries)>0 || size(orgBeneficiaries)>0 || size(groupBeneficiaries)>0) {
  __next = '1';
}else {
   __errormsg = 'There is no beneficiary exist!';
   __next = 'error';
}","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","20409","20407","Delete Beneficiary","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(custBeneficiaries)){
 custBeneficiary= custBeneficiaries.get(i);
 beneficiaryMsisdn = custBeneficiary.BeneficiaryMsisdn;
 beneficiaryName = custBeneficiary.BeneficiaryName;
 beneficiaryReference = custBeneficiary.BeneficiaryReference;
 __params.ActionType= 'DeleteCustomerBeneficiary';
 __params.BeneficiaryName= beneficiaryName;
 __params.BeneficiaryIdentifier = beneficiaryMsisdn;
 __params.BeneficiaryReference = beneficiaryReference;
 __next = '2';
 }
 else if (i >= size(custBeneficiaries) && i < size(orgBeneficiaries) + size(custBeneficiaries)){
 orgBeneficiary= orgBeneficiaries.get(i - size(custBeneficiaries));
 beneficiaryShortCode = orgBeneficiary.BeneficiaryShortCode;
 beneficiaryName = orgBeneficiary.BeneficiaryName;
 beneficiaryReference = orgBeneficiary.BeneficiaryReference;
 billReference= orgBeneficiary.BillReference;
 __params.ActionType= 'DeleteOrgBeneficiary';
 __params.BeneficiaryName= beneficiaryName;
 __params.BeneficiaryIdentifier =
beneficiaryShortCode;
 __params.BeneficiaryReference = beneficiaryReference;
 __params.BillReference = BillReference;
 __next = '2';
 }
 else if (i >= size(orgBeneficiaries) + size(custBeneficiaries) && i < size(orgBeneficiaries) + size(custBeneficiaries) +  size(groupBeneficiaries)){

 groupBeneficiary= groupBeneficiaries.get(i - size(custBeneficiaries) - size(orgBeneficiaries));
 beneficiaryGroupCode = groupBeneficiary.BeneficiaryGroupCode;
 beneficiaryName = groupBeneficiary.BeneficiaryName;
 beneficiaryReference = groupBeneficiary.BeneficiaryReference;
 __params.ActionType= 'DeleteGroupBeneficiary';
 __params.BeneficiaryName= beneficiaryName;
 __params.BeneficiaryIdentifier =
beneficiaryGroupCode;
 __params.BeneficiaryReference = beneficiaryReference;
 __next = '2';
 }else {
 __next = '1';
}","1","Select Beneficiary","<html>
<body>
Please Select Beneficiary:<br>
$$ var index = 1;
$$ for (custBeneficiary: custBeneficiaries){
 ${index} ${custBeneficiary.BeneficiaryName} ${custBeneficiary.BeneficiaryMsisdn} ${custBeneficiary.BeneficiaryReference}<br> 
$$ index = index + 1;
$$ }
$$ for (orgBeneficiary: orgBeneficiaries){
 ${index} ${orgBeneficiary.BeneficiaryName} ${orgBeneficiary.BillReference} ${orgBeneficiary.BeneficiaryReference}<br> 
$$ index = index + 1;
$$ }
$$ for (groupBeneficiary: groupBeneficiaries){
 ${index} ${groupBeneficiary.BeneficiaryName} ${groupBeneficiary.BeneficiaryGroupCode} ${groupBeneficiary.BeneficiaryReference}<br> 
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","20410","20407","Delete Beneficiary","__params.@HEAD@PIN = __input.response;
__next = '3';","2","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","20411","20407","Delete Beneficiary","var input = __input.response;
if(input == 1) {
 __next = 'end';
}else {
 __next = 'cancel';
}","3","Confirm","<html>
<body>
 Confirm to delete beneficiary ${__params.BeneficiaryName}<br>
1 OK  <br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20413","20412","Operator query MMF balances","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.AccountTypeCode='MMF Account for Organization';/* ACCOUNT TYPE CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","20414","20412","Operator query MMF balances","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '2';","1","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20415","20412","Operator query MMF balances","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20416","20412","Operator query MMF balances","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","20418","20201","Add Customer Beneficiary","var input = __input.response;
if(!empty(input)){
   __params.BeneficiaryIdentifier= __input.response;
   beneficiaryName = IC.queryListBeneficiaryName(input);
   disName=beneficiaryName.BeneficiaryName;
   disName2=beneficiaryName.firstName+' '+beneficiaryName.lastName;
   var canDis=beneficiaryName.canShowName;
   if(!canDis){
       disName='name not allowed to be shown';
       disName2='not allowed to be shown';
   }
   __next = '2';
}else{
    __next ='1';
}","1","Input MSISDN","<html>
<body>
Input MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","20419","20201","Add Customer Beneficiary","var input=__input.response;
if(empty(input))
{
  __next = '3';
}
else if(Validator.checkBenefiRefLength(input))
{
 __params.BeneficiaryReference = __input.response;
 __next = '3';
}
else
{
__next = '2';
}","2","Input Reference","<html>
<body>
Input Reference:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","20420","20201","Add Customer Beneficiary","__params.@HEAD@PIN = __input.response;
__next = '4';","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","20422","20421","Add Organization Beneficiary new","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier = msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__params.ActionType = 'AddOrgBeneficiary';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
shortCodeList= Util.queryShortCodeList('CPS.UMC.POPULAR.ORG');
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","7","20423","20421","Add Organization Beneficiary new","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","20424","20421","Add Organization Beneficiary new","__params.@HEAD@PIN = __input.response;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","20425","20421","Add Organization Beneficiary new","var input=__input.response;
if(empty(input))
{
  __next = '5';
}
else if(!empty(input))
{
 __params.BillReference = __input.response;
 __next = '5';
}
else
{
__next = '4';
}","4","Input Bill Reference","<html>
<body>
Input Bill Reference:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","20426","20421","Add Organization Beneficiary new","var input=__input.response;
if(empty(input))
{
  __next = '4';
}
else if(Validator.checkBenefiRefLength(input))
{
 __params.BeneficiaryReference = __input.response;
 __next = '4';
}
else
{
__next = '3';
}","3","Input Reference","<html>
<body>
Input Reference:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","20427","20421","Add Organization Beneficiary new","var input = __input.response;
if(empty(input)){
__next = '2';
}else
{
__params.BeneficiaryIdentifier= __input.response;
__next = '3';
}","2","Input Short Code","<html>
<body>
Input Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","20428","20421","Add Organization Beneficiary new","var input = __input.response;
if(input == '0'){
 __next = '2';
}else if(input != '0')
{
var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(shortCodeList)){
  shortCode= shortCodeList.get(i);
  code = shortCode.Value;
  __params.BeneficiaryIdentifier = code;
  __next = '3';
  }
}else
{
  __next = '1';
}","1","Select a Short Code","<html>
<body>
Please Select Short Code:<br>
$$ var index = 1;
$$ for (shortCode : shortCodeList ){
	${index} ${shortCode.Value} ${shortCode.DefaultName}<br> 
$$     index = index + 1;       
$$ }
       0 Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20503","20502","Operator Create Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';  /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '04'; /* SP_ID */
__params.VoucherTypeCode = 'Deposit Voucher';  
__params.ActionType = 'CreateAccount';
__params.DefaultFlag= 'N';
__params.Currency= 'TZS';
accountTypes = IC.queryAccountTypeList('Organization');
if ( size(accountTypes )>0) {
  __next = '1';
}else {
   __errormsg = 'There is no account type exist!';
   __next = 'error';
}","begin","set parammeters","",""<endrec>
"TILL","","6","20504","20502","Operator Create Account","__params.@HEAD@PIN = __input.response;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20505","20502","Operator Create Account","var input=__input.response;
if(!empty(input) && Validator.checkAccountNameLength(input)){
 __params.AccountName = __input.response;
 __next = '5';
}
else
{
__next = '4';
}","4","Enter Account Name","<html>
<body>
Enter Account Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20506","20502","Operator Create Account","var input = __input.response;
i
if (input == '1'){
{ 
    __params.AccountType = ""10011"";
}
}else if (input == '2'){
{
   __params.AccountType = ""10013"";
}
}else if (input == '3'){
{
   __params.AccountType = ""10015"";
}
}
__next = '4';","3","Select Account Type","<html>
<body>
Please Select Account Type:<br>
1. M-PESA Account<br>
2. Float Account<br>
3. Utility Account<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","20604","1007","Send Money","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2a';","1a","Phone no","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","20605","1007","Send Money","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  beneficiaryName = IC.queryListBeneficiaryName(beneficiaryMsisdn);
  disName2=beneficiaryName.firstName+' '+beneficiaryName.lastName;
  var canDis=beneficiaryName.canShowName;
 if(!canDis){
       
       disName2='';
   }
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '2';
}
else{

  __next = '1b';
}","1b","Beneficiary Choose .","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","20609","1024","Customer pay bill","var input = __input.response;
if (input == '1')
{ 
    __next = '1';
}else if (input == '2')
{
    __next = '2';
}else {
  __next = '0';
}","0","Choose a Method","<html>
<body>
Choose the receiver <br>
1 Enter Short Code<br>
2 Use Beneficiary<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","20701","1000","Buy Airtime","var input = __input.response;
__params.RechargedMSISDN = input;
  __next = '3';","2a","Input new MSISDN","<html>
<body>
Input the Recharged Phone no.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","20702","1000","Buy Airtime","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.RechargedMSISDN = beneficiaryMsisdn ;
  __next = '3';
} 
else{

  __next = '2b';
}","2b","Select a Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","20802","20801","Call Support","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","20804","20801","Call Support","var input = __input.response;

  __next = 'end';","1","Call Support","<html>
<body>
Dial 100 for support<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20902","20901","Organization Float Intra account transfer","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.IsIntra = '1';
__params.CurrencyCode = 'TZS';
__params.ReasonTypeCode = 'Transfer to Float Instance';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","5","20903","20901","Organization Float Intra account transfer","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(multiCurrencyCode)) {
               currencyCode = multiCurrencyCode.get(i);
                CurrencyCode =  currencyCode;
__params.Currency = currencyCode;
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Select Currency Code","<html>
<body>
Select Currency Code :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currency code is exist !
$$} else {
  $$var index = 1;
  $$for(currencyCode: multiCurrencyCode ) {
  ${index} ${currencyCode}<br>
  $$ index= index + 1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20904","20901","Organization Float Intra account transfer","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    if(1 == size(multiAccount)){
        accountType= multiAccount .get(0)
        if('true' == accountType.defaultFlag){
             __next = '4';
        }else{
             __next = '3';
        }
    }else{
   __next = '3';
}
} else {
    __next = '2';
}","2","Enter Amount","<html>
<body>
Enter Amount<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Float Account',CurrencyCode);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20905","20901","Organization Float Intra account transfer","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(multiAccount)) {
               accountType = multiAccount.get(i);
                __params.PrimaryAccountNo= accountType .AccountNo;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Initiator Account No","<html>
<body>
Please Select Initiator Account No :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Float Account',CurrencyCode);
$$if (empty(multiAccount )) {
 You have no account type exist !
$$} else {
  $$var index = 1;
  $$for(accountType: multiAccount ) {
  ${index} ${accountType.AccountName}(${accountType.AccountType.AccountTypeAlias})(${accountType.Currency.CurrencyCode})<br>
  $$  index = index+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20906","20901","Organization Float Intra account transfer","var input = __input.response;
__params.InitiatorIdentifier = input;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","20907","20901","Organization Float Intra account transfer","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20908","20901","Organization Float Intra account transfer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Move Funds ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","20911","20910","Organization Intra-Account Transfer For Org  Working to Float account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
CurrencyCode = 'TZS';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","20912","20910","Organization Intra-Account Transfer For Org  Working to Float account","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","20913","20910","Organization Intra-Account Transfer For Org  Working to Float account","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.PrimaryAccountNo= type.AccountNo;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Choose From AccountNo","<html>
<body>
Please select Origin account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","20914","20910","Organization Intra-Account Transfer For Org  Working to Float account","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.ReceiverAccountNo = type.AccountNo;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose To AccountNo","<html>
<body>
Please select Destination account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'Float Account' ,CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","20915","20910","Organization Intra-Account Transfer For Org  Working to Float account","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
}
__next = '5';","4","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","20916","20910","Organization Intra-Account Transfer For Org  Working to Float account","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '6';","5","Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","20917","20910","Organization Intra-Account Transfer For Org  Working to Float account","var input = __input.response;
__params.PIN = input;
__next = '7';","6","Enter PIN","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","20918","20910","Organization Intra-Account Transfer For Org  Working to Float account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to Intra_Account Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","2101","1021","Operator query mini statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","2102","1021","Operator query mini statement","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
    
    accountTypes = IC.queryAllAccountsByShortCode(input);
}
else
{
    accountTypes = IC.queryAllAccountsByTillId(identity.identityId);
}
__next = '2';
","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","2103","1021","Operator query mini statement","if (empty(accountTypes)) {
  __next = 'error';
} else {
  var input = __input.response;
  var i = Util.toInt(input) - 1;
  if (i >= 0 && i < size(accountTypes)) {
    __params.AccountTypeCode = accountTypes.get(i);
    __next = '3';
  } else {
    __next = '2';
  }
}","2","Select Account Type","<html>
<body>
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
    ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","2104","1021","Operator query mini statement","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';","3","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","2105","1021","Operator query mini statement","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","2106","1021","Operator query mini statement","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","21301","50201","Customer Get Start PIN","var input = __input.response;
if (Validator.isDate(input, 'ddMMyyyy')) {
  __params.Birthday = input;
  __next = '2';
} else {
  __next = '1b';
}","1b","Enter DOB Again","<html>
<body>
Because of wrong format<br>
please Enter Date of Birth(DDMMYYYY) again<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","21303","21302","Customer Beneficiary","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier = msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__params.ActionType = 'AddCustomerBeneficiary';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","21304","21302","Customer Beneficiary","var input = __input.response;
if(!empty(input)){
   __params.BeneficiaryIdentifier= __input.response;
   beneficiaryName = IC.queryListBeneficiaryName(input);
   disName=beneficiaryName.BeneficiaryName;
   disName2=beneficiaryName.firstName+' '+beneficiaryName.lastName;
   var canDis=beneficiaryName.canShowName;
   if(!canDis){
       disName='name not allowed to be shown';
       disName2='not allowed to be shown';
   }
   __next = '2';
}else{
    __next ='1';
}","1","Input MSISDN","<html>
<body>
Input MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","21305","21302","Customer Beneficiary","var input=__input.response;
if(empty(input))
{
  __next = '3';
}
else if(Validator.checkBenefiRefLength(input))
{
 __params.BeneficiaryReference = __input.response;
 __next = '3';
}
else
{
__next = '2';
}","2","Input Reference","<html>
<body>
Input Reference:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","21306","21302","Customer Beneficiary","__params.@HEAD@PIN = __input.response;
__next = '4';","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","21307","21302","Customer Beneficiary","var input = __input.response;
if (input == '1') {
__next = 'end';
} else if (input == '0') {
__next = 'cancel';
} else {
__next = '4';
}","4","Confirm","<html>
<body>
Confirm you will add ${__params.BeneficiaryIdentifier} with reference ${__params.BeneficiaryReference}<br> name ${disName2} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","21402","21401","IMT Send","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';
__params.RequesterIdentifierType = '01';
__params.TransactionCategory = 'IMT';
__params.TransactionSubCategory = 'IMT_HomeSend_Remittance_Request';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","7","21403","21401","IMT Send","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Sender MSISDN","<html>
<body>
Enter Sender MSISDN <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","21404","21401","IMT Send","var input = __input.response;
__params.ReferenceDataItem@LSB@KYC@RSB@@LSB@Personal@@SPACE@@Details@RSB@@LSB@First@@SPACE@@Name@RSB@ = input;
__next = '3';","2","Enter Sender First Name","<html>
<body>
Enter Sender First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","21405","21401","IMT Send","var input = __input.response;
if (Validator.isNonzeroAmount(input)) {
    var amount = TC.convertAmountFormat(input);
    __params.Amount = amount;
    __params.AdditionalDataItemPrinciple_Amount = amount;
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","21406","21401","IMT Send","var input = __input.response;
if (empty(input)) { 
__next = '4';
} else {
__params.AdditionalDataItemRecipient@@SPACE@@MSISDN = input;
__next = '5';
}","4","Enter Receiver MSISDN","<html>
<body>
Enter Receiver  MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","21407","21401","IMT Send","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name = input;
__next = '6';","5","Enter Receiver First Name","<html>
<body>
Enter Receiver First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","21408","21401","IMT Send","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name = input;
__next = '7';","6","Enter Receiver Last Name","<html>
<body>
Enter Receiver Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","21409","21401","IMT Send","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","21410","21401","IMT Send","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","21411","21401","IMT Send","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
SEND MONEY TO [${__params.AdditionalDataItemRecipient@@SPACE@@MSISDN}] [${__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name}] [${__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name}] [${__params.AdditionalDataItemPrinciple_Amount}] <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","21417","21416","IMT Send Query Quote","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';
__params.RequesterIdentifierType = '01';
__params.TransactionCategory = 'IMT';
__params.TransactionSubCategory = 'IMT_HomeSend_AdviceOfCharge_Request';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","21418","21416","IMT Send Query Quote","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Sender MSISDN","<html>
<body>
Enter Sender MSISDN <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","21419","21416","IMT Send Query Quote","var input = __input.response;
__params.FirstName= input;
__next = '3';","2","Enter Sender First Name","<html>
<body>
Enter Sender First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","21420","21416","IMT Send Query Quote","var input = __input.response;
if (Validator.isNonzeroAmount(input)) {
    __params.Amount = 0;
    __params.AdditionalDataItemPrinciple_Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","21421","21416","IMT Send Query Quote","var input = __input.response;
if (empty(input)) { 
__next = '4';
} else {
__params.AdditionalDataItemRecipient@@SPACE@@MSISDN = input;
__next = '5';
}","4","Enter Receiver MSISDN","<html>
<body>
Enter Receiver MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","21422","21416","IMT Send Query Quote","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name = input;
__next = '6';","5","Enter Receiver First Name","<html>
<body>
Enter First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","21423","21416","IMT Send Query Quote","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name = input;
__next = '7';","6","Enter Receiver Last Name","<html>
<body>
Enter Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","21424","21416","IMT Send Query Quote","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","21425","21416","IMT Send Query Quote","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","21426","21416","IMT Send Query Quote","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
REQUEST QUOTE FOR SENDING MONEY TO [${__params.AdditionalDataItemRecipient@@SPACE@@MSISDN}] [${__params.AdditionalDataItemPrinciple_Amount}]<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","21701","1037","Create Operator","var input = __input.response;
if (input == null || empty(input)) { 
    __next = '11';
} else {
   __params.PreferredNotificationChannel = '1001';
   __params.NotificationReceivingMSISDN = input;
   __next = '12';
}","11","Enter MSISDN to Receive Notification","<html>
<body>
Enter MSISDN to Receive Notification<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","21806","21805","Organisation ATM Deposit Voucher Request","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */
__secure = true;
__params.VoucherServiceType = '2'; 
atmProviders = Util.getAllATMProvidersOfDeposit();
 if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
  else
 {
       __next = '1';
 }","begin","set parammeters","",""<endrec>
"TILL","","1","21808","21807","Organisation ATM Withdraw Voucher Request","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */
__secure = true;
__params.VoucherServiceType = '1'; 
atmProviders = Util.getAllATMProviders();
providerName='';

 if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
 else if(size(atmProviders ) == 1) 
   {
      providerName= atmProviders.get(0);
      __params.ShortCode= Util.getShortCodeByName(providerName);
      __next = '2';
   }
  else
 {
       __next = '1';
 }","begin","set parammeters","",""<endrec>
"TILL","","2","21824","21805","Organisation ATM Deposit Voucher Request","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(atmProviders)) {
   providerName= atmProviders.get(i);
   __params.ShortCode= Util.getShortCodeByName(providerName);
   __next = '6';
} else {
   __next = '1';
}","1","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","21825","21807","Organisation ATM Withdraw Voucher Request","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(atmProviders)) {
   providerName= atmProviders.get(i);
   __params.ShortCode= Util.getShortCodeByName(providerName);
   __next = '6';
} else {
   __next = '1';
}","1","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","21826","21807","Organisation ATM Withdraw Voucher Request","var input = __input.response;
if (!empty(input)){
__params.ReceiverPartyIdentifier = input;
__next = '3';
} else 
   {
      __next = '2';
   }","2","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","21827","21805","Organisation ATM Deposit Voucher Request","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
__next = '3';
} else 
   {
      __next = '2';
   }","2","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","21828","21805","Organisation ATM Deposit Voucher Request","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","21829","21807","Organisation ATM Withdraw Voucher Request","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","21901","1006","Redeem withdraw voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","0","11","21903","1006","Redeem withdraw voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html><body>Give Cash ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"CUSTOMER","","1","22004","22003","Customer ATM Deposit Voucher request (value)","__params.ServiceCode = __service.serviceCode;
__params.VoucherServiceType = '2'; /* VoucherServiceType */ 
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */ 
__params.ReceiverPartyIdentifier = msisdn;
__secure = true;
__params.ReasonTypeCode = 'Customer request ATM Deposit Voucher (value)'; 
atmProviders = Util.getAllATMProvidersOfDeposit();
providerName='';

 if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
 else if(size(atmProviders ) == 1) 
   {
      providerName= atmProviders.get(0);
      __params.ShortCode= Util.getShortCodeByName(providerName);
      __next = '2';
   }
  else
 {
       __next = '1';
 }","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","22005","22003","Customer ATM Deposit Voucher request (value)","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(atmProviders)) {
   providerName= atmProviders.get(i);
   __params.ShortCode= Util.getShortCodeByName(providerName);
   __next = '2';
} else {
   __next = '1';
}","1","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22007","22003","Customer ATM Deposit Voucher request (value)","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","22008","22003","Customer ATM Deposit Voucher request (value)","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","2201","1022","Operator Initiate Inter-Account Transfer Transaction via Till","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.PrimaryPartyIdentifierType = '04'; /* SHORT_CODE */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","1","22011","22010","Customer ATM Deposit Voucher request (valueless)","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */ 
__params.ReceiverPartyIdentifier = msisdn;
 __params.ReasonTypeCode = 'ATM Deposit Voucher For Customer (valueless)'; 
__secure = true;
 __next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","22012","22010","Customer ATM Deposit Voucher request (valueless)","__params.ShortCode=__input.response; 
if (!empty(__params.ShortCode)) {
      __next = '2';
   } 
 else 
   {
      __next = '1';
   }","1","Enter ATM Provider Short Code","<html>
<body>
Enter ATM Provider Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22013","22010","Customer ATM Deposit Voucher request (valueless)","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22014","22010","Customer ATM Deposit Voucher request (valueless)","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Short Code - ${__params.ShortCode} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","22015","21805","Organisation ATM Deposit Voucher Request","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","22016","21805","Organisation ATM Deposit Voucher Request","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","22019","21807","Organisation ATM Withdraw Voucher Request","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","2202","1022","Operator Initiate Inter-Account Transfer Transaction via Till","var input = __input.response;
__params.PrimaryPartyIdentifier = input;
__next = '2';","1","Enter Sender Short Code","<html>
<body>
Enter Sender Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","22020","21807","Organisation ATM Withdraw Voucher Request","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22022","22021","Customer Initiate Reversal Request","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","22023","22021","Customer Initiate Reversal Request","var input = __input.response;
if (!empty(input)) {
  __params.OriginalReceiptNumber= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Transaction ID","<html>
<body>
Enter Transaction ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22024","22021","Customer Initiate Reversal Request","var input = __input.response;
if (!empty(input)) {
__params.PIN = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22025","22021","Customer Initiate Reversal Request","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input != '1') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","You are going to initiate reversal request","<html>
<body>
You are going to initiate reversal request. Press 1 to continue and other numbers to cancel.
${__params.info}<br>
1 OK<br>
 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22027","22026","Initiate Reversal Transaction","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ActionType = 'TransactionReversal';
  __next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","22028","22026","Initiate Reversal Transaction","var input = __input.response;
if (!empty(input)) {
  __params.OriginalOrderId= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Transaction ID or Request ID","<html>
<body>
Enter Transaction ID or Request ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22029","22026","Initiate Reversal Transaction","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Pin","<html>
<body>
Enter Pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","2203","1022","Operator Initiate Inter-Account Transfer Transaction via Till","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2","Enter Receiver Short Code","<html>
<body>
Enter Receiver Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22030","22026","Initiate Reversal Transaction","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '3';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '4';
}","3","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22031","22026","Initiate Reversal Transaction","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input != '1'){
  __next = 'cancel';
} else {
  __next = '5';
}","4","Confirm","<html><body>You are going to initiate reversal transaction. Press 1 to continue and other numbers to cancel. ${__params.info}<br>
1 OK <br>
 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","22035","22034","Org Operator Initiate Reversal Request","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPEATOR ID */
__params.ConvertErrorCode_IC14004 = 'false';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","22036","22034","Org Operator Initiate Reversal Request","var input = __input.response;
if (!empty(input)) {
  __params.OriginalReceiptNumber= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Transaction ID","<html>
<body>
Enter Transaction ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","22037","22034","Org Operator Initiate Reversal Request","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '3';
}","2","Enter Your Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","22038","22034","Org Operator Initiate Reversal Request","var input = __input.response;
if (!empty(input)) {
__params.PIN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","22039","22034","Org Operator Initiate Reversal Request","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input != '1') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","You are going to initiate reversal request","<html>
<body>
You are going to initiate reversal request. Press 1 to continue and other numbers to cancel.
${__params.info}<br>
1 OK<br>
 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","2204","1022","Operator Initiate Inter-Account Transfer Transaction via Till","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '4';
} else {
    __next = '3';
}","3","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","22042","22041","Initiate Reversal Transaction","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPEATOR ID */
__params.ActionType = 'TransactionReversal';
  __next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","22043","22041","Initiate Reversal Transaction","var input = __input.response;
if (!empty(input)) {
  __params.OriginalOrderId= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Transaction ID or Request ID","<html>
<body>
Enter Transaction ID or Request ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","22044","22041","Initiate Reversal Transaction","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","22045","22041","Initiate Reversal Transaction","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Pin","<html>
<body>
Enter Pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","22046","22041","Initiate Reversal Transaction","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","22047","22041","Initiate Reversal Transaction","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input != '1'){
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html><body>You are going to initiate reversal transaction. Press 1 to continue and other numbers to cancel. ${__params.info}<br>
1 OK <br>
 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","2205","1022","Operator Initiate Inter-Account Transfer Transaction via Till","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","2206","1022","Operator Initiate Inter-Account Transfer Transaction via Till","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","2207","1022","Operator Initiate Inter-Account Transfer Transaction via Till","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Move Funds from ${__params.PrimaryParty.Identifier} to ${__params.ReceiverParty.Identifier}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22102","22101","abcd","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","22103","22003","Customer ATM Deposit Voucher request (value)","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.VoucherAmount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '3';
} else {
    __next = '2';
}","2","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22202","22201","Send Money 2 factor ID Type","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
beneficiaries = IC.queryCustListBeneficiary(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","22203","22201","Send Money 2 factor ID Type","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22204","22201","Send Money 2 factor ID Type","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2a","Input Phone Number","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22205","22201","Send Money 2 factor ID Type","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3';
} 
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","22207","22201","Send Money 2 factor ID Type","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","22208","22201","Send Money 2 factor ID Type","var input = __input.response;
__params.PIN = input;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
__next = '7';","6","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","22209","22201","Send Money 2 factor ID Type","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>Send Money to ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22303","22302","Send Money 2 factor cert Type","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
beneficiaries = IC.queryCustListBeneficiary(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","22304","22302","Send Money 2 factor cert Type","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22305","22302","Send Money 2 factor cert Type","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2a","Input Phone Number","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22306","22302","Send Money 2 factor cert Type","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3';
} 
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","22308","22302","Send Money 2 factor cert Type","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","22310","22302","Send Money 2 factor cert Type","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>Send Money to ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","22312","22201","Send Money 2 factor ID Type","var input = __input.response;
if (input == '1') {
 __params.CertificateType = '01'; /* National ID */
 __next = '5';
} else {
  __next = '4';
}","4","Input ID Type","<html>
<body>
Input ID Type<br>
1  National ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>
</html>",""<endrec>
"CUSTOMER","","1","22315","22314","Pay Bill 2 factor cert Type AML","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
orgBeneficiaries = IC.queryOrgListBeneficiary(msisdn);
__next = '1a';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","22316","22314","Pay Bill 2 factor cert Type AML","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(orgBeneficiaries)){
  orgBeneficiary= orgBeneficiaries.get(i);
  beneficiaryMsisdn = orgBeneficiary.BeneficiaryMsisdn;
__params.ReceiverPartyIdentifier=beneficiaryMsisdn;
  __next = '3';
  }else {
  __next = '1b';
}","1b","Use Beneficiary","<html>
<body>
Please Select Beneficiary:<br>
$$ var index = 1;
$$ for (orgBeneficiary: orgBeneficiaries){
	${index} ${orgBeneficiary.BeneficiaryName} ${orgBeneficiary.BillReference} ${orgBeneficiary.BeneficiaryReference}<br> 
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22317","22314","Pay Bill 2 factor cert Type AML","var input = __input.response;
if (input == '1')
{ 
    __next = '1';
}else if (input == '2')
{
    __next = '1b';
}","1a","Choose a Method","<html>
<body>
Choose the receiver <br>
1 Enter Short Code<br>
2 Use Beneficiary<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22318","22314","Pay Bill 2 factor cert Type AML","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
var isManual = TC.isManualSelectionMode(__params.ServiceCode);
if (isManual) {
   reasonTypes = TC.queryReasonTypes(__params.ServiceCode);
   if (empty(reasonTypes) || size(reasonTypes) == 0) {
      __errormsg = 'Sorry, there is not any reason types.';
      __next = 'error';
   } else {
      __next = '2';
   }  
} else {
   __next = '3';
}","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","22319","22314","Pay Bill 2 factor cert Type AML","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(reasonTypes)) {
   __params.ReasonTypeCode = reasonTypes.get(i).getAlias();
   __next = '3';
} else {
   __next = '2';
}","2","Enter Reason Type","<html>
<body>
Select reason type:<br>
$$ var index = 1;
$$ for (reasonType : reasonTypes) {
${index} ${reasonType.getDisplayName(identity.locale)}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","22320","22314","Pay Bill 2 factor cert Type AML","var input = __input.response;
__params.BillReferenceNumber = input;
__next = '4';","3","Enter Bill No.","<html>
<body>
Enter Bill No.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","22321","22314","Pay Bill 2 factor cert Type AML","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '5';
} else {
    __next = '4';
}","4","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","22322","22314","Pay Bill 2 factor cert Type AML","var input = __input.response;
__params.PIN = input;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
__next = '8';

 __isCustomerInitiatorCNSEnable = IC.checkCustomerInitiatorCNSEnable(__params.InitiatorIdentifier);
    if (__isCustomerInitiatorCNSEnable)
    {
           __organizationKYC = IC.queryOrganizationKYC(__params.ReceiverPartyIdentifier);
           if (__organizationKYC.isError == '1') {
                     __next = 'error';
                     __errormsg = __organizationKYC.errorMsg;
            }   
          __feeInfo= TC.calculateInitiatorCustomerCharge(__params,  identity.identityId);
          if (__feeInfo.resultCode == '1' ) {
                    __next = 'error';
                    __errormsg = __feeInfo.errorMsg;
          }
    }","7","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","22323","22314","Pay Bill 2 factor cert Type AML","var input = __input.response;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
$$ if(__isCustomerInitiatorCNSEnable) {
To pay ${__feeInfo.principalAmout} to ${__organizationKYC.OrganizationName} for account number ${__params.BillReferenceNumber}, the charge is ${__feeInfo.fee}. Press 1 to confirm or 0 to cancel.
$$ } else {
Pay Bill - ${__params.ReceiverParty.Identifier} ${__params.BillReferenceNumber} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br> 
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22326","22325","Customer Withdrawal at Agent Till with 2 factor first name","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","22327","22325","Customer Withdrawal at Agent Till with 2 factor first name","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';","1","Enter till no","<html>
<body>
Enter till no<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22328","22325","Customer Withdrawal at Agent Till with 2 factor first name","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22329","22325","Customer Withdrawal at Agent Till with 2 factor first name","var input = __input.response;
__params.PIN = input;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
__next = '5';","4","Enter pin","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22330","22325","Customer Withdrawal at Agent Till with 2 factor first name","var input = __input.response;
__params.SimpleKYCMap = IC.buildSimpleKYCMap('First Name',input,__params.SimpleKYCMap);
__secure = true;
__next = '4';","3","Enter First Name","<html>
<body>
Enter Sender First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22332","22331","Apply Customer ATM withdraw 2 factor auth special PEP","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */ 
__params.ReceiverPartyIdentifier = msisdn;
__secure = true;
__params.VoucherTypeCode = 'Paynet ATM Withdawal Voucher'; 
atmProviders = Util.getAllATMProviders();
providerName='';

 if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
 else if(size(atmProviders ) == 1) 
   {
      providerName= atmProviders.get(0);
      __params.ShortCode= Util.getShortCodeByName(providerName);
      __next = '2';
   }
  else
 {
       __next = '1';
 }","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","22333","22331","Apply Customer ATM withdraw 2 factor auth special PEP","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(atmProviders)) {
   providerName= atmProviders.get(i);
   __params.ShortCode= Util.getShortCodeByName(providerName);
   __next = '2';
} else {
   __next = '1';
}","1","Enter ATM Provider","<html>
<body>
Select ATM Provider:<br>
$$ var index = 1;
$$ for (atmProvider: atmProviders ) {
${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22334","22331","Apply Customer ATM withdraw 2 factor auth special PEP","var input = __input.response;
__params.SimpleKYCMap = IC.buildSimpleKYCMap('PEP',input,__params.SimpleKYCMap);
__secure = true;
__next = '3';","2","Enter PEP","<html>
<body>
Enter Your Special Details :<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22335","22331","Apply Customer ATM withdraw 2 factor auth special PEP","var input = __input.response;
__params.PIN = input;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
__next = '4';","3","Enter PIN","<html>
<body>
Please Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22336","22331","Apply Customer ATM withdraw 2 factor auth special PEP","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Comfirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","22337","22325","Customer Withdrawal at Agent Till with 2 factor first name","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Withdraw cash from ${__params.ReceiverParty.Identifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","22338","22201","Send Money 2 factor ID Type","var input = __input.response;
__params.MutiKYCMap = IC.buildMutiKYCMap('IDNumber',input,__params.MutiKYCMap);
__secure = true;
__next = '6';","5","Enter Your ID Number","<html>
<body>
Please Enter Your ID Number :<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","22346","22314","Pay Bill 2 factor cert Type AML","var input = Util.toInt(__input.response);
if (input <= 0 || input >=2) {
   __secure = true;
   __next = '5';
} else {
__params.MutiKYCMap = IC.buildMutiKYCMap('CertificateNumber','01',__params.MutiKYCMap);
   __secure = true;
   __next = '6';
}","5","Enter Certificate Type","<html>
<body>
Enter Certificate Type  <br>
1  AML Training Certificate<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>
</html>",""<endrec>
"CUSTOMER","","10","22347","22314","Pay Bill 2 factor cert Type AML","var input = __input.response;
__params.MutiKYCMap = IC.buildMutiKYCMap('CertificateNumber',input,__params.MutiKYCMap);
__secure = true;
__next = '7';","6","Enter Certificate Number","<html>
<body>
Please Enter Your Certificate Number  :<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","22348","22302","Send Money 2 factor cert Type","var input = __input.response;
__params.PIN = input;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
__next = '6';","5","Input PIN","<html>
<body>
INput PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22351","22350","Send Money with user input reference","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
beneficiaries = IC.queryCustListBeneficiary(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","22352","22350","Send Money with user input reference","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html",""<endrec>
"CUSTOMER","","3","22353","22350","Send Money with user input reference","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2a","Input Phone Number","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22354","22350","Send Money with user input reference","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3';
} 
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22355","22350","Send Money with user input reference","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","22356","22350","Send Money with user input reference","var input = __input.response;
__params.PIN = input;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
__next = '5a';","4","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","22357","22350","Send Money with user input reference","var input = __input.response;
 if (Validator.isMatchRegex(input,'^(\d{4})$') || empty(input)){
     __params.VoucherSecretCode = input;
     __next = '6';     
   } 
else{
    __next = '5a';
}","5a","Input Reference Code","<html>
<body>
Input Secret Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","22358","22350","Send Money with user input reference","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>Send Money to ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","22362","22361","Deposit Money 2 Factor First Name","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","7","22363","22361","Deposit Money 2 Factor First Name","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';","1","Enter Phone No","<html>
<body>
Enter phone no<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","22364","22361","Deposit Money 2 Factor First Name","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","22365","22361","Deposit Money 2 Factor First Name","var input = __input.response;
__params.SimpleKYCMap = IC.buildSimpleKYCMap('First Name',input,__params.SimpleKYCMap);
__secure = true;
__next = '4';","3","Enter First Name","<html>
<body>
Enter Sender First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","22366","22361","Deposit Money 2 Factor First Name","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","22367","22361","Deposit Money 2 Factor First Name","var input = __input.response;
__params.PIN = input;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
__next = '6';","5","Enter Pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","22368","22361","Deposit Money 2 Factor First Name","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Deposit Cash ${__params.ReceiverParty.Identifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","22373","22372","Test","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","22401","1007","Send Money","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","22402","1000","Buy Airtime","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '5';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '6';
}","5","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","22502","22501","Group Buy Goods with Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; 
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__params.RequesterIdentifierType = '01';  /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","22503","22501","Group Buy Goods with Voucher","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.GroupCode = input;
     __params.VoucherValidationValue = input;
     __next = '2';     
   } 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","22504","22501","Group Buy Goods with Voucher","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Requesting Customer MSISDN","<html>
<body>
Requesting Customer MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","22505","22501","Group Buy Goods with Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html><body>Buy goods - ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","22506","22501","Group Buy Goods with Voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","22507","22501","Group Buy Goods with Voucher","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '4';","3","Enter Voucher Code","<html>
<body>
Enter Voucher Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","22508","22501","Group Buy Goods with Voucher","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","22509","22501","Group Buy Goods with Voucher","var input = __input.response;
__params.Remark = input;
__next = '6';","5","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","22510","22501","Group Buy Goods with Voucher","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '7';","6","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","22511","22501","Group Buy Goods with Voucher","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","22515","22514","Group Deposit With Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '03'; /* Voucher Code */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","10","22516","22514","Group Deposit With Voucher","var input = __input.response;
if (input == '1') {
 __next = 'end';
} else if(input == '0') {
 __next = 'cancel';
} else {
 __next = '9';
}","9","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","22517","22514","Group Deposit With Voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","22518","22514","Group Deposit With Voucher","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.PIN = input;
 __next = '8';
} else {
 __secure = true;
 __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","22519","22514","Group Deposit With Voucher","var input = __input.response;
__params.InitiatorIdentifier = input;
__next = '7';","6","Enter OperatorID","<html>
<body>
Enter OperatorID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","22520","22514","Group Deposit With Voucher","var input = __input.response;
__params.Remark = input;
__next = '6';","5","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","22521","22514","Group Deposit With Voucher","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.Amount= TC.convertAmountFormat(input);
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","22522","22514","Group Deposit With Voucher","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '4';","3","Enter Voucher Code","<html>
<body>
Enter Voucher Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","22523","22514","Group Deposit With Voucher","var input = __input.response;
if (!empty(input)) {
__params.RequesterIdentifier = input;
__params.RequesterIdentifierType = '01';
}
__next = '3';","2","Enter Requester","<html>
<body>
Enter The Requester MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","22524","22514","Group Deposit With Voucher","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.GroupCode = input;
     __next = '2';     
   } 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","22528","22527","Group Withdraw With Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; 
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__params.RequesterIdentifierType = '01';  /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","10","22529","22527","Group Withdraw With Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html><body>Redeem Voucher - ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","22530","22527","Group Withdraw With Voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","22531","22527","Group Withdraw With Voucher","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","22532","22527","Group Withdraw With Voucher","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '7';","6","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","22533","22527","Group Withdraw With Voucher","var input = __input.response;
__params.Remark = input;
__next = '6';","5","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","22534","22527","Group Withdraw With Voucher","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '5';
} else {
    __next = '4';
}","4","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","22535","22527","Group Withdraw With Voucher","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '4';","3","Enter Voucher Code","<html>
<body>
Enter Voucher Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","22536","22527","Group Withdraw With Voucher","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Requesting Customer MSISDN","<html>
<body>
Requesting Customer MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","22537","22527","Group Withdraw With Voucher","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.GroupCode = input;
     __next = '2';     
   } 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22539","22538","Group P2G Transfer","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '15'; /* Group Code */
beneficiaries = IC.queryGroupListBeneficiary(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","9","22541","22538","Group P2G Transfer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>Group details: ${__params.ReceiverPartyIdentifier}<br>
Group Name: ${__params.map.groupName}<br>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","22542","22538","Group P2G Transfer","var input = __input.response;
var length = size(input);
var map = IC.querygroupInfo('15',__params.ReceiverPartyIdentifier);
DEBUG.error(""===map"",map);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","22543","22538","Group P2G Transfer","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","22544","22538","Group P2G Transfer","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.Amount= TC.convertAmountFormat(input);
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22545","22538","Group P2G Transfer","var input = __input.response;
__params.Remark = input;
__next = '4';","3","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22546","22538","Group P2G Transfer","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
 __params.map = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);

  __next = '3';
} 
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22547","22538","Group P2G Transfer","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.ReceiverPartyIdentifier = input;
 __params.map = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
DEBUG.error(""===map"",map);
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","22548","22538","Group P2G Transfer","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22556","22555","Group Pay Bill","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
CurrencyCode  = """";
groups = IC.queryMyGroups(msisdn);
__next = '0';","begin","set parammeters","",""<endrec>
"CUSTOMER","","11","22557","22555","Group Pay Bill","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","8","Confirm","<html>
<body>
Confirm to submit?<br>
$$orgName = IC.queryOrgName(__params.ReceiverPartyIdentifier);
$$formatAmount = IC.formatAmount(__params.Currency, __params.Amount);
Fee:${chargeFee = TC.queryCustomerCharge(__params)};<br>
To Pay  ${__params.amount} to ${__params.ReceiverPartyIdentifier} ${orgName}. Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","22558","22555","Group Pay Bill","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","22559","22555","Group Pay Bill","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.PIN = input;
    __next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","22560","22555","Group Pay Bill","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.Amount= TC.convertAmountFormat(input);
    __params.amount= input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","22561","22555","Group Pay Bill","var input = __input.response;
__params.Remark = input;
__next = '5';","4","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","22562","22555","Group Pay Bill","var input = __input.response;
__params.BillReferenceNumber = input;
   __next = '4';","3","Bill Reference Number","<html>
<body>
Input Bill No <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22563","22555","Group Pay Bill","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
   __next = '3';","2","Input Bill Issuer ShortCode","<html>
<body>
Input Bill Issuer Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22564","22555","Group Pay Bill","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '2';
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22565","22555","Group Pay Bill","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
__params.PrimaryPartyIdentifier = input;
__next = '2';
}else{
__next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","22566","22555","Group Pay Bill","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","0","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22568","22567","Group G2G Transfer","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group Code */
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
groups = IC.queryMyGroups(msisdn);
beneficiaries = IC.queryGroupListBeneficiary(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","12","22569","22567","Group G2G Transfer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>Group details: ${__params.ReceiverPartyIdentifier}<br>
Group Name: ${__params.groupmap.groupName}<br>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","22570","22567","Group G2G Transfer","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","22571","22567","Group G2G Transfer","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.PIN = input;
    __next = '8';
} else {
    __secure = true;
    __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","22572","22567","Group G2G Transfer","var input = __input.response;
__params.Remark = input;
__next = '7';","6","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","22573","22567","Group G2G Transfer","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","22574","22567","Group G2G Transfer","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
  __next = '5';
} 
else{

  __next = '4b';
}","4b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","22575","22567","Group G2G Transfer","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
 __params.groupmap = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
     __next = '5';     
   } 
else{
    __next = '4a';
}","4a","Enter Recipient Group Code","<html>
<body>
Enter Recipient Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22576","22567","Group G2G Transfer","var input = __input.response;
if (input == '1') {
  __next = '4a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '4b';
    }
} else {
   __next = '3';
}","3","Select Option(Recipient)","<html>
<body>
Please select option: <br>
1 Enter Recipient Group Code<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22577","22567","Group G2G Transfer","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22578","22567","Group G2G Transfer","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.PrimaryPartyIdentifier = input;
 __params.map = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
DEBUG.error(""===map"",map);
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","22579","22567","Group G2G Transfer","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22583","22582","Customer Apply Group Buy Goods Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '15'; /*GROUP_CODE */
__params.RequesterIdentifier = msisdn;
__params.VoucherTypeCode = 'Group Buy Goods Voucher';  
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","7","22584","22582","Customer Apply Group Buy Goods Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to Request Group Buy Goods Voucher?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","22585","22582","Customer Apply Group Buy Goods Voucher","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22586","22582","Customer Apply Group Buy Goods Voucher","var input = __input.response;
if (!empty(input) && Validator.isAmount(input)) {
    __params.VoucherAmount = TC.convertAmountFormat(input);
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22587","22582","Customer Apply Group Buy Goods Voucher","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22588","22582","Customer Apply Group Buy Goods Voucher","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","22589","22582","Customer Apply Group Buy Goods Voucher","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22592","22591","Customer Apply Group Deposit Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '15'; /*GROUP_CODE */
__params.RequesterIdentifier = msisdn;
__params.VoucherTypeCode = 'Deposit Voucher For Group';  
beneficiaries = IC.queryGroupListBeneficiary(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","6","22593","22591","Customer Apply Group Deposit Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to Request Customer Apply Group Deposit Voucher?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22594","22591","Customer Apply Group Deposit Voucher","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22595","22591","Customer Apply Group Deposit Voucher","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
  __next = '3';
} 
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22596","22591","Customer Apply Group Deposit Voucher","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","22597","22591","Customer Apply Group Deposit Voucher","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22600","22599","Apply Group Withdraw Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '15'; /*GROUP_CODE */
__params.RequesterIdentifier = msisdn;
__params.VoucherTypeCode = 'Group Withdrawal Voucher';  
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","7","22601","22599","Apply Group Withdraw Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","5","Confirm","<html>
<body>
Confirm to Request Group Withdraw Voucher?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","22603","22599","Apply Group Withdraw Voucher","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22604","22599","Apply Group Withdraw Voucher","var input = __input.response;
if (!empty(input) && Validator.isAmount(input)) {
    __params.VoucherAmount = TC.convertAmountFormat(input);
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22605","22599","Apply Group Withdraw Voucher","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '4';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22606","22599","Apply Group Withdraw Voucher","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","22607","22599","Apply Group Withdraw Voucher","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22610","1399","Group ATM Withdraw Voucher(valueless)","var input = __input.response;
__params.Remark = input;
__next = '5';","4","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","22701","22302","Send Money 2 factor cert Type","var input = Util.toInt(__input.response);
if (input <= 0 || input >=1) {
   __secure = true;
   __next = '4';
} else {
__params.MutiKYCMap = IC.buildMutiKYCMap('CertificateNumber','01',__params.MutiKYCMap);
   __secure = true;
   __next = '4a';
}","4","Enter Certificate Type","<html>
<body>
Enter Certificate Type  <br>
1  AML Training Certificate<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","22702","22302","Send Money 2 factor cert Type","var input = __input.response;
__params.MutiKYCMap = IC.buildMutiKYCMap('CertificateNumber',input,__params.MutiKYCMap);
__secure = true;
__next = '5';","4a","Enter Certificate Number","<html>
<body>
Please Enter Your Certificate Number  :<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","22804","22803","Confirm Group Member ship","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ConfirmGroupMembership';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15';   /* GroupCode */

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","6","22805","22803","Confirm Group Member ship","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>Group details: ${__params.ReceiverPartyIdentifier}<br>
Group Name: ${__params.map.groupName}<br>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","22806","22803","Confirm Group Member ship","__params.@HEAD@PIN = __input.response;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","22807","22803","Confirm Group Member ship","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
  __next = '3';
} 
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","22808","22803","Confirm Group Member ship","var input = __input.response;
__params.ReceiverPartyIdentifier = input;

__next = '3';","2a","Enter Group Code","<html>
<body>
Enter Group Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","22809","22803","Confirm Group Member ship","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","22901","1034","Organization operator applies a voucher for business withdraw","var input = __input.response;
var length = size(input);
if(length < __params.minLength  || length > __params.maxLength )
{
__params.info = 'The length of a secret code must be in the range of [' + __params.minLength + ',' + __params.maxLength + '], please enter secret code again!';
__next = '4';
}
else if(!empty(__params.rule) && input !~ __params.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __params.rule + ', please enter secret code again!';
__next = '4';
}
else
{
__params.VoucherSecretCode = input;
__next = '1';
}","4","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23003","23002","Apply Issue School Dinner Voucher (1)","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.IS_RESOLVE_RECEIVER_BY_INITIATOR = '1';  
__params.ReasonTypeCode = 'Issue School Dinner Voucher (1)';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","23004","23002","Apply Issue School Dinner Voucher (1)","var input = __input.response;
if(!empty(input)){
__params.Msisdn = __input.response;
__next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the receiving Msisdn:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23006","23002","Apply Issue School Dinner Voucher (1)","var input = __input.response;
if(!empty(input)){
__params.VoucherAmount = __input.response;
__next = '4';
}else{
    __next ='3';
}","3","Input amount","<html>
<body>
Please input the amount of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23007","23002","Apply Issue School Dinner Voucher (1)","var input = __input.response;
__params.ValidityPeriod = input;
__next = '5';","4","Input validity period","<html>
<body>
Please input the validity period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","23008","23002","Apply Issue School Dinner Voucher (1)","var input = __input.response;
__params.Extra1 = input;
__next = '6';","5","Input description 1","<html>
<body>
Please input the description 1 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","23009","23002","Apply Issue School Dinner Voucher (1)","var input = __input.response;
__params.Extra2 = input;
__next = '7';","6","Input description 2","<html>
<body>
Please input the description 2 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","2301","1023","Operator Initiate Intra-Account Transfer Transaction via Handset","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.IsIntra = '1';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","9","23010","23002","Apply Issue School Dinner Voucher (1)","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '8';
}else{
    __next ='7';
}","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","23011","23002","Apply Issue School Dinner Voucher (1)","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
You will issue a voucher to  ${__params.Msisdn},the amount is ${__params.VoucherAmount},the Redeeming org short code is ${__params.ShortCode}<br>
1 Confirm<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23014","23002","Apply Issue School Dinner Voucher (1)","var input = __input.response;
__params.ShortCode = input;
__next = '3';","2","Input short Code","<html>
<body>
Please input the redeeming organization short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23016","23015","Apply Issue School Dinner Voucher (2)","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.IS_RESOLVE_RECEIVER_BY_INITIATOR = '1';  
__params.ReasonTypeCode = 'Issue School Dinner Voucher (2)';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","9","23017","23015","Apply Issue School Dinner Voucher (2)","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
You will issue a voucher to  ${__params.Msisdn},the amount is ${__params.VoucherAmount},the Redeeming org short code is ${__params.ShortCode}<br>
1 Confirm<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","23018","23015","Apply Issue School Dinner Voucher (2)","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '8';
}else{
    __next ='7';
}","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","23019","23015","Apply Issue School Dinner Voucher (2)","var input = __input.response;
__params.Extra2 = input;
__next = '7';","6","Input description 2","<html>
<body>
Please input the description 2 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","2302","1023","Operator Initiate Intra-Account Transfer Transaction via Handset","var input = __input.response;
if (input == '1') {
  __params.ReasonTypeCode = 'Organization Transfer from Float Account to MMF Account via STK';
  __next = '2';
} else if (input == '2') {
  __params.ReasonTypeCode = 'Organization Transfer from MMF Account to Float Account via STK';
  __next = '2';
}else if (input == '3') {
  __params.ReasonTypeCode = 'Merchant Transfer from Merchant Account to Working Account via web';
  __next = '2';
} else {
  __next = '1';
}","1","Select transfer direction","<html>
<body>
1 From float to working account<br>
2 From working to float<br>
3 From Merchant to working<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23020","23015","Apply Issue School Dinner Voucher (2)","var input = __input.response;
__params.Extra1 = input;
__next = '6';","5","Input description 1","<html>
<body>
Please input the description 1 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23021","23015","Apply Issue School Dinner Voucher (2)","var input = __input.response;
__params.ValidityPeriod = input;
__next = '5';","4","Input validity period","<html>
<body>
Please input the validity period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23022","23015","Apply Issue School Dinner Voucher (2)","var input = __input.response;
if(!empty(input)){
__params.VoucherAmount = __input.response;
__next = '4';
}else{
    __next ='3';
}","3","Input amount","<html>
<body>
Please input the amount of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23023","23015","Apply Issue School Dinner Voucher (2)","var input = __input.response;
__params.ShortCode = input;
__next = '3';","2","Input short Code","<html>
<body>
Please input the redeeming organization short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23024","23015","Apply Issue School Dinner Voucher (2)","var input = __input.response;
if(!empty(input)){
__params.Msisdn = __input.response;
__next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the receiving Msisdn:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23028","23027","Apply Issue School Dinner Voucher (3)","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.IS_RESOLVE_RECEIVER_BY_INITIATOR = '1';  
__params.ReasonTypeCode = 'Issue School Dinner Voucher (3)';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","2303","1023","Operator Initiate Intra-Account Transfer Transaction via Handset","var input = __input.response;
 if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","23030","23027","Apply Issue School Dinner Voucher (3)","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
You will issue a voucher to  ${__params.Msisdn},the amount is ${__params.VoucherAmount},the Redeeming org short code is ${__params.ShortCode}<br>
1 Confirm<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","23031","23027","Apply Issue School Dinner Voucher (3)","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '8';
}else{
    __next ='7';
}","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","23032","23027","Apply Issue School Dinner Voucher (3)","var input = __input.response;
__params.Extra2 = input;
__next = '7';","6","Input description 2","<html>
<body>
Please input the description 2 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23033","23027","Apply Issue School Dinner Voucher (3)","var input = __input.response;
__params.Extra1 = input;
__next = '6';","5","Input description 1","<html>
<body>
Please input the description 1 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23034","23027","Apply Issue School Dinner Voucher (3)","var input = __input.response;
__params.ValidityPeriod = input;
__next = '5';","4","Input validity period","<html>
<body>
Please input the validity period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23035","23027","Apply Issue School Dinner Voucher (3)","var input = __input.response;
if(!empty(input)){
__params.VoucherAmount = __input.response;
__next = '4';
}else{
    __next ='3';
}","3","Input amount","<html>
<body>
Please input the amount of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23036","23027","Apply Issue School Dinner Voucher (3)","var input = __input.response;
__params.ShortCode = input;
__next = '3';","2","Input short Code","<html>
<body>
Please input the redeeming organization short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23037","23027","Apply Issue School Dinner Voucher (3)","var input = __input.response;
if(!empty(input)){
__params.Msisdn = __input.response;
__next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the receiving Msisdn:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","2304","1023","Operator Initiate Intra-Account Transfer Transaction via Handset","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';","3","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23040","23039","Apply Issue School Dinner Voucher (4)","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.IS_RESOLVE_RECEIVER_BY_INITIATOR = '1';  
__params.ReasonTypeCode = 'Issue School Dinner Voucher (4)';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","1","23042","23041","Apply Issue School Dinner Voucher (5)","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.IS_RESOLVE_RECEIVER_BY_INITIATOR = '1';  
__params.ReasonTypeCode = 'Issue School Dinner Voucher (5)';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","1","23044","23043","Apply Issue School Dinner Voucher (6)","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.IS_RESOLVE_RECEIVER_BY_INITIATOR = '1';  
__params.ReasonTypeCode = 'Issue School Dinner Voucher (6)';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","9","23045","23043","Apply Issue School Dinner Voucher (6)","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
You will issue a voucher to  ${__params.Msisdn},the amount is ${__params.VoucherAmount},the Redeeming org short code is ${__params.ShortCode}<br>
1 Confirm<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","23046","23039","Apply Issue School Dinner Voucher (4)","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
You will issue a voucher to  ${__params.Msisdn},the amount is ${__params.VoucherAmount},the Redeeming org short code is ${__params.ShortCode}<br>
1 Confirm<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","23047","23041","Apply Issue School Dinner Voucher (5)","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
You will issue a voucher to  ${__params.Msisdn},the amount is ${__params.VoucherAmount},the Redeeming org short code is ${__params.ShortCode}<br>
1 Confirm<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","23048","23043","Apply Issue School Dinner Voucher (6)","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '8';
}else{
    __next ='7';
}","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","23049","23039","Apply Issue School Dinner Voucher (4)","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '8';
}else{
    __next ='7';
}","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","2305","1023","Operator Initiate Intra-Account Transfer Transaction via Handset","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","23050","23041","Apply Issue School Dinner Voucher (5)","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '8';
}else{
    __next ='7';
}","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","23051","23043","Apply Issue School Dinner Voucher (6)","var input = __input.response;
__params.Extra2 = input;
__next = '7';","6","Input description 2","<html>
<body>
Please input the description 2 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","23052","23039","Apply Issue School Dinner Voucher (4)","var input = __input.response;
__params.Extra2 = input;
__next = '7';","6","Input description 2","<html>
<body>
Please input the description 2 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","23053","23041","Apply Issue School Dinner Voucher (5)","var input = __input.response;
__params.Extra2 = input;
__next = '7';","6","Input description 2","<html>
<body>
Please input the description 2 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23054","23041","Apply Issue School Dinner Voucher (5)","var input = __input.response;
__params.Extra1 = input;
__next = '6';","5","Input description 1","<html>
<body>
Please input the description 1 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23055","23039","Apply Issue School Dinner Voucher (4)","var input = __input.response;
__params.Extra1 = input;
__next = '6';","5","Input description 1","<html>
<body>
Please input the description 1 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23056","23043","Apply Issue School Dinner Voucher (6)","var input = __input.response;
__params.Extra1 = input;
__next = '6';","5","Input description 1","<html>
<body>
Please input the description 1 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23057","23041","Apply Issue School Dinner Voucher (5)","var input = __input.response;
__params.ValidityPeriod = input;
__next = '5';","4","Input validity period","<html>
<body>
Please input the validity period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23058","23039","Apply Issue School Dinner Voucher (4)","var input = __input.response;
__params.ValidityPeriod = input;
__next = '5';","4","Input validity period","<html>
<body>
Please input the validity period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23059","23043","Apply Issue School Dinner Voucher (6)","var input = __input.response;
__params.ValidityPeriod = input;
__next = '5';","4","Input validity period","<html>
<body>
Please input the validity period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","2306","1023","Operator Initiate Intra-Account Transfer Transaction via Handset","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Move Funds ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23060","23043","Apply Issue School Dinner Voucher (6)","var input = __input.response;
if(!empty(input)){
__params.VoucherAmount = __input.response;
__next = '4';
}else{
    __next ='3';
}","3","Input amount","<html>
<body>
Please input the amount of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23061","23039","Apply Issue School Dinner Voucher (4)","var input = __input.response;
if(!empty(input)){
__params.VoucherAmount = __input.response;
__next = '4';
}else{
    __next ='3';
}","3","Input amount","<html>
<body>
Please input the amount of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23062","23041","Apply Issue School Dinner Voucher (5)","var input = __input.response;
if(!empty(input)){
__params.VoucherAmount = __input.response;
__next = '4';
}else{
    __next ='3';
}","3","Input amount","<html>
<body>
Please input the amount of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23063","23043","Apply Issue School Dinner Voucher (6)","var input = __input.response;
__params.ShortCode = input;
__next = '3';","2","Input short Code","<html>
<body>
Please input the redeeming organization short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23064","23039","Apply Issue School Dinner Voucher (4)","var input = __input.response;
__params.ShortCode = input;
__next = '3';","2","Input short Code","<html>
<body>
Please input the redeeming organization short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23065","23041","Apply Issue School Dinner Voucher (5)","var input = __input.response;
__params.ShortCode = input;
__next = '3';","2","Input short Code","<html>
<body>
Please input the redeeming organization short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23066","23043","Apply Issue School Dinner Voucher (6)","var input = __input.response;
if(!empty(input)){
__params.Msisdn = __input.response;
__next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the receiving Msisdn:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23067","23039","Apply Issue School Dinner Voucher (4)","var input = __input.response;
if(!empty(input)){
__params.Msisdn = __input.response;
__next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the receiving Msisdn:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23068","23041","Apply Issue School Dinner Voucher (5)","var input = __input.response;
if(!empty(input)){
__params.Msisdn = __input.response;
__next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the receiving Msisdn:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23074","23073","Create Group","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CreateGroup';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.RequesterIdentifier = msisdn;
__params.GroupType = '10000218';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","23075","23073","Create Group","var input = __input.response;
var length = size(input);
if(length > 64)
{
__next = '1';
}
else
{
__params.GroupCode = input;
__next = '2';
}","1","Enter Group Code","<html>
<body>
Enter Group Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23076","23073","Create Group","var input = __input.response;
if (!empty(input)) {
  __params.GroupName = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Group Name","<html>
<body>
Enter Group Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23077","23073","Create Group","var input = __input.response;
__params.GroupDescription = input;
__next = '5';","3","Enter Group Description","<html>
<body>
Enter Group Description<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23078","23073","Create Group","var input = __input.response;
__params.FirstName = input;
__next = '7';","4","Enter Group Sponsor","<html>
<body>
Enter First name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","23079","23073","Create Group","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","23080","23073","Create Group","var input = __input.response;
__params.KYCInfo = IC.buildGroupKYCInfo(__params);
__params.ProductList = IC.buildGroupProductInfo(__params);
__params.IdentifierList = IC.buildGroupIdentifierListInfo(__params);
__params.GroupBasicInfo = IC.buildGroupBasicInfo(__params);
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html><body>New Group ${__params.RequesterIdentifier}, ${__params.GroupName},${__params.GroupDescription}, ${__params.GroupSponsor}, ${__params.GroupCode}  ${__params.ProductList}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23083","23082","Add Group Member","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'AddGroupMember';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
groups = IC.queryMyGroups(msisdn);
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
  __next = '0';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","23084","23082","Add Group Member","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","0","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a></body>
</html>",""<endrec>
"CUSTOMER","","3","23085","23082","Add Group Member","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
 __params.groupmap = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
DEBUG.error(""===map"",map);
if (!empty(input)) {
roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
 }else {
      __next = '1a';
   }","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23086","23082","Add Group Member","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{

  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23087","23082","Add Group Member","var input = __input.response;
__params.InvitedMSISDN = input;
__params.map = IC.queryCustomerName(__params.InvitedMSISDN);
if (!empty(input)) {
      __next = '3';
   } 
 else 
   {
      __next = '2';
   }","2","Input Invited Group Member MSISDN","<html>
<body>
Input Invited Group Member MSISDN <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23088","23082","Add Group Member","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(roleList)){
 __params.MemberRole = IC.bulidMemberRole(__params, roleList.get(i).roleId, roleList.get(i).roleName);
  __next = '4';
  }else {
  __next = '3';
}","3","Select Role","<html>
<body>
Please Select Role:<br>
$$ var index = 1;
$$ for (role: roleList){
 ${index} ${role.roleName}<br>
$$ index=index+1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","23089","23082","Add Group Member","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","23090","23082","Add Group Member","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>Group details: ${__params.ReceiverPartyIdentifier}<br>
Group Name: ${__params.groupmap.groupName}<br>
Invited MSISDN :${__params.InvitedMSISDN}<br>
Customer First Name : ${__params.map.firstName}<br>
Customer Last Name : ${__params.map.lastName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23092","23091","Remove Group Member","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'RemoveGroupMember';
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn; /* MSISDN */
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn; /* MSISDN */
__params.ReceiverPartyIdentifierType= '15'; /* Group Code*/
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","23093","23091","Remove Group Member","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23094","23091","Remove Group Member","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.ReceiverPartyIdentifier = input;
 __params.groupmap = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
DEBUG.error(""===map"",map);
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23095","23091","Remove Group Member","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23096","23091","Remove Group Member","var input = __input.response;
if (!empty(input)) {
  __params.RemovedMSISDN = input;
__params.map = IC.queryCustomerName(__params.RemovedMSISDN);
  __next = '4';
} else {
  __next = '3';
}","3","Enter Removed Customer MSISDN","<html>
<body>
Enter Removed Customer MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23097","23091","Remove Group Member","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","23098","23091","Remove Group Member","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>Group details: ${__params.ReceiverPartyIdentifier}<br>
Group Name: ${__params.groupmap.groupName}<br>
Removed MSISDN :${__params.RemovedMSISDN}<br>
Customer First Name : ${__params.map.firstName}<br>
Customer Last Name : ${__params.map.lastName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23100","23099","Change Group Member Role","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ChangeGroupMemberRole';
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '15'; /* MSISDN */
groups = IC.queryMyGroups(msisdn);
recipientList= IC.queryPreValidationNotification(msisdn,'01','',0,'');
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","23101","23099","Change Group Member Role","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23102","23099","Change Group Member Role","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
 __params.map = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
DEBUG.error(""===map"",map);
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23103","23099","Change Group Member Role","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23104","23099","Change Group Member Role","var input = __input.response;
__params.groupmap = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
if (!empty(input)) {
  __params.ChangedMSISDN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Changed MSISDN","<html>
<body>
Enter Changed MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23105","23099","Change Group Member Role","var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(listRoles)) {
                __params.RemoveRole=listRoles.get(i).roleId;
                __params.RemoveRoleName=listRoles.get(i).name;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '3';
    }","4","Select Remove Group Member Role","<html>
<body>
Select Remove Group Member Role:<br>
$$listRoles= IC.queryCurrentMemberRole(__params.ReceiverPartyIdentifier,__params.InitiatorIdentifier,__params.ChangedMSISDN);
$$if (empty(listRoles)) {
  The customer (initiator, requester, or the recharge party) has not been invited to join the group or the customer has been invited but has not confirmed the invitation.
$$} else {
  $$var i = 1;
  $$for(role: listRoles) {
  ${i} ${role.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","23106","23099","Change Group Member Role","var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(addListRoles)) {
               __params.AddRole=addListRoles.get(i).roleId;
               __params.AddRoleName=addListRoles.get(i).name;
                __secure = true;
                __next = '6';
         } else {
                __next = '5';
         }
    } else {
        __next = '4';
    }","5","Select Add Group Member Role","<html>
<body>
Select Add Group Member Role:<br>
$$addListRoles= IC.queryAvailableMemberRole(__params.ReceiverPartyIdentifier,__params.InitiatorIdentifier,__params.ChangedMSISDN);
$$if (empty(addListRoles)) {
  The customer (initiator, requester, or the recharge party) has not been invited to join the group or the customer has been invited but has not confirmed the invitation.
$$} else {
  $$var i = 1;
  $$for(role: addListRoles) {
  ${i} ${role.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","23107","23099","Change Group Member Role","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
   __params.AddRoleList = IC.bulidAddMemberRoleInfo(__params);
  __params.RemoveRoleList = IC.bulidRemoveMemberRoleInfo(__params);
    __next = '6a';
} else {
    __secure = true;
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","23108","23099","Change Group Member Role","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>Group details: ${__params.ReceiverPartyIdentifier}<br>
Group Name: ${__params.map.groupName}<br>
Confirm to change group member ${__params.ChangedMSISDN} from role ${__params.RemoveRoleName} to ${__params.AddRoleName}?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23113","1400","Group ATM Deposit Voucher(Value)","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.VoucherAmount= TC.convertAmountFormat(input);
    __next = '4';
} else {
    __secure = true;
    __next = '4';
}","3","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23115","23114","Group ATM Deposit Voucher(Valueless)","__params.ServiceCode = __service.serviceCode;
__params.VoucherServiceType = '2'; /* VoucherServiceType */ 
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group*/ 
__secure = true;
__params.ReasonTypeCode = 'Group request ATM Deposit Voucher ( Valueless )'; 
atmProviders = Util.getAllATMProvidersOfDeposit();
providerName='';

 if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
 else if(size(atmProviders ) == 1) 
   {
      providerName= atmProviders.get(0);
      __params.ShortCode= Util.getShortCodeByName(providerName);
      __next = '2';
   }
  else
 {
       __next = '1';
 }","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","23116","23114","Group ATM Deposit Voucher(Valueless)","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23117","23114","Group ATM Deposit Voucher(Valueless)","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23118","23114","Group ATM Deposit Voucher(Valueless)","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(atmProviders)) {
   providerName= atmProviders.get(i);
   __params.ShortCode= Util.getShortCodeByName(providerName);
   __next = '3';
} else {
   __next = '2';
}","2","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23119","23114","Group ATM Deposit Voucher(Valueless)","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.ReceiverPartyIdentifier = input;
    __next = '2'; 
} 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23122","23121","Group ATM Withdraw Voucher(value)","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group */ 
__secure = true;
__params.ReasonTypeCode = 'Group Request ATM Withdrawal Voucher ( Value )'; 
atmProviders = Util.getAllATMProviders();
providerName='';

 if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
 else if(size(atmProviders ) == 1) 
   {
      providerName= atmProviders.get(0);
      __params.ShortCode= Util.getShortCodeByName(providerName);
      __next = '2';
   }
  else
 {
       __next = '1';
 }","begin","set parammeters","",""<endrec>
"CUSTOMER","","7","23123","23121","Group ATM Withdraw Voucher(value)","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23124","23121","Group ATM Withdraw Voucher(value)","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23125","23121","Group ATM Withdraw Voucher(value)","var input = __input.response;
__params.Remark = input;
__next = '5';","4","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23126","23121","Group ATM Withdraw Voucher(value)","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.VoucherAmount= TC.convertAmountFormat(input);
    __next = '4';
} else {
    __secure = true;
    __next = '4';
}","3","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23127","23121","Group ATM Withdraw Voucher(value)","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(atmProviders)) {
   providerName= atmProviders.get(i);
   __params.ShortCode= Util.getShortCodeByName(providerName);
   __next = '3';
} else {
   __next = '2';
}","2","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23128","23121","Group ATM Withdraw Voucher(value)","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.ReceiverPartyIdentifier = input;
    __next = '2'; 
} 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","23132","23131","CCH Create Group","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CreateGroup';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.InitiatorIdentifier = msisdn;
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.RequesterIdentifier = msisdn;
__params.GroupType = '10000248';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","23133","23131","CCH Create Group","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '3';
} else {
  __next = '1';
}","1","Enter Requesting Customer MSISDN","<html>
<body>
Enter Requesting Customer MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","23134","23131","CCH Create Group","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'yyyyMMdd')) {
    __next = '2';
} else {
    __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
    __next = '3';
}","2","Enter Customer Date of Birth(YYYYMMDD)","<html>
<body>
Enter Customer Date of Birth(YYYYMMDD)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","23135","23131","CCH Create Group","var input = __input.response;
var length = size(input);
if(length > 64)
{
__next = '3';
}
else
{
__params.GroupCode = input;
__next = '4';
}","3","Enter Group Code","<html>
<body>
Enter Group Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","23136","23131","CCH Create Group","var input = __input.response;
if (!empty(input)) {
  __params.GroupName = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Group Name","<html>
<body>
Enter Group Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","23137","23131","CCH Create Group","var input = __input.response;
__params.GroupDescription = input;
__next = '7';","5","Enter Group Description","<html>
<body>
Enter Group Description<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","23138","23131","CCH Create Group","var input = __input.response;
__params.GroupSponsor = input;
__next = '7';","6","Enter Group Sponsor","<html>
<body>
Enter Group Sponsor<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","23139","23131","CCH Create Group","var input = __input.response;
if (input == '1') {
  __next = '8';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html><body>New Group ${__params.RequesterIdentifier}, ${__params.GroupName},${__params.GroupDescription}, ${__params.GroupSponsor}, ${__params.GroupCode}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","23140","23131","CCH Create Group","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '9';
} else {
  __next = '8';
}","8","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","23141","23131","CCH Create Group","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo = IC.buildGroupKYCInfo(__params);
__params.ProductList = IC.buildGroupProductInfo(__params);
__params.IdentifierList = IC.buildGroupIdentifierListInfo(__params);
__params.GroupBasicInfo = IC.buildGroupBasicInfo(__params);
__next = 'end';","9","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","23143","23142","Add Group Member","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CCHAddGroupMember';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType ='15'; /* SHORT_CODE */
__params.RequesterIdentifierType = ""01"";
__params.RequesterIdentifier = __msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
__next = '1a';","begin","set parammeters","",""<endrec>
"TILL","","3","23144","23142","Add Group Member","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","0","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a></body>
</html>",""<endrec>
"TILL","","4","23145","23142","Add Group Member","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '1c';
}else {
   __errormsg = 'The group you inputed is not exist in system or status is closed';
   __next = 'error';
}
 }else {
      __next = '1a';
  }","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","23146","23142","Add Group Member","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{

  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","23147","23142","Add Group Member","var input = __input.response;
__params.InvitedMSISDN = input;
__params.groupmap = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
if (!empty(input)) {
      __next = '3';
   } 
 else 
   {
      __next = '2';
   }","2","Input Invited Group Member MSISDN","<html>
<body>
Input Invited Group Member MSISDN <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","23148","23142","Add Group Member","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(roleList)){
 __params.MemberRole = IC.bulidMemberRole(__params, roleList.get(i).roleId, roleList.get(i).roleName);
  __next = '3b';
  }else {
  __next = '3';
}","3","Select Role","<html>
<body>
Please Select Role:<br>
$$ var index = 1;
$$ for (role: roleList){
 ${index} ${role.roleName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","23149","23142","Add Group Member","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter Leader Customer PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","23150","23142","Add Group Member","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23202","23201","Group G2P Transfer","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","10","23203","23201","Group G2P Transfer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","23204","23201","Group G2P Transfer","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","23205","23201","Group G2P Transfer","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.PIN = input;
    __next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","23206","23201","Group G2P Transfer","var input = __input.response;
__params.Remark = input;
__next = '6';","5","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23207","23201","Group G2P Transfer","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23208","23201","Group G2P Transfer","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '4';","3","Enter Recipient MSISDN","<html>
<body>
Enter Recipient MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23209","23201","Group G2P Transfer","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23210","23201","Group G2P Transfer","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.PrimaryPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23211","23201","Group G2P Transfer","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","23214","23213","Create Coupon","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"TILL","","9","23301","23142","Add Group Member","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '3a';
} else {
    __secure = true;

    roleTypes = IC.queryOrgOperatorAllRoleType(input);
    if (null == roleTypes || empty(roleTypes)) {
         __errormsg = 'There are not any role type to select.';
         __next = 'error';
     } else { 
         __params.InitiatorIdentifier = input;
         __next = '4';
    }
}","3a","Enter Your Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","23303","23302","Create Group","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';      /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ActionType = 'CreateGroup';
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
  __next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","23304","23302","Create Group","var input = __input.response;
var length = size(input);
if(length > 64)
{
__next = '1';
}
else
{
__params.GroupCode = input;
__next = '2';
}","1","Enter Group Code","<html>
<body>
Enter Group Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","23305","23302","Create Group","var input = __input.response;
if (!empty(input)) {
  __params.GroupName = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Group Name","<html>
<body>
Enter Group Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","23306","23302","Create Group","var input = __input.response;
__params.GroupDescription = input;
__next = '4';","3","Enter Group Description","<html>
<body>
Enter Group Description<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","23307","23302","Create Group","var input = __input.response;
__params.GroupSponsor = input;
__next = '5';","4","Enter Group Sponsor","<html>
<body>
Enter Group Sponsor<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","23308","23302","Create Group","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","23309","23302","Create Group","var input = __input.response;
__params.KYCInfo = IC.buildGroupKYCInfo(__params);
__params.ProductList = IC.buildGroupProductInfo(__params);
__params.IdentifierList = IC.buildGroupIdentifierListInfo(__params);
__params.GroupBasicInfo = IC.buildGroupBasicInfo(__params);
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html><body>New Group ${__params.RequesterIdentifier}, ${__params.GroupName},${__params.GroupDescription}, ${__params.GroupSponsor}, ${__params.GroupCode}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","23311","23310","Remove Group Member","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';      /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ActionType = 'RemoveGroupMember';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
groups = IC.queryMyGroups(msisdn);
__next = '2a';","begin","set parammeters","",""<endrec>
"TILL","","2","23312","23310","Remove Group Member","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","23313","23310","Remove Group Member","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __params.groupmap = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","23314","23310","Remove Group Member","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","23315","23310","Remove Group Member","var input = __input.response;
if (!empty(input)) {
  __params.RemovedMSISDN = input;
  __params.map = IC.queryCustomerName(__params.RemovedMSISDN);
  __next = '3a';
} else {
  __next = '4';
}","3","Enter Removed Customer MSISDN","<html>
<body>
Enter Removed Customer MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","23316","23310","Remove Group Member","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter Leader Customer PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","23317","23310","Remove Group Member","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Group details: ${__params.ReceiverPartyIdentifier}<br>
Group Name: ${__params.groupmap.groupName}<br>
Confirm to remove group member ${__params.RemovedMSISDN}?<br>
Customer First Name : ${__params.map.firstName}<br>
Customer Last Name : ${__params.map.lastName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","23319","23318","CCH Change Group Member Role","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CCHChangeGroupMemberRole';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.GroupType = '10000169';
__next = '1a';","begin","set parammeters","",""<endrec>
"TILL","","6","23320","23318","CCH Change Group Member Role","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1c';
}","1c","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a></body>
</html>",""<endrec>
"TILL","","7","23321","23318","CCH Change Group Member Role","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '2c';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","23322","23318","CCH Change Group Member Role","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","23323","23318","CCH Change Group Member Role","var input = __input.response;
__params.groupmap = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
if (!empty(input)) {
  __params.ChangedMSISDN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Changed MSISDN","<html>
<body>
Enter Changed MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","23324","23318","CCH Change Group Member Role","var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(listRoles)) {
                __params.RemoveRole=listRoles.get(i).roleId;
                __params.RemoveRoleName=listRoles.get(i).name;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '3';
    }","4","Select Remove Group Member Role","<html>
<body>
Select Remove Group Member Role:<br>
$$listRoles= IC.queryCurrentMemberRole(__params.ReceiverPartyIdentifier,__params.InitiatorIdentifier,__params.ChangedMSISDN);
$$if (empty(listRoles)) {
  The customer (initiator, requester, or the recharge party) has not been invited to join the group or the customer has been invited but has not confirmed the invitation.
$$} else {
  $$var i = 1;
  $$for(role: listRoles) {
  ${i} ${role.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","23325","23318","CCH Change Group Member Role","var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(addListRoles)) {
               __params.AddRole=addListRoles.get(i).roleId;
               __params.AddRoleName=addListRoles.get(i).name;
                __secure = true;
                __next = '5a';
         } else {
                __next = '6';
         }
    } else {
        __next = '4';
    }","5","Select Add Group Member Role","<html>
<body>
Select Add Group Member Role:<br>
$$addListRoles= IC.queryAvailableMemberRole(__params.ReceiverPartyIdentifier,__params.InitiatorIdentifier,__params.ChangedMSISDN);
$$if (empty(addListRoles)) {
  The customer (initiator, requester, or the recharge party) has not been invited to join the group or the customer has been invited but has not confirmed the invitation.
$$} else {
  $$var i = 1;
  $$for(role: addListRoles) {
  ${i} ${role.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","16","23326","23318","CCH Change Group Member Role","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
   __params.AddRoleList = IC.bulidAddMemberRoleInfo(__params);
  __params.RemoveRoleList = IC.bulidRemoveMemberRoleInfo(__params);
    __next = '6a';
} else {
    __secure = true;
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter OperatorPIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","15","23327","23318","CCH Change Group Member Role","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to change group member ${__params.ChangedMSISDN} from role ${__params.RemoveRoleName} to ${__params.AddRoleName}?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","23401","23142","Add Group Member","var input = __input.response;
if (!empty(input)) {
 __params.InitiatorIdentifier = input ;
__params.RequesterIdentifier = input;
  __next = '2';
}else {
      __next = '1c';
   }","1c","Enter Leader MSISDN","<html>
<body>
Enter Leader MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","23402","23310","Remove Group Member","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '4';
} else {
  __next = '3a';
}","3a","Enter Leader customer MSISDN","<html>
<body>
Enter Leader customer MSISDN <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","14","23403","23318","CCH Change Group Member Role","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '6';","5a","operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","23404","23318","CCH Change Group Member Role","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '3';
} else {
  __next = '2a';
}","2c","Enter Leader customer MSISDN","<html>
<body>
Enter Leader customer MSISDN <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23419","23418","Activate Group Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'ActiveGroupFSIProducts';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
__params.OrgShortCode = '262626';
groups = IC.queryMyGroups(msisdn);
  __next = '0';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","23420","23418","Activate Group Account","var input = __input.response;
__params.@HEAD@PIN = input;
__next = 'end';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23421","23418","Activate Group Account","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  
  roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23422","23418","Activate Group Account","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
 }else {
      __next = '1a';
   }","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23423","23418","Activate Group Account","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","0","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","23425","23424","Org withdrawal from group","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* TILL_NO */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","23426","23424","Org withdrawal from group","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
  __next = '2';","1","Enter group code","<html>
<body>
Enter Group Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","23427","23424","Org withdrawal from group","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '5';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","23428","23424","Org withdrawal from group","var input = __input.response;
__params.PIN = input;
__next = '4';","3","enter pin","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","23429","23424","Org withdrawal from group","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","confirm","<html>
<body>
Withdraw cash from ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","23431","23424","Org withdrawal from group","var input = __input.response;
__params.InitiatorIdentifier = input;
__next = '3';","5","Enter Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","23433","23432","Buy Goods from the Group Account","__params.ServiceCode = __service.serviceCode;
__params.ReasonType = 'Buy Goods from the Group Account';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* TILL_NO */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","23434","23432","Buy Goods from the Group Account","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
  __next = '2';","1","Enter group code","<html>
<body>
Enter Group Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","23435","23432","Buy Goods from the Group Account","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '5';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","23436","23432","Buy Goods from the Group Account","var input = __input.response;
__params.InitiatorIdentifier = input;
__next = '3';","5","Enter Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","23437","23432","Buy Goods from the Group Account","var input = __input.response;
__params.PIN = input;
__next = '4';","3","enter pin","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","23438","23432","Buy Goods from the Group Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","confirm","<html>
<body>
Buy Goods from ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","23440","23439","Transfer funds to Group Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* TILL_NO */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","23441","23439","Transfer funds to Group Account","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
 __params.map = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
DEBUG.error(""===map"",map);
  __next = '2';","1","Enter group code","<html>
<body>
Enter Group Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","23442","23439","Transfer funds to Group Account","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '5';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","23443","23439","Transfer funds to Group Account","var input = __input.response;
__params.InitiatorIdentifier = input;
__next = '3';","5","Enter Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","23444","23439","Transfer funds to Group Account","var input = __input.response;
__params.PIN = input;
__next = '4';","3","enter pin","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","23445","23439","Transfer funds to Group Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","confirm","<html>
<body>
Transfer funds to Group ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
Group Name: ${__params.map.groupName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23457","23456","Query Group Mini Statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '15'; /* Group Code */
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","23458","23456","Query Group Mini Statement","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23459","23456","Query Group Mini Statement","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23460","23456","Query Group Mini Statement","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23461","23456","Query Group Mini Statement","if (empty(accountTypes)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(accountTypes)) {
                __params.AccountTypeCode =  accountTypes.get(i);
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Account Type","<html>
<body>
Please select account:<br>
$$accountTypes = IC.queryAllAccountsByGroupCode(__params.ReceiverPartyIdentifier);
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23462","23456","Query Group Mini Statement","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","23463","23456","Query Group Mini Statement","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23466","23465","Query Group List","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'QueryGroupList';
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","23467","23465","Query Group List","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '2';
} else {
    __secure = true;
    __next = '1';
}","1","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23468","23465","Query Group List","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","23513","23512","Approve Transaction","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ApproveGroupTask';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","23514","23512","Approve Transaction","var input = __input.response;
if (!empty(input)) {
  __params.OrderID= input;
  __next = '2';
} else {
  __next = '1';
}","1","Input ReminderID","<html>
<body>
Please enter the ReminderID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","23515","23512","Approve Transaction","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
    __secure = true;


    __next = '3a';
    
}","2","Select Option","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","23516","23512","Approve Transaction","__params.ApproverMSISDN = __params.InitiatorIdentifier;
var input = __input.response;
queryapprovalinfo = IC.queryApprovalInfo(__params.InitiatorIdentifier,__params.OrderID,input);
var amout = queryapprovalinfo.amount;
if (!empty(input)) {
if (!empty(amout)) {
  __params.GroupCode = input;
  __next = '5';
} else {
  __params.GroupCode = input;
  __next = '5';
}
} else {
  __next = '3a';
}","3a","Input GroupCode","<html>
<body>
Please enter the GroupCode:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","23517","23512","Approve Transaction","var input = __input.response;
if (!empty(input)) {
  __params.@HEAD@PIN = input;
  __next = '6';
} else {
  __next = '5';
}","5","Input PIN","<html>
<body>
Please enter the PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","23518","23512","Approve Transaction","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
__next = 'cancel';
} else {
  __next = '6';
}","6","Complete","<html>
<body>
You have completed the approval please press 1 End<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23522","23521","M-Shwari Deposit for Group","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '262626';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Deposit';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","7","23523","23521","M-Shwari Deposit for Group","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Deposit ${__params.Amount} in bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23524","23521","M-Shwari Deposit for Group","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23525","23521","M-Shwari Deposit for Group","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23526","23521","M-Shwari Deposit for Group","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23527","23521","M-Shwari Deposit for Group","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.PrimaryPartyIdentifier = input;
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23528","23521","M-Shwari Deposit for Group","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23530","23529","M-Shwari Withdraw for Group","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '262626';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Withdraw';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","7","23531","23529","M-Shwari Withdraw for Group","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Withdraw ${__params.Amount} from bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23532","23529","M-Shwari Withdraw for Group","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23533","23529","M-Shwari Withdraw for Group","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23534","23529","M-Shwari Withdraw for Group","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23535","23529","M-Shwari Withdraw for Group","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.PrimaryPartyIdentifier = input;
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23536","23529","M-Shwari Withdraw for Group","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23538","23537","M-Shwari Bank Balance for Group","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='262626';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Saving_Account_Balance';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","6","23539","23537","M-Shwari Bank Balance for Group","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
M-Shwari Bank Balance for Group - Group Code - ${__params.ReceiverPartyIdentifier}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23540","23537","M-Shwari Bank Balance for Group","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23541","23537","M-Shwari Bank Balance for Group","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '3';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23542","23537","M-Shwari Bank Balance for Group","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '3';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
 }else {
      __next = '2a';
   }","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23543","23537","M-Shwari Bank Balance for Group","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23545","23544","M-Shwari FSI Mini Statement for Group","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='262626';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Mini_Statement';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","6","23546","23544","M-Shwari FSI Mini Statement for Group","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
M-Shwari FSI Mini Statement for Group - Group Code - ${__params.ReceiverPartyIdentifier}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23547","23544","M-Shwari FSI Mini Statement for Group","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23548","23544","M-Shwari FSI Mini Statement for Group","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '3';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23549","23544","M-Shwari FSI Mini Statement for Group","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '3';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
 }else {
      __next = '2a';
   }","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23550","23544","M-Shwari FSI Mini Statement for Group","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23602","23601","Group FSI Loan For M-Shwari","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '262626';
__params.Amount = '0';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Request';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","7","23603","23601","Group FSI Loan For M-Shwari","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Request ${__params.ReceiverPartyIdentifier} ${__referenceData.RequestBalance} loans?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23604","23601","Group FSI Loan For M-Shwari","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23605","23601","Group FSI Loan For M-Shwari","var input = __input.response;
if (Validator.isAmount(input)) {
    __referenceData.RequestBalance = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23606","23601","Group FSI Loan For M-Shwari","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23607","23601","Group FSI Loan For M-Shwari","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.PrimaryPartyIdentifier = input;
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23608","23601","Group FSI Loan For M-Shwari","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23609","23073","Create Group","var input = __input.response;
__params.LastName = input;
__next = '5';","7","input last name","<html>
<body>
Enter Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","23611","23610","Org Withdrawal by Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; 
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__params.RequesterIdentifierType = '01';  /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","23612","23610","Org Withdrawal by Voucher","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.GroupCode = input;
     __next = '2';     
   } 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","23613","23610","Org Withdrawal by Voucher","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Requesting Customer MSISDN","<html>
<body>
Requesting Customer MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","23614","23610","Org Withdrawal by Voucher","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '4';","3","Enter Voucher Code","<html>
<body>
Enter Voucher Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","23615","23610","Org Withdrawal by Voucher","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '5';
} else {
    __next = '4';
}","4","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","23616","23610","Org Withdrawal by Voucher","var input = __input.response;
__params.Remark = input;
__next = '6';","5","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","23617","23610","Org Withdrawal by Voucher","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '7';","6","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","23618","23610","Org Withdrawal by Voucher","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","23619","23610","Org Withdrawal by Voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","23620","23610","Org Withdrawal by Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html><body>Redeem Voucher - ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23702","23701","Group FSI Loan Repayment For M-Shwari","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '262626';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Repayment';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","7","23703","23701","Group FSI Loan Repayment For M-Shwari","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Pay ${__params.Amount} loans?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23704","23701","Group FSI Loan Repayment For M-Shwari","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23705","23701","Group FSI Loan Repayment For M-Shwari","var input = __input.response;
if (Validator.isAmount(input)) {
    __referenceData.RequestBalance = TC.convertAmountFormat(input);
    __params.Amount = __referenceData.RequestBalance;
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23706","23701","Group FSI Loan Repayment For M-Shwari","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23707","23701","Group FSI Loan Repayment For M-Shwari","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.PrimaryPartyIdentifier = input;
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23708","23701","Group FSI Loan Repayment For M-Shwari","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23710","23709","Group FSI Loan Repayment from Savings For M-Shwari","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '262626';
__params.Amount = '0';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Payment_from_Savings';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","7","23711","23709","Group FSI Loan Repayment from Savings For M-Shwari","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Pay ${__referenceData.RequestBalance} loans from group savings?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","23712","23709","Group FSI Loan Repayment from Savings For M-Shwari","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23713","23709","Group FSI Loan Repayment from Savings For M-Shwari","var input = __input.response;
if (Validator.isAmount(input)) {
    __referenceData.RequestBalance = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23714","23709","Group FSI Loan Repayment from Savings For M-Shwari","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23715","23709","Group FSI Loan Repayment from Savings For M-Shwari","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.PrimaryPartyIdentifier = input;
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","23716","23709","Group FSI Loan Repayment from Savings For M-Shwari","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23802","23801","Apply ATM Voucher","__params.ServiceCode = __service.serviceCode;
__params.VoucherServiceType = '2'; /* VoucherServiceType */ 
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group*/ 
__secure = true;
__params.ReasonTypeCode = 'Apply Group ATM Deposit Voucher'; 
atmProviders = Util.getAllATMProvidersOfDeposit();
providerName='';

 if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
 else if(size(atmProviders ) == 1) 
   {
      providerName= atmProviders.get(0);
      __params.ShortCode= Util.getShortCodeByName(providerName);
      __next = '2';
   }
  else
 {
       __next = '1';
 }","begin","set parammeters","",""<endrec>
"CUSTOMER","","1","23804","23803","Apply ATM Voucher for Group","__params.ServiceCode = __service.serviceCode;
__params.VoucherServiceType = '2'; /* VoucherServiceType */ 
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.IS_RESOLVE_RECEIVER_BY_INITIATOR = '1';  
__params.ReceiverPartyIdentifierType = '15'; /* Group*/ 
__secure = true;
__params.ReasonTypeCode = 'Customer request ATM deposit for group (non member)'; 
atmProviders = Util.getAllATMProvidersOfDeposit();
providerName='';

 if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
 else if(size(atmProviders ) == 1) 
   {
      providerName= atmProviders.get(0);
      __params.ShortCode= Util.getShortCodeByName(providerName);
      __next = '1';
   }
  else
 {
       __next = '1';
 }","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","23805","23803","Apply ATM Voucher for Group","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.ReceiverPartyIdentifier = input;
    __next = '2'; 
} 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","23806","23803","Apply ATM Voucher for Group","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(atmProviders)) {
   providerName= atmProviders.get(i);
   __params.ShortCode= Util.getShortCodeByName(providerName);
   __next = '3';
} else {
   __next = '2';
}","2","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","23807","23803","Apply ATM Voucher for Group","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","23808","23803","Apply ATM Voucher for Group","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","23810","21805","Organisation ATM Deposit Voucher Request","var input = __input.response;
if (input == '1') {
  __params.ReasonTypeCode = 'Organization request ATM Deposit Voucher with Value'; 
  __next = '7';
} else if (input == '2') {
  __params.ReasonTypeCode = 'Org Request ATM Deposit Voucher'; 
  __next = '2';
} else {
  __next = '6';
}","6","Choose Value or Valueless","<html>
<body>
Choose Value or Valueless<br>
1. With Value<br>
2. Without Value<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","23811","21805","Organisation ATM Deposit Voucher Request","var input = __input.response;
if(!empty(input)){
__params.VoucherAmount = __input.response;
__next = '2';
}else{
    __next ='7';
}","7","Enter Amount","<html>
<body>
Please input the amount of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","23812","21807","Organisation ATM Withdraw Voucher Request","var input = __input.response;
if (input == '1') {
  __params.ReasonTypeCode = 'Org Request ATM Withdrawal Voucher with Value'; 
  __next = '7';
} else if (input == '2') {
  __params.ReasonTypeCode = 'Org Request ATM Withdrawal Voucher'; 
  __next = '2';
} else {
  __next = '6';
}","6","Choose Value or Valueless","<html>
<body>
Choose Value or Valueless<br>
1. With Value<br>
2. Without Value<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","23813","21807","Organisation ATM Withdraw Voucher Request","var input = __input.response;
if(!empty(input)){
__params.VoucherAmount = __input.response;
__next = '2';
}else{
    __next ='7';
}","7","Enter Amount","<html>
<body>
Please input the amount of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","23815","23814","Customer Apply Deposit Voucher for Group","__params.ServiceCode = __service.serviceCode;
__params.VoucherServiceType = '2'; /* VoucherServiceType */ 
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.IS_RESOLVE_RECEIVER_BY_INITIATOR = '1';  
__params.ReceiverPartyIdentifierType = '15'; /* Group*/ 
__secure = true;
__params.ReasonTypeCode = 'Customer Apply Voucher for Group'; 
atmProviders = Util.getAllATMProvidersOfDeposit();
providerName='';

 if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
 else if(size(atmProviders ) == 1) 
   {
      providerName= atmProviders.get(0);
      __params.ShortCode= Util.getShortCodeByName(providerName);
      __next = '1';
   }
  else
 {
       __next = '1';
 }","begin","set parammeters","",""<endrec>
"TILL","","1","23902","23901","Org Apply Group ATM Withdrawal Voucher","__params.ServiceCode = __service.serviceCode;
__params.VoucherServiceType = '2'; /* VoucherServiceType */ 
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */

__params.ReceiverPartyIdentifierType = '15'; /* Group */ 
__params.Msisdn ='40720331974';
__secure = true;
__params.ReasonTypeCode = 'Org apply Voucher for Group'; 
atmProviders = Util.getAllATMProviders();
providerName='';
if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
 else if(size(atmProviders ) == 1) 
   {
      providerName= atmProviders.get(0);
      __params.ShortCode= Util.getShortCodeByName(providerName);
      __next = '2';
   }
  else
 {
       __next = '2';
 }","begin","set parammeters","",""<endrec>
"TILL","","2","23903","23901","Org Apply Group ATM Withdrawal Voucher","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.ReceiverPartyIdentifier = input;
    __next = '3'; 
} 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","23904","23901","Org Apply Group ATM Withdrawal Voucher","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(atmProviders)) {
   providerName= atmProviders.get(i);
   __params.ShortCode= Util.getShortCodeByName(providerName);
   __next = '1';
} else {
   __next = '2';
}","2","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","23905","23901","Org Apply Group ATM Withdrawal Voucher","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.VoucherAmount= TC.convertAmountFormat(input);
    __next = '4';
} else {
    __secure = true;
    __next = '4';
}","3","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","23906","23901","Org Apply Group ATM Withdrawal Voucher","var input = __input.response;
__params.Remark = input;
__next = '7';","4","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","23907","23901","Org Apply Group ATM Withdrawal Voucher","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","23908","23901","Org Apply Group ATM Withdrawal Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","23909","23901","Org Apply Group ATM Withdrawal Voucher","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","7","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","23911","1542","Issue Coupon","var input = __input.response;
var length = size(input);
if(length < __params.minLength  || length > __params.maxLength )
{
__params.info = 'The length of a secret code must be in the range of [' + __params.minLength + ',' + __params.maxLength + '], please enter secret code again!';
__next = '8';
}
else if(!empty(__params.rule) && input !~ __params.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __params.rule + ', please enter secret code again!';
__next = '8';
}
else
{
__params.VoucherSecretCode = input;
__next = '9';
}","8","Enter secret code","<html>
<body>${__params.info}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","24002","1007","Send Money","var input = __input.response;
__params.VoucherSecretCode= input;
__next = '2b';","2a","enter secret code","<html>
<body>
Please enter Secret Code.(the length must be 7)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","2401","1024","Customer pay bill","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
orgBeneficiaries = IC.queryOrgListBeneficiary(msisdn);
CurrencyCode  = """";
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
__next = '0';","begin","Initialization ","",""<endrec>
"CUSTOMER","","10","2405","1024","Customer pay bill","var input = __input.response;
__params.BillReferenceNumber = input;
DEBUG.error('input',input);
var isManual = TC.isManualSelectionMode(__params.ServiceCode);
DEBUG.error('isManual',isManual);
if (isManual) {
   reasonTypes = TC.queryReasonTypes(__params.ServiceCode);
DEBUG.error('resasionTypes',reasonTypes);
DEBUG.error('resasionTypes_size',size(reasonTypes));
   if (empty(reasonTypes) || size(reasonTypes) == 0) {
      __errormsg = 'Sorry, there is not any reason types.';
      __next = 'error';
   } else {
__params.put('TransOutgoingRequest@LIST@Param.BillReferenceNumber',__params.BillReferenceNumber);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode',__params.ReceiverPartyIdentifier);
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',__params.AccessDeviceIdentifier);
map=AG.sendTransOutgoingByParams(__params,'52');
DEBUG.error('map1',map);
      __next = '4';
   }  
} else {
__params.put('TransOutgoingRequest@LIST@Param.BillReferenceNumber',__params.BillReferenceNumber);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode',__params.ReceiverPartyIdentifier);
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',__params.AccessDeviceIdentifier);
map=AG.sendTransOutgoingByParams(__params,'52');
DEBUG.error('params',__params);
DEBUG.error('map2',map);
   __next = '5';
}","3","Input Bill No","<html>
<body>
Input Bill No <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","2406","1024","Customer pay bill","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(reasonTypes)) {
   __params.ReasonTypeCode = reasonTypes.get(i).getAlias();
   __next = '5';
} 
else {
   __next = '4';
}","4","Input Reason Type","<html>
<body>
$$test =empty(map)?'':map.get('test');
${test} Please select reason type:<br>
$$ var index = 1;
$$ for (reasonType : reasonTypes) {
  ${index} ${reasonType.getDisplayName(identity.locale)}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","2407","1024","Customer pay bill","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                CurrencyCode =  type;
                __params.Currency = type;
                __secure = true;
                __next = '6';
         } else {
                __next = '5';
         }
    } else {
        __next = '5';
    }
}","5","Choose CurrencyCode","<html>
<body>
$$test =empty(map)?'':map.get('test');
${test} Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currency to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","24101","20160","Unlock PIN","var input = __input.response;
if (input == null || empty(input)) {
    __next = '2a';
} else {
    __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '2';
}","2a","Enter Date Of Birth","<html>
<body>
Enter Date Of Birth<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","24103","24102","Query Group Account Balance","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '15'; /* Group Code */
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","7","24104","24102","Query Group Account Balance","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","24105","24102","Query Group Account Balance","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter Pin","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","24106","24102","Query Group Account Balance","if (empty(accountTypes)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(accountTypes)) {
                __params.AccountTypeCode =  accountTypes.get(i);
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Account Type","<html>
<body>
Please select account:<br>
$$accountTypes = IC.queryAllAccountsByGroupCode(__params.ReceiverPartyIdentifier);
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","24107","24102","Query Group Account Balance","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","24108","24102","Query Group Account Balance","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","24109","24102","Query Group Account Balance","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","24111","24110","M-Shwari Query Group Loan Credit Limit","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='262626';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '15';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Eligible_Credit_Limit';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","6","24112","24110","M-Shwari Query Group Loan Credit Limit","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Query group loan credit limit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","24113","24110","M-Shwari Query Group Loan Credit Limit","var input = __input.response;
 if (!empty(input) && Validator.isDigit(input)) {
 __params.PIN = input;
 __next = '4';
 } 
 else {
 __secure = true;
 __next = '3';
 }","3","Enter PIN","<html>
 <body>
 Enter PIN:<br>
 <a href=""${mobilemoneyURL}"" default=""yes""></a>
 </body>
 </html>",""<endrec>
"CUSTOMER","","4","24114","24110","M-Shwari Query Group Loan Credit Limit","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","24115","24110","M-Shwari Query Group Loan Credit Limit","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.ReceiverPartyIdentifier  = input;
    __next = '3'; 
} 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","24116","24110","M-Shwari Query Group Loan Credit Limit","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","24118","24117","Organization Redeem Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';
__params.RequesterIdentifierType = '01';
__params.ReceiverPartyIdentifierType = '03';
__params.ReceiverIdentifierType = '01';
__params.RequesterIdentifierType = '01';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","24119","24117","Organization Redeem Voucher","var input = __input.response;
__params.RequesterIdentifier = input;
__next = '1a';","1","Input Voucher Holder","<html>
<body>
Please input the voucher holder:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","24120","24117","Organization Redeem Voucher","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2","Input Voucher Code","<html>
<body>
Please input the voucher code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","24121","24117","Organization Redeem Voucher","var input = __input.response;
if(!empty(input)){
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';
}else{
    __next ='3';
}","3","Input Operator ID","<html>
<body>
Please input the operator id:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","24122","24117","Organization Redeem Voucher","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","24123","24117","Organization Redeem Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","6","Confirm","<html>
<body>You will redeem a coupon hold by ${__params.Msisdn}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","24124","24117","Organization Redeem Voucher","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '2';
} else {
    __next = '1a';
}","1a","input amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","24126","24125","M-Shwari Query Group Loan Mini Statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='262626';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '15';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Loan_Mini_Statement';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","6","24127","24125","M-Shwari Query Group Loan Mini Statement","var input = __input.response;
if (input == '1') {
__next = 'end';
} 
else if(input == '0') {
__next = 'cancel';
} 
else {
__next = '4';
}","4","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","24128","24125","M-Shwari Query Group Loan Mini Statement","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
__params.PIN = input;
__next = '4';
} 
else {
__secure = true;
__next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","24129","24125","M-Shwari Query Group Loan Mini Statement","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","24130","24125","M-Shwari Query Group Loan Mini Statement","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')) {
__params.ReceiverPartyIdentifier = input;
__next = '3';
} 
else {
__next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","24131","24125","M-Shwari Query Group Loan Mini Statement","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","24501","1024","Customer pay bill","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    if(1 == size(multiAccount)){
        type = multiAccount .get(0)
        if('true' == type.defaultFlag){
             __next = '8';
        }else{
             __next = '7';
        }
    }else{
   __next = '7';
}
} else {
    __next = '6';
}","6","Input Amount","<html>
<body>
Input Amount<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',CurrencyCode);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","24502","1024","Customer pay bill","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.InitiatorAccountNo = type.AccountNo;
                __secure = true;
                __next = '8';
         } else {
                __next = '7';
         }
    } else {
        __next = '7';
    }
}","7","Choose Inititator Account","<html>
<body>
Please Choose Inititator Account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","23","24504","1024","Customer pay bill","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
$$orgName = IC.queryOrgName(__params.ReceiverPartyIdentifier);
$$formatAmount = IC.formatAmount(__params.Currency, __params.Amount);
Fee:${chargeFee = TC.queryCustomerCharge(__params)};<br>
To Pay ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${orgName} for account number ${__params.BillReferenceNumber}, the charge is ${chargeFee}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","24801","20174","Send Start Key for Customer New PIN","var input = __input.response;
if (input == null || empty(input)) {
    __next = '1b';
} else {
    __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '2';
}","1b","Input Date of Birth","<html>
<body>
Enter Date Of Birth<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","24803","24802","Customer request buy goods linked card voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Customer Buy Goods Voucher';  
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","24804","24802","Customer request buy goods linked card voucher","var input = __input.response;
__params.PIN = input;
__next = '2';","1","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","24805","24802","Customer request buy goods linked card voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Voucher Type - ${__params.VoucherTypeCode} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","24902","24901","IMT Send_1","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';
__params.RequesterIdentifierType = '01';
__params.TransactionCategory = 'IMT';
__params.TransactionSubCategory = 'IMT_HomeSend_Remittance_Request';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","24903","24901","IMT Send_1","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Sender MSISDN","<html>
<body>
Enter Sender MSISDN <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","24904","24901","IMT Send_1","var input = __input.response;
__params.FirstName = input;
__next = '3';","2","Enter Sender First Name","<html>
<body>
Enter Sender First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","24905","24901","IMT Send_1","var input = __input.response;
if (Validator.isNonzeroAmount(input)) {
    var amount = TC.convertAmountFormat(input);
    __params.Amount = amount;
    __params.AdditionalDataItemPrinciple_Amount = amount;
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","24906","24901","IMT Send_1","var input = __input.response;
if (empty(input)) { 
__next = '4';
} else {
__params.AdditionalDataItemRecipient@@SPACE@@MSISDN = input;
__next = '5';
}","4","Enter Receiver MSISDN","<html>
<body>
Enter Receiver  MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","24907","24901","IMT Send_1","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name = input;
__next = '6';","5","Enter Receiver First Name","<html>
<body>
Enter Receiver First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","24908","24901","IMT Send_1","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name = input;
__next = '7';","6","Enter Receiver Last Name","<html>
<body>
Enter Receiver Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","24909","24901","IMT Send_1","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","24910","24901","IMT Send_1","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","24911","24901","IMT Send_1","var input = __input.response;
if (input == '1') {
  __endmsg = 'Your Request have send to System.';
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
SEND MONEY TO [${__params.AdditionalDataItemRecipient@@SPACE@@MSISDN}] [${__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name}] [${__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name}] [${__params.AdditionalDataItemPrinciple_Amount}] <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","25000","25000","Send Money via m-pesa","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","25001","25000","Send Money via m-pesa","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                CurrencyCode =  type;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","25002","25000","Send Money via m-pesa","if (empty(multiAccount)) {
  __next = 'error';
} else {

    var input = __input.response;
    if (!empty(input)) {
       var tmp = Util.toInt(input) - 1;
       if(tmp >=0 && tmp < size(multiAccount)) {
           type = multiAccount.get(tmp);
          __params.InitiatorAccountNo= type.AccountNo;
          __secure = true;
          __next = '6';
       } else {
          __next = '5';
       }
    } else {
      __next = '5';
    }


}","5","Choose Initiator AccountNo","<html>
<body>
Please select Initiator account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","25003","25000","Send Money via m-pesa","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","25004","25000","Send Money via m-pesa","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2a","Input Phone Number","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","25005","25000","Send Money via m-pesa","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3';
}
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","25006","25000","Send Money via m-pesa","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
  __next = '5';
  if(1 == size(multiAccount) )
  {
    type = multiAccount.get(0);
    if(empty(type.defaultFlag) ||  type.defaultFlag == 'true')
    {
      __next = '6';
    }
  }
} else {
    __next = '4';
}","4","Input Amount","<html>
<body>
Input Amount:<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'m-pesa',CurrencyCode);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","25007","25000","Send Money via m-pesa","var input = __input.response;
__params.PIN = input;
__next = '7';

 __isCustomerInitiatorCNSEnable = IC.checkCustomerInitiatorCNSEnable(__params.InitiatorIdentifier);
if (__isCustomerInitiatorCNSEnable)
{
       __feeInfo= TC.calculateInitiatorCustomerCharge(__params, identity.identityId);
      if (__feeInfo.resultCode == '1' ) {
              __next = 'error';
              __errormsg = __feeInfo.errorMsg;
       }
}","6","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","25008","25000","Send Money via m-pesa","var input = __input.response;
if (input == '*') {
  __next = previous7 ; 
}else
{
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
IC.cnsCancelationProcess(__params.InitiatorIdentifierType,__params.InitiatorIdentifier);
  __next = 'cancel';
} else {
  __next = '7';
}
}","7","Confirm","<html>
<body>
$$customerNameAndTypeMap = IC.queryCustomerName(__params.ReceiverPartyIdentifier);
$$customerFirstName = customerNameAndTypeMap.get(""firstName"");
$$customerMiddleName = customerNameAndTypeMap.get(""middleName"");
$$customerLastName = customerNameAndTypeMap.get(""lastName"");
$$customerType = customerNameAndTypeMap.get(""customerType"");
$$chargeFee = TC.queryCustomerCharge(__params);
$$formatAmount = IC.formatAmount(__params.Currency, __params.Amount);
$$if (empty(customerNameAndTypeMap)){
Customer ${__params.ReceiverPartyIdentifier} does not exist on the system or is not registered.<br>
To send ${formatAmount} to ${__params.ReceiverPartyIdentifier}, the charge is ${chargeFee}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
$$} else if (!empty(customerNameAndTypeMap) && customerType == ""1001""){
Customer ${__params.ReceiverPartyIdentifier} does not exist on the system or is not registered.<br>
To send ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${customerFirstName} ${customerMiddleName} ${customerLastName}, the charge is ${chargeFee}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
$$} else {
To send ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${customerFirstName} ${customerMiddleName} ${customerLastName}, the charge is ${chargeFee}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
$$}
Input * to return to the previous step.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","2501","1025","Customer Buy Goods","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '02';/*TILL NO*/
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","4","2503","1025","Customer Buy Goods","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '3';
} else {
    __next = '2';
}","2","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","2504","1025","Customer Buy Goods","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","2505","1025","Customer Buy Goods","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Buy Goods and Services ${__params.ReceiverParty.Identifier} Tsh ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","25100","25100","Purchase Airtime via m-pesa","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
beneficiaries = IC.queryCustListBeneficiary(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","25101","25100","Purchase Airtime via m-pesa","var input = __input.response;
if (input == '1') {
  __params.RechargedMSISDN = msisdn;
  __buyairtimeForSelf = 'YES';
  __next = '3';
} else if (input == '2') {
  __next = '2';
} else {
  __next = '1';
}","1","Select Phone","<html>
<body>
Please select phone :<br>
1 My phone<br>
2 Other phone<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","25102","25100","Purchase Airtime via m-pesa","var input = __input.response;
if(input == 1) {
 __next = '2a';
}else if(input == '2') {
    if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
}else{
 __next = '2';
}","2","Select option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","25103","25100","Purchase Airtime via m-pesa","var input = __input.response;
if (!empty(input)) {
  __params.RechargedMSISDN = input;
  __next = '3';
} else {
  __next = '3a';
}","2a","Input MSISDN Number","<html>
<body>
Input MSISDN Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","25104","25100","Purchase Airtime via m-pesa","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 and i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.RechargedMSISDN = beneficiaryMsisdn ;
  __next = '3';
}
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","25105","25100","Purchase Airtime via m-pesa","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifier = '2001'; /* China Mobile's short code */
  __next = '4';
} else {
  __next = '3';
}","3","Input MNO name","<html>
<body>
Input MNO name:<br>
1 China Mobile<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","25106","25100","Purchase Airtime via m-pesa","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","25107","25100","Purchase Airtime via m-pesa","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
	__next = '6';
  if(1 == size(multiAccount) )
  {
    type = multiAccount.get(0);
    if(type.defaultFlag == 'true')
    {
      __next = '7';
    }
  }
} else {
    __next = '5';
}","5","Input Amount","<html>
<body>
Input Amount:<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'m-pesa',__params.Currency);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","25108","25100","Purchase Airtime via m-pesa","if (empty(multiAccount)) {
  __next = 'error';
} else {

		var input = __input.response;
		if (!empty(input)) {
			 var tmp = Util.toInt(input) - 1;
			 if(tmp >=0 and tmp < size(multiAccount)) {
				   type = multiAccount.get(tmp);
					__params.InitiatorAccountNo= type.AccountNo;
					__secure = true;
					__next = '7';
			 } else {
					__next = '6';
			 }
		} else {
			__next = '6';
		}


}","6","Choose Initiator AccountNo","<html>
<body>
Please select Initiator account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'m-pesa',__params.Currency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","25109","25100","Purchase Airtime via m-pesa","var input = __input.response;
__params.PIN = input;
__next = '8';

if (__buyairtimeForSelf != 'YES')
{
    __isCustomerInitiatorCNSEnable = IC.checkCustomerInitiatorCNSEnable(__params.InitiatorIdentifier);
    if (__isCustomerInitiatorCNSEnable)
    {
              __feeInfo= TC.calculateInitiatorCustomerCharge(__params,  identity.identityId);
              if (__feeInfo.resultCode == '1' ) {
                     __next = 'error';
                     __errormsg = __feeInfo.errorMsg;
               }
    }
}","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","25110","25100","Purchase Airtime via m-pesa","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
$$ var  receiverPartyName = '';
$$ if ( __buyairtimeForSelf != 'YES' && __isCustomerInitiatorCNSEnable) 
$$ {
$$     __isCustomerReceiverCNSEnable = IC.checkCustomerReceiverCNSEnable(__params.RechargedMSISDN);
$$     if (__isCustomerReceiverCNSEnable)
$$     {
$$            __customerKYC = IC.queryCustomerKYC(__params.RechargedMSISDN);
$$            
$$            if (!empty(__customerKYC.ReceiverPartyFirstName))
$$            {
$$                   receiverPartyName = "" "" + __customerKYC.ReceiverPartyFirstName;
$$            }
$$            if (!empty(__customerKYC.ReceiverPartyMidName))
$$            {    
$$                   receiverPartyName =   receiverPartyName  + "" "" + __customerKYC.ReceiverPartyMidName;
$$            }
$$            if (!empty(__customerKYC.ReceiverPartyLastName))
$$            {
$$                  receiverPartyName =   receiverPartyName  + "" "" + __customerKYC.ReceiverPartyLastName;
$$            }
$$     }
To buy airtime of ${__feeInfo.principalAmout} for ${__params.RechargedMSISDN}${receiverPartyName}, the charge is ${__feeInfo.fee}. Press 1 to confirm or 0 to cancel.
$$ } else {
Buy Airtime  ${__params.RechargedMSISDN} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br> 
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","25201","25200","Organization operator sell airtime from MNO organization via org float","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","25202","25200","Organization operator sell airtime from MNO organization via org float","var input = __input.response;
__params.RechargedMSISDN = input;
__next = '2';","1","Enter MSISDN","<html>
<body>
Enter MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","25203","25200","Organization operator sell airtime from MNO organization via org float","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifier = '737373'; /* China Mobile's short code */
  __next = '3';
} else {
  __next = '2';
}","2","Enter MNO name","<html>
<body>
Enter MNO<br>
1 China Mobile<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","25204","25200","Organization operator sell airtime from MNO organization via org float","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","25205","25200","Organization operator sell airtime from MNO organization via org float","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
	__next = '5';
  if(1 == size(multiAccount) )
  {
    type = multiAccount.get(0);
    if(type.defaultFlag == 'true')
    {
      __next = '6';
    }
  }
} else {
    __next = '4';
}","4","Input Amount","<html>
<body>
Input Amount:<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'org float',__params.Currency);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","25206","25200","Organization operator sell airtime from MNO organization via org float","if (empty(multiAccount)) {
  __next = 'error';
} else {

		var input = __input.response;
		if (!empty(input)) {
			 var tmp = Util.toInt(input) - 1;
			 if(tmp >=0 and tmp < size(multiAccount)) {
				   type = multiAccount.get(tmp);
					__params.PrimaryAccountNo= type.AccountNo;
					__secure = true;
					__next = '6';
			 } else {
					__next = '5';
			 }
		} else {
			__next = '5';
		}


}","5","Choose Initiator AccountNo","<html>
<body>
Please select Initiator account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',__params.Currency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","25207","25200","Organization operator sell airtime from MNO organization via org float","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '7';","6","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","25208","25200","Organization operator sell airtime from MNO organization via org float","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","25209","25200","Organization operator sell airtime from MNO organization via org float","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html><body>Sell Airtime ${__params.RechargedMSISDN}, ${__params.Amount} <br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","25210","25209","ServicePurchase","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__params.ReceiverPartyIdentifier = '737373'; /* China Mobile's short code */
beneficiaries = IC.queryCustListBeneficiary(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","25211","25209","ServicePurchase","var input = __input.response;
if (input == '1') {
  __params.RechargedMSISDN = msisdn;
  __next = '3';
} else if (input == '2') {
  __next = '2';
} else {
  __next = '1';
}","1","Select phone","<html>
<body>
Please select phone :<br>
1 My phone<br>
2 Other phone<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","25212","25209","ServicePurchase","var input = __input.response;
if(input == 1) {
 __next = '2a';
}else if(input == '2') {
    if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
}else{
 __next = '2';
}","2","Select Phone no","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","25213","25209","ServicePurchase","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","25214","25209","ServicePurchase","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","25215","25209","ServicePurchase","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '5';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '6';
}","5","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","25216","25209","ServicePurchase","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
$$chargeFee = TC.queryCustomerCharge(__params);
$$result = TC.calculateBudget(__params);
$$budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
$$var promptText = '';
$$feeList = budgetMap.fee;
$$if(!empty(feeList)){
$$	   i = 1;
$$	   sizeLen = size(feeList);
$$	  for(fee:feeList)
$$	  {
$$	   promptText = promptText+ 'The amount of charge is '+fee.amount;
$$	 
$$	   if(i < sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$		i = i+1 
$$	  }
$$}
$$   taxList = budgetMap.tax;
$$   if(!empty(taxList)){
$$	   i = 1;
$$	   sizeLen = size(taxList);
$$	  for(tax:taxList)
$$	  {
$$		 if(i ==1 &&  promptText != '')
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$
$$		promptText = promptText
$$	 + 'The amount of tax is '+tax.amount;
$$	   
$$	   if(i <sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   } 
$$	   i = i+1;
$$	  }
$$  }
Buy Airtime ${__params.otherphone} Ksh ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","25217","25209","ServicePurchase","var input = __input.response;
__params.RechargedMSISDN = input;
  __next = '3';","2a","Input new MSISDN","<html>
<body>
Input the Recharged Phone no.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","25218","25209","ServicePurchase","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.RechargedMSISDN = beneficiaryMsisdn ;
  __next = '3';
} 
else{

  __next = '2b';
}","2b","Select a Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","25301","25300","Operator buy airtime from MNO organization via handset via org float","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */
__params.ReceiverPartyIdentifier = '737373';
__next = '2';","begin","Initialization ","",""<endrec>
"TILL","","2","25302","25300","Operator buy airtime from MNO organization via handset via org float","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifier = '787878'; /* China Mobile's short code */
  __next = '2';
} else {
  __next = '1';
}","1","Enter MNO name","<html>
<body>
Enter MNO <br>
1 China Mobile<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","25303","25300","Operator buy airtime from MNO organization via handset via org float","var input = __input.response;
if (!empty(input)) {
  __params.RechargedMSISDN = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Msisdn.","<html>
<body>
Enter Charge Msisdn <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","25304","25300","Operator buy airtime from MNO organization via handset via org float","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","25305","25300","Operator buy airtime from MNO organization via handset via org float","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
	__next = '6';
  if(1 == size(multiAccount) )
  {
    type = multiAccount.get(0);
    if(type.defaultFlag == 'true')
    {
      __next = '6';
    }
  }
} else {
    __next = '4';
}","4","Input Amount","<html>
<body>
Input Amount:<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'org float',__params.Currency);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","25306","25300","Operator buy airtime from MNO organization via handset via org float","if (empty(multiAccount)) {
  __next = 'error';
} else {

		var input = __input.response;
		if (!empty(input)) {
			 var tmp = Util.toInt(input) - 1;
			 if(tmp >=0 and tmp < size(multiAccount)) {
				   type = multiAccount.get(tmp);
					__params.PrimaryAccountNo= type.AccountNo;
					__secure = true;
					__next = '6';
			 } else {
					__next = '5';
			 }
		} else {
			__next = '5';
		}


}","5","Choose Initiator AccountNo","<html>
<body>
Please select Initiator account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'org float',__params.Currency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","25307","25300","Operator buy airtime from MNO organization via handset via org float","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>
",""<endrec>
"TILL","","8","25308","25300","Operator buy airtime from MNO organization via handset via org float","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter Pin","<html>
<body>
Enter Pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","25309","25300","Operator buy airtime from MNO organization via handset via org float","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '9';
}","8","Confirm","<html><body>Buy Airtime ${__params.RechargedMSISDN} ${__params.Amount}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","25400","25400","Customer Buy Goods via m-pesa","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","25401","25400","Customer Buy Goods via m-pesa","var input = __input.response;
    if (empty(input)) {
    	__next = '1';
    } else if (input == '1') {
        __params.ReceiverPartyIdentifierType = '01'; /* TILL_NO */
        __tips = 'Till no';
        __next = '2';
    } else if (input == '2') {
        __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
        __tips = 'Short code';
        __next = '2';
    } else {
    	__next = '1';
    }","1","Select Till no or Short code","<html>
<body>
Select Till no or Short code<br>
1 Till no<br>
2 Short code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","25402","25400","Customer Buy Goods via m-pesa","var input = __input.response;
if (empty(input)) {
__next = '2';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '3';
}","2","Enter Till no or Short code","<html>
<body>
Enter ${__tips}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","25403","25400","Customer Buy Goods via m-pesa","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","25404","25400","Customer Buy Goods via m-pesa","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
	__next = '5';
  if(1 == size(multiAccount) )
  {
    type = multiAccount.get(0);
    if(type.defaultFlag == 'true')
    {
      __next = '6';
    }
  }
} else {
    __next = '4';
}","4","Input Amount","<html>
<body>
Input Amount:<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'m-pesa',__params.Currency);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","25405","25400","Customer Buy Goods via m-pesa","if (empty(multiAccount)) {
  __next = 'error';
} else {

		var input = __input.response;
		if (!empty(input)) {
			 var tmp = Util.toInt(input) - 1;
			 if(tmp >=0 and tmp < size(multiAccount)) {
				   type = multiAccount.get(tmp);
					__params.InitiatorAccountNo= type.AccountNo;
					__secure = true;
					__next = '6';
			 } else {
					__next = '5';
			 }
		} else {
			__next = '5';
		}


}","5","Choose Initiator AccountNo","<html>
<body>
Please select Initiator account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',__params.Currency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","25406","25400","Customer Buy Goods via m-pesa","var input = __input.response;
__params.PIN = input;
__next = '7';","6","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","25407","25400","Customer Buy Goods via m-pesa","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Buy Goods - ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","25413","25412","Call Support","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"TILL","","2","25414","25412","Call Support","var input = __input.response;

  __next = 'end';","1","Call Support","<html>
<body>
Dial 100 for support<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","25601","25600","Service Purchase","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */
__params.ReceiverPartyIdentifier = '737373';
__params.RechargedMSISDN = msisdn;
__next = '2';
serviceName1= 'supercheka';
amout1= '5000';
amout2= '2000';
amout3= '1000';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","25602","25600","Service Purchase","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","25603","25600","Service Purchase","var input = __input.response;
if (input == '1') {
  __params.RechargedMSISDN = msisdn;
  __next = '4';
} else if (input == '2') {
  __next = '3';
} else {
  __next = '2';
}","2","Select Phone","<html>
<body>
Please select phone :<br>
1 My phone<br>
2 Other phone<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","25604","25600","Service Purchase","var input = __input.response;
if (!empty(input)) {
  __params.RechargedMSISDN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Input MSIADN Number","<html>
<body>
Input MSISDN Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","25605","25600","Service Purchase","var input = __input.response;
if (input == '4') {
__params.BillReferenceNumber = serviceName1;
__next = '5';
} else if (input == '1' && Validator.isAmount(amout1)) {
__params.BillReferenceNumber = serviceName1;
 __params.Amount = TC.convertAmountFormat(amout1);
__secure = true;
 __next = '6' ; 
}else if (input == '2' && Validator.isAmount(amout2)){
__params.BillReferenceNumber = serviceName1;
__params.Amount = TC.convertAmountFormat(amout2);
 __secure = true;
 __next = '6';
}else if (input == '3' && Validator.isAmount(amout3)){
__params.BillReferenceNumber = serviceName1;
__params.Amount = TC.convertAmountFormat(amout3);
__secure = true;
 __next = '6';
}else{
__next = '4';
}","4","Select Amount","<html>
<body>
Please select amount:<br>
1 ${serviceName1} ${amout1}<br>
2 ${serviceName1} ${amout2}<br>
3  ${serviceName1} ${amout3}<br>
4  ${serviceName1}  <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","25606","25600","Service Purchase","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
	__next = '6';
  } else {
  __next = '5';
    }","5","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","25607","25600","Service Purchase","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","25608","25600","Service Purchase","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '8';
}","7","Confirm","<html>
<body>
Service Purchase ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","25612","25611","Send Money Prevalidation","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","25613","25611","Send Money Prevalidation","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","error execute while error occurs","error execute while error occurs",""<endrec>
"Pre-Validation","","3","25614","25611","Send Money Prevalidation","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;
if(budgetMap.isError == '1')
{
 __params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
  __params.ResultMsg = '';
  var tips = '';
  tips = tips+'You will send ' ;
  var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
  tips = tips + IC.formatAmount(currency, amount);
  
  tips = tips+' to ';
  
  var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
  __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);


var maskname=  IC.maskIdentityName(empty(cust.firstName) ? '' : cust.firstName, empty(cust.middleName) ? '' : (' ' + cust.middleName), empty(cust.lastName) ? '' : (' ' + cust.lastName));
var custnametest = IC.queryCustomerName(CurReq.getIdentifierDef('ReceiverParty'));
  tips = tips + 'Customer ' +custnametest;
  tips = tips + ', Phone number ';

  tips = tips + cust.basicIdentifier;
  
  tips = tips +'.	Charge for this transaction is:\n ';

  __params.ResultMsg = __params.ResultMsg + tips ;
 
  feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
  for(fee:feeList)
  {
  
   __params.ResultMsg =__params.ResultMsg + ':The amount of charge is '+fee.amount;
   
   if(i < sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;
   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  __params.ResultMsg != '')
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
    __params.ResultMsg =__params.ResultMsg + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
   i = i+1;
  }
  if( __params.ResultMsg == '')
   {
     __params.ResultMsg =' No charge.';

   }

 
 else
  {
    __params.ResultMsg =__params.ResultMsg +'.';
  }  
 __next = '2';
}
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);
}
else
{

  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","2","25615","25611","Send Money Prevalidation","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if (confirmedOrNot)
{  
     __params.put('ResultType','0');
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.ResultCode='0';
	__params.ResultMsg ='You confirm initiate transaction!';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{
	IC.cnsCancelationProcess(CurReq.getIdentifierDef('Initiator'));
	__params.ResultCode='1';
        __params.errDesc='Pre-Validation Result is Rejected.';
	__params.Reason='Pre-Validation Result is Rejected.';
	__params.TransactionUMCPreValidationError ='You rejected initiate transaction!';
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"CUSTOMER","","10","25616","1007","Send Money","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '2';
         } else {
                __next = '2b';
         }
    } else {
        __next = '2b';
    }
}","2b","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","25802","25801","Customer transfer via web pre-validation","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","25803","25801","Customer transfer via web pre-validation","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Error to be executed on error code return","Error to be executed on error code return",""<endrec>
"Pre-Validation","","3","25804","25801","Customer transfer via web pre-validation","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId,__params);

	if(__params.get('BudgetResult') == '0')
	{
		var tips = '';
		tips = tips+'You will send ' ;
		var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
		var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
		tips = tips + IC.formatAmount(currency, amount);
	  
		tips = tips+' to ';
	  
		var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
		__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
		__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
		var maskname=  IC.maskIdentityName(empty(cust.firstName) ? '' : cust.firstName, empty(cust.middleName) ? '' : (' ' + cust.middleName), empty(cust.lastName) ? '' : (' ' + cust.lastName));
	  
		tips = tips + 'Customer ' +maskname;
		tips = tips + ', Phone number ';
		tips = tips + cust.basicIdentifier;
	  
		tips = tips +'. ';

		CurResp.putToBody('CalculateFeeResponse.tips', tips);
	}
	__next = '2';
}
else
{
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","2","25805","25801","Customer transfer via web pre-validation","var resultType =   CurReq.getValueFromBody('TransactionEventRequest.ResultType');
__params.put('ResultType',resultType);
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

if (resultType == '0')
{ 
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	__params.put('Common.Result.ErrorCode','TS28009');
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
	
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
TC.savingPreValidationEventLog(__params);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","25807","25806","Customer Transfer Pre-validation","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","25808","25806","Customer Transfer Pre-validation","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","information","information",""<endrec>
"Pre-Validation","","3","25809","25806","Customer Transfer Pre-validation","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
var tips = '';
var cust = IC.queryIdentityName(CurReq.getIdentifierDef('ReceiverParty'));
tips = tips + 'Customer ' + (empty(cust.firstName)?'[]':cust.firstName) + ' ' + (empty(cust.middleName)?'[]':cust.middleName) + ' ' + (empty(cust.lastName)?'[]':cust.lastName);
tips = tips + ', Phone number ';
tips = tips + cust.basicIdentifier;
tips = tips + ' will deposit ';
var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
tips = tips + IC.formatAmount(currency, amount);
tips = tips + '. Respond with';
CurResp.putToBody('CalculateFeeResponse.tips', tips);
__next = '2';
}
else
{
CurResp = TargetService.invokeForScript(); 
__next='end';
}","1","Pre-validation","Pre-validation",""<endrec>
"Pre-Validation","","2","25810","25806","Customer Transfer Pre-validation","CurResp = TargetService.invokeForScript(); 
__next='end';","2","Logic Script","Logic Script",""<endrec>
"CUSTOMER","","1","25903","25902","Send Money PreValidation","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","25906","25905","Send Money Pre validation USSD","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","25907","25905","Send Money Pre validation USSD","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","3","25908","25905","Send Money Pre validation USSD","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId,__params);

	if(__params.get('BudgetResult') == '0')
	{
		var tips = '';
		tips = tips+'You will send ' ;
		var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
		var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
		tips = tips + IC.formatAmount(currency, amount);
	  
		tips = tips+' to ';
	  
		var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
		__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
		__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
		var maskname=  IC.maskIdentityName(empty(cust.firstName) ? '' : cust.firstName, empty(cust.middleName) ? '' : (' ' + cust.middleName), empty(cust.lastName) ? '' : (' ' + cust.lastName));
	  
		tips = tips + 'Customer ' +maskname;
		tips = tips + ', Phone number ';
		tips = tips + cust.basicIdentifier;
	  
		tips = tips +'. ';

		CurResp.putToBody('CalculateFeeResponse.tips', tips);
	}
	__next = '2';
}
else
{
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","2","25909","25905","Send Money Pre validation USSD","var resultType =   CurReq.getValueFromBody('TransactionEventRequest.ResultType');
__params.put('ResultType',resultType);
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

if (resultType == '0')
{ 
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	__params.put('Common.Result.ErrorCode','TS28009');
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
	
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
TC.savingPreValidationEventLog(__params);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"CUSTOMER","","1","2601","1026","Customer requests buy goods voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReasonTypeCode= 'Customer request buy goods voucher linked card'; 
__secure = true;
__next = '2';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","2602","1026","Customer requests buy goods voucher","var input = __input.response;
var length = size(input);
if(length < __params.minLength  || length > __params.maxLength )
{
__params.info = 'The length of a secret code must be in the range of [' + __params.minLength + ',' + __params.maxLength + '], please enter secret code again!';
__next = '1';
}
else if(!empty(__params.rule) && input !~ __params.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __params.rule + ', please enter secret code again!';
__next = '1';
}
else
{
__params.VoucherSecretCode = input;
__next = '2';
}","1","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","2603","1026","Customer requests buy goods voucher","if (empty(multiAccount)) {
 __next = '3';
  __params.ReceiverAccountNo= ''; 
} else {
    var input = __input.response;
    if (!empty(input)) {
 var tmp = Util.toInt(input) - 2;
 if(tmp >=0 && tmp < size(multiAccount)) {
 type = multiAccount.get(tmp);
 __params.ReceiverAccountNo= type.AccountNo;
  __secure = true;
  __next = '3';
} else if(tmp == -1) {
 __next = '3';
  __params.ReceiverAccountNo= '';
 } else {
  __next = '2';
  }
 } else {
  __next = '2';
  }
}","2","Select Account","<html>
<body>
Please select account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account','');
  $$var i = 1;
 ${i} select no account<br>
 $$for(type: multiAccount ) {
 ${i+1} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","26101","1313","Initiate Customer Transaction by Reminder","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.InitiatorAccountNo = type.AccountNo;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Choose Inititator Account","<html>
<body>
Please Choose Inititator Account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'',Currency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","26201","20120","Identify Assistant","var input = __input.response;
if (empty(input)) {
    __next = '3b';
} else {
    __params.ReceiverPartyShortCode= input;
    __next = '4';
}","3b","Enter Short Code","<html>
<body>
Enter ${__tips}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","26302","26301","Create Bank Account AM","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'CreateIdentityBankAccount';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;  

isMultiCurrency = Util.isMultiCurrency();
items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;
attrList = IC.queryBankCardAttr('1000');
attrIndex = 0;

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","1","26304","26303","Customer Transfer from M-Pesa to Bank AM","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';   /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '01';
__params.PrimaryPartyIdentifier= msisdn;
__params.QueryIdentifierType = '01';   /* MSISDN */
__params.QueryIdentifierValue = msisdn;
__params.ReceiverPartyIdentifierType = '04';   /* SHORT_CODE*/
__params.TransactionCategory = 'Bank_Card_Service';
__params.TransactionSubCategory = '1';
fiOrgList = IC.queryFiOrgList(__params);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","26305","26303","Customer Transfer from M-Pesa to Bank AM","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(fiOrgList)) {
   __params.ShortCode= fiOrgList.get(i).shortCode;
   __params.ReceiverPartyIdentifier = __params.ShortCode;
   __params.FIOrgIdentityId= fiOrgList.get(i).identityId;
   __next = '2';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '2';
}","1","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","26306","26303","Customer Transfer from M-Pesa to Bank AM","var input = __input.response;
__params.BankCardOwnerInputValue = input;
__next = '3';","2","Enter Receiver","<html>
<body>
Enter Receiver ${identifierTypeName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","26307","26303","Customer Transfer from M-Pesa to Bank AM","var input = __input.response;
if (input == '1') {
  bankLookupList = IC.queryBankLookupList(__params);
  __next = '4';
} else if (input == '2') {
  __next = '5';
}","3","Select or Enter Bank Account","<html>
<body>
1 Select form list <br>
2 Enter Bank Account No <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","26308","26303","Customer Transfer from M-Pesa to Bank AM","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankLookupList)) {
   __params.BankCardId= bankLookup.BankCardId;
   __secure = true;
   __next = '6';
} else {
  __next = '4';
}","4","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankLookup:bankLookupList){
 ${index} ${bankLookup.AccountName}/${bankLookup.AccountNumber}(${bankLookup.BankBranchName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","26309","26303","Customer Transfer from M-Pesa to Bank AM","__params.BankAccountNo= __input.response;
bankCardAttrList= IC.queryBankCardAttr(__params,'1000');
bankCardAttrLisSize = size(bankCardAttrList);
__params.FIAccountInfo = Util.buildMessage();
__params.FIAccountInfo.InfoDetail = Util.buildMessageList(bankCardAttrLisSize);
bankCardAttrListIndex = 1;
if (bankCardAttrLisSize > 0)
{
  __next = '6';
}
else
{
__next = '7';
}","5","Enter Bank Account","<html>
<body>
Enter Bank Account<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","26310","26303","Customer Transfer from M-Pesa to Bank AM","var input = __input.response;
if (bankCardAttrListIndex <= bankCardAttrLisSize){
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Key = bankCardAttrList.get(bankCardAttrListIndex-1).attrName;
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Value = input;
  bankCardAttrListIndex=bankCardAttrListIndex+1;
}
if(bankCardAttrLisSize < bankCardAttrListIndex){
  __next = '7';
}else{
  __next = '6';
}","6","Enter Bank Details","<html>
<body>
Enter ${bankCardAttrList.get(bankCardAttrListIndex-1).attrName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","26311","26303","Customer Transfer from M-Pesa to Bank AM","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '8';
} else {
    __next = '7';
}","7","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","26312","26303","Customer Transfer from M-Pesa to Bank AM","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","26313","26303","Customer Transfer from M-Pesa to Bank AM","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '9';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '10';
}","9","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","26314","26303","Customer Transfer from M-Pesa to Bank AM","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Deposit Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountNo}${__params.BankCardId}<br>
Reciever : ${__params.ReceiverPartyIdentifier}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","26402","26401","Send Money Prevalidation WEB","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","26403","26401","Send Money Prevalidation WEB","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","2","26404","26401","Send Money Prevalidation WEB","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId,__params);

	if(__params.get('BudgetResult') == '0')
	{
		var tips = '';
		tips = tips+'You will send ' ;
		var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
		var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
		tips = tips + IC.formatAmount(currency, amount);
	  
		tips = tips+' to ';
	  
		var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
		__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
		__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
		var maskname=  IC.maskIdentityName(empty(cust.firstName) ? '' : cust.firstName, empty(cust.middleName) ? '' : (' ' + cust.middleName), empty(cust.lastName) ? '' : (' ' + cust.lastName));
	  
		tips = tips + 'Customer ' +maskname;
		tips = tips + ', Phone number ';
		tips = tips + cust.basicIdentifier;
	  
		tips = tips +'. ';

		CurResp.putToBody('CalculateFeeResponse.tips', tips);
	}
	__next = '2';
}
else
{
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","3","26405","26401","Send Money Prevalidation WEB","var resultType =   CurReq.getValueFromBody('TransactionEventRequest.ResultType');
__params.put('ResultType',resultType);
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

if (resultType == '0')
{ 
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	__params.put('Common.Result.ErrorCode','TS28009');
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
	
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
TC.savingPreValidationEventLog(__params);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"CUSTOMER","","2","26406","26301","Create Bank Account AM","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';
    __params.BankName = 'Others';
    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
        __params.BankName = item.defaultName;
    }

    if ( __params.BankId == '-1')
    {
   __params.FIAccountInfo = Util.buildMessage();
   __params.FIAccountInfo.InfoDetail = Util.buildMessageList(size(attrList));
    }

     bankList = IC.queryOrgBankList(__params.BankId);
    __next = '2';
} else {
  __next = '1';
}","1","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","26407","26301","Create Bank Account AM","var input = __input.response;
if (!empty(input)) {
  __params.AccountName = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Account Name","<html>
<body>
Enter Account Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","26408","26301","Create Bank Account AM","var input = __input.response;

if (!empty(input))
{
  __params.AccountNumber = input;
 
if(isMultiCurrency && _params.bankId != '-1') 
{
    currencys = IC.getAllCurrencyList();
    __next = '4';
}
if (size(attrList) > 0 && __params.BankId == '-1')
{
    __next = '5';
}
if (size(attrList) == 0 || __params.BankId != '-1') 
{
  __next = '6';
}
} else {
  __next = '3';
}","3","Enter Account Number","<html>
<body>
Enter Account Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","26409","26301","Create Bank Account AM","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(currencys)) {
    __params.Currency = currencys.get(i);

    __next = '6';
} else {
  __next = '4';
}","4","Select Currency","<html>
<body>
Select Currency:<br>
$$ var index = 1;
$$ for (currency:currencys){
 ${index} ${currency}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","26410","26301","Create Bank Account AM","var input = __input.response;
if (!empty(input)) {
  __params.FIAccountInfo.InfoDetail[attrIndex].Key = attrList[attrIndex];
  __params.FIAccountInfo.InfoDetail[attrIndex].Value = input;

  attrIndex = attrIndex + 1;
  if(attrIndex < size(attrList)) {
    __next = '5';
  } else {
    __next = '6';
  }
} else {
  __next = '5';
}","5","Enter Bank Account Info","<html>
<body>
Enter ${attrList[attrIndex]}:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","26411","26301","Create Bank Account AM","var input = __input.response;
if (input == '1') {
  __next = '7';
} else if(input == '0') {
  __next = '1';
} else {
  __next = '6';
}","6","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${__params.BankName}<br>
Branch:${__params.BranchName}<br>
Account Name:${__params.AccountName}<br>
Account Number:${__params.AccountNumber}<br>
$$ if(isMultiCurrency) {
Currency:${__params.Currency}<br>
$$ }
$$ if(size(attrList) > 0 && __params.BankId == '-1') {
$$ for (detail:__params.FIAccountInfo.InfoDetail){
${detail.Key}:${detail.Value}<br>
$$ }
$$ }
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","26412","26301","Create Bank Account AM","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '8';
} else {
    __secure = true;
    __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","26413","26301","Create Bank Account AM","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","26501","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-1])$'))
{
 __params.NeedConfirmation = input ;
  if(input =='1')
 {
  __next = '10';
 }
else {
 __next = '11';
}
}","9","Need Confirmation","<html>
<body>
Need Confirmation<br>
0 No<br>
1 Yes<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","26702","26701","send money_ussd","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","26703","26701","send money_ussd","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","2","26704","26701","send money_ussd","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId,__params);

	if(__params.get('BudgetResult') == '0')
	{
		var tips = '';
		tips = tips+'You will send ' ;
		var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
		var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
		tips = tips + IC.formatAmount(currency, amount);
	  
		tips = tips+' to ';
	  
		var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
		__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
		__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
		var maskname=  IC.maskIdentityName(empty(cust.firstName) ? '' : cust.firstName, empty(cust.middleName) ? '' : (' ' + cust.middleName), empty(cust.lastName) ? '' : (' ' + cust.lastName));
	  
		tips = tips + 'Customer ' +maskname;
		tips = tips + ', Phone number ';
		tips = tips + cust.basicIdentifier;
	  
		tips = tips +'. ';

		CurResp.putToBody('CalculateFeeResponse.tips', tips);
	}
	__next = '2';
}
else
{
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","3","26705","26701","send money_ussd","var resultType =   CurReq.getValueFromBody('TransactionEventRequest.ResultType');
__params.put('ResultType',resultType);
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

if (resultType == '0')
{ 
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	__params.put('Common.Result.ErrorCode','TS28009');
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
	
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
TC.savingPreValidationEventLog(__params);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"TILL","","1","2701","1027","Merchant Initiates Buy Goods transaction using a voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","2702","1027","Merchant Initiates Buy Goods transaction using a voucher","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';
","1","Enter Voucher Code","<html>
<body>
Enter Voucher Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","2703","1027","Merchant Initiates Buy Goods transaction using a voucher","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","2704","1027","Merchant Initiates Buy Goods transaction using a voucher","var input = __input.response;
if (Validator.isDigit(input, 4, 4)) {
  __params.VoucherValidationValue = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter last 4 digits of MSISDN","<html>
<body>
Enter Last 4 Digits of MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","2705","1027","Merchant Initiates Buy Goods transaction using a voucher","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","2706","1027","Merchant Initiates Buy Goods transaction using a voucher","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","2707","1027","Merchant Initiates Buy Goods transaction using a voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}
","6","Confirm","<html>
<body>
Redeem Voucher - ${__params.ReceiverParty.Identifier} ${__params.Amount} ${__params.VoucherValidationValue}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","27101","1018","Customer Query an Account Balance via Handset","if (empty(accountTypes)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(accountTypes)) {
                __params.AccountTypeCode =  accountTypes.get(tmp);
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Choose Account Type","<html>
<body>
Please select account:<br>
$$accountTypes = IC.queryAllAccounts(identity.identityType, identity.identityId);
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","27201","20314","Pay Bill","var input = __input.response;
__params.FirstName= input;
__next = '3';","2","Enter First Name","<html>
<body>
Enter First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","27202","20314","Pay Bill","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","27203","20212","Operator query balances","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
    
    accountTypes = IC.queryAllAccountsByShortCode(input);
}
else
{
    accountTypes = IC.queryAllAccountsByTillId(identity.identityId);
}
__next = '2';","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","27204","20212","Operator query balances","if (empty(accountTypes)) {
  __next = 'error';
} else {
  var input = __input.response;
  var i = Util.toInt(input) - 1;
  if (i >= 0 && i < size(accountTypes)) {
    __params.AccountTypeCode = accountTypes.get(i);
    __next = '3';
  } else {
    __next = '2';
  }
}","2","Select Account Type","<html>
<body>
Please select account:<br>
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","27303","27302","Refund Customer","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"TILL","","1","27402","27401","CCH Initiate Reversal Transaction","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPEATOR ID */
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.ActionType = 'TransactionReversal';
__params.CCHFlag = 'true';

  __next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","27403","27401","CCH Initiate Reversal Transaction","var input = __input.response;
if (!empty(input)) {
  __params.OriginalOrderId= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Transaction ID or Request ID","<html>
<body>
Enter Transaction ID or Request ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","27404","27401","CCH Initiate Reversal Transaction","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","27405","27401","CCH Initiate Reversal Transaction","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Pin","<html>
<body>
Enter Pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","27406","27401","CCH Initiate Reversal Transaction","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '6';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","27407","27401","CCH Initiate Reversal Transaction","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input != '1'){
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html><body>You are going to initiate reversal transaction. Press 1 to continue and other numbers to cancel. ${__params.info}<br>
1 OK <br>
 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","27504","27503","Query Transaction by Transaction ID","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '97'; /* OPERATOR_ID */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","5","27505","27503","Query Transaction by Transaction ID","var input = __input.response;
__params.ReceiptNo = input;
__next = '2';","1","Enter Transaction ID","<html>
<body>
Enter Transaction ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","27506","27503","Query Transaction by Transaction ID","var input = __input.response;
if(!empty(input)){
  if(Validator.isOperatorID(input)){
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '3';
  } else {
    __next = '2';
  }
} else {
  __params.InitiatorIdentifier = IC.queryDefaultOperatorId(identity.identityId);
  __secure = true;
  __next = '3';
}","2","Enter your Operator ID","<html>
<body>
Enter your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","27507","27503","Query Transaction by Transaction ID","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","27508","27503","Query Transaction by Transaction ID","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","27606","1765","Operator Query Consumer Loyalty Account","if (empty(accountTypes)) {
  __next = 'error';
} else {
  var input = __input.response;
  var i = Util.toInt(input) - 1;
  if (i >= 0 && i < size(accountTypes)) {
    __params.AccountTypeCode = accountTypes.get(i);
    __next = '3';
  } else {
    __next = '2';
  }
}","2","Select Account Type","<html>
<body>
Please select account:<br>
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","27702","1750","M-Shwari Activate Account","__params.ReceiverPartyIdentifierType='04';
__params.ReceiverPartyIdentityType='5000';
__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
      __next = '3';
   } 
 else 
   {
      __next = '2';
   }","2","Input Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","27801","27401","CCH Initiate Reversal Transaction","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier =  input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Requester MSISDN","<html>
<body>
Enter Requester MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","27802","27401","CCH Initiate Reversal Transaction","var input = __input.response;
if (!empty(input)) {
  __params.ReverseAmount= input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter Reverse Amount","<html>
<body>
Enter Reverse Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","27803","27401","CCH Initiate Reversal Transaction","var input = __input.response;
if (!empty(input)) {
  __params.Remark= input;
  __next = '5';
} else {
  __next = '8';
}","8","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","27902","27901","Send Money12","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"CUSTOMER","","1","28003","28002","Send Money 2 factor Last Name","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
beneficiaries = IC.queryCustListBeneficiary(msisdn);
__params.VoucherTypeCode = 'Give Cash Voucher';  
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","28004","28002","Send Money 2 factor Last Name","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","28006","28002","Send Money 2 factor Last Name","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3';
} 
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","28007","28002","Send Money 2 factor Last Name","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2a","Input Phone Number","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","28008","28002","Send Money 2 factor Last Name","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","28009","28002","Send Money 2 factor Last Name","var input = __input.response;
__params.SimpleKYCMap = IC.buildSimpleKYCMap('Last Name',input,__params.SimpleKYCMap);
__secure = true;
__next = '5';","4","Enter Last Name","<html>
<body>
Enter Sender Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","2801","1028","Merchant Initiates Buy Goods refund transaction","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","8","28010","28002","Send Money 2 factor Last Name","var input = __input.response;
__params.PIN = input;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","28011","28002","Send Money 2 factor Last Name","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>Send Money to ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","2802","1028","Merchant Initiates Buy Goods refund transaction","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';
","1","Enter Customer MSISDN","<html>
<body>
Enter Customer MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","2803","1028","Merchant Initiates Buy Goods refund transaction","var input = __input.response;
 if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","2804","1028","Merchant Initiates Buy Goods refund transaction","var input = __input.response;
__params.Remark = input;
__next = '4';","3","Enter Original Transaction Receipt No.","<html>
<body>
Enter Original Transaction Receipt No.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","2805","1028","Merchant Initiates Buy Goods refund transaction","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","2806","1028","Merchant Initiates Buy Goods refund transaction","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","2807","1028","Merchant Initiates Buy Goods refund transaction","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Payment Refund - ${__params.ReceiverParty.Identifier} ${__params.Amount} ${__params.Remark}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","28101","1300","Create Customer Reminder Schedule With MSISDN","var input=__input.response;
if(!empty(input) && (input >= 0)&&(input <= 9))
{
 __params.NeedConfirmation = __input.response;
Confirmation = Confirmation.get(input);
 __next = '9';
}
else
{
__next = '8';
}","8","Need Confirmation or Not","<html>
<body>
Need Confirmation or Not: <br>
1 YES<br>
2 NO<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","28201","1530","Issue Voucher","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '4';
         } else {
                __next = '4';
         }
    } else {
        __next = '3';
    }
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","28202","1531","Org Issue Voucher","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '4';
         } else {
                __next = '4';
         }
    } else {
        __next = '3';
    }
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","28203","1541","Redeem Issued Voucher","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '4';
         } else {
                __next = '4';
         }
    } else {
        __next = '3';
    }
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","28206","1024","Customer pay bill","var input = __input.response;
__params.PIN = input;
__next = '9'","8","Input PIN","<html>
<body>
Input PIN :<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","28207","1024","Customer pay bill","orgBeneficiaries = IC.queryOrgListBeneficiary(msisdn);
var input = __input.response;
if (input == '0') {
	__next = '2';
} else if (input != '0') {
	var i = Util.toInt(__input.response) - 1;
	if (i >= 0 && i < size(orgBeneficiaries)) {
		orgBeneficiary = orgBeneficiaries.get(i);
		shortCode = orgBeneficiary.BeneficiaryShortCode;
		billReference = orgBeneficiary.BillReference;
		__params.ReceiverPartyIdentifier = shortCode;
		__params.BillReferenceNumber = billReference;
		var isManual = TC.isManualSelectionMode(__params.ServiceCode);
		if (isManual) {
			reasonTypes = TC.queryReasonTypes(__params.ServiceCode);
			if (empty(reasonTypes) || size(reasonTypes) == 0) {
				__errormsg = 'Sorry, there is not any reason types.';
				__next = 'error';
			} else {
				__next = '4';
			}
		} else {
			__next = '5';
		}
	}
} else {
	__next = '1';
}","2","Select Beneficiary ShortCode","<html>
<body>
Please Select Beneficiary ShortCode:<br>
$$ var index = 1;
$$ for (orgBeneficiary: orgBeneficiaries){
 ${index} ${orgBeneficiary.BeneficiaryName} ${orgBeneficiary.BeneficiaryShortCode} ${orgBeneficiary.BeneficiaryReference} ${orgBeneficiary.BillReference} <br> 
$$ index = index + 1;
$$ }
     0 Input Short Code
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","28208","1024","Customer pay bill","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
   __next = '3';","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","28211","28210","Redeem Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","28212","28210","Redeem Voucher","var input = __input.response;
if(!empty(input)){
__params.ReceiverPartyIdentifier = input;
__next = '2';
}else{
    __next ='1';
}","1","Input Voucher Code","<html>
<body>
Please input the voucher code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","28213","28210","Redeem Voucher","var input = __input.response;
 __params.VoucherValidationValue = input;
 __next = '3';","2","Input Msisdn","<html>
<body>
Input Additional validation information:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","28214","28210","Redeem Voucher","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '4';
         } else {
                __next = '4';
         }
    } else {
        __next = '3';
    }
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","28215","28210","Redeem Voucher","var input = __input.response;
__params.Amount = input;
__next = '5';","4","Input Amount","<html>
<body>
Please input the redeeming amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","28216","28210","Redeem Voucher","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","28217","28210","Redeem Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>You will redeem a voucher,the amount is ${__params.Amount}${__params.Currency}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","28401","1044","Organization operator pay bill","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                CurrencyCode =  type;
                __params.Currency = type;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currency to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","28403","1044","Organization operator pay bill","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    if(1 == size(accountTypes)){
       type = accountTypes.get(0);
       if( 'true' == type.defaultFlag){
           __next = '5';
       }else{
          __next = '5';
       }
    }else{
       __next = '5';
    }
} else {
    __next = '4';
}","4","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","28404","1044","Organization operator pay bill","var i = Util.toInt(__input.response)-1;
if (i >= 0 && i < size(accountTypes)){
   accountType = accountTypes.get(i);
  __params.AccountNo = accountType.AccountNo;
  __params.AccountName = accountType.AccountName;
   __next = '6';
}
else{
  __next = '5';
}","5","Choose Inititator AccountNo","<html>
<body>
Please Select Account:<br>
$$if (empty(accountTypes )) {
  You have no account type exist !
$$} else {
  $$var index = 1;
  $$for(accountType: accountTypes ) { 
  ${index} ${accountType.AccountName}(${accountType.AccountType.AccountTypeAlias})<br>
  $$  index = index+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","28405","1044","Organization operator pay bill","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","28406","1044","Organization operator pay bill","var input = __input.response;
if (!empty(input)) {
  __params.PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","28407","1044","Organization operator pay bill","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8a';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","14","28408","1044","Organization operator pay bill","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
$$orgName = IC.queryOrgName(__params.ReceiverPartyIdentifier);
$$formatAmount = IC.formatAmount(__params.Currency, __params.Amount);
Fee:${__params.confirm};<br>
To Pay B2B ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${orgName} for account number ${__params.BillReferenceNumber}.Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","28602","28601","Request Withdraw Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReasonTypeCode = 'Request Withdrawal Voucher For Customer'; 
__secure = true;
if(TC.isSupportSecretCode(__params.ReasonTypeCode))
{
var secretCodeRule = TC.getSecretCodeRule();
__params.minLength = secretCodeRule.getMinLength();
__params.maxLength = secretCodeRule.getMaxLength();
__params.rule = secretCodeRule.getRule();
__params.info = 'Enter a secret code:';
__next = '1';
}
else
{
__next = '2';
}","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","28603","28601","Request Withdraw Voucher","var input = __input.response;
var length = size(input);
if(length < __params.minLength  || length > __params.maxLength )
{
__params.info = 'The length of a secret code must be in the range of [' + __params.minLength + ',' + __params.maxLength + '], please enter secret code again!';
__next = '1';
}
else if(!empty(__params.rule) && input !~ __params.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __params.rule + ', please enter secret code again!';
__next = '1';
}
else
{
__params.VoucherSecretCode = input;
__next = '2';
}","1","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","28604","28601","Request Withdraw Voucher","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","28605","28601","Request Withdraw Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '2') {
  __next = 'cancel';
} else {
  __next = '2';
}","3","Confirm","<html>
<body>
Confirm to Request Withdraw Voucher?<br>
1 OK<br>
2 Quit<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","28701","1031","Organization operator applies a voucher for business deposit","var input = __input.response;
var length = size(input);
if(length < __params.minLength  || length > __params.maxLength )
{
__params.info = 'The length of a secret code must be in the range of [' + __params.minLength + ',' + __params.maxLength + '], please enter secret code again!';
__next = '1';
}
else if(!empty(__params.rule) && input !~ __params.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __params.rule + ', please enter secret code again!';
__next = '1';
}
else
{
__params.VoucherSecretCode = input;
__next = '2';
}","1","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","28702","1031","Organization operator applies a voucher for business deposit","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';","2","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","28703","1031","Organization operator applies a voucher for business deposit","if (empty(multiAccount)) {
 __next = '4';
  __params.ReceiverAccountNo= ''; 
} else {
    var input = __input.response;
    if (!empty(input)) {
 var tmp = Util.toInt(input) - 2;
 if(tmp >=0 && tmp < size(multiAccount)) {
 type = multiAccount.get(tmp);
 __params.ReceiverAccountNo= type.AccountNo;
  __secure = true;
  __next = '4';
} else if(tmp == -1) {
 __next = '4';
  __params.ReceiverAccountNo= '';
 } else {
  __next = '2';
  }
 } else {
  __next = '3';
  }
}","3","Select Account","<html>
<body>
Please select account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'org float','');
  $$var i = 1;
 ${i} select no account<br>
 $$for(type: multiAccount ) {
 ${i+1} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","28704","1031","Organization operator applies a voucher for business deposit","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","28705","1031","Organization operator applies a voucher for business deposit","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","5","Confirm","<html>
<body>
Confirm to apply?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","28801","1015","Customer change PIN","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '3';
         } else {
                __next = '3';
         }
    } else {
        __next = '2';
    }
}","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","29002","29001","Customer change PIN With Prevalidation","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ChangePIN';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__secure = true;
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","10","29003","29001","Customer change PIN With Prevalidation","var input = __input.response;
__params.OldPIN = input;
__params.@HEAD@PIN = input;
__secure = true;
__next = '2';","1","Enter PIN","<html>
<body>
Enter old PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","29004","29001","Customer change PIN With Prevalidation","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '3';
         } else {
                __next = '3';
         }
    } else {
        __next = '2';
    }
}","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","29005","29001","Customer change PIN With Prevalidation","var input = __input.response;
__params.NewPIN = input;
__secure = true;
__next = '4';","3","Enter New PIN","<html>
<body>
Enter New PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","29006","29001","Customer change PIN With Prevalidation","var input = __input.response;
if(__params.NewPIN == input)
{
__next = '6';
}
else
{
__next = '3';
}","4","Confirm new PIN","<html>
<body>
Confirm new PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","29007","29001","Customer change PIN With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = '6';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm Information","<html>
<body>
Confirm to change PIN?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","29008","29001","Customer change PIN With Prevalidation","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{

budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '10')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {
	   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
	 
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';
	   }
		i = i+1 
	  }
  }
   taxList = budgetMap.tax;
   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
		 if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }

		promptText = promptText
	 + fee.publicName + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
   {
     promptText =' No charge.';
   } 
 else
  {
    promptText =promptText +'.';
  }
__params.preValidationResult = promptText;
__params.confirm = promptText;
}
if (input == '1')
{__next = '7';
}
else if (input == '2') {
  __next = '8';
  }
}
else {
 __next = '6';
}","6","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","29009","29001","Customer change PIN With Prevalidation","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__params.EventType=""PRE_VALIDATION"";
__params.Reason=""Continue Pre-Validation Transaction"";
TC.savingPreValidationEventLog(__params);
__next = '8';
}
else if (input == '2') {
if(__params.IsCNSDataDisplayed == 'Yes')
{
  IC.cnsCancelationProcess(__params.InitiatorIdentifierType,__params.InitiatorIdentifier);
}
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
__next = 'error';
}
}
else {
 __next = '7';
}","7","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
You will change pin to ${__params.NewPIN}<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","2901","1029","Organization operator sell airtime from MNO organization","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","3","29010","29001","Customer change PIN With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","8","Confirm","<html>
<body>
Fee detail: ${__params.confirm}<br>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","29011","29001","Customer change PIN With Prevalidation","if(__errorCode == 'UMC64000')
{
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation confirmation is Timeout.';
__params.Reason=""Timeout"";
TC.savingPreValidationEventLog(__params);
__params.TransactionPreValidationEvent='Timeout';
__params.TransactionPreValidationError='Time out';
__params.put('Common.Result.ErrorCode','UMC64000');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
}","error","Execute while errors occur","error occurs.",""<endrec>
"CUSTOMER","","5","29013","1026","Customer requests buy goods voucher","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","29014","1026","Customer requests buy goods voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","4","Confirm","<html>
<body>
Confirm to requests buy goods voucher?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","29015","1026","Customer requests buy goods voucher","var input = __input.response;
if (!empty(input) && Validator.isAmount(input)) {
    __params.VoucherAmount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __secure = true;
    __next = '2a';
}","2a","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","29016","1048","M-Shwari Deposit","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '3';
         } else {
                __next = '3';
         }
    } else {
        __next = '2';
    }
}","2","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","2902","1029","Organization operator sell airtime from MNO organization","var input = __input.response;
__params.RechargedMSISDN = input;
__next = '2';","1","Enter MSISDN","<html>
<body>
Enter MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","2903","1029","Organization operator sell airtime from MNO organization","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifier = '100100'; /* China Mobile's short code */
  __next = '3';
} else {
  __next = '2';
}","2","Enter MNO name","<html>
<body>
Enter MNO<br>
1 China Mobile<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","2904","1029","Organization operator sell airtime from MNO organization","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '4';
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","2905","1029","Organization operator sell airtime from MNO organization","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","2906","1029","Organization operator sell airtime from MNO organization","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","2907","1029","Organization operator sell airtime from MNO organization","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Sell Airtime ${__params.RechargedMSISDN}, ${__params.Amount} <br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","29101","23142","Add Group Member","var input = __input.response;
if (Validator.isDate(input, 'yyyyMMdd')) {
  __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
  __next = '3a';
} else {
  __next = '3b';
}","3b","Enter Customer Date of Birth","<html>
<body>
Enter Leader Date of Birth(yyyyMMdd)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","29203","29202","Create Loyalty Consumer Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';  /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '04'; /* SP_ID */
__params.VoucherTypeCode = 'Deposit Voucher';  
__params.ActionType = 'CreateAccount';
__params.DefaultFlag= 'N';
__params.Currency= 'USD';
accountTypes = IC.queryAccountTypeList('Organization');
if ( size(accountTypes )>0) {
  __next = '1';
}else {
   __errormsg = 'There is no account type exist!';
   __next = 'error';
}","begin","set parammeters","",""<endrec>
"TILL","","2","29204","29202","Create Loyalty Consumer Account","var input = __input.response;
__params.ReceiverPartyIdentifier= input;
accountTypes = IC.queryAllPointAccountsByShortCode('input');
if ( size(accountTypes )>0) {
  __next = '2';
}else {
   __errormsg = 'There is no account type exist!';
   __next = 'error';
}
__next = '2';","1","Enter Organization Short Code","<html>
<body>
Enter Organization Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","29205","29202","Create Loyalty Consumer Account","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';","2","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","29206","29202","Create Loyalty Consumer Account","var i = Util.toInt(__input.response)-1;
if (i >= 0 && i < size(accountTypes)){
   accountType = accountTypes.get(i);
  __params.AccountType = accountType.AccountTypeId;
   __next = '4';
}
else{
  __next = '3';
}","3","Select Account Type","<html>
<body>
Please Select Account Type:<br>
$$ var index = 1;
$$ for (accountType: accountTypes){
 ${index}  ${accountType.AccountTypeAlias} <br> 
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","29207","29202","Create Loyalty Consumer Account","var input=__input.response;
if(!empty(input) && Validator.checkAccountNameLength(input)){
 __params.AccountName = __input.response;
 __next = '5';
}
else
{
__next = '4';
}","4","Enter Account Name","<html>
<body>
Enter Account Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","29208","29202","Create Loyalty Consumer Account","__params.@HEAD@PIN = __input.response;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","29209","29202","Create Loyalty Consumer Account","var input = __input.response;
if(input == 1) {
 __next = 'end';
}else {
 __next = 'cancel';
}","6","Confirm","<html>
<body>
 Confirm to create ${__params.AccountName} account <br>
1 OK  <br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","29304","29303","CCH Add Group Member","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CCHAddGroupMember';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.GroupType = '10000169';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","14","29305","29303","CCH Add Group Member","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Requesting Customer MSISDN","<html>
<body>
Enter Requesting Customer MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","29306","29303","CCH Add Group Member","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'yyyyMMdd')) {
    __next = '2';
} else {
    __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
    __next = '3';
}","2","Enter Customer Date of Birth(yyyyMMdd)","<html>
<body>
Enter Customer Date of Birth(yyyyMMdd)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","29307","29303","CCH Add Group Member","var input = __input.response;
if (input == '1') {
  __next = '4a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '4b';
    }
} else {
   __next = '0';
}","3","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a></body>
</html>",""<endrec>
"TILL","","11","29308","29303","CCH Add Group Member","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '4c';
}else {
   __errormsg = 'The group you inputed is not exist in system or status is closed';
   __next = 'error';
}
 }else {
      __next = '4a';
  }","4a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","29309","29303","CCH Add Group Member","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '5';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{

  __next = '4b';
}","4b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","29310","29303","CCH Add Group Member","var input = __input.response;
if (!empty(input)) {
 __params.InitiatorIdentifier = input ;
__params.RequesterIdentifier = input;
  __next = '5';
}else {
      __next = '4c';
   }","4c","Enter Leader MSISDN","<html>
<body>
Enter Leader MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","29311","29303","CCH Add Group Member","var input = __input.response;
__params.InvitedMSISDN = input;

if (!empty(input)) {
      __next = '6';
   } 
 else 
   {
      __next = '5';
   }","5","Input Invited Group Member MSISDN","<html>
<body>
Input Invited Group Member MSISDN <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","29312","29303","CCH Add Group Member","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(roleList)){
 __params.MemberRole = IC.bulidMemberRole(__params, roleList.get(i).roleId, roleList.get(i).roleName);
  __next = '6b';
  }else {
  __next = '6';
}","6","Select Role","<html>
<body>
Please Select Role:<br>
$$ var index = 1;
$$ for (role: roleList){
 ${index} ${role.roleName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","29313","29303","CCH Add Group Member","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '6a';
} else {
    __secure = true;

    roleTypes = IC.queryOrgOperatorAllRoleType(input);
    if (null == roleTypes || empty(roleTypes)) {
         __errormsg = 'There are not any role type to select.';
         __next = 'error';
     } else { 
         __params.InitiatorIdentifier = input;
         __next = '7';
    }
}","6a","Enter Your Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","29314","29303","CCH Add Group Member","var input = __input.response;
if (Validator.isDate(input, 'yyyyMMdd')) {
  __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
  __next = '6a';
} else {
  __next = '6b';
}","6b","Enter Leader Date of Birth","<html>
<body>
Enter Leader Date of Birth(yyyyMMdd)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","29315","29303","CCH Add Group Member","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '8';
} else {
    __secure = true;
    __next = '7';
}","7","Enter Operator PIN","<html>
<body>
Enter Operator PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","29316","29303","CCH Add Group Member","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","29405","29404","CCH Remove Group Member","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CCHRemoveGroupMember';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.GroupType = '10000169';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","12","29406","29404","CCH Remove Group Member","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Requesting Customer MSISDN","<html>
<body>
Enter Requesting Customer MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","29407","29404","CCH Remove Group Member","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'yyyyMMdd')) {
    __next = '2';
} else {
    __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
    __next = '3';
}","2","Enter Customer Date of Birth(yyyyMMdd)","<html>
<body>
Enter Customer Date of Birth(yyyyMMdd)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","29408","29404","CCH Remove Group Member","var input = __input.response;
if (input == '1') {
  __next = '4a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '4b';
    }
} else {
   __next = '0';
}","3","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a></body>
</html>",""<endrec>
"TILL","","9","29409","29404","CCH Remove Group Member","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
   __params.groupmap = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
   __next = '4c';
}else {
   __errormsg = 'The group you inputed is not exist in system or status is closed';
   __next = 'error';
}
 }else {
      __next = '4a';
  }","4a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","29410","29404","CCH Remove Group Member","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '5';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{

  __next = '4b';
}","4b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","29411","29404","CCH Remove Group Member","var input = __input.response;
if (!empty(input)) {
 __params.InitiatorIdentifier = input ;
__params.RequesterIdentifier = input;
  __next = '5';
}else {
      __next = '4c';
   }","4c","Enter Leader MSISDN","<html>
<body>
Enter Leader MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","29412","29404","CCH Remove Group Member","var input = __input.response;
__params.RemovedMSISDN = input;
__params.map = IC.queryCustomerName(__params.RemovedMSISDN);
if (!empty(input)) {
      __next = '6';
   } 
 else 
   {
      __next = '5';
   }","5","Input Remove Group Member MSISDN","<html>
<body>
Input Remove Group Member MSISDN <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","29413","29404","CCH Remove Group Member","var input = __input.response;
if (Validator.isDate(input, 'yyyyMMdd')) {
  __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
  __next = '7';
} else {
  __next = '6';
}","6","Enter Leader Date of Birth","<html>
<body>
Enter Leader Date of Birth(yyyyMMdd)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","29414","29404","CCH Remove Group Member","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '8';","7","Enter Your Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","29415","29404","CCH Remove Group Member","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '9';
} else {
    __secure = true;
    __next = '8';
}","8","Enter Operator PIN","<html>
<body>
Enter Operator PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","29416","29404","CCH Remove Group Member","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Group details: ${__params.ReceiverPartyIdentifier}<br>
Group Name: ${__params.groupmap.groupName}<br>
Confirm to remove group member ${__params.RemovedMSISDN}?<br>
Customer First Name : ${__params.map.firstName}<br>
Customer Last Name : ${__params.map.lastName}<br>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","29417","23318","CCH Change Group Member Role","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '1b';
} else {
  __next = '1a';
}","1a","Enter Requesting Customer MSISDN","<html>
<body>
Enter Requesting Customer MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","29418","23318","CCH Change Group Member Role","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'yyyyMMdd')) {
    __next = '1b';
} else {
    __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
    __next = '1c';
}","1b","Enter Customer Date of Birth(yyyyMMdd)","<html>
<body>
Enter Customer Date of Birth(yyyyMMdd)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","29419","23318","CCH Change Group Member Role","var input = __input.response;
if (Validator.isDate(input, 'yyyyMMdd')) {
  __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
  __next = '3';
} else {
  __next = '2d';
}","2d","Enter Leader Date of Birth","<html>
<body>
Enter Leader Date of Birth(yyyyMMdd)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","29701","1558","Create Direct Debit Mandate by Payee","var input = __input.response;
if (!empty(input) && !Validator.isDate(input, 'ddMMyyyy')){
__next = '9';
} else {
    __params.ExpiryDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '10';
}","9","Enter Expiry Date","<html>
<body>
Enter Expiry Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","3","1000","Buy Airtime","var input = __input.response;
if(input == 1) {
 __next = '2a';
}else if(input == '2') {
    if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
}else{
 __next = '2';
}","2","Select Phone no","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","3001","1030","Super agent operator initiates business deposit","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","3002","1030","Super agent operator initiates business deposit","var input = __input.response;
if (empty(input)) {
	__next = '1';
} else if (input == '1') {
    __params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
    __tips = 'Till no';
    __next = '2';
} else if (input == '2') {
    __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
    __tips = 'Short code';
    __next = '2';
} else {
	__next = '1';
}","1","Select Till no or Short code","<html>
<body>
Select Till no or Short code<br>
1 Till no<br>
2 Short code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","3003","1030","Super agent operator initiates business deposit","var input = __input.response;
if (empty(input)) { 
	__next = '2';
} else {
	__params.ReceiverPartyIdentifier = input;
	__next = '3';
}        
","2","Enter Till no or Short code","<html>
<body>
Enter ${__tips}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","3004","1030","Super agent operator initiates business deposit","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '4';
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","3005","1030","Super agent operator initiates business deposit","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","3006","1030","Super agent operator initiates business deposit","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","3007","1030","Super agent operator initiates business deposit","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Business Deposit - ${__params.ReceiverParty.Identifier} ${__params.Amount}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
Business Deposit to ${__params.ReceiverPartyIdentifier} ${disName2} Tsh${__params.Amount} <br>
${promptText } <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","301","1003","Redeem deposit voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","1","30105","30104","Approval Group Transaction","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ApproveGroupTask';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","9","30118","30104","Approval Group Transaction","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
__next = 'cancel';
} else {
  __next = '6';
}","6","Complete","<html>
<body>
You have completed the approval please press 1 End<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","30119","30104","Approval Group Transaction","var input = __input.response;
if (!empty(input)) {
  __params.@HEAD@PIN = input;
  __next = '6';
} else {
  __next = '5';
}","5","Input PIN","<html>
<body>
Please enter the PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","30120","30104","Approval Group Transaction","var input = __input.response;
if (empty(queryapprovalinfo.groupCode)) {
__next = '1';
} else {
if (input == '1') {
  __params.OperationType = input;
  __next = '5';
} else if( input == '0'){
__params.OperationType = input;
  __next = '5';
} else {
  __next = '4b';
}}","4b","Approves","<html>
<body>
$$if (empty(queryapprovalinfo.groupCode)) {
The value of GroupCode or ReminderID is incorrect.
$$}else{
Group Approval request for ${queryapprovalinfo.TaskName};<br>
Requested by ${queryapprovalinfo.OriginalInitiatorRole} ${queryapprovalinfo.OriginalInitiator.Identifier};<br>
For group name ${queryapprovalinfo.GroupName} and ID ${queryapprovalinfo.GroupCode}; <br>
$$if (!empty(queryapprovalinfo.changedOperationRole)) {
The operation Msidsn is ${queryapprovalinfo.operationMsisdn} and operation role is ${queryapprovalinfo.operationRole}, changed role is ${queryapprovalinfo.changedOperationRole}.<br>
$$}else{
The operation Msidsn is ${queryapprovalinfo.operationMsisdn} and operation role is ${queryapprovalinfo.operationRole}.<br>
$$}
Purpose:  ${queryapprovalinfo.Remark}; <br>
1 Approve<br>
0 Reject<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
$$}
</body>
</html>",""<endrec>
"CUSTOMER","","6","30121","30104","Approval Group Transaction","var input = __input.response;
if (empty(queryapprovalinfo.groupCode)) {
__next = '1';
} else {
if (input == '1') {
  __params.OperationType = input;
  __next = '5';
} else if( input == '0'){
__params.OperationType = input;
  __next = '5';
} else {
  __next = '4a';
}}","4a","Approve","<html>
<body>
$$if (empty(queryapprovalinfo.groupCode)) {
The value of GroupCode or ReminderID is incorrect.
$$}else{
Group Approval request for ${queryapprovalinfo.TaskName};<br>
Requested by ${queryapprovalinfo.OriginalInitiatorRole} ${queryapprovalinfo.OriginalInitiator.Identifier};<br>
For group name is ${queryapprovalinfo.GroupName} and group Code is ${queryapprovalinfo.GroupCode}; <br>
$$if (!empty(queryapprovalinfo.VoucherTypeName)) {
The voucher type is ${queryapprovalinfo.voucherTypeName};<br>
$$}else{
receiverParty value is ${queryapprovalinfo.ReceiverPartyIdentifier.identifier} ,type is ${queryapprovalinfo.ReceiverPartyIdentifier.identityType} ;<br>
$$}
Purpose:  ${queryapprovalinfo.Remark}; <br>
Amount: ${queryapprovalinfo.Amount}; <br>
1 Approve<br>
0 Reject<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
$$}
</body>
</html>",""<endrec>
"CUSTOMER","","5","30122","30104","Approval Group Transaction","__params.ApproverMSISDN = __params.InitiatorIdentifier;
var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  queryapprovalinfo = IC.queryApprovalInfo(__params.InitiatorIdentifier,__params.ReminderID,groupCode);
  var amout = queryapprovalinfo.amount;
  if (!empty(amout)) {
  __params.GroupCode = groupCode;
  __next = '4a';
} else {
  __params.GroupCode = groupCode;
  __next = '4b';
}
} 
else{
  __next = '3b';
}","3b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","30123","30104","Approval Group Transaction","__params.ApproverMSISDN = __params.InitiatorIdentifier;
var input = __input.response;
queryapprovalinfo = IC.queryApprovalInfo(__params.InitiatorIdentifier,__params.ReminderID,input);
var amout = queryapprovalinfo.amount;
if (!empty(input)) {
if (!empty(amout)) {
  __params.GroupCode = input;
  __next = '4a';
} else {
  __params.GroupCode = input;
  __next = '4b';
}
} else {
  __next = '3a';
}","3a","Input GroupCode","<html>
<body>
Please enter the GroupCode:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","30124","30104","Approval Group Transaction","groups = IC.queryMyGroups(msisdn);
var input = __input.response;
if (input == '1') {
	__next = '3a';
} else if (input == '2') {
	if (empty(groups) || size(groups) == 0) {
		__errormsg = 'Sorry, there is no groups.';
		__next = 'error';
	} else {
		__next = '3b';
	}
} else {
	__next = '2';
}","2","Select Option","<html>
<body>
Please select option: <br>
1 Input GroupCode<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","30125","30104","Approval Group Transaction","var input = __input.response;
if (!empty(input)) {
  __params.ReminderID= input;
  __next = '2';
} else {
  __next = '1';
}","1","Input ReminderID","<html>
<body>
Please enter the ReminderID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","302","1003","Redeem deposit voucher","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';
","1","Enter Voucher Code","<html>
<body>
Enter Voucher Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","30202","30201","Customer Query Bill_VDF_Demo","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"TILL","","3","303","1003","Redeem deposit voucher","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","30302","30301","Send Money Pre validation via API","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
initiator= CurReq.getIdentifierDef('Initiator'); 
__params.__sessionId= __sessionId; 
__params.put('TransOutgoingRequest@LIST@Param.sessionid',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.msisdn',initiator.Identifier);
__params.put('TransOutgoingRequest@LIST@Param.message','EnterPin');
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','808090');
__next = '3a';","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","30303","30301","Send Money Pre validation via API","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Error execute while error occurs","Error execute while error occurs",""<endrec>
"Pre-Validation","","4","30304","30301","Send Money Pre validation via API","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;
if(budgetMap.isError == '1')
{
 __params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
  __params.ResultMsg = '';
  var tips = '';
  tips = tips+'You will send ' ;
  var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
  tips = tips + IC.formatAmount(currency, amount);
  
  tips = tips+' to ';
  
  var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
  __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);


var maskname=  IC.maskIdentityName(empty(cust.firstName) ? '' : cust.firstName, empty(cust.middleName) ? '' : (' ' + cust.middleName), empty(cust.lastName) ? '' : (' ' + cust.lastName));
var custnametest = IC.queryCustomerName(cust.basicIdentifier);
  tips = tips + 'Customer ' +custnametest;
  tips = tips + ', Phone number ';
  tips = tips + cust.basicIdentifier;
  
  tips = tips +'.';

  __params.ResultMsg = __params.ResultMsg + tips ;
 
  feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
  for(fee:feeList)
  {
  
   __params.ResultMsg =__params.ResultMsg + ':The amount of charge is '+fee.amount;
   
   if(i < sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;
   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  __params.ResultMsg != '')
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
    __params.ResultMsg =__params.ResultMsg + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
   i = i+1;
  }
  if( __params.ResultMsg == '')
   {
     __params.ResultMsg =' No charge.';

   }

 
 else
  {
    __params.ResultMsg =__params.ResultMsg +'.';
  }  
 __next = '2';
}
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);
}
else
{

  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Query Charge fee","Query Charge fee",""<endrec>
"Pre-Validation","","3","30305","30301","Send Money Pre validation via API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if (confirmedOrNot)
{  
     __params.put('ResultType','0');
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.ResultCode='0';
	__params.ResultMsg ='You confirm initiate transaction!';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{
	IC.cnsCancelationProcess(CurReq.getIdentifierDef('Initiator'));
	__params.ResultCode='1';
        __params.errDesc='Pre-Validation Result is Rejected.';
	__params.Reason='Pre-Validation Result is Rejected.';
	__params.TransactionUMCPreValidationError ='You rejected initiate transaction!';
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","2","Confirm Initiate transaction","Confirm Initiate transaction",""<endrec>
"TILL","","4","304","1003","Redeem deposit voucher","var input = __input.response;
 __params.VoucherValidationValue = input;
 __next = '4';","3","Enter Additional validation information","<html>
<body>
Enter Additional validation information<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","30404","1836","Transfer Loyalty Points","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency  = type;
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Select Currency","<html>
<body>
Select the  Currency :<br>
$$multiCurrencyCode = IC.getAllForeignCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currencyCode to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","305","1003","Redeem deposit voucher","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","30501","1049","M-Shwari Withdraw","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '1';
         } else {
                __next = '1a';
         }
    } else {
        __next = '1a';
    }
}","1a","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","30508","1018","Customer Query an Account Balance via Handset","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '3';
         } else {
                __next = '3';
         }
    } else {
        __next = '2';
    }
}","2","Select Currency","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","30509","1534","Pay Bill By OTC Voucher","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Requester Voucher Code","<html>
<body>
Enter Requester Voucher Code <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","306","1003","Redeem deposit voucher","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","0","8","30601","1036","Organization withdraw e-money from float to bank account via handset","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Withdraw Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountName}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","","4","30602","1036","Organization withdraw e-money from float to bank account via handset","var input = __input.response;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';","3","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","307","1003","Redeem deposit voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Deposit Cash with ${__params.ReceiverParty.Identifier} 
Amount ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","30802","30801","Send Money with auto reference","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
beneficiaries = IC.queryCustListBeneficiary(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","30803","30801","Send Money with auto reference","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","30804","30801","Send Money with auto reference","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2a","Input Phone Number","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","30805","30801","Send Money with auto reference","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3';
} 
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","30806","30801","Send Money with auto reference","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Input Amount","<html>
<body>
Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","30807","30801","Send Money with auto reference","var input = __input.response;
__params.PIN = input;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
__next = '5';","4","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","30808","30801","Send Money with auto reference","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","5","Confirm","<html>
<body>Send Money to ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","30809","1006","Redeem withdraw voucher","var input = __input.response;

 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){

     __params.VoucherSecretCode = input;

     __next = '8';    

   }

else{

    __next = '7';

}","7","Enter Secret Code","<html>
<body>Enter Secret Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","30902","30901","Orgization Intra-Account Transfer For Org float to Working Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","30903","30901","Orgization Intra-Account Transfer For Org float to Working Account","","error","information","",""<endrec>
"TILL","","1","30905","30904","Deposit Money 2 Factor contact","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"TILL","","1","3101","1031","Organization operator applies a voucher for business deposit","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReasonTypeCode = 'OrgOperatorApplyDepositVoucher'; 
if(TC.isSupportSecretCode(__params.ReasonTypeCode))
{
var secretCodeRule = TC.getSecretCodeRule();
__params.minLength = secretCodeRule.getMinLength();
__params.maxLength = secretCodeRule.getMaxLength();
__params.rule = secretCodeRule.getRule();
__params.info = 'Enter a secret code:';
__next = '1';
}
else
{
__next = '2';
}","begin","Initialization ","",""<endrec>
"CUSTOMER","","1","31302","31301","Remove Group Member With Prevalidation","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'RemoveGroupMember';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE */
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
groups = IC.queryMyGroups(msisdn);
  __next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","31303","31301","Remove Group Member With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
    __next = '2b';
    __exemode = 'continue';
} else {
  __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${__mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","31304","31301","Remove Group Member With Prevalidation","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.ReceiverPartyIdentifier = input;
 __params.map = IC.queryGroupInfo('15',__params.ReceiverPartyIdentifier);
DEBUG.error(""===map"",map);
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","31305","31301","Remove Group Member With Prevalidation","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","31306","31301","Remove Group Member With Prevalidation","var input = __input.response;
if (!empty(input)) {
  __params.RemovedMSISDN = input;
__params.map = IC.queryCustomerName(__params.RemovedMSISDN);
  __next = '4';
} else {
  __next = '3';
}","3","Enter Removed Customer MSISDN","<html>
<body>
Enter Removed Customer MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","31310","31301","Remove Group Member With Prevalidation","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '7';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","31311","31301","Remove Group Member With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>Group details: ${__params.ReceiverPartyIdentifier}<br>
Group Name: ${__params.groupmap.groupName}<br>
Confirm to remove group member ${__params.RemovedMSISDN}?<br>
Customer First Name : ${__params.map.firstName}<br>
Customer Last Name : ${__params.map.lastName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","31312","31301","Remove Group Member With Prevalidation","var input = __input.response;
cust = IC.queryIdentityName(__params.InitiatorIdentifierType,__params.InitiatorIdentifier,'01',__params.RemovedMSISDN);
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
if(!IC.isSupportCustomerNameSearch() || cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01'){
__next = '7';
}
else
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '1')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {           
	   promptText = promptText + 'The amount of charge is '+fee.amount;
	  
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';
	   }
		i = i+1;
	  }
  }
   taxList = budgetMap.tax;

   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
	   if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }
		promptText = promptText + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
  {
    promptText =' No charge.';
  } 
  else
  {
    promptText =promptText +'.';
  }

var tips = '';
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
     if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
     {
       if(cust.subType  == '1000')
       {
	 tips = tips  + 'the received customer is unregistered.' + '<br>';
       }
       else if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
       {		   
           var nameStr= (empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName +' ');

           tips = tips + 'Customer name : ' + IC.maskIdentityName(nameStr) + '<br>';
           if(nameStr != ''){
           __params.IsCNSDataDisplayed = 'Yes';
           }
       }
     }
tips = tips + 'Phone number : ' + cust.basicIdentifier;
promptText = promptText + '<br>' + tips;

__params.preValidationResult = promptText;
__next = '6';
}
}
}
else if (input == '2') {
__next = '7';
}
}
else {
 __next = '5';
}","5","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","31313","31301","Remove Group Member With Prevalidation","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__next = '7';
}
else if (input == '2') {
if(__params.IsCNSDataDisplayed == 'Yes')
{
  IC.cnsCancelationProcess(__params.InitiatorIdentifierType,__params.InitiatorIdentifier);
}
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
}
else {
 __next = '6';
}","6","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","31401","23082","Add Group Member","var input = __input.response;
cust = IC.queryIdentityName('01',__params.InvitedMSISDN,'01',__params.InvitedMSISDN);
custname = IC.queryCustomerName(__params.InvitedMSISDN);
custlan = IC.queryCustomer(__params.InvitedMSISDN);
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '10')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {           
	   promptText = promptText + 'The amount of charge is '+fee.amount;
	  
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';
	   }
		i = i+1;
	  }
  }
   taxList = budgetMap.tax;

   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
	   if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }
		promptText = promptText + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
  {
    promptText =' No charge.';
  } 
  else
  {
    promptText =promptText +'.';
  }

var tips = '';
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
     if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
     {
       if(cust.subType  == '1000')
       {
	 tips = tips  + 'the received customer is unregistered.' + '<br>';
       }
       else if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
       {		   
           var nameStr= (empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName +' ');

           tips = tips + 'Registered Customer name : ' +custname  + '<br>' ;
           if(nameStr != ''){
           __params.IsCNSDataDisplayed = 'Yes';
           }
       }
     }
tips = tips + 'Phone number : ' + cust.basicIdentifier + custlan;
promptText = promptText + '<br>' + tips;

__params.preValidationResult = promptText;
__next = '6';
}
}
else if (input == '2') {
__next = '7';
}
}
else {
 __next = '5';
}","5","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","31402","23082","Add Group Member","var input = __input.response;
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__next = '7';
}
else if (input == '2') {
 IC.cnsCancelationProcess('01',__params.InitiatorIdentifier);
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
__next = 'error';
}
}
else {
 __next = '6';
}","6","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Group details: ${__params.ReceiverPartyIdentifier}<br>
Group Name: ${__params.groupmap.groupName}<br>
Initiator: ${__params.InitiatorIdentifier}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","31604","31603","Organization Query 3rd Bill","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.sessionId = universalSessionID.channelSessionID;

__params.AccessDeviceIdentifierType = '01';   /* MSISDN */ 
 __params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
 __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */


__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","31605","31603","Organization Query 3rd Bill","var input = __input.response;

if(empty(input)){
     __next = '1';
}else{
    var orgStatus = IC.queryOrgStatusByShortCode(input);
    if(!empty(orgStatus) && orgStatus =='03'){
        __params.ReceiverPartyIdentifier = input;
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode',input);
        __next = '2';
    }else{
        __errormsg='Sorry,the third party is not in active or the third party is not exist,please try later.';
        __next='error';
    }
}","1","Input Receiver Organization Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","31606","31603","Organization Query 3rd Bill","var input = __input.response;
if(empty(input)){
    __next = '2';
}else{
    orgShortCode=IC.queryShortCodeByOperatorCode(input);

    if(empty(orgShortCode)){
        __next='2a';
    }else{
_params.InitiatorIdentifier = input;
            __next='3';
       
    }
}","2","Input the Initiator Operator ID","<html>
<body>
Input the Initiator Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","31607","31603","Organization Query 3rd Bill","var input = __input.response;
if(empty(input)){
    __next = '2a';
}else{
    orgShortCode=IC.queryShortCodeByOperatorCode(input);

    if(empty(orgShortCode)){
        __next='2a';
    }else{

        if(IC.verifyShortcodeAndMsisdn(orgShortCode,__params.AccessDeviceIdentifier)){
            __params.InitiatorIdentifier = input;
            __next='3';
        }else{
            __errormsg='Sorry,the msisdn or operator id is worng,please try again.';
            __next='error';
        }
    }
}","2a","Reenter Operator ID","<html>
<body>
The Operator ID is not exist, please input the Initiator Operator ID again<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","31608","31603","Organization Query 3rd Bill","var input = __input.response;
if(empty(input)){
     __next = '3';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',input);
   
    __next = '4';
}","3","Input KYC Fields","<html>
<body>
Input Org Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","31609","31603","Organization Query 3rd Bill","var input = __input.response;

if(empty(input)){
	__next = '4';
}else{
        __params.PIN = input;

	__params.put('TransOutgoingRequest@LIST@Param.Identifier',orgShortCode);
	__params.put('TransOutgoingRequest@LIST@Param.IdentifierType','04');
        __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
        __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
        __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__params.sessionId);

	
	var result=AG.sendSyncTransOutgoing(__params,'52');
	
	if(empty(result) || empty(result.header)){
		__errormsg = 'Sorry, Query 3rd bill error';
		__next='error';
	}else  if(result.header.resultCode != '0'){
                __errormsg = 'Sorry, Third Party Response error,please try later.';
                __next='error';
        }else{
__params.ResultType='0';
__params.EventType='QUERY_BILL';
                __params.Reason=""Query Third Party Bills Success"";
                __params.ResultCode='0';


                TC.savingPreValidationEventLog(__params);
		billListStr = result.msgBody.GenericParameters;
                
                if(!empty(billListStr)){
                    billList = Util.stringSplit(billListStr,';');
                }
                __next='5';
        }
    }","4","Input Initiator PIN","<html>
<body>
Input Initiator Operator PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","31610","31603","Organization Query 3rd Bill","var input = __input.response;

if(input == '0'){
    __errormsg='You have colsed the session.';
    __next='error';
}else{
    __next='5';
}","5","Show Bill List","<html>
<body>
$$if (empty(billList)){
Third party cannot find your bill.
$$}else{
Organization bills are as follows,please select bill to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","2","31611","30301","Send Money Pre validation via API","AG.sendTransOutgoing(CurReq,__params,'140');
           pin=  CurReq.getValueFromBody('TransactionEventRequest.pin');
           __next = '1';","3a","push session","push session",""<endrec>
"Pre-Validation","","2","31701","1999","Send Money_USSD Push POC","AG.sendTransOutgoing(CurReq,__params,'140');
pin=  CurReq.getValueFromBody('TransactionEventRequest.pin');
DEBUG.error('test1');
 __next = '1';","3","push session","push session",""<endrec>
"TILL","","12","31702","23142","Add Group Member","var input = __input.response;
cust = IC.queryIdentityName('01',__params.InvitedMSISDN,'01',__params.InvitedMSISDN);
custname = IC.queryCustomerName(__params.InvitedMSISDN);
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
if(!IC.isSupportCustomerNameSearch() || cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01'){
__next = '7';
}
else
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '10')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {           
	   promptText = promptText + 'The amount of charge is '+fee.amount;
	  
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';
	   }
		i = i+1;
	  }
  }
   taxList = budgetMap.tax;

   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
	   if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }
		promptText = promptText + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
  {
    promptText =' No charge.';
  } 
  else
  {
    promptText =promptText +'.';
  }

var tips = '';
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
     if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
     {
       if(cust.subType  == '1000')
       {
	 tips = tips  + 'the received customer is unregistered.' + '<br>';
       }
       else if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
       {		   
           var nameStr= (empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName +' ');

           tips = tips + 'Registered Customer name : ' +custname  + '<br>';
           if(nameStr != ''){
           __params.IsCNSDataDisplayed = 'Yes';
           }
       }
     }

tips = tips + 'Phone number : ' + cust.basicIdentifier + '<br>';
promptText = promptText + '<br>' + tips;

__params.preValidationResult = promptText;
__next = '6';
}
}
}
else if (input == '2') {
__next = '7';
}
}
else {
 __next = '5';
}","5","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","31703","23142","Add Group Member","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__next = '7';
}
else if (input == '2') {
if(__params.IsCNSDataDisplayed == 'Yes')
{
  IC.cnsCancelationProcess(__params.InitiatorIdentifierType,__params.InitiatorIdentifier);
}
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
}
else {
 __next = '6';
}","6","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Group Name: ${__params.groupmap.groupName}<br>
Group code:${__params.ReceiverPartyIdentifier}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","19","31704","2280","Change Group Member Role V2.0","var input = __input.response;
cust = IC.queryIdentityName('01',__params.ChangedMSISDN,'01',__params.ChangedMSISDN);
custname = IC.queryCustomerName(__params.ChangedMSISDN);
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
if(!IC.isSupportCustomerNameSearch() || cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01'){
__next = '7';
}
else
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '10')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {           
	   promptText = promptText + 'The amount of charge is '+fee.amount;
	  
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';
	   }
		i = i+1;
	  }
  }
   taxList = budgetMap.tax;

   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
	   if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }
		promptText = promptText + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
  {
    promptText =' No charge.';
  } 
  else
  {
    promptText =promptText +'.';
  }

var tips = '';
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
     if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
     {
       if(cust.subType  == '1000')
       {
	 tips = tips  + 'the received customer is unregistered.' + '<br>';
       }
       else if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
       {		   
           var nameStr= (empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName +' ');

           tips = tips + 'ChangedMSISDN Customer name : ' +custname  + '<br>';
           if(nameStr != ''){
           __params.IsCNSDataDisplayed = 'Yes';
           }
       }
     }
tips = tips + 'Phone number : ' + cust.basicIdentifier + '<br>' + 'Add role: ' +__params.AddRoleList + 'Remove role: ' +__params.RemoveRoleList ;
promptText = promptText + '<br>' + tips;

__params.preValidationResult = promptText;
__next = '8';
}
}
}
else if (input == '2') {
__next = '9';
}
}
else {
 __next = '7';
}","7","please select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","20","31705","2280","Change Group Member Role V2.0","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__next = '9';
}
else if (input == '2') {
if(__params.IsCNSDataDisplayed == 'Yes')
{
  IC.cnsCancelationProcess(__params.InitiatorIdentifierType,__params.InitiatorIdentifier);
}
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
}
else {
 __next = '8';
}","8","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","31706","23099","Change Group Member Role","var input = __input.response;
cust = IC.queryIdentityName('01',__params.ChangedMSISDN,'01',__params.ChangedMSISDN);
custname = IC.queryCustomerName(__params.ChangedMSISDN);
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
if(!IC.isSupportCustomerNameSearch() || cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01'){
__next = '7';
}
else
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '10')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {           
	   promptText = promptText + 'The amount of charge is '+fee.amount;
	  
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';
	   }
		i = i+1;
	  }
  }
   taxList = budgetMap.tax;

   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
	   if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }
		promptText = promptText + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
  {
    promptText =' No charge.';
  } 
  else
  {
    promptText =promptText +'.';
  }

var tips = '';
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
     if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
     {
       if(cust.subType  == '1000')
       {
	 tips = tips  + 'the received customer is unregistered.' + '<br>';
       }
       else if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
       {		   
           var nameStr= (empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName +' ');

           tips = tips + 'Change role Customer name : ' +custname  + '<br>';
           if(nameStr != ''){
           __params.IsCNSDataDisplayed = 'Yes';
           }
       }
     }
tips = tips + 'Phone number : ' + cust.basicIdentifier ;
promptText = promptText + '<br>' + tips;

__params.preValidationResult = promptText;
__next = '6b';
}
}
}
else if (input == '2') {
__next = '7';
}
}
else {
 __next = '6a';
}","6a","please select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","31707","23099","Change Group Member Role","var input = __input.response;
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__next = '7';
}
else if (input == '2') {
if(__params.IsCNSDataDisplayed == 'Yes')
{
  IC.cnsCancelationProcess(__params.InitiatorIdentifierType,__params.InitiatorIdentifier);
}
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
__next = 'error';
}
}
else {
 __next = '6b';
}","6b","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
from role ${__params.RemoveRoleName} to ${__params.AddRoleName}<br>
Group details: ${__params.ReceiverPartyIdentifier}<br>
Group Name: ${__params.groupmap.groupName}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","31710","23318","CCH Change Group Member Role","var input = __input.response;
cust = IC.queryIdentityName('01',__params.ChangedMSISDN,'01',__params.ChangedMSISDN);
custname = IC.queryCustomerName(__params.ChangedMSISDN);
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
if(!IC.isSupportCustomerNameSearch() || cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01'){
__next = '7';
}
else
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '10')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {           
	   promptText = promptText + 'The amount of charge is '+fee.amount;
	  
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';
	   }
		i = i+1;
	  }
  }
   taxList = budgetMap.tax;

   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
	   if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }
		promptText = promptText + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
  {
    promptText =' No charge.';
  } 
  else
  {
    promptText =promptText +'.';
  }

var tips = '';
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
     if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
     {
       if(cust.subType  == '1000')
       {
	 tips = tips  + 'the received customer is unregistered.' + '<br>';
       }
       else if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
       {		   
           var nameStr= (empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName +' ');

           tips = tips + 'Change role Customer name : ' +custname  + '<br>';
           if(nameStr != ''){
           __params.IsCNSDataDisplayed = 'Yes';
           }
       }
     }
tips = tips + 'Phone number : ' + cust.basicIdentifier ;
promptText = promptText + '<br>' + tips;

__params.preValidationResult = promptText;
__next = '6b';
}
}
}
else if (input == '2') {
__next = '7';
}
}
else {
 __next = '6a';
}","6a","please select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","31711","23318","CCH Change Group Member Role","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__next = '7';
}
else if (input == '2') {
if(__params.IsCNSDataDisplayed == 'Yes')
{
  IC.cnsCancelationProcess(__params.InitiatorIdentifierType,__params.InitiatorIdentifier);
}
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
}
else {
 __next = '6b';
}","6b","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
from role ${__params.RemoveRoleName} to ${__params.AddRoleName}<br>
Group details: ${__params.ReceiverPartyIdentifier}<br>
Group Name: ${__params.groupmap.groupName}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","31714","31713","Group Query 3rd Bill","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.sessionId = universalSessionID.channelSessionID;

__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","31715","31713","Group Query 3rd Bill","var input = __input.response;

if(empty(input)){
     __next = '1';
}else{

    var orgStatus = IC.queryOrgStatusByShortCode(input);
    if(!empty(orgStatus) && orgStatus =='03'){
        __params.ReceiverPartyIdentifier = input;
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode',input);
        __next = '2';
    }else{
        __errormsg='Sorry,the third party is not in active or the third party is not exist,please try later.';
        __next='error';
    }
}","1","Input Receiver Organization Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","31716","31713","Group Query 3rd Bill","var input = __input.response;
if(empty(input)){
     __next = '2';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',input);
   
    __next = '3';
}","2","Input KYC Fields","<html>
<body>
Input You FirstName<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","31717","31713","Group Query 3rd Bill","var input = __input.response;
if(empty(input) || !IC.verifyIdentityPIN(__params.InitiatorIdentifierType,__params.InitiatorIdentifier,input)){
	__next = '3';
}else{
       var pinStatus = IC.queryPinStatusByIdentifier(__params.InitiatorIdentifier,__params.InitiatorIdentifierType);
        if(empty(pinStatus) || pinStatus != '1'){
                __errormsg = 'Sorry, your pin is not in normal.';
		__next='error';
        }else{

        __params.PIN = input;
	__params.put('TransOutgoingRequest@LIST@Param.Identifier',__params.InitiatorIdentifier);
	__params.put('TransOutgoingRequest@LIST@Param.IdentifierType',__params.InitiatorIdentifierType);
        __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
        __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
        __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__params.sessionId);

	var result=AG.sendSyncTransOutgoing(__params,'52');
	if(empty(result) || empty(result.header)){
		__errormsg = 'Sorry, Query 3rd bill error';
		__next='error';
	}else  if(result.header.resultCode != '0'){
                __errormsg = 'Sorry, Third Party Response error,please try later.';
                __next='error';
        }else{
__params.ResultType='0';
                __params.EventType='QUERY_BILL';

                __params.Reason=""Query Third Party Bills Success"";

                __params.ResultCode='0';
                TC.savingPreValidationEventLog(__params);
		billListStr = result.msgBody.GenericParameters;
                
                if(!empty(billListStr)){
                    billList = Util.stringSplit(billListStr,';');
                }

                __next='4';
        }
    }
}","3","Input PIN","<html>
<body>
Input You PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","31718","31713","Group Query 3rd Bill","var input = __input.response;

if(input == '0'){
    __errormsg='You have colsed the session.';
    __next='error';
}else{
    __next='4';
}","4","Show Bill List","<html>
<body>
$$if (empty(billList)){
Third party cannot find your bill.
$$}else{
Your bills are as follows,please enter 0 to close session.<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","24","31721","1024","Customer pay bill","var input = __input.response;
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '10')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
i = 1;
sizeLen = size(feeList);
for(fee:feeList)
{
promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
if(i < sizeLen)
{
promptText = promptText + '<br>';
}
i = i+1 
}
}
taxList = budgetMap.tax;
if(!empty(taxList)){
i = 1;
sizeLen = size(taxList);
for(tax:taxList)
{
if(i ==1 &&  promptText != '')
{
promptText = promptText + '<br>';
}
promptText = promptText

+ fee.publicName + ':The amount of tax is '+tax.amount;
if(i <sizeLen)
{
promptText = promptText + '<br>';
} 
i = i+1;
}
}
if( promptText == '')
{promptText =' No charge.';} 
else
{promptText =promptText +'.';
}

var org=IC.queryIdentityName('04',__params.ReceiverPartyIdentifier,'04',__params.ReceiverPartyIdentifier,'01',__params.AccessDeviceIdentifier);
var tips = 'You will Pay Bill of '+IC.formatAmount('', __params.Amount) + ' to ' + org.firstName +' with '+ __params.BillReferenceNumber+  '. ';
promptText = promptText + '<br>' + tips + 'org: ' + org;
__params.preValidationResult = promptText;
__next = '9b';
}
}
else if (input == '2') {
  __next = '10';
  }
}
else {
 __next = '9a';
}","9a","please select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","25","31722","1024","Customer pay bill","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__params.EventType=""PRE_VALIDATION"";
__params.Reason=""Continue Pre-Validation Transaction"";
TC.savingPreValidationEventLog(__params);
__next = '10';
}
else if (input == '2') {
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
__next = 'error';
}
}
else {
 __next = '9b';
}","9b","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","31724","31723","Customer Query 3rd Buy Goods","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.sessionId = universalSessionID.channelSessionID;

__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","31725","31723","Customer Query 3rd Buy Goods","var input = __input.response;

if(empty(input)){
     __next = '1';
}else{

    var orgStatus = IC.queryOrgStatusByShortCode(input);
    if(!empty(orgStatus) && orgStatus =='03'){
        __params.ReceiverPartyIdentifier = input;
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode',input);
        __next = '2';
    }else{
        __errormsg='Sorry,the third party is not in active or the third party is not exist,please try later.';
        __next='error';
    }
}","1","Input Receiver Organization Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","31726","31723","Customer Query 3rd Buy Goods","var input = __input.response;
if(empty(input)){
     __next = '2';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',input);
   
    __next = '3';
}","2","Input KYC Field","<html>
<body>
Input You FirstName<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","31727","31723","Customer Query 3rd Buy Goods","var input = __input.response;
if(empty(input) || !IC.verifyIdentityPIN(__params.InitiatorIdentifierType,__params.InitiatorIdentifier,input)){
	__next = '3';
}else{
       var pinStatus = IC.queryPinStatusByIdentifier(__params.InitiatorIdentifier,__params.InitiatorIdentifierType);
        if(empty(pinStatus) || pinStatus != '1'){
                __errormsg = 'Sorry, your pin is not in normal.';
		__next='error';
        }else{

        __params.PIN = input;
	__params.put('TransOutgoingRequest@LIST@Param.Identifier',__params.InitiatorIdentifier);
	__params.put('TransOutgoingRequest@LIST@Param.IdentifierType',__params.InitiatorIdentifierType);
        __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
        __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
        __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__params.sessionId);

	var result=AG.sendSyncTransOutgoing(__params,'52');
	if(empty(result) || empty(result.header)){
		__errormsg = 'Sorry, Query 3rd bill error';
		__next='error';
	}else  if(result.header.resultCode != '0'){
                __errormsg = 'Sorry, Third Party Response error,please try later.';
                __next='error';
        }else{
__params.ResultType='0';
                __params.EventType='QUERY_BILL';

                __params.Reason=""Query Third Party Bills Success"";

                __params.ResultCode='0';
                TC.savingPreValidationEventLog(__params);
		billListStr = result.msgBody.GenericParameters;
                
                if(!empty(billListStr)){
                    billList = Util.stringSplit(billListStr,';');
                }

                __next='4';
        }
    }
}","3","Input PIN","<html>
<body>
Input You PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","31728","31723","Customer Query 3rd Buy Goods","var input = __input.response;

if(input == '0'){
    __errormsg='You have colsed the session.';
    __next='error';
}else{
    __next='4';
}","4","Show Bill List","<html>
<body>
$$if (empty(billList)){
Third party cannot find your bill.
$$}else{
Your bills are as follows,please enter 0 to close session.<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","31731","31730","Customer Query 3rd Buy Goods and Payment","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.sessionId = universalSessionID.channelSessionID;

__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","8","31732","31730","Customer Query 3rd Buy Goods and Payment","var input = __input.response;

if(empty(input)){
     __next = '1';
}else{

    var orgStatus = IC.queryOrgStatusByShortCode(input);
    if(!empty(orgStatus) && orgStatus =='03'){
        __params.ReceiverPartyIdentifier = input;
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode',input);
        __next = '2';
    }else{
        __errormsg='Sorry,the third party is not in active or the third party is not exist,please try later.';
        __next='error';
    }
}","1","Input Receiver Organization Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","31733","31730","Customer Query 3rd Buy Goods and Payment","var input = __input.response;
if(empty(input)){
     __next = '2';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',input);
   
    __next = '3';
}","2","Input KYC Field","<html>
<body>
Input You FirstName<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","31734","31730","Customer Query 3rd Buy Goods and Payment","var input = __input.response;
if(empty(input) || !IC.verifyIdentityPIN(__params.InitiatorIdentifierType,__params.InitiatorIdentifier,input)){
	__next = '3';
}else{

       var pinStatus = IC.queryPinStatusByIdentifier(__params.InitiatorIdentifier,__params.InitiatorIdentifierType);
        if(empty(pinStatus) || pinStatus != '1'){
                __errormsg = 'Sorry, your pin is not in normal.';
		__next='error';
        }else{

        __params.PIN = input;
	__params.put('TransOutgoingRequest@LIST@Param.Identifier',__params.InitiatorIdentifier);
	__params.put('TransOutgoingRequest@LIST@Param.IdentifierType',__params.InitiatorIdentifierType);
        __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
        __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
        __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__params.sessionId);

	
	var result=AG.sendSyncTransOutgoing(__params,'52');
	
	if(empty(result) || empty(result.header)){
		__errormsg = 'Sorry, Query 3rd bill error';
		__next='error';
	}else  if(result.header.resultCode != '0'){
                __errormsg = 'Sorry, Third Party Response error,please try later.';
                __next='error';
        }else{
__params.ResultType='0';
                __params.EventType='QUERY_BILL';


                __params.Reason=""Query Third Party Bills Success"";
                __params.ResultCode='0';
                TC.savingPreValidationEventLog(__params);
		billListStr = result.msgBody.GenericParameters;
                
                if(!empty(billListStr)){
                    billList = Util.stringSplit(billListStr,';');
                }
                __next='4';
        }
    }
}","3","Input PIN","<html>
<body>
Input You PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","31735","31730","Customer Query 3rd Buy Goods and Payment","var input = __input.response;

if(empty(input) || !Validator.isDigit(input) || size(billList)<Util.toLong(input)){
    __next='4a';
}else if(input == '0'){
    __next='cancel';
}else{

    __params.remove('TransOutgoingRequest@LIST@Param.Identifier');
    __params.remove('TransOutgoingRequest@LIST@Param.IdentifierType');
    __params.remove('TransOutgoingRequest@LIST@Param.TransTime'); 
    __params.remove('TransOutgoingRequest@LIST@Param.GenericParameters');
    __params.remove('TransOutgoingRequest@LIST@Param.ConversationID');
    __params.remove('TransOutgoingRequest@LIST@Param.ShortCode');
    __params.remove('TransOutgoingRequest@LIST@Param.FirstName');

    var paymentBill=billList.get(Util.toLong(input)-1);
    var billInfoList = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfoList ){
        tempStrList=Util.stringSplit(billInfo,':');
        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
	        __params.BillReferenceNumber=tempStrList[1];
	    }else if(billInfo.contains('BillAmount')){
	        __params.Amount=tempStrList[1];

	    }else if(billInfo.contains('CurrencyCode')){
	        __params.Currency=tempStrList[1];
	    }
        }
    }
    
    __next='5';
}","4","Show Bill List","<html>
<body>
$$if (empty(billList)){
Third party cannot find your bill.
$$}else{
Your bills are as follows,please select bill to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","31736","31730","Customer Query 3rd Buy Goods and Payment","var input = __input.response;
if(empty(input) || !Validator.isDigit(input) || size(billList)<Util.toLong(input)){
    __next='4a';
}else if(input == '0'){
    __next='cancel';
}else{
    __params.remove('TransOutgoingRequest@LIST@Param.Identifier');
    __params.remove('TransOutgoingRequest@LIST@Param.IdentifierType');
    __params.remove('TransOutgoingRequest@LIST@Param.TransTime'); 
    __params.remove('TransOutgoingRequest@LIST@Param.GenericParameters');
    __params.remove('TransOutgoingRequest@LIST@Param.ConversationID');
    __params.remove('TransOutgoingRequest@LIST@Param.ShortCode');
    __params.remove('TransOutgoingRequest@LIST@Param.FirstName');

    var paymentBill=billList.get(Util.toLong(input)-1);
    var billInfoList = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfoList ){
        tempStrList=Util.stringSplit(billInfo,':');
        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
	        __params.BillReferenceNumber=tempStrList[1];
	    }else if(billInfo.contains('BillAmount')){
	        __params.Amount=tempStrList[1];

	    }else if(billInfo.contains('CurrencyCode')){
	        __params.Currency=tempStrList[1];
	    }
        }
    }
    
    __next='5';
}","4a","Reenter Bill No","<html>
<body>
You enter a worng bill sequence, please select bill again to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","31737","31730","Customer Query 3rd Buy Goods and Payment","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","31740","31739","Group Query 3rd Buy Goods","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.sessionId = universalSessionID.channelSessionID;

__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","31741","31739","Group Query 3rd Buy Goods","var input = __input.response;

if(empty(input)){
     __next = '1';
}else{

    var orgStatus = IC.queryOrgStatusByShortCode(input);
    if(!empty(orgStatus) && orgStatus =='03'){
        __params.ReceiverPartyIdentifier = input;
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode',input);
        __next = '2';
    }else{
        __errormsg='Sorry,the third party is not in active or the third party is not exist,please try later.';
        __next='error';
    }
}","1","input Reciever Organization Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","31742","31739","Group Query 3rd Buy Goods","var input = __input.response;
if(empty(input)){
     __next = '2';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',input);
   
    __next = '3';
}","2","Input KYC Field","<html>
<body>
Input You FirstName<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","31743","31739","Group Query 3rd Buy Goods","var input = __input.response;
if(empty(input) || !IC.verifyIdentityPIN(__params.InitiatorIdentifierType,__params.InitiatorIdentifier,input)){
	__next = '3';
}else{
       var pinStatus = IC.queryPinStatusByIdentifier(__params.InitiatorIdentifier,__params.InitiatorIdentifierType);
        if(empty(pinStatus) || pinStatus != '1'){
                __errormsg = 'Sorry, your pin is not in normal.';
		__next='error';
        }else{

        __params.PIN = input;
	__params.put('TransOutgoingRequest@LIST@Param.Identifier',__params.InitiatorIdentifier);
	__params.put('TransOutgoingRequest@LIST@Param.IdentifierType',__params.InitiatorIdentifierType);
        __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
        __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
        __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__params.sessionId);

	var result=AG.sendSyncTransOutgoing(__params,'52');
	if(empty(result) || empty(result.header)){
		__errormsg = 'Sorry, Query 3rd bill error';
		__next='error';
	}else  if(result.header.resultCode != '0'){
                __errormsg = 'Sorry, Third Party Response error,please try later.';
                __next='error';
        }else{
__params.ResultType='0';
                __params.EventType='QUERY_BILL';

                __params.Reason=""Query Third Party Bills Success"";

                __params.ResultCode='0';
                TC.savingPreValidationEventLog(__params);
		billListStr = result.msgBody.GenericParameters;
                
                if(!empty(billListStr)){
                    billList = Util.stringSplit(billListStr,';');
                }

                __next='4';
        }
    }
}","3","Input PIN","<html>
<body>
Input You PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","31744","31739","Group Query 3rd Buy Goods","var input = __input.response;

if(input == '0'){
    __errormsg='You have colsed the session.';
    __next='error';
}else{
    __next='4';
}","4","Show Bill List","<html>
<body>
$$if (empty(billList)){
Third party cannot find your bill.
$$}else{
Your bills are as follows,please enter 0 to close session.<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","31747","31746","Group Query 3rd Buy Goods And Payment","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.sessionId = universalSessionID.channelSessionID;

__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","8","31748","31746","Group Query 3rd Buy Goods And Payment","var input = __input.response;

if(empty(input)){
     __next = '1';
}else{
    var orgStatus = IC.queryOrgStatusByShortCode(input);
    if(!empty(orgStatus) && orgStatus =='03'){
        __params.ReceiverPartyIdentifier = input;
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode',input);
        __next = '2';
    }else{
        __errormsg='Sorry,the third party is not in active or the third party is not exist,please try later.';
        __next='error';
    }
}","1","Input Receiver Organization Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","31749","31746","Group Query 3rd Buy Goods And Payment","var input = __input.response;
if(empty(input)){
    __next = '2';
}else{
    __params.PrimaryPartyIdentifier = input;

    var groupInfo=IC.queryGroupInfo('15',__params.PrimaryPartyIdentifier);
    if(empty(groupInfo)){
        __errormsg='Sorry,Can not find Group Info,please try again later.';
        __next='error';
    }else{
        __params.put('TransOutgoingRequest@LIST@Param.Identifier',input);
        __params.put('TransOutgoingRequest@LIST@Param.IdentifierType','15');
        __next='3';
    }
}","2","Input Initiator Group Code","<html>
<body>
Input the Initiator Group Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","31750","31746","Group Query 3rd Buy Goods And Payment","var input = __input.response;
if(empty(input)){
     __next = '3';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',input);
   
    __next = '4';
}","3","Input KYC Field","<html>
<body>
Input Group Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","31751","31746","Group Query 3rd Buy Goods And Payment","var input = __input.response;

if(empty(input) || !IC.verifyIdentityPIN(__params.InitiatorIdentifierType,__params.InitiatorIdentifier,input)){
	__next = '4';
}else{
       var pinStatus = IC.queryPinStatusByIdentifier(__params.InitiatorIdentifier,__params.InitiatorIdentifierType);
        if(empty(pinStatus) || pinStatus != '1'){
                __errormsg = 'Sorry, your pin is not in normal.';
		__next='error';
        }else{
        __params.PIN = input;
        __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
        __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
        __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__params.sessionId);

	var result=AG.sendSyncTransOutgoing(__params,'52');
	if(empty(result) || empty(result.header)){
		__errormsg = 'Sorry, Query 3rd bill error';
		__next='error';
	}else  if(result.header.resultCode != '0'){
                __errormsg = 'Sorry, Third Party Response error,please try later.';
                __next='error';
        }else{
__params.ResultType='0';
__params.EventType='QUERY_BILL';
                __params.Reason=""Query Third Party Bills Success"";
                __params.ResultCode='0';
                TC.savingPreValidationEventLog(__params);
		billListStr = result.msgBody.GenericParameters;
                


                if(!empty(billListStr)){
                    billList = Util.stringSplit(billListStr,';');
                }
                __next='5';
        }
    }
}","4","Input PIN","<html>
<body>
Input Initiator PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","31752","31746","Group Query 3rd Buy Goods And Payment","var input = __input.response;

if(empty(input) || !Validator.isDigit(input) || size(billList)<Util.toLong(input)){
    __next='5a';
}else if(input == '0'){
    __next='cancel';
}else{

    __params.remove('TransOutgoingRequest@LIST@Param.Identifier');
    __params.remove('TransOutgoingRequest@LIST@Param.IdentifierType');
    __params.remove('TransOutgoingRequest@LIST@Param.TransTime'); 
    __params.remove('TransOutgoingRequest@LIST@Param.GenericParameters');
    __params.remove('TransOutgoingRequest@LIST@Param.ConversationID');
    __params.remove('TransOutgoingRequest@LIST@Param.ShortCode');
    __params.remove('TransOutgoingRequest@LIST@Param.GroupName');


    var paymentBill=billList.get(Util.toLong(input)-1);
    var billInfoList = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfoList ){
        tempStrList=Util.stringSplit(billInfo,':');
        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
	        __params.BillReferenceNumber=tempStrList[1];
	    }else if(billInfo.contains('BillAmount')){
	        __params.Amount=tempStrList[1];

	    }else if(billInfo.contains('CurrencyCode')){
	        __params.Currency=tempStrList[1];
	    }
        }
    }
    __next='6';
}","5","Show Buy Goods List","<html>
<body>
$$if (empty(billList)){
Third party cannot find your bill.
$$}else{
Group bills are as follows,please select bill to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","31753","31746","Group Query 3rd Buy Goods And Payment","var input = __input.response;

if(empty(input) || !Validator.isDigit(input) || size(billList)<Util.toLong(input)){
    __next='5a';
}else if(input == '0'){
    __next='cancel';
}else{

    __params.remove('TransOutgoingRequest@LIST@Param.Identifier');
    __params.remove('TransOutgoingRequest@LIST@Param.IdentifierType');
    __params.remove('TransOutgoingRequest@LIST@Param.TransTime'); 
    __params.remove('TransOutgoingRequest@LIST@Param.GenericParameters');
    __params.remove('TransOutgoingRequest@LIST@Param.ConversationID');
    __params.remove('TransOutgoingRequest@LIST@Param.ShortCode');
    __params.remove('TransOutgoingRequest@LIST@Param.GroupName');


    var paymentBill=billList.get(Util.toLong(input)-1);
    var billInfoList = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfoList ){
        tempStrList=Util.stringSplit(billInfo,':');
        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
	        __params.BillReferenceNumber=tempStrList[1];
	    }else if(billInfo.contains('BillAmount')){
	        __params.Amount=tempStrList[1];

	    }else if(billInfo.contains('CurrencyCode')){
	        __params.Currency=tempStrList[1];
	    }
        }
    }
    __next='6';
}","5a","Reenter Buy Goods List no","<html>
<body>
You enter a worng bill sequence, please select bill again to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","31754","31746","Group Query 3rd Buy Goods And Payment","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","31755","1902","Pay Bill With Prevalidation","var input = __input.response;
if (input == null || empty(input)) {
    __next = '2a';
} else {
    __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '3';
}","2a","enter customer date of birth","<html>
<body>
Enter Date Of Birth ddMMyy<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","31756","1044","Organization operator pay bill","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '10')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
i = 1;
sizeLen = size(feeList);
for(fee:feeList)
{
promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
if(i < sizeLen)
{
promptText = promptText + '<br>';
}
i = i+1 
}
}
taxList = budgetMap.tax;
if(!empty(taxList)){
i = 1;
sizeLen = size(taxList);
for(tax:taxList)
{
if(i ==1 &&  promptText != '')
{
promptText = promptText + '<br>';
}
promptText = promptText

+ fee.publicName + ':The amount of tax is '+tax.amount;
if(i <sizeLen)
{
promptText = promptText + '<br>';
} 
i = i+1;
}
}
if( promptText == '')
{promptText =' No charge.';} 
else
{promptText =promptText +'.';
}
}
__params.confirm = promptText;
if (input == '1')
{
var org=IC.queryIdentityName('05',__params.InitiatorIdentifier,'04',__params.ReceiverPartyIdentifier,'01',__params.AccessDeviceIdentifier);
var tips = 'You will Pay Bill of '+IC.formatAmount('', __params.Amount) + ' to ' + org.firstName +' with '+ __params.BillReferenceNumber+ '. ';
promptText = promptText + '<br>' + tips;
__params.preValidationResult = promptText;
__next = '8b';
}
else if (input == '2') {
  __next = '9';
  }
}
else {
 __next = '8a';
}","8a","please select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","31757","1044","Organization operator pay bill","var input = __input.response;
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__params.EventType=""PRE_VALIDATION"";
__params.Reason=""Continue Pre-Validation Transaction"";
__next = '9';
}
else if (input == '2') {
IC.cnsCancelationProcess('05',__params.InitiatorIdentifier);
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
__next = 'error';
}
}
else {
 __next = '8b';
}","8b","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","31758","1044","Organization operator pay bill","if(__errorCode == 'UMC64000')
{
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation confirmation is Timeout.';
__params.Reason=""Timeout"";
TC.savingPreValidationEventLog(__params);
__params.TransactionPreValidationEvent='Timeout';
__params.TransactionPreValidationError='Time out';
__params.put('Common.Result.ErrorCode','UMC64000');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
}","error","Execute while errors occur copy","error occurs.",""<endrec>
"CUSTOMER","","1","31760","31759","M-Shwari Withdraw2","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '262626';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","31761","31759","M-Shwari Withdraw2","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1b';
}","1b","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","31762","31759","M-Shwari Withdraw2","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","31763","31759","M-Shwari Withdraw2","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Withdraw ${__params.Amount} from bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","31764","31759","M-Shwari Withdraw2","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '1b';
         } else {
                __next = '1b';
         }
    } else {
        __next = '1';
    }
}","1","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","31766","31765","PayBillByOTCVoucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
 __params.AccessDeviceIdentifierType = '01';   /* MSISDN */ 
 __params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
 __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
 __params.RequesterIdentifierType = '03';
__next = '1'","begin","set parammeters","",""<endrec>
"TILL","","3","31767","31765","PayBillByOTCVoucher","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Requester Voucher Code","<html>
<body>
Enter Requester Voucher Code <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","31768","31765","PayBillByOTCVoucher","var input = __input.response;
__params.FirstName= input;
__next = '3';","2","Enter First Name","<html>
<body>
Enter First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","31769","31765","PayBillByOTCVoucher","__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
      __next = '4';
   } 
 else 
   {
      __next = '3';
   }","3","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","31770","31765","PayBillByOTCVoucher","var input = __input.response;
__params.BillReferenceNumber = input;
__next = '5';","4","Enter Business No","<html>
<body>
Enter Business No.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","31771","31765","PayBillByOTCVoucher","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","31772","31765","PayBillByOTCVoucher","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","31773","31765","PayBillByOTCVoucher","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","31774","31765","PayBillByOTCVoucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","31775","31765","PayBillByOTCVoucher","var input = __input.response;
 __params.VoucherValidationValue = input;
 __next = '10';","9","Enter Additional validation information","<html>
<body>
Enter Additional validation information<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","31776","31765","PayBillByOTCVoucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Pay Bill - ${__params.BillReferenceNumber} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","31778","31777","Create Direct Debit Mandate by Payee2","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CreateDirectDebitMandateByPayee';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '05';
__next = '0';","begin","set parammeters","",""<endrec>
"TILL","","2","31779","31777","Create Direct Debit Mandate by Payee2","var input = __input.response;
if (input == '1' )
{
  __params.IdentifierType = '01'; 
 __next = '1';
}else if ( input == '2')
{
  __params.IdentifierType = '04'; 
 __next = '1';
}else if (input == '3')
{
  __params.IdentifierType = '15';
 __next = '1';
} else {
   __next = '0';
}","0","Select Option","<html>
<body>
Please select Payer Identifier Type: <br>
1 Customer<br>
2 Organization<br>
3 Group
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","31780","31777","Create Direct Debit Mandate by Payee2","var input = __input.response;
if (!empty(input)) {
  __params.Identifier= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Payer ID","<html>
<body>
Enter  Payer  ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","31781","31777","Create Direct Debit Mandate by Payee2","var input = __input.response;
var length = size(input);
if (!empty(input) && length < 64) {
  __params.PayerReferenceNumber = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Payer Unique Reference number","<html>
<body>
Enter Payer Unique Reference number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","31782","31777","Create Direct Debit Mandate by Payee2","__params.AgreedTC = '1';
__next = '4';","3","Agreed TC","<html>
<body>
Please Confirm you have Agreed Terms and Conditions <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","31783","31777","Create Direct Debit Mandate by Payee2","var input = __input.response;
var length = size(input);
if(empty(input))
{
__next = '5';
}else if (length < 64) {
__params.PayeeAccountName= input;
__next = '5';
} else {
  __next = '4';
}","4","Enter Payee Account Instance","<html>
<body>
Enter Payee Account Instance <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","31784","31777","Create Direct Debit Mandate by Payee2","var input = __input.response;
if(empty(input))
{
__next = '6';
}else if (Validator.isMatchRegex(input,'^(0[1-8])$')) {
  __params.Frequency = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter Frequency","<html>
<body>
Enter Frequency <br>
01 One Off  <br>
02 Daily  <br>
03 Weekly  <br>
04 Monthly  <br>
05 Quarterly  <br>
06 Half Yearly  <br>
07 Yearly <br>
08 On Demand
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","31785","31777","Create Direct Debit Mandate by Payee2","var input = __input.response;
var frequency = __params.Frequency;
if (!empty(input) && !Validator.isDate(input, 'ddMMyyyy') || (frequency == '08') &&  !Validator.isDate(input, 'ddMMyyyy') ){
__next = '6';
} else {
 __params.FirstPaymentDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
  if(frequency == '08')
  {
    __next = '9';
  }else {
    __next = '7';
  }
}","6","Enter First Payment Date","<html>
<body>
Enter First Payment Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","31786","31777","Create Direct Debit Mandate by Payee2","var input = __input.response;
if(empty(input) ) 
{
  __next = '8';
}
else if(Validator.isMatchRegex(input ,'^([1-9]|[1-2]\d|3[0-1])$'))
{
   __next = '8';
__params.StartRangeOfDays = input;

}else
{
    __next = '7';
}","7","Enter Start of Range of days","<html>
<body>
Enter Start of Range of days <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","31787","31777","Create Direct Debit Mandate by Payee2","var input = __input.response;
if(empty(input) ) 
{
  __next = '9';
}
else if(Validator.isMatchRegex(input ,'^([1-9]|[1-2]\d|3[0-1])$'))
{
   __next = '9';
__params.EndRangeOfDays = input;

}else
{
    __next = '8';
}","8","Enter End of Range of days","<html>
<body>
Enter End of Range of days <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","31788","31777","Create Direct Debit Mandate by Payee2","var input = __input.response;
if (!empty(input) && !Validator.isDate(input, 'ddMMyyyy')){
__next = '9';
} else {
    __params.ExpiryDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '10';
}","9","Enter Expiry Date","<html>
<body>
Enter Expiry Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","31789","31777","Create Direct Debit Mandate by Payee2","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
__params.ReceiverPartyIdentifier = input;
  __next = '11';
} else {
  __next = '10';
}","10","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","31790","31777","Create Direct Debit Mandate by Payee2","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
    __next = '12';
} else {
    __secure = true;
    __next = '11';
}","11","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","14","31791","31777","Create Direct Debit Mandate by Payee2","var input = __input.response;
__params.Payer = IC.buildDirectDebitPayerInfo(__params);
__params.DirectDebitMandateInfo = IC.buildDirectDebitMandateInfo(__params);

if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '12';
}","12","Confirm","<html>
<body>
Create Direct Debit Mandate<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","31802","31801","Group Query 3rd Bill and Payment","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"TILL","","1","31805","31804","Organization Query 3rd Buy Goods and Payment","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.sessionId = universalSessionID.channelSessionID;

__params.AccessDeviceIdentifierType = '01';   /* MSISDN */ 
 __params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
 __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */


__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","9","31806","31804","Organization Query 3rd Buy Goods and Payment","var input = __input.response;

if(empty(input)){
     __next = '1';
}else{
    var orgStatus = IC.queryOrgStatusByShortCode(input);
    if(!empty(orgStatus) && orgStatus =='03'){
        __params.ReceiverPartyIdentifier = input;
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode',input);
        __next = '2';
    }else{
        __errormsg='Sorry,the third party is not in active or the third party is not exist,please try later.';
        __next='error';
    }
}","1","Input Receiver Organization Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","31807","31804","Organization Query 3rd Buy Goods and Payment","var input = __input.response;
if(empty(input)){
    __next = '2';
}else{
    orgShortCode=IC.queryShortCodeByOperatorCode(input);

    if(empty(orgShortCode)){
        __next='2a';
    }else{

        
            __params.InitiatorIdentifier = input;
            __next='3';
       
    }
}","2","Input Initiator Operator ID","<html>
<body>
Input the Initiator Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","31808","31804","Organization Query 3rd Buy Goods and Payment","var input = __input.response;
if(empty(input)){
    __next = '2a';
}else{
    orgShortCode=IC.queryShortCodeByOperatorCode(input);

    if(empty(orgShortCode)){
        __next='2a';
    }else{

     
            __params.InitiatorIdentifier = input;
            __next='3';
       
    }
}","2a","Reenter Operator ID","<html>
<body>
The Operator ID is not exist, please input the Initiator Operator ID again<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","31809","31804","Organization Query 3rd Buy Goods and Payment","var input = __input.response;
if(empty(input)){
     __next = '3';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',input);
   
    __next = '4';
}","3","Input KYC Field","<html>
<body>
Input Org Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","31810","31804","Organization Query 3rd Buy Goods and Payment","var input = __input.response;

if(empty(input)){
	__next = '4';
}else{
        __params.PIN = input;

	__params.put('TransOutgoingRequest@LIST@Param.Identifier',orgShortCode);
	__params.put('TransOutgoingRequest@LIST@Param.IdentifierType','04');
        __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
        __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
        __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__params.sessionId);

	
	var result=AG.sendSyncTransOutgoing(__params,'52');
	
	if(empty(result) || empty(result.header)){
		__errormsg = 'Sorry, Query 3rd bill error';
		__next='error';
	}else  if(result.header.resultCode != '0'){
                __errormsg = 'Sorry, Third Party Response error,please try later.';
                __next='error';
        }else{
__params.ResultType='0';
__params.EventType='QUERY_BILL';
                __params.Reason=""Query Third Party Bills Success"";
                __params.ResultCode='0';


                TC.savingPreValidationEventLog(__params);
		billListStr = result.msgBody.GenericParameters;
                
                if(!empty(billListStr)){
                    billList = Util.stringSplit(billListStr,';');
                }
                __next='5';
        }
    }","4","Input Initiator PIN","<html>
<body>
Input Initiator Operator PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","31811","31804","Organization Query 3rd Buy Goods and Payment","var input = __input.response;

if(empty(input) || !Validator.isDigit(input) || size(billList)<Util.toLong(input)){
    __next='5a';
} else if(input == '0'){
    __next='cancel';
}else{

    __params.remove('TransOutgoingRequest@LIST@Param.Identifier');
    __params.remove('TransOutgoingRequest@LIST@Param.IdentifierType');
    __params.remove('TransOutgoingRequest@LIST@Param.TransTime'); 
    __params.remove('TransOutgoingRequest@LIST@Param.GenericParameters');
    __params.remove('TransOutgoingRequest@LIST@Param.ConversationID');
    __params.remove('TransOutgoingRequest@LIST@Param.ShortCode');
    __params.remove('TransOutgoingRequest@LIST@Param.OrgName');

    var paymentBill=billList.get(Util.toLong(input)-1);
    var billInfoList = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfoList ){
        tempStrList=Util.stringSplit(billInfo,':');
        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
	        __params.BillReferenceNumber=tempStrList[1];
	    }else if(billInfo.contains('BillAmount')){
	        __params.Amount=tempStrList[1];

	    }else if(billInfo.contains('CurrencyCode')){
	        __params.Currency=tempStrList[1];
	    }
        }
    }

    __next='6';
}","5","Show Invoice List","<html>
<body>
$$if (empty(billList)){
Third party cannot find your bill.
$$}else{
Organization bills are as follows,please select bill to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","31812","31804","Organization Query 3rd Buy Goods and Payment","var input = __input.response;

if(empty(input) || !Validator.isDigit(input) || size(billList)<Util.toLong(input)){
    __next='5a';
} else if(input == '0'){
    __next='cancel';
}else{

    __params.remove('TransOutgoingRequest@LIST@Param.Identifier');
    __params.remove('TransOutgoingRequest@LIST@Param.IdentifierType');
    __params.remove('TransOutgoingRequest@LIST@Param.TransTime'); 
    __params.remove('TransOutgoingRequest@LIST@Param.GenericParameters');
    __params.remove('TransOutgoingRequest@LIST@Param.ConversationID');
    __params.remove('TransOutgoingRequest@LIST@Param.ShortCode');
    __params.remove('TransOutgoingRequest@LIST@Param.OrgName');

    var paymentBill=billList.get(Util.toLong(input)-1);
    var billInfoList = Util.stringSplit(paymentBill,',');
    for(var billInfo:billInfoList ){
        tempStrList=Util.stringSplit(billInfo,':');
        if(!empty(tempStrList) && tempStrList.size()>=2){
            if(billInfo.contains('BillReferenceNumber')){
	        __params.BillReferenceNumber=tempStrList[1];
	    }else if(billInfo.contains('BillAmount')){
	        __params.Amount=tempStrList[1];

	    }else if(billInfo.contains('CurrencyCode')){
	        __params.Currency=tempStrList[1];
	    }
        }
    }

    __next='6';
}","5a","Reenter Invoice Number","<html>
<body>
You enter a worng bill sequence, please select bill again to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","31813","31804","Organization Query 3rd Buy Goods and Payment","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","31815","31814","Organization Query 3rd Buy Goods","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.sessionId = universalSessionID.channelSessionID;

__params.AccessDeviceIdentifierType = '01';   /* MSISDN */ 
 __params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
 __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */


__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","7","31816","31814","Organization Query 3rd Buy Goods","var input = __input.response;

if(empty(input)){
     __next = '1';
}else{
    var orgStatus = IC.queryOrgStatusByShortCode(input);
    if(!empty(orgStatus) && orgStatus =='03'){
        __params.ReceiverPartyIdentifier = input;
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode',input);
        __next = '2';
    }else{
        __errormsg='Sorry,the third party is not in active or the third party is not exist,please try later.';
        __next='error';
    }
}","1","Input Receiver Oerganization Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","31817","31814","Organization Query 3rd Buy Goods","var input = __input.response;
if(empty(input)){
    __next = '2';
}else{
    orgShortCode=IC.queryShortCodeByOperatorCode(input);

    if(empty(orgShortCode)){
        __next='2a';
    }else{
_params.InitiatorIdentifier = input;
            __next='3';
       
    }
}","2","Input Initiator Operator ID","<html>
<body>
Input the Initiator Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","31818","31814","Organization Query 3rd Buy Goods","var input = __input.response;
if(empty(input)){
    __next = '2a';
}else{
    orgShortCode=IC.queryShortCodeByOperatorCode(input);

    if(empty(orgShortCode)){
        __next='2a';
    }else{

        if(IC.verifyShortcodeAndMsisdn(orgShortCode,__params.AccessDeviceIdentifier)){
            __params.InitiatorIdentifier = input;
            __next='3';
        }else{
            __errormsg='Sorry,the msisdn or operator id is worng,please try again.';
            __next='error';
        }
    }
}","2a","Reenter Operator ID","<html>
<body>
The Operator ID is not exist, please input the Initiator Operator ID again<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","31819","31814","Organization Query 3rd Buy Goods","var input = __input.response;
if(empty(input)){
     __next = '3';
}else{
    __params.put('TransOutgoingRequest@LIST@Param.KYCField',input);
   
    __next = '4';
}","3","Input KYC Field","<html>
<body>
Input Org Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","31820","31814","Organization Query 3rd Buy Goods","var input = __input.response;

if(empty(input)){
	__next = '4';
}else{
        __params.PIN = input;

	__params.put('TransOutgoingRequest@LIST@Param.Identifier',orgShortCode);
	__params.put('TransOutgoingRequest@LIST@Param.IdentifierType','04');
        __params.put('TransOutgoingRequest@LIST@Param.TransTime',Util.getCurrentTime());
        __params.put('TransOutgoingRequest@LIST@Param.GenericParameters','BillNumber;Amount;DueDate');
        __params.put('TransOutgoingRequest@LIST@Param.ConversationID',__params.sessionId);

	
	var result=AG.sendSyncTransOutgoing(__params,'52');
	
	if(empty(result) || empty(result.header)){
		__errormsg = 'Sorry, Query 3rd bill error';
		__next='error';
	}else  if(result.header.resultCode != '0'){
                __errormsg = 'Sorry, Third Party Response error,please try later.';
                __next='error';
        }else{
__params.ResultType='0';
__params.EventType='QUERY_BILL';
                __params.Reason=""Query Third Party Bills Success"";
                __params.ResultCode='0';


                TC.savingPreValidationEventLog(__params);
		billListStr = result.msgBody.GenericParameters;
                
                if(!empty(billListStr)){
                    billList = Util.stringSplit(billListStr,';');
                }
                __next='5';
        }
    }","4","Input Initiator PIN","<html>
<body>
Input Initiator Operator PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","31821","31814","Organization Query 3rd Buy Goods","var input = __input.response;

if(input == '0'){
    __errormsg='You have colsed the session.';
    __next='error';
}else{
    __next='5';
}","5","Show Invoice List","<html>
<body>
$$if (empty(billList)){
Third party cannot find your bill.
$$}else{
Organization bills are as follows,please select bill to payment,enter 0 to cancel<br>
$$var index= 1;
$$for(bill: billList ) {
${index}  ${bill}<br>
$$index = index + 1;
$$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","31823","20028","Customer Intra-Account Transfer m-pesae  to Saving","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Input Pin","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","31901","24117","Organization Redeem Voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '5';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '6';
}","5","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","31903","31902","Change Language2","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = msisdn;
__params.PrimaryIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","31904","31902","Change Language2","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(languages)) {
__phase = 0;
__locale = languages.get(i);
__next = 'begin';
} else {
  __next = '1';
}","1","Please select language","<html>
<body>
Please select language:<br>
$$languages = IC.queryAllLanguages();
$$var i = 1;
$$for (lang: languages) {
  ${i} ${lang.getDisplayName(identity.locale)}<br>
  $$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","32002","32001","Activate Customer Without Start PIN","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CustomerActivateByCreatePIN'; /* CustomerActivateByCreatePIN or Activate*/ 
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.@HEAD@IgnorePIN='true';
__params.ReceiverPartyIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","32003","32001","Activate Customer Without Start PIN","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(languages)) {
  __params.@BODY@LanguageCode = languages.get(i).toString();
  __secure = true;
  __next = '2';
} else {
  __next = '1';
}","1","Select Language","<html>
<body>
Please select language:<br>
$$languages = IC.queryAllLanguages();
$$var i = 1;
$$for (lang: languages) {
  ${i} ${lang.getDisplayName(identity.locale)}<br>
$$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","32004","32001","Activate Customer Without Start PIN","var input = __input.response;
__params.NewPIN = input;
__secure = true;
__next = '3';","2","Enter New PIN","<html>
<body>
Enter New PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","32005","32001","Activate Customer Without Start PIN","var input = __input.response;
if(__params.NewPIN == input)
{
__next = '4';
}
else
{
__next = '3';
}","3","Confirm new PIN","<html>
<body>
Confirm new PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","32006","32001","Activate Customer Without Start PIN","var input = __input.response;
if (Validator.isDate(input, 'ddmmyyyy')) {
 __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddmmyyyy');
__params.Birthday = input;
    __next = '5';
} else {
    __next = '4';
}","4","Enter Date of Birth","<html>
<body>
Enter Date of Birth(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","32007","32001","Activate Customer Without Start PIN","var input = __input.response;
__params.KYCInfo = IC.buildCustomerInfo(__params);
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to Activate?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","32008","1754","M-Shwari Org Terms And Conditons","__next = '4';","3","Terms And Conditons","<html>
<body>
Terms and conditions
These terms and conditions (“Terms and Conditions”) apply to your use of all Elsevier websites, <br>
applications, services and products (“Services” or individually a “Service”) <br>
that post a link to these Terms and Conditions and that are provided by any<br> 
Elsevier group company worldwide (""Elsevier"", ""we"", ""us"" or ""our"").<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","32009","1870","Transfer Loyalty Points","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency  = type;
                __secure = true;
                __next = '1';
         } else {
                __next = '1b';
         }
    } else {
        __next = '1b';
    }
}","1b","Select Currency","<html>
<body>
Select the  Currency :<br>
$$multiCurrencyCode = IC.getAllForeignCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currencyCode to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","3201","1032","Super agent operator redeems a business deposit voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","1","32011","32010","Organization operator pay bill with pre-validation","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
 __params.AccessDeviceIdentifierType = '01';   /* MSISDN */ 
 __params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
 __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
CurrencyCode = """";
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","12","32012","32010","Organization operator pay bill with pre-validation","var input = __input.response;
__params.BillReferenceNumber = input;
__next = '2';","1","Enter Business No","<html>
<body>
Enter Business No.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","32013","32010","Organization operator pay bill with pre-validation","__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
      __next = '3';
   } 
 else 
   {
      __next = '2';
   }","2","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","32014","32010","Organization operator pay bill with pre-validation","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                CurrencyCode =  type;
                __params.Currency = type;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currency to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","32015","32010","Organization operator pay bill with pre-validation","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    if(1 == size(multiAccount)){
       type = multiAccount.get(0);
       if( 'true' == type.defaultFlag){
           __params.InitiatorAccountNo = type.AccountNo;
           __next = '6';
       }else{
          __next = '5';
       }
    }else{
       __next = '5';
    }
} else {
    __next = '4';
}","4","Enter Amount","<html>
<body>
Enter Amount<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'org float',CurrencyCode);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","32016","32010","Organization operator pay bill with pre-validation","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.InitiatorAccountNo = type.AccountNo;
                __secure = true;
                __next = '6';
         } else {
                __next = '5';
         }
    } else {
        __next = '5';
    }
}","5","Choose Inititator AccountNo","<html>
<body>
Please select Inititator account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'org float',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","32017","32010","Organization operator pay bill with pre-validation","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","32018","32010","Organization operator pay bill with pre-validation","var input = __input.response;
if (!empty(input)) {
  __params.PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","32019","32010","Organization operator pay bill with pre-validation","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8a';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","3202","1032","Super agent operator redeems a business deposit voucher","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';
","1","Enter Voucher Code","<html>
<body>
Enter Voucher Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","32020","32010","Organization operator pay bill with pre-validation","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '1')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
i = 1;
sizeLen = size(feeList);
for(fee:feeList)
{
promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
if(i < sizeLen)
{
promptText = promptText + '<br>';
}
i = i+1 
}
}
taxList = budgetMap.tax;
if(!empty(taxList)){
i = 1;
sizeLen = size(taxList);
for(tax:taxList)
{
if(i ==1 &&  promptText != '')
{
promptText = promptText + '<br>';
}
promptText = promptText

+ fee.publicName + ':The amount of tax is '+tax.amount;
if(i <sizeLen)
{
promptText = promptText + '<br>';
} 
i = i+1;
}
}
if( promptText == '')
{promptText =' No charge.';} 
else
{promptText =promptText +'.';
}
var org=IC.queryIdentityName('05',__params.InitiatorIdentifier,'04',__params.ReceiverPartyIdentifier,'01',__params.AccessDeviceIdentifier);
var tips = 'You will Pay Bill of '+IC.formatAmount('', __params.Amount) + ' to ' + org.firstName +' with '+ __params.BillReferenceNumber+ '. ';
promptText = promptText + '<br>' + tips;
__params.preValidationResult = promptText;
__next = '8b';
}
}
else if (input == '2') {
  __next = '9';
  }
}
else {
 __next = '8a';
}","8a","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","32021","32010","Organization operator pay bill with pre-validation","var input = __input.response;
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__params.EventType=""PRE_VALIDATION"";
__params.Reason=""Continue Pre-Validation Transaction"";
__next = '9';
}
else if (input == '2') {
IC.cnsCancelationProcess('05',__params.InitiatorIdentifier);
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
__next = 'error';
}
}
else {
 __next = '8b';
}","8b","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","32022","32010","Organization operator pay bill with pre-validation","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
B2B Pay Bill - ${__params.BillReferenceNumber} ${__params.InitiatorAccountNo} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","32024","32023","Add Organization Beneficiary","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier = msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__params.ActionType = 'AddOrgBeneficiary';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
shortCodeList= Util.queryShortCodeList('CPS.UMC.POPULAR.ORG');
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","32025","32023","Add Organization Beneficiary","var input = __input.response;
if(input == '0'){
 __next = '2';
}else if(input != '0')
{
var i = Util.toInt(input+'') - 1;
var length = 0;
if(shortCodeList!= null){
length  = shortCodeList.size();
}
 if (i >= 0 && i < length ){
  shortCode= shortCodeList.get(i);
  code = shortCode.Value;
  __params.BeneficiaryIdentifier = code;
  __next = '3';
  }
}else
{
  __next = '1';
}","1","Selete Short Code","<html>
<body>
Please Select Short Code:<br>
$$ var index = 1;
$$ for (shortCode : shortCodeList ){
 ${index} ${shortCode.Value} ${shortCode.DefaultName}<br> 
$$     index = index + 1;       
$$ }
       0 Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","32026","32023","Add Organization Beneficiary","var input = __input.response;
if(empty(input)){
__next = '2';
}else
{
__params.BeneficiaryIdentifier= __input.response;
__next = '3';
}","2","Input Short Code","<html>
<body>
Input Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","32027","32023","Add Organization Beneficiary","var input=__input.response;
if(empty(input))
{
  __next = '4';
}
else if(Validator.checkBenefiRefLength(input))
{
 __params.BeneficiaryReference = __input.response;
 __next = '4';
}
else
{
__next = '3';
}","3","Input Reference","<html>
<body>
Input Reference:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","32028","32023","Add Organization Beneficiary","var input=__input.response;
if(empty(input))
{
  __next = '5';
}
else if(!empty(input))
{
 __params.BillReference = __input.response;
 __next = '5';
}
else
{
__next = '4';
}","4","Input Bill Reference","<html>
<body>
Input Bill Reference:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","32029","32023","Add Organization Beneficiary","__params.@HEAD@PIN = __input.response;
__next = 'end';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","3203","1032","Super agent operator redeems a business deposit voucher","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","32030","31730","Customer Query 3rd Buy Goods and Payment","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","32032","32031","Group P2G Transfer2","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group Code */

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","32033","32031","Group P2G Transfer2","beneficiaries = IC.queryGroupListBeneficiary(msisdn);
var input = __input.response;
if (input == '1') {
	__next = '2a';
} else if (input == '2') {
	if (empty(beneficiaries) || size(beneficiaries) == 0) {
		__errormsg = 'Sorry, there is no beneficiary.';
		__next = 'error';
	} else {
		__next = '2b';
	}
} else {
	__next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","32035","32034","Send Token","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierValue = msisdn;
__params.InitiatorIdentifierType = '01';
__params.InitiatingDeviceType = '01';
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifier = msisdn;
__params.Currency = 'TZS';
__params.ReceiverPartyIdentifierType = '01';
__params.ReceiverIdentifierType = '01';
beneficiaries = IC.queryCustListBeneficiary(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","32036","32034","Send Token","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select option","<html>
<body>
Choose the receiver <br>
1 Enter Phone No<br>
2 Use Beneficiary<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","32037","32034","Send Token","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__params.ReceiverIdentifierValue= input;
__next = '2';","2a","Enter phone no","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","32038","32034","Send Token","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(beneficiaries)) {
   beneficiary= beneficiaries.get(i);
   beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn;
  __params.ReceiverIdentifierValue= beneficiaryMsisdn;
   __next = '2';
} else {
   __next = '2b';
}","2b","Select beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","32039","32034","Send Token","var input = __input.response;
if (Validator.isAmount(input,'.')) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","3204","1032","Super agent operator redeems a business deposit voucher","var input = __input.response;
__params.VoucherValidationValue = input;
__next = '4';","3","Enter Short Code","<html>
<body>
Enter Reference Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","32040","32034","Send Token","var input = __input.response;
__params.Remark = input;
__next = '4';","3","Reason of Transaction","<html>
<body>
Enter Reason:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","32041","32034","Send Token","var input = __input.response;
if (Validator.isMatchRegex(input, '[0-9a-zA-Z]{4}') ){
     __params.VoucherSecretCode= input;
     __next = '5';    
}else{
    __errormsg= 'Secret code is not matched with regex!';
    __next = 'error';
}","4","Input secret code","<html>
<body>
Please enter Secret Code.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","32042","32034","Send Token","var input = __input.response;
__params.PIN = input;
result = TC.calculateBudget(__params);
if(!result.fee) {
error=1;
fee = 0;
__errormsg = 'Sorry, The paramaters you input are wrong or your balance is not enough.';
__next = 'error';
}else {
fee = result.fee;
__next = '6';
}","5","Input pin","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","32043","32034","Send Token","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
$$chargeFee = TC.queryCustomerCharge(__params);
$$result = TC.calculateBudget(__params);
$$budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
$$var promptText = '';
$$feeList = budgetMap.fee;
$$if(!empty(feeList)){
$$	   i = 1;
$$	   sizeLen = size(feeList);
$$	  for(fee:feeList)
$$	  {
$$	   promptText = promptText+ 'The amount of charge is '+fee.amount;
$$	 
$$	   if(i < sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$		i = i+1 
$$	  }
$$}
$$   taxList = budgetMap.tax;
$$   if(!empty(taxList)){
$$	   i = 1;
$$	   sizeLen = size(taxList);
$$	  for(tax:taxList)
$$	  {
$$		 if(i ==1 &&  promptText != '')
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$
$$		promptText = promptText
$$	 + 'The amount of tax is '+tax.amount;
$$	   
$$	   if(i <sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   } 
$$	   i = i+1;
$$	  }
$$  }
 Send Tokento ${__params.ReceiverPartyIdentifier}  Tsh${__params.Amount} <br>
${promptText } <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","3205","1032","Super agent operator redeems a business deposit voucher","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","3206","1032","Super agent operator redeems a business deposit voucher","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","3207","1032","Super agent operator redeems a business deposit voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Redeem Business deposit Voucher - ${__params.ReceiverParty.Identifier}<br>
Amount : ${__params.Amount}<br>
ValidationValue :${__params.VoucherValidationValue}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","32102","32101","Approval Group Transaction2","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ApproveGroupTask';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","32103","32101","Approval Group Transaction2","var input = __input.response;
if (!empty(input)) {
  __params.OrderID= input;
  __next = '2';
} else {
  __next = '1';
}","1","Input ReminderID","<html>
<body>
Please enter the ReminderID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","32104","32101","Approval Group Transaction2","groups = IC.queryMyGroups(msisdn);
var input = __input.response;
if (input == '1') {
	__next = '3a';
} else if (input == '2') {
	if (empty(groups) || size(groups) == 0) {
		__errormsg = 'Sorry, there is no groups.';
		__next = 'error';
	} else {
		__next = '3b';
	}
} else {
	__next = '2';
}","2","Select Option","<html>
<body>
Please select option: <br>
1 Input GroupCode<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","32105","32101","Approval Group Transaction2","__params.ApproverMSISDN = __params.InitiatorIdentifier;
var input = __input.response;
queryapprovalinfo = IC.queryApprovalInfo(__params.InitiatorIdentifier,__params.OrderID,input);
var amout = queryapprovalinfo.amount;
if (!empty(input)) {
if (!empty(amout)) {
  __params.GroupCode = input;
  __next = '4a';
} else {
  __params.GroupCode = input;
  __next = '4b';
}
} else {
  __next = '3a';
}","3a","Input GroupCode","<html>
<body>
Please enter the GroupCode:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","32106","32101","Approval Group Transaction2","__params.ApproverMSISDN = __params.InitiatorIdentifier;
var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  queryapprovalinfo = IC.queryApprovalInfo(__params.InitiatorIdentifier,__params.OrderID,groupCode);
  var amout = queryapprovalinfo.amount;
  if (!empty(amout)) {
  __params.GroupCode = groupCode;
  __next = '4a';
} else {
  __params.GroupCode = groupCode;
  __next = '4b';
}
} 
else{
  __next = '3b';
}","3b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","32107","32101","Approval Group Transaction2","var input = __input.response;
if (empty(queryapprovalinfo.groupCode)) {
__next = '1';
} else {
if (input == '1') {
  __params.OperationType = input;
  __next = '5';
} else if( input == '0'){
__params.OperationType = input;
  __next = '5';
} else {
  __next = '4a';
}}","4a","Approve","<html>
<body>
$$if (empty(queryapprovalinfo.groupCode)) {
The value of GroupCode or ReminderID is incorrect.
$$}else{
Group Approval request for ${queryapprovalinfo.TaskName};<br>
Requested by ${queryapprovalinfo.OriginalInitiatorRole} ${queryapprovalinfo.OriginalInitiator.Identifier};<br>
For group name ${queryapprovalinfo.GroupName} and ID ${queryapprovalinfo.GroupCode}; <br>
The voucher type is ${queryapprovalinfo.voucherTypeName} , receiverParty value is ${queryapprovalinfo.ReceiverPartyIdentifier.identifier} , type is ${queryapprovalinfo.ReceiverPartyIdentifier.identifierType} ;<br>
Purpose:  ${queryapprovalinfo.Remark}; <br>
Amount: ${queryapprovalinfo.Amount}; <br>
1 Approve<br>
0 Reject<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
$$}
</body>
</html>",""<endrec>
"CUSTOMER","","7","32108","32101","Approval Group Transaction2","var input = __input.response;
if (empty(queryapprovalinfo.groupCode)) {
__next = '1';
} else {
if (input == '1') {
  __params.OperationType = input;
  __next = '5';
} else if( input == '0'){
__params.OperationType = input;
  __next = '5';
} else {
  __next = '4b';
}}","4b","Approves","<html>
<body>
$$if (empty(queryapprovalinfo.groupCode)) {
The value of GroupCode or ReminderID is incorrect.
$$}else{
Group Approval request for ${queryapprovalinfo.TaskName};<br>
Requested by ${queryapprovalinfo.OriginalInitiatorRole} ${queryapprovalinfo.OriginalInitiator.Identifier};<br>
For group name ${queryapprovalinfo.GroupName} and ID ${queryapprovalinfo.GroupCode}; <br>
The operation Msidsn is ${queryapprovalinfo.operationMsisdn} and operation role is ${queryapprovalinfo.operationRole}, changed role is ${queryapprovalinfo.changedOperationRole}.<br>
Purpose:  ${queryapprovalinfo.Remark}; <br>
1 Approve<br>
0 Reject<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
$$}
</body>
</html>",""<endrec>
"CUSTOMER","","8","32109","32101","Approval Group Transaction2","var input = __input.response;
if (!empty(input)) {
  __params.@HEAD@PIN = input;
  __next = '6';
} else {
  __next = '5';
}","5","Input PIN","<html>
<body>
Please enter the PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","32110","32101","Approval Group Transaction2","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
__next = 'cancel';
} else {
  __next = '6';
}","6","Complete","<html>
<body>
You have completed the approval please press 1 End<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","32201","2225","Customer Query 3rd Bill","var input = __input.response;
if(empty(input)){
     __next = '2a';
}else{
    kycinfo=kycinfo.concat(input);
   
    __next = '2b';
}","2a","Input Last Name","<html>
<body>
Input You Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","32202","2225","Customer Query 3rd Bill","var input = __input.response;
if(empty(input)){
     __next = '2b';
}else{
__params.put('TransOutgoingRequest@LIST@Param.KYCField',kycinfo.concat(input));
    __next = '3';
}","2b","Input DOB","<html>
<body>
Input You DOB<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","32308","32307","Activate Group Account Language Test","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'ActiveGroupFSIProducts';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
__params.OrgShortCode = '262626';
groups = IC.queryMyGroups(msisdn);
  __next = '0';","begin","set parammeters","",""<endrec>
"CUSTOMER","","10","32309","32307","Activate Group Account Language Test","var input = __input.response;
if (input == '1') {
  __next = '0E';
} else if (input == '2') {
  __next = '0S';
} else {
   __next = '0';
}","0","Choose the language","<html>
<body>
Please select Language(XXXXXXXXX transfer to Swahili): <br>
1 English<br>
2 Swahili<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","32310","32307","Activate Group Account Language Test","var input = __input.response;
if (input == '1') {
  __next = '1aE';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'errorE';
    } else {
       __next = '1bE';
    }
} else {
   __next = '0E';
}","0E","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","32311","32307","Activate Group Account Language Test","var input = __input.response;
if (input == '1') {
  __next = '1aS';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'XXXXXXXX(Sorry, there is no groups.)';
      __next = 'errorS';
    } else {
       __next = '1bS';
    }
} else {
   __next = '0S';
}","0S","XXXXXXXXX(Select Option)","<html>
<body>
Please select option: <br>
1 XXXXXX(Enter Group Code)<br>
2 XXXXXX(Select From My Groups)
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","32312","32307","Activate Group Account Language Test","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '2E';
}else {
   __errormsg = 'no current group member role.';
   __next = 'errorE';
}
 }else {
      __next = '1aE';
   }","1aE","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","32313","32307","Activate Group Account Language Test","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '2S';
}else {
   __errormsg = 'XXXXXX(no current group member role.)';
   __next = 'errorS';
}
 }else {
      __next = '1aS';
   }","1aS","XXXXXXX(Enter Group Code)","<html>
<body>
XXXXXX(Enter Group Code:)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","32314","32307","Activate Group Account Language Test","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  
  roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1bE","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","32315","32307","Activate Group Account Language Test","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  
  roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '2S';
}else {
   __errormsg = 'XXXXXX(no current group member role.)';
   __next = 'errorS';
}
} 
else{
  __next = '1bS';
}","1bS","XXXXXX(Select From My Groups)","<html>
<body>
XXXXXX(Select Group:)<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","32316","32307","Activate Group Account Language Test","var input = __input.response;
__params.@HEAD@PIN = input;
__next = 'end';","2E","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","32317","32307","Activate Group Account Language Test","var input = __input.response;
__params.@HEAD@PIN = input;
__next = 'end';","2S","XXXXXX(Enter PIN)","<html>
<body>
XXXXXX(Enter PIN)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","32320","32319","Redeem Token","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierValue = msisdn;
__params.InitiatorIdentifierType = '01';
__params.InitiatingDeviceType = '01';
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifier = msisdn;
__params.Currency = 'TZS';
__params.ReceiverPartyIdentifierType = '03';
__params.ReceiverIdentifierType = '01';
__params.RequesterIdentifierType = '01';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","32321","32319","Redeem Token","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';","1","Input Cash Token Number","<html>
<body>
Please input the  Token Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","32322","32319","Redeem Token","var input = __input.response;
if (Validator.isMatchRegex(input, '[0-9]{1,20}') ){
     __params.VoucherSecretCode= input;
     __next = '5';    
}else{
    __errormsg= 'Secret code is not matched with regex!';
    __next = 'error';
}","2","Input Secret Code","<html>
<body>
Please input the Secret Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","32323","32319","Redeem Token","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","32324","32319","Redeem Token","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>Confirm to Reedem the Token<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","32325","32319","Redeem Token","var input = __input.response;
__params.RequesterIdentifier = input;
__next = '3';","5","Requester","<html>
<body>
Input Requester:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","32402","32401","Request Withdraw Voucher2","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.VoucherTypeCode = 'Request Withdrawl Voucher For Customer';  
__secure = true;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","32403","32401","Request Withdraw Voucher2","var input = __input.response;
__params.PIN = input;
__next = '2';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","32404","32401","Request Withdraw Voucher2","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '2') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Confirm to Request Withdrawal Voucher?<br>
1 OK<br>
2 Quit<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","32502","32501","Create Loyalty Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */

__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","32503","32501","Create Loyalty Account","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{0,128})$')){
    __params.AccountName = input;
    __next = '2'; 
} 
else{
    __next = '1';
}","1","Enter account name","<html>
<body>
Enter account name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","32504","32501","Create Loyalty Account","var input = __input.response;
	__params.InitiatorIdentifier = input;
	__secure = true;
	__next = '3';","2","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","32505","32501","Create Loyalty Account","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","32506","32501","Create Loyalty Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","4","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","32509","32508","Create Loyalty Consumer Account2","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"TILL","","1","32511","32510","Operator Create Consumer Loyalty Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","32512","32510","Operator Create Consumer Loyalty Account","var input = __input.response;
if (input == '1') 
{
  __params.ReceiverPartyIdentifierType = '01';
  __next = '2a';
} 
else if (input == '100') 
{
  __params.ReceiverPartyIdentifierType = '15';
  __next = '2b';
}
else if (input == '200') 
{
  __params.ReceiverPartyIdentifierType = '04';
  __next = '2c';
}
else 
{
   __next = '1';
}","1","Select Identity Type","<html>
<body>
Please select option: <br>
1 Customer<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","32513","32510","Operator Create Consumer Loyalty Account","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier= input;
  __next = '3';
} else {
  __next = '2a';
}","2a","Enter MSISDN","<html>
<body>
Enter MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","32514","32510","Operator Create Consumer Loyalty Account","__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
      __next = '3';
   } 
 else 
   {
      __next = '2c';
   }","2c","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","32515","32510","Operator Create Consumer Loyalty Account","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{0,128})$')){
    __params.AccountName = input;
    __next = '4'; 
} 
else{
    __next = '3a';
}","3a","Enter account name","<html>
<body>
Enter account name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","32516","32510","Operator Create Consumer Loyalty Account","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","32517","32510","Operator Create Consumer Loyalty Account","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","32518","32510","Operator Create Consumer Loyalty Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to create?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","32519","32510","Operator Create Consumer Loyalty Account","if (empty(accountTypes)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(accountTypes)) {
                __params.AccountTypeCode =  accountTypes.get(tmp);
                __secure = true;
                __next = '3a';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Account Type","<html>
<body>
Please select account:<br>
$$accountTypes = IC.queryAllPointAccounts(identity.identityType, identity.identityId);
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","32521","32520","take 2","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"CUSTOMER","","1","32524","32523","Send Money 2 factor DOB 01","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"CUSTOMER","","8","32525","32523","Send Money 2 factor DOB 01","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","32526","32523","Send Money 2 factor DOB 01","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2a","Input Phone","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","32527","32523","Send Money 2 factor DOB 01","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3';
} 
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","32528","32523","Send Money 2 factor DOB 01","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Amount","<html>
<body>
Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","32529","32523","Send Money 2 factor DOB 01","var input = __input.response;
__params.SimpleKYCMap = IC.buildSimpleKYCMap('Date Of Birth',input,__params.SimpleKYCMap);
__secure = true;
__next = '5';","4","Enter DOB","<html>
<body>
Enter Sender Date Of Birth<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","32530","32523","Send Money 2 factor DOB 01","var input = __input.response;
__params.PIN = input;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
__next = '6';","5","Input Pin","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","32531","32523","Send Money 2 factor DOB 01","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>Send Money to ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","32602","32601","Organization operator pay bill with pre-validation English","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"TILL","","13","32603","32010","Organization operator pay bill with pre-validation","var input = __input.response;
if (input == '1') {
  __next = '0E';
} else if (input == '2') {
  __next = '0S';
} else {
   __next = '0';
}","0","Choose the Language","<html>
<body>
Please select Language(XXXXXXXXX transfer to Swahili): <br>
1 English<br>
2 Swahili<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","32702","32701","Redeem Issued Voucher2","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","32703","32701","Redeem Issued Voucher2","var input = __input.response;
if(!empty(input)){
__params.ReceiverPartyIdentifier = input;
__next = '2';
}else{
    __next ='1';
}","1","Input Voucher Code","<html>
<body>
Please input the voucher code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","32704","32701","Redeem Issued Voucher2","var input = __input.response;
 __params.VoucherValidationValue = input;
 __next = '3';","2","Input Msisdn","<html>
<body>
Input Additional validation information:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","32705","32701","Redeem Issued Voucher2","var input = __input.response;
__params.Amount = input;
__next = '5';","3","Input Amount","<html>
<body>
Please input the redeeming amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","32706","32701","Redeem Issued Voucher2","var input = __input.response;
if(!empty(input)){
__params.InitiatorIdentifier = input;
__secure = true;
__next = '6';
}else{
    __next ='5';
}","5","Input Operator ID","<html>
<body>
Please input the operator id:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","32707","32701","Redeem Issued Voucher2","var input = __input.response;
__params.PIN = input;
__next = '7';","6","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","32708","32701","Redeem Issued Voucher2","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>You will redeem a voucher,the amount is ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","32709","32701","Redeem Issued Voucher2","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '4';
         } else {
                __next = '4';
         }
    } else {
        __next = '3';
    }
}","4","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","32711","32710","Send Money Off-Net","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","32712","32710","Send Money Off-Net","","error","information","",""<endrec>
"Pre-Validation","","1","32714","32713","Send Money Off-Net-1","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","32715","32713","Send Money Off-Net-1","","error","information","",""<endrec>
"CUSTOMER","","1","32802","32801","Query My Own bundle List","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'QueryCustomerIdentityBundleList';
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType= '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier= msisdn;
/*__params.PrimaryIdentifierType= '04';*/ /* SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","32803","32801","Query My Own bundle List","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-3])$'))
{
__params.BundleType= input ;
__secure = true;
 __next = '2';
}
else {
 __next = '1';
}","1","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","32804","32801","Query My Own bundle List","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '3';
} else {
    __secure = true;
    __next = '2';
}","2","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","32805","32801","Query My Own bundle List","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","32904","32903","Two factor org Contact Phone number","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';

","begin","set parammeters","",""<endrec>
"TILL","","1","32915","32914","Deposit Money 2 facor second name","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","7","32916","32914","Deposit Money 2 facor second name","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';","1","Enter Phone Number","<html>
<body>
Enter phone no<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","32917","32914","Deposit Money 2 facor second name","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","32918","32914","Deposit Money 2 facor second name","var input = __input.response;
__params.SimpleKYCMap = IC.buildSimpleKYCMap('Contact Second Name',input,__params.SimpleKYCMap);
__secure = true;
__next = '4';","3","Enter Second Name","<html>
<body>
Enter Contact Second Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","32919","32914","Deposit Money 2 facor second name","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","32920","32914","Deposit Money 2 facor second name","var input = __input.response;
__params.PIN = input;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
__next = '6'","5","Enter Pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","32921","32914","Deposit Money 2 facor second name","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Deposit Cash ${__params.ReceiverParty.Identifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","32924","32923","Redeem withdraw voucher01","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","32925","32923","Redeem withdraw voucher01","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';","1","Enter Voucher Code","<html>
<body>
Enter Voucher Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","32927","32923","Redeem withdraw voucher01","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","32928","32923","Redeem withdraw voucher01","var input = __input.response;
  __params.VoucherValidationValue = input;
  __next = '4';","3","Enter Additional validation information","<html>
<body>
Enter Additional validation information<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","32929","32923","Redeem withdraw voucher01","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","32930","32923","Redeem withdraw voucher01","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","32931","32923","Redeem withdraw voucher01","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","32932","32923","Redeem withdraw voucher01","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html><body>Give Cash ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","32934","32933","Customer Self Update KYC01","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'ChangeCustKYC';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","32935","32933","Customer Self Update KYC01","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input == '2') {
  __next = '3';
}else if (input == '3') {
  __next = '4';
}else {
  __next = '1';
}","1","Select Update KYC","<html>
<body>
Select Receiver Type:<br>
1 LastName <br>
2 DOB <br>
3 ID Details <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","32936","32933","Customer Self Update KYC01","var input = __input.response;
__params.LastName = input;
__next = '6';","2","Enter Last Name","<html>
<body>
Enter Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","32937","32933","Customer Self Update KYC01","var input = __input.response;
if (Validator.isDate(input, 'yyyyMMdd')) {
  __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
  __next = '6';
} else {
  __next = '3';
}","3","Enter Date of Birth","<html>
<body>
Enter Date of Birth(yyyyMMdd)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","32938","32933","Customer Self Update KYC01","var input = __input.response;
if (input == '1') {
  __params.CertificateType = '01'; /* National ID */
  __next = '5';
} else if (input == '2') {
  __params.CertificateType = '05'; /* Passport */
  __next = '5';
} else {
  __next = '4';
}","4","Identification Type","<html>
<body>
Identification Type<br>
1  National ID<br>
2  Passport<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","32939","32933","Customer Self Update KYC01","var input = __input.response;
__params.CertificateNumber = input;
__params.isCondition = 'true';
__next = '6';","5","Enter ID Number","<html>
<body>
Enter ID Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","32940","32933","Customer Self Update KYC01","var input = __input.response;
if (input == '1') {
  __next = '1';
} else if (input == '0') {
  __next = '7';
} else {
  __next = '6';
}","6","Continue Update Other KYC","<html><body>Continue Update Other KYC:<br>
1 YES<br>
0 NO<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","32941","32933","Customer Self Update KYC01","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo = IC.buildCustomerInfo(__params);
__next = '8';","7","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","32942","32933","Customer Self Update KYC01","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html><body>Customer ${__params.LastName}, ${__params.CertificateNumber}, ${__params.RequesterIdentifier}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","33002","33001","SZ_Group Approval test","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ApproveGroupTask';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","33003","33001","SZ_Group Approval test","var input = __input.response;
if (!empty(input)) {
  __params.OrderID= input;
  __next = '2';
} else {
  __next = '1';
}","1","Input ReminderID","<html>
<body>
Please enter the ReminderID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","33004","33001","SZ_Group Approval test","groups = IC.queryMyGroups(msisdn);
var input = __input.response;
if (input == '1') {
	__next = '3a';
} else if (input == '2') {
	if (empty(groups) || size(groups) == 0) {
		__errormsg = 'Sorry, there is no groups.';
		__next = 'error';
	} else {
		__next = '3b';
	}
} else {
	__next = '2';
}","2","Select Option","<html>
<body>
Please select option: <br>
1 Input GroupCode<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","33005","33001","SZ_Group Approval test","__params.ApproverMSISDN = __params.InitiatorIdentifier;
var input = __input.response;
queryapprovalinfo = IC.queryApprovalInfo(__params.InitiatorIdentifier,__params.OrderID,input);
var amout = queryapprovalinfo.amount;
if (!empty(input)) {
if (!empty(amout)) {
  __params.GroupCode = input;
  __next = '4a';
} else {
  __params.GroupCode = input;
  __next = '4b';
}
} else {
  __next = '3a';
}","3a","Input GroupCode","<html>
<body>
Please enter the GroupCode:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","33006","33001","SZ_Group Approval test","__params.ApproverMSISDN = __params.InitiatorIdentifier;
var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  queryapprovalinfo = IC.queryApprovalInfo(__params.InitiatorIdentifier,__params.OrderID,groupCode);
  var amout = queryapprovalinfo.amount;
  if (!empty(amout)) {
  __params.GroupCode = groupCode;
  __next = '4a';
} else {
  __params.GroupCode = groupCode;
  __next = '4b';
}
} 
else{
  __next = '3b';
}","3b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","33007","33001","SZ_Group Approval test","var input = __input.response;
if (empty(queryapprovalinfo.groupCode)) {
__next = '1';
} else {
if (input == '1') {
  __params.OperationType = input;
  __next = '5';
} else if( input == '0'){
__params.OperationType = input;
  __next = '5';
} else {
  __next = '4a';
}}","4a","Approve","<html>
<body>
$$if (empty(queryapprovalinfo.groupCode)) {
The value of GroupCode or ReminderID is incorrect.
$$}else{
Reply with<br>
1 Approve<br>
0 Reject<br>
$$if (!empty(queryapprovalinfo.VoucherTypeName)) {
$$if ((queryapprovalinfo.VoucherTypeName)=='Group Buy Goods Voucher') {
Generate Voucher for Buy Goods of ${queryapprovalinfo.Amount}<br>
$$} else {
Generate ${queryapprovalinfo.voucherTypeName} of ${queryapprovalinfo.Amount}<br>
$$}
$$}else{
Transfer ${queryapprovalinfo.Amount} funds to ${queryapprovalinfo.ReceiverPartyIdentifier.identityType}- ${queryapprovalinfo.ReceiverPartyIdentifier.identifier};<br>
$$}
Requested by ${queryapprovalinfo.OriginalInitiatorRole} ${queryapprovalinfo.OriginalInitiator.Identifier};<br>
For group name is ${queryapprovalinfo.GroupName} and group Code is ${queryapprovalinfo.GroupCode}; <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
$$}
</body>
</html>",""<endrec>
"CUSTOMER","","7","33008","33001","SZ_Group Approval test","var input = __input.response;
if (empty(queryapprovalinfo.groupCode)) {
__next = '1';
} else {
if (input == '1') {
  __params.OperationType = input;
  __next = '5';
} else if( input == '0'){
__params.OperationType = input;
  __next = '5';
} else {
  __next = '4b';
}}","4b","Approves BO","<html>
<body>
$$if (empty(queryapprovalinfo.groupCode)) {
The value of GroupCode or ReminderID is incorrect.
$$}else{
Reply:<br>
1 Approve<br>
0 Reject<br>
request to 
$$if ((queryapprovalinfo.TaskName)=='Add Group Member') {
Add New Member ${queryapprovalinfo.operationMsisdn} with role ${queryapprovalinfo.operationRole}.<br>
$$} else if((queryapprovalinfo.TaskName)=='Change Group Member Role') {
Change Role of Member ${queryapprovalinfo.operationMsisdn} from ${queryapprovalinfo.operationRole} to ${queryapprovalinfo.changedOperationRole}.<br>
$$}else {
${queryapprovalinfo.TaskName} - Msidsn ${queryapprovalinfo.operationMsisdn} and role ${queryapprovalinfo.operationRole}.<br>
$$}
For Group ${queryapprovalinfo.GroupCode}-${queryapprovalinfo.GroupName}; <br>
Requested by ${queryapprovalinfo.OriginalInitiatorRole} ${queryapprovalinfo.OriginalInitiator.Identifier};<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
$$}
</body>
</html>",""<endrec>
"CUSTOMER","","8","33009","33001","SZ_Group Approval test","var input = __input.response;
if (!empty(input)) {
  __params.@HEAD@PIN = input;
  __next = '6';
} else {
  __next = '5';
}","5","Input PIN","<html>
<body>
Please enter the PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","3301","1033","Organization operator initiates business withdraw","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","9","33010","33001","SZ_Group Approval test","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
__next = 'cancel';
} else {
  __next = '6';
}","6","Complete","<html>
<body>
You have completed the approval please press 1 End<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","3302","1033","Organization operator initiates business withdraw","var input = __input.response;
if (empty(input)) {
    __next = '1';
} else if (input == '1') {
    __params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
    __tips = 'Till no';
    __next = '2';
} else if (input == '2') {
    __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
    __tips = 'Short code';
    __next = '2';
} else {
    __next = '1';
}","1","Select Till no or Short code","<html>
<body>
Select Till no or Short code<br>
1 Till no<br>
2 Short code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","3303","1033","Organization operator initiates business withdraw","var input = __input.response;
if (empty(input)) {
    __next = '2';
} else {
    __params.ReceiverPartyIdentifier = input;
    __next = '3';
}","2","Enter Till no or Short code","<html>
<body>
Enter ${__tips}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","3304","1033","Organization operator initiates business withdraw","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '4';
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","3305","1033","Organization operator initiates business withdraw","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","3306","1033","Organization operator initiates business withdraw","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","3307","1033","Organization operator initiates business withdraw","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Business Withdraw - ${__params.ReceiverParty.Identifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","33102","33101","Customer Deposit Money With Prevalidation for web","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","33104","33101","Customer Deposit Money With Prevalidation for web","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{

CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);

var tips = '';

var cust = IC.queryIdentityName(CurReq.getIdentifierDef('ReceiverParty'));
tips = tips + 'Customer ' + (empty(cust.firstName)?'[]':cust.firstName) + ' ' + (empty(cust.middleName)?'[]':cust.middleName) + ' ' + (empty(cust.lastName)?'[]':cust.lastName);
tips = tips + ', Phone number ';
tips = tips + cust.basicIdentifier;
tips = tips + ' will deposit ';

var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
tips = tips + IC.formatAmount(currency, amount);

tips = tips + '. Respond with';

CurResp.putToBody('CalculateFeeResponse.tips', tips);

__next = '2';
}
else
{
CurResp = TargetService.invokeForScript(); 
__next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","3","33105","33101","Customer Deposit Money With Prevalidation for web","CurResp = TargetService.invokeForScript(); 
__next='end';","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","2","33106","33101","Customer Deposit Money With Prevalidation for web","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"TILL","","1","33202","33201","Redeem Issued Voucher3","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","33203","33201","Redeem Issued Voucher3","var input = __input.response;
if(!empty(input)){
__params.ReceiverPartyIdentifier = input;
__next = '2';
}else{
    __next ='1';
}","1","Input Voucher Code","<html>
<body>
Please input the voucher code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","33204","33201","Redeem Issued Voucher3","var input = __input.response;
 __params.VoucherValidationValue = input;
 __next = '3';","2","Input Msisdn","<html>
<body>
Input Additional validation information:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","33205","33201","Redeem Issued Voucher3","var input = __input.response;
__params.Amount = input;
__next = '4';","3","Input Amount","<html>
<body>
Please input the redeeming amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","33206","33201","Redeem Issued Voucher3","var input = __input.response;
if(!empty(input)){
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';
}else{
    __next ='4';
}","4","Input Operator ID","<html>
<body>
Please input the operator id:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","33207","33201","Redeem Issued Voucher3","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","33208","33201","Redeem Issued Voucher3","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>You will redeem a voucher,the amount is ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","33302","33301","Send Money 2 factor DOB","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
beneficiaries = IC.queryCustListBeneficiary(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","33303","33301","Send Money 2 factor DOB","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","33304","33301","Send Money 2 factor DOB","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2a","Input Phone","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","33305","33301","Send Money 2 factor DOB","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3';
} 
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","33306","33301","Send Money 2 factor DOB","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Amount","<html>
<body>
Input Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","33307","33301","Send Money 2 factor DOB","var input = __input.response;
__params.SimpleKYCMap = IC.buildSimpleKYCMap('Date of Birth',input,__params.SimpleKYCMap);
__secure = true;
__next = '5';","4","Enter DOB","<html>
<body>
Enter Sender Date Of Birth<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","33308","33301","Send Money 2 factor DOB","var input = __input.response;
__params.PIN = input;
__params.initiatorKYC = IC.buildInitiatorKYCInfo(__params);
__next = '6';","5","Input Pin","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","33309","33301","Send Money 2 factor DOB","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>Send Money to ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","33313","33312","Customer request Buy Goods Voucher 03","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReasonTypeCode = 'CustomerApplyBuyGoodsVoucher'; 
__secure = true;
if(TC.isSupportSecretCode(__params.ReasonTypeCode))
{
var secretCodeRule = TC.getSecretCodeRule();
__params.minLength = secretCodeRule.getMinLength();
__params.maxLength = secretCodeRule.getMaxLength();
__params.rule = secretCodeRule.getRule();
__params.info = 'Enter a secret code:';
__next = '1';
}
else
{
__next = '2';
}","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","33314","33312","Customer request Buy Goods Voucher 03","var input = __input.response;
var length = size(input);
if(length < __params.minLength  || length > __params.maxLength )
{
__params.info = 'The length of a secret code must be in the range of [' + __params.minLength + ',' + __params.maxLength + '], please enter secret code again!';
__next = '1';
}
else if(!empty(__params.rule) && input !~ __params.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __params.rule + ', please enter secret code again!';
__next = '1';
}
else
{
__params.VoucherSecretCode = input;
__next = '2';
}","1","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","33315","33312","Customer request Buy Goods Voucher 03","if (empty(multiAccount)) {
 __next = '3';
  __params.ReceiverAccountNo= ''; 
} else {
    var input = __input.response;
    if (!empty(input)) {
 var tmp = Util.toInt(input) - 2;
 if(tmp >=0 && tmp < size(multiAccount)) {
 type = multiAccount.get(tmp);
 __params.ReceiverAccountNo= type.AccountNo;
  __secure = true;
  __next = '3';
} else if(tmp == -1) {
 __next = '3';
  __params.ReceiverAccountNo= '';
 } else {
  __next = '2';
  }
 } else {
  __next = '2';
  }
}","2","Select Account","<html>
<body>
Please select account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'','');
  $$var i = 1;
 ${i} select no account<br>
 $$for(type: multiAccount ) {
 ${i+1} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","33316","33312","Customer request Buy Goods Voucher 03","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","33317","33312","Customer request Buy Goods Voucher 03","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","4","Confirm","<html>
<body>
Confirm to requests buy goods voucher?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","33402","33401","Merchant POS Payment with USSD Push","__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;
__params.put('TransOutgoingRequest@LIST@Param.sessionid',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','111111');
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */

__params.count = '3'; /* Error retries */

__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","33403","33401","Merchant POS Payment with USSD Push","TC.buildPreValidationParams4CalculateFee(OriginalReq,__params,__params.__sessionId);
__params.EventType='PRE_VALIDATION';

TC.savingPreValidationEventLog(__params);","error","information","error",""<endrec>
"Pre-Validation","","3","33404","33401","Merchant POS Payment with USSD Push","var receiver=CurReq.getIdentifierDef('ReceiverParty').Identifier;
var shortCode = CurReq.getIdentifierDef('Initiator').ShortCode;
var orgName = IC.queryOrgName(shortCode);

var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
var ussdContent = receiver+ ', please confirm payment of ' + IC.formatAmount(currency, amount) + ' to ' +  shortCode + '-' + orgName + ', by entering your M-PESA PIN' ;

__params.put('TransOutgoingRequest@LIST@Param.msisdn',receiver);
__params.put('TransOutgoingRequest@LIST@Param.message',ussdContent);

__params.put('step2CurReq',CurReq);
__params.put('step2params',__params);
__params.put('step2receiver',receiver);


AG.sendTransOutgoing(CurReq,__params,'140');
__next = '2';","1","Push PIN","Push PIN",""<endrec>
"Pre-Validation","","2","33405","33401","Merchant POS Payment with USSD Push","pin = CurReq.getValueFromBody('TransactionEventRequest.pin');
responseCode=CurReq.getValueFromBody('TransactionEventRequest.responseCode');


newPin = Util.convertMessageToObject(pin);

var isRight = IC.verifyIdentityPIN(__params.ReceiverPartyIdentifierType,__params.step2receiver,newPin);
var resultPinStatus = IC.queryPinStatusByIdentifier(__params.step2receiver, '01');

if (empty(newPin) || !isRight || '1' != responseCode||resultPinStatus != '1') 
{
__secure = true;
__params.count = __params.count - 1;
if(__params.count < 0){
	__params.put('Common.Result.ErrorCode',responseCode);
    __params.errDesc=__params.step2receiver + ' input wrong pin.External errorCode is ' +responseCode;
	__params.Reason=pin;
	__next = 'error';
}

else 
{
step2CurReq=__params.step2CurReq;
step2params=__params.step2params;

AG.sendTransOutgoing(step2CurReq,step2params,'140');
__next = '2';
}
}
else 
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPin',newPin);
	OriginalReq.putValue4ReferenceData('Channel',__accessChannel);
	CurResp = TargetService.invokeForScript();
	__next = 'end';
}","2","Get PIN","Get PIN",""<endrec>
"CUSTOMER","","1","33407","33406","Customer Query Loyalty Account 02","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","33408","33406","Customer Query Loyalty Account 02","if (empty(accountTypes)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(accountTypes)) {
                __params.AccountTypeCode =  accountTypes.get(tmp);
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Choose Account Type","<html>
<body>
Please select account:<br>
$$accountTypes = IC.queryAllPointAccounts(identity.identityType, identity.identityId);
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","33409","33406","Customer Query Loyalty Account 02","if (empty(accountNames)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(accountNames)) {
                __params.AccountNameCode =  accountNames.get(tmp);
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Choose Account Name","<html>
<body>
Please select account:<br>
$$accountNames = IC.queryAllPointAccounts(identity.identityType, identity.identityId);
$$if (empty(accountNames)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(name: accountNames) {
  ${i} ${name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","33410","33406","Customer Query Loyalty Account 02","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
    __params.PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","33411","33406","Customer Query Loyalty Account 02","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","33502","33501","PayBill With Prevalidation","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
 __params.AccessDeviceIdentifierType = '01';   /* MSISDN */ 
 __params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
 __params.RequesterIdentifierType = '01';
__next = '1'","begin","set parammeters","",""<endrec>
"TILL","","14","33503","33501","PayBill With Prevalidation","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter customer phone no","<html>
<body>
Enter customer phone no <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","33504","33501","PayBill With Prevalidation","var input = __input.response;
__params.FirstName= input;
__next = '3';","2","Enter First Name","<html>
<body>
Enter First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","33505","33501","PayBill With Prevalidation","var input = __input.response;
if (input == null || empty(input)) {
    __next = '2a';
} else {
    __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '3';
}","2a","enter customer date of birth","<html>
<body>
Enter Date Of Birth ddMMyy<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","33506","33501","PayBill With Prevalidation","__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
      __next = '4';
   } 
 else 
   {
      __next = '3';
   }","3","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","33507","33501","PayBill With Prevalidation","var input = __input.response;
__params.BillReferenceNumber = input;
__next = '5';","4","Enter Business No","<html>
<body>
Enter Business No.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","33508","33501","PayBill With Prevalidation","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","33509","33501","PayBill With Prevalidation","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;

  recipientList= IC.queryPreValidationNotificationByOrg(__params.InitiatorIdentifier,'05',0,__params.AccessDeviceIdentifier,'01');

  __next = '7';
} else {
  __next = '6';
}","6","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","33510","33501","PayBill With Prevalidation","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","33511","33501","PayBill With Prevalidation","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","33512","33501","PayBill With Prevalidation","var input = __input.response;
org=IC.queryIdentityName('05',__params.InitiatorIdentifier,'04',__params.ReceiverPartyIdentifier,'01',__params.AccessDeviceIdentifier);
shortCode = IC.queryShortCodeByOperatorCode(__params.InitiatorIdentifier);
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
if(!IC.isSupportCustomerNameSearch() || org.initiatorCNSStatus.suspensionFlag.fieldValue == '01'){
__next = '11';
}
else
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '1')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {
	   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
	 
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';

	   }
		i = i+1;
	  }
  }
   taxList = budgetMap.tax;
   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
	   if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }

		promptText = promptText + tax.publicName + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
  {
    promptText =' No charge.';
  } 
  else
  {
    promptText =promptText +'.';
  }

var tips = 'You will Pay Bill of '+IC.formatAmount('',__params.Amount)+' to Organization '+org.firstName+' with '+__params.BillReferenceNumber+' on behalf of '; 
cust=IC.queryIdentityName('05',__params.InitiatorIdentifier,'01',__params.RequesterIdentifier,'01',__params.AccessDeviceIdentifier);
__params.put('InitiatorCNSStatus',org.initiatorCNSStatus);
__params.put('ReceiverCNSStatus',org.receiverCNSStatus);
__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);

if(cust.subType  == '1000')
       {
	 tips = tips  + 'the unregistered Customer';
       }

       else if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
       {		   
           var nameStr= (empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName);
           tips = tips + 'Customer ' + IC.maskIdentityName(nameStr);
           if(nameStr != ''){
           __params.IsCNSDataDisplayed = 'Yes';
           }
       }
       else
       {
           tips = tips + 'Customer';
       }

tips = tips + ',Phone number ' + cust.basicIdentifier + '.';
promptText = promptText + '<br>' + tips;

__params.preValidationResult = promptText;
__next = '10';
}
}
}
else if (input == '2') {
  __next = '11';
  }
else {
 __next = '9';
}
}","9","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","33513","33501","PayBill With Prevalidation","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__next = '11';
}
else if (input == '2') {

if(__params.IsCNSDataDisplayed == 'Yes')
{
   IC.cnsCancelationProcess(__params.InitiatorIdentifier,shortCode,'05');
}
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
}
__next = 'error';
}
}
else {
 __next = '10';
}","10","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","33514","33501","PayBill With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","11","Confirm","<html>
<body>
Pay Bill - ${__params.BillReferenceNumber} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","33515","33501","PayBill With Prevalidation","if(__errorCode == 'UMC64000')
{
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation confirmation is Timeout.';
__params.Reason=""Timeout"";
TC.savingPreValidationEventLog(__params);
__params.TransactionPreValidationEvent='Timeout';
__params.TransactionPreValidationError='Time out';
__params.put('Common.Result.ErrorCode','UMC64000');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
}","error","Execute while errors occur copy","error occurs.",""<endrec>
"Pre-Validation","","1","33517","33516","SalaryPaymentGetCharges","__params.ServiceCode = __service.serviceCode;
__params.Channel = __accessChannel;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__params.TransactionUMCPreValidationEvent = 'Pre-Validation';
__params.EventType = 'PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","33518","33516","SalaryPaymentGetCharges","","error","information","",""<endrec>
"Pre-Validation","","2","33520","33516","SalaryPaymentGetCharges","var isPreValidation = CurReq.hasValueInBody('TransactionRequest.IsPreValidation','true');

if (isPreValidation)
{
      budgetMap = TC.calculatePreValidationFee(CurReq,__params,__sessionId);
      __params.FeeInfo = budgetMap.FeeInfo;
      __params.ResutCode = '0';
      __params.ResultMsg = budgetMap.ResultMessage;
      __params.UMC_SessionID = __sessionId;

      feeList = budgetMap.fee;
      var i = 1;
      sizeLen = size(feeList);
      for (fee:feeList)
      {
           __params.ResultMsg = __params.ResultMsg +':The amount of the charge is ' + fee.amount;
           if (i < sizeLen)
           {
                __params.ResultMsg = __params.ResultMsg + ',';
           }
           i = i + 1;
      }  

      AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);
}
else 
{
      CurResp = TargetService.invokeForScript();
      __next = 'end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"CUSTOMER","","2","33601","20335","IMT Transfer Abroad","var input = __input.response;
if (empty(input)) { 
__next = '6';
} else {
__params.ReferenceData.RecipientDateofBirth= input;
__next = '6';
}","5","Enter Recipient Date of Birth","<html>
<body>
Enter Recipient Date of Birth<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","33602","20335","IMT Transfer Abroad","var input = __input.response;
if (empty(input)) { 
__next = '7';
} else {
__params.ReferenceData.ReceiverPlaceOfBirth = input;
__next = '7';
}","6","Enter Recipient Place of Birth","<html>
<body>
Enter Recipient Place of Birth<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","33603","20335","IMT Transfer Abroad","var input = __input.response;
if (empty(input)) { 
__next = '8';
} else {
__params.ReferenceData.SourceURI = input;
__next = '8';
}","7","Enter Recipient SourceURI","<html>
<body>
Enter Recipient SourceURI<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","33701","20335","IMT Transfer Abroad","var input = __input.response;
if (empty(input)) { 
__next = '9';
} else {
__params.ReferenceData.ReceiverAddressCountry = input;
__next = '9';
}","8","Enter Recipient Country","<html>
<body>
Enter Recipient Country<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","3401","1034","Organization operator applies a voucher for business withdraw","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReasonTypeCode = 'OrgOperatorApplyWithdrawVoucher_VDF_Demo'; 
if(TC.isSupportSecretCode(__params.ReasonTypeCode))
{
var secretCodeRule = TC.getSecretCodeRule();
__params.minLength = secretCodeRule.getMinLength();
__params.maxLength = secretCodeRule.getMaxLength();
__params.rule = secretCodeRule.getRule();
__params.info = 'Enter a secret code:';
__next = '4';
}
else
{
__next = '1';
}","begin","Initialization ","",""<endrec>
"TILL","","3","3402","1034","Organization operator applies a voucher for business withdraw","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '2';","1","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","3403","1034","Organization operator applies a voucher for business withdraw","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","3404","1034","Organization operator applies a voucher for business withdraw","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to apply?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","3501","1035","Super agent operator redeems a business withdraw voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","3502","1035","Super agent operator redeems a business withdraw voucher","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';
","1","Enter Voucher Code","<html>
<body>
Enter Voucher Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","3503","1035","Super agent operator redeems a business withdraw voucher","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","3504","1035","Super agent operator redeems a business withdraw voucher","var input = __input.response;
__params.VoucherValidationValue = input;
__next = '4';","3","Enter Short Code","<html>
<body>
Enter Reference Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","3505","1035","Super agent operator redeems a business withdraw voucher","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","3506","1035","Super agent operator redeems a business withdraw voucher","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","3507","1035","Super agent operator redeems a business withdraw voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Redeem Business withdraw Voucher - ${__params.ReceiverParty.Identifier}<br>
Amount: ${__params.Amount}<br>
ValidationValue: ${__params.VoucherValidationValue}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","3601","1036","Organization withdraw e-money from float to bank account via handset","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SP_ID */
__params.ReceiverPartyIdentifier = IC.getDefaultSpId();
orgInfo = IC.queryByMsisdn(msisdn);
shortCode = IC.queryShortCodeByTillId(orgInfo.identityId);
bankAccounts = IC.queryBankAccountList('04', shortCode, '0');
if (empty(bankAccounts ) || size(bankAccounts ) == 0) {
    __errormsg = 'Sorry, there is not any bank account.';
    __next = 'error';
 } 
else
{
     __next = '1';
}","begin","Initialization ","",""<endrec>
"TILL","","2","3602","1036","Organization withdraw e-money from float to bank account via handset","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","0","5","3604","1036","Organization withdraw e-money from float to bank account via handset","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","","1","3701","1037","Create Operator","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CreateOrgOperator';
__params.PrimaryOperator = '0';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';      /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';   /* OPERATOR_ID */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","3702","1037","Create Operator","var input = __input.response;
__params.FirstName = input;
__next = '2';
","1","Enter New first name","<html>
<body>
$$ if (!empty(nameFieldEmpty) && nameFieldEmpty == 'yes') {
You must input first name or last name.<br> 
$$    nameFieldEmpty = 'no';
$$} 
Enter new first name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","3703","1037","Create Operator","var input = __input.response;
__params.MiddleName = input;
__next = '3';","2","Enter New middle name","<html>
<body>
Enter New middle name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","3704","1037","Create Operator","var input = __input.response;
if (empty(__params.FirstName) && empty(input)) {
    nameFieldEmpty = 'yes';
    __params.FirstName = null;
    __params.MiddleName = null;
    __next = '1';
} else {
    __params.LastName = input;
    IDTypeItems = IC.queryAllIDTypeItem();
    if (IDTypeItems == null || empty(IDTypeItems)) {
        __errormsg = 'There are not any IDType items to select.';
        __next = 'error';
    } else {
        __next = '4';
    }
}","3","Enter New last name","<html>
<body>
Enter New last name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","3705","1037","Create Operator","var input = Util.toInt(__input.response);
if (input <= 0 || input > size(IDTypeItems)) {
   __next = '4';
} else {
   __params.CertificateType = IDTypeItems.get(input - 1).getValue(); 
   __next = '5';
}
","4","Identification Type","<html>
<body>
Identification Type:<br>            
$$ var languageCode = identity.getLocale().getLanguage();
$$ var index = 1;
$$ for (IDTypeItem : IDTypeItems) {
$$   var displayName = IDTypeItem.getNameByLanguageCode(languageCode);
${index} ${displayName} <br>
$$   index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","3706","1037","Create Operator","var input = __input.response;
if (input == null || empty(input)) {
    __next = '5';
} else {
    __params.CertificateNumber = input;
    __next = '6';
}","5","Enter New ID Number","<html>
<body>
Enter New ID Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","3707","1037","Create Operator","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '6';
} else {
    __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '7';
}","6","Enter New Date of Birth","<html>
<body>
Enter New Date of Birth(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","3708","1037","Create Operator","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '7';
} else {
    __params.ReceiverPartyIdentifierType = '05';  /*OPERATOR_ID*/
    __params.ReceiverPartyIdentifier = input;
    __next = '8';
}","7","Enter New Operator ID","<html>
<body>
Enter New Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","3709","1037","Create Operator","var input = __input.response;
__params.ReceiverPartyShortCode = input;
__next = '9';","8","Enter Organization Short Code","<html>
<body>
Enter Organization Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","3710","1037","Create Operator","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '9';
} else {
    __params.InitiatorIdentifier = input;
    __secure = true;

    roleTypes = IC.queryOrgOperatorAllRoleType(input);
    if (null == roleTypes || empty(roleTypes)) {
         __errormsg = 'There are not any role type to select.';
         __next = 'error';
     } else { 
         __next = '10';
    }
}","9","Enter Your Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","3711","1037","Create Operator","var input = Util.toInt(__input.response);
if (input <= 0 || input > size(roleTypes)) {
    __next = '10';
} else {
    __params.RoleID = roleTypes.get(input - 1).getRoleId();
    __next = '11';
}","10","Select Role Type","<html>
<body>
Please select role type:<br>
$$ var index = 1;
$$ for(roleType : roleTypes) {
${index} ${roleType.getName()}<br>
$$ index = index + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","3712","1037","Create Operator","var input = __input.response;
if (input == null || empty(input)) { 
    __next = '12';
} else {
   __params.KYCInfo = IC.buildOperatorInfo(__params);
   __params.@HEAD@PIN = input;
   __next = '13';
}","12","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","14","3713","1037","Create Operator","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '13';
}","13","Confirm","<html>
<body>
Confirm to create the operator?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","3801","1038","Close Operator","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ChangeOrgOperatorStatus';
__params.Status = '06';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","3802","1038","Close Operator","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '1';
} else {
    __params.ReceiverPartyIdentifierType = '05'; /* OPERATOR_ID */
    __params.ReceiverPartyIdentifier = input;
    __next = '2';
}
","1","Enter Operator ID to be Closed","<html>
<body>
Enter Operator ID to be Closed <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","3803","1038","Close Operator","var input = __input.response;
__params.ReceiverPartyShortCode = input;
__next = '3';","2","Enter Organization Short Code","<html>
<body>
Enter Organization Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","3804","1038","Close Operator","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '3';
} else {
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '4';
}","3","Enter Your Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","3805","1038","Close Operator","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '5';","4","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","3806","1038","Close Operator","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '5';
}


","5","Confirm ","<html>
<body>
Confirm to close the operator?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html> 
",""<endrec>
"TILL","","1","3901","1039","Operator buy airtime from MNO organization via handset","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","3902","1039","Operator buy airtime from MNO organization via handset","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifier = '100100'; /* China Mobile's short code */
  __next = '2';
} else {
  __next = '1';
}
","1","Enter MNO name","<html>
<body>
Enter MNO <br>
1 China Mobile<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","3903","1039","Operator buy airtime from MNO organization via handset","var input = __input.response;
if (!empty(input)) {
  __params.RechargedMSISDN = input;
  __next = '3';
} else {
  __next = '2';
}
","2","Enter phone no.","<html>
<body>
Enter phone no <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","3904","1039","Operator buy airtime from MNO organization via handset","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter amount <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","3905","1039","Operator buy airtime from MNO organization via handset","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>
",""<endrec>
"TILL","","6","3906","1039","Operator buy airtime from MNO organization via handset","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","3907","1039","Operator buy airtime from MNO organization via handset","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Buy Airtime ${__params.RechargedMSISDN} ${__params.Amount}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","3908","1040","ATM withdraw Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */ 
__params.ReceiverPartyIdentifier = msisdn;
__secure = true;
__params.VoucherTypeCode = 'Paynet ATM Withdawal Voucher'; 
atmProviders = Util.getAllATMProviders();
providerName='';

 if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
 else if(size(atmProviders ) == 1) 
   {
      providerName= atmProviders.get(0);
      __params.ShortCode= Util.getShortCodeByName(providerName);
      __next = '2';
   }
  else
 {
       __next = '1';
 }","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3909","1040","ATM withdraw Voucher","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(atmProviders)) {
   providerName= atmProviders.get(i);
   __params.ShortCode= Util.getShortCodeByName(providerName);
   __next = '2';
} else {
   __next = '1';
}","1","Enter ATM Provider","<html>
<body>
Select ATM Provider:<br>
$$ var index = 1;
$$ for (atmProvider: atmProviders ) {
${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","3910","1040","ATM withdraw Voucher","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","3911","1040","ATM withdraw Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","3912","1041","ATM withdraw Voucher by short code","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */ 
__params.ReceiverPartyIdentifier = msisdn;
 __params.VoucherTypeCode = 'Paynet ATM Withdawal Voucher'; 
__secure = true;
 __next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3913","1041","ATM withdraw Voucher by short code","__params.ShortCode=__input.response; 
if (!empty(__params.ShortCode)) {
      __next = '2';
   } 
 else 
   {
      __next = '1';
   }","1","Enter ATM Provider Short Code","<html>
<body>
Enter ATM Provider Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","3914","1041","ATM withdraw Voucher by short code","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","3915","1041","ATM withdraw Voucher by short code","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Short Code - ${__params.ShortCode} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","3916","1042","Apply Voucher via Reason Type","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__secure = true;

reasonTypes = Util.getAllReasonTypes(__params.AccessDeviceIdentifier);
 if (empty(reasonTypes) || size(reasonTypes) == 0) {
      __errormsg = 'Sorry, there is not any reason types.';
      __next = 'error';
   } 
 else 
   {
      __next = '1';
   }","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3917","1042","Apply Voucher via Reason Type","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(reasonTypes)) {
   __params.VoucherTypeCode = Util.getVoucherByReasonType(reasonTypes.get(i).getAlias());
   __next = '2';
} else {
   __next = '1';
}","1","Enter Reason type","<html>
<body>
Select reason type:<br>
$$ var index = 1;
$$ for (reasonType : reasonTypes) {
${index} ${reasonType.getDisplayName(identity.locale)}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","3918","1042","Apply Voucher via Reason Type","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","3919","1042","Apply Voucher via Reason Type","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","3","Confirm","<html>
<body>
Voucher Type - ${__params.VoucherTypeCode} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","3920","1043","Operator Apply Voucher via Reason Type","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__secure = true;

reasonTypes = Util.getAllReasonTypes(__params.AccessDeviceIdentifier);
 if (empty(reasonTypes) || size(reasonTypes) == 0) {
      __errormsg = 'Sorry, there is not any reason types.';
      __next = 'error';
   } 
 else 
   {
      __next = '1';
   }","begin","Initialization","",""<endrec>
"TILL","","2","3921","1043","Operator Apply Voucher via Reason Type","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(reasonTypes)) {
   __params.VoucherTypeCode = Util.getVoucherByReasonType(reasonTypes.get(i).getAlias());
   __next = '2';
} else {
   __next = '1';
}","1","Enter Reason type","<html>
<body>
Select reason type:<br>
$$ var index = 1;
$$ for (reasonType : reasonTypes) {
${index} ${reasonType.getDisplayName(identity.locale)}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","3922","1043","Operator Apply Voucher via Reason Type","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';","2","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","3923","1043","Operator Apply Voucher via Reason Type","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","3924","1043","Operator Apply Voucher via Reason Type","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to apply?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","3925","1044","Organization operator pay bill","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
 __params.AccessDeviceIdentifierType = '01';   /* MSISDN */ 
 __params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
 __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
CurrencyCode = """";
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
__next = '1'","begin","Initialization ","",""<endrec>
"TILL","","6","3926","1044","Organization operator pay bill","var input = __input.response;
__params.BillReferenceNumber = input;
__next = '2';","1","Enter Business No","<html>
<body>
Enter Business No.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","3927","1044","Organization operator pay bill","var input = __input.response;
__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
     accountTypes = IC.queryAccountInstanceByTillId(identity.identityId);
      __next = '3';
   } 
 else 
   {
      __next = '2';
   }","2","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","3932","1045","Create Lite Customer","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ActionType = 'CreateCustomer';
__params.CustomerType = '1001';
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","3933","1045","Create Lite Customer","var input = __input.response;
__params.FirstName = input;
__next = '2';
","1","Enter New first name","<html>
<body>
Enter new first name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","3934","1045","Create Lite Customer","var input = __input.response;
__params.MiddleName = input;
__next = '3';","2","Enter New middle name","<html>
<body>
Enter New middle name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","3935","1045","Create Lite Customer","var input = __input.response;
__params.LastName = input;
__next = '4';","3","Enter New last name","<html>
<body>
Enter New last name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","3936","1045","Create Lite Customer","var input = __input.response;
if (input == '1') {
  __params.CertificateType = '01'; /* National ID */
  __next = '5';
} else if (input == '2') {
  __params.CertificateType = '02'; /* Military ID*/
  __next = '5';
} else if (input == '3') {
  __params.CertificateType = '03'; /* Diplomatic ID */
  __next = '5';
} else if (input == '4') {
  __params.CertificateType = '04'; /* Alien ID */
  __next = '5';
} else if (input == '5') {
  __params.CertificateType = '05'; /* Passport */
  __next = '5';
} else {
  __next = '4';
}","4","Identification Type","<html>
<body>
Identification Type<br>
1  National ID<br>
2  Military ID<br>
3  Diplomatic ID<br>
4  Alien ID<br>
5  Passport<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","3937","1045","Create Lite Customer","var input = __input.response;
__params.CertificateNumber = input;
__next = '6';","5","Enter New ID Number","<html>
<body>
Enter New ID Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","3938","1045","Create Lite Customer","var input = __input.response;
if (Validator.isDate(input, 'ddMMyyyy')) {
  __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
  __next = '7';
} else {
  __next = '6';
}","6","Enter New Date of Birth","<html>
<body>
Enter New Date of Birth(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","3939","1045","Create Lite Customer","var input = __input.response;
__params.ReceiverPartyIdentifierType = '01';
__params.ReceiverPartyIdentifier = input;
__params.RegisterMsisdn = input;
__next = '8';","7","Enter New phone no","<html>
<body>
Enter New phone no<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","3940","1045","Create Lite Customer","var input = __input.response;
if (input == '1') {
  __next = '9';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
New customer ${__params.FirstName}, ${__params.LastName}, ${__params.CertificateNumber}, ${__params.RegisterMsisdn}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","3941","1045","Create Lite Customer","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '10';","9","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","3942","1045","Create Lite Customer","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo = IC.buildCustomerInfo(__params);
__next = 'end';","10","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","3943","1046","M-Shwari Activate Account","__params.ServiceCode = __service.serviceCode;
__params.ActionType ='ActiveFSIProducts';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* ShortCode*/
__params.ReceiverPartyIdentifier = msisdn;
__params.OrgShortCode = '262626';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3944","1046","M-Shwari Activate Account","var input = __input.response;
__params.@HEAD@PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","3945","1047","M-Shwari Activate Account Terms and Conditions","__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3946","1047","M-Shwari Activate Account Terms and Conditions","__next = 'end';","1","Terms and Conditions","<html>
<body>
Please read and confirm the contents to Activate:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","3947","1048","M-Shwari Deposit","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '262626';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Deposit';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3948","1048","M-Shwari Deposit","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","3949","1048","M-Shwari Deposit","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","3950","1048","M-Shwari Deposit","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Deposit ${__params.Amount} in bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","3951","1049","M-Shwari Withdraw","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '262626';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1a';","begin","Initialization ","",""<endrec>
"CUSTOMER","0","3","3952","1049","M-Shwari Withdraw","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"CUSTOMER","0","4","3953","1049","M-Shwari Withdraw","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"CUSTOMER","0","5","3954","1049","M-Shwari Withdraw","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Withdraw ${__params.Amount} from bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"CUSTOMER","","1","3955","1050","M-Shwari Request Loan","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '262626';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Request';
__params.Amount = '0';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3956","1050","M-Shwari Request Loan","var input = __input.response;
if (Validator.isAmount(input)) {
    __referenceData.RequestBalance = TC.convertAmountFormat(input);

    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","3957","1050","M-Shwari Request Loan","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","3958","1050","M-Shwari Request Loan","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Request  ${__params.Amount} loans from ${__params.ReceiverPartyIdentifier}?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","3959","1051","M-Shwari Request Loan Terms and Conditions","__params.ServiceCode = __service.serviceCode;
__params.ActionType ='SetConditionRead';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; 
__params.ReceiverPartyIdentifier = msisdn;
__params.OrgShortCode = '2001';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3960","1051","M-Shwari Request Loan Terms and Conditions","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
}","1","Terms and Conditions","<html>
<body>
Please read and confirm<br>
Please read and confirm the contents to Request Loan:<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>",""<endrec>
"CUSTOMER","","1","3961","1052","M-Shwari Pay Loan","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '262626';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Repayment';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3962","1052","M-Shwari Pay Loan","var input = __input.response;
if (Validator.isAmount(input)) {
    __referenceData.RequestBalance = TC.convertAmountFormat(input);
__params.Amount = __referenceData.RequestBalance;
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","3963","1052","M-Shwari Pay Loan","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","3964","1052","M-Shwari Pay Loan","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Pay ${__params.Amount} loans?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","3965","1053","M-Shwari Pay Loan from Savings","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '262626';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Payment_from_Savings';
__params.Amount = '0';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3966","1053","M-Shwari Pay Loan from Savings","var input = __input.response;
if (Validator.isAmount(input)) {    
  __referenceData.RequestBalance = TC.convertAmountFormat(input);    
__secure = true;  
  __next = '2';
} else {    
__next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","3967","1053","M-Shwari Pay Loan from Savings","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","3968","1053","M-Shwari Pay Loan from Savings","var input = __input.response;
if (input == '1') { 
 __next = 'end';
} else if (input == '0') {  
__next = 'cancel';
} else {  
__next = '3';
}","3","Confirm","<html>
<body>
Pay ${__params.Amount} loans from savings?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","3975","1056","M-Shwari Bank Balance","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='262626';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Saving_Account_Balance';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3976","1056","M-Shwari Bank Balance","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","3977","1057","M-Shwari Mini Statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='262626';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Mini_Statement';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3978","1057","M-Shwari Mini Statement","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","3979","1058","M-Shwari Loan Limit","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='262626';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Eligible_Credit_Limit';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","3980","1058","M-Shwari Loan Limit","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","4005","1060","M-Kesho Deposit","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '363636';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Deposit';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","4006","1060","M-Kesho Deposit","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","4007","1060","M-Kesho Deposit","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","4008","1060","M-Kesho Deposit","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Deposit ${__params.Amount} in bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","4009","1061","M-Kesho Withdraw","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '363636';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","1","401","1004","Withdraw money","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","4010","1061","M-Kesho Withdraw","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","4011","1061","M-Kesho Withdraw","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","4012","1061","M-Kesho Withdraw","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Withdraw ${__params.Amount} from bank?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","4013","1062","M-Kesho Request Loan","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '363636';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Request';
__params.Amount = '0';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","4014","1062","M-Kesho Request Loan","var input = __input.response;
if (Validator.isAmount(input)) {
    __referenceData.RequestBalance = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","4015","1062","M-Kesho Request Loan","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","4016","1062","M-Kesho Request Loan","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Request ${__params.ReceiverPartyIdentifier} ${__params.Amount} loans?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","4017","1063","M-Kesho Request Loan Terms and Conditions","__params.ServiceCode = __service.serviceCode;
__params.ActionType ='SetConditionRead';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; 
__params.ReceiverPartyIdentifier = msisdn;
__params.OrgShortCode = '1001';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","4018","1063","M-Kesho Request Loan Terms and Conditions","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
}","1","Terms and Conditions","<html>
<body>
Please read and confirm<br>
Please read and confirm the contents to Request Loan:<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>",""<endrec>
"CUSTOMER","","2","402","1004","Withdraw money","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';
","1","Enter till no","<html>
<body>
Enter till no<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","4027","1066","M-Kesho Request Insurance","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '363636';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Insurance_Request';
__params.Amount = '0';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","4028","1066","M-Kesho Request Insurance","var input = __input.response;
 if (Validator.isMatchRegex(input, '^[^<>!#%\""\*=\'\?&]{0,32}$') ){
     __referenceData.InsuranceTypeCode = input;
     __next = '3';     
   } 
else{
    __next = '2';
}","1","Enter InsuranceTypeCode","<html>
<body>
Enter InsuranceTypeCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","4029","1066","M-Kesho Request Insurance","var input = __input.response;
if (input == '1') {
  __next = '1';
} else if(input == '0') {
  __next = 'cancel';
}","2","Input Error","<html>
<body>
The value cannot contain the following special characters: <>!#%""*='?&<br>
1 Input again<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","403","1004","Withdraw money","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","4030","1066","M-Kesho Request Insurance","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","4031","1066","M-Kesho Request Insurance","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Request insurance?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","4032","1067","M-Kesho Request Insurance Terms and Conditions","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'SetConditionRead';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; 
__params.ReceiverPartyIdentifier = msisdn;
__params.OrgShortCode = '1001';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","4033","1067","M-Kesho Request Insurance Terms and Conditions","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
}","1","Terms and Conditions","<html>
<body>
Please read and confirm<br>
Please read and confirm the contents to Request Insurance:<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","4034","1068","M-Kesho Bank Balance","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='363636';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Saving_Account_Balance';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","4035","1068","M-Kesho Bank Balance","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","4036","1069","M-Kesho Mini Statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='363636';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = msisdn;
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Loan_Mini_Statement';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","4037","1069","M-Kesho Mini Statement","var input = __input.response;
__params.PIN = input;
__next = 'end';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","404","1004","Withdraw money","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter pin","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","405","1004","Withdraw money","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Withdraw cash from ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","5","1000","Buy Airtime","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","5000","1300","Create Customer Reminder Schedule With MSISDN","__params.ServiceCode = __service.serviceCode;
__params.ServiceForInitiateTransaction = __service.linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01';  /* MSISDN */
amap = { ""1"" : ""One Off"", ""2"" : ""Daily"", ""3"" : ""Weekly"", ""4"": ""4-Weekly"" ,""5"" : ""Monthly"", ""6"" : ""Bi Monthly"", ""7"" : ""Quarterly"", ""8"": ""Half Yearly"", ""9"": ""Yearly""}; 
Confirmation = {""1"":""Yes"",""0"":""No""};
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","5001","1300","Create Customer Reminder Schedule With MSISDN","var input = __input.response;
if (!empty(input) &&Validator.isNonzeroAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","5002","1300","Create Customer Reminder Schedule With MSISDN","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Phone Number","<html>
<body>
Enter Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","5003","1300","Create Customer Reminder Schedule With MSISDN","var input = __input.response;
if(Validator.isMatchRegex(input ,'^([a-zA-Z0-9_\.\-\,\-\;\-]){0,64}$'))
{
 __params.FreeText = input;
 __next = '4';
}
else
{
__next = '3';
}","3","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","5004","1300","Create Customer Reminder Schedule With MSISDN","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","5005","1300","Create Customer Reminder Schedule With MSISDN","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '5';
} else {
 __params.FirstPaymentReminderDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '6';
}","5","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","5006","1300","Create Customer Reminder Schedule With MSISDN","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '6';
} else {
 __params.IssuePaymentReminderUntil = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '7';
}","6","Enter Issue Reminder Date Until","<html>
<body>
Enter Issue Reminder Date Until(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","5007","1300","Create Customer Reminder Schedule With MSISDN","var input=__input.response;
if(!empty(input) && (input >= 0)&&(input <= 9))
{
 __params.Frequency = __input.response;
FrequencyName = amap.get(input);
 __next = '8';
}
else
{
__next = '7';
}","7","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","5008","1300","Create Customer Reminder Schedule With MSISDN","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '10';
} else {
  __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","5009","1300","Create Customer Reminder Schedule With MSISDN","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","10","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br>Amount: ${__params.Amount}<br>Phone Number: ${__params.ReceiverPartyIdentifier}<br>Free Text: ${__params.FreeText}<br>Reminder Name: ${__params.ReminderScheduleName}<br>First Date: ${__params.FirstPaymentReminderDate}<br>End Date: ${__params.IssuePaymentReminderUntil}<br>Frequency: ${FrequencyName}<br>Confirmation: ${Confirmation}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","5010","1301","Create Customer Reminder Schedule With Short Code","__params.ServiceCode = __service.serviceCode;
__params.ServiceForInitiateTransaction = __service.linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */
amap = { ""1"" : ""One Off"", ""2"" : ""Daily"", ""3"" : ""Weekly"", ""4"": ""4-Weekly"" ,""5"" : ""Monthly"", ""6"" : ""Bi Monthly"", ""7"" : ""Quarterly"", ""8"": ""Half Yearly"", ""9"": ""Yearly""}; 
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","7","50101","20502","Operator Create Account","var input = __input.response;
if(input == 1) {
 __next = 'end';
}else {
 __next = 'cancel';
}","6","Confirm","<html>
<body>
 Confirm to create ${__params.AccountName} account <br>
1 OK  <br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","50102","20102","Customer Create Account","var input = __input.response;
if(input == 1) {
 __next = 'end';
}else {
 __next = 'cancel';
}","4","Confirm","<html>
<body>
 Confirm to create ${__params.AccountName} account <br>
1 OK  <br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","50103","50102","Refund Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.RequesterIdentifierType = '01';
__params.ReceiverPartyIdentifierType = '03';  /* ORG_SHORT_CODE */
__params.isPgwOTCRefundPayVoucher = 'Y'; /* is or not payment getaway OTC Refund Voucher */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","5","50104","50102","Refund Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
${__params.info}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","50105","50102","Refund Voucher","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
__params.feeInfo = TC.calculateBudget(__params);
  __next = '4';
} else {
  __next = '3';
}
if (!empty(__params.feeInfo.isError)&&__params.feeInfo.isError == '1') {
__params.info = __params.feeInfo.errorMsg;
} else {
__params.info = 'Transaction Amount: ' + __params.feeInfo.principalAmout + ', Fee: ' + __params.feeInfo.fee + ', Total: ' + __params.feeInfo.sumAmount + '<br>' + '1 OK<br>' + '0 Cancel<br>';
}","3","Enter PIN","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","50106","50102","Refund Voucher","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","50107","50102","Refund Voucher","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Voucher No","<html>
<body>
Enter Voucher No <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","50108","50104","Transfer to owner","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.Currency= 'USD';
settlementNumber = IC.querySettlementNumber(msisdn);
if ( !empty(settlementNumber)) {
  __params.ReceiverPartyIdentifier=settlementNumber ;
  __next = '1';
}else {
   __errormsg = 'Obtain Settlement Number failed!';
   __next = 'error';
}","begin","Initialization ","",""<endrec>
"TILL","","2","50109","50104","Transfer to owner","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input ==  '0') {
  __next = 'cancel';
} else {
  __next = '1';
}","1","Confirm Owner's MSISDN","<html>
<body>
Your are going to transfer the funds to ${__params.ReceiverPartyIdentifier}[Owner's MSISDN].<br>
1 Press 1 to continue<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","5011","1301","Create Customer Reminder Schedule With Short Code","var input = __input.response;
if (!empty(input) &&Validator.isNonzeroAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","50110","50104","Transfer to owner","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","50111","50104","Transfer to owner","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';","3","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","50112","50104","Transfer to owner","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","50113","50104","Transfer to owner","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html><body>Merchant Transfer ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","5012","1301","Create Customer Reminder Schedule With Short Code","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","5013","1301","Create Customer Reminder Schedule With Short Code","var input = __input.response;
__params.ExtraParameter.BillReferenceNumber = input;
__next = '4';","3","Enter Bill No","<html>
<body>
Enter Bill No:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","5014","1301","Create Customer Reminder Schedule With Short Code","var input = __input.response;
if(Validator.isMatchRegex(input ,'^([a-zA-Z0-9_\.\-\,\-\;\-]){0,64}$'))
{
 __params.FreeText = input;
 __next = '5';
}
else
{
__next = '4';
}","4","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","5015","1301","Create Customer Reminder Schedule With Short Code","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","5016","1301","Create Customer Reminder Schedule With Short Code","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '6';
} else {
 __params.FirstPaymentReminderDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '7';
}","6","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","5017","1301","Create Customer Reminder Schedule With Short Code","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '7';
} else {
 __params.IssuePaymentReminderUntil = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '8';
}","7","Enter Issue Reminder Date Until","<html>
<body>
Enter Issue Reminder Date Until(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","5018","1301","Create Customer Reminder Schedule With Short Code","var input=__input.response;
if(!empty(input) && (input >= 0)&&(input <= 9))
{
 __params.Frequency = __input.response;
FrequencyName = amap.get(input);
 __next = '9';
}
else
{
__next = '8';
}","8","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","5019","1301","Create Customer Reminder Schedule With Short Code","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '10';
} else {
  __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","5020","1301","Create Customer Reminder Schedule With Short Code","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","10","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br>Amount: ${__params.Amount}<br>Short Code: ${__params.ReceiverPartyIdentifier}<br>Bill No: ${__params.ExtraParameter.BillReferenceNumber}<br>Free Text: ${__params.FreeText}<br>Reminder Name: ${__params.ReminderScheduleName}<br>First Date: ${__params.FirstPaymentReminderDate}<br>End Date: ${__params.IssuePaymentReminderUntil}<br>Frequency: ${FrequencyName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","50202","50201","Customer Get Start PIN","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CustomerGetStartPIN';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__erroinfo=""empty"";
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","50205","50201","Customer Get Start PIN","var input = __input.response;
__params.KYCInfo = IC.buildCustomerInfo(__params);
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '1';
}","2","Confirm","<html><body>Customer ${__params.FirstName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","50206","50201","Customer Get Start PIN","var input = __input.response;
if (Validator.isDate(input, 'ddMMyyyy')) {
  __params.Birthday = input;
  
  __next = '2';
}else{
  __next = '1b';
}","1","Enter Date of Birth","<html>
<body>
Enter Date of Birth(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","5021","1302","Create Customer Reminder Schedule With Short Code And MSISDN","__params.ServiceCode = __service.serviceCode;
__params.ServiceForInitiateTransaction = __service.linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */
amap = { ""1"" : ""One Off"", ""2"" : ""Daily"", ""3"" : ""Weekly"", ""4"": ""4-Weekly"" ,""5"" : ""Monthly"", ""6"" : ""Bi Monthly"", ""7"" : ""Quarterly"", ""8"": ""Half Yearly"", ""9"": ""Yearly""}; 
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","5022","1302","Create Customer Reminder Schedule With Short Code And MSISDN","var input = __input.response;
if (!empty(input) &&Validator.isNonzeroAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","5023","1302","Create Customer Reminder Schedule With Short Code And MSISDN","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","5024","1302","Create Customer Reminder Schedule With Short Code And MSISDN","var input = __input.response;
__params.ExtraParameter.RechargedMSISDN = input;
__next = '4';","3","Enter MSISDN Number","<html>
<body>
Enter MSISDN Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","5025","1302","Create Customer Reminder Schedule With Short Code And MSISDN","var input = __input.response;
if(Validator.isMatchRegex(input ,'^([a-zA-Z0-9_\.\-\,\-\;\-]){0,64}$'))
{
 __params.FreeText = input;
 __next = '5';
}
else
{
__next = '4';
}","4","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","5026","1302","Create Customer Reminder Schedule With Short Code And MSISDN","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","5027","1302","Create Customer Reminder Schedule With Short Code And MSISDN","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '6';
} else {
 __params.FirstPaymentReminderDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '7';
}","6","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","5028","1302","Create Customer Reminder Schedule With Short Code And MSISDN","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '7';
} else {
 __params.IssuePaymentReminderUntil = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '8';
}","7","Enter Issue Reminder Date Until","<html>
<body>
Enter Issue Reminder Date Until(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","5029","1302","Create Customer Reminder Schedule With Short Code And MSISDN","var input=__input.response;
if(!empty(input) && (input >= 0)&&(input <= 9))
{
 __params.Frequency = __input.response;
FrequencyName = amap.get(input);
 __next = '9';
}
else
{
__next = '8';
}","8","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","5030","1302","Create Customer Reminder Schedule With Short Code And MSISDN","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '10';
} else {
  __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","5031","1302","Create Customer Reminder Schedule With Short Code And MSISDN","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","10","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br>Amount: ${__params.Amount}<br>Short Code: ${__params.ReceiverPartyIdentifier}<br>MSISDN Number: ${__params.ExtraParameter.RechargedMSISDN}<br>Free Text: ${__params.FreeText}<br>Reminder Name: ${__params.ReminderScheduleName}<br>First Date: ${__params.FirstPaymentReminderDate}<br>End Date: ${__params.IssuePaymentReminderUntil}<br>Frequency: ${FrequencyName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","5032","1303","Create Customer IMT Transfer Abroad Reminder Schedule","__params.ServiceCode = __service.serviceCode;
__params.ServiceForInitiateTransaction = __service.linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01';  /* MSISDN */
__params.ExtraParameter.TransactionCategory = 'IMT';
__params.ExtraParameter.TransactionSubCategory = 'IMT_HomeSend_Remittance_Request';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","5033","1303","Create Customer IMT Transfer Abroad Reminder Schedule","var input = __input.response;
if (!empty(input) &&Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","5034","1303","Create Customer IMT Transfer Abroad Reminder Schedule","var input = __input.response;
if (empty(input)) { 
__next = '2';
} else {
__params.ExtraParameter.Recipient@@SPACE@@MSISDN = input;
__params.ReceiverPartyIdentifier = input;
__next = '3';
}","2","Enter Recipient MSISDN","<html>
<body>
Enter Recipient MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","5035","1303","Create Customer IMT Transfer Abroad Reminder Schedule","var input = __input.response;
__params.ExtraParameter.Recipient@@SPACE@@First@@SPACE@@Name = input;
__next = '4';","3","Enter Recipient First Name","<html>
<body>
Enter Recipient First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","5036","1303","Create Customer IMT Transfer Abroad Reminder Schedule","var input = __input.response;
__params.ExtraParameter.Recipient@@SPACE@@Last@@SPACE@@Name = input;
__next = '5';","4","Enter Recipient Last Name","<html>
<body>
Enter Recipient Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","5037","1303","Create Customer IMT Transfer Abroad Reminder Schedule","var input = __input.response;
__params.FreeText = input;
__next = '6';","5","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","5038","1303","Create Customer IMT Transfer Abroad Reminder Schedule","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","5039","1303","Create Customer IMT Transfer Abroad Reminder Schedule","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '7';
} else {
 __params.FirstPaymentReminderDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '8';
}","7","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","5040","1303","Create Customer IMT Transfer Abroad Reminder Schedule","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '8';
} else {
 __params.IssuePaymentReminderUntil = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '9';
}","8","Enter Issue Reminder Date Unitll","<html>
<body>
Enter Issue Reminder Date Unitll(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","5041","1303","Create Customer IMT Transfer Abroad Reminder Schedule","var input=__input.response;
if(!empty(input) && (input >= 0)&&(input <= 9))
{
 __params.Frequency = __input.response;
 __next = '10';
}
else
{
__next = '9';
}","9","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","5042","1303","Create Customer IMT Transfer Abroad Reminder Schedule","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '11';
} else {
  __next = '10';
}","10","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","5043","1303","Create Customer IMT Transfer Abroad Reminder Schedule","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","11","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br> Amount: ${__params.Amount}<br> Recipient MSISDN: ${__params.ExtraParameter.Recipient@@SPACE@@MSISDN}<br> Recipient First Name: ${__params.ExtraParameter.Recipient@@SPACE@@First@@SPACE@@Name}<br> Recipient Last Name: ${__params.ExtraParameter.Recipient@@SPACE@@Last@@SPACE@@Name}<br> Free Text: ${__params.FreeText}<br> Reminder Name: ${__params.ReminderScheduleName}<br> First Date: ${__params.FirstPaymentReminderDate}<br> End Date: ${__params.IssuePaymentReminderUntil}<br> Frequency: ${__params.Frequency}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","5044","1304","Create Customer M-Shwari Withdraw Reminder Schedule","__params.ServiceCode = __service.serviceCode;
__params.ServiceForInitiateTransaction = __service.linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* ShortCode */
__params.ReceiverPartyIdentifier  = '2001'; 
__params.ExtraParameter.TransactionCategory = 'FSI';
__params.ExtraParameter.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","5045","1304","Create Customer M-Shwari Withdraw Reminder Schedule","var input = __input.response;
if (!empty(input) &&Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","5046","1304","Create Customer M-Shwari Withdraw Reminder Schedule","var input = __input.response;
__params.FreeText = input;
__next = '3';","2","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","5047","1304","Create Customer M-Shwari Withdraw Reminder Schedule","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","5048","1304","Create Customer M-Shwari Withdraw Reminder Schedule","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '4';
} else {
 __params.FirstPaymentReminderDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '5';
}","4","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","5049","1304","Create Customer M-Shwari Withdraw Reminder Schedule","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '5';
} else {
 __params.IssuePaymentReminderUntil = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '6';
}","5","Enter Issue Reminder Date Unitll","<html>
<body>
Enter Issue Reminder Date Unitll(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","5050","1304","Create Customer M-Shwari Withdraw Reminder Schedule","var input=__input.response;
if(!empty(input) && (input >= 0)&&(input <= 9))
{
 __params.Frequency = __input.response;
 __next = '7';
}
else
{
__next = '6';
}","6","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","5051","1304","Create Customer M-Shwari Withdraw Reminder Schedule","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","5052","1304","Create Customer M-Shwari Withdraw Reminder Schedule","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br> Amount: ${__params.Amount}<br> Free Text: ${__params.FreeText}<br> Reminder Name: ${__params.ReminderScheduleName}<br> First Date: ${__params.FirstPaymentReminderDate}<br> End Date: ${__params.IssuePaymentReminderUntil}<br> Frequency: ${__params.Frequency}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","5053","50103","Create Customer M-Kesho Withdraw Reminder Schedule","__params.ServiceCode = __service.serviceCode;
__params.ServiceForInitiateTransaction = __service.linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* ShortCode */
__params.ReceiverPartyIdentifier  = '1001'; 
__params.ExtraParameter.TransactionCategory = 'FSI';
__params.ExtraParameter.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1';","begin","Initialization ","",""<endrec>
"CUSTOMER","","2","5054","50103","Create Customer M-Kesho Withdraw Reminder Schedule","var input = __input.response;
if (!empty(input) &&Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","5055","50103","Create Customer M-Kesho Withdraw Reminder Schedule","var input = __input.response;
__params.FreeText = input;
__next = '3';","2","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","5056","50103","Create Customer M-Kesho Withdraw Reminder Schedule","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","5057","50103","Create Customer M-Kesho Withdraw Reminder Schedule","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '4';
} else {
 __params.FirstPaymentReminderDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '5';
}","4","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","5058","50103","Create Customer M-Kesho Withdraw Reminder Schedule","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '5';
} else {
 __params.IssuePaymentReminderUntil = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '6';
}","5","Enter Issue Reminder Date Unitll","<html>
<body>
Enter Issue Reminder Date Unitll(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","5059","50103","Create Customer M-Kesho Withdraw Reminder Schedule","var input=__input.response;
if(!empty(input) && (input >= 0)&&(input <= 9))
{
 __params.Frequency = __input.response;
 __next = '7';
}
else
{
__next = '6';
}","6","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","5060","50103","Create Customer M-Kesho Withdraw Reminder Schedule","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","5061","50103","Create Customer M-Kesho Withdraw Reminder Schedule","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br> Amount: ${__params.Amount}<br> Free Text: ${__params.FreeText}<br> Reminder Name: ${__params.ReminderScheduleName}<br> First Date: ${__params.FirstPaymentReminderDate}<br> End Date: ${__params.IssuePaymentReminderUntil}<br> Frequency: ${__params.Frequency}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","5501","1311","View Reminder Schedules","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier =msisdn;
__params.ActionType= 'QueryIndividualReminderScheduleDetails';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
reminderList = IC.queryReminderListByMsisdn(__params);
if(empty(reminderList )|| size(reminderList )==0){
 __errormsg = 'no current schedules.';
 __next = 'error';
}else {
 __next = '1';
}","begin","Initialization","",""<endrec>
"CUSTOMER","","2","5502","1311","View Reminder Schedules","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(reminderList)) { 
__params.ReminderScheduleID =  reminderList.get(i).reminderId;
__params.ReminderScheduleName =  reminderList.get(i).reminderName;
__next = '2';
} else {
__next = '1';
}","1","Select Reminder Schedules","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","5503","1311","View Reminder Schedules","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","5504","1311","View Reminder Schedules","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '3';
}","3","Confirm","<html>
<body>
Reminder Schedule  - ${__params.ReminderScheduleName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","5551","1312","Cancel Reminder Schedule","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType= 'DeleteIndividualReminderSchedule';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
reminderList = IC.queryReminderListByMsisdn(__params);
amap = { ""1"" : ""One Off"", ""2"" : ""Daily"", ""3"" : ""Weekly"", ""4"": ""4-Weekly"" ,""5"" : ""Monthly"", ""6"" : ""Bi Monthly"", ""7"" : ""Quarterly"", ""8"": ""Half Yearly"", ""9"": ""Yearly""}; 
if ( !empty(reminderList ) || size(reminderList)>0) {
  __next = '1';
}else {
   __errormsg = 'no current schedules.';
   __next = 'error';
}","begin","Initialization","",""<endrec>
"CUSTOMER","","2","5552","1312","Cancel Reminder Schedule","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(reminderList)){
 __params.ReminderScheduleID =  reminderList.get(i).reminderId;

reminderID =  reminderList.get(i).reminderId;
reminderName =  reminderList.get(i).reminderName;
freeText =  reminderList.get(i).freeText;
serviceID =  reminderList.get(i).serviceID;
firstPaymentReminderDate =  reminderList.get(i).firstPaymentReminderDate;
issuePaymentReminderUntil =  reminderList.get(i).issuePaymentReminderUntil;
frequency =  reminderList.get(i).frequency;
FrequencyName = amap.get(frequency);
  __next = '2';
  }else {
  __next = '1';
}","1","Select Reminder Schedule","<html>
<body>
Please Select Cancel Reminder Schedule:<br>
$$ var index = 1;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","5553","1312","Cancel Reminder Schedule","__params.@HEAD@PIN = __input.response;
__next = '3';","2","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","5554","1312","Cancel Reminder Schedule","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
 Confirm to cancel reminder schedule:<br>
ReminderScheduleID:${reminderID}<br>
ReminderName:${reminderName}<br>
Description:${freeText}<br>
ServiceID:${serviceID}<br>
Start Date:${firstPaymentReminderDate}<br>
End Date:${issuePaymentReminderUntil}<br>
Frequency:${FrequencyName}.<br><br>
1 OK  <br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","5601","1313","Initiate Customer Transaction by Reminder","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.RequesterIdentifierType = '01'; /* MSISDN */
__params.RequesterIdentifier= msisdn;
__params.ActionType= 'InitiateTransactionByReminder';
custReminders = IC.queryReminderByParams(__params);
if ( size(custReminders)>0) {
  __next = '1';
}else {
   __errormsg = 'There is no Reminder exist!';
   __next = 'error';
}","begin","Initialization","",""<endrec>
"CUSTOMER","","2","5602","1313","Initiate Customer Transaction by Reminder","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(custReminders)){
  custReminder= custReminders.get(i);
  reminderId = custReminder.reminderId;
  reminderName = custReminder.reminderName;
__params.ReminderID= reminderId;
  __next = '2';
} else {
  __next = '1';
}","1","Select Reminder","<html>
<body>
Please Select Reminder:<br>
$$ var index = 1;
$$ for (custReminder: custReminders){
 ${index} ${custReminder.reminderId} / ${custReminder.reminderName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","5603","1313","Initiate Customer Transaction by Reminder","__params.@HEAD@PIN = __input.response;
__next = '4';","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","5604","1313","Initiate Customer Transaction by Reminder","var input = __input.response;
if(input == 1) {
 __next = 'end';
}else {
 __next = 'cancel';
}","4","Confirm","<html>
<body>
 Confirm to Initiate Transaction By Reminder ${__params.ReminderID}<br>
1 OK  <br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","5651","1314","Initiate Organization Transaction by Reminder","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPEATOR ID */
__params.ActionType= 'InitiateTransactionByReminder';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","3","5652","1314","Initiate Organization Transaction by Reminder","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(orgReminders)){
  orgReminder= orgReminders.get(i);
  reminderId = orgReminder.reminderId;
  reminderName = orgReminder.reminderName;
__params.ReminderID= reminderId;
  __next = '3';
} else {
  __next = '2';
}","2","Select Reminder","<html>
<body>
Please Select Reminder:<br>
$$ var index = 1;
$$ for (orgReminder: orgReminders){
 ${index} ${orgReminder.reminderId} / ${orgReminder.reminderName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","5653","1314","Initiate Organization Transaction by Reminder","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
orgReminders = IC.queryReminderByParams(__params);
  __next = '2';
} else {
  __next = '1';
}
if ( size(orgReminders)>0) {
  __next = '2';
}else {
   __errormsg = 'There is no Reminder exist!';
   __next = 'error';
}","1","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","5654","1314","Initiate Organization Transaction by Reminder","__params.@HEAD@PIN = __input.response;
__next = '4';","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","5655","1314","Initiate Organization Transaction by Reminder","var input = __input.response;
if(input == 1) {
 __next = 'end';
}else {
 __next = 'cancel';
}","4","Confirm","<html>
<body>
 Confirm to Initiate Transaction By Reminder ${__params.ReminderID}<br>
1 OK  <br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","5790","1334","Purchase Airtime via m-pesa","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","5792","1334","Purchase Airtime via m-pesa","var input = __input.response;
if(input == 1) {
 __next = '2a';
}else if(input == '2') {
beneficiaries = IC.queryCustListBeneficiary(msisdn);
    if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
}else{
 __next = '2';
}","2","Select option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","5884","1351","Reset Operator PIN","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ResetOrgOperatorPIN';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType  = '05'; /* OPERATOR_ID */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","5885","1351","Reset Operator PIN","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '1';
} else {
    __params.ReceiverPartyIdentifier = input;
   __params.ReceiverPartyShortCode = identity.shortCode;
    __next = '2';
}","1","Input Operator B ID","<html>
<body>
Input Operator B ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","5887","1351","Reset Operator PIN","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '3';","2","Input PIN","<html>
<body>
Input PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","5888","1351","Reset Operator PIN","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to reset PIN?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","6","1000","Buy Airtime","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","601","1006","Redeem withdraw voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","3","602","1006","Redeem withdraw voucher","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';
","1","Enter Voucher Code","<html>
<body>
Enter Voucher Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","604","1006","Redeem withdraw voucher","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","605","1006","Redeem withdraw voucher","var input = __input.response;
  __params.VoucherValidationValue = input;
  __next = '4';","3","Enter Additional validation information","<html>
<body>
Enter Additional validation information<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","606","1006","Redeem withdraw voucher","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","607","1006","Redeem withdraw voucher","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6187","1342","Recharge","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '5';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '6';
}","5","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6188","1343","Transfer","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '5';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '6';
}","5","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6190","1337","Customer Buy Goods via m-pesa","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6194","1327","Customer Intra-Account Transfer Saving to Saving","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6195","1330","Customer Intra-Account Transfer m-pesae to m-pesae","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6196","999","Customer Intra-Account Transfer Saving to m-pesae","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6197","1322","Customer Intra-Account Transfer m-pesae  to Saving","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6202","1320","Operator Commission payable accounts Transfer via Till","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6203","1339","Refund Voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","6204","1334","Purchase Airtime via m-pesa","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6205","1001","Deposit Money","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '5';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '6';
}","5","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6207","1004","Withdraw money","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","22","6209","1024","Customer pay bill","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '9';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9a';
}","9","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6210","1027","Merchant Initiates Buy Goods transaction using a voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6211","1028","Merchant Initiates Buy Goods refund transaction","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6212","1030","Super agent operator initiates business deposit","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6213","1032","Super agent operator redeems a business deposit voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6214","1033","Organization operator initiates business withdraw","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6215","1035","Super agent operator redeems a business withdraw voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","0","7","6217","1036","Organization withdraw e-money from float to bank account via handset","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '5';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '6';
}","5","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","","7","6222","1371","Group B2G Transfer","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6225","1377","Refund Group Transaction","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6229","1204","Pay Voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6230","1359","Initiate Reversal Transaction","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '3';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '4';
}","3","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6232","1392","OTC Remit to M-Wallet","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6233","1393","OTC Remit to CNIC","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6234","1394","Collect Remittance","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6235","1395","Customer Remit","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6246","1396","Agent Upgrade Customer","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ChangeCustKYC';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","3","6247","1396","Agent Upgrade Customer","var input = __input.response;
__params.LastName = input;
__next = '3';","2","Enter Last name","<html>
<body>
Enter Father's name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6248","1396","Agent Upgrade Customer","var input = __input.response;
if (input == '1') {
  __params.CertificateType = '01'; /* National ID */
  __next = '4';
} else if (input == '2') {
  __params.CertificateType = '05'; /* Passport */
  __next = '4';
} else {
  __next = '3';
}","3","Identification Type","<html>
<body>
Identification Type<br>
1  National ID<br>
2  Passport<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6249","1396","Agent Upgrade Customer","var input = __input.response;
__params.CertificateNumber = input;
__params.isCondition = 'true';
__next = '5';","4","Enter ID Number","<html>
<body>
Enter ID Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6250","1396","Agent Upgrade Customer","var input = __input.response;
if (Validator.isDate(input, 'ddMMyyyy')) {
  __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
  __next = '6';
} else {
  __next = '5';
}","5","Enter Date of Birth","<html>
<body>
Enter Date of Birth(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","6251","1396","Agent Upgrade Customer","var input = __input.response;
__params.ReceiverPartyIdentifierType = '01';
__params.ReceiverPartyIdentifier = input;
__params.RequesterIdentifierType = '01';
  __params.RequesterIdentifier = input;
__next = '2';","1","Enter phone no","<html>
<body>
Enter phone no<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6252","1396","Agent Upgrade Customer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html><body>Customer ${__params.LastName}, ${__params.CertificateNumber}, ${__params.RequesterIdentifier}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6253","1396","Agent Upgrade Customer","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '7';","6","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6254","1396","Agent Upgrade Customer","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo = IC.buildCustomerInfo(__params);
__next = '8';","7","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6260","1397","Add Group Beneficiary","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverIdentifierType = '01'; /* SP_ID */
__params.ReceiverIdentifier = msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__params.ActionType = 'AddGroupBeneficiary';
__next = '1';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","6261","1397","Add Group Beneficiary","var input = __input.response;
if(!empty(input)){
   __params.BeneficiaryIdentifier= __input.response;
   __next = '2';
}else{
    __next ='1';
}","1","Input Group Code","<html>
<body>
Input Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6262","1397","Add Group Beneficiary","var input=__input.response;
if(empty(input))
{
  __next = '3';
}
else if(Validator.checkBenefiRefLength(input))
{
 __params.BeneficiaryReference = __input.response;
 __next = '3';
}
else
{
__next = '2';
}","2","Input Reference","<html>
<body>
Input Reference:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6263","1397","Add Group Beneficiary","__params.@HEAD@PIN = __input.response;
__next = 'end';","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6264","1398","M-Shwari Activate Group Account Terms and Conditions","__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6265","1398","M-Shwari Activate Group Account Terms and Conditions","__next = 'end';","1","Terms and Conditions","<html>
 <body>
 Please read and confirm the contents to Activate:<br>
 <a href=""${mobilemoneyURL}"" default=""yes""></a>
 </body>
 </html>",""<endrec>
"CUSTOMER","","1","6266","1399","Group ATM Withdraw Voucher(valueless)","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group */ 
__secure = true;
__params.ReasonTypeCode = 'Group Request ATM Withdrawal Voucher'; 
atmProviders = Util.getAllATMProviders();
providerName='';

 if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
 else if(size(atmProviders ) == 1) 
   {
      providerName= atmProviders.get(0);
      __params.ShortCode= Util.getShortCodeByName(providerName);
      __next = '2';
   }
  else
 {
       __next = '1';
 }","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6267","1399","Group ATM Withdraw Voucher(valueless)","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.ReceiverPartyIdentifier = input;
    __next = '2'; 
} 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6268","1399","Group ATM Withdraw Voucher(valueless)","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(atmProviders)) {
   providerName= atmProviders.get(i);
   __params.ShortCode= Util.getShortCodeByName(providerName);
   __next = '4';
} else {
   __next = '2';
}","2","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6269","1399","Group ATM Withdraw Voucher(valueless)","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.VoucherAmount= TC.convertAmountFormat(input);
    __next = '4';
} else {
    __secure = true;
    __next = '4';
}","3","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6270","1399","Group ATM Withdraw Voucher","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6271","1399","Group ATM Withdraw Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6272","1400","Group ATM Deposit Voucher(Value)","__params.ServiceCode = __service.serviceCode;
__params.VoucherServiceType = '2'; /* VoucherServiceType */ 
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group*/ 
__secure = true;
__params.ReasonTypeCode = 'Group request ATM Deposit Voucher'; 
atmProviders = Util.getAllATMProvidersOfDeposit();
providerName='';

 if (empty(atmProviders ) || size(atmProviders ) == 0) {
      __errormsg = 'Sorry, there is not any ATM providers.';
      __next = 'error';
   } 
 else if(size(atmProviders ) == 1) 
   {
      providerName= atmProviders.get(0);
      __params.ShortCode= Util.getShortCodeByName(providerName);
      __next = '2';
   }
  else
 {
       __next = '1';
 }","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6273","1400","Group ATM Deposit Voucher(Value)","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
    __params.ReceiverPartyIdentifier = input;
    __next = '2'; 
} 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6274","1400","Group ATM Deposit Voucher(Value)","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(atmProviders)) {
   providerName= atmProviders.get(i);
   __params.ShortCode= Util.getShortCodeByName(providerName);
   __next = '3';
} else {
   __next = '2';
}","2","Enter ATM Provider","<html>
<body>
Please select ATM provider:<br>
$$ var index = 1;
$$ for (atmProvider: atmProviders ) {
  ${index} ${atmProvider}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6275","1400","Group ATM Deposit Voucher(Value)","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6276","1400","Group ATM Deposit Voucher(Value)","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","6277","1317","Add Group Member dont use","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","0","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a></body>
</html>",""<endrec>
"CUSTOMER","","1","6361","1500","View Customer Bundles","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'QueryCustomerBundleDetails';
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType= '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* SP_ID */
__params.ReceiverPartyIdentifier= msisdn;
__params.PrimaryIdentifierType= '04'; /* SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6362","1500","View Customer Bundles","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-3])$'))
{
__params.BundleType= input ;
__secure = true;
 __next = '2';
}
else {
 __next = '1';
}","1","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6363","1500","View Customer Bundles","if (empty(BundleList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(BundleList)) {
               type = BundleList.get(tmp);
                __params.BundleId = type.bundleId;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Select Destination Bundle","<html>
<body>
Please select destination bundle :<br>
$$BundleList = IC.queryBundleforInteroperability(__params);
$$if (empty(BundleList )) {
  You have no bundle to subscribe.
$$} else {
  $$var i = 1;
  $$for(bundle: BundleList ) {
  ${i} ${bundle.bundleName}:${bundle.internalPrice} ${bundle.Currency} ${bundle.durationTimes} ${bundle.durationUnit}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6364","1500","View Customer Bundles","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6365","1500","View Customer Bundles","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6366","1501","Query My Own Bundles","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'QueryCustomerIdentityBundleDetails';
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType= '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier= msisdn;
__params.PrimaryIdentifierType= '04'; /* SHORT_CODE */
__next = '1';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6367","1501","Query My Own Bundles","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-3])$'))
{
__params.BundleType= input ;
__secure = true;
 __next = '2';
}
else {
 __next = '1';
}","1","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6368","1501","Query My Own Bundles","if (empty(BundleList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(BundleList)) {
               type = BundleList.get(tmp);
                __params.IdentityBundleId = type.identityBundleId;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Select Destination Bundle","<html>
<body>
Please select Destination bundle:<br>
$$BundleList = IC.queryIdentityBundleforInteroperability(__params);
$$if (empty(BundleList )) {
  No bundle you have subscribed.
$$} else {
  $$var i = 1;
  $$for(bundle: BundleList ) {
  ${i} ${bundle.identityBundleId} :${bundle.bundleName} ${bundle.internalPrice} ${bundle.Currency}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6369","1501","Query My Own Bundles","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6370","1501","Query My Own Bundles","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6374","1036","Organization withdraw e-money from float to bank account via handset","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccounts)) {
   __params.BankCardID= bankAccounts.get(i).bankCardId;
   __params.BankAccountName= bankAccounts.get(i).accountName + '/' + bankAccounts.get(i).accountNumber + '(' + bankAccounts.get(i).bankName  + ')';
   __secure = true;
   __next = '3';
} else {
   __next = '2';
}","2","Enter Bank Card ID","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6375","1502","Customer withdraw e-money from float to bank account via handset","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';   /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SP_ID */
__params.ReceiverPartyIdentifier = IC.getDefaultSpId();
bankAccounts = IC.queryBankAccountList(__params.InitiatorIdentifierType, __params.InitiatorIdentifier, '0');
if (empty(bankAccounts ) || size(bankAccounts ) == 0) {
    __errormsg = 'Sorry, there is not any bank account.';
    __next = 'error';
 } 
else
{
     __next = '1';
}","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6376","1502","Customer withdraw e-money from float to bank account via handset","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6377","1502","Customer withdraw e-money from float to bank account via handset","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccounts)) {
   __params.BankCardID= bankAccounts.get(i).bankCardId;
   __params.BankAccountName= bankAccounts.get(i).accountName + '/' + bankAccounts.get(i).accountNumber + '(' + bankAccounts.get(i).bankName  + ')';
   __secure = true;
   __next = '3';
} else {
   __next = '2';
}","2","Enter Bank Card ID","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6378","1502","Customer withdraw e-money from float to bank account via handset","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6379","1502","Customer withdraw e-money from float to bank account via handset","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6380","1502","Customer withdraw e-money from float to bank account via handset","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Withdraw Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountName}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6395","1510","Create Customer Bundle","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType= '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier= msisdn;
__params.AssignType= '1';
__params.ActionType = 'CreateCustomerBundle';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6396","1510","Create Customer Bundle","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-3])$'))
{
__params.BundleType= input ;
__secure = true;
 __next = '2';
}
else {
 __next = '1';
}","1","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6397","1510","Create Customer Bundle","if (empty(BundleList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(BundleList)) {
               type = BundleList.get(tmp);
                __params.BundleID = type.bundleId;
                __params.BundleName = type.bundleName;
                __params.Price= type.internalPrice;
                __params.Currency= type.Currency;
                __params.AutomaticRenewal= type.automaticRenewal;
                __params.BundleProvider= type.bundleProvider;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Select a Bundle","<html>
<body>
Please select destination bundle :<br>
$$BundleList = IC.queryBundleforInteroperability(__params);
$$if (empty(BundleList )) {
  You have no bundle to subscribe.
$$} else {
  $$var i = 1;
  $$for(bundle: BundleList ) {
   ${i} ${bundle.bundleName} :(${bundle.internalPrice} ${bundle.Currency})
$$if (!empty(bundle.durationTimes)) {
 (${bundle.durationTimes} ${bundle.durationUnit})<br>
$$}else{
     <br>
$$}  
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6398","1510","Create Customer Bundle","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
    if(input =='1')
    {
            __secure = true;
           __params.EffectiveMode= '0';
            __next = '4';
    }
    else if(input =='2')
    {
            __secure = true;
            __params.EffectiveMode= '-1';
            __next = '5';
    }else {
          __next = '3';
}
}
else {
 __next = '3';
}","3","Select Effective Mode","<html>
<body>Select Effective Mode:<br>
1 Input days from today<br>
2 Next day of the same bundle expired<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6399","1510","Create Customer Bundle","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9]{1,3})$')){
     __params.EffectiveMode= input;
     __next = '5';     
   } 
else{
    __next = '4';
}","4","Input Days From Today","<html>
<body>Input Days From Today:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6400","1510","Create Customer Bundle","var input = __input.response;
if (input == '1') {
  __next = '6';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm Bundle Information","<html>
<body>
Please Confirm Bundle Information :<br>
     Bundle Name : ${__params.BundleName}<br>
$$if (!empty(__params.BundleProvider )) {
     Provider :${__params.BundleProvider}<br>
$$}
     Price : ${__params.Price} ${__params.Currency}<br>
$$if(__params.EffectiveMode=='-1'){
     Next day of the same bundle expired<br>
$$}else if(__params.EffectiveMode=='0'){
     Effective Date : Today<br>
$$}else{
     Effective Date : ${__params.EffectiveMode} days from today<br>
$$}
$$if(type.automaticRenewal=='0'){
     Renewal Mode : No action<br>
$$}else if(type.automaticRenewal=='1'){    
     Renewal Mode : Send Reminer only<br>
$$}else if(type.automaticRenewal=='2'){    
     Renewal Mode : Automatically subscribe<br>
$$}
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6401","1510","Create Customer Bundle","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6402","1510","Create Customer Bundle","var input = __input.response;
__params.BundleInfo = IC.convertBundleInfo(__params);
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '7';
}","7","Confirm","<html>
<body>
Confirm to subscribe customer bundle?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6403","1511","Create Organization Bundle","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CreateOrganizationBundle';
__params.Status = '06';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.AssignType= '1';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6405","1511","Create Organization Bundle","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-3])$'))
{
__params.BundleType= input ;
__secure = true;
 __next = '2';
}
else {
 __next = '1';
}","1","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6406","1511","Create Organization Bundle","if (empty(BundleList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(BundleList)) {
               type = BundleList.get(tmp);
                __params.BundleID = type.bundleId;
                __params.BundleName = type.bundleName;
                __params.Price= type.internalPrice;
                __params.Currency= type.Currency;
                __params.AutomaticRenewal= type.automaticRenewal;
                __params.BundleProvider= type.bundleProvider;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Select a Bundle","<html>
<body>
Please select destination bundle :<br>
$$BundleList = IC.queryBundleforInteroperability(__params);
$$if (empty(BundleList )) {
  You have no bundle to subscribe.
$$} else {
  $$var i = 1;
  $$for(bundle: BundleList ) {
   ${i} ${bundle.bundleName} :(${bundle.internalPrice} ${bundle.Currency})
$$if (!empty(bundle.durationTimes)) {
 (${bundle.durationTimes} ${bundle.durationUnit})<br>
$$}else{
     <br>
$$}  
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6407","1511","Create Organization Bundle","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
    if(input =='1')
    {
            __secure = true;
            __next = '6';
    }
    else if(input =='2')
    {
            __secure = true;
            __params.EffectiveMode= '-1';
            __next = '7';
    }else {
          __next = '5';
}
}
else {
 __next = '5';
}","5","Select Effective Mode","<html>
<body>Select Effective Mode:<br>
1 Input days from today<br>
2 Next day of the same bundle expired<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6408","1511","Create Organization Bundle","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9]{1,3})$')){
     __params.EffectiveMode= input;
     __next = '7';     
   } 
else{
    __next = '6';
}","6","Input Days From Today","<html>
<body>Input days from today:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6409","1511","Create Organization Bundle","var input = __input.response;
if (input == '1') {
  __next = '8';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm Bundle Information","<html>
<body>
Please Confirm Bundle Information :<br>
     Bundle Name : ${__params.BundleName}<br>
$$if (!empty(__params.BundleProvider )) {
     Provider :${__params.BundleProvider}<br>
$$}
     Price : ${__params.Price} ${__params.Currency}<br>
$$if(__params.EffectiveMode=='-1'){
     Next day of the same bundle expired<br>
$$}else if(__params.EffectiveMode=='0'){
     Effective Date : Today<br>
$$}else{
     Effective Date : ${__params.EffectiveMode} days from today<br>
$$}
$$if(type.automaticRenewal=='0'){
     Renewal Mode : No action<br>
$$}else if(type.automaticRenewal=='1'){    
     Renewal Mode : Send Reminer only<br>
$$}else if(type.automaticRenewal=='2'){    
     Renewal Mode : Automatically subscribe<br>
$$}
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6410","1511","Create Organization Bundle","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '3';
} else {
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '4';
}","3","Enter Your Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","6411","1511","Create Organization Bundle","var input = __input.response;
__params.BundleInfo = IC.convertBundleInfo(__params);
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '10';
}","9","Confirm","<html>
<body>
Confirm to subscribe organization bundle?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6412","1511","Create Organization Bundle","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '9';
} else {
    __secure = true;
    __next = '8';
}","8","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6416","1520","View Group Bundles","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'QueryGroupBundleDetails';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6417","1520","View Group Bundles","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6418","1520","View Group Bundles","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-3])$'))
{
__params.BundleType= input ;
__secure = true;
 __next = '3';
}
else {
 __next = '2';
}","2","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6419","1520","View Group Bundles","if (empty(BundleList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(BundleList)) {
               type = BundleList.get(tmp);
                __params.BundleId = type.bundleId;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Destination Bundle","<html>
<body>
Please select destination bundle :<br>
$$BundleList = IC.queryBundleforInteroperability(__params);
$$if (empty(BundleList )) {
  You have no bundle to subscribe.
$$} else {
  $$var i = 1;
  $$for(bundle: BundleList ) {
  ${i} ${bundle.bundleName}:${bundle.internalPrice} ${bundle.Currency} ${bundle.durationTimes} ${bundle.durationUnit}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6420","1520","View Group Bundles","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6421","1520","View Group Bundles","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6422","1521","Query My Group Bundles","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'QueryGroupIdentityBundleDetails';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6423","1521","Query My Group Bundles","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6424","1521","Query My Group Bundles","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-3])$'))
{
__params.BundleType= input ;
__secure = true;
 __next = '3';
}
else {
 __next = '2';
}","2","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6425","1521","Query My Group Bundles","if (empty(BundleList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(BundleList)) {
               type = BundleList.get(tmp);
                __params.IdentityBundleId = type.identityBundleId;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Destination Bundle","<html>
<body>
Please select Destination bundle :<br>
$$BundleList = IC.queryIdentityBundleforInteroperability(__params);
$$if (empty(BundleList )) {
  No bundle you have subscribed.
$$} else {
  $$var i = 1;
  $$for(bundle: BundleList ) {
  ${i} ${bundle.identityBundleId} :${bundle.bundleName} ${bundle.internalPrice} ${bundle.Currency}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6426","1521","Query My Group Bundles","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6427","1521","Query My Group Bundles","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6428","1512","Create Group Bundle","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'CreateGroupBundle';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
__params.AssignType= '1';
groups = IC.queryMyGroups(msisdn);
  __next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6429","1512","Create Group Bundle","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6430","1512","Create Group Bundle","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '0';
}
}
if ( found == '1') {
   __errormsg = 'no current group or not belong to the group.';
   __next = 'error';
}
else
{
   __next = '2';
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6431","1512","Create Group Bundle","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{

  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6432","1512","Create Group Bundle","if (empty(BundleList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(BundleList)) {
               type = BundleList.get(tmp);
                __params.BundleID = type.bundleId;
                __params.BundleName = type.bundleName;
                __params.Price= type.internalPrice;
                __params.Currency= type.Currency;
                __params.AutomaticRenewal= type.automaticRenewal;
                __params.BundleProvider= type.bundleProvider;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select a Bundle","<html>
<body>
Please select destination bundle :<br>
$$BundleList = IC.queryBundleforInteroperability(__params);
$$if (empty(BundleList )) {
  You have no bundle to subscribe.
$$} else {
  $$var i = 1;
  $$for(bundle: BundleList ) {
   ${i} ${bundle.bundleName} :(${bundle.internalPrice} ${bundle.Currency})
$$if (!empty(bundle.durationTimes)) {
 (${bundle.durationTimes} ${bundle.durationUnit})<br>
$$}else{
     <br>
$$}  
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6433","1512","Create Group Bundle","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-3])$'))
{
__params.BundleType= input ;
__secure = true;
 __next = '3';
}
else {
 __next = '2';
}","2","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6434","1512","Create Group Bundle","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
    if(input =='1')
    {
            __secure = true;
            __next = '5';
    }
    else if(input =='2')
    {
            __secure = true;
            __params.EffectiveMode= '-1';
            __next = '6';
    }else {
          __next = '4';
}
}
else {
 __next = '4';
}","4","Select Effective Mode","<html>
<body>Select Effective Mode:<br>
1 Input days from today<br>
2 Next day of the same bundle expired<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6435","1512","Create Group Bundle","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9]{1,3})$')){
     __params.EffectiveMode= input;
     __next = '6';     
   } 
else{
    __next = '5';
}","5","Input Days From Today","<html>
<body>Input days from today:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","6436","1512","Create Group Bundle","var input = __input.response;
if (input == '1') {
  __next = '7';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm bundle information","<html>
<body>
Please Confirm Bundle Information :<br>
     Bundle Name : ${__params.BundleName}<br>
$$if (!empty(__params.BundleProvider )) {
     Provider :${__params.BundleProvider}<br>
$$}
     Price : ${__params.Price} ${__params.Currency}<br>
$$if(__params.EffectiveMode=='-1'){
     Next day of the same bundle expired<br>
$$}else if(__params.EffectiveMode=='0'){
     Effective Date : Today<br>
$$}else{
     Effective Date : ${__params.EffectiveMode} days from today<br>
$$}
$$if(type.automaticRenewal=='0'){
     Renewal Mode : No action<br>
$$}else if(type.automaticRenewal=='1'){    
     Renewal Mode : Send Reminer only<br>
$$}else if(type.automaticRenewal=='2'){    
     Renewal Mode : Automatically subscribe<br>
$$}
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","6437","1512","Create Group Bundle","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '8';
} else {
    __secure = true;
    __next = '7';
}","7","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","6438","1512","Create Group Bundle","var input = __input.response;
__params.BundleInfo = IC.convertBundleInfo(__params);
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '8';
}","8","Confirm","<html>
<body>
Confirm to subscribe group bundle?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6440","1522","View Bundles","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'QueryOrgBundleDetails';
__params.Status = '06';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6441","1522","View Bundles","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
}
else
{
    __next = '1';
}
__next = '2';","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6442","1522","View Bundles","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
    __next = '3';
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6443","1522","View Bundles","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-3])$'))
{
__params.BundleType= input ;
__secure = true;
 __next = '4';
}
else {
 __next = '3';
}","3","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6444","1522","View Bundles","if (empty(BundleList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(BundleList)) {
               type = BundleList.get(tmp);
                __params.BundleId = type.bundleId;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Select Destination Bundle","<html>
<body>
Please select Destination bundle :<br>
$$BundleList = IC.queryBundleforInteroperability(__params);
$$if (empty(BundleList )) {
   You have no bundle to subscribe,please confirm your permission or input information.
$$} else {
  $$var i = 1;
  $$for(bundle: BundleList ) {
  ${i} ${bundle.bundleName}:${bundle.internalPrice} ${bundle.Currency} ${bundle.durationTimes} ${bundle.durationUnit}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6445","1522","View Bundles","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6446","1523","Query My Own Bundles","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'QueryOrgIdentityBundleDetails';
__params.Status = '06';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6447","1523","Query My Own Bundles","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
}
else
{
    __next = '1';
}
__next = '2';","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6448","1523","Query My Own Bundles","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
    __next = '3';
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6449","1523","Query My Own Bundles","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-3])$'))
{
__params.BundleType= input ;
__secure = true;
 __next = '4';
}
else {
 __next = '3';
}","3","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6450","1523","Query My Own Bundles","if (empty(BundleList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(BundleList)) {
               type = BundleList.get(tmp);
                __params.IdentityBundleId = type.identityBundleId;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Select Destination Bundle","<html>
<body>
Please select Destination bundle :<br>
$$BundleList = IC.queryIdentityBundleforInteroperability(__params);
$$if (empty(BundleList )) {
  No bundle you have subscribed,please confirm your permission or input information.
$$} else {
  $$var i = 1;
  $$for(bundle: BundleList ) {
  ${i} ${bundle.identityBundleId}:${bundle.bundleName} ${bundle.internalPrice} ${bundle.Currency}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6452","1523","Query My Own Bundles","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6456","1524","Create Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'CreateIdentityBankAccount';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;  

isMultiCurrency = Util.isMultiCurrency();
items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;
attrList = IC.queryBankCardAttr('1000');
attrIndex = 0;

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6458","1524","Create Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';
    __params.BankName = 'Others';
    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
        __params.BankName = item.defaultName;
    }

    if ( __params.BankId == '-1')
    {
   __params.FIAccountInfo = Util.buildMessage();
   __params.FIAccountInfo.InfoDetail = Util.buildMessageList(size(attrList));
    }

     bankList = IC.queryOrgBankList(__params.BankId);
    __next = '2';
} else {
  __next = '1';
}","1","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6459","1524","Create Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankList)) {
    bank = bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '3';
} else {
  __next = '2';
}","2","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6460","1524","Create Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.AccountName = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Account Name","<html>
<body>
Enter Account Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6461","1524","Create Bank Account","var input = __input.response;

if (!empty(input))
{
  __params.AccountNumber = input;
 
if(isMultiCurrency && _params.bankId != '-1') 
{
    currencys = IC.getAllCurrencyList();
    __next = '5';
}
if (size(attrList) > 0 && __params.BankId == '-1')
{
    __next = '6';
}
if (size(attrList) == 0 || __params.BankId != '-1') 
{
  __next = '7';
}
} else {
  __next = '4';
}","4","Enter Account Number","<html>
<body>
Enter Account Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6462","1524","Create Bank Account","var input = __input.response;
if (input == '1') {
  __next = '8';
} else if(input == '0') {
  __next = '1';
} else {
  __next = '7';
}","7","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${__params.BankName}<br>
Branch:${__params.BranchName}<br>
Account Name:${__params.AccountName}<br>
Account Number:${__params.AccountNumber}<br>
$$ if(isMultiCurrency) {
Currency:${__params.Currency}<br>
$$ }
$$ if(size(attrList) > 0 && __params.BankId == '-1') {
$$ for (detail:__params.FIAccountInfo.InfoDetail){
${detail.Key}:${detail.Value}<br>
$$ }
$$ }
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","6463","1524","Create Bank Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '9';
} else {
    __secure = true;
    __next = '8';
}","8","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","6464","1524","Create Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6466","1525","Set Default Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'SetIdentityBankAccount';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
bankAccountList = IC.queryBankAccountWithoutOrg('01', msisdn, '');
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6467","1525","Set Default Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccountList)) {
    bankAccount = bankAccountList.get(i);
    __params.BankCardId = bankAccount.bankCardId;

    __next = '2';
} else {
  __next = '1';
}","1","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankAccount:bankAccountList){
 ${index} ${bankAccount.accountName}/${bankAccount.accountNumber}(${bankAccount.Currency},${bankAccount.branchName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6468","1525","Set Default Bank Account","var input = __input.response;
if (input == '1') {
  __next = '3';
} else if(input == '0') {
  __next = '1';
} else {
  __next = '2';
}","2","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${bankAccount.bankName}<br>
Branch:${bankAccount.branchName}<br>
Account Name:${bankAccount.accountName}<br>
Account Number:${bankAccount.accountNumber}<br>
Currency:${bankAccount.Currency}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6469","1525","Set Default Bank Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6470","1525","Set Default Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6471","1526","Delete Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'DeleteIdentityBankAccount';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;  
bankAccountList = IC.queryBankAccountList('01', msisdn, '');
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6472","1526","Delete Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccountList)) {
    bankAccount = bankAccountList.get(i);
    __params.BankCardId = bankAccount.bankCardId;

    __next = '2';
} else {
  __next = '1';
}","1","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankAccount:bankAccountList){
 ${index} ${bankAccount.accountName}/${bankAccount.accountNumber}(${bankAccount.Currency},${bankAccount.branchName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6473","1526","Delete Bank Account","var input = __input.response;
if (input == '1') {
  __next = '3';
} else if(input == '0') {
  __next = '1';
} else {
  __next = '2';
}","2","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${bankAccount.bankName}<br>
Branch:${bankAccount.branchName}<br>
Account Name:${bankAccount.accountName}<br>
Account Number:${bankAccount.accountNumber}<br>
Currency:${bankAccount.Currency}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6474","1526","Delete Bank Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6475","1526","Delete Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6477","1527","Create Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'CreateIdentityBankAccount';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';   /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */

isMultiCurrency = Util.isMultiCurrency();
items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;
attrList = IC.queryBankCardAttr('5000');
attrIndex = 0;
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","6478","1527","Create Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';
    __params.BankName = 'Others';
    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
        __params.BankName = item.defaultName;
    }
    
    if ( __params.BankId == '-1')
    {
   __params.FIAccountInfo = Util.buildMessage();
   __params.FIAccountInfo.InfoDetail = Util.buildMessageList(size(attrList));
    }

     bankList = IC.queryOrgBankList(__params.BankId);

    __next = '3';
} else {
  __next = '2';
}","2","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6479","1527","Create Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankList)) {
   bank = bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '4';
} else {
  __next = '4';
}","3","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6480","1527","Create Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.AccountName = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Account Name","<html>
<body>
Enter Account Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6481","1527","Create Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.AccountNumber = input;
  if(isMultiCurrency && __params.BankId != '-1') {
    currencys = IC.getAllCurrencyList();
    __next = '6';
  } 
if (size(attrList) > 0 && __params.BankId == '-1')
{
    __next = '7';
}
if (size(attrList) == 0 || __params.BankId != '-1')
{
  __next = '8';
}
} else {
  __next = '5';
}","5","Enter Account Number","<html>
<body>
Enter Account Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6482","1527","Create Bank Account","var input = __input.response;
if (input == '1') {
  __next = '9';
} else if(input == '0') {
  __next = '2';
} else {
  __next = '8';
}","8","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${__params.BankName}<br>
Branch:${__params.BranchName}<br>
Account Name:${__params.AccountName}<br>
Account Number:${__params.AccountNumber}<br>
$$ if(isMultiCurrency) {
Currency:${__params.Currency}<br>
$$ }
$$ if(size(attrList) > 0 && __params.BankId == '-1') {
$$ for (detail:__params.FIAccountInfo.InfoDetail){
${detail.Key}:${detail.Value}<br>
$$ }
$$ }
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","6484","1527","Create Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  DEBUG.error('InitiatorIdentifier',__params.InitiatorIdentifier);
  __next = '10';
} else {
  __next = '9';
}","9","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","6485","1527","Create Bank Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '11';
} else {
    __secure = true;
    __next = '10';
}","10","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","6486","1527","Create Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","11","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6487","1528","Set Default Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'SetIdentityBankAccount';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';   /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","6488","1528","Set Default Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccountList)) {
    bankAccount = bankAccountList.get(i);
    __params.BankCardId = bankAccount.bankCardId;

    __next = '3';
} else {
  __next = '2';
}","2","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankAccount:bankAccountList){
 ${index} ${bankAccount.accountName}/${bankAccount.accountNumber}(${bankAccount.Currency},${bankAccount.branchName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6489","1528","Set Default Bank Account","var input = __input.response;
if (input == '1') {
  __next = '4';
} else if(input == '0') {
  __next = '2';
} else {
  __next = '3';
}","3","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${bankAccount.bankName}<br>
Branch:${bankAccount.branchName}<br>
Account Name:${bankAccount.accountName}<br>
Account Number:${bankAccount.accountNumber}<br>
Currency:${bankAccount.Currency}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6490","1528","Set Default Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6491","1528","Set Default Bank Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6492","1528","Set Default Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6493","1529","Delete Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'DeleteIdentityBankAccount';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';   /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","6494","1529","Delete Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccountList)) {
    bankAccount = bankAccountList.get(i);
    __params.BankCardId = bankAccount.bankCardId;

    __next = '3';
} else {
  __next = '2';
}","2","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankAccount:bankAccountList){
 ${index} ${bankAccount.accountName}/${bankAccount.accountNumber}(${bankAccount.Currency},${bankAccount.branchName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6495","1529","Delete Bank Account","var input = __input.response;
if (input == '1') {
  __next = '4';
} else if(input == '0') {
  __next = '2';
} else {
  __next = '3';
}","3","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${bankAccount.bankName}<br>
Branch:${bankAccount.branchName}<br>
Account Name:${bankAccount.accountName}<br>
Account Number:${bankAccount.accountNumber}<br>
Currency:${bankAccount.Currency}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6496","1529","Delete Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6497","1529","Delete Bank Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6498","1529","Delete Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6499","1511","Create Organization Bundle","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
__next = '3';
} else 
   {
      __next = '2';
   }","2","Enter Your Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6500","1522","View Bundles","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","6","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6501","1523","Query My Own Bundles","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","6","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6502","1530","Issue Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.IS_RESOLVE_RECEIVER_BY_INITIATOR = '1';  
__params.ReasonTypeCode = 'CustomerIssueVoucher';
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6503","1530","Issue Voucher","var input = __input.response;
if(!empty(input)){
__params.Msisdn = __input.response;
__next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the receiving Msisdn:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6504","1530","Issue Voucher","var input = __input.response;
__params.ShortCode = input;
__next = '3';","2","Input short Code","<html>
<body>
Please input the redeeming organization short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6505","1530","Issue Voucher","var input = __input.response;
if(!empty(input)){
__params.VoucherAmount = __input.response;
__next = '5';
}else{
    __next ='4';
}","4","Input amount","<html>
<body>
Please input the amount of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6506","1530","Issue Voucher","var input = __input.response;
__params.ValidityPeriod = input;
__next = '6';","5","Input validity period","<html>
<body>
Please input the validity period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6507","1530","Issue Voucher","var input = __input.response;
__params.Extra1 = input;
__next = '7';","6","Input description 1","<html>
<body>
Please input the description 1 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6508","1530","Issue Voucher","var input = __input.response;
__params.Extra2 = input;
__next = '8';","7","Input description 2","<html>
<body>
Please input the description 2 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","6509","1530","Issue Voucher","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '9';
}else{
    __next ='8';
}","8","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","6510","1530","Issue Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
You will issue a voucher to  ${__params.Msisdn},the amount is ${__params.VoucherAmount} ${__params.Currency},the Redeeming org short code is ${__params.ShortCode}<br>
1 Confirm<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6511","1531","Org Issue Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.IS_RESOLVE_RECEIVER_BY_INITIATOR = '1';  
__params.ReasonTypeCode = 'Org Issue Voucher';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6512","1531","Org Issue Voucher","var input = __input.response;
if(!empty(input)){
__params.Msisdn = __input.response;
__next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the receiving Msisdn:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6513","1531","Org Issue Voucher","var input = __input.response;
__params.ShortCode = input;
__next = '3';","2","Input short Code","<html>
<body>
Please input the redeeming organization short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6514","1531","Org Issue Voucher","var input = __input.response;
if(!empty(input)){
__params.VoucherAmount = __input.response;
__next = '5';
}else{
    __next ='4';
}","4","Input amount","<html>
<body>
Please input the amount of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6515","1531","Org Issue Voucher","var input = __input.response;
__params.ValidityPeriod = input;
__next = '6';","5","Input validity period","<html>
<body>
Please input the validity period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6516","1531","Org Issue Voucher","var input = __input.response;
__params.Extra1 = input;
__next = '7';","6","Input description 1","<html>
<body>
Please input the description 1 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6517","1531","Org Issue Voucher","var input = __input.response;
__params.Extra2 = input;
__next = '8';","7","Input description 2","<html>
<body>
Please input the description 2 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6518","1531","Org Issue Voucher","var input = __input.response;
if(!empty(input)){
__params.InitiatorIdentifier = input;
__secure = true;
__next = '9';
}else{
    __next ='8';
}","8","Input operator ID","<html>
<body>
Please input operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","6519","1531","Org Issue Voucher","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '10';
}else{
    __next ='9';
}","9","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","6520","1531","Org Issue Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
You will issue a voucher to  ${__params.Msisdn},the amount is ${__params.VoucherAmount}${__params.Currency},the Redeeming org short code is ${__params.ShortCode}<br>
1 Confirm<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","6521","1527","Create Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;

  __next = '2';
} else {
  __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","6522","1528","Set Default Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;
  bankAccountList = IC.queryBankAccountWithoutOrg('04', input, '');

  __next = '2';
} else {
  __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","6523","1529","Delete Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;
  bankAccountList = IC.queryBankAccountList('04', input, '');

  __next = '2';
} else {
  __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6524","1532","Apply OTC Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReasonTypeCode = 'Customer Apply OTC Voucher'; 
__secure = true;
__next = '2';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6525","1532","Apply OTC Voucher","var length = size(input);
if(length < __params.minLength  || length > __params.maxLength )
{
__params.info = 'The length of a secret code must be in the range of [' + __params.minLength + ',' + __params.maxLength + '], please enter secret code again!';
__next = '1';
}
else if(!empty(__params.rule) && input !~ __params.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __params.rule + ', please enter secret code again!';
__next = '1';
}
else
{
__params.VoucherSecretCode = input;
__next = '2';
}","1","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6526","1532","Apply OTC Voucher","if (empty(multiAccount)) {
 __next = '3';
  __params.ReceiverAccountNo= ''; 
} else {
    var input = __input.response;
    if (!empty(input)) {
 var tmp = Util.toInt(input) - 2;
 if(tmp >=0 && tmp < size(multiAccount)) {
 type = multiAccount.get(tmp);
 __params.ReceiverAccountNo= type.AccountNo;
  __secure = true;
  __next = '3';
} else if(tmp == -1) {
 __next = '3';
  __params.ReceiverAccountNo= '';
 } else {
  __next = '2';
  }
 } else {
  __next = '2';
  }
}","2","Select Account","<html>
<body>
Please select account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account','');
  $$var i = 1;
 ${i} select no account<br>
 $$for(type: multiAccount ) {
 ${i+1} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6527","1532","Apply OTC Voucher","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6528","1532","Apply OTC Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","4","Confirm","<html>
<body>
Confirm to requests buy goods voucher?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6531","1524","Create Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(currencys)) {
    __params.Currency = currencys.get(i);

    __next = '7';
} else {
  __next = '5';
}","5","Select Currency","<html>
<body>
Select Currency:<br>
$$ var index = 1;
$$ for (currency:currencys){
 ${index} ${currency}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6532","1527","Create Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(currencys)) {
    __params.Currency = currencys.get(i);
    __next = '8';
} else {
  __next = '6';
}","6","Select Currency","<html>
<body>
Select Currency:<br>
$$ var index = 1;
$$ for (currency:currencys){
 ${index} ${currency}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6534","1533","Airtime Purchase By OTC Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.RequesterIdentifierType = '03';
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","6535","1533","Airtime Purchase By OTC Voucher","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Requester Voucher Code","<html>
<body>
Enter Requester Voucher Code <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6536","1533","Airtime Purchase By OTC Voucher","var input = __input.response;
__params.FirstName= input;
__next = '3';","2","Enter First Name","<html>
<body>
Enter First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6537","1533","Airtime Purchase By OTC Voucher","var input = __input.response;
if (!empty(input)) {
__params.RechargedMSISDN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Recharged MSISDN","<html>
<body>
Enter Recharged MSISDN <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6538","1533","Airtime Purchase By OTC Voucher","__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
      __next = '5';
   } 
 else 
   {
      __next = '4';
   }","4","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6539","1533","Airtime Purchase By OTC Voucher","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Enter amount","<html>
<body>
Enter amount <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6540","1533","Airtime Purchase By OTC Voucher","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6541","1533","Airtime Purchase By OTC Voucher","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6542","1533","Airtime Purchase By OTC Voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","6543","1533","Airtime Purchase By OTC Voucher","var input = __input.response;
 __params.VoucherValidationValue = input;
 __next = '10';","9","Enter Additional validation information","<html>
<body>
Enter Additional validation information<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","6545","1533","Airtime Purchase By OTC Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html><body>Buy Airtime ${__params.RechargedMSISDN} ${__params.Amount}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6546","1534","Pay Bill By OTC Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
 __params.AccessDeviceIdentifierType = '01';   /* MSISDN */ 
 __params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
 __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
 __params.RequesterIdentifierType = '03';
__next = '1'","begin","Initialization","",""<endrec>
"TILL","0","4","6548","1534","Pay Bill By OTC Voucher","var input = __input.response;
var input = __input.response;
__params.FirstName= input;
__next = '3';","2","Enter First Name","<html>
<body>
Enter First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","0","5","6549","1534","Pay Bill By OTC Voucher","__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
      __next = '4';
   } 
 else 
   {
      __next = '3';
   }","3","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","0","6","6550","1534","Pay Bill By OTC Voucher","var input = __input.response;
__params.BillReferenceNumber = input;
__next = '5';","4","Enter Business No","<html>
<body>
Enter Business No.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","0","7","6551","1534","Pay Bill By OTC Voucher","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","0","8","6552","1534","Pay Bill By OTC Voucher","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","0","9","6553","1534","Pay Bill By OTC Voucher","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","0","10","6554","1534","Pay Bill By OTC Voucher","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","0","11","6555","1534","Pay Bill By OTC Voucher","var input = __input.response;
 __params.VoucherValidationValue = input;
 __next = '10';","9","Enter Additional validation information","<html>
<body>
Enter Additional validation information<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","0","12","6556","1534","Pay Bill By OTC Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Pay Bill - ${__params.BillReferenceNumber} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"TILL","","1","6557","1535","Organization online withdraw e-money from float to bank account via handset","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SP_ID */
__params.ReceiverPartyIdentifier = IC.getDefaultSpId();
orgInfo = IC.queryByMsisdn(msisdn);
shortCode = IC.queryShortCodeByTillId(orgInfo.identityId);
bankAccounts = IC.queryBankAccountList('04', shortCode, '1');
if (empty(bankAccounts ) || size(bankAccounts ) == 0) {
    __errormsg = 'Sorry, there is not any bank account.';
    __next = 'error';
 } 
else
{
     __next = '1';
}","begin","Initialization","",""<endrec>
"TILL","","2","6558","1535","Organization online withdraw e-money from float to bank account via handset","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6559","1535","Organization online withdraw e-money from float to bank account via handset","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccounts)) {
   __params.BankCardID= bankAccounts.get(i).bankCardId;
   __params.BankAccountName= bankAccounts.get(i).accountName + '/' + bankAccounts.get(i).accountNumber + '(' + bankAccounts.get(i).bankName  + ')';
   __params.Currency=bankAccounts.get(i).currency;
   __secure = true;
   __next = '3';
} else {
   __next = '2';
}","2","Select Bank Card ID","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6560","1535","Organization online withdraw e-money from float to bank account via handset","var input = __input.response;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';","3","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6561","1535","Organization online withdraw e-money from float to bank account via handset","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6562","1535","Organization online withdraw e-money from float to bank account via handset","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '5';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '6';
}","5","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6563","1535","Organization online withdraw e-money from float to bank account via handset","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Withdraw Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountName}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6564","1536","Customer online withdraw e-money from float to bank account via handset","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';   /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SP_ID */
__params.ReceiverPartyIdentifier = IC.getDefaultSpId();
bankAccounts = IC.queryBankAccountList(__params.InitiatorIdentifierType, __params.InitiatorIdentifier, '1');
if (empty(bankAccounts ) || size(bankAccounts ) == 0) {
    __errormsg = 'Sorry, there is not any bank account.';
    __next = 'error';
 } 
else
{
     __next = '1';
}","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6565","1536","Customer online withdraw e-money from float to bank account via handset","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6566","1536","Customer online withdraw e-money from float to bank account via handset","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccounts)) {
   __params.BankCardID= bankAccounts.get(i).bankCardId;
   __params.BankAccountName= bankAccounts.get(i).accountName + '/' + bankAccounts.get(i).accountNumber + '(' + bankAccounts.get(i).bankName  + ')';
   __params.Currency=bankAccounts.get(i).currency;
   __secure = true;
   __next = '3';
} else {
   __next = '2';
}","2","Select Bank Card ID","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6567","1536","Customer online withdraw e-money from float to bank account via handset","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6568","1536","Customer online withdraw e-money from float to bank account via handset","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6569","1536","Customer online withdraw e-money from float to bank account via handset","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Withdraw Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountName}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6571","1520","View Group Bundles","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '0';
}
}
if ( found == '1') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   __next = '2';
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6572","1520","View Group Bundles","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6573","1521","Query My Group Bundles","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '0';
}
}
if ( found == '1') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   __next = '2';
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6574","1521","Query My Group Bundles","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6575","1537","IMT Send Query Quote By OTC Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';
__params.RequesterIdentifierType = '03';
__params.TransactionCategory = 'IMT';
__params.TransactionSubCategory = 'IMT_HomeSend_AdviceOfCharge_Request';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","6576","1537","IMT Send Query Quote By OTC Voucher","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Sender Voucher Code","<html>
<body>
Enter Sender Voucher Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6577","1537","IMT Send Query Quote By OTC Voucher","var input = __input.response;
__params.ReferenceDataItem@LSB@KYC@RSB@@LSB@Personal@@SPACE@@Details@RSB@@LSB@First@@SPACE@@Name@RSB@ = input;
__next = '3';","2","Enter Sender First Name","<html>
<body>
Enter Sender First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6578","1537","IMT Send Query Quote By OTC Voucher","var input = __input.response;
if (Validator.isNonzeroAmount(input)) {
    __params.Amount = 0;
    __params.AdditionalDataItemPrinciple_Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6579","1537","IMT Send Query Quote By OTC Voucher","var input = __input.response;
if (empty(input)) { 
__next = '4';
} else {
__params.AdditionalDataItemRecipient@@SPACE@@MSISDN = input;
__next = '5';
}","4","Enter Receiver MSISDN","<html>
<body>
Enter Receiver MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6580","1537","IMT Send Query Quote By OTC Voucher","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name = input;
__next = '6';","5","Enter Receiver First Name","<html>
<body>
Enter First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6581","1537","IMT Send Query Quote By OTC Voucher","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name = input;
__next = '7';","6","Enter Receiver Last Name","<html>
<body>
Enter Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6582","1537","IMT Send Query Quote By OTC Voucher","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6583","1537","IMT Send Query Quote By OTC Voucher","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","6584","1537","IMT Send Query Quote By OTC Voucher","var input = __input.response;
 __params.VoucherValidationValue = input;
 __next = '10';","9","Enter Additional validation information","<html>
<body>
Enter Additional validation information<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","6585","1537","IMT Send Query Quote By OTC Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
REQUEST QUOTE FOR SENDING MONEY TO [${__params.AdditionalDataItemRecipient@@SPACE@@MSISDN}] [${__params.AdditionalDataItemPrinciple_Amount}]<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6586","1538","IMT Send By OTC Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';
__params.RequesterIdentifierType = '03';
__params.TransactionCategory = 'IMT';
__params.TransactionSubCategory = 'IMT_HomeSend_Remittance_Request';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","6587","1538","IMT Send By OTC Voucher","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Sender Voucher Code","<html>
<body>
Enter Sender Voucher Code <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6588","1538","IMT Send By OTC Voucher","var input = __input.response;
__params.ReferenceDataItem@LSB@KYC@RSB@@LSB@Personal@@SPACE@@Details@RSB@@LSB@First@@SPACE@@Name@RSB@ = input;
__next = '3';","2","Enter Sender First Name","<html>
<body>
Enter Sender First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6589","1538","IMT Send By OTC Voucher","var input = __input.response;
if (Validator.isNonzeroAmount(input)) {
    var amount = TC.convertAmountFormat(input);
    __params.Amount = amount;
    __params.AdditionalDataItemPrinciple_Amount = amount;
    __secure = true;
    __next = '4';
} else {
    __next = '3';
}","3","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6590","1538","IMT Send By OTC Voucher","var input = __input.response;
if (empty(input)) { 
__next = '4';
} else {
__params.AdditionalDataItemRecipient@@SPACE@@MSISDN = input;
__next = '5';
}","4","Enter Receiver MSISDN","<html>
<body>
Enter Receiver  MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6591","1538","IMT Send By OTC Voucher","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name = input;
__next = '6';","5","Enter Receiver First Name","<html>
<body>
Enter Receiver First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6592","1538","IMT Send By OTC Voucher","var input = __input.response;
__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name = input;
__next = '7';","6","Enter Receiver Last Name","<html>
<body>
Enter Receiver Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6593","1538","IMT Send By OTC Voucher","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6594","1538","IMT Send By OTC Voucher","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","6595","1538","IMT Send By OTC Voucher","var input = __input.response;
 __params.VoucherValidationValue = input;
 __next = '10';","9","Enter Additional validation information","<html>
<body>
Enter Additional validation information<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","6596","1538","IMT Send By OTC Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
SEND MONEY TO [${__params.AdditionalDataItemRecipient@@SPACE@@MSISDN}] [${__params.AdditionalDataItemRecipient@@SPACE@@First@@SPACE@@Name}] [${__params.AdditionalDataItemRecipient@@SPACE@@Last@@SPACE@@Name}] [${__params.AdditionalDataItemPrinciple_Amount}] <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6597","1550","Change Language","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverPartyIdentifierType= '01';
__params.ReceiverPartyIdentifier = msisdn;
__params.PrimaryIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6598","1550","Change Language","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(languages)) {
__phase = 0;
__locale = languages.get(i).toString();
__next = 'begin';
} else {
  __next = '1';
}","1","Please select language","<html>
<body>
Please select language:<br>
$$languages = IC.queryAllLanguages();
$$var i = 1;
$$for (lang: languages) {
  ${i} ${lang.getDisplayName(identity.locale)}<br>
  $$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6600","1551","Register","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDevice = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__params.CustomerType = 1002;
__params.ActionType = 'CreateCustomer';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6601","1551","Register","var input = __input.response;
__params.FirstName = input;
__next = '2';","1","Enter first name","<html>
<body>
Enter first name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6602","1551","Register","var input = __input.response;
__params.LastName = input;
__next = '3';","2","Enter last name","<html>
<body>
Enter last name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6603","1551","Register","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(languages)) {
  __params.@BODY@LanguageCode = languages.get(i).toString();
  __secure = true;
  __next = '5';
} else {
  __next = '4';
}","4","Please select language","<html>
<body>
select preferred language.<br>
$$languages = IC.queryAllLanguages();
$$var i = 1;
$$for (lang: languages) {
  ${i} ${lang.getDisplayName(identity.locale)}<br>
  $$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6604","1551","Register","var input = __input.response;
if (input == '1') {
  __params.KYCInfo = IC.buildCustomerInfo(__params);
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Register ${__params.FirstName} ${__params.LastName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6605","1552","Help","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifierValue = msisdn;
__params.ReceiverIdentifierType = '10'; /* SP_ID */
__params.ReceiverIdentifierValue = IC.getDefaultSpId();
__params.PrimaryIdentifierType = '04'; /* SHORT_CODE */
__params.VoucherTypeCode = 'Deposit Voucher';  
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6606","1552","Help","__next = 'end';","1","contact","<html>
<body>
Please contact the help desk on 10086.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6607","1539","Customer Online Cash In","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';   /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SP_ID */
__params.ReceiverPartyIdentifier = IC.getDefaultSpId();
bankAccounts = IC.queryBankAccountList(__params.InitiatorIdentifierType, __params.InitiatorIdentifier, '1');
if (empty(bankAccounts ) || size(bankAccounts ) == 0) {
    __errormsg = 'Sorry, there is not any bank account.';
    __next = 'error';
 } 
else
{
     __next = '1';
}","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6608","1539","Customer Online Cash In","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6609","1539","Customer Online Cash In","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccounts)) {
   __params.BankCardID= bankAccounts.get(i).bankCardId;
   __params.BankAccountName= bankAccounts.get(i).accountName + '/' + bankAccounts.get(i).accountNumber + '(' + bankAccounts.get(i).bankName  + ')';
   __params.Currency=bankAccounts.get(i).currency;
   __secure = true;
   __next = '3';
} else {
   __next = '2';
}","2","Select Bank Card ID","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6610","1539","Customer Online Cash In","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6611","1539","Customer Online Cash In","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6612","1539","Customer Online Cash In","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Cash In Amount : ${__params.Amount}<br>
Bank Account: ${__params.BankAccountName}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6613","1540","Organization Online Cash In","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SP_ID */
__params.ReceiverPartyIdentifier = IC.getDefaultSpId();
orgInfo = IC.queryByMsisdn(msisdn);
shortCode = IC.queryShortCodeByTillId(orgInfo.identityId);
bankAccounts = IC.queryBankAccountList('04', shortCode, '1');
if (empty(bankAccounts ) || size(bankAccounts ) == 0) {
    __errormsg = 'Sorry, there is not any bank account.';
    __next = 'error';
 } 
else
{
     __next = '1';
}","begin","Initialization","",""<endrec>
"TILL","","2","6614","1540","Organization Online Cash In","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6615","1540","Organization Online Cash In","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccounts)) {
   __params.BankCardID= bankAccounts.get(i).bankCardId;
   __params.BankAccountName= bankAccounts.get(i).accountName + '/' + bankAccounts.get(i).accountNumber + '(' + bankAccounts.get(i).bankName  + ')';
   __params.Currency=bankAccounts.get(i).currency;
   __secure = true;
   __next = '3';
} else {
   __next = '2';
}","2","Select Bank Card ID","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6616","1540","Organization Online Cash In","var input = __input.response;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';","3","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6617","1540","Organization Online Cash In","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6618","1540","Organization Online Cash In","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '5';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '6';
}","5","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6619","1540","Organization Online Cash In","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Cash In Amount : ${__params.Amount}<br>
Bank Account: ${__params.BankAccountName}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6623","1541","Redeem Issued Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6624","1541","Redeem Issued Voucher","var input = __input.response;
if(!empty(input)){
__params.ReceiverPartyIdentifier = input;
__next = '2';
}else{
    __next ='1';
}","1","Input Voucher Code","<html>
<body>
Please input the voucher code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6625","1541","Redeem Issued Voucher","var input = __input.response;
 __params.VoucherValidationValue = input;
 __next = '4';","2","Input Msisdn","<html>
<body>
Input Additional validation information:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6626","1541","Redeem Issued Voucher","var input = __input.response;
__params.Amount = input;
__next = '5';","4","Input Amount","<html>
<body>
Please input the redeeming amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6627","1541","Redeem Issued Voucher","var input = __input.response;
if(!empty(input)){
__params.InitiatorIdentifier = input;
__secure = true;
__next = '6';
}else{
    __next ='5';
}","5","Input Operator ID","<html>
<body>
Please input the operator id:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6628","1541","Redeem Issued Voucher","var input = __input.response;
__params.PIN = input;
__next = '7';","6","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6629","1541","Redeem Issued Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","8","Confirm","<html>
<body>You will redeem a voucher,the amount is ${__params.Amount}${__params.Currency}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6631","1542","Issue Coupon","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.IS_RESOLVE_RECEIVER_BY_INITIATOR = '1';  
__params.ReasonTypeCode = 'Org Coupon Voucher';
  
var secretCodeRule = TC.getSecretCodeRule();
__params.minLength = secretCodeRule.getMinLength();
__params.maxLength = secretCodeRule.getMaxLength();
__params.rule = secretCodeRule.getRule();
__params.info = 'Please input Voucher Reference Code:';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","6633","1542","Issue Coupon","var input = __input.response;
if(!empty(input)){
__params.Msisdn= __input.response;
__next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the receiving Msisdn:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6634","1542","Issue Coupon","var input = __input.response;
__params.ShortCode = input;
__next = '3';","2","Input short Code","<html>
<body>
Please input the redeeming organization short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6635","1542","Issue Coupon","var input = __input.response;
__params.ValidityPeriod = input;
__next = '4';","3","Input validity period","<html>
<body>
Please input the validity period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6637","1542","Issue Coupon","var input = __input.response;
__params.Extra1 = input;
__next = '5';","4","Input description 1","<html>
<body>
Please input the description 1 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6638","1542","Issue Coupon","var input = __input.response;
__params.Extra2 = input;
__next = '6';","5","Input description 2","<html>
<body>
Please input the description 2 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6639","1542","Issue Coupon","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '8';
}else{
    __next ='7';
}","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","6642","1542","Issue Coupon","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
You will issue a coupon to  ${__params.Msisdn}, the Redeeming org short code is ${__params.ShortCode}<br>
1 Confirm<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6643","1542","Issue Coupon","var input = __input.response;
if(!empty(input)){
__params.InitiatorIdentifier = input;
__secure = true;
__next = '7';
}else{
    __next ='6';
}","6","Input operator ID","<html>
<body>
Please input operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6645","1543","Cancel Issued Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.VoucherTypeAlias = 'IssuerVoucher';
__params.ActionType = 'CancelIssuedVoucher';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6646","1543","Cancel Issued Voucher","var input = __input.response;
if(!empty(input)){
 __params.Msisdn = input;
 __next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the Msisdn of the voucher holder:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6647","1543","Cancel Issued Voucher","var input = __input.response;
if(!empty(input)){
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';
}else{
    __next ='2';
}","2","Input Operator ID","<html>
<body>
Please input the operator id:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6648","1543","Cancel Issued Voucher","var input = __input.response;
if(!empty(input)){
__params.@HEAD@PIN = input;
__next = '4';
}else{
    __next ='3';
}","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6649","1543","Cancel Issued Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel all active voucher hold by ${__params.Msisdn} which is issued by yourself.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6650","1544","Redeem Coupon","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';
__params.ReceiverPartyIdentifierType = '03';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6651","1544","Redeem Coupon","var input = __input.response;
if(!empty(input)){
__params.ReceiverPartyIdentifier = input;
__next = '2';
}else{
    __next ='1';
}","1","Input Voucher Code","<html>
<body>
Please input the voucher code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6652","1544","Redeem Coupon","var input = __input.response;
__params.VoucherValidationValue = input;
__params.Msisdn= input;
 __next = '3';","2","Input Validation","<html>
<body>
Input Voucher Holder MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6653","1544","Redeem Coupon","var input = __input.response;
if(!empty(input)){
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';
}else{
    __next ='3';
}","3","Input Operator ID","<html>
<body>
Please input the operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6654","1544","Redeem Coupon","var input = __input.response;
__params.PIN = input;
__next = '6';","4","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6655","1544","Redeem Coupon","var input = __input.response;
__params.VoucherSecretCode = input;
__next = '6';","5","Inpute Secret Code","<html>
<body>
Input Voucher Reference Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6656","1544","Redeem Coupon","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>You will redeem a coupon hold by ${__params.Msisdn}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6657","1553","Cancel Coupon","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.VoucherTypeAlias = 'CouponsVoucher';
__params.ActionType = 'CancelIssuedVoucher';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6658","1553","Cancel Coupon","var input = __input.response;
if(!empty(input)){
 __params.Msisdn = input;
 __next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the Msisdn of the voucher holder:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6659","1553","Cancel Coupon","var input = __input.response;
if(!empty(input)){
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';
}else{
    __next ='2';
}","2","Input Operator ID","<html>
<body>
Please input the operator id:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6660","1553","Cancel Coupon","var input = __input.response;
if(!empty(input)){
__params.@HEAD@PIN = input;
__next = '4';
}else{
    __next ='3';
}","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6661","1553","Cancel Coupon","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel all active voucher hold by ${__params.Msisdn} which is issued by yourself.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6662","1551","Register","var input = __input.response;
if (Validator.isDate(input, 'ddMMyyyy')) {
 __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
 __next = '4';
} else {
 __next = '3';
}","3","Enter Date of Birth","<html>
<body>
Enter Date of Birth<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6664","1554","Apply Ticket Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReasonTypeCode = 'Aplply Buy Ticket Voucher';  
__secure = true;
if(TC.isSupportSecretCode(__params.ReasonTypeCode))
{
var secretCodeRule = TC.getSecretCodeRule();
__params.minLength = secretCodeRule.getMinLength();
__params.maxLength = secretCodeRule.getMaxLength();
__params.rule = secretCodeRule.getRule();
__params.info = 'Enter a secret code:';
__next = '1';
}
else
{
__next = '2';
}","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6665","1554","Apply Ticket Voucher","var input = __input.response;
var length = size(input);
if(length < __params.minLength  || length > __params.maxLength )
{
__params.info = 'The length of a secret code must be in the range of [' + __params.minLength + ',  ' + __params.maxLength + '], please enter secret code again!';
__next = '1';
}
else if(!empty(__params.rule) && input !~ __params.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __params.rule + ', please enter secret code again!';
__next = '1';
}
else
{
__params.VoucherSecretCode = input;
__next = '2';
}","1","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6666","1554","Apply Ticket Voucher","var input = __input.response;
__params.PIN = input;
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6667","1554","Apply Ticket Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '2') {
  __next = 'cancel';
} else {
  __next = '2';
}","3","Confirm","<html>
<body>
Confirm to Apply Ticket Voucher?<br>
1 OK<br>
2 Quit<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6668","1545","Buy Ticket Using Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__params.ReasonTypeCode = 'Buy Ticket Using Voucher';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6669","1545","Buy Ticket Using Voucher","var input = __input.response;
if(!empty(input)){
__params.ReceiverPartyIdentifier = input;
__next = '2';
}else{
    __next ='1';
}","1","Input Voucher Code","<html>
<body>
Please input the voucher code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6670","1545","Buy Ticket Using Voucher","var input = __input.response;
 __params.VoucherValidationValue = input;
 __next = '3';","2","Input Msisdn","<html>
<body>
Input Additional validation information:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6671","1545","Buy Ticket Using Voucher","var input = __input.response;
__params.Amount = input;
__next = '4';","3","Input Amount","<html>
<body>
Please input the amount of the ticket:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6673","1545","Buy Ticket Using Voucher","var input = __input.response;
__params.ValidityPeriod = input;
__next = '5';","4","Input validity period","<html>
<body>
Please input the validity period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6674","1545","Buy Ticket Using Voucher","var input = __input.response;
__params.Extra1 = input;
__next = '6';","5","Input description 1","<html>
<body>
Please input the description 1 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6675","1545","Buy Ticket Using Voucher","var input = __input.response;
__params.Extra2 = input;
__next = '7';","6","Input description 2","<html>
<body>
Please input the description 2 of the voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6676","1545","Buy Ticket Using Voucher","var input = __input.response;
if(!empty(input)){
__params.InitiatorIdentifier = input;
__secure = true;
__next = '8';
}else{
    __next ='7';
}","7","Input operator ID","<html>
<body>
Please input operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6677","1545","Buy Ticket Using Voucher","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '9';
}else{
    __next ='8';
}","8","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","6678","1545","Buy Ticket Using Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
You will issue a ticket voucher,the amount is ${__params.Amount}<br>
1 Confirm<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6680","1555","Redeem Ticket Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__params.ReasonTypeCode = 'Redeem Coupon Voucher for Org';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6681","1555","Redeem Ticket Voucher","var input = __input.response;
if(!empty(input)){
__params.ReceiverPartyIdentifier = input;
__next = '2';
}else{
    __next ='1';
}","1","Input Voucher Code","<html>
<body>
Please input the voucher code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6682","1555","Redeem Ticket Voucher","var input = __input.response;
 __params.VoucherValidationValue = input;
 __next = '3';","2","Input Msisdn","<html>
<body>
Input Additional validation information:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6683","1555","Redeem Ticket Voucher","var input = __input.response;
if(!empty(input)){
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';
}else{
    __next ='3';
}","3","Input Operator ID","<html>
<body>
Please input the operator id:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6684","1555","Redeem Ticket Voucher","var input = __input.response;
__params.PIN = input;
__next = '5';","4","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6685","1555","Redeem Ticket Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>You will redeem a voucher hold by ${__params.VoucherValidationValue}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6686","1556","Cancel Ticket Voucher","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.VoucherTypeAlias = 'TicketVoucher';
__params.ActionType = 'CancelIssuedVoucher';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6687","1556","Cancel Ticket Voucher","var input = __input.response;
if(!empty(input)){
 __params.Msisdn = input;
 __next = '2';
}else{
    __next ='1';
}","1","Input Msisdn","<html>
<body>
Please input the Msisdn of the voucher holder:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6688","1556","Cancel Ticket Voucher","var input = __input.response;
if(!empty(input)){
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';
}else{
    __next ='2';
}","2","Input Operator ID","<html>
<body>
Please input the operator id:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6689","1556","Cancel Ticket Voucher","var input = __input.response;
if(!empty(input)){
__params.@HEAD@PIN = input;
__next = '4';
}else{
    __next ='3';
}","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6690","1556","Cancel Ticket Voucher","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel all active ticket voucher hold by ${__params.Msisdn} which is issued by yourself.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6695","1399","Group ATM Withdraw Voucher","var input = __input.response;
__params.Remark = input;
__next = '5';","4","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6696","1557","Customer Transfer from Bank to M-Pesa","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';   /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.BankCardOwnerInputType = '01';   /* MSISDN */
__params.BankCardOwnerInputValue = msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.TransactionCategory = 'Bank_Card_Service';
__params.TransactionSubCategory = '0';
__params.QueryIdentifierType = '01';   /* MSISDN */
__params.QueryIdentifierValue = msisdn;
fiOrgList = IC.queryFiOrgList(__params);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6697","1557","Customer Transfer from Bank to M-Pesa","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(fiOrgList)) {
   __params.ShortCode= fiOrgList.get(i).shortCode;
   __params.PrimaryPartyIdentifier= __params.ShortCode;
   __params.FIOrgIdentityId= fiOrgList.get(i).identityId;
   __next = '2';
} else {
   __next = '1';
}","1","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6698","1557","Customer Transfer from Bank to M-Pesa","var input = __input.response;
if (input == '1') {
  bankAccounts = IC.queryBankAccListByIdenAndBank(__params);
  __next = '3';
} else if (input == '2') {
  __next = '4';
}","2","Select or Enter Bank Account","<html>
<body>
1 Select form list <br>
2 Enter bank card <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6699","1557","Customer Transfer from Bank to M-Pesa","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccounts)) {
   __params.BankCardId = bankAccounts.get(i).bankCardId;
   __secure = true;
   __next = '5';
} else {
   __next = '3';
}","3","Select Bank Account","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6700","1557","Customer Transfer from Bank to M-Pesa","__params.BankAccountNo = __input.response;
__secure = true;
bankCardAttrList= IC.queryBankCardAttr(__params,'1000');
bankCardAttrLisSize = size(bankCardAttrList);
__params.FIAccountInfo = Util.buildMessage();
__params.FIAccountInfo.InfoDetail = Util.buildMessageList(bankCardAttrLisSize);
bankCardAttrListIndex = 1;
if (bankCardAttrLisSize > 0)
{
  __next = '4a';
}
else
{
__next = '5';
}","4","Enter Bank Account","<html>
<body>
Enter Bank Account<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6701","1557","Customer Transfer from Bank to M-Pesa","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '7';","6","Enter Receiver","<html>
<body>
Enter Receiver ${identifierTypeName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","6702","1557","Customer Transfer from Bank to M-Pesa","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '8';
} else {
    __next = '7';
}","7","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","6703","1557","Customer Transfer from Bank to M-Pesa","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","6704","1557","Customer Transfer from Bank to M-Pesa","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '9';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '10';
}","9","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","6705","1557","Customer Transfer from Bank to M-Pesa","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Deposit Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountNo}${__params.BankCardId}<br>
Reciever : ${__params.ReceiverPartyIdentifier}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6708","1558","Create Direct Debit Mandate by Payee","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CreateDirectDebitMandateByPayee';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '05';
__next = '0';","begin","Initialization","",""<endrec>
"TILL","","2","6710","1558","Create Direct Debit Mandate by Payee","var input = __input.response;
if (input == '1' )
{
  __params.IdentifierType = '01'; 
 __next = '1';
}else if ( input == '2')
{
  __params.IdentifierType = '04'; 
 __next = '1';
}else if (input == '3')
{
  __params.IdentifierType = '15';
 __next = '1';
} else {
   __next = '0';
}","0","Select Option","<html>
<body>
Please select Payer Identifier Type: <br>
1 Customer<br>
2 Organization<br>
3 Group
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6711","1558","Create Direct Debit Mandate by Payee","var input = __input.response;
if (!empty(input)) {
  __params.Identifier= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Payer ID","<html>
<body>
Enter  Payer  ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6712","1558","Create Direct Debit Mandate by Payee","var input = __input.response;
var length = size(input);
if (!empty(input) && length < 64) {
  __params.PayerReferenceNumber = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Payer Unique Reference number","<html>
<body>
Enter Payer Unique Reference number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6713","1558","Create Direct Debit Mandate by Payee","__params.AgreedTC = '1';
__next = '4';","3","Agreed TC","<html>
<body>
Please Confirm you have Agreed Terms and Conditions <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6714","1558","Create Direct Debit Mandate by Payee","var input = __input.response;
var length = size(input);
if(empty(input))
{
__next = '5';
}else if (length < 64) {
__params.PayeeAccountName= input;
__next = '5';
} else {
  __next = '4';
}","4","Enter Payee Account Instance","<html>
<body>
Enter Payee Account Instance <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6715","1558","Create Direct Debit Mandate by Payee","var input = __input.response;
if(empty(input))
{
__next = '6';
}else if (Validator.isMatchRegex(input,'^(0[1-7])$')) {
  __params.Frequency = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter Frequency","<html>
<body>
Enter Frequency <br>
01 One Off  <br>
02 Daily  <br>
03 Weekly  <br>
04 Monthly  <br>
05 Quarterly  <br>
06  Half Yearly  <br>
07  Yearly
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6716","1558","Create Direct Debit Mandate by Payee","var input = __input.response;
if (!empty(input) && !Validator.isDate(input, 'ddMMyyyy')){
__next = '6';
} else {
 __params.FirstPaymentDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '7';
}","6","Enter First Payment Date","<html>
<body>
Enter First Payment Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6717","1558","Create Direct Debit Mandate by Payee","var input = __input.response;
if(empty(input) ) 
{
  __next = '8';
}
else if(Validator.isMatchRegex(input ,'^([1-9]|[1-2]\d|3[0-1])$'))
{
   __next = '8';
__params.StartRangeOfDays = input;

}else
{
    __next = '7';
}","7","Enter Start of Range of days","<html>
<body>
Enter Start of Range of days <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","6718","1558","Create Direct Debit Mandate by Payee","var input = __input.response;
if(empty(input) ) 
{
  __next = '9';
}
else if(Validator.isMatchRegex(input ,'^([1-9]|[1-2]\d|3[0-1])$'))
{
   __next = '9';
__params.EndRangeOfDays = input;

}else
{
    __next = '8';
}","8","Enter End of Range of days","<html>
<body>
Enter End of Range of days <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","6719","1558","Create Direct Debit Mandate by Payee","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
__params.ReceiverPartyIdentifier = input;
  __next = '11';
} else {
  __next = '10';
}","10","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","6720","1558","Create Direct Debit Mandate by Payee","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
    __next = '12';
} else {
    __secure = true;
    __next = '11';
}","11","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","0","14","6721","1558","Create Direct Debit Mandate by Payee","var input = __input.response;
__params.Payer = IC.buildDirectDebitPayerInfo(__params);
__params.DirectDebitMandateInfo = IC.buildDirectDebitMandateInfo(__params);

if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","12","Confirm","<html>
<body>
Create Direct Debit Mandate<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>","0"<endrec>
"CUSTOMER","","1","6722","1559","Customer Activate Direct Debit Mandate","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType= '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier= msisdn;
__params.ActionType = 'ActivateCustomerDirectDebitMandate';
__params.MandateStatus = '02';
mandateList = IC.queryDirectDebitMandateByPayer(__params);
if(empty(mandateList )|| size(mandateList )==0){
 __errormsg = 'No Available Mandates.';
_next = 'error';
}else {
 __next = '1';
}
__next = '1'","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6723","1559","Customer Activate Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__next = '2';
} else {
__next = '1';
}","1","Enter Mandate ID","<html>
<body>
Select Mandate ID<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6724","1559","Customer Activate Direct Debit Mandate","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-1])$'))
{
__params.AgreedTC= input ;
 __next = '3';
}
else {
 __next = '2';
}","2","Select AgreedTC","<html>
<body>
Select Agreed Terms and Conditions<br>
0 No<br>
1 Yes<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6725","1559","Customer Activate Direct Debit Mandate","var input = __input.response;
var length = size(input);
if(empty(input))
{
__next = '4';
}else if (length < 64) {
 __params.PayerAccountName = input;
__next = '4';
} else {
  __next = '3';
}","3","Enter Payer Account Name","<html>
<body>Enter Payer Account Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6726","1559","Customer Activate Direct Debit Mandate","var input = __input.response;
if (!empty(input) ) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6727","1559","Customer Activate Direct Debit Mandate","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '5';
}","5","Confirm","<html>
<body>
Confirm to Activate Direct Debit Mandate?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6729","1560","Group Activate Direct Debit Mandate","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
__params.ActionType = 'ActivateGroupDirectDebitMandate';
groups = IC.queryMyGroups(msisdn);
__params.MandateStatus = '02';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6730","1560","Group Activate Direct Debit Mandate","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '0';
}
}
if ( found == '1') {
   __errormsg = 'no current group or not belong to the group.';
   __next = 'error';
}
else
{
  mandateList = IC.queryDirectDebitMandateByPayer(__params);
  if(empty(mandateList )|| size(mandateList )==0){
   __errormsg = 'No Available Mandates.';
   __next= 'error';
  }else {
  __next = '2';
  }
}
}
 else {
      __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6731","1560","Group Activate Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__next = '3';
} else {
__next = '2';
}","2","Enter Mandate ID","<html>
<body>
Select Mandate ID<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index}  ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6732","1560","Group Activate Direct Debit Mandate","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-1])$'))
{
__params.AgreedTC= input ;
 __next = '4';
}
else {
 __next = '3';
}","3","Select AgreedTC","<html>
<body>
Select Agreed Terms and Conditions<br>
0 No<br>
1 Yes<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6733","1560","Group Activate Direct Debit Mandate","var input = __input.response;
var length = size(input);
if(empty(input))
{
__next = '5';
}else if (length < 64) {
 __params.PayerAccountName = input;
__next = '5';
} else {
  __next = '4';
}","4","Enter Payer Account Name","<html>
<body>Enter Payer Account Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6734","1560","Group Activate Direct Debit Mandate","var input = __input.response;
if (!empty(input) ) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else { 
    __next = '5';
}","5","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html",""<endrec>
"CUSTOMER","","7","6735","1560","Group Activate Direct Debit Mandate","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '6';
}","6","Confirm","<html>
<body>
Confirm to Activate Direct Debit Mandate?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6738","1561","Organization Activate Direct Debit Mandate","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType= '05';
__params.ActionType = 'ActivateOrganizationDirectDebitMandate';
__params.MandateStatus = '02';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","6739","1561","Organization Activate Direct Debit Mandate","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '1';
} else {
    __params.InitiatorIdentifier = input;
 __params.ReceiverPartyIdentifier= input;
 __secure = true;
   mandateList = IC.queryDirectDebitMandateByPayer(__params);
if(empty(mandateList )|| size(mandateList )==0){
 __errormsg = 'No Available Mandates.';
_next = 'error';
}else {
  __next = '2';
}  
}","1","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6740","1561","Organization Activate Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__next = '3';
} else {
__next = '2';
}","2","Enter Mandate ID","<html>
<body>
Select Mandate ID<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6741","1561","Organization Activate Direct Debit Mandate","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-1])$'))
{
__params.AgreedTC= input ;
 __next = '4';
}
else {
 __next = '3';
}","3","Select AgreedTC","<html>
<body>
Select Agreed Terms and Conditions<br>
0 No<br>
1 Yes<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6742","1561","Organization Activate Direct Debit Mandate","var input = __input.response;
var length = size(input);
if(empty(input))
{
__next = '5';
}else if (length < 64) {
 __params.PayerAccountName = input;
__next = '5';
} else {
  __next = '4';
}","4","Enter Payer Account Name","<html>
<body>Enter Payer Account Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6743","1561","Organization Activate Direct Debit Mandate","var input = __input.response;
if (!empty(input) ) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6747","1561","Organization Activate Direct Debit Mandate","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '6';
}","6","Confirm","<html>
<body>
Confirm to Activate Direct Debit Mandate?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6748","1562","View Direct Debit Mandate","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = msisdn;
__params.ActionType= 'ViewDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.MandateStatus = '03';
mandateList = IC.queryDirectDebitMandateByPayer(__params);
if(empty(mandateList )|| size(mandateList )==0){
 __errormsg = 'No Available Mandates.';
__next = 'error';
}else {
 __next = '1';
}","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6749","1562","View Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__params.PayeeName =  mandateList.get(i).payeeName;
__next = '2';
} else {
__next = '1';
}","1","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6750","1562","View Direct Debit Mandate","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6751","1562","View Direct Debit Mandate","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '3';
}","3","Comfirm","<html>
<body>
 Direct Debit Mandate  - ${__params.PayeeName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6752","1557","Customer Transfer from Bank to M-Pesa","var input = __input.response;
if (bankCardAttrListIndex <= bankCardAttrLisSize){
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Key = bankCardAttrList.get(bankCardAttrListIndex-1).attrName;
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Value = input;
  bankCardAttrListIndex=bankCardAttrListIndex+1;
}
if(bankCardAttrLisSize < bankCardAttrListIndex){
  __next = '5';
}else{
  __next = '4a';
}","4a","Enter Bank Card Attr","<html>
<body>
Enter ${bankCardAttrList.get(bankCardAttrListIndex-1).attrName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6753","1563","Create Direct Debit Mandate by Customer","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatingDeviceType = '01';   /* MSISDN */
__params.InitiatingDeviceValue = msisdn;
__params.InitiatorIdentifierType= '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverPartyIdentifierType = '01'; 
__params.ReceiverPartyIdentifier = msisdn;
__params.ActionType = 'CreateDirectDebitMandateByCustomer';
__next = '1'","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6754","1563","Create Direct Debit Mandate by Customer","var input = __input.response;
if (!empty(input)) {
  __params.Identifier= input;
__params.IdentifierType = '04'; 
  __next = '2';
} else {
  __next = '1';
}","1","Enter Payee ID","<html>
<body>
Enter  Payee  ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6755","1563","Create Direct Debit Mandate by Customer","var input = __input.response;
var length = size(input);
if (!empty(input) && length < 64) {
  __params.PayerReferenceNumber = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Payer Unique Reference number","<html>
<body>
Enter Payer Unique Reference number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6756","1563","Create Direct Debit Mandate by Customer","__params.AgreedTC = '1';
__next = '5';","3","Agreed TC","<html>
<body>
Please Confirm you have Agreed Terms and Conditions <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6757","1563","Create Direct Debit Mandate by Customer","var input = __input.response;
var length = size(input);
if(empty(input))
{
__next = '5';
}else if (length < 64) {
  __params.PayerAccountName= input;
__next = '5';
} else {
  __next = '4';
}","4","Enter Payer Account Instance","<html>
<body>
Enter Payer Account Instance <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6758","1563","Create Direct Debit Mandate by Customer","var input = __input.response;
if(empty(input))
{
__next = '6';
}else if (Validator.isMatchRegex(input,'^(0[1-7])$')) {
__params.Frequency = input;
__next = '6';
} else {
__next = '5';
}","5","Enter Frequency","<html>
<body>
Enter Frequency <br>
01 One Off  <br>
02 Daily  <br>
03 Weekly  <br>
04 Monthly  <br>
05 Quarterly  <br>
06  Half Yearly  <br>
07  Yearly
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html",""<endrec>
"CUSTOMER","","7","6759","1563","Create Direct Debit Mandate by Customer","var input = __input.response;
if (!empty(input) && !Validator.isDate(input, 'ddMMyyyy')){
__next = '6';
} else {
 __params.FirstPaymentDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '7';
}","6","Enter First Payment Date","<html>
<body>
Enter First Payment Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6760","1563","Create Direct Debit Mandate by Customer","var input = __input.response;
if(empty(input) ) 
{
  __next = '8';
}
else if(Validator.isMatchRegex(input ,'^([1-9]|[1-2]\d|3[0-1])$'))
{
   __next = '8';
__params.StartRangeOfDays = input;

}else
{
    __next = '7';
}","7","Enter Start of Range of days","<html>
<body>
Enter Start of Range of days <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html",""<endrec>
"CUSTOMER","","9","6761","1563","Create Direct Debit Mandate by Customer","var input = __input.response;
if(empty(input) ) 
{
  __next = '9';
}
else if(Validator.isMatchRegex(input ,'^([1-9]|[1-2]\d|3[0-1])$'))
{
   __next = '9';
__params.EndRangeOfDays = input;

}else
{
    __next = '8';
}","8","Enter End of Range of days","<html>
<body>
Enter End of Range of days <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","6762","1563","Create Direct Debit Mandate by Customer","var input = __input.response;
if (!empty(input) ) {
 __params.@HEAD@PIN = input;
    __next = '11';
} else {
    __secure = true;
    __next = '10';
}","10","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","6763","1563","Create Direct Debit Mandate by Customer","var input = __input.response;
__params.Payee = IC.buildDirectDebitPayerInfo(__params);
__params.DirectDebitMandateInfo = IC.buildDirectDebitMandateInfo(__params);
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '10';
}","11","Confirm","<html>
<body>
Confirm to Create Direct Debit Mandate?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6766","1564","Group Transfer from Bank to M-Pesa","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';   /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.BankCardOwnerInputType = '15';   /* GROUP_CODE*/
__params.RequesterIdentifierType = '01';   /* MSISDN */
__params.RequesterIdentifier =  msisdn;
__params.PrimaryPartyIdentifierType= '04';
__params.TransactionCategory = 'Bank_Card_Service';
__params.TransactionSubCategory = '0';
fiOrgList = IC.queryFiOrgList(__params);
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6767","1564","Group Transfer from Bank to M-Pesa","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '3';
    }
} else {
   __next = '1';
}","1","Select Option For Group","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6768","1564","Group Transfer from Bank to M-Pesa","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.BankCardOwnerInputValue = input;
     __next = '4';     
   } 
else{
    __next = '2';
}","2","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6769","1564","Group Transfer from Bank to M-Pesa","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.BankCardOwnerInputValue = groupCode;
  __next = '4';
} 
else{
  __next = '3';
}","3","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6770","1564","Group Transfer from Bank to M-Pesa","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(fiOrgList)) {
   __params.ShortCode= fiOrgList.get(i).shortCode;
   __params.PrimaryPartyIdentifier= __params.ShortCode;
   __params.FIOrgIdentityId= fiOrgList.get(i).identityId;
   __next = '5';
} else {
   __next = '4';
}","4","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6771","1564","Group Transfer from Bank to M-Pesa","var input = __input.response;
if (input == '1') {
  __params.QueryIdentifierType = __params.BankCardOwnerInputType;
  __params.QueryIdentifierValue = __params.BankCardOwnerInputValue;
  bankAccounts = IC.queryBankAccListByIdenAndBank(__params);
  __next = '6';
} else if (input == '2') {
  __next = '7';
}else{
  __next = '5';
}","5","Select or Enter Bank Account","<html>
<body>
1 Select form list <br>
2 Enter bank card <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6772","1564","Group Transfer from Bank to M-Pesa","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccounts)) {
   __params.BankCardId = bankAccounts.get(i).bankCardId;
   __secure = true;
   __next = '9';
} else {
   __next = '6';
}","6","Select Bank Account","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","6773","1564","Group Transfer from Bank to M-Pesa","var input = __input.response;
if (bankCardAttrListIndex <= bankCardAttrLisSize){
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Key = bankCardAttrList.get(bankCardAttrListIndex-1).attrName;
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Value = input;
  bankCardAttrListIndex=bankCardAttrListIndex+1;
}
if(bankCardAttrListIndex > bankCardAttrLisSize){
  __next = '9';
}else{
  __next = '8';
}","8","Enter Bank Card Attr","<html>
<body>
Enter ${bankCardAttrList.get(bankCardAttrListIndex-1).attrName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","6774","1564","Group Transfer from Bank to M-Pesa","var input = __input.response;
if (input == '1') {
  identifierTypeName = 'MSISDN';
  __params.ReceiverPartyIdentifierType = '01';   /* MSISDN */
  __next = '10';
} else if (input == '2') {
  identifierTypeName = 'Organization Short Code';
  __params.ReceiverPartyIdentifierType = '04';   /* SHORT_CODE*/
  __next = '10';
}else if (input == '3') {
  identifierTypeName = 'Group Code';
  __params.ReceiverPartyIdentifierType = '15';   /* GROUP_CODE*/
  __next = '10';
}  else {
  __next = '9';
}","9","Select Receiver Type","<html>
<body>
Select Receiver Type:<br>
1 Customer <br>
2 Organization <br>
3 Group <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","6775","1564","Group Transfer from Bank to M-Pesa","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '11';","10","Enter Receiver","<html>
<body>
Enter Receiver ${identifierTypeName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","6776","1564","Group Transfer from Bank to M-Pesa","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '12';
} else {
    __next = '11';
}","11","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","6777","1564","Group Transfer from Bank to M-Pesa","var input = __input.response;
__params.PIN = input;
__secure = true;
__next = '13';","12","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","6778","1564","Group Transfer from Bank to M-Pesa","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '13';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '14';
}","13","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","6779","1564","Group Transfer from Bank to M-Pesa","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '14';
}","14","Confirm","<html>
<body>
Deposit Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountNo}${__params.BankCardId}<br>
Reciever : ${__params.ReceiverPartyIdentifier}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6780","1557","Customer Transfer from Bank to M-Pesa","var input = __input.response;
if (input == '1') {
  identifierTypeName = 'MSISDN';
  __params.ReceiverPartyIdentifierType = '01';   /* MSISDN */
  __next = '6';
} else if (input == '2') {
  identifierTypeName = 'Organization Short Code';
  __params.ReceiverPartyIdentifierType = '04';   /* SHORT_CODE*/
  __next = '6';
}else if (input == '3') {
  identifierTypeName = 'Group Code';
  __params.ReceiverPartyIdentifierType = '15';   /* GROUP_CODE*/
  __next = '6';
}  else {
  __next = '5';
}","5","Select Receiver Type","<html>
<body>
Select Receiver Type:<br>
1 Customer <br>
2 Organization <br>
3 Group <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6781","1565","Organization Transfer from Bank to M-Pesa","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.PrimaryPartyIdentifierType= '04'; /* SHORT_CODE*/
orgInfo = IC.queryByMsisdn(msisdn);
shortCode = IC.queryShortCodeByTillId(orgInfo.identityId);
__params.BankCardOwnerInputType = '04'; /* SHORT_CODE*/
__params.BankCardOwnerInputValue = shortCode;
__params.TransactionCategory = 'Bank_Card_Service';
__params.TransactionSubCategory = '0';
fiOrgList = IC.queryFiOrgList(__params);
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","6782","1565","Organization Transfer from Bank to M-Pesa","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(fiOrgList)) {
   __params.ShortCode= fiOrgList.get(i).shortCode;
   __params.PrimaryPartyIdentifier= __params.ShortCode;
   __params.FIOrgIdentityId= fiOrgList.get(i).identityId;
   __next = '2';
} else {
   __next = '1';
}","1","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6783","1565","Organization Transfer from Bank to M-Pesa","var input = __input.response;
if (input == '1') {
  __params.QueryIdentifierType = __params.BankCardOwnerInputType;
  __params.QueryIdentifierValue = __params.BankCardOwnerInputValue;
  bankAccounts = IC.queryBankAccListByIdenAndBank(__params);
  __next = '3';
} else if (input == '2') {
  __next = '4';
}","2","Select or Enter Bank Account","<html>
<body>
1 Select form list <br>
2 Enter bank card <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6784","1565","Organization Transfer from Bank to M-Pesa","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccounts)) {
   __params.BankCardId = bankAccounts.get(i).bankCardId;
   __secure = true;
   __next = '5';
} else {
   __next = '3';
}","3","Select Bank Account","<html>
<body>
Please select bank account:<br>
$$ var index = 1;
$$ for (bankAccount: bankAccounts ) {
  ${index} ${bankAccount.accountName}/${bankAccount.accountNumber} (${bankAccount.bankName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6785","1565","Organization Transfer from Bank to M-Pesa","__params.BankAccountNo = __input.response;
__secure = true;
bankCardAttrList= IC.queryBankCardAttr(__params,'1000');
bankCardAttrLisSize = size(bankCardAttrList);
__params.FIAccountInfo = Util.buildMessage();
__params.FIAccountInfo.InfoDetail = Util.buildMessageList(bankCardAttrLisSize);
bankCardAttrListIndex = 1;
if (bankCardAttrLisSize > 0)
{
  __next = '4a';
}
else
{
__next = '5';
}","4","Enter Bank Account","<html>
<body>
Enter Bank Account<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6786","1565","Organization Transfer from Bank to M-Pesa","var input = __input.response;
if (bankCardAttrListIndex <= bankCardAttrLisSize){
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Key = bankCardAttrList.get(bankCardAttrListIndex-1).attrName;
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Value = input;
  bankCardAttrListIndex=bankCardAttrListIndex+1;
}
if(bankCardAttrLisSize < bankCardAttrListIndex){
  __next = '5';
}else{
  __next = '4a';
}","4a","Enter Bank Card Attr","<html>
<body>
Enter ${bankCardAttrList.get(bankCardAttrListIndex-1).attrName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6787","1565","Organization Transfer from Bank to M-Pesa","var input = __input.response;
if (input == '1') {
  identifierTypeName = 'MSISDN';
  __params.ReceiverPartyIdentifierType = '01';   /* MSISDN */
  __next = '6';
} else if (input == '2') {
  identifierTypeName = 'Organization Short Code';
  __params.ReceiverPartyIdentifierType = '04';   /* SHORT_CODE*/
  __next = '6';
}else if (input == '3') {
  identifierTypeName = 'Group Code';
  __params.ReceiverPartyIdentifierType = '15';   /* GROUP_CODE*/
  __next = '6';
}  else {
  __next = '5';
}","5","Select Receiver Type","<html>
<body>
Select Receiver Type:<br>
1 Customer <br>
2 Organization <br>
3 Group <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6788","1565","Organization Transfer from Bank to M-Pesa","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '7';","6","Enter Receiver","<html>
<body>
Enter Receiver ${identifierTypeName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6789","1565","Organization Transfer from Bank to M-Pesa","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '8';
} else {
    __next = '7';
}","7","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","6790","1565","Organization Transfer from Bank to M-Pesa","var input = __input.response;
__params.PIN = input;
__next = '10';","9","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","6791","1565","Organization Transfer from Bank to M-Pesa","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '10';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '11';
}","10","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","6792","1565","Organization Transfer from Bank to M-Pesa","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","11","Confirm","<html>
<body>
Deposit Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountNo}${__params.BankCardId}<br>
Reciever : ${__params.ReceiverPartyIdentifier}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6796","1566","View Direct Debit Mandate","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ViewDirectDebitMandateByPayer';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.MandateStatus = '03';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","4","6797","1566","View Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__params.PayeeName =  mandateList.get(i).payeeName;
__next = '4';
} else {
__next = '3';
}","3","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6798","1566","View Direct Debit Mandate","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6799","1566","View Direct Debit Mandate","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '5';
}","5","Comfirm","<html>
<body>
 Direct Debit Mandate  - ${__params.PayeeName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6800","1567","Create Direct Debit Mandate by Group","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
__params.ActionType = 'CreateDirectDebitMandateByGroup';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6801","1567","Create Direct Debit Mandate by Group","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '0';
}
}
if ( found == '1') {
   __errormsg = 'no current group or not belong to the group.';
   __next = 'error';
}
else
{
   __next = '2';
}
}
 else {
      __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6802","1567","Create Direct Debit Mandate by Group","var input = __input.response;
if (!empty(input)) {
  __params.Identifier= input;
__params.IdentifierType = '04'; 
  __next = '3';
} else {
  __next = '2';
}","2","Enter Payee ID","<html>
<body>
Enter  Payee  ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6803","1567","Create Direct Debit Mandate by Group","var input = __input.response;
var length = size(input);
if (!empty(input) && length < 64) {
  __params.PayerReferenceNumber = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Payer Unique Reference number","<html>
<body>
Enter Payer Unique Reference number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6804","1567","Create Direct Debit Mandate by Group","__params.AgreedTC = '1';
__next = '5';","4","Agreed TC","<html>
<body>
Please Confirm you have Agreed Terms and Conditions <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6805","1567","Create Direct Debit Mandate by Group","var input = __input.response;
var length = size(input);
if(empty(input))
{
__next = '6';
}else if (length < 64) {
  __params.PayerAccountName= input;
__next = '6';
} else {
  __next = '5';
}","5","Enter Payer Account Instance","<html>
<body>
Enter Payer Account Instance <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6806","1567","Create Direct Debit Mandate by Group","var input = __input.response;
if(empty(input))
{
__next = '7';
}else if (Validator.isMatchRegex(input,'^(0[1-7])$')) {
__params.Frequency = input;
__next = '7';
} else {
__next = '6';
}","6","Enter Frequency","<html>
<body>
Enter Frequency <br>
01 One Off  <br>
02 Daily  <br>
03 Weekly  <br>
04 Monthly  <br>
05 Quarterly  <br>
06  Half Yearly  <br>
07  Yearly
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html",""<endrec>
"CUSTOMER","","8","6807","1567","Create Direct Debit Mandate by Group","var input = __input.response;
if (!empty(input) && !Validator.isDate(input, 'ddMMyyyy')){
__next = '7';
} else {
 __params.FirstPaymentDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '8';
}","7","Enter First Payment Date","<html>
<body>
Enter First Payment Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","6808","1567","Create Direct Debit Mandate by Group","var input = __input.response;
if(empty(input) ) 
{
  __next = '9';
}
else if(Validator.isMatchRegex(input ,'^([1-9]|[1-2]\d|3[0-1])$'))
{
   __next = '9';
__params.StartRangeOfDays= input;

}else
{
    __next = '8';
}","8","Enter Start of Range of days","<html>
<body>
Enter Start of Range of days <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","6809","1567","Create Direct Debit Mandate by Group","var input = __input.response;
if(empty(input) ) 
{
  __next = '10';
}
else if(Validator.isMatchRegex(input ,'^([1-9]|[1-2]\d|3[0-1])$'))
{
   __next = '10';
__params.EndRangeOfDays= input;

}else
{
    __next = '9';
}","9","Enter End of Range of days","<html>
<body>
Enter End of Range of days <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","6810","1567","Create Direct Debit Mandate by Group","var input = __input.response;
if (!empty(input) ) {
 __params.@HEAD@PIN = input;
    __next = '11';
} else {
    __secure = true;
    __next = '10';
}","10","Enter Your PIN","<html>
<body>
Enter Your PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","6811","1567","Create Direct Debit Mandate by Group","var input = __input.response;
__params.Payee = IC.buildDirectDebitPayerInfo(__params);
__params.DirectDebitMandateInfo = IC.buildDirectDebitMandateInfo(__params);
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '12';
}","12","Confirm","<html>
<body>
Confirm to Create Direct Debit Mandate?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6812","1568","Create Direct Debit Mandate by Organization","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '05';
__params.ActionType = 'CreateDirectDebitMandateByOrganization';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","6813","1568","Create Direct Debit Mandate by Organization","var input = __input.response;
__params.InitiatorIdentifier = input;
__params.ReceiverPartyIdentifier = input;
__secure = true;
__next = '2';","1","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6814","1568","Create Direct Debit Mandate by Organization","var input = __input.response;
if (!empty(input)) {
  __params.Identifier= input;
__params.IdentifierType = '04'; 
  __next = '3';
} else {
  __next = '2';
}","2","Enter Payee ID","<html>
<body>
Enter  Payee  ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6815","1568","Create Direct Debit Mandate by Organization","var input = __input.response;
var length = size(input);
if (!empty(input) && length < 64) {
  __params.PayerReferenceNumber = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Payer Unique Reference number","<html>
<body>
Enter Payer Unique Reference number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6816","1568","Create Direct Debit Mandate by Organization","__params.AgreedTC = '1';
__next = '5';","4","Agreed TC","<html>
<body>
Please Confirm you have Agreed Terms and Conditions <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6817","1568","Create Direct Debit Mandate by Organization","var input = __input.response;
var length = size(input);
if(empty(input))
{
__next = '6';
}else if (length < 64) {
  __params.PayerAccountName= input;
__next = '6';
} else {
  __next = '5';
}","5","Enter Payer Account Instance","<html>
<body>
Enter Payer Account Instance <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6818","1568","Create Direct Debit Mandate by Organization","var input = __input.response;
if(empty(input))
{
__next = '7';
}else if (Validator.isMatchRegex(input,'^(0[1-7])$')) {
__params.Frequency = input;
__next = '7';
} else {
__next = '6';
}","6","Enter Frequency","<html>
<body>
Enter Frequency <br>
01 One Off  <br>
02 Daily  <br>
03 Weekly  <br>
04 Monthly  <br>
05 Quarterly  <br>
06  Half Yearly  <br>
07  Yearly
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6819","1568","Create Direct Debit Mandate by Organization","var input = __input.response;
if (!empty(input) && !Validator.isDate(input, 'ddMMyyyy')){
__next = '7';
} else {
 __params.FirstPaymentDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '8';
}","7","Enter First Payment Date","<html>
<body>
Enter First Payment Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6820","1568","Create Direct Debit Mandate by Organization","var input = __input.response;
if(empty(input) ) 
{
  __next = '9';
}
else if(Validator.isMatchRegex(input ,'^([1-9]|[1-2]\d|3[0-1])$'))
{
   __next = '9';
__params.StartRangeOfDays= input;

}else
{
    __next = '8';
}","8","Enter Start of Range of days","<html>
<body>
Enter Start of Range of days <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","6821","1568","Create Direct Debit Mandate by Organization","var input = __input.response;
if(empty(input) ) 
{
  __next = '10';
}
else if(Validator.isMatchRegex(input ,'^([1-9]|[1-2]\d|3[0-1])$'))
{
   __next = '10';
__params.EndRangeOfDays= input;

}else
{
    __next = '9';
}","9","Enter End of Range of days","<html>
<body>
Enter End of Range of days <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","6822","1568","Create Direct Debit Mandate by Organization","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
    __next = '12';
} else {
    __secure = true;
    __next = '11';
}","11","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","6823","1568","Create Direct Debit Mandate by Organization","var input = __input.response;
__params.Payee = IC.buildDirectDebitPayerInfo(__params);
__params.DirectDebitMandateInfo = IC.buildDirectDebitMandateInfo(__params);
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '11';
}","12","Confirm","<html>
<body>
Confirm to Create Direct Debit Mandate?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6826","1570","Customer Buy Foreign Currency","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '11'; /* SP SHORT CODE */
__params.ReceiverPartyIdentifier = '1';
__params.TransactionCategory = 'FX';
defaultCurrencyCode = IC.getDefaultCurrencyCode();
__params.SourceCurrency = defaultCurrencyCode;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6827","1570","Customer Buy Foreign Currency","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.DestinationCurrency = type;
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Select Currency","<html>
<body>
Select the Foreign Currency to Buy :<br>
$$multiCurrencyCode = IC.getAllForeignCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currencyCode to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6828","1570","Customer Buy Foreign Currency","var input = __input.response;
if (input == '1') {
  __params.BaseCurrency = __params.DestinationCurrency;  
  __next = '3';
} else if(input == '2') {
  __params.BaseCurrency = defaultCurrencyCode;
   __next = '3';
} else {
  __next = '2';
}","2","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.DestinationCurrency} <br>
2 Input the amount in ${defaultCurrencyCode}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6829","1570","Customer Buy Foreign Currency","var input = __input.response;
if (Validator.isAmountOfSpecialCurrency(input,__params.BaseCurrency)) {
__params.BaseAmount = TC.convertAmountFormat(input);
__secure = true;
 __next = '4';
}
else {
 __next = '3';
}","3","Input Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6830","1570","Customer Buy Foreign Currency","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.SourceAccount = type.AccountNo;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Select account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account' ,__params.SourceCurrency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6831","1570","Customer Buy Foreign Currency","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6832","1570","Customer Buy Foreign Currency","if (rateInfo.formatRate == null) {
  __next = 'error';
} else {
var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}
}","6","Confirm","<html>
<body>
$$rateInfo = TC.queryFxRateAndAmount(__params.SourceCurrency, __params.DestinationCurrency,__params.BaseCurrency,__params.BaseAmount);
You are going to buy [${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}],[${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}] will be debited from your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6833","1571","View Direct Debit Mandate By Payee","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ViewDirectDebitMandateByPayee';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","4","6834","1571","View Direct Debit Mandate By Payee","var input = __input.response;
if (!empty(input)) {
  __params.MandateID = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Mandate ID","<html>
<body>
Enter Mandate ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6835","1571","View Direct Debit Mandate By Payee","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6836","1571","View Direct Debit Mandate By Payee","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '5';
}","5","Comfirm","<html>
<body>
 Direct Debit Mandate  - ${__params.MandateID} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6839","1572","View Standing Order Schedule","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier =msisdn;
__params.ActionType= 'QueryIndividualReminderScheduleDetails';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.NeedConfirmation= '0';
reminderList = IC.queryReminderListByMsisdn(__params);
if(empty(reminderList )|| size(reminderList )==0){
 __errormsg = 'no current schedules.';
 __next = 'error';
}else {
 __next = '1';
}","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6840","1572","View Standing Order Schedule","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(reminderList)) { 
__params.ReminderScheduleID =  reminderList.get(i).reminderId;
__params.ReminderScheduleName =  reminderList.get(i).reminderName;
__next = '2';
} else {
__next = '1';
}","1","Select Standing Order Schedules","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6841","1572","View Standing Order Schedule","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6842","1572","View Standing Order Schedule","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '3';
}","3","Comfirm","<html>
<body>
Reminder Schedule  - ${__params.ReminderScheduleName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6843","1573","View Standing Order Schedule","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'QueryIndividualReminderScheduleDetails';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.NeedConfirmation= '0';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","4","6844","1573","View Standing Order Schedule","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(reminderList)) { 
__params.ReminderScheduleID =  reminderList.get(i).reminderId;
__params.ReminderScheduleName =  reminderList.get(i).reminderName;
__next = '4';
} else {
__next = '3';
}","3","Select Standing Order Schedules","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6845","1573","View Standing Order Schedule","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6846","1573","View Standing Order Schedule","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '5';
}","5","Comfirm","<html>
<body>
Reminder Schedule  - ${__params.ReminderScheduleName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6848","1574","View Direct Debit Mandate By Group","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ActionType= 'ViewDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.MandateStatus = '03';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6849","1574","View Direct Debit Mandate By Group","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
 for(group: groups){
  if(group.groupCode == input)
  {
    found = '0';
  }
 }
 if ( found == '1') {
    __errormsg = 'no current group or not belong to the group.';
    __next = 'error';
 }
 else
 {
  mandateList = IC.queryDirectDebitMandateByPayer(__params);
  if(empty(mandateList )|| size(mandateList )==0){
   __errormsg = 'No Available Mandates.';
   __next= 'error';
  }else {
  __next = '2';
  }
    
 }
}
 else {
  __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6850","1574","View Direct Debit Mandate By Group","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__params.PayeeName =  mandateList.get(i).payeeName;
__next = '3';
} else {
__next = '2';
}","2","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6851","1574","View Direct Debit Mandate By Group","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6852","1574","View Direct Debit Mandate By Group","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '4';
}","4","Comfirm","<html>
<body>
 Direct Debit Mandate  - ${__params.PayeeName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6853","1575","View Standing Order Schedule By Group","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ActionType= 'QueryIndividualReminderScheduleDetails';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.NeedConfirmation= '0';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6854","1575","View Standing Order Schedule By Group","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
 for(group: groups){
  if(group.groupCode == input)
  {
    found = '0';
  }
 }
 if ( found == '1') {
    __errormsg = 'no current group or not belong to the group.';
    __next = 'error';
 }
 else
 {
  reminderList = IC.queryReminderListByMsisdn(__params);
  if(empty(reminderList )|| size(reminderList )==0){
   __errormsg = 'no current schedules.';
   __next = 'error';
  }else {
   __next = '2';
  }
    
 }
}
 else {
      __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6855","1575","View Standing Order Schedule By Group","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(reminderList)) { 
__params.ReminderScheduleID =  reminderList.get(i).reminderId;
__params.ReminderScheduleName =  reminderList.get(i).reminderName;
__next = '3';
} else {
__next = '2';
}","2","Select Standing Order Schedule","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6857","1575","View Standing Order Schedule By Group","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6858","1575","View Standing Order Schedule By Group","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '4';
}","4","Comfirm","<html>
<body>
Reminder Schedule  - ${__params.ReminderScheduleName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","6860","1566","View Direct Debit Mandate","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input; 
   __next = '2';
}
else
{
    __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6861","1566","View Direct Debit Mandate","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
   mandateList = IC.queryDirectDebitMandateByPayer(__params);
if(empty(mandateList )|| size(mandateList )==0){
 __errormsg = 'No Available Mandates.';
__next = 'error';
}else {
  __next = '3';
}  
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","6862","1571","View Direct Debit Mandate By Payee","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
   __next = '2';
}
else
{
    __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6864","1571","View Direct Debit Mandate By Payee","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
    __next = '3';
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","6865","1573","View Standing Order Schedule","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
    __next = '2';
}
else
{
    __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6866","1573","View Standing Order Schedule","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
reminderList = IC.queryReminderListByMsisdn(__params);
if(empty(reminderList )|| size(reminderList )==0){
 __errormsg = 'no current schedules.';
__next = 'error';
}else {
  __next = '3';
}
   
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6867","1577","Customer Sell Foreign Currency","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '11'; /* SP SHORT CODE */
__params.ReceiverPartyIdentifier = '1';
__params.TransactionCategory = 'FX';
defaultCurrencyCode = IC.getDefaultCurrencyCode();
__params.DestinationCurrency = defaultCurrencyCode;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6868","1577","Customer Sell Foreign Currency","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.SourceCurrency  = type;
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Select Currency","<html>
<body>
Select the Foreign Currency to Sell :<br>
$$multiCurrencyCode = IC.getAllForeignCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currencyCode to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6869","1577","Customer Sell Foreign Currency","var input = __input.response;
if (input == '1') {
  __params.BaseCurrency = __params.SourceCurrency ;  
  __next = '3';
} else if(input == '2') {
  __params.BaseCurrency = defaultCurrencyCode;
   __next = '3';
} else {
  __next = '2';
}","2","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.SourceCurrency} <br>
2 Input the amount in ${defaultCurrencyCode}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6870","1577","Customer Sell Foreign Currency","var input = __input.response;
if (Validator.isAmountOfSpecialCurrency(input,__params.BaseCurrency)) {
__params.BaseAmount = TC.convertAmountFormat(input);
__secure = true;
 __next = '4';
}
else {
 __next = '3';
}","3","Input Base Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6871","1577","Customer Sell Foreign Currency","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.SourceAccount = type.AccountNo;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Select Paying Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account' ,__params.SourceCurrency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6872","1577","Customer Sell Foreign Currency","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6873","1577","Customer Sell Foreign Currency","if (rateInfo.formatRate == null) {
__endmsg='No exchange rate is configured or the exchange rate has expired or in Disabled state.';
  __next = 'end';
} else {
var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}
}","6","Confirm","<html>
<body>
$$rateInfo = TC.queryFxRateAndAmount(__params.SourceCurrency, __params.DestinationCurrency,__params.BaseCurrency,__params.BaseAmount);
You are going to sell [${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}],[${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}] will be credit to your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6874","1578","Group Buy Foreign Currency","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '11'; /* SP SHORT CODE */
__params.ReceiverPartyIdentifier = '1';
__params.TransactionCategory = 'FX';
groups = IC.queryMyGroups(msisdn);
defaultCurrencyCode = IC.getDefaultCurrencyCode();
__params.SourceCurrency = defaultCurrencyCode;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6875","1578","Group Buy Foreign Currency","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Group","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6876","1578","Group Buy Foreign Currency","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.PrimaryPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Input Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6877","1578","Group Buy Foreign Currency","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select My Group","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6878","1578","Group Buy Foreign Currency","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.DestinationCurrency = type;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Currency","<html>
<body>
Select the Foreign Currency to Buy :<br>
$$multiCurrencyCode = IC.getAllForeignCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currencyCode to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6879","1578","Group Buy Foreign Currency","var input = __input.response;
if (input == '1') {
  __params.BaseCurrency = __params.DestinationCurrency;  
  __next = '5';
} else if(input == '2') {
  __params.BaseCurrency = defaultCurrencyCode;
   __next = '5';
} else {
  __next = '4';
}","4","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.DestinationCurrency} <br>
2 Input the amount in ${defaultCurrencyCode}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6880","1578","Group Buy Foreign Currency","var input = __input.response;
if (Validator.isAmountOfSpecialCurrency(input,__params.BaseCurrency)) {
__params.BaseAmount = TC.convertAmountFormat(input);
__secure = true;
 __next = '6';
}
else {
 __next = '5';
}","5","Input Base Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6881","1578","Group Buy Foreign Currency","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.SourceAccount = type.AccountNo;
                __secure = true;
                __next = '7';
         } else {
                __next = '6';
         }
    } else {
        __next = '6';
    }
}","6","Select Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
$$multiAccount = IC.queryGroupMultiAccounts(__params.PrimaryPartyIdentifier,'M-PESA Account' ,__params.SourceCurrency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","6882","1578","Group Buy Foreign Currency","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","6883","1578","Group Buy Foreign Currency","if (rateInfo.formatRate == null) {
  __next = 'error';
} else {
var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}
}","8","Confirm","<html>
<body>
$$rateInfo = TC.queryFxRateAndAmount(__params.SourceCurrency, __params.DestinationCurrency,__params.BaseCurrency,__params.BaseAmount);
You are going to buy [${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}],[${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}] will be debited from your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6884","1579","Customer Transfer from M-Pesa to Bank","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';   /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType= '01';
__params.PrimaryPartyIdentifier= msisdn;
__params.QueryIdentifierType = '01';   /* MSISDN */
__params.QueryIdentifierValue = msisdn;
__params.ReceiverPartyIdentifierType = '04';   /* SHORT_CODE*/
__params.TransactionCategory = 'Bank_Card_Service';
__params.TransactionSubCategory = '1';
fiOrgList = IC.queryFiOrgList(__params);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","3","6885","1583","Group Transfer from M-Pesa to Bank","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.PrimaryPartyIdentifier= input;
     __next = '4';     
   } 
else{
    __next = '2';
}","2","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6886","1580","Customer Cancel Direct Debit Mandate","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = msisdn;
__params.ActionType= 'CancelCustomerDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.MandateStatus = '02,03';
mandateList = IC.queryDirectDebitMandateByPayer(__params);
if(empty(mandateList )|| size(mandateList )==0){
 __errormsg = 'No Available Mandates.';
_next = 'error';
}else {
 __next = '1';
}","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6887","1580","Customer Cancel Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__params.PayeeName =  mandateList.get(i).payeeName;
__next = '2';
} else {
__next = '1';
}","1","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6888","1580","Customer Cancel Direct Debit Mandate","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '3';
} else {
    __secure = true;
    __next = '2';
}","2","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6889","1580","Customer Cancel Direct Debit Mandate","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6890","1581","Customer Reactivate Direct Debit Mandate","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = msisdn;
__params.ActionType= 'ReactivateCustomerDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.MandateStatus = '04';
mandateList = IC.queryDirectDebitMandateByPayer(__params);
if(empty(mandateList )|| size(mandateList )==0){
 __errormsg = 'No Available Mandates.';
_next = 'error';
}else {
 __next = '1';
}
__params.ActionType = 'ReactivateCustomerDirectDebitMandateByPayer';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6891","1581","Customer Reactivate Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__params.PayeeName =  mandateList.get(i).payeeName;
__next = '2';
} else {
__next = '1';
}","1","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6892","1581","Customer Reactivate Direct Debit Mandate","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '3';
} else {
    __secure = true;
    __next = '2';
}","2","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6893","1581","Customer Reactivate Direct Debit Mandate","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6894","1582","Customer Edit Direct Debit Mandate","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = msisdn;
__params.ActionType= 'EditCustomerDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.MandateStatus = '02,03';
mandateList = IC.queryDirectDebitMandateByPayer(__params);
if(empty(mandateList )|| size(mandateList )==0){
 __errormsg = 'No Available Mandates.';
_next = 'error';
}else {
 __next = '1';
}
__params.ActionType = 'EditCustomerDirectDebitMandateByPayer';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6895","1582","Customer Edit Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__params.PayeeName =  mandateList.get(i).payeeName;
__next = '2';
} else {
__next = '1';
}","1","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6896","1582","Customer Edit Direct Debit Mandate","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-1])$'))
{
__params.AgreedTC = input;
__secure = true;
 __next = '3';
}
else {
 __next = '2';
}","2","Agreed TC","<html>
<body>Please Select you have Agreed T:<br>
1 yes<br>
0 no<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6897","1582","Customer Edit Direct Debit Mandate","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6898","1582","Customer Edit Direct Debit Mandate","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6901","1579","Customer Transfer from M-Pesa to Bank","var input = __input.response;
if (input == '1') {
  identifierTypeName = 'MSISDN';
  __params.BankCardOwnerInputType = '01';   /* MSISDN */
  __next = '3';
} else if (input == '2') {
  identifierTypeName = 'Organization Short Code';
  __params.BankCardOwnerInputType = '04';   /* SHORT_CODE*/
  __next = '3';
}else if (input == '3') {
  identifierTypeName = 'Group Code';
  __params.BankCardOwnerInputType = '15';   /* GROUP_CODE*/
  __next = '3';
}  else {
  __next = '2';
}","2","Select Receiver Type","<html>
<body>
Select Receiver Type:<br>
1 Customer <br>
2 Organization <br>
3 Group <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6902","1579","Customer Transfer from M-Pesa to Bank","var input = __input.response;
__params.BankCardOwnerInputValue = input;
__next = '4';","3","Enter Receiver","<html>
<body>
Enter Receiver ${identifierTypeName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6903","1579","Customer Transfer from M-Pesa to Bank","var input = __input.response;
if (input == '1') {
  bankLookupList = IC.queryBankLookupList(__params);
  __next = '5';
} else if (input == '2') {
  __next = '6';
}","4","Select or Enter Bank Account","<html>
<body>
1 Select form list <br>
2 Enter bank card <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6904","1579","Customer Transfer from M-Pesa to Bank","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankLookupList)) {
   __params.BankCardId= bankLookup.BankCardId;
   __secure = true;
   __next = '7';
} else {
  __next = '5';
}","5","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankLookup:bankLookupList){
 ${index} ${bankLookup.AccountName}/${bankLookup.AccountNumber}(${bankLookup.BankBranchName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6905","1579","Customer Transfer from M-Pesa to Bank","__params.BankAccountNo= __input.response;
bankCardAttrList= IC.queryBankCardAttr(__params,'1000');
bankCardAttrLisSize = size(bankCardAttrList);
__params.FIAccountInfo = Util.buildMessage();
__params.FIAccountInfo.InfoDetail = Util.buildMessageList(bankCardAttrLisSize);
bankCardAttrListIndex = 1;
if (bankCardAttrLisSize > 0)
{
  __next = '6a';
}
else
{
__next = '7';
}","6","Enter Bank Account","<html>
<body>
Enter Bank Account<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6906","1579","Customer Transfer from M-Pesa to Bank","var input = __input.response;
if (bankCardAttrListIndex <= bankCardAttrLisSize){
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Key = bankCardAttrList.get(bankCardAttrListIndex-1).attrName;
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Value = input;
  bankCardAttrListIndex=bankCardAttrListIndex+1;
}
if(bankCardAttrLisSize < bankCardAttrListIndex){
  __next = '7';
}else{
  __next = '6a';
}","6a","Enter Bank Card Attr","<html>
<body>
Enter ${bankCardAttrList.get(bankCardAttrListIndex-1).attrName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","6907","1579","Customer Transfer from M-Pesa to Bank","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '8';
} else {
    __next = '7';
}","7","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","6908","1579","Customer Transfer from M-Pesa to Bank","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","6909","1579","Customer Transfer from M-Pesa to Bank","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '9';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '10';
}","9","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","6910","1579","Customer Transfer from M-Pesa to Bank","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Deposit Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountNo}${__params.BankCardId}<br>
Reciever : ${__params.ReceiverPartyIdentifier}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6911","1583","Group Transfer from M-Pesa to Bank","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';   /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.RequesterIdentifierType = '01';   /* MSISDN */
__params.RequesterIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15';   /* GROUP_CODE*/
__params.ReceiverPartyIdentifierType = '04';   /* SHORT CODE */
__params.TransactionCategory = 'Bank_Card_Service';
__params.TransactionSubCategory = '1';
fiOrgList = IC.queryFiOrgList(__params);
groups = IC.queryMyGroups(msisdn);
var IdentityType ='100';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6912","1583","Group Transfer from M-Pesa to Bank","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '3';
    }
} else {
   __next = '0';
}","1","Select Option For Group","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6913","1584","Query Bank Account","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'QueryIdentityBankAccount';
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6914","1584","Query Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';
    __params.BankName = 'Others';
    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
        __params.BankName = item.defaultName;
    }

     bankList = IC.queryOrgBankList(__params.BankId);
    __next = '2';
} else {
  __next = '1';
}","1","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6915","1584","Query Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankList)) {
    bank = bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '3';
} else {
  __next = '2';
}","2","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6916","1584","Query Bank Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6917","1584","Query Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6918","1585","Query Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'QueryIdentityBankAccount';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';   /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */
items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6919","1585","Query Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;

  __next = '2';
} else {
  __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6920","1585","Query Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';
    __params.BankName = 'Others';
    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
        __params.BankName = item.defaultName;
    }

     bankList = IC.queryOrgBankList(__params.BankId);
    __next = '3';
} else {
  __next = '2';
}","2","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6921","1585","Query Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankList)) {
    bank = bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '4';
} else {
  __next = '4';
}","3","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6922","1585","Query Bank Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6923","1585","Query Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6924","1586","Create Bank Card Lookup","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'CreateIdentityBankCardLookup';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;

items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;
attrList = IC.queryBankCardAttr('1000');
__params.FIAccountInfo = Util.buildMessage();
__params.FIAccountInfo.InfoDetail = Util.buildMessageList(size(attrList));

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6925","1586","Create Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';
    __params.BankName = 'Others';
    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
        __params.BankName = item.defaultName;
    }
    bankList = IC.queryOrgBankList(__params.BankId);

    __next = '2';
} else {
  __next = '1';
}","1","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6926","1586","Create Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankList)) {
    bank = bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '3';
} else {
  __next = '2';
}","2","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6927","1586","Create Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.AccountName = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Lookup Name","<html>
<body>
Enter Lookup Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6928","1586","Create Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.AccountNumber = input;
  if(size(attrList) > 0) {
    index = 0;
    __next = '5';
  } else {
    __next = '6';
  }
} else {
  __next = '4';
}","4","Enter Lookup Card No.","<html>
<body>
Enter Lookup Card No.:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6929","1586","Create Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.FIAccountInfo.InfoDetail[index].Key = attrList[index];
  __params.FIAccountInfo.InfoDetail[index].Value = input;

  index = index + 1;
  if(index < size(attrList)) {
    __next = '5';
  } else {
    __next = '6';
  }
} else {
  __next = '5';
}","5","Enter FI Account Info","<html>
<body>
Enter ${attrList[index]}:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6930","1586","Create Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = '7';
} else if(input == '0') {
  __next = '1';
} else {
  __next = '6';
}","6","Confirm Bank Card Lookup","<html>
<body>
Confirm Bank Card Lookup<br><br>
Bank:${__params.BankName}<br>
Bank Branch:${__params.BranchName}<br>
Lookup Name:${__params.AccountName}<br>
Lookup Card No.:${__params.AccountNumber}<br>
<br>
$$ for (detail:__params.FIAccountInfo.InfoDetail){
${detail.Key}:${detail.Value}<br>
$$ }
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6931","1586","Create Bank Card Lookup","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '8';
} else {
    __secure = true;
    __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","6932","1586","Create Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6933","1587","Delete Bank Card Lookup","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'DeleteIdentityBankCardLookup';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;

__params.QueryIdentifierType = '01';
__params.QueryIdentifierValue = msisdn;
bankLookupList = IC.queryBankLookupList(__params);

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6934","1587","Delete Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankLookupList)) {
    bankLookup = bankLookupList.get(i);
    __params.BankCardId = bankLookup.BankCardId;

    __next = '2';
} else {
  __next = '1';
}","1","Select Bank Card Lookup","<html>
<body>
Select Bank Card Lookup:<br>
$$ var index = 1;
$$ for (bankLookup:bankLookupList){
 ${index} ${bankLookup.AccountName}/${bankLookup.AccountNumber}(${bankLookup.BankBranchName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6935","1587","Delete Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = '3';
} else if(input == '0') {
  __next = '1';
} else {
  __next = '2';
}","2","Confirm Bank Card Lookup","<html>
<body>
Confirm Bank Card Lookup<br><br>
Bank:${bankLookup.BankName}<br>
Bank Branch:${bankLookup.BankBranchName}<br>
Lookup Name:${bankLookup.AccountName}<br>
Lookup Card No.:${bankLookup.AccountNumber}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6936","1587","Delete Bank Card Lookup","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6937","1587","Delete Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6938","1588","Query Bank Card Lookup","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'QueryIdentityBankCardLookup';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;  
items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","6939","1588","Query Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';

    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
    }

    bankList = IC.queryOrgBankList(__params.BankId);

    __next = '2';
} else {
  __next = '1';
}","1","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6940","1588","Query Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankList)) {
    bank = bankList.get(i);
    __params.BankBranchId = bank.BranchId;

    __next = '3';
} else {
  __next = '2';
}","2","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6941","1588","Query Bank Card Lookup","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6942","1588","Query Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6943","1589","Create Bank Card Lookup","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'CreateIdentityBankCardLookup';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';   /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */

items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;
attrList = IC.queryBankCardAttr('5000');
__params.FIAccountInfo = Util.buildMessage();
__params.FIAccountInfo.InfoDetail = Util.buildMessageList(size(attrList));

__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6944","1589","Create Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;

  __next = '2';
} else {
  __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6945","1589","Create Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';
    __params.BankName = 'Others';

    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
        __params.BankName = item.defaultName;
    }

    bankList = IC.queryOrgBankList(__params.BankId);

    __next = '3';
} else {
  __next = '2';
}","2","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6946","1589","Create Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankList)) {
    bank = bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '4';
} else {
  __next = '3';
}","3","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6947","1589","Create Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.AccountName = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Lookup Name","<html>
<body>
Enter Lookup Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6948","1589","Create Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.AccountNumber = input;
  if(size(attrList) > 0) {
    index = 0;
    __next = '6';
  } else {
    __next = '7';
  }
} else {
  __next = '5';
}","5","Enter Lookup Card No.","<html>
<body>
Enter Lookup Card No.:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6949","1589","Create Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.FIAccountInfo.InfoDetail[index].Key = attrList[index];
  __params.FIAccountInfo.InfoDetail[index].Value = input;

  index = index + 1;
  if(index < size(attrList)) {
    __next = '6';
  } else {
    __next = '7';
  }
} else {
  __next = '6';
}","6","Enter FI Account Info","<html>
<body>
Enter ${attrList[index]}:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6950","1589","Create Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = '8';
} else if(input == '0') {
  __next = '2';
} else {
  __next = '7';
}","7","Confirm Bank Card Lookup","<html>
<body>
Confirm Bank Card Lookup<br><br>
Bank:${__params.BankName}<br>
Bank Branch:${__params.BranchName}<br>
Lookup Name:${__params.AccountName}<br>
Lookup Card No.:${__params.AccountNumber}<br>
<br>
$$ for (detail:__params.FIAccountInfo.InfoDetail) {
${detail.Key}:${detail.Value}<br>
$$ }
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","6951","1589","Create Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '9';
} else {
  __next = '8';
}","8","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","6954","1589","Create Bank Card Lookup","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '10';
} else {
    __secure = true;
    __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","6955","1589","Create Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6956","1590","Delete Bank Card Lookup","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'DeleteIdentityBankCardLookup';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';   /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6957","1590","Delete Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;

  __params.QueryIdentifierType = '04';
  __params.QueryIdentifierValue = input;
  bankLookupList = IC.queryBankLookupList(__params);

  __next = '2';
} else {
  __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6958","1590","Delete Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankLookupList)) {
    bankLookup = bankLookupList.get(i);
    __params.BankCardId = bankLookup.BankCardId;

    __next = '3';
} else {
  __next = '2';
}","2","Select Bank Card Lookup","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankLookup:bankLookupList){
 ${index} ${bankLookup.AccountName}/${bankLookup.AccountNumber}(${bankLookup.BankBranchName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6959","1590","Delete Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = '4';
} else if(input == '0') {
  __next = '2';
} else {
  __next = '3';
}","3","Confirm Bank Card Lookup","<html>
<body>
Confirm Bank Card Lookup<br><br>
Bank:${bankLookup.BankName}<br>
Bank Branch:${bankLookup.BankBranchName}<br>
Lookup Name:${bankLookup.AccountName}<br>
Lookup Card No.:${bankLookup.AccountNumber}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6960","1590","Delete Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6961","1590","Delete Bank Card Lookup","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6962","1590","Delete Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6963","1591","Query Bank Card Lookup","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'QueryIdentityBankCardLookup';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05';   /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* ORG_SHORT_CODE */
items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","6964","1591","Query Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;

  __next = '2';
} else {
  __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6965","1591","Query Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';

    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
    }

    bankList = IC.queryOrgBankList(__params.BankId);

    __next = '3';
} else {
  __next = '2';
}","2","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6966","1591","Query Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankList)) {
    bank = bankList.get(i);
    __params.BankBranchId = bank.BranchId;

    __next = '4';
} else {
  __next = '3';
}","3","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6967","1591","Query Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6968","1591","Query Bank Card Lookup","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6969","1591","Query Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6970","1592","Group Sell Foreign Currency","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '11'; /* SP SHORT CODE */
__params.ReceiverPartyIdentifier = '1';
__params.TransactionCategory = 'FX';
groups = IC.queryMyGroups(msisdn);
defaultCurrencyCode = IC.getDefaultCurrencyCode();
__params.DestinationCurrency = defaultCurrencyCode;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6971","1592","Group Sell Foreign Currency","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Group Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","6972","1592","Group Sell Foreign Currency","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.PrimaryPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","6974","1592","Group Sell Foreign Currency","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select Group","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","6975","1592","Group Sell Foreign Currency","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.SourceCurrency = type;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Foreign Currency","<html>
<body>
Select the Foreign Currency to Sell :<br>
$$multiCurrencyCode = IC.getAllForeignCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currencyCode to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","6976","1592","Group Sell Foreign Currency","var input = __input.response;
if (input == '1') {
  __params.BaseCurrency = __params.SourceCurrency;  
  __next = '5';
} else if(input == '2') {
  __params.BaseCurrency = defaultCurrencyCode;
   __next = '5';
} else {
  __next = '4';
}","4","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.SourceCurrency} <br>
2 Input the amount in ${defaultCurrencyCode}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","6977","1592","Group Sell Foreign Currency","var input = __input.response;
if (Validator.isAmountOfSpecialCurrency(input,__params.BaseCurrency)) {
__params.BaseAmount = TC.convertAmountFormat(input);
__secure = true;
 __next = '6';
}
else {
 __next = '5';
}","5","Input Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","6978","1592","Group Sell Foreign Currency","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.SourceAccount = type.AccountNo;
                __secure = true;
                __next = '7';
         } else {
                __next = '6';
         }
    } else {
        __next = '6';
    }
}","6","Select Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
$$multiAccount = IC.queryGroupMultiAccounts(__params.PrimaryPartyIdentifier,'' ,__params.SourceCurrency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","6979","1592","Group Sell Foreign Currency","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","6980","1592","Group Sell Foreign Currency","if (rateInfo.formatRate == null) {
  __next = 'error';
} else {
var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}
}","8","Confirm","<html>
<body>
$$rateInfo = TC.queryFxRateAndAmount(__params.SourceCurrency, __params.DestinationCurrency,__params.BaseCurrency,__params.BaseAmount);
You are going to sell [${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}],[${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}] will be credited to your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6981","1593","Org Buy Foreign Currency","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Org Operator */
__params.ReceiverPartyIdentifierType = '11'; /* SP SHORT CODE */
__params.ReceiverPartyIdentifier = '1';
__params.TransactionCategory = 'FX';
defaultCurrencyCode = IC.getDefaultCurrencyCode();
__params.SourceCurrency = defaultCurrencyCode;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","6982","1593","Org Buy Foreign Currency","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.DestinationCurrency = type;
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Select Currency","<html>
<body>
Select the Foreign Currency to Buy :<br>
$$multiCurrencyCode = IC.getAllForeignCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currencyCode to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6983","1593","Org Buy Foreign Currency","var input = __input.response;
if (input == '1') {
  __params.BaseCurrency = __params.DestinationCurrency;  
  __next = '3';
} else if(input == '2') {
  __params.BaseCurrency = defaultCurrencyCode;
   __next = '3';
} else {
  __next = '2';
}","2","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.DestinationCurrency} <br>
2 Input the amount in ${defaultCurrencyCode}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6984","1593","Org Buy Foreign Currency","var input = __input.response;
if (Validator.isAmountOfSpecialCurrency(input,__params.BaseCurrency)) {
__params.BaseAmount = TC.convertAmountFormat(input);
__secure = true;
 __next = '4';
}
else {
 __next = '3';
}","3","Input Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6985","1593","Org Buy Foreign Currency","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.SourceAccount = type.AccountNo;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Select Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',__params.SourceCurrency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6986","1593","Org Buy Foreign Currency","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '6';","5","Input Operator Id","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6987","1593","Org Buy Foreign Currency","var input = __input.response;
__params.PIN = input;
__next = '7';","6","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6988","1593","Org Buy Foreign Currency","if (rateInfo.formatRate == null) {
  __next = 'error';
} else {
var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}
}","7","Confirm","<html>
<body>
$$rateInfo = TC.queryFxRateAndAmount(__params.SourceCurrency, __params.DestinationCurrency,__params.BaseCurrency,__params.BaseAmount);
You are going to buy [${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}],[${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}] will be debited from your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","6989","1594","Org Sell Foreign Currency","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Org Operator */
__params.ReceiverPartyIdentifierType = '11'; /* SP SHORT CODE */
__params.ReceiverPartyIdentifier = '1';
__params.TransactionCategory = 'FX';
defaultCurrencyCode = IC.getDefaultCurrencyCode();
__params.DestinationCurrency = defaultCurrencyCode;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","6990","1594","Org Sell Foreign Currency","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.SourceCurrency  = type;
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Select Currency","<html>
<body>
Select the Foreign Currency to Sell :<br>
$$multiCurrencyCode = IC.getAllForeignCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currencyCode to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","6991","1594","Org Sell Foreign Currency","var input = __input.response;
if (input == '1') {
  __params.BaseCurrency = __params.SourceCurrency ;  
  __next = '3';
} else if(input == '2') {
  __params.BaseCurrency = defaultCurrencyCode;
   __next = '3';
} else {
  __next = '2';
}","2","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.SourceCurrency} <br>
2 Input the amount in ${defaultCurrencyCode}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","6992","1594","Org Sell Foreign Currency","var input = __input.response;
if (Validator.isAmountOfSpecialCurrency(input,__params.BaseCurrency)) {
__params.BaseAmount = TC.convertAmountFormat(input);
__secure = true;
 __next = '4';
}
else {
 __next = '3';
}","3","Input Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","6993","1594","Org Sell Foreign Currency","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.SourceAccount = type.AccountNo;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Select Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',__params.SourceCurrency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","6994","1594","Org Sell Foreign Currency","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '6';","5","Input Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","6995","1594","Org Sell Foreign Currency","var input = __input.response;
__params.PIN = input;
__next = '7';","6","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","6996","1594","Org Sell Foreign Currency","if (rateInfo.formatRate == null) {
  __next = 'error';
} else {
var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}
}","7","Confirm","<html>
<body>
$$rateInfo = TC.queryFxRateAndAmount(__params.SourceCurrency, __params.DestinationCurrency,__params.BaseCurrency,__params.BaseAmount);
You are going to sell [${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}],[${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}] will be credit to your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","6998","1595","Cancel Standing Order Schedule","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = msisdn;
__params.ActionType= 'DeleteIndividualReminderSchedule';
__params.ReceiverPartyIdentifierType = '01'; /* SP_ID */
__params.ReceiverPartyIdentifier = msisdn;
__params.NeedConfirmation= '0';
reminderList = IC.queryReminderListByMsisdn(__params);
if(empty(reminderList )|| size(reminderList )==0){
  __errormsg = 'no current schedules.';
 __next = 'error';
}else {
 __next = '1';
}","begin","Initialization","",""<endrec>
"CUSTOMER","","2","6999","1595","Cancel Standing Order Schedule","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(reminderList)) { 
__params.ReminderScheduleID =  reminderList.get(i).reminderId;
__params.ReminderScheduleName =  reminderList.get(i).reminderName;
__next = '2';
} else {
__next = '1';
}","1","Select Standing Order Schedule","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","7","1000","Buy Airtime","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Fee:${chargeFee = TC.queryCustomerCharge(__params)};<br>
To Pay ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${orgName} for account number ${__params.otherphone},the charge is ${chargeFee}.Press 1 to confirm or 0 to cancel.<br>
$$result = TC.calculateBudget(__params);
$$budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
$$var promptText = '';
$$feeList = budgetMap.fee;
$$if(!empty(feeList)){
$$	   i = 1;
$$	   sizeLen = size(feeList);
$$	  for(fee:feeList)
$$	  {
$$	   promptText = promptText+ 'The amount of charge is '+fee.amount;
$$	 
$$	   if(i < sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$		i = i+1 
$$	  }
$$}
$$   taxList = budgetMap.tax;
$$   if(!empty(taxList)){
$$	   i = 1;
$$	   sizeLen = size(taxList);
$$	  for(tax:taxList)
$$	  {
$$		 if(i ==1 &&  promptText != '')
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$
$$		promptText = promptText
$$	 + 'The amount of tax is '+tax.amount;
$$	   
$$	   if(i <sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   } 
$$	   i = i+1;
$$	  }
$$  }
Buy Airtime ${__params.otherphone} Ksh ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7000","1595","Cancel Standing Order Schedule","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '3';","2","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7001","1595","Cancel Standing Order Schedule","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '3';
}","3","Comfirm","<html>
<body>
Confirm to cancel reminder schedule:<br>
ReminderScheduleID:${__params.ReminderScheduleID}<br>
ReminderName:${__params.ReminderScheduleName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7002","1596","Cancel Standing Order Schedule By Group","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ActionType = 'DeleteGroupReminderSchedule';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.NeedConfirmation = '0';

__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7003","1596","Cancel Standing Order Schedule By Group","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
 for(group: groups){
  if(group.groupCode == input)
  {
    found = '0';
  }
 }
 if ( found == '1') {
    __errormsg = 'no current group or not belong to the group.';
    __next = 'error';
 }
 else
 {
  reminderList = IC.queryReminderListByMsisdn(__params);
  if(empty(reminderList )|| size(reminderList )==0){
    __errormsg = 'no current schedules.';
   __next = 'error';
  }else {
   __next = '2';
  }    
 }
}
else {
      __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7004","1596","Cancel Standing Order Schedule By Group","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(reminderList)) { 
__params.ReminderScheduleID =  reminderList.get(i).reminderId;
__params.ReminderScheduleName =  reminderList.get(i).reminderName;
DEBUG.error('ReminderScheduleID',__params.ReminderScheduleID);
__next = '3';
} else {
__next = '2';
}","2","Select Standing Order Schedule","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7005","1596","Cancel Standing Order Schedule By Group","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7006","1596","Cancel Standing Order Schedule By Group","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '4';
}","4","Comfirm","<html>
<body>
Confirm to cancel reminder schedule:<br>
ReminderScheduleID:${__params.ReminderScheduleID}<br>
ReminderName:${__params.ReminderScheduleName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7007","1597","Cancel Standing Order Schedule","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'DeleteIndividualReminderSchedule';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.NeedConfirmation= '0';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7008","1597","Cancel Standing Order Schedule","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
    __next = '2';
}
else
{
    __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7009","1597","Cancel Standing Order Schedule","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
  reminderList = IC.queryReminderListByMsisdn(__params);
  if(empty(reminderList )|| size(reminderList )==0){
   __errormsg = 'no current schedules.';
   __next = 'error';
  }else {
    __next = '3';
  }   
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","701","1007","Send Money","__params.ServiceCode = __service.serviceCode;
__params.ServiceForInitiateTransaction = __service.linkedServiceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
beneficiaries = IC.queryCustListBeneficiary(msisdn);
disName='';
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","4","7010","1597","Cancel Standing Order Schedule","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(reminderList)) { 
__params.ReminderScheduleID =  reminderList.get(i).reminderId;
__params.ReminderScheduleName =  reminderList.get(i).reminderName;
__next = '4';
} else {
__next = '3';
}","3","Select Standing Order Schedule","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (reminder: reminderList) {
    ${index} ${reminder.reminderName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7011","1597","Cancel Standing Order Schedule","var input = __input.response;
__params.@HEAD@PIN = input; 
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7012","1597","Cancel Standing Order Schedule","var input = __input.response;
if (input == '1') { 
__next = 'end';
} else if(input == '0'){
__next = 'cancel';
} else{
__next = '5';
}","5","Comfirm","<html>
<body>
Confirm to cancel reminder schedule:<br>
ReminderScheduleID:${__params.ReminderScheduleID}<br>
ReminderName:${__params.ReminderScheduleName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7013","1598","Organization Transfer from M-Pesa to Bank","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';   /* SHORT_CODE*/
__params.TransactionCategory = 'Bank_Card_Service';
__params.TransactionSubCategory = '1';
orgInfo = IC.queryByMsisdn(msisdn);
shortCode = IC.queryShortCodeByTillId(orgInfo.identityId);
__params.PrimaryPartyIdentifierType= '04';   /* SHORT_CODE*/
__params.PrimaryPartyIdentifier= shortCode;
fiOrgList = IC.queryFiOrgList(__params);
var IdentityType ='100';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","8","7014","1564","Group Transfer from Bank to M-Pesa","__params.BankAccountNo= __input.response;
__secure = true;
bankCardAttrList= IC.queryBankCardAttr(__params,'1000');
bankCardAttrLisSize = size(bankCardAttrList);
__params.FIAccountInfo = Util.buildMessage();
__params.FIAccountInfo.InfoDetail = Util.buildMessageList(bankCardAttrLisSize);
bankCardAttrListIndex = 1;
if (bankCardAttrLisSize > 0)
{
  __next = '8';
}
else
{
__next = '9';
}","7","Enter Bank Account","<html>
<body>
Enter Bank Account<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7015","1565","Organization Transfer from Bank to M-Pesa","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '9';","8","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","7016","1598","Organization Transfer from M-Pesa to Bank","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(fiOrgList)) {
   __params.ShortCode= fiOrgList.get(i).shortCode;
   __params.ReceiverPartyIdentifier = __params.ShortCode;
   __params.FIOrgIdentityId= fiOrgList.get(i).identityId;
   __next = '2';
} else {
   __next = '1';
}","1","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7017","1598","Organization Transfer from M-Pesa to Bank","var input = __input.response;
if (input == '1') {
  identifierTypeName = 'MSISDN';
  __params.BankCardOwnerInputType = '01';   /* MSISDN */
IdentityType = '1000';   /* SHORT_CODE*/
  __next = '3';
} else if (input == '2') {
  identifierTypeName = 'Organization Short Code';
  __params.BankCardOwnerInputType = '04';   /* SHORT_CODE*/

IdentityType = '5000';   /* SHORT_CODE*/
  __next = '3';
}else if (input == '3') {
  identifierTypeName = 'Group Code';
  __params.BankCardOwnerInputType = '15';   /* GROUP_CODE*/
IdentityType = '7000';   /* SHORT_CODE*/
  __next = '3';
}  else {
  __next = '2';
}","2","Select Receiver Type","<html>
<body>
Select Receiver Type:<br>
1 Customer <br>
2 Organization <br>
3 Group <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7018","1598","Organization Transfer from M-Pesa to Bank","var input = __input.response;
__params.BankCardOwnerInputValue = input;
__next = '4';","3","Enter Receiver","<html>
<body>
Enter Receiver ${identifierTypeName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7019","1598","Organization Transfer from M-Pesa to Bank","var input = __input.response;
if (input == '1') {
  __params.QueryIdentifierType = __params.PrimaryPartyIdentifierType;
  __params.QueryIdentifierValue = __params.PrimaryPartyIdentifier;
  bankLookupList = IC.queryBankLookupList(__params);
  __next = '5';
} else if (input == '2') {
  __next = '6';
}","4","Select or Enter Bank Account","<html>
<body>
1 Select form list <br>
2 Enter bank card <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","702","1007","Send Money","var input = __input.response;
if (input == '1')
{ 
    __next = '1a';
}else if (input == '2')
{
    __next = '1b';
}","1","Enter phone no","<html>
<body>
Choose the receiver <br>
1 Enter Phone No<br>
2 Use Beneficiary<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7020","1598","Organization Transfer from M-Pesa to Bank","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankLookupList)) {
   __params.BankCardId= bankLookup.BankCardId;
   __secure = true;
   __next = '8';
} else {
   __next = '6';
}","5","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankLookup:bankLookupList){
 ${index} ${bankLookup.AccountName}/${bankLookup.AccountNumber}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7021","1598","Organization Transfer from M-Pesa to Bank","__params.BankAccountNo= __input.response;
__secure = true;
bankCardAttrList= IC.queryBankCardAttr(__params,IdentityType);
bankCardAttrLisSize = size(bankCardAttrList);
__params.FIAccountInfo = Util.buildMessage();
__params.FIAccountInfo.InfoDetail = Util.buildMessageList(bankCardAttrLisSize);
bankCardAttrListIndex = 1;
if (bankCardAttrLisSize > 0)
{
  __next = '7';
}
else
{
__next = '8';
}","6","Enter Bank Account","<html>
<body>
Enter Bank Account<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7022","1598","Organization Transfer from M-Pesa to Bank","var input = __input.response;
if (bankCardAttrListIndex <= bankCardAttrLisSize){
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Key = bankCardAttrList.get(bankCardAttrListIndex-1).attrName;
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Value = input;
  bankCardAttrListIndex=bankCardAttrListIndex+1;
}
if(bankCardAttrLisSize < bankCardAttrListIndex){
  __next = '8';
}else{
  __next = '7';
}","7","Enter Bank Card Attr","<html>
<body>
Enter ${bankCardAttrList.get(bankCardAttrListIndex-1).attrName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7023","1598","Organization Transfer from M-Pesa to Bank","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '9';
} else {
    __next = '8';
}","8","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7024","1598","Organization Transfer from M-Pesa to Bank","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '10';","9","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","7025","1598","Organization Transfer from M-Pesa to Bank","var input = __input.response;
__params.PIN = input;
__secure = true;
__next = '11';","10","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","7026","1598","Organization Transfer from M-Pesa to Bank","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '11';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '12';
}","11","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","7027","1598","Organization Transfer from M-Pesa to Bank","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '12';
}","12","Confirm","<html>
<body>
Deposit Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountNo}${__params.BankCardId}<br>
Reciever : ${__params.ReceiverPartyIdentifier}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7028","1583","Group Transfer from M-Pesa to Bank","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '4';
} 
else{
  __next = '3';
}","3","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7029","1583","Group Transfer from M-Pesa to Bank","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(fiOrgList)) {
   __params.ShortCode= fiOrgList.get(i).shortCode;
   __params.ReceiverPartyIdentifier = __params.ShortCode;
   __params.FIOrgIdentityId= fiOrgList.get(i).identityId;
   __next = '5';
} else {
   __next = '4';
}","4","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","703","1007","Send Money","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7030","1583","Group Transfer from M-Pesa to Bank","var input = __input.response;
if (input == '1') {
  identifierTypeName = 'MSISDN';
  __params.BankCardOwnerInputType  = '01';   /* MSISDN */
IdentityType = '1000';   /* SHORT_CODE*/
  __next = '6';
} else if (input == '2') {
  identifierTypeName = 'Organization Short Code';
  __params.BankCardOwnerInputType = '04';   /* SHORT_CODE*/
IdentityType = '5000';   /* SHORT_CODE*/
  __next = '6';
}else if (input == '3') {
  identifierTypeName = 'Group Code';
  __params.BankCardOwnerInputType = '15';   /* GROUP_CODE*/
IdentityType = '7000';   /* SHORT_CODE*/
  __next = '6';
}  else {
  __next = '5';
}","5","Select Receiver Type","<html>
<body>
Select Receiver Type:<br>
1 Customer <br>
2 Organization <br>
3 Group <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7031","1583","Group Transfer from M-Pesa to Bank","var input = __input.response;
__params.BankCardOwnerInputValue = input;
__next = '7';","6","Enter Receiver","<html>
<body>
Enter Receiver ${identifierTypeName}<br><a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7032","1583","Group Transfer from M-Pesa to Bank","var input = __input.response;
if (input == '1') {
  __params.QueryIdentifierType = __params.PrimaryPartyIdentifierType;
  __params.QueryIdentifierValue = __params.PrimaryPartyIdentifier;
  bankLookupList = IC.queryBankLookupList(__params);
  __next = '8';
} else if (input == '2') {
  __next = '9';
}","7","Select or Enter Bank Account","<html>
<body>
1 Select form list <br>
2 Enter bank card <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7033","1583","Group Transfer from M-Pesa to Bank","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankLookupList)) {
   __params.BankCardId= bankLookup.BankCardId;
   __secure = true;
   __next = '11';
} else {
   __next = '8';
}","8","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankLookup:bankLookupList){
 ${index} ${bankLookup.AccountName}/${bankLookup.AccountNumber}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","7034","1583","Group Transfer from M-Pesa to Bank","__params.BankAccountNo = __input.response;
bankCardAttrList= IC.queryBankCardAttr(__params,IdentityType);
bankCardAttrLisSize = size(bankCardAttrList);
__params.FIAccountInfo = Util.buildMessage();
__params.FIAccountInfo.InfoDetail = Util.buildMessageList(bankCardAttrLisSize);
bankCardAttrListIndex = 1;
if (bankCardAttrLisSize > 0)
{
  __next = '10';
}
else
{
__next = '11';
}","9","Enter Bank Account","<html>
<body>
Enter Bank Account<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","7035","1583","Group Transfer from M-Pesa to Bank","var input = __input.response;
if (bankCardAttrListIndex <= bankCardAttrLisSize){
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Key = bankCardAttrList.get(bankCardAttrListIndex-1).attrName;
  __params.FIAccountInfo.InfoDetail[bankCardAttrListIndex-1].Value = input;
  bankCardAttrListIndex=bankCardAttrListIndex+1;
}
if(bankCardAttrLisSize < bankCardAttrListIndex){
  __next = '11';
}else{
  __next = '10';
}","10","Enter Bank Card Attr","<html>
<body>
Enter ${bankCardAttrList.get(bankCardAttrListIndex-1).attrName}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","7036","1583","Group Transfer from M-Pesa to Bank","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '12';
} else {
    __next = '11';
}","11","Enter Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","7037","1583","Group Transfer from M-Pesa to Bank","var input = __input.response;
__params.PIN = input;
__next = '13';","12","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","7038","1583","Group Transfer from M-Pesa to Bank","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '13';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '14';
}","13","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","7039","1583","Group Transfer from M-Pesa to Bank","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '14';
}","14","Confirm","<html>
<body>
Deposit Amount : ${__params.Amount}<br>
Bank Account : ${__params.BankAccountNo}${__params.BankCardId}<br>
Reciever : ${__params.ReceiverPartyIdentifier}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","704","1007","Send Money","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7040","1650","Customer Payment With Foreign Exchange","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.TransactionCategory = 'FX';
defaultCurrencyCode = IC.getDefaultCurrencyCode();
customerBeneficiaries = IC.queryCustListBeneficiary(msisdn);
groupBeneficiaries = IC.queryGroupListBeneficiary(msisdn);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7041","1650","Customer Payment With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifierType = '01'; 
  __next = '2a';
} else if(input == '2') {
  __params.ReceiverPartyIdentifierType = '15'; 
  __next = '2b';
} else if(input == '3') {
  __params.ReceiverPartyIdentifierType = '04'; 
  __next = '2c';
} else {
  __next = '1';
}","1","Select Receiver Type","<html>
<body>
Please select the receiver type: <br>
1 Customer <br>
2 Group <br>
3 Organization <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7042","1650","Customer Payment With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __next = '2a0';
} else if (input == '2') {
   if (empty(customerBeneficiaries  ) || size(customerBeneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2a1';
    }
} else {
   __next = '2a';
}","2a","Customer Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7043","1650","Customer Payment With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __next = '2b0';
} else if (input == '2') {
   if (empty(groupBeneficiaries ) || size(groupBeneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b1';
    }
} else {
   __next = '2b';
}","2b","Select Group Option","<html>
<body>
Please select option: <br>
1 Enter Recipient Group Code<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7044","1650","Customer Payment With Foreign Exchange","var input = __input.response;
if (empty(input)) { 
__next = '2c';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '3';
}","2c","Input Org Short Code","<html>
<body>
Please enter organization short code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7045","1650","Customer Payment With Foreign Exchange","var input = __input.response;
if (empty(input)) { 
__next = '2a0';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '3';
}","2a0","Input Msisdn","<html>
<body>
Enter customer msisdn<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7046","1650","Customer Payment With Foreign Exchange","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(customerBeneficiaries)){
  beneficiary= customerBeneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3';
} 
else{

  __next = '2a1';
}","2a1","Select Customer","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: customerBeneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7047","1650","Customer Payment With Foreign Exchange","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2b0';
}","2b0","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7048","1650","Customer Payment With Foreign Exchange","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groupBeneficiaries )){
  beneficiary= groupBeneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
  __next = '3';
} 
else{
  __next = '2b1';
}","2b1","Select Group","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: groupBeneficiaries ){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","7049","1650","Customer Payment With Foreign Exchange","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
		 DEBUG.error('tmp',tmp);
		 DEBUG.error('multiCurrencyCode',multiCurrencyCode);
		 DEBUG.error('defaultCurrencyCode',defaultCurrencyCode);
               type = multiCurrencyCode.get(tmp);
                __params.DestinationCurrency = type;
                __secure = true;
		DEBUG.error('defaultCurrencyCode==type',defaultCurrencyCode==type);
			if(defaultCurrencyCode==type)
			{
				__next = '4b';
			}else{
				__next = '4a';
			}
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Dest Currency","<html>
<body>
Select the destination currency you want to pay :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currency to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","705","1007","Send Money","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
IC.cnsCancelationProcess(__params.InitiatorIdentifierType,__params.InitiatorIdentifier);
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
$$chargeFee = TC.queryCustomerCharge(__params);
$$result = TC.calculateBudget(__params);
$$budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
$$var promptText = '';
$$feeList = budgetMap.fee;
$$if(!empty(feeList)){
$$	   i = 1;
$$	   sizeLen = size(feeList);
$$	  for(fee:feeList)
$$	  {
$$	   promptText = promptText+ 'The amount of charge is '+fee.amount;
$$	 
$$	   if(i < sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$		i = i+1 
$$	  }
$$}
$$   taxList = budgetMap.tax;
$$   if(!empty(taxList)){
$$	   i = 1;
$$	   sizeLen = size(taxList);
$$	  for(tax:taxList)
$$	  {
$$		 if(i ==1 &&  promptText != '')
$$	   {
$$		promptText = promptText + '<br>';
$$	   }
$$
$$		promptText = promptText
$$	 + 'The amount of tax is '+tax.amount;
$$	   
$$	   if(i <sizeLen)
$$	   {
$$		promptText = promptText + '<br>';
$$	   } 
$$	   i = i+1;
$$	  }
$$  }
 Send money to ${__params.ReceiverPartyIdentifier} ${disName2} Tsh${__params.Amount} <br>
${promptText } <br>
Test $(__params.InitiatorIdentifierType)$(__params.InitiatorIdentifier) <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","7050","1650","Customer Payment With Foreign Exchange","var input = __input.response;
if (input=='1') { 
__params.SourceCurrency = defaultCurrencyCode;
__next = '5';
} else {
__next = '4a';
}","4a","Select Source Currency","<html>
<body>
Select the source currency to pay from:<br>
1 ${defaultCurrencyCode}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","7051","1650","Customer Payment With Foreign Exchange","if (empty(multiForeignCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiForeignCurrencyCode)) {
               type = multiForeignCurrencyCode.get(tmp);
                __params.SourceCurrency = type;
                __secure = true;
                __next = '5';
         } else {
                __next = '4b';
         }
    } else {
        __next = '4b';
    }
}","4b","Select Foreign Source Currency","<html>
<body>
Select the source currency to pay from:<br>
$$multiForeignCurrencyCode = IC.getAllForeignCurrencyList();
$$if (empty(multiForeignCurrencyCode)) {
  You have no currency to query.
$$} else {
  $$var i = 1;
  $$for(type: multiForeignCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","7052","1650","Customer Payment With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __params.BaseCurrency = __params.SourceCurrency ;  
  __next = '6';
} else if(input == '2') {
  __params.BaseCurrency = __params.DestinationCurrency ;
   __next = '6';
} else {
  __next = '5';
}","5","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.SourceCurrency} <br>
2 Input the amount in ${__params.DestinationCurrency}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","7053","1650","Customer Payment With Foreign Exchange","var input = __input.response;
if (Validator.isAmountOfSpecialCurrency(input,__params.BaseCurrency)) {
__params.BaseAmount = TC.convertAmountFormat(input);
__secure = true;
multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'m-pesa',__params.SourceCurrency);
DEBUG.error('multiAccount',multiAccount);
DEBUG.error('identity.identityType',identity.identityType);
DEBUG.error('identity.identityId',identity.identityId);
DEBUG.error('__params.SourceCurrency',__params.SourceCurrency);
 __next = '7';
}
else {
 __next = '6';
}","6","Input Base Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","7054","1650","Customer Payment With Foreign Exchange","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.SourceAccount = type.AccountNo;
                __secure = true;
                __next = '8';
         } else {
                __next = '7';
         }
    } else {
        __next = '7';
    }
}","7","Select Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'',__params.SourceCurrency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","7055","1650","Customer Payment With Foreign Exchange","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","17","7056","1650","Customer Payment With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
$$rateInfo = TC.queryFxRateAndAmount(__params.SourceCurrency, __params.DestinationCurrency,__params.BaseCurrency,__params.BaseAmount);
You are going to pay [${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}] to ${__params.ReceiverPartyIdentifier},[${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}] will be debited from your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7057","1651","Group Payment With Foreign Exchange","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.TransactionCategory = 'FX';
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
defaultCurrencyCode = IC.getDefaultCurrencyCode();
customerBeneficiaries = IC.queryCustListBeneficiary(msisdn);
groupBeneficiaries = IC.queryGroupListBeneficiary(msisdn);
groups = IC.queryMyGroups(msisdn);
__next = '0';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7058","1651","Group Payment With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __next = '0a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '0b';
    }
} else {
   __next = '0';
}","0","My Group Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7059","1651","Group Payment With Foreign Exchange","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.PrimaryPartyIdentifier = input;
     __next = '1';     
   } 
else{
    __next = '0a';
}","0a","Enter My Group Code","<html>
<body>
Enter group code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7060","1651","Group Payment With Foreign Exchange","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '1';
} 
else{
  __next = '0b';
}","0b","Select My Group","<html>
<body>
Select my group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7061","1651","Group Payment With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifierType = '01'; 
  __next = '2a';
} else if(input == '2') {
  __params.ReceiverPartyIdentifierType = '15'; 
  __next = '2b';
} else if(input == '3') {
  __params.ReceiverPartyIdentifierType = '04'; 
  __next = '2c';
} else {
  __next = '1';
}","1","Select Receiver Type","<html>
<body>
Please select the receiver type: <br>
1 Customer <br>
2 Group <br>
3 Organization <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7062","1651","Group Payment With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __next = '2a0';
} else if (input == '2') {
   if (empty(customerBeneficiaries  ) || size(customerBeneficiaries  ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2a1';
    }
} else {
   __next = '2a';
}","2a","Select Customer Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7063","1651","Group Payment With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __next = '2b0';
} else if (input == '2') {
   if (empty(groupBeneficiaries ) || size(groupBeneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b1';
    }
} else {
   __next = '2b';
}","2b","Select Recipient Group Option","<html>
<body>
Please select option: <br>
1 Enter Recipient Group Code<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7064","1651","Group Payment With Foreign Exchange","var input = __input.response;
if (empty(input)) { 
__next = '2c';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '3';
}","2c","Enter Org Short Code","<html>
<body>
Please enter organization short code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7065","1651","Group Payment With Foreign Exchange","var input = __input.response;
if (empty(input)) { 
__next = '2a0';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '3';
}","2a0","Enter Customer Msisdn","<html>
<body>
Enter customer msisdn<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","7066","1651","Group Payment With Foreign Exchange","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(customerBeneficiaries)){
  beneficiary= customerBeneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3';
} 
else{

  __next = '2a1';
}","2a1","Select Customer","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: customerBeneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","7067","1651","Group Payment With Foreign Exchange","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2b0';
}","2b0","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","7068","1651","Group Payment With Foreign Exchange","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groupBeneficiaries )){
  beneficiary= groupBeneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
  __next = '3';
} 
else{
  __next = '2b1';
}","2b1","Select Receiver Group","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: groupBeneficiaries ){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","7070","1651","Group Payment With Foreign Exchange","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.DestinationCurrency = type;
                __secure = true;
   if(defaultCurrencyCode==type)
   {
                  __next = '4b';
   }else{
                  __next = '4a';
   }
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Dest Currency","<html>
<body>
Select the destination currency you want to pay :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currency to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","7071","1651","Group Payment With Foreign Exchange","var input = __input.response;
if (input=='1') { 
__params.SourceCurrency = defaultCurrencyCode;
__next = '5';
} else {
__next = '4a';
}","4a","Select Source Currency","<html>
<body>
Select the source currency to pay from:<br>
1 ${defaultCurrencyCode}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","7072","1651","Group Payment With Foreign Exchange","if (empty(multiForeignCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiForeignCurrencyCode)) {
               type = multiForeignCurrencyCode.get(tmp);
                __params.SourceCurrency = type;
                __secure = true;
                __next = '5';
         } else {
                __next = '4b';
         }
    } else {
        __next = '4b';
    }
}","4b","Select Foreign Source Currency","<html>
<body>
Select the source currency to pay from:<br>
$$multiForeignCurrencyCode = IC.getAllForeignCurrencyList();
$$if (empty(multiForeignCurrencyCode)) {
  You have no currency to query.
$$} else {
  $$var i = 1;
  $$for(type: multiForeignCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","16","7073","1651","Group Payment With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __params.BaseCurrency = __params.SourceCurrency ;  
  __next = '6';
} else if(input == '2') {
  __params.BaseCurrency = __params.DestinationCurrency ;
   __next = '6';
} else {
  __next = '5';
}","5","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.SourceCurrency} <br>
2 Input the amount in ${__params.DestinationCurrency}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","17","7074","1651","Group Payment With Foreign Exchange","var input = __input.response;
if (Validator.isAmountOfSpecialCurrency(input,__params.BaseCurrency)) {
__params.BaseAmount = TC.convertAmountFormat(input);
__secure = true;
 __next = '7';
}
else {
 __next = '6';
}","6","Input Base Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","18","7075","1651","Group Payment With Foreign Exchange","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.SourceAccount = type.AccountNo;
                __secure = true;
                __next = '8';
         } else {
                __next = '7';
         }
    } else {
        __next = '7';
    }
}","7","Select Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
$$multiAccount = IC.queryGroupMultiAccounts(__params.PrimaryPartyIdentifier ,'Group float',__params.SourceCurrency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","19","7076","1651","Group Payment With Foreign Exchange","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","20","7077","1651","Group Payment With Foreign Exchange","if (rateInfo.formatRate == null) {
  __next = 'error';
} else {
var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}
}","9","Confirm","<html>
<body>
$$rateInfo = TC.queryFxRateAndAmount(__params.SourceCurrency, __params.DestinationCurrency,__params.BaseCurrency,__params.BaseAmount);
You are going to pay [${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}] to ${__params.ReceiverPartyIdentifier},[${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}] will be debited from your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7078","1652","Organization Payment With Foreign Exchange","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Org Operator */
__params.TransactionCategory = 'FX';
defaultCurrencyCode = IC.getDefaultCurrencyCode();
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7079","1652","Organization Payment With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __params.ReceiverPartyIdentifierType = '01'; 
  __next = '2a';
} else if(input == '2') {
  __params.ReceiverPartyIdentifierType = '15'; 
  __next = '2b';
} else if(input == '3') {
  __params.ReceiverPartyIdentifierType = '04'; 
  __next = '2c';
} else {
  __next = '1';
}","1","Select Receiver Type","<html>
<body>
Please select the receiver type: <br>
1 Customer <br>
2 Group <br>
3 Organization <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7080","1652","Organization Payment With Foreign Exchange","var input = __input.response;
if (empty(input)) { 
__next = '2a';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '3';
}","2a","Enter Msisdn","<html>
<body>
Please enter msisdn<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7081","1652","Organization Payment With Foreign Exchange","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2b';
}","2b","Enter Group Code","<html>
<body>
Please enter group code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7082","1652","Organization Payment With Foreign Exchange","var input = __input.response;
if (empty(input)) { 
__next = '2c';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '3';
}","2c","Enter Org Short Code","<html>
<body>
Please enter organization short code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7083","1652","Organization Payment With Foreign Exchange","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.DestinationCurrency = type;
                __secure = true;
   if(defaultCurrencyCode==type)
   {
                  __next = '4b';
   }else{
                  __next = '4a';
   }
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Dest Currency","<html>
<body>
Select the destination currency you want to pay :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currency to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7084","1652","Organization Payment With Foreign Exchange","var input = __input.response;
if (input=='1') { 
__params.SourceCurrency = defaultCurrencyCode;
__next = '5';
} else {
__next = '4a';
}","4a","Select Source Currency","<html>
<body>
Select the source currency to pay from:<br>
1 ${defaultCurrencyCode}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7085","1652","Organization Payment With Foreign Exchange","if (empty(multiForeignCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiForeignCurrencyCode)) {
               type = multiForeignCurrencyCode.get(tmp);
                __params.SourceCurrency = type;
                __secure = true;
                __next = '5';
         } else {
                __next = '4b';
         }
    } else {
        __next = '4b';
    }
}","4b","Select Foreign Source Currency","<html>
<body>
Select the source currency to pay from:<br>
$$multiForeignCurrencyCode = IC.getAllForeignCurrencyList();
$$if (empty(multiForeignCurrencyCode)) {
  You have no currency to query.
$$} else {
  $$var i = 1;
  $$for(type: multiForeignCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7086","1652","Organization Payment With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __params.BaseCurrency = __params.SourceCurrency ;  
  __next = '6';
} else if(input == '2') {
  __params.BaseCurrency = __params.DestinationCurrency ;
   __next = '6';
} else {
  __next = '5';
}","5","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.SourceCurrency} <br>
2 Input the amount in ${__params.DestinationCurrency}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7087","1652","Organization Payment With Foreign Exchange","var input = __input.response;
if (Validator.isAmountOfSpecialCurrency(input,__params.BaseCurrency)) {
__params.BaseAmount = TC.convertAmountFormat(input);
__secure = true;
 __next = '7';
}
else {
 __next = '6';
}","6","Input Base Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","7088","1652","Organization Payment With Foreign Exchange","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.SourceAccount = type.AccountNo;
                __secure = true;
                __next = '8';
         } else {
                __next = '7';
         }
    } else {
        __next = '7';
    }
}","7","Select Account","<html>
<body>
Please select the paying account ${__params.SourceCurrency}:<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'org float',__params.SourceCurrency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","7089","1652","Organization Payment With Foreign Exchange","var input = __input.response;
if (empty(input)) { 
__next = '8';
} else {
__params.InitiatorIdentifier = input;
__next = '9';
}","8","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","7090","1652","Organization Payment With Foreign Exchange","var input = __input.response;
__params.PIN = input;
__next = '10';","9","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","14","7091","1652","Organization Payment With Foreign Exchange","if (rateInfo.formatRate == null) {
  __next = 'error';
} else {
var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}
}","10","Confirm","<html>
<body>
$$rateInfo = TC.queryFxRateAndAmount(__params.SourceCurrency, __params.DestinationCurrency,__params.BaseCurrency,__params.BaseAmount);
You are going to pay [${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}] to ${__params.ReceiverPartyIdentifier},[${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}] will be debited from your account. <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to Transfer?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7092","1653","Buy Goods With Foreign Exchange","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Org Operator */
__params.TransactionCategory = 'FX';
defaultCurrencyCode = IC.getDefaultCurrencyCode();
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7093","1653","Buy Goods With Foreign Exchange","var input = __input.response;
if (empty(input)) { 
__next = '1';
} else {
  __params.ReceiverPartyIdentifierType = '03'; 
  __params.ReceiverPartyIdentifier = input; 
__next = '2';
}","1","Input Voucher Code","<html>
<body>
Please input voucher code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7094","1653","Buy Goods With Foreign Exchange","var input = __input.response;
__params.VoucherValidationValue = input;
__next = '3';","2","Input Verification Code","<html>
<body>
Please input verification code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7095","1653","Buy Goods With Foreign Exchange","var input = __input.response;
__params.VoucherSecretCode = input;
__next = '4';","3","Input Serect Code","<html>
<body>
Please input secret code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7096","1653","Buy Goods With Foreign Exchange","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.DestinationCurrency = type;
                __secure = true;
   if(defaultCurrencyCode==type)
   {
                  __next = '4b';
   }else{
                  __next = '4a';
   }
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Select Dest Currency","<html>
<body>
Select the currency you want to receive :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no currency to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7097","1653","Buy Goods With Foreign Exchange","var input = __input.response;
if (input=='1') { 
__params.SourceCurrency = defaultCurrencyCode;
__next = '5';
} else {
__next = '4a';
}","4a","Select Source Currency","<html>
<body>
Select the source currency to pay from:<br>
1 ${defaultCurrencyCode}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7098","1653","Buy Goods With Foreign Exchange","if (empty(multiForeignCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiForeignCurrencyCode)) {
               type = multiForeignCurrencyCode.get(tmp);
                __params.SourceCurrency = type;
                __secure = true;
                __next = '5';
         } else {
                __next = '4b';
         }
    } else {
        __next = '4b';
    }
}","4b","Select Foreign Source Currency","<html>
<body>
Select the source currency to pay from:<br>
$$multiForeignCurrencyCode = IC.getAllForeignCurrencyList();
$$if (empty(multiForeignCurrencyCode)) {
  You have no currency to query.
$$} else {
  $$var i = 1;
  $$for(type: multiForeignCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7099","1653","Buy Goods With Foreign Exchange","var input = __input.response;
if (input == '1') {
  __params.BaseCurrency = __params.SourceCurrency ;  
  __next = '6';
} else if(input == '2') {
  __params.BaseCurrency = __params.DestinationCurrency ;
   __next = '6';
} else {
  __next = '5';
}","5","Select Base Currency","<html>
<body>
1 Input the amount in ${__params.SourceCurrency} <br>
2 Input the amount in ${__params.DestinationCurrency}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7100","1653","Buy Goods With Foreign Exchange","var input = __input.response;
if (Validator.isAmountOfSpecialCurrency(input,__params.BaseCurrency)) {
__params.BaseAmount = TC.convertAmountFormat(input);
__secure = true;
 __next = '7';
}
else {
 __next = '6';
}","6","Input Amount","<html>
<body>
Please input the amount in ${__params.BaseCurrency} : <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7101","1653","Buy Goods With Foreign Exchange","var input = __input.response;
if (empty(input)) { 
__next = '7';
} else {
__params.InitiatorIdentifier = input;
__next = '8';
}","7","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","7102","1653","Buy Goods With Foreign Exchange","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","7103","1653","Buy Goods With Foreign Exchange","if (rateInfo.formatRate == null) {
  __next = 'error';
} else {
var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}
}","9","Confirm","<html>
<body>
$$rateInfo = TC.queryFxRateAndAmount(__params.SourceCurrency, __params.DestinationCurrency,__params.BaseCurrency,__params.BaseAmount);
You are going to receive [${rateInfo.destinationCurrency} ${rateInfo.destinationAmount}],equal [${rateInfo.sourceCurrency} ${rateInfo.sourceAmount}] . <br>
The FX rate is ${rateInfo.formatRate}.<br>
Confirm to that?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7105","1524","Create Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.FIAccountInfo.InfoDetail[attrIndex].Key = attrList[attrIndex];
  __params.FIAccountInfo.InfoDetail[attrIndex].Value = input;

  attrIndex = attrIndex + 1;
  if(attrIndex < size(attrList)) {
    __next = '6';
  } else {
    __next = '7';
  }
} else {
  __next = '6';
}","6","Enter Bank Account Info","<html>
<body>
Enter ${attrList[attrIndex]}:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7106","1527","Create Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.FIAccountInfo.InfoDetail[attrIndex].Key = attrList[attrIndex];
  __params.FIAccountInfo.InfoDetail[attrIndex].Value = input;

  attrIndex = attrIndex + 1;
  if(attrIndex < size(attrList)) {
    __next = '7';
  } else {
    __next = '8';
  }
} else {
  __next = '7';
}","7","Enter Bank Account Info","<html>
<body>
Enter ${attrList[attrIndex]}:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7107","1585","Query Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7110","1654","Create Group Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'CreateIdentityBankAccount';
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;  

isMultiCurrency = Util.isMultiCurrency();
items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;
attrList = IC.queryBankCardAttr('7000');
attrIndex = 0;
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","7111","1654","Create Group Bank Account","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '1';
}","1","Select Group","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7112","1654","Create Group Bank Account","var input = __input.response;
var found = '0';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '1';
}
}
if ( found == '0') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   __next = '2';
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7113","1654","Create Group Bank Account","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7114","1654","Create Group Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';
    __params.BankName = 'Others';
    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
        __params.BankName = item.defaultName;
    }

    if ( __params.BankId == '-1')
    {
   __params.FIAccountInfo = Util.buildMessage();
   __params.FIAccountInfo.InfoDetail = Util.buildMessageList(size(attrList));
    }

     bankList = IC.queryOrgBankList(__params.BankId);
    __next = '3';
} else {
  __next = '2';
}","2","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7115","1654","Create Group Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankList)) {
    bank = bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '4';
} else {
  __next = '3';
}","3","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7116","1654","Create Group Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.AccountName = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Account Name","<html>
<body>
Enter Account Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7117","1654","Create Group Bank Account","var input = __input.response;

if (!empty(input))
{
  __params.AccountNumber = input;
 
if(isMultiCurrency && _params.bankId != '-1') 
{
    currencys = IC.getAllCurrencyList();
    __next = '6';
}
if (size(attrList) > 0 && __params.BankId == '-1')
{
    __next = '7';
}
if (size(attrList) == 0 || __params.BankId != '-1') 
{
  __next = '8';
}
} else {
  __next = '5';
}","5","Enter Account Number","<html>
<body>
Enter Account Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7118","1654","Create Group Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(currencys)) {
    __params.Currency = currencys.get(i);

    __next = '8';
} else {
  __next = '6';
}","6","Select Currency","<html>
<body>
Select Currency:<br>
$$ var index = 1;
$$ for (currency:currencys){
 ${index} ${currency}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","7119","1654","Create Group Bank Account","var input = __input.response;
if (!empty(input)) {
  __params.FIAccountInfo.InfoDetail[attrIndex].Key = attrList[attrIndex];
  __params.FIAccountInfo.InfoDetail[attrIndex].Value = input;

  attrIndex = attrIndex + 1;
  if(attrIndex < size(attrList)) {
    __next = '7';
  } else {
    __next = '8';
  }
} else {
  __next = '7';
}","7","Enter Bank Account Info","<html>
<body>
Enter ${attrList[attrIndex]}:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","7120","1654","Create Group Bank Account","var input = __input.response;
if (input == '1') {
  __next = '9';
} else if(input == '0') {
  __next = '1';
} else {
  __next = '8';
}","8","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${__params.BankName}<br>
Branch:${__params.BranchName}<br>
Account Name:${__params.AccountName}<br>
Account Number:${__params.AccountNumber}<br>
$$ if(isMultiCurrency) {
Currency:${__params.Currency}<br>
$$ }
$$ if(size(attrList) > 0 && __params.BankId == '-1') {
$$ for (detail:__params.FIAccountInfo.InfoDetail){
${detail.Key}:${detail.Value}<br>
$$ }
$$ }
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","7121","1654","Create Group Bank Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '10';
} else {
    __secure = true;
    __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","7122","1654","Create Group Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","10","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7123","1655","Delete Group Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'DeleteIdentityBankAccount';
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn; 
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","7124","1655","Delete Group Bank Account","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '1';
}","1","Select Group","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7125","1655","Delete Group Bank Account","var input = __input.response;
var found = '0';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '1';

  bankAccountList = IC.queryBankAccountList('15', input, '');
}
}
if ( found == '0') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   __next = '2';
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7126","1655","Delete Group Bank Account","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
   bankAccountList = IC.queryBankAccountList('15', groupCode, ''); 
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Group","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7127","1655","Delete Group Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccountList)) {
    bankAccount = bankAccountList.get(i);
    __params.BankCardId = bankAccount.bankCardId;

    __next = '3';
} else {
  __next = '2';
}","2","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankAccount:bankAccountList){
 ${index} ${bankAccount.accountName}/${bankAccount.accountNumber}(${bankAccount.Currency},${bankAccount.branchName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7128","1655","Delete Group Bank Account","var input = __input.response;
if (input == '1') {
  __next = '4';
} else if(input == '0') {
  __next = '2';
} else {
  __next = '3';
}","3","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${bankAccount.bankName}<br>
Branch:${bankAccount.branchName}<br>
Account Name:${bankAccount.accountName}<br>
Account Number:${bankAccount.accountNumber}<br>
Currency:${bankAccount.Currency}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7129","1655","Delete Group Bank Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7130","1655","Delete Group Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7131","1656","Query Group Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'QueryIdentityBankAccount';
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* SHORT_CODE */
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;  
items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;
groups = IC.queryMyGroups(msisdn);

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","7132","1656","Query Group Bank Account","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '1';
}","1","Select Group","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7133","1656","Query Group Bank Account","var input = __input.response;
var found = '0';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '1';
}
}
if ( found == '0') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   __next = '2';
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7134","1656","Query Group Bank Account","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7135","1656","Query Group Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';
    __params.BankName = 'Others';
    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
        __params.BankName = item.defaultName;
    }

     bankList = IC.queryOrgBankList(__params.BankId);
    __next = '3';
} else {
  __next = '2';
}","2","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7136","1656","Query Group Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankList)) {
    bank = bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '4';
} else {
  __next = '3';
}","3","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7137","1656","Query Group Bank Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7138","1656","Query Group Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7139","1657","Set Default Group Bank Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'SetIdentityBankAccount';
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15';  /* SHORT_CODE */
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","7140","1657","Set Default Group Bank Account","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '1';
}","1","Select Group","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7141","1657","Set Default Group Bank Account","var input = __input.response;
var found = '0';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '1';
  bankAccountList = IC.queryBankAccountWithoutOrg('15', input, '');
}
}
if ( found == '0') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   __next = '2';
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7142","1657","Set Default Group Bank Account","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  bankAccountList = IC.queryBankAccountWithoutOrg('15', groupCode, ''); 
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Group","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7143","1657","Set Default Group Bank Account","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankAccountList)) {
    bankAccount = bankAccountList.get(i);
    __params.BankCardId = bankAccount.bankCardId;

    __next = '3';
} else {
  __next = '2';
}","2","Select Bank Account","<html>
<body>
Select Bank Account:<br>
$$ var index = 1;
$$ for (bankAccount:bankAccountList){
 ${index} ${bankAccount.accountName}/${bankAccount.accountNumber}(${bankAccount.Currency},${bankAccount.branchName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7144","1657","Set Default Group Bank Account","var input = __input.response;
if (input == '1') {
  __next = '4';
} else if(input == '0') {
  __next = '1';
} else {
  __next = '3';
}","3","Confirm Bank Account","<html>
<body>
Confirm Bank Account<br><br>
Bank:${bankAccount.bankName}<br>
Branch:${bankAccount.branchName}<br>
Account Name:${bankAccount.accountName}<br>
Account Number:${bankAccount.accountNumber}<br>
Currency:${bankAccount.Currency}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7145","1657","Set Default Group Bank Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7146","1657","Set Default Group Bank Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7148","1660","Group Edit Direct Debit Mandate","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = msisdn;
__params.ActionType= 'EditGroupDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.MandateStatus = '02,03';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7149","1660","Group Edit Direct Debit Mandate","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","1","select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7150","1660","Group Edit Direct Debit Mandate","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '0';
}
}
if ( found == '1') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   mandateList = IC.queryDirectDebitMandateByPayer(__params);
  if(empty(mandateList )|| size(mandateList )==0){
   __errormsg = 'No Available Mandates.';
   __next= 'error';
  }else {
  __next = '2';
  }
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7151","1660","Group Edit Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  mandateList = IC.queryDirectDebitMandateByPayer(__params);
  if(empty(mandateList )|| size(mandateList )==0){
   __errormsg = 'No Available Mandates.';
   __next= 'error';
  }else {
  __next = '2';
  }
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7152","1660","Group Edit Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__params.PayeeName =  mandateList.get(i).payeeName;
__next = '3';
} else {
__next = '2';
}","2","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7153","1660","Group Edit Direct Debit Mandate","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7154","1660","Group Edit Direct Debit Mandate","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7156","1661","Group Cancel Direct Debit Mandate","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = msisdn;
__params.ActionType= 'CancelGroupDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.MandateStatus = '02,03';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7157","1661","Group Cancel Direct Debit Mandate","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","1","select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7158","1661","Group Cancel Direct Debit Mandate","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '0';
}
}
if ( found == '1') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   mandateList = IC.queryDirectDebitMandateByPayer(__params);
  if(empty(mandateList )|| size(mandateList )==0){
   __errormsg = 'No Available Mandates.';
   __next= 'error';
  }else {
  __next = '2';
  }
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7159","1661","Group Cancel Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  mandateList = IC.queryDirectDebitMandateByPayer(__params);
  if(empty(mandateList )|| size(mandateList )==0){
   __errormsg = 'No Available Mandates.';
   __next= 'error';
  }else {
  __next = '2';
  }
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7160","1661","Group Cancel Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__params.PayeeName =  mandateList.get(i).payeeName;
__next = '3';
} else {
__next = '2';
}","2","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7161","1661","Group Cancel Direct Debit Mandate","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7162","1661","Group Cancel Direct Debit Mandate","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7163","1662","Group Reactivate Direct Debit Mandate","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ReceiverIdentifierType = '01'; /* MSISDN */
__params.ReceiverIdentifier = msisdn;
__params.ActionType= 'ReactivateGroupDirectDebitMandateByPayer';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.RequesterIdentifierType  = ""01"";
__params.RequesterIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.MandateStatus = '04';
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7164","1662","Group Reactivate Direct Debit Mandate","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","1","select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7165","1662","Group Reactivate Direct Debit Mandate","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '0';
}
}
if ( found == '1') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   mandateList = IC.queryDirectDebitMandateByPayer(__params);
  if(empty(mandateList )|| size(mandateList )==0){
   __errormsg = 'No Available Mandates.';
   __next= 'error';
  }else {
  __next = '2';
  }
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7166","1662","Group Reactivate Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  mandateList = IC.queryDirectDebitMandateByPayer(__params);
  if(empty(mandateList )|| size(mandateList )==0){
   __errormsg = 'No Available Mandates.';
   __next= 'error';
  }else {
  __next = '2';
  }
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7167","1662","Group Reactivate Direct Debit Mandate","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__params.PayeeName =  mandateList.get(i).payeeName;
__next = '3';
} else {
__next = '2';
}","2","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7168","1662","Group Reactivate Direct Debit Mandate","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7169","1662","Group Reactivate Direct Debit Mandate","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7173","1663","Create Group Bank Card Lookup","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'CreateIdentityBankCardLookup';
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';    /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15';     /* SHORT_CODE */
__params.RequesterIdentifierType  = '01';    /* MSISDN */
__params.RequesterIdentifier = msisdn;

groups = IC.queryMyGroups(msisdn);

items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;
attrList = IC.queryBankCardAttr('7000');
__params.FIAccountInfo = Util.buildMessage();
__params.FIAccountInfo.InfoDetail = Util.buildMessageList(size(attrList));

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","7174","1663","Create Group Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '3';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7175","1663","Create Group Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifier = input;

    __next = '4';
}else {
    __next = '2';
}","2","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7176","1663","Create Group Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(groups)){
    group= groups.get(i);
    groupCode= group.groupCode;
    __params.ReceiverPartyIdentifier = groupCode;

    __next = '4';
}else {
  __next = '3';
}","3","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7177","1663","Create Group Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';
    __params.BankName = 'Others';
    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
        __params.BankName = item.defaultName;
    }
    bankList = IC.queryOrgBankList(__params.BankId);

    __next = '5';
} else {
  __next = '4';
}","4","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7178","1663","Create Group Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankList)) {
    bank = bankList.get(i);
    __params.BankBranchId = bank.BranchId;
    __params.BranchName = bank.BranchName;

    __next = '6';
} else {
  __next = '5';
}","5","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7179","1663","Create Group Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.AccountName = input;
  __next = '7';
} else {
  __next = '6';
}","6","Enter Lookup Name","<html>
<body>
Enter Lookup Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7180","1663","Create Group Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.AccountNumber = input;
  if(size(attrList) > 0) {
    index = 0;
    __next = '8';
  } else {
    __next = '9';
  }
} else {
  __next = '7';
}","7","Enter Lookup Card No.","<html>
<body>
Enter Lookup Card No.:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7181","1663","Create Group Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
  __params.FIAccountInfo.InfoDetail[index].Key = attrList[index];
  __params.FIAccountInfo.InfoDetail[index].Value = input;

  index = index + 1;
  if(index < size(attrList)) {
    __next = '8';
  } else {
    __next = '9';
  }
} else {
  __next = '8';
}","8","Enter FI Account Info","<html>
<body>
Enter ${attrList[index]}:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","7182","1663","Create Group Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = '10';
} else if(input == '0') {
  __next = '4';
} else {
  __next = '9';
}","9","Confirm Bank Card Lookup","<html>
<body>
Confirm Bank Card Lookup<br><br>
Bank:${__params.BankName}<br>
Bank Branch:${__params.BranchName}<br>
Lookup Name:${__params.AccountName}<br>
Lookup Card No.:${__params.AccountNumber}<br>
<br>
$$ for (obj:__params.FIAccountInfo.InfoDetail){
${obj.Key}:${obj.Value}<br>
$$ }
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","7183","1663","Create Group Bank Card Lookup","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '11';
} else {
    __secure = true;
    __next = '10';
}","10","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","7184","1663","Create Group Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","11","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7185","1664","Delete Group Bank Card Lookup","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'DeleteIdentityBankCardLookup';
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';    /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15';    /* SHORT_CODE */
__params.RequesterIdentifierType  = ""01"";    /* MSISDN */
__params.RequesterIdentifier = msisdn;

groups = IC.queryMyGroups(msisdn);

__params.QueryIdentifierType = '15';    /* SHORT_CODE */

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","7186","1664","Delete Group Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '3';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7187","1664","Delete Group Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifier = input;

    __params.QueryIdentifierValue = input;
    bankLookupList = IC.queryBankLookupList(__params);

    __next = '4';
}else {
    __next = '2';
}","2","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7188","1664","Delete Group Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(groups)) {
    group= groups.get(i);
    groupCode= group.groupCode;
    __params.ReceiverPartyIdentifier = groupCode;

    __params.QueryIdentifierValue = groupCode;
    bankLookupList = IC.queryBankLookupList(__params);

    __next = '4';
}else {
     __next = '3';
}","3","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7189","1664","Delete Group Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankLookupList)) {
    bankLookup = bankLookupList.get(i);
    __params.BankCardId = bankLookup.BankCardId;

    __next = '5';
} else {
  __next = '4';
}","4","Select Bank Card Lookup","<html>
<body>
Select Bank Card Lookup:<br>
$$ var index = 1;
$$ for (bankLookup:bankLookupList){
 ${index} ${bankLookup.AccountName}/${bankLookup.AccountNumber}(${bankLookup.BankBranchName})<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7190","1664","Delete Group Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = '6';
} else if(input == '0') {
  __next = '4';
} else {
  __next = '5';
}","5","Confirm Bank Card Lookup","<html>
<body>
Confirm Bank Card Lookup<br><br>
Bank:${bankLookup.BankName}<br>
Bank Branch:${bankLookup.BankBranchName}<br>
Lookup Name:${bankLookup.AccountName}<br>
Lookup Card No.:${bankLookup.AccountNumber}<br>
<br>
1 OK<br>
0 Back<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7191","1664","Delete Group Bank Card Lookup","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7192","1664","Delete Group Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7193","1665","Query Group Bank Card Lookup","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'QueryIdentityBankCardLookup';
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';    /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15';    /* SHORT_CODE */
__params.RequesterIdentifierType  = ""01"";    /* MSISDN */
__params.RequesterIdentifier = msisdn;

groups = IC.queryMyGroups(msisdn);

items = Util.queryDataDictTypeByKey('BANK_CATEGORY').items;

__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","7194","1665","Query Group Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '3';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7195","1665","Query Group Bank Card Lookup","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifier = input;

    __next = '4';
}else {
    __next = '2';
}","2","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7196","1665","Query Group Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(groups)) {
    group= groups.get(i);
    groupCode= group.groupCode;
    __params.ReceiverPartyIdentifier = groupCode;

    __next = '4';
}else {
    __next = '3';
}","3","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7197","1665","Query Group Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i <= size(items)) {
    __params.BankId = '-1';

    if(i < size(items)) {
        item = items.get(i);
        __params.BankId = item.value;
    }

    bankList = IC.queryOrgBankList(__params.BankId);

    __next = '5';
} else {
  __next = '4';
}","4","Select Bank","<html>
<body>
Select Bank:<br>
$$ var index = 1;
$$ for (item:items){
 ${index} ${item.defaultName}<br>
$$ index = index + 1;
$$ }
 ${index} Others
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7198","1665","Query Group Bank Card Lookup","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(bankList)) {
    bank = bankList.get(i);
    __params.BankBranchId = bank.BranchId;

    __next = '6';
} else {
  __next = '5';
}","5","Select Bank Branch","<html>
<body>
Select Bank Branch:<br>
$$ var index = 1;
$$ for (bank:bankList){
 ${index} ${bank.BranchName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7199","1665","Query Group Bank Card Lookup","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7200","1665","Query Group Bank Card Lookup","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7204","1600","Create Standing Order Schedule With Short Code","__params.ServiceCode = __service.serviceCode;
__params.ServiceForInitiateTransaction = __service.linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */
__params.NeedConfirmation = '0';
amap = { ""1"" : ""One Off"", ""2"" : ""Daily"", ""3"" : ""Weekly"", ""4"": ""4-Weekly"" ,""5"" : ""Monthly"", ""6"" : ""Bi Monthly"", ""7"" : ""Quarterly"", ""8"": ""Half Yearly"", ""9"": ""Yearly""}; 
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7205","1600","Create Standing Order Schedule With Short Code","var input = __input.response;
if (!empty(input) &&Validator.isNonzeroAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7206","1600","Create Standing Order Schedule With Short Code","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7207","1600","Create Standing Order Schedule With Short Code","var input = __input.response;
__params.ExtraParameter.BillReferenceNumber = input;
__next = '4';","3","Enter Bill No","<html>
<body>
Enter Bill No:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7208","1600","Create Standing Order Schedule With Short Code","var input = __input.response;
if(Validator.isMatchRegex(input ,'^([a-zA-Z0-9_\.\-\,\-\;\-]){0,64}$'))
{
 __params.FreeText = input;
 __next = '5';
}
else
{
__next = '4';
}","4","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7209","1600","Create Standing Order Schedule With Short Code","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7210","1600","Create Standing Order Schedule With Short Code","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '6';
} else {
 __params.FirstPaymentReminderDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '7';
}","6","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7211","1600","Create Standing Order Schedule With Short Code","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '7';
} else {
 __params.IssuePaymentReminderUntil = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '8';
}","7","Enter Issue Reminder Date Until","<html>
<body>
Enter Issue Reminder Date Until(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7212","1600","Create Standing Order Schedule With Short Code","var input=__input.response;
if(!empty(input) && (input >= 0)&&(input <= 9))
{
 __params.Frequency = __input.response;
FrequencyName = amap.get(input);
 __next = '9';
}
else
{
__next = '8';
}","8","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","7214","1600","Create Standing Order Schedule With Short Code","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-1])$'))
{
 __params.SendNotification = input ;
  if(input =='0')
 {
  __next = '11';
 }
 else
 {
   __next = '10';
 }
}
else {
 __next = '9';
}","9","Sending Pre-warning Notification","<html>
<body>
Sending Pre-warning Notification<br>
0 No<br>
1 Yes<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","7215","1600","Create Standing Order Schedule With Short Code","var input = __input.response;
if (!empty(input)) {
__params.Period = input;
  __next = '11';
} else {
  __next = '10';
}","10","Enter Pre-warning Period","<html>
<body>
Enter Pre-warning Period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","7216","1600","Create Standing Order Schedule With Short Code","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next ='12'
} else {
  __next = '11';
}","11","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","7217","1600","Create Standing Order Schedule With Short Code","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","12","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br>Amount: ${__params.Amount}<br>Short Code: ${__params.ReceiverPartyIdentifier}<br>Bill No: ${__params.ExtraParameter.BillReferenceNumber}<br>Free Text: ${__params.FreeText}<br>Reminder Name: ${__params.ReminderScheduleName}<br>First Date: ${__params.FirstPaymentReminderDate}<br>End Date: ${__params.IssuePaymentReminderUntil}<br>Frequency: ${FrequencyName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7219","1601","Create Standing Order Schedule With Short Code By Group","__params.ServiceCode = __service.serviceCode;
__params.ServiceForInitiateTransaction = __service.linkedServiceCode;
__params.ActionType = 'CreateGroupReminderSchedule';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */
groups = IC.queryMyGroups(msisdn);
__params.NeedConfirmation = '0';
__params.RequesterIdentifierType = '15'; /* Group Code */
__params.NeedConfirmation = '0';
amap = { ""1"" : ""One Off"", ""2"" : ""Daily"", ""3"" : ""Weekly"", ""4"": ""4-Weekly"" ,""5"" : ""Monthly"", ""6"" : ""Bi Monthly"", ""7"" : ""Quarterly"", ""8"": ""Half Yearly"", ""9"": ""Yearly""}; 
__next = '5';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7220","1601","Create Standing Order Schedule With Short Code By Group","var input = __input.response;
if (!empty(input) &&Validator.isNonzeroAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7221","1601","Create Standing Order Schedule With Short Code By Group","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7222","1601","Create Standing Order Schedule With Short Code By Group","var input = __input.response;
__params.ExtraParameter.BillReferenceNumber = input;
__next = '4';","3","Enter Bill No","<html>
<body>
Enter Bill No:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7223","1601","Create Standing Order Schedule With Short Code By Group","var input = __input.response;
if(Validator.isMatchRegex(input ,'^([a-zA-Z0-9_\.\-\,\-\;\-]){0,64}$'))
{
 __params.FreeText = input;
 __next = '12';
}
else
{
__next = '4';
}","4","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7224","1601","Create Standing Order Schedule With Short Code By Group","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7225","1601","Create Standing Order Schedule With Short Code By Group","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '6';
} else {
 __params.FirstPaymentReminderDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '7';
}","6","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7226","1601","Create Standing Order Schedule With Short Code By Group","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '7';
} else {
 __params.IssuePaymentReminderUntil = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '8';
}","7","Enter Issue Reminder Date Until","<html>
<body>
Enter Issue Reminder Date Until(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7227","1601","Create Standing Order Schedule With Short Code By Group","var input=__input.response;
if(!empty(input) && (input >= 0)&&(input <= 9))
{
 __params.Frequency = __input.response;
FrequencyName = amap.get(input);
 __next = '9';
}
else
{
__next = '8';
}","8","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","7229","1601","Create Standing Order Schedule With Short Code By Group","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-1])$'))
{
 __params.SendNotification = input ;
  if(input =='0')
 {
  __next = '11';
 }
 else
 {
   __next = '10';
 }
}
else {
 __next = '9';
}","9","Sending Pre-warning Notification","<html>
<body>
Sending Pre-warning Notification<br>
0 No<br>
1 Yes<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","7230","1601","Create Standing Order Schedule With Short Code By Group","var input = __input.response;
if (!empty(input)) {
__params.Period = input;
  __next = '11';
} else {
  __next = '10';
}","10","Enter Pre-warning Period","<html>
<body>
Enter Pre-warning Period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","7231","1601","Create Standing Order Schedule With Short Code By Group","var input = __input.response;
var found = '1';
__params.RequesterIdentifier = input;
if (!empty(input)) {
 for(group: groups){
  if(group.groupCode == input)
  {
    found = '0';
  }
 }
 if ( found == '1') {
    __errormsg = 'no current group or not belong to the group.';
    __next = 'error';
 }
 else
 {
   __next = '1';
 }
}
else {
      __next = '11';
}","11","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","7232","1601","Create Standing Order Schedule With Short Code By Group","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '13';
} else {
  __next = '12';
}","12","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","7233","1601","Create Standing Order Schedule With Short Code By Group","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","13","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br>Amount: ${__params.Amount}<br>Short Code: ${__params.ReceiverPartyIdentifier}<br>Bill No: ${__params.ExtraParameter.BillReferenceNumber}<br>Free Text: ${__params.FreeText}<br>Reminder Name: ${__params.ReminderScheduleName}<br>First Date: ${__params.FirstPaymentReminderDate}<br>End Date: ${__params.IssuePaymentReminderUntil}<br>Frequency: ${FrequencyName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7234","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
if (!empty(input) &&Validator.isNonzeroAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7235","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7236","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
__params.ExtraParameter.BillReferenceNumber = input;
__next = '4';","3","Enter Bill No","<html>
<body>
Enter Bill No:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7237","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
if(Validator.isMatchRegex(input ,'^([a-zA-Z0-9_\.\-\,\-\;\-]){0,64}$'))
{
 __params.FreeText = input;
 __next = '5';
}
else
{
__next = '4';
}","4","Enter Free Text","<html>
<body>
Enter Free Text:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7238","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
if (!empty(input)) {
__params.ReminderScheduleName = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter Reminder Name","<html>
<body>
Enter Reminder Name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7239","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '6';
} else {
 __params.FirstPaymentReminderDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '7';
}","6","Enter First Payment Reminder Date","<html>
<body>
Enter First Payment Reminder Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7240","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '7';
} else {
 __params.IssuePaymentReminderUntil = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '8';
}","7","Enter Issue Reminder Date Until","<html>
<body>
Enter Issue Reminder Date Until(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7241","1602","Create Standing Order Schedule With Short Code By Org","var input=__input.response;
if(!empty(input) && (input >= 0)&&(input <= 9))
{
 __params.Frequency = __input.response;
FrequencyName = amap.get(input);
 __next = '9';
}
else
{
__next = '8';
}","8","Select Frequency","<html>
<body>
Please select Frequency: <br>
1 One Off<br>
2 Daily<br>
3 Weekly<br>
4 4-Weekly<br>
5 Monthly<br>
6 Bi Monthly<br>
7 Quarterly<br>
8 Half Yearly<br>
9 Yearly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","7243","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-1])$'))
{
 __params.SendNotification = input ;
  if(input =='0')
 {
  __next = '12';
 }
 else
 {
   __next = '11';
 }
}
else {
 __next = '10';
}","10","Sending Pre-warning Notification","<html>
<body>
Sending Pre-warning Notification<br>
0 No<br>
1 Yes<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","7244","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
if (!empty(input)) {
__params.Period = input;
  __next = '12';
} else {
  __next = '11';
}","11","Enter Pre-warning Period","<html>
<body>
Enter Pre-warning Period:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","14","7245","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '12';
} else {
  __next = '13';
 __params.InitiatorIdentifier = input;
}","12","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","15","7246","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
if (!empty(input)) {
__params.@HEAD@PIN = input;
  __next = '14';
} else {
  __next = '13';
}","13","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","16","7247","1602","Create Standing Order Schedule With Short Code By Org","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","14","Confirm","<html>
<body> Service: ${__params.ServiceForInitiateTransaction}<br>Amount: ${__params.Amount}<br>Short Code: ${__params.ReceiverPartyIdentifier}<br>Bill No: ${__params.ExtraParameter.BillReferenceNumber}<br>Free Text: ${__params.FreeText}<br>Reminder Name: ${__params.ReminderScheduleName}<br>First Date: ${__params.FirstPaymentReminderDate}<br>End Date: ${__params.IssuePaymentReminderUntil}<br>Frequency: ${FrequencyName}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7248","1103","Change Organization Advertisement","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'UpdateOrgAdv';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7249","1103","Change Organization Advertisement","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifier=input;  
serviceList = IC.queryOrgAdvServices(__params);
if ( !empty(serviceList) || size(serviceList)>0) {
  __next = '2';
}else {
   __errormsg = 'no service advertisement can change.';
   __next = 'error';
}
} else 
   {
      __next = '1';
   }","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7250","1103","Change Organization Advertisement","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(serviceList)){
 __params.ServiceCode = serviceList.get(i).serviceCode;
 __params.ServiceIndex = serviceList.get(i).serviceIndex;
__params.ServiceName= serviceList.get(i).serviceName;
  __next = '3';
  }else {
  __next = '2';
}","2","Select Service","<html>
<body>
Please Select Service:<br>
$$ var index = 1;
$$ for (service: serviceList){
 ${index} ${service.serviceName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7251","1103","Change Organization Advertisement","var input = __input.response;
__params.AdvText = input;
__params.UpdateItemList = IC.buildOrgAdvInfo(__params);
__next = '4';","3","Enter Advertisement Text","<html>
<body>
Enter Advertisement Text<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7252","1103","Change Organization Advertisement","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7253","1103","Change Organization Advertisement","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
__next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7254","1103","Change Organization Advertisement","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html><body>Change Organization(${__params.ReceiverPartyIdentifier}) Service(${__params.ServiceName}) Advertisement To ${__params.AdvText}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7255","1670","Org Edit Direct Debit Mandate By Payer","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'EditOrgDirectDebitMandateByPayer';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.MandateStatus = '02,03';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7256","1670","Org Edit Direct Debit Mandate By Payer","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input; 
   __next = '2';
}
else
{
    __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7257","1670","Org Edit Direct Debit Mandate By Payer","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
   mandateList = IC.queryDirectDebitMandateByPayer(__params);
if(empty(mandateList )|| size(mandateList )==0){
 __errormsg = 'No Available Mandates.';
__next = 'error';
}else {
  __next = '3';
}  
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7258","1670","Org Edit Direct Debit Mandate By Payer","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__params.PayeeName =  mandateList.get(i).payeeName;
__next = '4';
} else {
__next = '3';
}","3","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7259","1670","Org Edit Direct Debit Mandate By Payer","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7260","1670","Org Edit Direct Debit Mandate By Payer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7261","1671","Org Edit Direct Debit Mandate By Payee","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'EditOrgDirectDebitMandateByPayee';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.MandateStatus = '02,03';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7262","1671","Org Edit Direct Debit Mandate By Payee","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input; 
   __next = '2';
}
else
{
    __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7263","1671","Org Edit Direct Debit Mandate By Payee","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
    __next = '3';
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7264","1671","Org Edit Direct Debit Mandate By Payee","var input = __input.response;
if (!empty(input)) {
  __params.MandateID = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Mandate ID","<html>
<body>
Enter Mandate ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7265","1671","Org Edit Direct Debit Mandate By Payee","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '9';
} else {
    __secure = true;
    __next = '8';
}","8","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7266","1671","Org Edit Direct Debit Mandate By Payee","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7267","1672","Org Cancel Direct Debit Mandate By Payer","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CancelOrgDirectDebitMandateByPayer';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.MandateStatus = '02,03';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7268","1672","Org Cancel Direct Debit Mandate By Payer","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input; 
   __next = '2';
}
else
{
    __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7269","1672","Org Cancel Direct Debit Mandate By Payer","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
   mandateList = IC.queryDirectDebitMandateByPayer(__params);
if(empty(mandateList )|| size(mandateList )==0){
 __errormsg = 'No Available Mandates.';
__next = 'error';
}else {
  __next = '3';
}  
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7270","1672","Org Cancel Direct Debit Mandate By Payer","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__params.PayeeName =  mandateList.get(i).payeeName;
__next = '4';
} else {
__next = '3';
}","3","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7271","1672","Org Cancel Direct Debit Mandate By Payer","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7272","1672","Org Cancel Direct Debit Mandate By Payer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7273","1673","Org Cancel Direct Debit Mandate By Payee","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CancelOrgDirectDebitMandateByPayee';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.MandateStatus = '02,03';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7274","1673","Org Cancel Direct Debit Mandate By Payee","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input; 
   __next = '2';
}
else
{
    __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7275","1673","Org Cancel Direct Debit Mandate By Payee","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
    __next = '3';
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7276","1673","Org Cancel Direct Debit Mandate By Payee","var input = __input.response;
if (!empty(input)) {
  __params.MandateID = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Mandate ID","<html>
<body>
Enter Mandate ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7277","1673","Org Cancel Direct Debit Mandate By Payee","var input = __input.response;
if (!empty(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7278","1673","Org Cancel Direct Debit Mandate By Payee","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7279","1674","Org Reactivate Direct Debit Mandate By Payer","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ReactivateOrgDirectDebitMandateByPayer';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.MandateStatus = '04';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7280","1674","Org Reactivate Direct Debit Mandate By Payer","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input; 
   __next = '2';
}
else
{
    __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7281","1674","Org Reactivate Direct Debit Mandate By Payer","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
   mandateList = IC.queryDirectDebitMandateByPayer(__params);
if(empty(mandateList )|| size(mandateList )==0){
 __errormsg = 'No Available Mandates.';
 __next = 'error';
}else {
  __next = '3';
}  
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7282","1674","Org Reactivate Direct Debit Mandate By Payer","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(mandateList)) { 
__params.MandateID =  mandateList.get(i).mandateId;
__params.PayeeName =  mandateList.get(i).payeeName;
__next = '4';
} else {
__next = '3';
}","3","Select Direct Debit Mandate","<html>
<body>
Select Option:<br>
$$ var index = 1;
$$ for (mandate: mandateList) {
    ${index} ${mandate.mandateId}-${mandate.payeeName}<br>
    $$ index = index + 1;
 $$ } 
<a href=""${mobilemoneyURL}""  default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7283","1674","Org Reactivate Direct Debit Mandate By Payer","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7284","1674","Org Reactivate Direct Debit Mandate By Payer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7285","1675","Org Reactivate Direct Debit Mandate By Payee","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ReactivateOrgDirectDebitMandateByPayee';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.MandateStatus = '03';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7286","1675","Org Reactivate Direct Debit Mandate By Payee","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input; 
   __next = '2';
}
else
{
    __next = '1';
}","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7287","1675","Org Reactivate Direct Debit Mandate By Payee","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
    __next = '3';
}","2","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7288","1675","Org Reactivate Direct Debit Mandate By Payee","var input = __input.response;
if (!empty(input)) {
  __params.MandateID = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Mandate ID","<html>
<body>
Enter Mandate ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7289","1675","Org Reactivate Direct Debit Mandate By Payee","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7290","1675","Org Reactivate Direct Debit Mandate By Payee","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","7301","1579","Customer Transfer from M-Pesa to Bank","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(fiOrgList)) {
   __params.ShortCode= fiOrgList.get(i).shortCode;
   __params.ReceiverPartyIdentifier = __params.ShortCode;
   __params.FIOrgIdentityId= fiOrgList.get(i).identityId;
   __next = '2';
} else {
   __next = '1';
}","1","Select FI Organisation","<html>
<body>
Select FI Organisation:<br>
$$ var index = 1;
$$ for (fiOrg: fiOrgList) {
  ${index} ${fiOrg.shortCode} - ${fiOrg.identityName}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","7304","1676","initiate Direct Debit Transaction","var input = __input.response;
if (!empty(input)) {
__params.ReceiverPartyIdentifier = input;
__params.ReceiverPartyIdentifierType = '53'; /* REF Number */
__next = '2';
} else {
__next = '1';
}","1","Input reference number","<html>
<body>
Enter Reference Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7306","1602","Create Standing Order Schedule With Short Code By Org","__params.ServiceCode = __service.serviceCode;
__params.ServiceForInitiateTransaction = __service.linkedServiceCode;
__params.ActionType = 'CreateReminderSchedule';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* opid*/
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */
__params.NeedConfirmation = '0';
amap = { ""1"" : ""One Off"", ""2"" : ""Daily"", ""3"" : ""Weekly"", ""4"": ""4-Weekly"" ,""5"" : ""Monthly"", ""6"" : ""Bi Monthly"", ""7"" : ""Quarterly"", ""8"": ""Half Yearly"", ""9"": ""Yearly""}; 
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","6","7311","1660","Group Edit Direct Debit Mandate","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-1])$'))
{
__params.AgreedTC = input;
__secure = true;
 __next = '4';
}
else {
 __next = '3';
}","3","Agreed TC","<html>
<body>Please Select you have Agreed T:<br>
1 yes<br>
0 no<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7312","1670","Org Edit Direct Debit Mandate By Payer","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-1])$'))
{
__params.AgreedTC = input;
__secure = true;
 __next = '5';
}
else {
 __next = '4';
}","4","Agreed TC","<html>
<body>Please Select you have Agreed T:<br>
1 yes<br>
0 no<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7313","1671","Org Edit Direct Debit Mandate By Payee","var input = __input.response;
if(empty(input))
{
__next = '5';
}else if (Validator.isMatchRegex(input,'^(0[1-7])$')) {
__params.Frequency = input;
__next = '5';
} else {
__next = '4';
}","4","Enter Frequency","<html>
<body>
Enter Frequency <br>
01 One Off  <br>
02 Daily  <br>
03 Weekly  <br>
04 Monthly  <br>
05 Quarterly  <br>
06  Half Yearly  <br>
07  Yearly
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html",""<endrec>
"TILL","","6","7314","1671","Org Edit Direct Debit Mandate By Payee","var input = __input.response;
if (!empty(input) && !Validator.isDate(input, 'ddMMyyyy')){
__next = '5';
} else {
 __params.FirstPaymentDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '6';
}","5","Enter First Payment Date","<html>
<body>
Enter First Payment Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7315","1671","Org Edit Direct Debit Mandate By Payee","var input = __input.response;
if(empty(input) ) 
{
  __next = '7';
}
else if(Validator.isMatchRegex(input ,'^([1-9]|[1-2]\d|3[0-1])$'))
{
   __next = '7';
__params.StartRangeOfDays = input;

}else
{
    __next = '6';
}","6","Enter Start of Range of days","<html>
<body>
Enter Start of Range of days <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html",""<endrec>
"TILL","","8","7316","1671","Org Edit Direct Debit Mandate By Payee","var input = __input.response;
if(empty(input) ) 
{
  __next = '8';
}
else if(Validator.isMatchRegex(input ,'^([1-9]|[1-2]\d|3[0-1])$'))
{
   __next = '8';
__params.EndRangeOfDays = input;

}else
{
    __next = '7';
}","7","Enter End of Range of days","<html>
<body>
Enter End of Range of days <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7367","1677","Customer Self Update KYC","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'ChangeCustKYC';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7368","1677","Customer Self Update KYC","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input == '2') {
  __next = '3';
}else if (input == '3') {
  __next = '4';
}else {
  __next = '1';
}","1","Select Update KYC","<html>
<body>
Select Receiver Type:<br>
1 LastName <br>
2 DOB <br>
3 ID Details <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7369","1677","Customer Self Update KYC","var input = __input.response;
__params.LastName = input;
__next = '6';","2","Enter Last Name","<html>
<body>
Enter Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7370","1677","Customer Self Update KYC","var input = __input.response;
if (Validator.isDate(input, 'yyyyMMdd')) {
  __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
  __next = '6';
} else {
  __next = '3';
}","3","Enter Date of Birth","<html>
<body>
Enter Date of Birth(yyyyMMdd)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7371","1677","Customer Self Update KYC","var input = __input.response;
if (input == '1') {
  __params.CertificateType = '01'; /* National ID */
  __next = '5';
} else if (input == '2') {
  __params.CertificateType = '05'; /* Passport */
  __next = '5';
} else {
  __next = '4';
}","4","Identification Type","<html>
<body>
Identification Type<br>
1  National ID<br>
2  Passport<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7372","1677","Customer Self Update KYC","var input = __input.response;
__params.CertificateNumber = input;
__params.isCondition = 'true';
__next = '6';","5","Enter ID Number","<html>
<body>
Enter ID Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7373","1677","Customer Self Update KYC","var input = __input.response;
if (input == '1') {
  __next = '1';
} else if (input == '0') {
  __next = '7';
} else {
  __next = '6';
}","6","Continue Update Other KYC","<html><body>Continue Update Other KYC:<br>
1 YES<br>
0 NO<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7374","1677","Customer Self Update KYC","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo = IC.buildCustomerInfo(__params);
__next = '8';","7","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7375","1677","Customer Self Update KYC","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html><body>Customer ${__params.LastName}, ${__params.CertificateNumber}, ${__params.RequesterIdentifier}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7377","1678","OrgOperator Self Update KYC","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'ChangeOrgOperatorOwnKYC';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7378","1678","OrgOperator Self Update KYC","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input == '2') {
  __next = '3';
} else if (input == '3') {
  __next = '4';
} else {
  __next = '1';
}","1","Select Update KYC","<html>
<body>
Select Receiver Type:<br>
1 LastName <br>
2 DOB <br>
3 ID Details <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7379","1678","OrgOperator Self Update KYC","var input = __input.response;
__params.LastName = input;
__next = '6';","2","Enter Last Name","<html>
<body>
Enter Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7380","1678","OrgOperator Self Update KYC","var input = __input.response;
if (Validator.isDate(input, 'yyyyMMdd')) {
  __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
  __next = '6';
} else {
  __next = '3';
}","3","Enter Date of Birth","<html>
<body>
Enter Date of Birth(yyyyMMdd)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7381","1678","OrgOperator Self Update KYC","var input = __input.response;
if (input == '1') {
  __params.CertificateType = '01'; /* National ID */
  __next = '5';
} else if (input == '2') {
  __params.CertificateType = '05'; /* Passport */
  __next = '5';
} else {
  __next = '4';
}","4","Identification Type","<html>
<body>
Identification Type<br>
1  National ID<br>
2  Passport<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7382","1678","OrgOperator Self Update KYC","var input = __input.response;
__params.CertificateNumber = input;
__params.isCondition = 'true';
__next = '6';","5","Enter ID Number","<html>
<body>
Enter ID Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7383","1678","OrgOperator Self Update KYC","var input = __input.response;
if (input == '1') {
  __next = '1';
} else if (input == '0') {
  __next = '7';
} else {
  __next = '6';
}","6","Continue Update Other KYC","<html><body>Continue Update Other KYC:<br>
1 YES<br>
0 NO<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7384","1678","OrgOperator Self Update KYC","var input = __input.response;
__params.InitiatorIdentifier = input;
__params.ReceiverPartyIdentifier = input;
__secure = true;
__next = '8';","7","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7385","1678","OrgOperator Self Update KYC","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo = IC.buildCustomerInfo(__params);
__next = '9';","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7386","1678","OrgOperator Self Update KYC","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html><body>Customer ${__params.LastName}, ${__params.CertificateNumber}, ${__params.RequesterIdentifier}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7388","1513","Create Customer Bundle By Organization","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CreateCustomerBundleByOrganization';
__params.Status = '06';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.AssignType= '1';
__next = '1a';","begin","set parammeters","",""<endrec>
"TILL","","2","7391","1513","Create Customer Bundle By Organization","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifierType='01';
    __params.ReceiverPartyIdentifier=input;  
__next = '1';
} else 
   {
      __next = '1a';
   }","1a","Input Customer's MSISDN","<html>
<body>
Input Customer's MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7392","1513","Create Customer Bundle By Organization","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-3])$'))
{
__params.BundleType= input ;
__secure = true;
 __next = '3';
}
else {
 __next = '1';
}","1","Select Bundle Type","<html>
<body>Select Bundle Type:<br>
1 M-Pesa Bundle<br>
2 External Bundle<br>
3 Combined Bundle<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7394","1513","Create Customer Bundle By Organization","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '3';
} else {
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '4';
}","3","Enter Your Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7395","1513","Create Customer Bundle By Organization","if (empty(BundleList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(BundleList)) {
               type = BundleList.get(tmp);
                __params.BundleID = type.bundleId;
                __params.BundleName = type.bundleName;
                __params.Price= type.internalPrice;
                __params.Currency= type.Currency;
                __params.AutomaticRenewal= type.automaticRenewal;
                __params.BundleProvider= type.bundleProvider;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
    } else {
        __next = '4';
    }
}","4","Select a Bundle","<html>
<body>
Please select destination bundle :<br>
$$BundleList = IC.queryBundleforInteroperability(__params);
$$if (empty(BundleList )) {
  You have no bundle to subscribe.
$$} else {
  $$var i = 1;
  $$for(bundle: BundleList ) {
   ${i} ${bundle.bundleName} :(${bundle.internalPrice} ${bundle.Currency})
$$if (!empty(bundle.durationTimes)) {
 (${bundle.durationTimes} ${bundle.durationUnit})<br>
$$}else{
     <br>
$$}  
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7396","1513","Create Customer Bundle By Organization","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
    if(input =='1')
    {
            __secure = true;
            __next = '6';
    }
    else if(input =='2')
    {
            __secure = true;
            __params.EffectiveMode= '-1';
            __next = '7';
    }else {
          __next = '5';
}
}
else {
 __next = '5';
}","5","Select Effective Mode","<html>
<body>Select Effective Mode:<br>
1 Input days from today<br>
2 Next day of the same bundle expired<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7397","1513","Create Customer Bundle By Organization","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9]{1,3})$')){
     __params.EffectiveMode= input;
     __next = '7';     
   } 
else{
    __next = '6';
}","6","Input Days From Today","<html>
<body>Input days from today:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7398","1513","Create Customer Bundle By Organization","var input = __input.response;
if (input == '1') {
  __next = '8';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm Bundle Information","<html>
<body>
Please Confirm Bundle Information :<br>
     Bundle Name : ${__params.BundleName}<br>
$$if (!empty(__params.BundleProvider )) {
     Provider :${__params.BundleProvider}<br>
$$}
     Price : ${__params.Price} ${__params.Currency}<br>
$$if(__params.EffectiveMode=='-1'){
     Next day of the same bundle expired<br>
$$}else if(__params.EffectiveMode=='0'){
     Effective Date : Today<br>
$$}else{
     Effective Date : ${__params.EffectiveMode} days from today<br>
$$}
$$if(type.automaticRenewal=='0'){
     Renewal Mode : No action<br>
$$}else if(type.automaticRenewal=='1'){    
     Renewal Mode : Send Reminer only<br>
$$}else if(type.automaticRenewal=='2'){    
     Renewal Mode : Automatically subscribe<br>
$$}
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7399","1513","Create Customer Bundle By Organization","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '9';
} else {
    __secure = true;
    __next = '8';
}","8","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","7400","1513","Create Customer Bundle By Organization","var input = __input.response;
__params.BundleInfo = IC.convertBundleInfo(__params);
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '10';
}","9","Confirm","<html>
<body>
Confirm to subscribe organization bundle?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7454","1713","Customer Cancel Card","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CustomerCancelCard';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
cardTypes = IC.queryCancelCardTypeInfos(__params);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7455","1713","Customer Cancel Card","if (empty(cardTypes)) {
 __next = 'error';
}else{
var input = __input.response;
if (empty(input)) 
{
__next = '1';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardTypes)) {
             cardType = cardTypes.get(tmp);
              code = cardType.code;
                __params.CardType = code;
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
}
}","1","Select Card Type","<html>
<body>
Select Card Type :<br>
$$if (empty(cardTypes)) {
  You have no Card Type.
$$} else {
  $$var i = 1;
  $$for(cardType: cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7456","1713","Customer Cancel Card","var input = __input.response;
cardNumbers = cardType.cardNumbers;
if (empty(input)) 
{
__next = '2';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardNumbers )) {
             cardNumber = cardNumbers.get(tmp);
                __params.CardNumber = cardNumber;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
}","2","Select Card Number","<html>
<body>
Select Card Number :<br>
$$ cardNumbers = cardType.cardNumbers;
$$if (empty(cardNumbers)) {
  You have no Card Number.
$$} else {
  $$var i = 1;
  $$for(cardNumber: cardNumbers ) {
  ${i} ${cardNumber}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7459","1713","Customer Cancel Card","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html><body>Cancel Customer Card. Card Type:${__params.CardType}, Card Number:${__params.CardNumber}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7460","1713","Customer Cancel Card","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7461","1714","CCH Identify Customer","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'CCHIdentifyCustomer';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01';   /* MSISDN */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7462","1714","CCH Identify Customer","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo = IC.buildCustomerInfo(__params);
__next = '5';","4","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7468","1714","CCH Identify Customer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html><body>New Group ${__params.RequesterIdentifier}, ${__params.GroupName},${__params.GroupDescription}, ${__params.GroupSponsor}, ${__params.GroupCode}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7469","1714","CCH Identify Customer","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","7470","1714","CCH Identify Customer","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;
  __next = '3';
} else {
  __next = '1';
}","1","Enter Customer Phone No","<html>
<body>
Enter Requesting Customer MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7509","1718","CCH Change Customer KYC","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'CCHChangeCustKYC';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7510","1718","CCH Change Customer KYC","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Requesting Customer MSISDN","<html>
<body>
Enter Requesting Customer MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7511","1718","CCH Change Customer KYC","var input = __input.response;
if (input == '1') {
  __next = '3';
} else if (input == '2') {
  __next = '4';
}else if (input == '3') {
  __next = '5';
}else {
  __next = '2';
}","2","Select Update KYC","<html>
<body>
Select Receiver Type:<br>
1 LastName <br>
2 DOB <br>
3 ID Details <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7512","1718","CCH Change Customer KYC","var input = __input.response;
__params.LastName = input;
__next = '7';","3","Enter Last Name","<html>
<body>
Enter Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7513","1718","CCH Change Customer KYC","var input = __input.response;
if (Validator.isDate(input, 'yyyyMMdd')) {
  __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
  __next = '7';
} else {
  __next = '4';
}","4","Enter Date of Birth","<html>
<body>
Enter Date of Birth(yyyyMMdd)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7514","1718","CCH Change Customer KYC","var input = __input.response;
if (input == '1') {
  __params.CertificateType = '01'; /* National ID */
  __next = '6';
} else if (input == '2') {
  __params.CertificateType = '05'; /* Passport */
  __next = '6';
} else {
  __next = '5';
}","5","Identification Type","<html>
<body>
Identification Type<br>
1  National ID<br>
2  Passport<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7515","1718","CCH Change Customer KYC","var input = __input.response;
__params.CertificateNumber = input;
__params.isCondition = 'true';
__next = '7';","6","Enter ID Number","<html>
<body>
Enter ID Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7516","1718","CCH Change Customer KYC","var input = __input.response;
if (input == '1') {
  __next = '2';
} else if (input == '0') {
  __next = '8';
} else {
  __next = '7';
}","7","Continue Update Other KYC","<html><body>Continue Update Other KYC:<br>
1 YES<br>
0 NO<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7517","1718","CCH Change Customer KYC","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __secure = true;
  __next = '9';
} else {
  __next = '8';
}","8","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7518","1718","CCH Change Customer KYC","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo = IC.buildCustomerInfo(__params);
__next = '10';","9","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7554","1721","Group Cancel Card","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ActionType= 'GroupCancelCard';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7555","1721","Group Cancel Card","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","1","select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7556","1721","Group Cancel Card","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '0';
}
}
if ( found == '1') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   __next = '2';
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7557","1721","Group Cancel Card","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7558","1721","Group Cancel Card","if (empty(cardTypes)) {
 __next = 'error';
}else{
var input = __input.response;
if (empty(input)) 
{
__next = '2';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardTypes)) {
             cardType = cardTypes.get(tmp);
              code = cardType.code;
                __params.CardType = code;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
}
}","2","Select Card Type","<html>
<body>
Select Card Type :<br>
$$cardTypes = IC.queryCancelCardTypeInfos(__params);
$$if (empty(cardTypes)) {
  You have no Card Type.
$$} else {
  $$var i = 1;
  $$for(cardType: cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7559","1721","Group Cancel Card","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7560","1721","Group Cancel Card","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html><body>Cancel Group Card.Card Type: ${__params.CardType},Card Number: ${__params.CardNumber}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7561","1721","Group Cancel Card","var input = __input.response;
cardNumbers = cardType.cardNumbers;
if (empty(input)) 
{
__next = '3';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardNumbers )) {
             cardNumber = cardNumbers.get(tmp);
                __params.CardNumber = cardNumber;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
}","3","Select Card Number","<html>
<body>
Select Card Number :<br>
$$ cardNumbers = cardType.cardNumbers;
$$if (empty(cardNumbers)) {
  You have no Card Number.
$$} else {
  $$var i = 1;
  $$for(cardNumber: cardNumbers ) {
  ${i} ${cardNumber}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7574","1723","Org Cancel Card","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'OrgCancelCard';
__params.Status = '06';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","4","7576","1723","Org Cancel Card","if (empty(cardTypes)) {
 __next = 'error';
}else{
var input = __input.response;
if (empty(input)) 
{
__next = '3';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardTypes)) {
             cardType = cardTypes.get(tmp);
              code = cardType.code;
                __params.CardType = code;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
}
}","3","Select Card Type","<html>
<body>
Select Card Type :<br>
$$cardTypes = IC.queryCancelCardTypeInfos(__params);
$$if (empty(cardTypes)) {
  You have no Card Type.
$$} else {
  $$var i = 1;
  $$for(cardType: cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7578","1723","Org Cancel Card","var input = __input.response;
cardNumbers = cardType.cardNumbers;
if (empty(input)) 
{
__next = '4';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardNumbers )) {
             cardNumber = cardNumbers.get(tmp);
                __params.CardNumber = cardNumber;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
}","4","Select Card Number","<html>
<body>
Select Card Number :<br>
$$ cardNumbers = cardType.cardNumbers;
$$if (empty(cardNumbers)) {
  You have no Card Number.
$$} else {
  $$var i = 1;
  $$for(cardNumber: cardNumbers ) {
  ${i} ${cardNumber}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7580","1723","Org Cancel Card","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '3';
}","2","Enter Your Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7582","1723","Org Cancel Card","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","7583","1723","Org Cancel Card","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
__next = '2';
} else 
   {
      __next = '1';
   }","1","Enter Your Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7584","1723","Org Cancel Card","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html><body>Cancel Org Card.Card Type: ${__params.CardType},Card Number: ${__params.CardNumber}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7610","1728","Two Part Buy Goods","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.OtherTwoPartyVoucherReceiver= msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7611","1728","Two Part Buy Goods","var input = __input.response;
    if (empty(input)) {
     __next = '1';
    } else if (input == '1') {
        __params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
        __tips = 'Till no';
        __next = '2';
    } else if (input == '2') {
        __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
        __tips = 'Short code';
        __next = '2';
    } else {
     __next = '1';
    }","1","Select Till no or Short code","<html>
<body>
Select Till no or Short code<br>
1 Till no<br>
2 Short code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7612","1728","Two Part Buy Goods","var input = __input.response;
if (empty(input)) {
__next = '2';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '3';
}","2","Enter Till no or Short code","<html>
<body>
Enter ${__tips}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7613","1728","Two Part Buy Goods","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7614","1728","Two Part Buy Goods","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
 __next = '5';
  if(1 == size(multiAccount) )
  {
    type = multiAccount.get(0);
    if(type.defaultFlag == 'true')
    {
      __next = '6';
    }
  }
} else {
    __next = '4';
}","4","Input Amount","<html>
<body>
Input Amount:<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',__params.Currency);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7615","1728","Two Part Buy Goods","if (empty(multiAccount)) {
  __next = 'error';
} else {

  var input = __input.response;
  if (!empty(input)) {
    var tmp = Util.toInt(input) - 1;
    if(tmp >=0 and tmp < size(multiAccount)) {
       type = multiAccount.get(tmp);
     __params.InitiatorAccountNo= type.AccountNo;
     __secure = true;
     __next = '6';
    } else {
     __next = '5';
    }
  } else {
   __next = '5';
  }


}","5","Choose Initiator AccountNo","<html>
<body>
Please select Initiator account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA Account',__params.Currency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7616","1728","Two Part Buy Goods","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","7617","1728","Two Part Buy Goods","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Buy Goods - ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7618","1728","Two Part Buy Goods","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7619","1729","Two Part Payment Confirm","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7620","1729","Two Part Payment Confirm","var input = __input.response;
if (!empty(input)) {
  __params.TransactionId= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Transaction ID","<html>
<body>
Enter Transaction ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7621","1729","Two Part Payment Confirm","var input = __input.response;
if (!empty(input)) {
  __params.TwoPartPaymentVoucher= input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Two Part Payment Voucher","<html>
<body>
Enter Two Part Payment Voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7622","1729","Two Part Payment Confirm","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter PIN","<html>
<body>
Enter Pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7623","1729","Two Part Payment Confirm","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input != '1'){
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html><body>You are going to initiate two part payment confirm. Press 1 to continue and other numbers to cancel. ${__params.info}<br>
1 OK <br>
 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7625","1729","Two Part Payment Confirm","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7626","1730","Two Part Voucher Redeeming","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__params.OtherTwoPartyVoucherReceiver='86812530002';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7627","1730","Two Part Voucher Redeeming","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';
","1","Enter Voucher Code","<html>
<body>
Enter Voucher Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7628","1730","Two Part Voucher Redeeming","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7629","1730","Two Part Voucher Redeeming","var input = __input.response;
if (Validator.isDigit(input, 4, 4)) {
  __params.VoucherValidationValue = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter last 4 digits of MSISDN","<html>
<body>
Enter Last 4 Digits of MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7630","1730","Two Part Voucher Redeeming","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7631","1730","Two Part Voucher Redeeming","var input = __input.response;
__params.PIN = input;
__next = '7';","6","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7632","1730","Two Part Voucher Redeeming","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html><body>Redeem Voucher - ${__params.ReceiverPartyIdentifier} ${__params.Amount} ${__params.VoucherValidationValue}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7633","1730","Two Part Voucher Redeeming","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7635","1728","Two Part Buy Goods","var input = __input.response;
__params.OtherTwoPartyVoucherReceiver = input;
__next = '7';","6","Enter OtherTwoPartyVoucherReceiver","<html>
<body>
Enter OtherTwoPartyVoucherReceiver<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7645","1732","Two Part Payment Org Confirm","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7646","1732","Two Part Payment Org Confirm","var input = __input.response;
if (!empty(input)) {
  __params.TransactionId= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Transaction ID","<html>
<body>
Enter Transaction ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7647","1732","Two Part Payment Org Confirm","var input = __input.response;
if (!empty(input)) {
  __params.TwoPartPaymentVoucher= input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Two Part Payment Voucher","<html>
<body>
Enter Enter Two Part Payment Voucher:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7648","1732","Two Part Payment Org Confirm","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '4';","3","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7649","1732","Two Part Payment Org Confirm","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter PIN","<html>
<body>
Enter Pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7650","1732","Two Part Payment Org Confirm","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '5';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '6';
}","5","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7652","1732","Two Part Payment Org Confirm","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input != '1'){
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html><body>You are going to initiate two part payment confirm. Press 1 to continue and other numbers to cancel. ${__params.info}<br>
1 OK <br>
 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7653","1733","CCH Identify All Organization Operator","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'CCHIdentifyOrgOperator';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '05';   /* OPERATOR_ID */
__params.CheckOrgHierarchy = '0';
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","7","7660","1733","CCH Identify All Organization Operator","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html><body>Confirm<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7661","1733","CCH Identify All Organization Operator","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter Operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7662","1733","CCH Identify All Organization Operator","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo = IC.buildGroupKYCInfo(__params);
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","7663","1733","CCH Identify All Organization Operator","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__secure = true;
__next = '2';","1","Enter Receiver Operator Code","<html>
<body>
Enter Receiver Operator Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7664","1733","CCH Identify All Organization Operator","var input = __input.response;
__params.ReceiverPartyTillNumber = input;
__secure = true;
__next = '4';","2","Enter Receiver Till No","<html>
<body>
Enter Receiver Till No:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7667","1719","CCH Change OrgOperator KYC","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'CCHChangeOrgOperatorKYC';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7668","1719","CCH Change OrgOperator KYC","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Requesting OrgOperator Code","<html>
<body>
Enter Requesting OrgOperator Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7669","1719","CCH Change OrgOperator KYC","var input = __input.response;
if (input == '1') {
  __next = '4';
} else if (input == '2') {
  __next = '5';
}else if (input == '3') {
  __next = '6';
}else {
  __next = '3';
}","3","Select Update KYC","<html>
<body>
Select Receiver Type:<br>
1 LastName <br>
2 DOB <br>
3 ID Details <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7670","1719","CCH Change OrgOperator KYC","var input = __input.response;
__params.LastName = input;
__next = '8';","4","Enter Last Name","<html>
<body>
Enter Last Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7671","1719","CCH Change OrgOperator KYC","var input = __input.response;
if (Validator.isDate(input, 'yyyyMMdd')) {
  __params.Birthday = IC.convertor2DefaultDateFormat(input, 'yyyyMMdd');
  __next = '8';
} else {
  __next = '5';
}","5","Enter Date of Birth","<html>
<body>
Enter Date of Birth(yyyyMMdd)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7672","1719","CCH Change OrgOperator KYC","var input = __input.response;
if (input == '1') {
  __params.CertificateType = '01'; /* National ID */
  __next = '7';
} else if (input == '2') {
  __params.CertificateType = '05'; /* Passport */
  __next = '7';
} else {
  __next = '6';
}","6","Identification Type","<html>
<body>
Identification Type<br>
1  National ID<br>
2  Passport<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7673","1719","CCH Change OrgOperator KYC","var input = __input.response;
__params.CertificateNumber = input;
__params.isCondition = 'true';
__next = '8';","7","Enter ID Number","<html>
<body>
Enter ID Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7674","1719","CCH Change OrgOperator KYC","var input = __input.response;
if (input == '1') {
  __next = '3';
} else if (input == '0') {
  __next = '9';
} else {
  __next = '8';
}","8","Continue Update Other KYC","<html><body>Continue Update Other KYC:<br>
1 YES<br>
0 NO<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7676","1719","CCH Change OrgOperator KYC","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '10';","9","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","7677","1719","CCH Change OrgOperator KYC","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo = IC.buildCustomerInfo(__params);
__next = '11';","10","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","7678","1719","CCH Change OrgOperator KYC","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","11","Confirm","<html><body>Customer ${__params.LastName}, ${__params.CertificateNumber}, ${__params.RequesterIdentifier}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7679","1734","Customer Activate Card","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CustomerActivateCard';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
cardTypes = IC.queryActivateCardTypeInfos(__params);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7680","1734","Customer Activate Card","if (empty(cardTypes)) {
 __next = 'error';
}else{
var input = __input.response;
if (empty(input)) 
{
__next = '1';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardTypes)) {
             cardType = cardTypes.get(tmp);
              code = cardType.code;
                __params.CardType = code;
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
}
}","1","Select Card Type","<html>
<body>
Select Card Type :<br>
$$if (empty(cardTypes)) {
  You have no Card Type.
$$} else {
  $$var i = 1;
  $$for(cardType: cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7681","1734","Customer Activate Card","var input = __input.response;
cardNumbers = cardType.cardNumbers;
if (empty(input)) 
{
__next = '2';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardNumbers )) {
             cardNumber = cardNumbers.get(tmp);
                __params.CardNumber = cardNumber;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
}","2","Select Card Number","<html>
<body>
Select Card Number :<br>
$$ cardNumbers = cardType.cardNumbers;
$$if (empty(cardNumbers)) {
  You have no Card Number.
$$} else {
  $$var i = 1;
  $$for(cardNumber: cardNumbers ) {
  ${i} ${cardNumber}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7682","1734","Customer Activate Card","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html><body>Activate Customer Card.Card Type: ${__params.CardType}, Card Number:${__params.CardNumber}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7683","1734","Customer Activate Card","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7684","1735","Group Activate Card","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ActionType= 'GroupActivateCard';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7685","1735","Group Activate Card","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","1","select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7686","1735","Group Activate Card","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '0';
}
}
if ( found == '1') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   __next = '2';
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7687","1735","Group Activate Card","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7688","1735","Group Activate Card","if (empty(cardTypes)) {
 __next = 'error';
}else{
var input = __input.response;
if (empty(input)) 
{
__next = '2';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardTypes)) {
             cardType = cardTypes.get(tmp);
              code = cardType.code;
                __params.CardType = code;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
}
}","2","Select Card Type","<html>
<body>
Select Card Type :<br>
$$cardTypes = IC.queryActivateCardTypeInfos(__params);
$$if (empty(cardTypes)) {
  You have no Card Type.
$$} else {
  $$var i = 1;
  $$for(cardType: cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7689","1735","Group Activate Card","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7690","1735","Group Activate Card","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html><body>Activate Group Card.Card Type: ${__params.CardType},Card Number: ${__params.CardNumber}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7691","1735","Group Activate Card","var input = __input.response;
cardNumbers = cardType.cardNumbers;
if (empty(input)) 
{
__next = '3';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardNumbers )) {
             cardNumber = cardNumbers.get(tmp);
                __params.CardNumber = cardNumber;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
}","3","Select Card Number","<html>
<body>
Select Card Number :<br>
$$ cardNumbers = cardType.cardNumbers;
$$if (empty(cardNumbers)) {
  You have no Card Number.
$$} else {
  $$var i = 1;
  $$for(cardNumber: cardNumbers ) {
  ${i} ${cardNumber}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7692","1736","Org Activate Card","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'OrgActivateCard';
__params.Status = '06';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","4","7693","1736","Org Activate Card","if (empty(cardTypes)) {
 __next = 'error';
}else{
var input = __input.response;
if (empty(input)) 
{
__next = '3';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardTypes)) {
             cardType = cardTypes.get(tmp);
              code = cardType.code;
                __params.CardType = code;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
}
}","3","Select Card Type","<html>
<body>
Select Card Type :<br>
$$cardTypes = IC.queryActivateCardTypeInfos(__params);
$$if (empty(cardTypes)) {
  You have no Card Type.
$$} else {
  $$var i = 1;
  $$for(cardType: cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7694","1736","Org Activate Card","var input = __input.response;
cardNumbers = cardType.cardNumbers;
if (empty(input)) 
{
__next = '4';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardNumbers )) {
             cardNumber = cardNumbers.get(tmp);
                __params.CardNumber = cardNumber;
                __secure = true;
                __next = '5';
         } else {
                __next = '4';
         }
}","4","Select Card Number","<html>
<body>
Select Card Number :<br>
$$ cardNumbers = cardType.cardNumbers;
$$if (empty(cardNumbers)) {
  You have no Card Number.
$$} else {
  $$var i = 1;
  $$for(cardNumber: cardNumbers ) {
  ${i} ${cardNumber}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7695","1736","Org Activate Card","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '3';
}","2","Enter Your Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7696","1736","Org Activate Card","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","7697","1736","Org Activate Card","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
__next = '2';
} else 
   {
      __next = '1';
   }","1","Enter Your Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7698","1736","Org Activate Card","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html><body>Activate Org Card.Card Type: ${__params.CardType},Card Number: ${__params.CardNumber}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7699","1737","Customer Register Card","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CustomerRegisterCard';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__params.CardStart='01';
cardTypes = IC.queryRegisterCardTypeInfos(__params);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7700","1737","Customer Register Card","if (empty(cardTypes)) {
 __next = 'error';
}else{
var input = __input.response;
if (empty(input)) 
{
__next = '1';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardTypes)) {
             cardType = cardTypes.get(tmp);
              code = cardType.code;
                __params.CardType = code;
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
}
}","1","Select Card Type","<html>
<body>
Select Card Type :<br>
$$if (empty(cardTypes)) {
  You have no Card Type.
$$} else {
  $$var i = 1;
  $$for(cardType: cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7701","1737","Customer Register Card","var input = __input.response;
if (empty(input)) 
{
     __next = '2';
}
else
{
     __params.CardNumber = input;
     __secure = true;
     __next = '3';
}","2","Enter Card Number","<html>
<body>
Enter Card Number :<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7704","1737","Customer Register Card","var input = __input.response;
__params.CardExpiry = input;
__secure = true;
__next = '4';","3","Enter Card Expiry","<html>
<body>
Enter Card Expiry(YYYYMMDD) :<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7705","1737","Customer Register Card","var input = __input.response;
__params.CardHolderName = input;
__secure = true;
__next = '5';","4","Enter Card Holder Name","<html>
<body>
Enter Card Holder Name (Less than 25 Characters):<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7706","1737","Customer Register Card","var input = __input.response;
__params.CardIssueNumber = input;
__secure = true;
__next = '6';","5","Enter Card Issue Number","<html>
<body>
Enter Card Issue Number:(1-25 Characters or Digits)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7707","1737","Customer Register Card","var input = __input.response;
__params.ValidFrom = input;
__secure = true;
__next = '7';","6","Enter Valid From","<html>
<body>
Enter Valid From:(YYYYMMDD)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7709","1737","Customer Register Card","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '8';
} else {
    __secure = true;
    __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7710","1737","Customer Register Card","var input = __input.response;
__params.AdditionalCardInfos = IC.buildAdditionalCardInfos(__params);
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html><body>Register Customer Card.Card Type: ${__params.CardType}, Card Number:${__params.CardNumber}, Card Expiry:${__params.CardExpiry}, Card Holder Name:${__params.CardHolderName}, Card Issue Number:${__params.CardIssueNumber}, Valid From:${__params.ValidFrom}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7721","1740","Group Register Card","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier= msisdn;
__params.ActionType= 'GroupRegisterCard';
__params.ReceiverPartyIdentifierType = '15'; /* Group Code*/
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7722","1740","Group Register Card","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","1","select option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7723","1740","Group Register Card","var input = __input.response;
var found = '1';
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
for(group: groups){
if(group.groupCode == input)
{
  found = '0';
}
}
if ( found == '1') {
   __errormsg = 'No current group or not belong to the group.';
   __next = 'error';
}
else
{
   __next = '2';
}
}
 else {
      __next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7724","1740","Group Register Card","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
  if ( !empty(roleList) || size(roleList)>0) {
  __next = '2';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7725","1740","Group Register Card","if (empty(cardTypes)) {
 __next = 'error';
}else{
var input = __input.response;
if (empty(input)) 
{
__next = '2';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardTypes)) {
             cardType = cardTypes.get(tmp);
              code = cardType.code;
                __params.CardType = code;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
}
}","2","Select Card Type","<html>
<body>
Select Card Type :<br>
$$cardTypes = IC.queryRegisterCardTypeInfos(__params);
$$if (empty(cardTypes)) {
  You have no Card Type.
$$} else {
  $$var i = 1;
  $$for(cardType: cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7728","1740","Group Register Card","var input = __input.response;
if (empty(input)) 
{
     __next = '3';
}
else
{
     __params.CardNumber = input;
     __secure = true;
     __next = '4';
}","3","Enter Card Number","<html>
<body>
Enter Card Number :<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7729","1740","Group Register Card","var input = __input.response;
__params.CardExpiry = input;
__secure = true;
__next = '5';","4","Enter Card Expiry","<html>
<body>
Enter Card Expiry :(YYYYMMDD)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7730","1740","Group Register Card","var input = __input.response;
__params.CardHolderName = input;
__secure = true;
__next = '6';","5","Enter Card Holder Name","<html>
<body>
Enter Card Holder Name : (Less than 25 Characters)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7731","1740","Group Register Card","var input = __input.response;
__params.CardIssueNumber = input;
__secure = true;
__next = '7';","6","Enter Card Issue Number","<html>
<body>
Enter Card Issue Number:(1-25 Characters or Digits)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","7732","1740","Group Register Card","var input = __input.response;
__params.ValidFrom = input;
__secure = true;
__next = '8';","7","Enter Valid From","<html>
<body>
Enter Valid From:(YYYYMMDD)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","7733","1740","Group Register Card","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '9';
} else {
    __secure = true;
    __next = '8';
}","8","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","7734","1740","Group Register Card","var input = __input.response;
__params.AdditionalCardInfos = IC.buildAdditionalCardInfos(__params);
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html><body>Register Group Card.Card Type: ${__params.CardType}, Card Number:${__params.CardNumber}, Card Expiry:${__params.CardExpiry}, Card Holder Name:${__params.CardHolderName}, Card Issue Number:${__params.CardIssueNumber}, Valid From:${__params.ValidFrom}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7735","1741","Org Register Card","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'OrgRegisterCard';
__params.Status = '06';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","4","7736","1741","Org Register Card","if (empty(cardTypes)) {
 __next = 'error';
}else{
var input = __input.response;
if (empty(input)) 
{
__next = '3';
}
else
{
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(cardTypes)) {
             cardType = cardTypes.get(tmp);
              code = cardType.code;
                __params.CardType = code;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
}
}","3","Select Card Type","<html>
<body>
Select Card Type :<br>
$$cardTypes = IC.queryRegisterCardTypeInfos(__params);
$$if (empty(cardTypes)) {
  You have no Card Type.
$$} else {
  $$var i = 1;
  $$for(cardType: cardTypes) {
  ${i} ${cardType.name}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7738","1741","Org Register Card","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '2';
} else {
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '3';
}","2","Enter Your Operator ID","<html>
<body>
Enter Your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","7740","1741","Org Register Card","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
__next = '2';
} else 
   {
      __next = '1';
   }","1","Enter Your Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7742","1741","Org Register Card","var input = __input.response;
if (empty(input)) 
{
     __next = '4';
}
else
{
     __params.CardNumber = input;
     __secure = true;
     __next = '5';
}","4","Enter Card Number","<html>
<body>
Enter Card Number :<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7743","1741","Org Register Card","var input = __input.response;
__params.CardExpiry = input;
__secure = true;
__next = '6';","5","Enter Card Expiry","<html>
<body>
Enter Card Expiry:(YYYYMMDD)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7744","1741","Org Register Card","var input = __input.response;
__params.CardHolderName = input;
__secure = true;
__next = '7';","6","Enter Card Holder Name","<html>
<body>
Enter Card Holder Name : (Less than 25 Characters)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7745","1741","Org Register Card","var input = __input.response;
__params.CardIssueNumber = input;
__secure = true;
__next = '8';","7","Enter Card Issue Number","<html>
<body>
Enter Card Issue Number:(1-25 Characters or Digits)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7746","1741","Org Register Card","var input = __input.response;
__params.ValidFrom = input;
__secure = true;
__next = '9';","8","Enter Valid From","<html>
<body>
Enter Valid From:(YYYYMMDD)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7747","1741","Org Register Card","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '10';
} else {
    __secure = true;
    __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","7748","1741","Org Register Card","var input = __input.response;
__params.AdditionalCardInfos = IC.buildAdditionalCardInfos(__params);
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html><body>Register Org Card.Card Type: ${__params.CardType}, Card Number:${__params.CardNumber}, Card Expiry:${__params.CardExpiry}, Card Holder Name:${__params.CardHolderName}, Card Issue Number:${__params.CardIssueNumber}, Valid From:${__params.ValidFrom}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","7750","1718","CCH Change Customer KYC","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html><body>Customer ${__params.LastName}, ${__params.CertificateNumber}, ${__params.RequesterIdentifier}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7765","1743","Send Money via m-pesa With Prevalidation","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","7766","1743","Send Money via m-pesa With Prevalidation","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7767","1743","Send Money via m-pesa With Prevalidation","if (empty(multiAccount)) {
  __next = 'error';
} else {

  var input = __input.response;
  if (!empty(input)) {
    var tmp = Util.toInt(input) - 1;
    if(tmp >=0 and tmp < size(multiAccount)) {
       type = multiAccount.get(tmp);
     __params.InitiatorAccountNo= type.AccountNo;
     __secure = true;
     __next = '6';
    } else {
     __next = '5';
    }
  } else {
   __next = '5';
  }


}","5","Choose Initiator AccountNo","<html>
<body>
Please select Initiator account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'M-PESA',__params.Currency);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","7768","1743","Send Money via m-pesa With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
beneficiaries = IC.queryCustListBeneficiary(msisdn);
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Input MSISDN Number<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7769","1743","Send Money via m-pesa With Prevalidation","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '3';","2a","Input Phone Number","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7770","1743","Send Money via m-pesa With Prevalidation","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 and i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryMsisdn = beneficiary.BeneficiaryMsisdn;
  __params.ReceiverPartyIdentifier = beneficiaryMsisdn ;
  __next = '3';
}
else{

  __next = '2b';
}","2b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryMsisdn} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7771","1743","Send Money via m-pesa With Prevalidation","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
 __next = '6';
  if(1 == size(multiAccount) )
  {
    type = multiAccount.get(0);
    if(empty(type.defaultFlag) ||  type.defaultFlag == 'true')
    {
      __next = '6';
    }
  }
} else {
    __next = '6';
}","4","Input Amount","<html>
<body>
Input Amount:<br>
${identity.identityType}  ${identity.identityId};
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'m-pesa',__params.Currency);
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7774","1743","Send Money via m-pesa With Prevalidation","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
    __referenceData.Comment2Customer = input;
    __next = '8';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7776","1743","Send Money via m-pesa With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = '12';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","11","Transaction Information","<html>
<body>
Transaction Information:<br>
Phone Number : ${__params.ReceiverPartyIdentifier}<br>
CurrencyCode : ${__params.Currency}<br>
Amount : ${__params.Amount}<br>
${__params.CNSreceiver}
Comment  : ${__referenceData.Comment2Customer}<br>
Press 1 to confirm or 0 to cancel:<br>
1 Submit <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","7777","1743","Send Money via m-pesa With Prevalidation","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.PIN = input;
    __next = '9';
} else {
    __secure = true;
    __next = '8';
}","8","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","7778","1743","Send Money via m-pesa With Prevalidation","var input = __input.response;
cust = IC.queryIdentityName('01',__params.ReceiverPartyIdentifier,'01',__params.ReceiverPartyIdentifier);
custname = IC.queryCustomerName(__params.ReceiverPartyIdentifier);
var tips2 = '';
if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
{
           tips2 = 'You will send money to: ' +custname  + '<br>';
           __params.CNSreceiver = tips2;}
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '1')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {
	   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
	 
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';
	   }
		i = i+1 
	  }
  }
   taxList = budgetMap.tax;
   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
		 if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }

		promptText = promptText
	 + fee.publicName + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
   {
     promptText =' No charge.';
   } 
 else
  {
    promptText =promptText +'.';
  }
var tips = '';
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
     if(cust.initiatorCNSStatus.initiatorFlag.fieldValue == '01' && cust.initiatorCNSStatus.initiatorBlock.fieldValue == '02')
     {
       if(cust.subType  == '1000')
       {
	 tips = tips  + 'the received customer is unregistered.' + '<br>';
       }
       else if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
       {		   
           var nameStr= (empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName +' ');

           tips = tips + 'You will send money to: ' +custname  + '<br>';
           if(nameStr != ''){
           __params.IsCNSDataDisplayed = 'Yes';
           }
       }
     }
tips = tips + 'Phone number : ' + cust.basicIdentifier ;
promptText = promptText + '<br>' + tips;
__params.preValidationResult = promptText;
__next = '10';
}
}
else if (input == '2') {
  __next = '11';
  }
}
else {
 __next = '9';
}","9","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","7779","1743","Send Money via m-pesa With Prevalidation","var input = __input.response;
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__params.EventType=""PRE_VALIDATION"";
__params.Reason=""Continue Pre-Validation Transaction"";
TC.savingPreValidationEventLog(__params);
__next = '11';
}
else if (input == '2') {
IC.cnsCancelationProcess('01',msisdn);
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
__next = 'error';
}
}
else {
 __next = '10';
}","10","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","7780","1743","Send Money via m-pesa With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  IC.cnsCancelationProcess(__params.InitiatorIdentifierType,__params.InitiatorIdentifier);
  __next = 'cancel';
} else {
  __next = '12';
}","12","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7781","1744","Group G2G Transfer With Prevalidation","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* Group Code */
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
groups = IC.queryMyGroups(msisdn);
beneficiaries = IC.queryGroupListBeneficiary(msisdn);
recipientList= IC.queryPreValidationNotification(msisdn,'01','',0,'');
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","7782","1744","Group G2G Transfer With Prevalidation","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.PrimaryPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7783","1744","Group G2G Transfer With Prevalidation","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '5';     
   } 
else{
    __next = '4a';
}","4a","Enter Recipient Group Code","<html>
<body>
Enter Recipient Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7784","1744","Group G2G Transfer With Prevalidation","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7785","1744","Group G2G Transfer With Prevalidation","var input = __input.response;
__params.Remark = input;
__next = '7';","6","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","7788","1744","Group G2G Transfer With Prevalidation","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","7789","1744","Group G2G Transfer With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7790","1744","Group G2G Transfer With Prevalidation","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7791","1744","Group G2G Transfer With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = '4a';
} else if (input == '2') {
   if (empty(beneficiaries ) || size(beneficiaries ) == 0) {
      __errormsg = 'Sorry, there is no beneficiary.';
      __next = 'error';
    } else {
       __next = '4b';
    }
} else {
   __next = '3';
}","3","Select Option(Recipient)","<html>
<body>
Please select option: <br>
1 Enter Recipient Group Code<br>
2 Select Beneficiary
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7792","1744","Group G2G Transfer With Prevalidation","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(beneficiaries)){
  beneficiary= beneficiaries.get(i);
  beneficiaryGroupCode = beneficiary.BeneficiaryGroupCode;
  __params.ReceiverPartyIdentifier = beneficiaryGroupCode ;
  __next = '5';
} 
else{

  __next = '4b';
}","4b","Select Beneficiary","<html>
<body>
Select Beneficiary:<br>
$$ var index = 1;
$$ for (beneficiary: beneficiaries){
 ${index} ${beneficiary.BeneficiaryName} ${beneficiary.BeneficiaryGroupCode} ${beneficiary.BeneficiaryReference}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","7794","1744","Group G2G Transfer With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = '9';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm Information","<html>
<body>
Transaction Information:<br>
Group Code : ${__params.PrimaryPartyIdentifier}<br>
Recipient Group Code : ${__params.ReceiverPartyIdentifier}<br>
Amount : ${__params.Amount}<br>
Remark : ${__params.Remark}<br>
Comment  : ${__referenceData.Comment2Customer}<br>
Press 1 to confirm or 0 to cancel:<br>
1 Submit <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","7795","1744","Group G2G Transfer With Prevalidation","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.PIN = input;
    __next = '10';
} else {
    __secure = true;
    __next = '9';
}","9","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","13","7796","1744","Group G2G Transfer With Prevalidation","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '1')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {
	   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
	 
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';
	   }
		i = i+1 
	  }
  }
   taxList = budgetMap.tax;
   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
		 if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }
		promptText =
 promptText
	 + fee.publicName + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
   {
     promptText =' No charge.';
   } 
 else
  {
    promptText =promptText +'.';
  }
__params.preValidationResult = promptText;
__next = '11';
}
}
else if (input == '2') {
  __next = '12';
  }
}
else {
 __next = '10';
}","10","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","7797","1744","Group G2G Transfer With Prevalidation","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__params.EventType=""PRE_VALIDATION"";
__params.Reason=""Continue Pre-Validation Transaction"";
TC.savingPreValidationEventLog(__params);
__next = '12';
}
else if (input == '2') {
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
__next = 'error';
}
}
else {
 __next = '11';
}","11","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","15","7798","1744","Group G2G Transfer With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '12';
}","12","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7799","1745","Deposit Money With Prevalidation","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7800","1745","Deposit Money With Prevalidation","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';
","1","Enter phone no","<html>
<body>
Enter phone no<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7801","1745","Deposit Money With Prevalidation","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7802","1745","Deposit Money With Prevalidation","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
recipientList= IC.queryPreValidationNotificationByOrg(__params.InitiatorIdentifier,'05',0,__params.AccessDeviceIdentifier,'01');
__next = '4';","3","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7805","1745","Deposit Money With Prevalidation","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '4';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '5';
}","4","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7807","1745","Deposit Money With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = '6';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm Information","<html>
<body>
Transaction Information:<br>
phone no : ${__params.ReceiverPartyIdentifier}<br>
Amount : ${__params.Amount}<br>
Operator ID : ${__params.InitiatorIdentifier}<br>
Comment  : ${__referenceData.Comment2Customer}<br>
Press 1 to confirm or 0 to cancel:<br>
1 Submit <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7808","1745","Deposit Money With Prevalidation","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.PIN = input;
    __next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7809","1745","Deposit Money With Prevalidation","var input = __input.response;
cust = IC.queryIdentityName(__params.InitiatorIdentifierType,__params.InitiatorIdentifier,__params.ReceiverPartyIdentifierType,__params.ReceiverPartyIdentifier,
                                        __params.AccessDeviceIdentifierType,__params.AccessDeviceIdentifier);
shortCode = IC.queryShortCodeByOperatorCode(__params.InitiatorIdentifier);
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
if(!IC.isSupportCustomerNameSearch() || cust.initiatorCNSStatus.suspensionFlag.fieldValue == '01'){
__next = '9';
}
else
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '1')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
	   i = 1;
	   sizeLen = size(feeList);
	  for(fee:feeList)
	  {
	   promptText = promptText + 'The amount of charge is '+fee.amount;

	 
	   if(i < sizeLen)
	   {
		promptText = promptText + '<br>';
	   }
		i = i+1;
	  }
  }
   taxList = budgetMap.tax;
   if(!empty(taxList)){
	   i = 1;
	   sizeLen = size(taxList);
	  for(tax:taxList)
	  {
	   if(i ==1 &&  promptText != '')
	   {
		promptText = promptText + '<br>';
	   }

		promptText = promptText + ':The amount of tax is '+tax.amount;
	   
	   if(i <sizeLen)
	   {
		promptText = promptText + '<br>';
	   } 
	   i = i+1;
	  }
  }
  
  if( promptText == '')
  {
    promptText =' No charge.';
  } 
  else
  {
    promptText =promptText +'.';
  }

var tips = 'Customer ';
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
if(cust.subType  == '1000')
       {
	 tips = tips  + 'is unregistered.' + '<br>';
       }

       else if(cust.receiverCNSStatus.receiverFlag.fieldValue == '01' && cust.receiverCNSStatus.receiverBlock.fieldValue == '02')
       {		   

           var nameStr= (empty(cust.firstName)?'':cust.firstName +' ') + (empty(cust.middleName)?'':cust.middleName +' ') + (empty(cust.lastName)?'':cust.lastName);
           tips = tips + IC.maskIdentityName(nameStr);
           if(nameStr != ''){
           __params.IsCNSDataDisplayed = 'Yes';
           }
       }
tips = tips + ',Phone number ' + cust.basicIdentifier + ' will deposit ' + IC.formatAmount('',__params.Amount) + '. response with:';
promptText = promptText + '<br>' + tips;

__params.preValidationResult = promptText;
__next = '8';
}
}
}
else if (input == '2') {
  __next = '9';
  }
else {
 __next = '7';
}
}","7","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7810","1745","Deposit Money With Prevalidation","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__params.EventType=""PRE_VALIDATION"";
__params.Reason=""Continue Pre-Validation Transaction"";
TC.savingPreValidationEventLog(__params);
__next = '9';
}
else if (input == '2') {
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
if(__params.IsCNSDataDisplayed == 'Yes')
{
  IC.cnsCancelationProcess(__params.InitiatorIdentifier,shortCode,'05');
}
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
__next = 'error';
}
}
else {
 __next = '8';
}
DEBUG.error(__params.InitiatorIdentifier);
DEBUG.error(shortCode);
DEBUG.error(cust);","8","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7811","1745","Deposit Money With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7825","1747","Group Two Part Buy Goods","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '15'; /* Group Code */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
CurrencyCode  = """";
groups = IC.queryMyGroups(msisdn);
__next = '0';","begin","set parammeters","",""<endrec>
"CUSTOMER","","3","7826","1747","Group Two Part Buy Goods","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
__params.PrimaryPartyIdentifier = input;
__next = '2';
}else{
__next = '1a';
}","1a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7827","1747","Group Two Part Buy Goods","var input = __input.response;
    if (empty(input)) {
     __next = '2';
    } else if (input == '1') {
        __params.ReceiverPartyIdentifierType = '02'; /* TILL_NO */
        __tips = 'Till no';
        __next = '3';
    } else if (input == '2') {
        __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
        __tips = 'Short code';
        __next = '3';
    } else {
     __next = '2';
    }","2","Select Till no or Short code","<html>
<body>
Select Till no or Short code<br>
1 Till no<br>
2 Short code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7828","1747","Group Two Part Buy Goods","var input = __input.response;
if (empty(input)) {
__next = '3';
} else {
__params.ReceiverPartyIdentifier = input;
__next = '4';
}","3","Enter Till no or Short code","<html>
<body>
Enter ${__tips}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7829","1747","Group Two Part Buy Goods","var input = __input.response;
__params.OtherTwoPartyVoucherReceiver = input;
__next = '5';","4","Enter OtherTwoPartyVoucherReceiver","<html>
<body>
Enter OtherTwoPartyVoucherReceiver<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7830","1747","Group Two Part Buy Goods","if (empty(multiCurrencyCode)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 and tmp < size(multiCurrencyCode)) {
               type = multiCurrencyCode.get(tmp);
                __params.Currency =  type;
                __secure = true;
                __next = '6';
         } else {
                __next = '5';
         }
    } else {
        __next = '5';
    }
}","5","Choose CurrencyCode","<html>
<body>
Choose CurrencyCode :<br>
$$multiCurrencyCode = IC.getAllCurrencyList();
$$if (empty(multiCurrencyCode)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiCurrencyCode ) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","7831","1747","Group Two Part Buy Goods","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.Amount= TC.convertAmountFormat(input);
    __next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","7832","1747","Group Two Part Buy Goods","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","7833","1747","Group Two Part Buy Goods","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.PIN = input;
    __next = '8';
} else {
    __secure = true;
    __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","7834","1747","Group Two Part Buy Goods","var input = __input.response;
if (input == '1') {
  __next = '1a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '1b';
    }
} else {
   __next = '0';
}","0","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7835","1747","Group Two Part Buy Goods","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.PrimaryPartyIdentifier = groupCode;
  __next = '2';
} 
else{
  __next = '1b';
}","1b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","7836","1747","Group Two Part Buy Goods","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","9","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7850","1730","Two Part Voucher Redeeming","var input = __input.response;
__params.OtherTwoPartyVoucherReceiver = input;
__next = '6';","5","Enter OtherTwoPartyVoucherReceiver","<html>
<body>
Enter OtherTwoPartyVoucherReceiver<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7851","1719","CCH Change OrgOperator KYC","var input = __input.response;
__params.ReceiverPartyTillNumber = input;
__secure = true;
__next = '3';","2","Enter Receiver Till No","<html>
<body>
Enter Receiver Till No:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7852","1749","Group Two Part Voucher Redeeming","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; 
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '03'; /* VOUCHER_CODE */
__params.RequesterIdentifierType = '01';  /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","7853","1749","Group Two Part Voucher Redeeming","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.GroupCode = input;
     __next = '2';     
   } 
else{
    __next = '1';
}","1","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7854","1749","Group Two Part Voucher Redeeming","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Requesting Customer MSISDN","<html>
<body>
Requesting Customer MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7855","1749","Group Two Part Voucher Redeeming","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '4';","3","Enter Voucher Code","<html>
<body>
Enter Voucher Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7856","1749","Group Two Part Voucher Redeeming","var input = __input.response;
if (!empty(input) && Validator.isAmount(input, ""."")) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7857","1749","Group Two Part Voucher Redeeming","var input = __input.response;
__params.Remark = input;
__next = '7';","6","Enter Remark","<html>
<body>
Enter Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7858","1749","Group Two Part Voucher Redeeming","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '8';","7","Enter Operator ID","<html>
<body>
Enter Operator ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7859","1749","Group Two Part Voucher Redeeming","var input = __input.response;
__params.PIN = input;
__next = '9';","8","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","7860","1749","Group Two Part Voucher Redeeming","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html><body>Redeem Voucher - ${__params.ReceiverPartyIdentifier} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7861","1749","Group Two Part Voucher Redeeming","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '9';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '10';
}","9","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7862","1749","Group Two Part Voucher Redeeming","var input = __input.response;
__params.OtherTwoPartyVoucherReceiver = input;
__next = '5';","4","Enter OtherTwoPartyVoucherReceiver","<html>
<body>
Enter OtherTwoPartyVoucherReceiver<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7863","1750","M-Shwari Activate Account","__params.ServiceCode = __service.serviceCode;
__params.ActionType ='ActiveOrgFSIProducts';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.OrgShortCode = '262626';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","4","7865","1750","M-Shwari Activate Account","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '2';","1","Input Operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7866","1750","M-Shwari Activate Account","var input = __input.response;
if(!empty(input)){
__params.@HEAD@PIN = input;
__next = '4';
}else{
    __next ='3';
}","3","Input PIN","<html>
<body>
Input PIN: <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7867","1750","M-Shwari Activate Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel active account?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7883","1754","M-Shwari Org Terms And Conditons","__params.ServiceCode ='Org FSI Deposit For M-Shwari';
__params.ActionType ='SetConditionRead';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.OrgShortCode = '262626';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","7885","1754","M-Shwari Org Terms And Conditons","var input = __input.response;
__params.InitiatorIdentifier = input;
__params.ReceiverPartyIdentifierType='99';
__params.ReceiverPartyIdentityType='5000';
__params.ReceiverPartyIdentifier=IC.queryOrgIdByOperatorUsername(input);
__secure = true;
__next = '2';","1","Input Operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7886","1754","M-Shwari Org Terms And Conditons","var input = __input.response;
if(!empty(input)){
__params.@HEAD@PIN = input;
__next = '4';
}else{
    __next ='2';
}","2","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7887","1754","M-Shwari Org Terms And Conditons","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","4","Confirm","<html>
<body>
Terms and Conditions<br>
These terms and conditions (“Terms and Conditions”) apply to your use of all Elsevier websites, <br>
applications, services and products (“Services” or individually a “Service”)<br>
that post a link to these Terms and Conditions and that are provided by any<br> 
Elsevier group company worldwide (""Elsevier"", ""we"", ""us"" or ""our"").<br>
You will Confirm Terms and Conditions?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","14","7906","1743","Send Money via m-pesa With Prevalidation","if(__errorCode == 'UMC64000')
{
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation confirmation is Timeout.';
__params.Reason=""Timeout"";
TC.savingPreValidationEventLog(__params);
__params.TransactionPreValidationEvent='Timeout';
__params.TransactionPreValidationError='Time out';
__params.put('Common.Result.ErrorCode','UMC64000');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
}","error","Execute while errors occur","error occurs.",""<endrec>
"TILL","","11","7907","1745","Deposit Money With Prevalidation","if(__errorCode == 'UMC64000')
{
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation confirmation is Timeout.';
__params.Reason=""Timeout"";
TC.savingPreValidationEventLog(__params);
__params.TransactionPreValidationEvent='Timeout';
__params.TransactionPreValidationError='Time out';
__params.put('Common.Result.ErrorCode','UMC64000');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
}","error","Execute while errors occur","error occurs.",""<endrec>
"CUSTOMER","","16","7908","1744","Group G2G Transfer With Prevalidation","if(__errorCode == 'UMC64000')
{
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation confirmation is Timeout.';
__params.Reason=""Timeout"";
TC.savingPreValidationEventLog(__params);
__params.TransactionPreValidationEvent='Timeout';
__params.TransactionPreValidationError='Time out';
__params.put('Common.Result.ErrorCode','UMC64000');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
}","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","1","7913","1758","Send Money via m-pesa With Prevalidation for API","__next = '1';
 __params.Channel = __accessChannel;","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","7914","1758","Send Money via m-pesa With Prevalidation for API","__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if(__errorCode == 'UMC64000')
{	
    __params.errCode='5';
    __params.errDesc='Pre-Validation confirmation is Timeout.';
    __params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
    __params.EventType='PRE_VALIDATION';
    __params.Reason='Timeout'; 
   TC.savingPreValidationEventLog(__params);
}
else
{
    __params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
 
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","2","7915","1758","Send Money via m-pesa With Prevalidation for API","budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;
if(budgetMap.isError == '1')
{
 __params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
  __params.ResultMsg = '';
  feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
  for(fee:feeList)
  {
  
   __params.ResultMsg =__params.ResultMsg + fee.publicName+ ':The amount of charge is '+fee.amount;
   
   if(i < sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;
   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  __params.ResultMsg != '')
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
    __params.ResultMsg =__params.ResultMsg +tax.publicName+ ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
 
   i = i+1;
  }
  if( __params.ResultMsg == '')
   {
     __params.ResultMsg =' No charge.';
   }
 
 else
  {
    __params.ResultMsg =__params.ResultMsg +'.';
  }  
 __next = '2';
}
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","3","7916","1758","Send Money via m-pesa With Prevalidation for API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{  
    __params.Reason='Continue Pre-Validation Transaction.';
  __params.ResultCode='0';
  __params.ResultMsg ='You confirm initiate transaction!';
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}
else
{
  __params.Reason='Pre-Validation Result is Rejected.';
   __params.ResultCode='1';
   __params.ResultMsg ='You rejected initiate transaction!';
  __next='cancel';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"CUSTOMER","","1","7917","1759","Customer Query Loyalty Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7918","1759","Customer Query Loyalty Account","if (empty(accountTypes)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(accountTypes)) {
                __params.AccountTypeCode =  accountTypes.get(tmp);
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Choose Account Type","<html>
<body>
Please select account:<br>
$$accountTypes = IC.queryAllPointAccounts(identity.identityType, identity.identityId);
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7919","1759","Customer Query Loyalty Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
    __params.PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7921","1759","Customer Query Loyalty Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7922","1759","Customer Query Loyalty Account","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{0,128})$')){
    __params.AccountName  = input;
    __next = '3'; 
} 
else{
    __next = '2';
}","2","Enter account name","<html>
<body>
Enter account name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7926","1760","Query Group Loyalty Account","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
    __params.PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7927","1760","Query Group Loyalty Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7928","1760","Query Group Loyalty Account","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{0,128})$')){
    __params.AccountName = input;
    __next = '5'; 
} 
else{
    __next = '4';
}","4","Enter account name","<html>
<body>
Enter account name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","7930","1760","Query Group Loyalty Account","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7931","1760","Query Group Loyalty Account","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7932","1760","Query Group Loyalty Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '15'; /* Group Code */
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","7933","1760","Query Group Loyalty Account","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7934","1760","Query Group Loyalty Account","if (empty(accountTypes)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(accountTypes)) {
                __params.AccountTypeCode =  accountTypes.get(i);
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Account Type","<html>
<body>
Please select account:<br>
$$accountTypes = IC.queryAllPointAccountsByGroupCode(__params.ReceiverPartyIdentifier);
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7935","1761","Customer Query Loyalty Statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","7936","1761","Customer Query Loyalty Statement","if (empty(accountTypes)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(accountTypes)) {
                __params.AccountTypeCode =  accountTypes.get(tmp);
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Choose Account Type","<html>
<body>
Please select account:<br>
$$accountTypes = IC.queryAllPointAccounts(identity.identityType, identity.identityId);
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","7937","1761","Customer Query Loyalty Statement","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
    __params.PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7938","1761","Customer Query Loyalty Statement","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7939","1761","Customer Query Loyalty Statement","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{0,128})$')){
    __params.AccountName  = input;
    __next = '3'; 
} 
else{
    __next = '2';
}","2","Enter account name","<html>
<body>
Enter account name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","7940","1762","Query Group Loyalty Statement","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
    __params.PIN = input;
    __next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","7941","1762","Query Group Loyalty Statement","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","7942","1762","Query Group Loyalty Statement","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{0,128})$')){
    __params.AccountName = input;
    __next = '5'; 
} 
else{
    __next = '4';
}","4","Enter account name","<html>
<body>
Enter account name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","7943","1762","Query Group Loyalty Statement","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","7944","1762","Query Group Loyalty Statement","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2a';
}","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","7945","1762","Query Group Loyalty Statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '15'; /* Group Code */
groups = IC.queryMyGroups(msisdn);
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","4","7946","1762","Query Group Loyalty Statement","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  __next = '3';
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","7947","1762","Query Group Loyalty Statement","if (empty(accountTypes)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var i = Util.toInt(input) - 1;
         if(i >=0 && i < size(accountTypes)) {
                __params.AccountTypeCode =  accountTypes.get(i);
                __secure = true;
                __next = '4';
         } else {
                __next = '3';
         }
    } else {
        __next = '3';
    }
}","3","Select Account Type","<html>
<body>
Please select account:<br>
$$accountTypes = IC.queryAllPointAccountsByGroupCode(__params.ReceiverPartyIdentifier);
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7948","1763","Operator Query Loyalty Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */

__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7949","1763","Operator Query Loyalty Account","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
    
    accountTypes = IC.queryAllPointAccountsByShortCode(input);
}
else
{
    accountTypes = IC.queryAllPointAccountsByTillId(identity.identityId);
}
__next = '2';","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7950","1763","Operator Query Loyalty Account","if (empty(accountTypes)) {
  __next = 'error';
} else {
  var input = __input.response;
  var i = Util.toInt(input) - 1;
  if (i >= 0 && i < size(accountTypes)) {
    __params.AccountTypeCode = accountTypes.get(i);
    __next = '3';
  } else {
    __next = '2';
  }
}","2","Select Account Type","<html>
<body>
Please select account:<br>
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
  ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7951","1763","Operator Query Loyalty Account","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7952","1763","Operator Query Loyalty Account","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7953","1763","Operator Query Loyalty Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7954","1764","Operator Query Loyalty Statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7955","1764","Operator Query Loyalty Statement","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=input;  
    
    accountTypes = IC.queryAllPointAccountsByShortCode(input);
}
else
{
    accountTypes = IC.queryAllPointAccountsByTillId(identity.identityId);
}
__next = '2';","1","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7956","1764","Operator Query Loyalty Statement","if (empty(accountTypes)) {
  __next = 'error';
} else {
  var input = __input.response;
  var i = Util.toInt(input) - 1;
  if (i >= 0 && i < size(accountTypes)) {
    __params.AccountTypeCode = accountTypes.get(i);
    __next = '3';
  } else {
    __next = '2';
  }
}","2","Select Account Type","<html>
<body>
Please select account:<br>
$$if (empty(accountTypes)) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: accountTypes) {
    ${i} ${type}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7957","1764","Operator Query Loyalty Statement","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7958","1764","Operator Query Loyalty Statement","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7959","1764","Operator Query Loyalty Statement","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7960","1763","Operator Query Loyalty Account","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{0,128})$')){
    __params.AccountName = input;
    __next = '4'; 
} 
else{
    __next = '3';
}","3","Enter account name","<html>
<body>
Enter account name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7961","1764","Operator Query Loyalty Statement","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{0,128})$')){
    __params.AccountName = input;
    __next = '4'; 
} 
else{
    __next = '3';
}","3","Enter account name","<html>
<body>
Enter account name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7962","1765","Operator Query Consumer Loyalty Account","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */

__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7963","1765","Operator Query Consumer Loyalty Account","var input = __input.response;
if (input == '1') 
{
  __params.ReceiverPartyIdentifierType = '01';
  __next = '2a';
} 
else if (input == '2') 
{
  __params.ReceiverPartyIdentifierType = '15';
  __next = '2b';
}
else if (input == '3') 
{
  __params.ReceiverPartyIdentifierType = '04';
  __next = '2c';
}
else 
{
   __next = '1';
}","1","Select Identity Type","<html>
<body>
Please select option: <br>
1 Customer<br>
2 Group<br>
3 Organization
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7965","1765","Operator Query Consumer Loyalty Account","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7966","1765","Operator Query Consumer Loyalty Account","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","7967","1765","Operator Query Consumer Loyalty Account","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","7968","1765","Operator Query Consumer Loyalty Account","__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
      __next = '2';
   } 
 else 
   {
      __next = '2c';
   }","2c","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7976","1765","Operator Query Consumer Loyalty Account","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier= input;
  __next = '3';
} else {
  __next = '2a';
}","2a","Enter MSISDN","<html>
<body>
Enter MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7979","1765","Operator Query Consumer Loyalty Account","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2b';
}","2b","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","7980","1767","Operator Query Consumer Loyalty Statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */

__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","7981","1767","Operator Query Consumer Loyalty Statement","var input = __input.response;
if (input == '1') 
{
  __params.ReceiverPartyIdentifierType = '01';
  __next = '2a';
} 
else if (input == '2') 
{
  __params.ReceiverPartyIdentifierType = '15';
  __next = '2b';
}
else if (input == '3') 
{
  __params.ReceiverPartyIdentifierType = '04';
  __next = '2c';
}
else 
{
   __next = '1';
}","1","Select Identity Type","<html>
<body>
Please select option: <br>
1 Customer<br>
2 Group<br>
3 Organization
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","7982","1767","Operator Query Consumer Loyalty Statement","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '5';","4","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","7983","1767","Operator Query Consumer Loyalty Statement","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","7984","1767","Operator Query Consumer Loyalty Statement","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","7985","1767","Operator Query Consumer Loyalty Statement","__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
      __next = '3';
   } 
 else 
   {
      __next = '2c';
   }","2c","Enter Short Code","<html>
<body>
Enter Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","7986","1767","Operator Query Consumer Loyalty Statement","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier= input;
  __next = '3';
} else {
  __next = '2a';
}","2a","Enter MSISDN","<html>
<body>
Enter MSISDN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","7987","1767","Operator Query Consumer Loyalty Statement","var input = __input.response;
 if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{4,12})$')){
     __params.ReceiverPartyIdentifier = input;
     __next = '3';     
   } 
else{
    __next = '2b';
}","2b","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","7988","1768","Send Money via m-pesa With Prevalidation for STK","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","7989","1768","Send Money via m-pesa With Prevalidation for STK","__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
__params.EventType='PRE_VALIDATION';
if(__errorCode == 'UMC64000')
{
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
__params.errDesc='Pre-Validation confirmation is Timeout.';
TC.savingPreValidationEventLog(__params);
}
else
{
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","2","7990","1768","Send Money via m-pesa With Prevalidation for STK","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__params.Channel = __accessChannel;
var needDisplayFeeConfirmation=CurReq.hasValueInBody('TransactionRequest.needDisplayFeeConfirmation', 'true');
if (needDisplayFeeConfirmation)
{
TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
feeInfo=budgetMap.FeeInfo;
if(budgetMap.isError == '1')
{
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
 __next = 'end';
}
else
{
 feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
   var promptText = '';
  for(fee:feeList)
  {   
   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
 
   if(i < sizeLen)
   {
    promptText = promptText + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;

   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  promptText != '')
   {
    promptText = promptText +
 ',';
   }
 
    promptText = promptText + fee.publicName + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    promptText = promptText + ',';
   } 
   i = i+1;
  }
  if( promptText == '')
   {
     promptText =' No charge.';
   } 
 else
  {
    promptText =promptText +'.';
  } 
var promptText = promptText + '\n1. Yes\n2. No';
__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
accessDevice = CurReq.getIdentifierDef('AccessDevice');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
AG.sendTransOutgoing(CurReq,__params,'19');
__next = '2';
}
}
else
{
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Do Pre-Validation","Do Pre-Validation",""<endrec>
"Pre-Validation","","3","7991","1768","Send Money via m-pesa With Prevalidation for STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if (confirmedOrNot)
{ 
__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
CurResp = TargetService.invokeForScript(); 
TC.savingPreValidationEventLog(__params);
__next='end';
}
else
{ 
 var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
 if(resultType == '2' || resultType == '3')
 {
 __params.errDesc='Pre-Validation Result is Rejected.';
__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
}
 else if(resultType == '4')
 {
 __params.errDesc='Pre-Validation confirmation is Timeout.';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
 }
 else
 {
__params.errDesc=""Pre-Validation Request Failed."";
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
 } 
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
TC.savingPreValidationEventLog(__params);
  __next='cancel';
 }","2","Pre-Validataion Result","Pre-Validataion Result",""<endrec>
"Pre-Validation","","1","7992","1769","Group G2G Transfer With Prevalidation for STK","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","7993","1769","Group G2G Transfer With Prevalidation for STK","__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
__params.EventType='PRE_VALIDATION';
if(__errorCode == 'UMC64000')
{
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
__params.errDesc='Pre-Validation confirmation is Timeout.';
TC.savingPreValidationEventLog(__params);
}
else
{
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","2","7994","1769","Group G2G Transfer With Prevalidation for STK","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__params.Channel = __accessChannel;
var needDisplayFeeConfirmation=CurReq.hasValueInBody('TransactionRequest.needDisplayFeeConfirmation', 'true');
if (needDisplayFeeConfirmation)
{
TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
feeInfo=budgetMap.FeeInfo;
if(budgetMap.isError == '1')
{
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
 __next = 'end';
}
else
{
 feeList = budgetMap.fee;
   i = 1;
   sizeLen = 0;

   var promptText = '';
   
   if(null != feeList)
   {
      sizeLen = size(feeList);
      for(fee:feeList)
      {   
       promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
      
       if(i < sizeLen)
       {
        promptText = promptText + ',';
       }
        i = i+1 
      }
   }
   
  
   taxList = budgetMap.tax;
   i = 1;
   sizeLen =
 0;
   if(null != taxList)
   {
      sizeLen = size(taxList);
      for(tax:taxList)
      {
        if(i ==1 &&  promptText != '')
        {
            promptText = promptText +
            ',';
        }
   }

   promptText = promptText + fee.publicName + ':The amount of tax is '+tax.amount;

   if(i <sizeLen)
   {
    promptText = promptText + ',';
   } 
   i = i+1;
  }
  if( promptText == '')
   {
     promptText =' No charge.';
   } 
 else
  {
    promptText =promptText +'.';
  } 
var promptText = promptText + '\n1. Yes\n2. No';
__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
accessDevice = CurReq.getIdentifierDef('AccessDevice');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
AG.sendTransOutgoing(CurReq,__params,'19');
__next = '2';
}
}
else
{
CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Do Pre-Validation","Do Pre-Validation",""<endrec>
"Pre-Validation","","3","7995","1769","Group G2G Transfer With Prevalidation for STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if (confirmedOrNot)
{ 
__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
CurResp = TargetService.invokeForScript(); 
TC.savingPreValidationEventLog(__params);
__next='end';
}
else
{ 
 var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
 if(resultType == '2' || resultType == '3')
 {
 __params.errDesc='Pre-Validation Result is Rejected.';
__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
}
 else if(resultType == '4')
 {
 __params.errDesc='Pre-Validation confirmation is Timeout.';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
 }
 else
 {
__params.errDesc=""Pre-Validation Request Failed."";
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
 } 
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
TC.savingPreValidationEventLog(__params);
  __next='cancel';
 }","2","Pre-Validataion Result","Pre-Validataion Result",""<endrec>
"Pre-Validation","","1","7996","1770","Group G2G Transfer With Prevalidation for API","__next = '1';
 __params.Channel = __accessChannel;","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","7997","1770","Group G2G Transfer With Prevalidation for API","__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if(__errorCode == 'UMC64000')
{	
    __params.errCode='5';
    __params.errDesc='Pre-Validation confirmation is Timeout.';
    __params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
    __params.EventType='PRE_VALIDATION';
    __params.Reason='Timeout'; 
   TC.savingPreValidationEventLog(__params);
}
else
{
    __params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
 
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","2","7998","1770","Group G2G Transfer With Prevalidation for API","budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;
if(budgetMap.isError == '1')
{
 __params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
  __params.ResultMsg = '';
  feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
  for(fee:feeList)
  {
  
   __params.ResultMsg =__params.ResultMsg + fee.publicName+ ':The amount of charge is '+fee.amount;
   
   if(i < sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;
   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  __params.ResultMsg != '')
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
    __params.ResultMsg =__params.ResultMsg +tax.publicName+ ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
 
   i = i+1;
  }
  if( __params.ResultMsg == '')
   {
     __params.ResultMsg =' No charge.';
   }
 
 else
  {
    __params.ResultMsg =__params.ResultMsg +'.';
  }  
 __next = '2';
}
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","3","7999","1770","Group G2G Transfer With Prevalidation for API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{  
  __params.Reason='Continue Pre-Validation Transaction.';
  __params.ResultCode='0';
  __params.ResultMsg ='You confirm initiate transaction!';
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}
else
{
  __params.Reason='Pre-Validation Result is Rejected.';
   __params.ResultCode='1';
   __params.ResultMsg ='You rejected initiate transaction!';
  __next='cancel';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","8000","1771","Deposit Money With Prevalidation for API","__next = '1';
 __params.Channel = __accessChannel;","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","8001","1771","Deposit Money With Prevalidation for API","__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if(__errorCode == 'UMC64000')
{	
    __params.errCode='5';
    __params.errDesc='Pre-Validation confirmation is Timeout.';
    __params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
    __params.EventType='PRE_VALIDATION';
    __params.Reason='Timeout'; 
   TC.savingPreValidationEventLog(__params);
}
else
{
    __params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
 
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","2","8002","1771","Deposit Money With Prevalidation for API","budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;
if(budgetMap.isError == '1')
{
 __params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
  __params.ResultMsg = '';
  feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
  for(fee:feeList)
  {
  
   __params.ResultMsg =__params.ResultMsg + fee.publicName+ ':The amount of charge is '+fee.amount;
   
   if(i < sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;
   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  __params.ResultMsg != '')
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
    __params.ResultMsg =__params.ResultMsg +tax.publicName+ ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
 
   i = i+1;
  }
  if( __params.ResultMsg == '')
   {
     __params.ResultMsg =' No charge.';
   }
 
 else
  {
    __params.ResultMsg =__params.ResultMsg +'.';
  }  
 __next = '2';
}
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","3","8003","1771","Deposit Money With Prevalidation for API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{  
  __params.Reason='Continue Pre-Validation Transaction.';
  __params.ResultCode='0';
  __params.ResultMsg ='You confirm initiate transaction!';
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}
else
{
   __params.Reason='Pre-Validation Result is Rejected.';
   __params.ResultCode='1';
   __params.ResultMsg ='You rejected initiate transaction!';
  __next='cancel';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"TILL","","1","8004","1772","M-Shwari Deposit","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Deposit';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","8005","1772","M-Shwari Deposit","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8006","1772","M-Shwari Deposit","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';","2","Input Operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8007","1772","M-Shwari Deposit","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
__params.PIN = input;
    __next = '4';
} else {
    __secure = true;
    __next = '2';
}","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8008","1772","M-Shwari Deposit","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel deposit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8009","1773","M-Shwari Withdraw","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Savings_Withdraw';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","1","801","1008","Register Customer","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CreateCustomer';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ActionType = 'CreateCustomer';
__params.CustomerType = '1002';
__next = '1';","begin","Initialization ","",""<endrec>
"TILL","","2","8010","1773","M-Shwari Withdraw","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8011","1773","M-Shwari Withdraw","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';","2","Input Operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8012","1773","M-Shwari Withdraw","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '4';
}else{
    __next ='3';
}","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8013","1773","M-Shwari Withdraw","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel withdraw?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8014","1774","M-Shwari Request Loan","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '262626';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Request';
__params.Amount = '0';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","8015","1774","M-Shwari Request Loan","var input = __input.response;
if (Validator.isAmount(input)) {
    __referenceData.RequestBalance = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8016","1774","M-Shwari Request Loan","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';","2","Input Operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8017","1774","M-Shwari Request Loan","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '4';
}else{
    __next ='3';
}","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8018","1774","M-Shwari Request Loan","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel request loan?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8019","1775","M-Shwari Repay Loan","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Repayment';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","802","1008","Register Customer","var input = __input.response;
__params.FirstName = input;
__next = '2';
","1","Enter New first name","<html>
<body>
Enter new first name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","8020","1775","M-Shwari Repay Loan","var input = __input.response;
if (Validator.isAmount(input)) {
    __referenceData.RequestBalance = TC.convertAmountFormat(input);
    __params.Amount = __referenceData.RequestBalance;
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8021","1775","M-Shwari Repay Loan","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';","2","Input Operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8022","1775","M-Shwari Repay Loan","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '4';
}else{
    __next ='3';
}","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8023","1775","M-Shwari Repay Loan","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel repay loan?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8024","1776","M-Shwari Repay Loan Saving","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType= '04'; /* ShortCode*/
__params.ReceiverPartyIdentifier = '2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'FSI_Loan_Payment_from_Savings';
__params.Amount ='0';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","8025","1776","M-Shwari Repay Loan Saving","var input = __input.response;
if (Validator.isAmount(input)) {
    __referenceData.RequestBalance = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8026","1776","M-Shwari Repay Loan Saving","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';","2","Input Operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8027","1776","M-Shwari Repay Loan Saving","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '4';
}else{
    __next ='3';
}","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8028","1776","M-Shwari Repay Loan Saving","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel repay loan from saving?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8029","1676","initiate Direct Debit Transaction","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01'; /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /*OPERATOR ID */
__params.ReceiverPartyIdentifierType = '53'; /* REF Number */
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","3","803","1008","Register Customer","var input = __input.response;
__params.MiddleName = input;
__next = '3';","2","Enter New middle name","<html>
<body>
Enter New middle name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8030","1777","M-Shwari Query Mini Statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType= '05'; /* ShortCode*/
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Mini_Statement';
__next = '2';","begin","set parammeters","",""<endrec>
"TILL","","3","8032","1777","M-Shwari Query Mini Statement","var input = __input.response;
__params.InitiatorIdentifier = input;
__params.ReceiverPartyIdentifierType='99';
__params.ReceiverPartyIdentityType='5000';
__params.ReceiverPartyIdentifier=IC.queryOrgIdByOperatorUsername(input);
__secure = true;
__next = '3';","2","Input Operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8033","1777","M-Shwari Query Mini Statement","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '4';
}else{
    __next ='3';
}","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8034","1777","M-Shwari Query Mini Statement","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel query mini statement?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8035","1778","M-Shwari Query Balance","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType= '05'; /* ShortCode*/
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='262626';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Saving_Account_Balance';
__next = '2';","begin","set parammeters","",""<endrec>
"TILL","","3","8037","1778","M-Shwari Query Balance","var input = __input.response;
__params.InitiatorIdentifier = input;
__params.ReceiverPartyIdentifierType='99';
__params.ReceiverPartyIdentityType='5000';
__params.ReceiverPartyIdentifier=IC.queryOrgIdByOperatorUsername(input);
__secure = true;
__next = '3';","2","Input Operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8038","1778","M-Shwari Query Balance","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '4';
}else{
    __next ='3';
}","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8039","1778","M-Shwari Query Balance","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel query balance?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","804","1008","Register Customer","var input = __input.response;
__params.LastName = input;
__next = '4';","3","Enter New last name","<html>
<body>
Enter New last name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8040","1779","M-Shwari Query Credit Limit","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType= '05'; /* ShortCode*/
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Eligible_Credit_Limit';
__next = '2';","begin","set parammeters","",""<endrec>
"TILL","","3","8042","1779","M-Shwari Query Credit Limit","var input = __input.response;
__params.InitiatorIdentifier = input;
__params.ReceiverPartyIdentifierType='99';
__params.ReceiverPartyIdentityType='5000';
__params.ReceiverPartyIdentifier=IC.queryOrgIdByOperatorUsername(input);
__secure = true;
__next = '3';","2","Input Operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8043","1779","M-Shwari Query Credit Limit","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '4';
}else{
    __next ='3';
}","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8044","1779","M-Shwari Query Credit Limit","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel query credit limit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8045","1780","M-Shwari Query Loan Mini Statement","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType= '05'; /* ShortCode*/
__params.PrimaryPartyIdentifierType= '04';
__params.PrimaryPartyIdentifier='2001';
__params.TransactionCategory = 'FSI';
__params.TransactionSubCategory = 'Query_FSI_Loan_Mini_Statement';
__next = '2';","begin","set parammeters","",""<endrec>
"TILL","","3","8047","1780","M-Shwari Query Loan Mini Statement","var input = __input.response;
__params.InitiatorIdentifier = input;
__params.ReceiverPartyIdentifierType='99';
__params.ReceiverPartyIdentityType='5000';
__params.ReceiverPartyIdentifier=IC.queryOrgIdByOperatorUsername(input);
__secure = true;
__next = '3';","2","Input Operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8048","1780","M-Shwari Query Loan Mini Statement","var input = __input.response;
if(!empty(input)){
__params.PIN = input;
__next = '4';
}else{
    __next ='3';
}","3","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8049","1780","M-Shwari Query Loan Mini Statement","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>You will cancel query loan mini statement?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","805","1008","Register Customer","var input = __input.response;
if (input == '1') {
  __params.CertificateType = '01'; /* National ID */
  __next = '5';
} else if (input == '2') {
  __params.CertificateType = '02'; /* Military ID*/
  __next = '5';
} else if (input == '3') {
  __params.CertificateType = '03'; /*Alien ID */
  __next = '5';
} else if (input == '4') {
  __params.CertificateType = '04'; /* Diplomatic ID  */
  __next = '5';
} else if (input == '5') {
  __params.CertificateType = '05'; /* Passport */
  __next = '5';
}  else {
  __next = '4';
}","4","Identification Type","<html>
<body>
Identification Type<br>
1  National ID<br>
2  Military ID<br>
3  Alien ID<br>
4  Diplomatic ID<br>
5  Passport<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8050","1676","initiate Direct Debit Transaction","var input = __input.response;
__params.MandateID = input;
__next = '3';","2","Input mandate ID","<html>
<body>
Enter Mandate ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8051","1676","initiate Direct Debit Transaction","var input = __input.response;
if (Validator.isAmount(input)) {
__params.Amount = TC.convertAmountFormat(input);
__next = '4';
} else{
__next = '3';
}","3","Input amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8052","1676","initiate Direct Debit Transaction","var input = __input.response;
if (!empty(input)) {
__params.InitiatorIdentifier = input;
__next = '5';
} else {
__next = '4';
}","4","Input operator ID","<html>
<body>
Enter Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8053","1676","initiate Direct Debit Transaction","var input = __input.response;
if (!empty(input)) {
__params.PIN = input;
__next = '6';
} else {
__next = '5';
}","5","Input PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8054","1676","initiate Direct Debit Transaction","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Comfirm","<html>
<body>
Confirm to initialize the direct debit transaction?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","8055","1781","Two Step Authentication Transaction","__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","8057","1781","Two Step Authentication Transaction","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__params.Channel = __accessChannel;
var promptText = 'Please Enter Your Pin.';
__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
accessDevice = CurReq.getIdentifierDef('AccessDevice');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',notificationInfoList.get(0).recipients);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
AG.sendTransOutgoing(CurReq,__params,'19');
__next = '2';","1","Enter Pin","Enter Pin",""<endrec>
"CUSTOMER","","3","8058","1781","Two Step Authentication Transaction","OriginalReq.copyFromAsKeyValue(CurReq,'TransactionEventRequest.Parameters.Parameter.PIN','TransactionRequest.RequestContext.Parameter.PIN');
TargetService.invoke();
__next='end';","2","Authentication","Authentication",""<endrec>
"TILL","","7","8059","1765","Operator Query Consumer Loyalty Account","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{0,128})$')){
    __params.AccountName = input;
    __next = '4'; 
} 
else{
    __next = '3';
}","3","Enter account name","<html>
<body>
Enter account name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","806","1008","Register Customer","var input = __input.response;
__params.CertificateNumber = input;
__next = '6';","5","Enter New ID Number","<html>
<body>
Enter New ID Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8060","1767","Operator Query Consumer Loyalty Statement","var input = __input.response;
if (Validator.isMatchRegex(input,'^([0-9A-Za-z]{0,128})$')){
    __params.AccountName = input;
    __next = '4'; 
} 
else{
    __next = '3';
}","3","Enter account name","<html>
<body>
Enter account name:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","8062","1782","Web Default Template","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8064","1782","Web Default Template","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{

CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
__next = '2';
}
else
{
CurResp = TargetService.invokeForScript(); 
__next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","3","8065","1782","Web Default Template","CurResp = TargetService.invokeForScript(); 
__next='end';","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"CUSTOMER","","1","8066","1783","Subscribe Saving Plan For Customer","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'SubscribeSavingPlanForCustomer';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */ 
__params.ReceiverPartyIdentifier = msisdn;
recipientList= IC.queryPreValidationNotification(msisdn,'01','',0,'');
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","8067","1783","Subscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '2';
} else {
    __next = '1';
}","1","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","8068","1783","Subscribe Saving Plan For Customer","var input = __input.response;
__params.AccountTypeID = input;
__next = '3';","2","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","8069","1783","Subscribe Saving Plan For Customer","var input = __input.response;
 __params.AccountNo = input;
__next = '4';","3","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","807","1008","Register Customer","var input = __input.response;
if (Validator.isDate(input, 'ddMMyyyy')) {
  __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
  __next = '7';
} else {
  __next = '6';
}","6","Enter New Date of Birth","<html>
<body>
Enter New Date of Birth(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","8070","1784","Subscribe Saving Plan For Group","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'SubscribeSavingPlanForGroup';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
groups = IC.queryMyGroups(msisdn);
recipientList= IC.queryPreValidationNotification(msisdn,'01','',0,'');
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","8071","1784","Subscribe Saving Plan For Group","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","8072","1784","Subscribe Saving Plan For Group","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '3';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
 }else {
      __next = '2a';
   }","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","8073","1784","Subscribe Saving Plan For Group","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '4';
} else {
    __next = '3';
}","3","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","8082","1783","Subscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","8083","1783","Subscribe Saving Plan For Customer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","8084","1787","UnSubscribe Saving Plan For Customer","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'UnSubscribeSavingPlanForCustomer';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */ 
__params.ReceiverPartyIdentifier = msisdn;
recipientList= IC.queryPreValidationNotification(msisdn,'01','',0,'');
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","8085","1787","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '2';
} else {
    __next = '1';
}","1","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","8086","1787","UnSubscribe Saving Plan For Customer","var input = __input.response;
__params.AccountTypeID = input;
__next = '3';","2","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","8087","1787","UnSubscribe Saving Plan For Customer","var input = __input.response;
 __params.AccountNo = input;
__next = '4';","3","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","8088","1787","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","809","1008","Register Customer","var input = __input.response;
__params.ReceiverPartyIdentifierType = '01';
__params.ReceiverPartyIdentifier = input;
__params.RegisterMsisdn = input;
__next = '8';","7","Enter New phone no","<html>
<body>
Enter New phone no<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","8090","1784","Subscribe Saving Plan For Group","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","8091","1784","Subscribe Saving Plan For Group","var input = __input.response;
__params.AccountTypeID = input;
__next = '5';","4","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","8092","1784","Subscribe Saving Plan For Group","var input = __input.response;
 __params.AccountNo = input;
__next = '6';","5","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","8093","1784","Subscribe Saving Plan For Group","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '3';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","8094","1784","Subscribe Saving Plan For Group","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","8095","1788","UnSubscribe Saving Plan For Group","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'UnSubscribeSavingPlanForGroup';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
groups = IC.queryMyGroups(msisdn);
recipientList= IC.queryPreValidationNotification(msisdn,'01','',0,'');
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","8096","1788","UnSubscribe Saving Plan For Group","var input = __input.response;
if (input == '1') {
  __next = '2a';
} else if (input == '2') {
   if (empty(groups) || size(groups) == 0) {
      __errormsg = 'Sorry, there is no groups.';
      __next = 'error';
    } else {
       __next = '2b';
    }
} else {
   __next = '1';
}","1","Select Option","<html>
<body>
Please select option: <br>
1 Enter Group Code<br>
2 Select From My Groups
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","8097","1788","UnSubscribe Saving Plan For Group","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
if (!empty(input)) {
roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '3';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
 }else {
      __next = '2a';
   }","2a","Enter Group Code","<html>
<body>
Enter Group Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","8098","1788","UnSubscribe Saving Plan For Group","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '4';
} else {
    __next = '3';
}","3","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","810","1008","Register Customer","var input = __input.response;
if (input == '1') {
  __next = '9';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
New customer ${__params.FirstName}, ${__params.MiddleName}, ${__params.LastName}, ${__params.CertificateNumber}, ${__params.RegisterMsisdn}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","8100","1788","UnSubscribe Saving Plan For Group","var input = __input.response;
__params.AccountTypeID = input;
__next = '5';","4","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","8101","1788","UnSubscribe Saving Plan For Group","var input = __input.response;
 __params.AccountNo = input;
__next = '6';","5","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","8102","1788","UnSubscribe Saving Plan For Group","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(groups)){
  group= groups.get(i);
  groupCode= group.groupCode;
  __params.ReceiverPartyIdentifier = groupCode;
  roleList = IC.queryGroupMemberRoles(__params);
if ( !empty(roleList) || size(roleList)>0) {
  __next = '3';
}else {
   __errormsg = 'no current group member role.';
   __next = 'error';
}
} 
else{
  __next = '2b';
}","2b","Select From My Groups","<html>
<body>
Select Group:<br>
$$ var index = 1;
$$ for (group: groups){
 ${index} ${group.groupName} ${group.groupCode}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","8103","1788","UnSubscribe Saving Plan For Group","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8104","1789","Subscribe Saving Plan For Customer","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'SubscribeSavingPlanForCustomer';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","3","8105","1789","Subscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '3';
} else {
    __next = '2';
}","2","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8106","1789","Subscribe Saving Plan For Customer","var input = __input.response;
__params.AccountTypeID = input;
__next = '4';","3","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8107","1789","Subscribe Saving Plan For Customer","var input = __input.response;
 __params.AccountNo = input;
__next = '5';","4","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","8108","1789","Subscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '8';
} else {
    __secure = true;
    __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","8109","1789","Subscribe Saving Plan For Customer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","811","1008","Register Customer","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '10';","9","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8110","1790","Subscribe Saving Plan For Group","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'SubscribeSavingPlanForGroup';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
recipientList= IC.queryPreValidationNotification(msisdn,'01','',0,'');
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","11","812","1008","Register Customer","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo = IC.buildCustomerInfo(__params);
__next = 'end';","10","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8135","1789","Subscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input)) {
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","8137","1789","Subscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;
recipientList= IC.queryPreValidationNotification(input,'01','',0,'');
DEBUG.error('recipientList',recipientList);
  __next = '2';
} else {
  __next = '1';
}","1","Enter Requesting Customer MSISDN","<html>
<body>
Enter Requesting Customer MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8143","1793","Subscribe Saving Plan For Org","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'SubscribeSavingPlanForOrg';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */
recipientList= IC.queryPreValidationNotification(msisdn,'01','',0,'');
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","4","8144","1793","Subscribe Saving Plan For Org","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '4';
} else {
    __next = '3';
}","3","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8145","1793","Subscribe Saving Plan For Org","var input = __input.response;
__params.AccountTypeID = input;
__next = '5';","4","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8146","1793","Subscribe Saving Plan For Org","var input = __input.response;
 __params.AccountNo = input;
__next = '6';","5","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8147","1793","Subscribe Saving Plan For Org","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","8148","1793","Subscribe Saving Plan For Org","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","8149","1793","Subscribe Saving Plan For Org","var input = __input.response;
__params.InitiatorIdentifier = input;
__params.ReceiverPartyIdentifier = input;
__secure = true;
__next = '2';","1","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8152","1793","Subscribe Saving Plan For Org","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifier=input;  
    __params.InitiatorShortCode = input;
  __next = '3';
}else {
   __next = '2';
}","2","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8154","1794","UnSubscribe Saving Plan For Customer","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'UnSubscribeSavingPlanForCustomer';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","1","8173","1796","UnSubscribe Saving Plan For Org","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'UnSubscribeSavingPlanForOrg';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';    /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04';  /* Short Code */
recipientList= IC.queryPreValidationNotification(msisdn,'01','',0,'');
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","4","8174","1796","UnSubscribe Saving Plan For Org","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '4';
} else {
    __next = '3';
}","3","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8175","1796","UnSubscribe Saving Plan For Org","var input = __input.response;
__params.AccountTypeID = input;
__next = '5';","4","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8176","1796","UnSubscribe Saving Plan For Org","var input = __input.response;
 __params.AccountNo = input;
__next = '6';","5","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8177","1796","UnSubscribe Saving Plan For Org","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","8179","1796","UnSubscribe Saving Plan For Org","var input = __input.response;
__params.InitiatorIdentifier = input;
__params.ReceiverPartyIdentifier = input;
__secure = true;
__next = '2';","1","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8180","1796","UnSubscribe Saving Plan For Org","var input = __input.response;
if (!empty(input)) {
    __params.ReceiverPartyIdentifier=input;  
    __params.InitiatorShortCode = input;
  __next = '3';
}else {
   __next = '2';
}","2","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","8185","1798","API Default Template","__next = '1';
 __params.Channel = __accessChannel;","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8188","1798","API Default Template","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
 var serviceCode = CurReq.getValueFromBody('TransactionRequest.RequestContext.Parameter.ServiceCode');
 __params.ResultCode='1';
 __params.UMC_SessionID=__sessionId;
 __params.ResultMsg = 'The interface is not support for service [' +serviceCode+'].';
 AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);
}
else
{
  CurResp = TargetService.invokeForScript(); 
}
__next='end';","1","Initiate Transaction","Initiate Transaction",""<endrec>
"TILL","","1","8189","1799","UnSubscribe Saving Plan For Group","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'UnSubscribeSavingPlanForGroup';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '15'; /* GROUP_CODE*/
recipientList= IC.queryPreValidationNotification(msisdn,'01','',0,'');
__next = '1';","begin","set parammeters","",""<endrec>
"Internal","","1","8199","1800","API Transaction Template","__next = '1';
 __params.Channel = __accessChannel;","begin","set parammeters","",""<endrec>
"Internal","","2","8200","1800","API Transaction Template","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
 var serviceCode = CurReq.getValueFromBody('TransactionRequest.RequestContext.Parameter.ServiceCode');
 __params.ResultCode='1';
 __params.UMC_SessionID=__sessionId;
 __params.ResultMsg = 'The interface is not support for service [' +serviceCode+'].';
 AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);
}
else
{
  CurResp = TargetService.invokeForScript(); 
}
__next='end';","1","Initiate Transaction","Initiate Transaction",""<endrec>
"TILL","","7","8201","1789","Subscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input)) {
    __params.InitiatorShortCode = input;
    __next = '7';
} else {
    __next = '6';
}","6","Enter Organization Short Code","<html>
<body>
Enter Organization ShortCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8202","1790","Subscribe Saving Plan For Group","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '3';
} else {
    __next = '2';
}","2","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8203","1790","Subscribe Saving Plan For Group","var input = __input.response;
__params.AccountTypeID = input;
__next = '4';","3","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8204","1790","Subscribe Saving Plan For Group","var input = __input.response;
 __params.AccountNo = input;
__next = '5';","4","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8205","1790","Subscribe Saving Plan For Group","var input = __input.response;
if (!empty(input)) {
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8206","1790","Subscribe Saving Plan For Group","var input = __input.response;
if (!empty(input)) {
    __params.InitiatorShortCode = input;
    __next = '7';
} else {
    __next = '6';
}","6","Enter Organization Short Code","<html>
<body>
Enter Organization ShortCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","8207","1790","Subscribe Saving Plan For Group","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '8';
} else {
    __secure = true;
    __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","8208","1790","Subscribe Saving Plan For Group","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","8209","1790","Subscribe Saving Plan For Group","var input = __input.response;
var length = size(input);
if((length > 64) || empty(input))
{
__next = '1';
}
else
{
__params.ReceiverPartyIdentifier = input;
__next = '2';
}","1","Enter Group Code","<html>
<body>
Enter Group Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","8210","1794","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifier = input;
recipientList= IC.queryPreValidationNotification(input,'01','',0,'');
DEBUG.error('recipientList',recipientList);
  __next = '2';
} else {
  __next = '1';
}","1","Enter Requesting Customer MSISDN","<html>
<body>
Enter Requesting Customer MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8211","1794","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '3';
} else {
    __next = '2';
}","2","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8212","1794","UnSubscribe Saving Plan For Customer","var input = __input.response;
__params.AccountTypeID = input;
__next = '4';","3","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8213","1794","UnSubscribe Saving Plan For Customer","var input = __input.response;
 __params.AccountNo = input;
__next = '5';","4","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8214","1794","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input)) {
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8215","1794","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input)) {
    __params.InitiatorShortCode = input;
    __next = '7';
} else {
    __next = '6';
}","6","Enter Organization Short Code","<html>
<body>
Enter Organization ShortCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","8216","1794","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '8';
} else {
    __secure = true;
    __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","8219","1799","UnSubscribe Saving Plan For Group","var input = __input.response;
var length = size(input);
if((length > 64) || empty(input))
{
__next = '1';
}
else
{
__params.ReceiverPartyIdentifier = input;
__next = '2';
}","1","Enter Group Code","<html>
<body>
Enter Group Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8220","1799","UnSubscribe Saving Plan For Group","var input = __input.response;
if (!empty(input)) {
    __params.PlanCode= input;
    __next = '3';
} else {
    __next = '2';
}","2","Enter PlanCode","<html>
<body>
Enter PlanCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8221","1799","UnSubscribe Saving Plan For Group","var input = __input.response;
__params.AccountTypeID = input;
__next = '4';","3","Enter AccountTypeID","<html>
<body>
Enter AccountTypeID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8222","1799","UnSubscribe Saving Plan For Group","var input = __input.response;
 __params.AccountNo = input;
__next = '5';","4","Enter AccountNo","<html>
<body>
Enter AccountNo:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8223","1799","UnSubscribe Saving Plan For Group","var input = __input.response;
if (!empty(input)) {
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Enter operator ID","<html>
<body>
Enter operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8224","1799","UnSubscribe Saving Plan For Group","var input = __input.response;
if (!empty(input)) {
    __params.InitiatorShortCode = input;
    __next = '7';
} else {
    __next = '6';
}","6","Enter Organization Short Code","<html>
<body>
Enter Organization ShortCode<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","8225","1799","UnSubscribe Saving Plan For Group","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
    __next = '8';
} else {
    __secure = true;
    __next = '7';
}","7","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8232","1802","Indosat Reload","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SP_OPERATOR_NAME*/
__params.ReceiverPartyIdentifier = '200000000000010001';
__params.InitiatorIdentifierType = '01'; /* MSISDN  */
__params.InitiatorShortCode=identity.shortCode;
__params.InitiatorIdentifier = msisdn;
__params.aLAC=Util.getSplit(__input.cell_id,2);
__params.aCI=Util.getSplit(__input.cell_id,3);
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","8233","1802","Indosat Reload","var input = __input.response;
if (!empty(input)) {
  __params.SubscriberNumber = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter MSISDN Number","<html>
<body>
Enter MSISDN Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8234","1802","Indosat Reload","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(denominations)) {
  __params.DenominationCode = denominations.get(i).elementIdentifier;
  __next = '3';
} else {
  __next = '2';
}","2","Select Denomination","<html>
<body>
Denomination:<br>
$$denominations = IC.querySpBundle('1','');
$$var i = 1;
$$for (deno: denominations ) {
  ${i} ${deno.elementName}<br>
  $$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8235","1802","Indosat Reload","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Input PIN","<html>
<body>
Input PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8236","1802","Indosat Reload","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html><body>Indosat Reload ${__params.SubscriberNumber} ${__params.DenominationCode}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","8264","1783","Subscribe Saving Plan For Customer","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	if (input == '1')
	{
		budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
		if(budgetMap.isError == '1')
		{
			__errormsg = 'Pre-Validation is failed,Please check notification.';
			__params.TransactionUMCPreValidationEvent='Failed';
			__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
			__params.put('Common.Result.ErrorCode','TS28009');
			if (empty(recipientList)) 
			{
				__errormsg = 'The recipient is null and send notification failed.';
			} 
			else 
			{
				NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
			}
			__next = 'error';
		}
		else
		{
				var promptText = '';
				feeList = budgetMap.fee;
				if(!empty(feeList))
				{
					   i = 1;
					   sizeLen = size(feeList);
					  for(fee:feeList)
					  {
						   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
						   __params.TotalTee = fee.amount;
						   if(i < sizeLen)
						   {
								promptText = promptText + '<br>';
						   }
							i = i+1 
					  }
				}

			  if( promptText == '')
			   {
					promptText =' No charge.';
			   } 
			
 else
			  {
					promptText =promptText +'.';
			  }
			__params.preValidationResult = promptText;
			__next = '6';
		}
	}
	else if (input == '2') 
	{
		__next = '7';
	}
}
else 
{
	__next = '5';
}","5","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","8265","1783","Subscribe Saving Plan For Customer","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	__params.OperationType= input ;
	if (input == '1')
	{
		__params.EventType=""PRE_VALIDATION"";
		__params.Reason=""Continue Pre-Validation Transaction"";
		TC.savingPreValidationEventLog(__params);
		__next = '7';
	}
	else if (input == '2') {
		__params.EventType=""PRE_VALIDATION"";
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.Reason=""Rejected"";
		__errormsg = 'You have chosed to reject transation,Please check notification.';
		TC.savingPreValidationEventLog(__params);
		__params.TransactionUMCPreValidationEvent='Rejected';
		__params.TransactionUMCPreValidationError='Choosing Reject';
		__params.put('Common.Result.ErrorCode','TS28009');
		if (empty(recipientList)) {
			__errormsg = 'The recipient is null and send notification failed.';
		} else {
			NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
		}
		__next = 'error';
		}
	}
else {
	__next = '6';
}","6","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","8266","1783","Subscribe Saving Plan For Customer","if(__errorCode == 'UMC64000')
{
	__params.EventType=""PRE_VALIDATION"";
	__params.errDesc='Pre-Validation confirmation is Timeout.';
	__params.Reason=""Timeout"";
	TC.savingPreValidationEventLog(__params);
	__params.TransactionPreValidationEvent='Timeout';
	__params.TransactionPreValidationError='Time out';
	__params.put('Common.Result.ErrorCode','UMC64000');
	if (empty(recipientList)) {
		__errormsg = 'The recipient is null and send notification failed.';
	} else {
		NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
	}
}","error","Execute while errors occur","error occurs.",""<endrec>
"CUSTOMER","","9","8267","1784","Subscribe Saving Plan For Group","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	if (input == '1')
	{
		budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
		if(budgetMap.isError == '1')
		{
			__errormsg = 'Pre-Validation is failed,Please check notification.';
			__params.TransactionUMCPreValidationEvent='Failed';
			__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
			__params.put('Common.Result.ErrorCode','TS28009');
			if (empty(recipientList)) 
			{
				__errormsg = 'The recipient is null and send notification failed.';
			} 
			else 
			{
				NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
			}
			__next = 'error';
		}
		else
		{
				var promptText = '';
				feeList = budgetMap.fee;
				if(!empty(feeList))
				{
					   i = 1;
					   sizeLen = size(feeList);
					  for(fee:feeList)
					  {
						   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
						   __params.TotalTee = fee.amount;
						   if(i < sizeLen)
						   {
								promptText = promptText + '<br>';
						   }
							i = i+1 
					  }
				}

			  if( promptText == '')
			   {
					promptText =' No charge.';
			   } 
			
 else
			  {
					promptText =promptText +'.';
			  }
			__params.preValidationResult = promptText;
			__next = '8';
		}
	}
	else if (input == '2') 
	{
		__next = '9';
	}
}
else 
{
	__next = '7';
}","7","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","8268","1784","Subscribe Saving Plan For Group","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	__params.OperationType= input ;
	if (input == '1')
	{
		__params.EventType=""PRE_VALIDATION"";
		__params.Reason=""Continue Pre-Validation Transaction"";
		TC.savingPreValidationEventLog(__params);
		__next = '9';
	}
	else if (input == '2') {
		__params.EventType=""PRE_VALIDATION"";
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.Reason=""Rejected"";
		__errormsg = 'You have chosed to reject transation,Please check notification.';
		TC.savingPreValidationEventLog(__params);
		__params.TransactionUMCPreValidationEvent='Rejected';
		__params.TransactionUMCPreValidationError='Choosing Reject';
		__params.put('Common.Result.ErrorCode','TS28009');
		if (empty(recipientList)) {
			__errormsg = 'The recipient is null and send notification failed.';
		} else {
			NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
		}
		__next = 'error';
		}
	}
else {
	__next = '8';
}","8","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","8269","1784","Subscribe Saving Plan For Group","if(__errorCode == 'UMC64000')
{
	__params.EventType=""PRE_VALIDATION"";
	__params.errDesc='Pre-Validation confirmation is Timeout.';
	__params.Reason=""Timeout"";
	TC.savingPreValidationEventLog(__params);
	__params.TransactionPreValidationEvent='Timeout';
	__params.TransactionPreValidationError='Time out';
	__params.put('Common.Result.ErrorCode','UMC64000');
	if (empty(recipientList)) {
		__errormsg = 'The recipient is null and send notification failed.';
	} else {
		NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
	}
}","error","Execute while errors occur","error occurs.",""<endrec>
"CUSTOMER","","6","8270","1787","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	if (input == '1')
	{
		budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
		if(budgetMap.isError == '1')
		{
			__errormsg = 'Pre-Validation is failed,Please check notification.';
			__params.TransactionUMCPreValidationEvent='Failed';
			__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
			__params.put('Common.Result.ErrorCode','TS28009');
			if (empty(recipientList)) 
			{
				__errormsg = 'The recipient is null and send notification failed.';
			} 
			else 
			{
				NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
			}
			__next = 'error';
		}
		else
		{
				var promptText = '';
				feeList = budgetMap.fee;
				if(!empty(feeList))
				{
					   i = 1;
					   sizeLen = size(feeList);
					  for(fee:feeList)
					  {
						   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
						   __params.TotalTee = fee.amount;
						   if(i < sizeLen)
						   {
								promptText = promptText + '<br>';
						   }
							i = i+1 
					  }
				}

			  if( promptText == '')
			   {
					promptText =' No charge.';
			   } 
			
 else
			  {
					promptText =promptText +'.';
			  }
			__params.preValidationResult = promptText;
			__next = '6';
		}
	}
	else if (input == '2') 
	{
		__next = '7';
	}
}
else 
{
	__next = '5';
}","5","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","8271","1787","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	__params.OperationType= input ;
	if (input == '1')
	{
		__params.EventType=""PRE_VALIDATION"";
		__params.Reason=""Continue Pre-Validation Transaction"";
		TC.savingPreValidationEventLog(__params);
		__next = '7';
	}
	else if (input == '2') {
		__params.EventType=""PRE_VALIDATION"";
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.Reason=""Rejected"";
		__errormsg = 'You have chosed to reject transation,Please check notification.';
		TC.savingPreValidationEventLog(__params);
		__params.TransactionUMCPreValidationEvent='Rejected';
		__params.TransactionUMCPreValidationError='Choosing Reject';
		__params.put('Common.Result.ErrorCode','TS28009');
		if (empty(recipientList)) {
			__errormsg = 'The recipient is null and send notification failed.';
		} else {
			NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
		}
		__next = 'error';
		}
	}
else {
	__next = '6';
}","6","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","8272","1787","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","8273","1787","UnSubscribe Saving Plan For Customer","if(__errorCode == 'UMC64000')
{
	__params.EventType=""PRE_VALIDATION"";
	__params.errDesc='Pre-Validation confirmation is Timeout.';
	__params.Reason=""Timeout"";
	TC.savingPreValidationEventLog(__params);
	__params.TransactionPreValidationEvent='Timeout';
	__params.TransactionPreValidationError='Time out';
	__params.put('Common.Result.ErrorCode','UMC64000');
	if (empty(recipientList)) {
		__errormsg = 'The recipient is null and send notification failed.';
	} else {
		NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
	}
}","error","Execute while errors occur","error occurs.",""<endrec>
"CUSTOMER","","9","8274","1788","UnSubscribe Saving Plan For Group","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	if (input == '1')
	{
		budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
		if(budgetMap.isError == '1')
		{
			__errormsg = 'Pre-Validation is failed,Please check notification.';
			__params.TransactionUMCPreValidationEvent='Failed';
			__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
			__params.put('Common.Result.ErrorCode','TS28009');
			if (empty(recipientList)) 
			{
				__errormsg = 'The recipient is null and send notification failed.';
			} 
			else 
			{
				NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
			}
			__next = 'error';
		}
		else
		{
				var promptText = '';
				feeList = budgetMap.fee;
				if(!empty(feeList))
				{
					   i = 1;
					   sizeLen = size(feeList);
					  for(fee:feeList)
					  {
						   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
						   __params.TotalTee = fee.amount;
						   if(i < sizeLen)
						   {
								promptText = promptText + '<br>';
						   }
							i = i+1 
					  }
				}

			  if( promptText == '')
			   {
					promptText =' No charge.';
			   } 
			
 else
			  {
					promptText =promptText +'.';
			  }
			__params.preValidationResult = promptText;
			__next = '8';
		}
	}
	else if (input == '2') 
	{
		__next = '9';
	}
}
else 
{
	__next = '7';
}","7","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","8275","1788","UnSubscribe Saving Plan For Group","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	__params.OperationType= input ;
	if (input == '1')
	{
		__params.EventType=""PRE_VALIDATION"";
		__params.Reason=""Continue Pre-Validation Transaction"";
		TC.savingPreValidationEventLog(__params);
		__next = '9';
	}
	else if (input == '2') {
		__params.EventType=""PRE_VALIDATION"";
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.Reason=""Rejected"";
		__errormsg = 'You have chosed to reject transation,Please check notification.';
		TC.savingPreValidationEventLog(__params);
		__params.TransactionUMCPreValidationEvent='Rejected';
		__params.TransactionUMCPreValidationError='Choosing Reject';
		__params.put('Common.Result.ErrorCode','TS28009');
		if (empty(recipientList)) {
			__errormsg = 'The recipient is null and send notification failed.';
		} else {
			NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
		}
		__next = 'error';
		}
	}
else {
	__next = '8';
}","8","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","8276","1788","UnSubscribe Saving Plan For Group","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","12","8277","1788","UnSubscribe Saving Plan For Group","if(__errorCode == 'UMC64000')
{
	__params.EventType=""PRE_VALIDATION"";
	__params.errDesc='Pre-Validation confirmation is Timeout.';
	__params.Reason=""Timeout"";
	TC.savingPreValidationEventLog(__params);
	__params.TransactionPreValidationEvent='Timeout';
	__params.TransactionPreValidationError='Time out';
	__params.put('Common.Result.ErrorCode','UMC64000');
	if (empty(recipientList)) {
		__errormsg = 'The recipient is null and send notification failed.';
	} else {
		NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
	}
}","error","Execute while errors occur","error occurs.",""<endrec>
"TILL","","9","8278","1789","Subscribe Saving Plan For Customer","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	if (input == '1')
	{
		budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
		if(budgetMap.isError == '1')
		{
			__errormsg = 'Pre-Validation is failed,Please check notification.';
			__params.TransactionUMCPreValidationEvent='Failed';
			__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
			__params.put('Common.Result.ErrorCode','TS28009');
			if (empty(recipientList)) 
			{
				__errormsg = 'The recipient is null and send notification failed.';
			} 
			else 
			{
				NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
			}
			__next = 'error';
		}
		else
		{
				var promptText = '';
				feeList = budgetMap.fee;
				if(!empty(feeList))
				{
					   i = 1;
					   sizeLen = size(feeList);
					  for(fee:feeList)
					  {
						   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
						   __params.TotalTee = fee.amount;
						   if(i < sizeLen)
						   {
								promptText = promptText + '<br>';
						   }
							i = i+1 
					  }
				}

			  if( promptText == '')
			   {
					promptText =' No charge.';
			   } 
			
 else
			  {
					promptText =promptText +'.';
			  }
			__params.preValidationResult = promptText;
			__next = '9';
		}
	}
	else if (input == '2') 
	{
		__next = '10';
	}
}
else 
{
	__next = '8';
}","8","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","8279","1789","Subscribe Saving Plan For Customer","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	__params.OperationType= input ;
	if (input == '1')
	{
		__params.EventType=""PRE_VALIDATION"";
		__params.Reason=""Continue Pre-Validation Transaction"";
		TC.savingPreValidationEventLog(__params);
		__next = '10';
	}
	else if (input == '2') {
		__params.EventType=""PRE_VALIDATION"";
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.Reason=""Rejected"";
		__errormsg = 'You have chosed to reject transation,Please check notification.';
		TC.savingPreValidationEventLog(__params);
		__params.TransactionUMCPreValidationEvent='Rejected';
		__params.TransactionUMCPreValidationError='Choosing Reject';
		__params.put('Common.Result.ErrorCode','TS28009');
		if (empty(recipientList)) {
			__errormsg = 'The recipient is null and send notification failed.';
		} else {
			NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
		}
		__next = 'error';
		}
	}
else {
	__next = '9';
}","9","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","8280","1789","Subscribe Saving Plan For Customer","if(__errorCode == 'UMC64000')
{
	__params.EventType=""PRE_VALIDATION"";
	__params.errDesc='Pre-Validation confirmation is Timeout.';
	__params.Reason=""Timeout"";
	TC.savingPreValidationEventLog(__params);
	__params.TransactionPreValidationEvent='Timeout';
	__params.TransactionPreValidationError='Time out';
	__params.put('Common.Result.ErrorCode','UMC64000');
	if (empty(recipientList)) {
		__errormsg = 'The recipient is null and send notification failed.';
	} else {
		NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
	}
}","error","Execute while errors occur","error occurs.",""<endrec>
"TILL","","9","8281","1790","Subscribe Saving Plan For Group","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	if (input == '1')
	{
		budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
		if(budgetMap.isError == '1')
		{
			__errormsg = 'Pre-Validation is failed,Please check notification.';
			__params.TransactionUMCPreValidationEvent='Failed';
			__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
			__params.put('Common.Result.ErrorCode','TS28009');
			if (empty(recipientList)) 
			{
				__errormsg = 'The recipient is null and send notification failed.';
			} 
			else 
			{
				NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
			}
			__next = 'error';
		}
		else
		{
				var promptText = '';
				feeList = budgetMap.fee;
				if(!empty(feeList))
				{
					   i = 1;
					   sizeLen = size(feeList);
					  for(fee:feeList)
					  {
						   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
						   __params.TotalTee = fee.amount;
						   if(i < sizeLen)
						   {
								promptText = promptText + '<br>';
						   }
							i = i+1 
					  }
				}

			  if( promptText == '')
			   {
					promptText =' No charge.';
			   } 
			
 else
			  {
					promptText =promptText +'.';
			  }
			__params.preValidationResult = promptText;
			__next = '9';
		}
	}
	else if (input == '2') 
	{
		__next = '10';
	}
}
else 
{
	__next = '8';
}","8","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","8282","1790","Subscribe Saving Plan For Group","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	__params.OperationType= input ;
	if (input == '1')
	{
		__params.EventType=""PRE_VALIDATION"";
		__params.Reason=""Continue Pre-Validation Transaction"";
		TC.savingPreValidationEventLog(__params);
		__next = '10';
	}
	else if (input == '2') {
		__params.EventType=""PRE_VALIDATION"";
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.Reason=""Rejected"";
		__errormsg = 'You have chosed to reject transation,Please check notification.';
		TC.savingPreValidationEventLog(__params);
		__params.TransactionUMCPreValidationEvent='Rejected';
		__params.TransactionUMCPreValidationError='Choosing Reject';
		__params.put('Common.Result.ErrorCode','TS28009');
		if (empty(recipientList)) {
			__errormsg = 'The recipient is null and send notification failed.';
		} else {
			NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
		}
		__next = 'error';
		}
	}
else {
	__next = '9';
}","9","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","8283","1790","Subscribe Saving Plan For Group","if(__errorCode == 'UMC64000')
{
	__params.EventType=""PRE_VALIDATION"";
	__params.errDesc='Pre-Validation confirmation is Timeout.';
	__params.Reason=""Timeout"";
	TC.savingPreValidationEventLog(__params);
	__params.TransactionPreValidationEvent='Timeout';
	__params.TransactionPreValidationError='Time out';
	__params.put('Common.Result.ErrorCode','UMC64000');
	if (empty(recipientList)) {
		__errormsg = 'The recipient is null and send notification failed.';
	} else {
		NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
	}
}","error","Execute while errors occur","error occurs.",""<endrec>
"TILL","","8","8284","1793","Subscribe Saving Plan For Org","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	if (input == '1')
	{
		budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
		if(budgetMap.isError == '1')
		{
			__errormsg = 'Pre-Validation is failed,Please check notification.';
			__params.TransactionUMCPreValidationEvent='Failed';
			__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
			__params.put('Common.Result.ErrorCode','TS28009');
			if (empty(recipientList)) 
			{
				__errormsg = 'The recipient is null and send notification failed.';
			} 
			else 
			{
				NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
			}
			__next = 'error';
		}
		else
		{
				var promptText = '';
				feeList = budgetMap.fee;
				if(!empty(feeList))
				{
					   i = 1;
					   sizeLen = size(feeList);
					  for(fee:feeList)
					  {
						   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
						   __params.TotalTee = fee.amount;
						   if(i < sizeLen)
						   {
								promptText = promptText + '<br>';
						   }
							i = i+1 
					  }
				}

			  if( promptText == '')
			   {
					promptText =' No charge.';
			   } 
			
 else
			  {
					promptText =promptText +'.';
			  }
			__params.preValidationResult = promptText;
			__next = '8';
		}
	}
	else if (input == '2') 
	{
		__next = '9';
	}
}
else 
{
	__next = '7';
}","7","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","8285","1793","Subscribe Saving Plan For Org","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	__params.OperationType= input ;
	if (input == '1')
	{
		__params.EventType=""PRE_VALIDATION"";
		__params.Reason=""Continue Pre-Validation Transaction"";
		TC.savingPreValidationEventLog(__params);
		__next = '9';
	}
	else if (input == '2') {
		__params.EventType=""PRE_VALIDATION"";
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.Reason=""Rejected"";
		__errormsg = 'You have chosed to reject transation,Please check notification.';
		TC.savingPreValidationEventLog(__params);
		__params.TransactionUMCPreValidationEvent='Rejected';
		__params.TransactionUMCPreValidationError='Choosing Reject';
		__params.put('Common.Result.ErrorCode','TS28009');
		if (empty(recipientList)) {
			__errormsg = 'The recipient is null and send notification failed.';
		} else {
			NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
		}
		__next = 'error';
		}
	}
else {
	__next = '8';
}","8","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","8286","1793","Subscribe Saving Plan For Org","if(__errorCode == 'UMC64000')
{
	__params.EventType=""PRE_VALIDATION"";
	__params.errDesc='Pre-Validation confirmation is Timeout.';
	__params.Reason=""Timeout"";
	TC.savingPreValidationEventLog(__params);
	__params.TransactionPreValidationEvent='Timeout';
	__params.TransactionPreValidationError='Time out';
	__params.put('Common.Result.ErrorCode','UMC64000');
	if (empty(recipientList)) {
		__errormsg = 'The recipient is null and send notification failed.';
	} else {
		NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
	}
}","error","Execute while errors occur","error occurs.",""<endrec>
"TILL","","9","8287","1794","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	if (input == '1')
	{
		budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
		if(budgetMap.isError == '1')
		{
			__errormsg = 'Pre-Validation is failed,Please check notification.';
			__params.TransactionUMCPreValidationEvent='Failed';
			__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
			__params.put('Common.Result.ErrorCode','TS28009');
			if (empty(recipientList)) 
			{
				__errormsg = 'The recipient is null and send notification failed.';
			} 
			else 
			{
				NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
			}
			__next = 'error';
		}
		else
		{
				var promptText = '';
				feeList = budgetMap.fee;
				if(!empty(feeList))
				{
					   i = 1;
					   sizeLen = size(feeList);
					  for(fee:feeList)
					  {
						   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
						   __params.TotalTee = fee.amount;
						   if(i < sizeLen)
						   {
								promptText = promptText + '<br>';
						   }
							i = i+1 
					  }
				}

			  if( promptText == '')
			   {
					promptText =' No charge.';
			   } 
			
 else
			  {
					promptText =promptText +'.';
			  }
			__params.preValidationResult = promptText;
			__next = '9';
		}
	}
	else if (input == '2') 
	{
		__next = '10';
	}
}
else 
{
	__next = '8';
}","8","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","8288","1794","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	__params.OperationType= input ;
	if (input == '1')
	{
		__params.EventType=""PRE_VALIDATION"";
		__params.Reason=""Continue Pre-Validation Transaction"";
		TC.savingPreValidationEventLog(__params);
		__next = '10';
	}
	else if (input == '2') {
		__params.EventType=""PRE_VALIDATION"";
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.Reason=""Rejected"";
		__errormsg = 'You have chosed to reject transation,Please check notification.';
		TC.savingPreValidationEventLog(__params);
		__params.TransactionUMCPreValidationEvent='Rejected';
		__params.TransactionUMCPreValidationError='Choosing Reject';
		__params.put('Common.Result.ErrorCode','TS28009');
		if (empty(recipientList)) {
			__errormsg = 'The recipient is null and send notification failed.';
		} else {
			NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
		}
		__next = 'error';
		}
	}
else {
	__next = '9';
}","9","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","8289","1794","UnSubscribe Saving Plan For Customer","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","8290","1794","UnSubscribe Saving Plan For Customer","if(__errorCode == 'UMC64000')
{
	__params.EventType=""PRE_VALIDATION"";
	__params.errDesc='Pre-Validation confirmation is Timeout.';
	__params.Reason=""Timeout"";
	TC.savingPreValidationEventLog(__params);
	__params.TransactionPreValidationEvent='Timeout';
	__params.TransactionPreValidationError='Time out';
	__params.put('Common.Result.ErrorCode','UMC64000');
	if (empty(recipientList)) {
		__errormsg = 'The recipient is null and send notification failed.';
	} else {
		NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
	}
}","error","Execute while errors occur","error occurs.",""<endrec>
"TILL","","9","8291","1799","UnSubscribe Saving Plan For Group","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	if (input == '1')
	{
		budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
		if(budgetMap.isError == '1')
		{
			__errormsg = 'Pre-Validation is failed,Please check notification.';
			__params.TransactionUMCPreValidationEvent='Failed';
			__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
			__params.put('Common.Result.ErrorCode','TS28009');
			if (empty(recipientList)) 
			{
				__errormsg = 'The recipient is null and send notification failed.';
			} 
			else 
			{
				NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
			}
			__next = 'error';
		}
		else
		{
				var promptText = '';
				feeList = budgetMap.fee;
				if(!empty(feeList))
				{
					   i = 1;
					   sizeLen = size(feeList);
					  for(fee:feeList)
					  {
						   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
						   __params.TotalTee = fee.amount;
						   if(i < sizeLen)
						   {
								promptText = promptText + '<br>';
						   }
							i = i+1 
					  }
				}

			  if( promptText == '')
			   {
					promptText =' No charge.';
			   } 
			
 else
			  {
					promptText =promptText +'.';
			  }
			__params.preValidationResult = promptText;
			__next = '9';
		}
	}
	else if (input == '2') 
	{
		__next = '10';
	}
}
else 
{
	__next = '8';
}","8","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","8292","1799","UnSubscribe Saving Plan For Group","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	__params.OperationType= input ;
	if (input == '1')
	{
		__params.EventType=""PRE_VALIDATION"";
		__params.Reason=""Continue Pre-Validation Transaction"";
		TC.savingPreValidationEventLog(__params);
		__next = '10';
	}
	else if (input == '2') {
		__params.EventType=""PRE_VALIDATION"";
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.Reason=""Rejected"";
		__errormsg = 'You have chosed to reject transation,Please check notification.';
		TC.savingPreValidationEventLog(__params);
		__params.TransactionUMCPreValidationEvent='Rejected';
		__params.TransactionUMCPreValidationError='Choosing Reject';
		__params.put('Common.Result.ErrorCode','TS28009');
		if (empty(recipientList)) {
			__errormsg = 'The recipient is null and send notification failed.';
		} else {
			NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
		}
		__next = 'error';
		}
	}
else {
	__next = '9';
}","9","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","8293","1799","UnSubscribe Saving Plan For Group","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '10';
}","10","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","8294","1799","UnSubscribe Saving Plan For Group","if(__errorCode == 'UMC64000')
{
	__params.EventType=""PRE_VALIDATION"";
	__params.errDesc='Pre-Validation confirmation is Timeout.';
	__params.Reason=""Timeout"";
	TC.savingPreValidationEventLog(__params);
	__params.TransactionPreValidationEvent='Timeout';
	__params.TransactionPreValidationError='Time out';
	__params.put('Common.Result.ErrorCode','UMC64000');
	if (empty(recipientList)) {
		__errormsg = 'The recipient is null and send notification failed.';
	} else {
		NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
	}
}","error","Execute while errors occur","error occurs.",""<endrec>
"TILL","","8","8295","1796","UnSubscribe Saving Plan For Org","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	if (input == '1')
	{
		budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
		if(budgetMap.isError == '1')
		{
			__errormsg = 'Pre-Validation is failed,Please check notification.';
			__params.TransactionUMCPreValidationEvent='Failed';
			__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
			__params.put('Common.Result.ErrorCode','TS28009');
			if (empty(recipientList)) 
			{
				__errormsg = 'The recipient is null and send notification failed.';
			} 
			else 
			{
				NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
			}
			__next = 'error';
		}
		else
		{
				var promptText = '';
				feeList = budgetMap.fee;
				if(!empty(feeList))
				{
					   i = 1;
					   sizeLen = size(feeList);
					  for(fee:feeList)
					  {
						   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
						   __params.TotalTee = fee.amount;
						   if(i < sizeLen)
						   {
								promptText = promptText + '<br>';
						   }
							i = i+1 
					  }
				}

			  if( promptText == '')
			   {
					promptText =' No charge.';
			   } 
			
 else
			  {
					promptText =promptText +'.';
			  }
			__params.preValidationResult = promptText;
			__next = '8';
		}
	}
	else if (input == '2') 
	{
		__next = '9';
	}
}
else 
{
	__next = '7';
}","7","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","8296","1796","UnSubscribe Saving Plan For Org","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
	__params.OperationType= input ;
	if (input == '1')
	{
		__params.EventType=""PRE_VALIDATION"";
		__params.Reason=""Continue Pre-Validation Transaction"";
		TC.savingPreValidationEventLog(__params);
		__next = '9';
	}
	else if (input == '2') {
		__params.EventType=""PRE_VALIDATION"";
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.Reason=""Rejected"";
		__errormsg = 'You have chosed to reject transation,Please check notification.';
		TC.savingPreValidationEventLog(__params);
		__params.TransactionUMCPreValidationEvent='Rejected';
		__params.TransactionUMCPreValidationError='Choosing Reject';
		__params.put('Common.Result.ErrorCode','TS28009');
		if (empty(recipientList)) {
			__errormsg = 'The recipient is null and send notification failed.';
		} else {
			NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
		}
		__next = 'error';
		}
	}
else {
	__next = '8';
}","8","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","8297","1796","UnSubscribe Saving Plan For Org","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '9';
}","9","Confirm","<html>
<body>
Confirm to submit ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","8298","1796","UnSubscribe Saving Plan For Org","if(__errorCode == 'UMC64000')
{
	__params.EventType=""PRE_VALIDATION"";
	__params.errDesc='Pre-Validation confirmation is Timeout.';
	__params.Reason=""Timeout"";
	TC.savingPreValidationEventLog(__params);
	__params.TransactionPreValidationEvent='Timeout';
	__params.TransactionPreValidationError='Time out';
	__params.put('Common.Result.ErrorCode','UMC64000');
	if (empty(recipientList)) {
		__errormsg = 'The recipient is null and send notification failed.';
	} else {
		NC.sendPreValidationNotification(recipientList,__params.Channel,101000000000001078,__params);
	}
}","error","Execute while errors occur","error occurs.",""<endrec>
"TILL","","1","8299","1808","Purchase Data Package","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SP_OPERATOR_NAME*/
__params.ReceiverPartyIdentifier = '200000000000010001';
__params.InitiatorIdentifierType = '01'; /* MSISDN  */
__params.InitiatorShortCode=identity.shortCode;
__params.InitiatorIdentifier = msisdn;
__params.PackageType= '2';
__params.BundleCategory= '2';
__params.aLAC=Util.getSplit(__input.cell_id,2);
__params.aCI=Util.getSplit(__input.cell_id,3);
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","8300","1808","Purchase Data Package","if (empty(packageList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(packageList)) {
               type = packageList.get(tmp);
                __params.PackageGroup = type.groupCode;
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Select Package Group","<html>
<body>
Please Select Package Group :<br>
$$packageList = IC.queryPackageGroup();
$$if (empty(packageList)) {
  No package group can be selected.
$$} else {
  $$var i = 1;
  $$for(group: packageList) {
  ${i} ${group.groupName}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8301","1808","Purchase Data Package","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(packages)) {
  __params.PackageCode = packages.get(i).elementIdentifier;
  __next = '3';
} else {
  __next = '2';
}","2","PackageName","<html>
<body>
Package Name:<br>
$$packages = IC.querySpBundle('2',__params.PackageGroup);
$$var i = 1;
$$for (package: packages ) {
  ${i} ${package.elementName}<br>
  $$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8305","1808","Purchase Data Package","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8306","1808","Purchase Data Package","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html><body>Purchase Package ${__params.RechargedMSISDN} ${__params.PackageCode}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8307","1808","Purchase Data Package","var input = __input.response;
if (!empty(input)) {
__params.RechargedMSISDN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter MSISDN Number","<html>
<body>
Enter MSISDN Number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8309","1809","Purchase VAS Package","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SP_OPERATOR_NAME*/
__params.ReceiverPartyIdentifier = '200000000000010001';
__params.InitiatorIdentifierType = '01'; /* MSISDN  */
__params.InitiatorShortCode=identity.shortCode;
__params.InitiatorIdentifier = msisdn;
__params.PackageType= '3';
__params.BundleCategory= '3';
__params.aLAC=Util.getSplit(__input.cell_id,2);
__params.aCI=Util.getSplit(__input.cell_id,3);
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","8310","1809","Purchase VAS Package","if (empty(packageList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(packageList)) {
               type = packageList.get(tmp);
                __params.PackageGroup = type.groupCode;
                __secure = true;
                __next = '2';
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Select Package Group","<html>
<body>
Please Select Package Group :<br>
$$packageList = IC.queryPackageGroup();
$$if (empty(packageList)) {
  No package group can be selected.
$$} else {
  $$var i = 1;
  $$for(group: packageList) {
  ${i} ${group.groupName}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8311","1809","Purchase VAS Package","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(packages)) {
  __params.PackageCode = packages.get(i).elementIdentifier;
  __next = '3';
} else {
  __next = '2';
}","2","Package Name","<html>
<body>
Package Name:<br>
$$packages = IC.querySpBundle('3',__params.PackageGroup);
$$var i = 1;
$$for (package: packages ) {
  ${i} ${package.elementName}<br>
  $$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8314","1809","Purchase VAS Package","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8315","1809","Purchase VAS Package","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html><body>Purchase Package ${__params.RechargedMSISDN} ${__params.PackageCode}<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8316","1809","Purchase VAS Package","var input = __input.response;
if (!empty(input)) {
__params.RechargedMSISDN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter MSISDN Number","<html>
<body>
Enter MSISDN Number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","8362","1817","CreateOrg","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8363","1817","CreateOrg","initiator = CurReq.getIdentifierDef('Initiator');
territoryType = '1002';

if(initiator.identifierType.toCode() == '13' || initiator.identifierType.toCode() == '09')
{
    CurReq.request.getHeader().setServiceCode(null);
    CurResp = TargetService.invokeForScript(); 
    __next = 'end';
}
else
{
    gpsPosition = CurReq.getValueFromBody('CreateTopOrgRequest.GPSPosition');

    if(empty(gpsPosition))
    {
        gpsPosition = CurReq.getValueFromBody('CreateChildOrgRequest.GPSPosition');
    }
    if(empty(gpsPosition))
    {
        gpsPosition = CurReq.getValueFromBody('ChangeOrgKYCRequest.GPSPosition');
    }
    
    if(empty(gpsPosition))
    {
        CurReq.request.getHeader().setServiceCode(null);
        CurResp = TargetService.invokeForScript(); 
        __next = 'end';
    }
    else
    {
        locationList = Util.getLocationXAndY(gpsPosition);
        verifyResult = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,locationList.get(1),locationList.get(0));
        if(verifyResult == 'SYS00000')
        {
            CurReq.request.getHeader().setServiceCode(null);
            CurResp = TargetService.invokeForScript(); 
            __next = 'end';
        }
        else
        {
            __next = 'error';
        }
    }
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","3","8364","1817","CreateOrg","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","2","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","8365","1818","GEO Locking","__params.Channel = __accessChannel;
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8366","1818","GEO Locking","msisdn=CurReq.getParamValue4ReferenceDataParam('Msisdn');
fossResult=IC.queryFossData(msisdn);
var ProgramCode=fossResult.ProgramCode;
var DealerCode=fossResult.DealerCode;
CurReq.putToBodyForce('GEOLockingRequest.isNeedValify','true');
if(empty(ProgramCode))
{
 CurReq.putToBodyForce('GEOLockingRequest.isNeedValify','false');
}
else
{
  isProgramCodeValid=Util.checkPromgramCodeExist(ProgramCode);
  if(!isProgramCodeValid)
  {
   CurReq.putToBodyForce('GEOLockingRequest.isNeedValify','false');   
  }
}

CurReq.putToBodyForce('GEOLockingRequest.DealerCode',DealerCode);

var LAC = CurReq.getParamValue4ReferenceDataParam('Lac');
var CI = CurReq.getParamValue4ReferenceDataParam('Ci');
if(empty(LAC) || empty(CI))
{
	__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
        __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
 	__params.put('TransOutgoingRequest@LIST@Param.msisdn',msisdn);
	AG.sendTransOutgoing(CurReq,__params,'60');
	__next='2';	
}
else
{	
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}","1","Query Customer FOSS Info","Verify Identity Information",""<endrec>
"Pre-Validation","","3","8367","1818","GEO Locking","__next='end';","error","information","Verify failed,locking SIM.",""<endrec>
"Pre-Validation","","1","8368","1819","Indosat Reload With Location Validation for API","subscriberNumber= TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.SubscriberNumber')); 
denominationCode= CurReq.getValueFromBody('TransactionRequest.DenominationCode'); 
initiator = CurReq.getIdentifierDef('Initiator');
shortCode= initiator.shortCode;
var dupKey='';
inServerName = IC.queryINServerName(subscriberNumber,'');

dupKey = dupKey + subscriberNumber + denominationCode + shortCode;
resultCode = Util.checkDuplication(dupKey, 2);
if (resultCode == 'OK')
{
    CurReq.putToBodyForce('TransactionRequest.SubscriberNumber',subscriberNumber);
    CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SubscriberNumber',subscriberNumber);

    __params.__sessionId= __sessionId;
    CurReq.putValue4ReferenceData(""MSISDN"",subscriberNumber);   
    CurReq.putValue4ReferenceData(""Denomination Code"",denominationCode);     
       
    A_FactorX = '';       
    A_FactorY = '';

    __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
    gpsPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');

    __next = '1';
}
else
{
     __params.TransactionUMCPreValidationEvent='Pre-Validation';
     __params.TransactionUMCPreValidationError='A request is consecutively initiated multiple times in a short period of time.';
     duplicateErrorCode='UMC65002';

     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
     __errorCode=duplicateErrorCode;
     notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
     NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);
     resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode('UMC65002');
     __next = 'end';
}
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
gpsPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');

__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8369","1819","Indosat Reload With Location Validation for API","if(empty(inServerName))
{
	notificationInfoList  = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
	NC.sendPreValidationNotification(notificationInfoList ,__params.Channel,101000000000001174,__params);
	__next = 'end';
}
else
{
if(!empty(gpsPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',gpsPosition);
}
__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
 __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
 AG.sendTransOutgoing(CurReq,__params,'71');
__next = '2';
}","1","Record A Territory And Get B Territory","Record A Territory And Get B Territory",""<endrec>
"Pre-Validation","","3","8370","1819","Indosat Reload With Location Validation for API","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(B_FactorX) && !empty(B_FactorY))
{
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorX);
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorY);
}

      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
{
    __next = 'error';
}     
else
{
           __params.put('TransOutgoingRequest@LIST@Param.thirdPartyKey',inServerName);   
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','1');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','EXT');        
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumber',subscriberNumber);
           __params.put('TransOutgoingRequest@LIST@Param.originTransactionID',__sessionId);
           __params.put('TransOutgoingRequest@LIST@Param.originHostName','SALDOMOBO');
           __params.put('TransOutgoingRequest@LIST@Param.originTimeStamp',Util.getISO8601CurrencyTime()); 
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumberNAI','1');
           AG.sendTransOutgoing(CurReq,__params,'72');
         __next = '3';
}","2","Record B Territory","Record B Territory",""<endrec>
"Pre-Validation","","3","8389","1818","GEO Locking","LAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
CI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
OriginalReq.putToBodyForce('GEOLockingRequest.Lac',LAC);
OriginalReq.putToBodyForce('GEOLockingRequest.Ci',CI);
if(empty(LAC) || empty(CI))
{
   OriginalReq.putToBodyForce('GEOLockingRequest.isNeedValify','false');	 
}	
 __next='end';
CurResp = TargetService.invokeForScript();","2","Verify Identity Location","Verify Identity Location",""<endrec>
"Pre-Validation","","4","8390","1819","Indosat Reload With Location Validation for API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if(confirmedOrNot)
{ 
var inServerName = IC.queryINServerName(subscriberNumber,'');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
        CurResp = TargetService.invokeForScript(); 
        __next = 'end';
}
  else
    {
        OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyAccountStatusFailed','true');
         CurResp = TargetService.invokeForScript(); 
        __next = 'error';
    }","3","Verify Msisdn Status","Verify Msisdn Status",""<endrec>
"Pre-Validation","","6","8392","1819","Indosat Reload With Location Validation for API","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","8393","1826","Indosat Reload With Location Validation for USSD","subscriberNumber= TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.SubscriberNumber')); 
denominationCode= CurReq.getValueFromBody('TransactionRequest.DenominationCode'); 
initiator = CurReq.getIdentifierDef('Initiator');
shortCode= initiator.shortCode;
var dupKey='';

dupKey = dupKey + subscriberNumber + denominationCode + shortCode;
resultCode = Util.checkDuplication(dupKey, 2);
if (resultCode == 'OK')
{
    serviceCode = CurReq.getRequest().header.serviceCode;
    __params.__sessionId= __sessionId;
    spList = IC.queryServiceProperties(serviceCode);
    spValue = ''; 
    for(sp:spList )
    {
        if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
       {
            spValue = sp.servicePropertyValue;
            break;
       }
    }
    
    
    receipts = IC.queryPreValidationNotification(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,0,null);
    amsisdn = receipts.get(0).recipients;
    CurReq.putToBodyForce('TransactionRequest.SubscriberNumber',subscriberNumber);
    CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SubscriberNumber',subscriberNumber);
    CurReq.putValue4ReferenceData(""MSISDN"",subscriberNumber);   
    CurReq.putValue4ReferenceData(""Denomination Code"",denominationCode);     
    
    territoryType = '2';
         
    A_FactorX = '';       

    A_FactorY = '';
    
    __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
    gpsPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
    __params.aLAC= CurReq.getValueFromBody('TransactionRequest.aLAC');
    __params.aCI= CurReq.getValueFromBody('TransactionRequest.aCI');
    
    __next = '1';
}
else
{
     __params.TransactionUMCPreValidationEvent='Pre-Validation';
     __params.TransactionUMCPreValidationError='A request is consecutively initiated multiple times in a short period of time.';
     duplicateErrorCode='UMC65002';
     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
     __errorCode=duplicateErrorCode;
     notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
     NC.sendPreValidationNotification(notificationInfoList ,duplicateErrorCode,__accessChannel,__params);
     resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode('UMC65002');
     __next = 'end';
}","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8394","1826","Indosat Reload With Location Validation for USSD","inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
{
	notificationInfoList  = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
	NC.sendPreValidationNotification(notificationInfoList ,__params.Channel,101000000000001174,__params);
	__next = 'end';
}
else
{
if(empty(__params.aLAC) || empty(__params.aCI))
{
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
 __params.put('TransOutgoingRequest@LIST@Param.msisdn',amsisdn);
 __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
 AG.sendTransOutgoing(CurReq,__params,'71');
 __next = '2'; 
 }
else
{
OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);

  if(spValue == '01' || spValue == '03')
    {
	 
       var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
          if(resultMap.ResultCode == 'SYS00000')
          {
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');    
              __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        

              __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
			   __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
             AG.sendTransOutgoing(CurReq,__params,'71');
             __next = '3';
          }
         else
         {				  
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
            __next = 'error';
         }
     }
	 else
	 {
   __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
              __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
			   __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
             AG.sendTransOutgoing(CurReq,__params,'71');
	   __next = '3';
	 }
}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","3","8395","1826","Indosat Reload With Location Validation for USSD","A_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
A_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(A_FactorX) && !empty(A_FactorY))
  {
OriginalReq.putValue4ReferenceData('A#CellID',A_FactorX);
OriginalReq.putValue4ReferenceData('A#LAC',A_FactorY); 
	  if(spValue == '01' || spValue == '03')
	  {
       var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',A_FactorX,A_FactorY);
        
       if(resultMap.ResultCode == 'SYS00000')
       {
           OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');   
		     __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
               __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
               AG.sendTransOutgoing(CurReq,__params,'71');
  
             __next = '3';
               
        }
        else
        {
		 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');   
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
           __next = 'error';
        }
        
        

		}else{
		
     OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
     __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
     AG.sendTransOutgoing(CurReq,__params,'71');
        __next = '3';
		}
     }
else
   {
   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
    
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
     __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
     AG.sendTransOutgoing(CurReq,__params,'71');
        __next = '3';
   }","2","Verify Identity Territory Result","Verify Identity Territory Result",""<endrec>
"Pre-Validation","","4","8396","1826","Indosat Reload With Location Validation for USSD","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','1');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','EXT');        
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumber',subscriberNumber);
           __params.put('TransOutgoingRequest@LIST@Param.originTransactionID',__sessionId);
           __params.put('TransOutgoingRequest@LIST@Param.originHostName','SALDOMOBO');
           __params.put('TransOutgoingRequest@LIST@Param.originTimeStamp',Util.getISO8601CurrencyTime()); 
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumberNAI','1');
if(!empty(B_FactorX) && !empty(B_FactorY))
{ 
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorX);
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorY); 
        if(spValue == '02' || spValue == '03')
		{
       var resultMapB = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',B_FactorX,B_FactorY);      
        if(resultMapB.ResultCode == 'SYS00000')
        {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
       {
           __next = 'error';
        }     
else
       {


           __params.put('TransOutgoingRequest@LIST@Param.thirdPartyKey',inServerName);   
           OriginalReq.putValue4ReferenceData(""MSISDNTerritoryId"",resultMap.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'0');   
           AG.sendTransOutgoing(CurReq,__params,'72');
         __next = '4';
        }
        }
        else
       
        {
		OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'1');   
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
         __next = 'error';
        }
        
     }else
	 {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
   {
    __next = 'error';
   }     
else
       {
            __params.put('TransOutgoingRequest@LIST@Param.thirdPartyKey',inServerName);   
            OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
           AG.sendTransOutgoing(CurReq,__params,'72');
         __next = '4';
     }
	 }
    }
    else
    {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
   {
    __next = 'error';
   }     
else


   {
            __params.put('TransOutgoingRequest@LIST@Param.thirdPartyKey',inServerName);   
            OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
           AG.sendTransOutgoing(CurReq,__params,'72');
         __next = '4';
    }
    }","3","Verify Msisdn And Identity Territory Result","Verify Msisdn And Identity Territory Result",""<endrec>
"Pre-Validation","","5","8397","1826","Indosat Reload With Location Validation for USSD","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');

if(confirmedOrNot)
{ 
var inServerName = IC.queryINServerName(subscriberNumber,'');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
        CurResp = TargetService.invokeForScript(); 
        __next = 'end';
}
  else
    {
        OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyAccountStatusFailed','true');
         CurResp = TargetService.invokeForScript(); 
        __next = 'error';
    }","4","Verify Msisdn Status","Verify Msisdn Status",""<endrec>
"Pre-Validation","","6","8398","1826","Indosat Reload With Location Validation for USSD","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","8399","1827","Indosat Reload With Msisdn Status Validation via Web","subscriberNumber= TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.SubscriberNumber')); 
denominationCode= CurReq.getValueFromBody('TransactionRequest.DenominationCode');
initiator = CurReq.getIdentifierDef('Initiator');
shortCode= initiator.shortCode;
var dupKey='';

dupKey = dupKey + subscriberNumber + denominationCode + shortCode;
resultCode = Util.checkDuplication(dupKey, 2);
if (resultCode == 'OK')
{
     __next = '1';
     __params.__sessionId= __sessionId;
}
else
{
     __params.TransactionUMCPreValidationEvent='Pre-Validation';
     __params.TransactionUMCPreValidationError='A request is consecutively initiated multiple times in a short period of time.';
     duplicateErrorCode='UMC65002';
     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
     __errorCode=duplicateErrorCode;
     resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode('UMC65002');
     header.setResultMessage('The request is consecutively initiated multiple times in a short period of time. Wait a while and initiate the request again.');
     __next = 'end';
}","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8400","1827","Indosat Reload With Msisdn Status Validation via Web","inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
{
     resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode('UMC65002');
     header.setResultMessage('Can Not Matche Mno ServerName By Msisdn.');
     __next = 'end';
}
else
{
var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{

    CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
    __next = '4';
}
else
{
subscriberNumber= TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.SubscriberNumber')); 
CurReq.putToBodyForce('TransactionRequest.SubscriberNumber',subscriberNumber);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SubscriberNumber',subscriberNumber);
denominationCode= CurReq.getValueFromBody('TransactionRequest.DenominationCode'); 
OriginalReq.putValue4ReferenceData(""MSISDN"",subscriberNumber);   
OriginalReq.putValue4ReferenceData(""Denomination Code"",denominationCode);  	
__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
 __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
 AG.sendTransOutgoing(CurReq,__params,'71');
__next = '2'; 
}
}","1","Get B Territory","Get B Territory",""<endrec>
"Pre-Validation","","3","8401","1827","Indosat Reload With Msisdn Status Validation via Web","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(B_FactorX) && !empty(B_FactorY))
{
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorX);
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorY);
}

      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
{
    __next = 'error';
}     
else
{
           __params.put('TransOutgoingRequest@LIST@Param.thirdPartyKey',inServerName);   
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','1');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','EXT');        
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumber',subscriberNumber);
           __params.put('TransOutgoingRequest@LIST@Param.originTransactionID',__sessionId);
           __params.put('TransOutgoingRequest@LIST@Param.originHostName','SALDOMOBO');
           __params.put('TransOutgoingRequest@LIST@Param.originTimeStamp',Util.getISO8601CurrencyTime()); 
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumberNAI','1');
           AG.sendTransOutgoing(CurReq,__params,'72');
         __next = '3';
}","2","Record B Territory","Record B Territory",""<endrec>
"Pre-Validation","","4","8402","1827","Indosat Reload With Msisdn Status Validation via Web","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if(confirmedOrNot)
{ 
var inServerName = IC.queryINServerName(subscriberNumber,'');
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
        CurResp = TargetService.invokeForScript(); 
        __next = 'end';
}
  else
{
        OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyAccountStatusFailed','true');
         CurResp = TargetService.invokeForScript(); 
        __next = 'error';
}","3","Verify Msisdn Status","Verify Msisdn Status",""<endrec>
"Pre-Validation","","1","8405","1828","Purchase Data Package With Location Validation for USSD","rechargedMSISDN = TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN')); 
CurReq.putToBodyForce('TransactionRequest.RechargedMSISDN',rechargedMSISDN);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.RechargedMSISDN',rechargedMSISDN);
spValue = ''; 
serviceCode = CurReq.getRequest().header.serviceCode;
__params.__sessionId= __sessionId;
spList = IC.queryServiceProperties(serviceCode);
for(sp:spList )
{
if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
{
spValue = sp.servicePropertyValue;
break;
}
}

territoryType = '2';

initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');


receipts = IC.queryPreValidationNotification(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,0,null);
if(!empty(receipts))
{
	__params.amsisdn = receipts.get(0).recipients;
}
__params.bmsisdn=CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN');
__params.aLAC= CurReq.getValueFromBody('TransactionRequest.aLAC');
__params.aCI= CurReq.getValueFromBody('TransactionRequest.aCI');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PackageType','2');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BundleCategory','2');
  __next='1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8406","1828","Purchase Data Package With Location Validation for USSD","if(!empty(__params.aLAC) && !empty(__params.aCI) )
{
	OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);
	if(spValue == '01' || spValue == '03')
    {
	 var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode != 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}
	else
	{
            OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');  
		__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	}
     }
	 else
	 {
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
	  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
		 __next='3';
	 }
 	
}
else
{
	__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
	__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.amsisdn);
	__next='2';
	AG.sendTransOutgoing(CurReq,__params,'71');
}","1","Recored Operator Location","Recored Operator Location",""<endrec>
"Pre-Validation","","3","8407","1828","Purchase Data Package With Location Validation for USSD","__params.aLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
__params.aCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(__params.aLAC) && !empty(__params.aCI) )
  { 
       OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);
	if(spValue == '01' || spValue == '03')
    {
	 var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode != 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}
	else
	{
	      OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');    
		__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	}
     }
	 else
	 {

	  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	 }
     }
else
   {
   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
   }","2","Verify Operator Location","Verify Operator Location",""<endrec>
"Pre-Validation","","4","8408","1828","Purchase Data Package With Location Validation for USSD","bLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
bCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
responseCode=CurReq.getValueFromBody('TransactionEventRequest.responseCode');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Lac',bLAC);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Ci',bCI);
aLAC = __params.aLAC;
aCI = __params.aCI;
if(!empty(aLAC))
{
	OriginalReq.putValue4ReferenceData('A#CellID',aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',aLAC);
}
if(!empty(bLAC))
{
	OriginalReq.putValue4ReferenceData('B#CellID',bCI);
	OriginalReq.putValue4ReferenceData('B#LAC',bLAC);
}
if(!empty(bLAC) && !empty(bCI))
{ 
if(spValue == '02' || spValue == '03')
		{
       var resultMapB = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',bLAC,bCI);      
        if(resultMapB.ResultCode == 'SYS00000')
        {
		   OriginalReq.putValue4ReferenceData(""MSISDNTerritoryId"",resultMapB.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'0');   
            CurResp = TargetService.invokeForScript(); 
	       __next='end';
        }
        else
        {

OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		  OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'1');   
		  CurResp = TargetService.invokeForScript(); 
         __next = 'error';
        }
        
     }else
	 {
	            OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
            CurResp = TargetService.invokeForScript(); 
	       __next='end';
	 }
}

else
{
   OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
	CurResp = TargetService.invokeForScript();
	 __next='end';
}","3","Recored MSISDN Location","Recored MSISDN Location",""<endrec>
"Pre-Validation","","5","8409","1828","Purchase Data Package With Location Validation for USSD","__next='end';","error","information","Verify failed.",""<endrec>
"Pre-Validation","","1","8411","1829","Purchase Data Package for API","rechargedMSISDN = TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN')); 
CurReq.putToBodyForce('TransactionRequest.RechargedMSISDN',rechargedMSISDN);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.RechargedMSISDN',rechargedMSISDN);
__params.Channel = __accessChannel;
__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
__next = '1';
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 CurReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PackageType','2');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BundleCategory','2');","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8412","1829","Purchase Data Package for API","bmsisdn=CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN');
__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
__params.put('TransOutgoingRequest@LIST@Param.msisdn',bmsisdn);
AG.sendTransOutgoing(CurReq,__params,'71');
__next=2;","1","Get B Territory","Get B Territory",""<endrec>
"Pre-Validation","","3","8413","1829","Purchase Data Package for API","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(B_FactorX) && !empty(B_FactorY))
{
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorX);
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorY);
}

   CurResp = TargetService.invokeForScript(); 
   __next = 'end';","2","Record B Territory","Record B Territory",""<endrec>
"Pre-Validation","","5","8415","1829","Purchase Data Package for API","__next='end';","error","information","Verify failed.",""<endrec>
"Pre-Validation","","1","8416","1830","Purchase VAS Package With Location Validation for USSD","spValue = ''; 
__params.__sessionId= __sessionId;
rechargedMSISDN = TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN')); 
CurReq.putToBodyForce('TransactionRequest.RechargedMSISDN',rechargedMSISDN);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.RechargedMSISDN',rechargedMSISDN);
serviceCode = CurReq.getRequest().header.serviceCode;
spList = IC.queryServiceProperties(serviceCode);
for(sp:spList )
{
if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
{
spValue = sp.servicePropertyValue;
break;
}
}

territoryType = '2';

initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');


receipts = IC.queryPreValidationNotification(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,0,null);
if(!empty(receipts))
{
	__params.amsisdn = receipts.get(0).recipients;
}
__params.bmsisdn=CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN');
__params.aLAC= CurReq.getValueFromBody('TransactionRequest.aLAC');
__params.aCI= CurReq.getValueFromBody('TransactionRequest.aCI');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PackageType','3');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BundleCategory','3');
  __next='1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8417","1830","Purchase VAS Package With Location Validation for USSD","if(!empty(__params.aLAC) && !empty(__params.aCI) )
{
	OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);
	if(spValue == '01' || spValue == '03')
    {
	 var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode != 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}
	else
	{
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');  
		__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	}
     }
	 else
	 {
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
	  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
		 __next='3';
	 }
 	
}
else
{
	__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
	__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.amsisdn);
	__next='2';
	AG.sendTransOutgoing(CurReq,__params,'71');
}","1","Recored Operator Location","Recored Operator Location",""<endrec>
"Pre-Validation","","3","8418","1830","Purchase VAS Package With Location Validation for USSD","__params.aLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
__params.aCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(__params.aLAC) && !empty(__params.aCI) )
  { 
    OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);
	if(spValue == '01' || spValue == '03')
    {
	 var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode != 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}
	else
	{
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');  
		__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	}
     }
	 else
	 {

	  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	 }
     }
else
   {
   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
   }","2","Verify Operator Location","Verify Operator Location",""<endrec>
"Pre-Validation","","4","8419","1830","Purchase VAS Package With Location Validation for USSD","bLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
bCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
responseCode=CurReq.getValueFromBody('TransactionEventRequest.responseCode');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Lac',bLAC);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Ci',bCI);
aLAC = __params.aLAC;
aCI = __params.aCI;
if(!empty(aLAC))
{
	OriginalReq.putValue4ReferenceData('A#CellID',aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',aLAC);
}
if(!empty(bLAC))
{
	OriginalReq.putValue4ReferenceData('B#CellID',bCI);
	OriginalReq.putValue4ReferenceData('B#LAC',bLAC);
}
if(!empty(bLAC) && !empty(bCI))
{ 
if(spValue == '02' || spValue == '03')
		{
       var resultMapB = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',bLAC,bCI);      
        if(resultMapB.ResultCode == 'SYS00000')
        {
		   OriginalReq.putValue4ReferenceData(""MSISDNTerritoryId"",resultMapB.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'0');   
            CurResp = TargetService.invokeForScript(); 
	       __next='end';
        }
        else
        {

OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		  OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'1');   
		  CurResp = TargetService.invokeForScript(); 
         __next = 'error';
        }
        
     }else
	 {
	            OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
            CurResp = TargetService.invokeForScript(); 
	       __next='end';
	 }
}

else
{
   OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
	CurResp = TargetService.invokeForScript();
	 __next='end';
}","3","Recored MSISDN Location","Recored MSISDN Location",""<endrec>
"Pre-Validation","","5","8420","1830","Purchase VAS Package With Location Validation for USSD","__next='end';","error","information","Verify failed.",""<endrec>
"Pre-Validation","","1","8421","1831","Purchase VAS Package for API","__params.Channel = __accessChannel;
__params.__sessionId= __sessionId;
rechargedMSISDN = TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN')); 
CurReq.putToBodyForce('TransactionRequest.RechargedMSISDN',rechargedMSISDN);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.RechargedMSISDN',rechargedMSISDN);
initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
__next = '1';
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 CurReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PackageType','3');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BundleCategory','3');","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8422","1831","Purchase VAS Package for API","bmsisdn=CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN');
__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
__params.put('TransOutgoingRequest@LIST@Param.msisdn',bmsisdn);
AG.sendTransOutgoing(CurReq,__params,'71');
__next=2;","1","Get B Territory","Get B Territory",""<endrec>
"Pre-Validation","","3","8423","1831","Purchase VAS Package for API","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(B_FactorX) && !empty(B_FactorY))
{
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorX);
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorY);
}

   CurResp = TargetService.invokeForScript(); 
   __next = 'end';","2","Record B Territory","Record B Territory",""<endrec>
"Pre-Validation","","5","8425","1831","Purchase VAS Package for API","__next='end';","error","information","Verify failed.",""<endrec>
"TILL","","1","8426","1832","(Dompetku Allocation) Parent Organization Allocate to sub Organization","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '97'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","8427","1832","(Dompetku Allocation) Parent Organization Allocate to sub Organization","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';","1","Enter  Receiver Short Code","<html>
<body>
Enter Receiver Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8428","1832","(Dompetku Allocation) Parent Organization Allocate to sub Organization","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '3';
} else {
    __next = '2';
}","2","Enter Transfer Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8429","1832","(Dompetku Allocation) Parent Organization Allocate to sub Organization","var input = __input.response;
if(!empty(input)){
  if(Validator.isOperatorID(input)){
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '5';
  } else {
    __next = '4';
  }
} else {
  __params.InitiatorIdentifier = IC.queryDefaultOperatorId(identity.identityId);
  __secure = true;
  __next = '5';
}","4","Enter your Operator ID","<html>
<body>
Enter your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8430","1832","(Dompetku Allocation) Parent Organization Allocate to sub Organization","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter your PIN code","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","8431","1832","(Dompetku Allocation) Parent Organization Allocate to sub Organization","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8432","1832","(Dompetku Allocation) Parent Organization Allocate to sub Organization","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8433","1832","(Dompetku Allocation) Parent Organization Allocate to sub Organization","var input = __input.response;
__params.DompetkuPIN = Util.encrypt(input);
__params.needEncrypt = 'Y';
__next = '4';","3","Enter Dompetku Pin","<html>
<body>
Enter Dompetku Pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8434","1833","Sub Organization Request Dompetku Allocation by Canvasser","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '97'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","8435","1833","Sub Organization Request Dompetku Allocation by Canvasser","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';","1","Enter  Receiver Short Code","<html>
<body>
Enter Receiver Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8436","1833","Sub Organization Request Dompetku Allocation by Canvasser","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '4';
} else {
    __next = '2';
}","2","Enter Transfer Amount","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8437","1833","Sub Organization Request Dompetku Allocation by Canvasser","var input = __input.response;
if(!empty(input)){
  if(Validator.isOperatorID(input)){
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '5';
  } else {
    __next = '4';
  }
} else {
  __params.InitiatorIdentifier = IC.queryDefaultOperatorId(identity.identityId);
  __secure = true;
  __next = '5';
}","4","Enter your Operator ID","<html>
<body>
Enter your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8438","1833","Sub Organization Request Dompetku Allocation by Canvasser","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter your PIN code","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","8439","1833","Sub Organization Request Dompetku Allocation by Canvasser","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8440","1833","Sub Organization Request Dompetku Allocation by Canvasser","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8442","1834","Sub Organization Request Dompetku Allocation from it's Parent","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '97'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","8443","1834","Sub Organization Request Dompetku Allocation from it's Parent","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
__next = '2';","1","Enter  Receiver Short Code","<html>
<body>
Enter Receiver Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8445","1834","Sub Organization Request Dompetku Allocation from it's Parent","var input = __input.response;
if(!empty(input)){
  if(Validator.isOperatorID(input)){
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '5';
  } else {
    __next = '4';
  }
} else {
  __params.InitiatorIdentifier = IC.queryDefaultOperatorId(identity.identityId);
  __secure = true;
  __next = '5';
}","4","Enter your Operator ID","<html>
<body>
Enter your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8446","1834","Sub Organization Request Dompetku Allocation from it's Parent","var input = __input.response;
__params.PIN = input;
__next = '6';","5","Enter your PIN code","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","8447","1834","Sub Organization Request Dompetku Allocation from it's Parent","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Confirm ?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8448","1834","Sub Organization Request Dompetku Allocation from it's Parent","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '7';
}","6","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8450","1834","Sub Organization Request Dompetku Allocation from it's Parent","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __next = '4';
} else {
    __next = '2';
}","2","Enter Transfer Amount copy","<html>
<body>
Enter amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8451","1835","Organization operator applies a voucher for redeeming goods","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* OPERATOR_ID */
__params.ReasonTypeCode = 'Apply Redeem Goods Voucher'; 
if(TC.isSupportSecretCode(__params.ReasonTypeCode))
{
var secretCodeRule = TC.getSecretCodeRule();
__params.minLength = secretCodeRule.getMinLength();
__params.maxLength = secretCodeRule.getMaxLength();
__params.rule = secretCodeRule.getRule();
__params.info = 'Enter a secret code:';
__next = '1';
}
else
{
__next = '2';
}","begin","Initialization","",""<endrec>
"TILL","","2","8452","1835","Organization operator applies a voucher for redeeming goods","var input = __input.response;
var length = size(input);
if(length < __params.minLength  || length > __params.maxLength )
{
__params.info = 'The length of a secret code must be in the range of [' + __params.minLength + ',' + __params.maxLength + '], please enter secret code again!';
__next = '1';
}
else if(!empty(__params.rule) && input !~ __params.rule )
{
__params.info = 'The secret code must meet the format of a regular expression: ' + __params.rule + ', please enter secret code again!';
__next = '1';
}
else
{
__params.VoucherSecretCode = input;
__next = '2';
}","1","Enter secret code","<html>
<body>
${__params.info}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8453","1835","Organization operator applies a voucher for redeeming goods","var input = __input.response;
__params.InitiatorIdentifier = input;
__secure = true;
__next = '3';","2","Enter Operator ID","<html>
<body>
Enter Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8454","1835","Organization operator applies a voucher for redeeming goods","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8455","1835","Organization operator applies a voucher for redeeming goods","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","4","Confirm","<html>
<body>
Confirm to apply?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","8456","1836","Transfer Loyalty Points","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","6","8458","1836","Transfer Loyalty Points","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
  __params.ReceiverPartyIdentifier= input;
  __next = '6';
} else {
  __next = '5';
}","5","Input Phone Number","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","8459","1836","Transfer Loyalty Points","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","8460","1836","Transfer Loyalty Points","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = input;
    __secure = true;
    __next = '3';
} else {
    __next = '2';
}","2","Input Amount","<html>
<body>
Input Points Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
Currency - ${__params.SourceCurrency} <br>
</body>
</html>",""<endrec>
"CUSTOMER","","5","8461","1836","Transfer Loyalty Points","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
  __params.ReceiverPartyIdentifier= input;
  __next = '6';
} else {
  __next = '4';
}","4","Input Short Code","<html>
<body>
Input Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","8468","1836","Transfer Loyalty Points","var input = __input.response;
if (input == '1') {
  __next = '4';
} else if (input == '2') {
  __next = '5';
} else {
  __next = '3';
}","3","Select Receiver","<html>
<body>
Please select option: <br>
1 To organization<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8492","1841","Redeem Points To Balance","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
 __params.AccessDeviceIdentifierType = '01';   /* MSISDN */ 
 __params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
__params.ActionType = 'RedeemPointsToBalance';
__next = '1'","begin","Initialization","",""<endrec>
"TILL","","2","8497","1841","Redeem Points To Balance","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '2';
} else {
    __next = '1';
}","1","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8498","1841","Redeem Points To Balance","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8499","1841","Redeem Points To Balance","var input = __input.response;
if (!emtpy(input)) {
  __params.@HEAD@PIN = input;
  __next = '4';
} else {
  __next = '3';
}","3","Enter pin","<html>
<body>
Please input PIN to confirm  redeem KOIN with amount ${__params.Amount}<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8500","1841","Redeem Points To Balance","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
RedeemPointsToBalance:${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8502","1842","Query Airtime Balance","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* OPERATOR_ID */
__params.InitiatorIdentifier = msisdn;
__secure = true;

__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","8506","1842","Query Airtime Balance","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.PIN = input; 
} else {
   __next = '1';
}
if(!empty(identity.shortCode))
{
    __params.ReceiverPartyIdentifierType='04';
    __params.ReceiverPartyIdentifier=identity.shortCode;  
    
    accountTypes = IC.queryAllAccountsByShortCode(identity.shortCode);
}
else
{
    accountTypes = IC.queryAllAccountsByTillId(identity.identityId);
}
if (empty(accountTypes)) {
  __next = 'error';
} else {
  var j= size(accountTypes);
  
  for(accountType:accountTypes)
  {
        if(accountType.contains(""Airtime""))
        {
             __params.AccountTypeCode = accountType;
        }
  }
} 
__secure = true;
__next = '2';","1","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8507","1842","Query Airtime Balance","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8508","1843","Query Org KYC","__params.ServiceCode = '';
__params.ActionType='QueryOrgKYC';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* OPERATOR_ID */
__params.InitiatorIdentifier = msisdn;
__secure = true;
__params.ReceiverPartyIdentifierType='04';
__params.ReceiverPartyIdentifier=identity.shortCode;  

__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","8509","1843","Query Org KYC","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
    __params.@HEAD@PIN = input;
} else {
   __next = '1';
}
__secure = true;
__next = '2';","1","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8510","1843","Query Org KYC","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8529","1847","Reset Dompetku PIN","_params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* OPERATOR_ID */
__params.InitiatorIdentifier= msisdn;
__params.InitiatorShortCode=identity.shortCode;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","1","8535","1848","Change Dompetku PIN","_params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* OPERATOR_ID */
__params.InitiatorIdentifier= msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","8537","1848","Change Dompetku PIN","var input = __input.response;
if (!empty(input) && Validator.isDigit(input) && size(input)<65) {
__secure = true;
__params.put('TransOutgoingRequest@LIST@Param.DompetkuOldPIN',AG.cryptString(input) );
__next = '2';
} else {
    __secure = true;
    __next = '1';
}","1","Enter old PIN","<html>
<body>
Enter old PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8538","1848","Change Dompetku PIN","var input = __input.response;
if (!empty(input) && Validator.isDigit(input) && size(input)<65) {
__params.PIN = input;
__secure = true;
__next = '3';
} else {
    __secure = true;
    __next = '2';
}","2","Enter New PIN","<html>
<body>
Enter New PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8539","1848","Change Dompetku PIN","var input = __input.response;
if(__params.PIN == input && size(input)<65)
{
__params.PIN=AG.cryptString(input);
__next = '4';
}
else
{
__next = '2';
}","3","Confirm new PIN","<html>
<body>
Confirm new PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8540","1848","Change Dompetku PIN","var input = __input.response;
if (input == '1') {
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','10066');
__params.put('TransOutgoingRequest@LIST@Param.DompetkuNewPIN',__params.PIN);
__params.put('TransOutgoingRequest@LIST@Param.DompetkuMSISDN',__params.InitiatorIdentifier);
AG.sendTransOutgoingByParams(__params,'63');
  __cancelmsg = 'Your request was sent for processing. Wait for M-Pesa to reply with an SMS for confirmation.';
  __next = 'cancel';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to Change PIN?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8541","1849","Register Dompetku Customer","_params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* OPERATOR_ID */
__params.InitiatorIdentifier= msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","1","8547","1850","Query Dompetku Balance","_params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* OPERATOR_ID */
__params.InitiatorIdentifier= msisdn;
__params.InitiatorShortCode=identity.shortCode;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","8548","1850","Query Dompetku Balance","var input = __input.response;
if (!empty(input) && Validator.isDigit(input) && size(input)<65) {
__params.put('TransOutgoingRequest@LIST@Param.DompetkuMSISDN',input );
__secure = true;
__next = '2';
} else {
    __secure = true;
    __next = '1';
}","1","Enter MSISDN","<html>
<body>
Enter operator MSISDN you want to query<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8549","1850","Query Dompetku Balance","var input = __input.response;
if (!empty(input) && Validator.isDigit(input) && size(input)<65) {
__params.PIN = AG.cryptString(input);
__secure = true;
__next = '3';
} else {
    __secure = true;
    __next = '2';
}","2","Enter Dompetku  PIN","<html>
<body>
Input Dompetku PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8552","1850","Query Dompetku Balance","var input = __input.response;
if (input == '1') {
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','10066');
__params.put('TransOutgoingRequest@LIST@Param.DompetkuPIN',__params.PIN);
DompetkuMSISDNKYC = IC.getDompetkuMsisdn(__params.InitiatorShortCode);
__params.put('TransOutgoingRequest@LIST@Param.DompetkuMSISDNKYC',DompetkuMSISDNKYC);
AG.sendTransOutgoingByParams(__params,'65');
  __cancelmsg = 'Your request was sent for processing. Wait for M-Pesa to reply with an SMS for confirmation.';
  __next = 'cancel';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
To query Dompetku balance? Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","8553","1847","Reset Dompetku PIN","var input = __input.response;
if (!empty(input) && Validator.isDigit(input) && size(input)<65) {
__params.put('TransOutgoingRequest@LIST@Param.DompetkuMSISDN',input );
__secure = true;
__next = '2';
} else {
    __secure = true;
    __next = '1';
}","1","Enter MSISDN","<html>
<body>
Enter operator MSISDN you want to reset<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8554","1847","Reset Dompetku PIN","var input = __input.response;
if (!empty(input) && Validator.isDigit(input) && size(input)<65) {
__params.PIN = AG.cryptString(input);
__secure = true;
__next = '3';
} else {
    __secure = true;
    __next = '2';
}","2","Enter Dompetku  PIN","<html>
<body>
Input Dompetku PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8555","1847","Reset Dompetku PIN","var input = __input.response;
if (input == '1') {
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','10066');
__params.put('TransOutgoingRequest@LIST@Param.DompetkuPIN',__params.PIN);
DompetkuMSISDNKYC = IC.getDompetkuMsisdn(__params.InitiatorShortCode);
__params.put('TransOutgoingRequest@LIST@Param.DompetkuMSISDNKYC',DompetkuMSISDNKYC);
AG.sendTransOutgoingByParams(__params,'62');
  __cancelmsg = 'Your request was sent for processing. Wait for M-Pesa to reply with an SMS for confirmation.';
  __next = 'cancel';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
To query Dompetku balance? Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","8556","1849","Register Dompetku Customer","var input = __input.response;
if (!empty(input) && Validator.isDigit(input) && size(input)<65) {
__params.put('TransOutgoingRequest@LIST@Param.DompetkuMSISDN',input );
__secure = true;
__next = '2';
} else {
    __secure = true;
    __next = '1';
}","1","Enter MSISDN","<html>
<body>
Enter register MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8557","1849","Register Dompetku Customer","var input = __input.response;
if (!empty(input) && size(input)<65) {
__params.put('TransOutgoingRequest@LIST@Param.DompetkuName',input );
__secure = true;
__next = '3';
} else {
    __secure = true;
    __next = '2';
}","2","Enter Name","<html>
<body>
Enter Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8558","1849","Register Dompetku Customer","var input = __input.response;
if (!empty(input)  && size(input)<65) {
__params.put('TransOutgoingRequest@LIST@Param.DompetkuIDType',input );
__secure = true;
__next = '4';
} else {
    __secure = true;
    __next = '3';
}","3","Enter ID Type","<html>
<body>
Enter ID Type<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8561","1849","Register Dompetku Customer","var input = __input.response;
if (!empty(input) && size(input)<65 && Validator.isMatchRegex(input,'^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$')) {
__params.put('TransOutgoingRequest@LIST@Param.DompetkuEmail',input );
__secure = true;
__next = '7';
} else {
    __secure = true;
    __next = '6';
}","6","Enter Email","<html>
<body>
Enter Email<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8562","1849","Register Dompetku Customer","var input = __input.response;
if (!empty(input) && size(input)<65) {
__params.put('TransOutgoingRequest@LIST@Param.DompetkuMotherName',input );
__secure = true;
__next = '6';
} else {
    __secure = true;
    __next = '5';
}","5","Enter Mother Name","<html>
<body>
Enter Mother Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8563","1849","Register Dompetku Customer","var input = __input.response;
if (!empty(input) && size(input)<65) {
__params.put('TransOutgoingRequest@LIST@Param.DompetkuIDNumber',AG.cryptString(input) );
__secure = true;
__next = '5';
} else {
    __secure = true;
    __next = '4';
}","4","Enter ID Number","<html>
<body>
Enter ID Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","8564","1849","Register Dompetku Customer","var input = __input.response;
if (input == '1') {
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','10066');
__params.put('TransOutgoingRequest@LIST@Param.DompetkuPIN',__params.PIN);
AG.sendTransOutgoingByParams(__params,'64');
  __cancelmsg = 'Your request was sent for processing. Wait for M-Pesa to reply with an SMS for confirmation.';
  __next = 'cancel';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
To register for Dompetku customer ? Press 1 to confirm or 0 to cancel.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","8565","1849","Register Dompetku Customer","var input = __input.response;
if (!empty(input) && Validator.isDigit(input) && size(input)<65) {
__params.PIN = AG.cryptString(input);
__secure = true;
__next = '8';
} else {
    __secure = true;
    __next = '7';
}","7","Enter Dompetku  PIN","<html>
<body>
Input Dompetku PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8580","1852","Reset PIN of Operator","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ResetOrgOperatorPIN';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '97'; /* OPERATOR_ID */
__params.ReceiverPartyIdentifierType  = '05'; /* OPERATOR_ID */
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","8581","1852","Reset PIN of Operator","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '1';
} else {
    __params.ReceiverPartyIdentifier = input;
   __params.ReceiverPartyShortCode = IC.queryShortCodeByTillId(identity.identityId);
    __next = '2';
}","1","Enter Target Operator ID","<html>
<body>
Enter Target Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8582","1852","Reset PIN of Operator","var input = __input.response;
if(!empty(input)){
  if(Validator.isOperatorID(input)){
    __params.InitiatorIdentifier = input;
    __secure = true;
    __next = '3';
  } else {
    __next = '2';
  }
} else {
  __params.InitiatorIdentifier = IC.queryDefaultOperatorId(identity.identityId);
  __secure = true;
  __next = '3';
}","2","Enter Your Operator ID","<html>
<body>
Enter your Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8583","1852","Reset PIN of Operator","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '4';","3","Enter your PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8584","1852","Reset PIN of Operator","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '4';
}","4","Confirm","<html>
<body>
Confirm to reset PIN?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8585","1853","Create Frontliner","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'CreateOrgOperator';
__params.PrimaryOperator = '0';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyShortCode = identity.shortCode;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","8586","1853","Create Frontliner","var input = __input.response;
__params.FirstName = input;
__next = '2';","1","Input New first name","<html>
<body>
$$ if (!empty(nameFieldEmpty) && nameFieldEmpty == 'yes') {
You must input first name or last name.<br> 
$$    nameFieldEmpty = 'no';
$$} 
Input New first name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8587","1853","Create Frontliner","var input = __input.response;
__params.MiddleName = input;
__next = '3';","2","Input New middle name","<html>
<body>
Input New middle name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8588","1853","Create Frontliner","var input = __input.response;
if (empty(__params.FirstName) && empty(input)) {
    nameFieldEmpty = 'yes';
    __params.FirstName = null;
    __params.MiddleName = null;
    __next = '1';
} else {
    __params.LastName = input;
    __next = '4';
}","3","Input New Last Name","<html>
<body>
Input New last name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","8589","1853","Create Frontliner","var input = Util.toInt(__input.response);
if (input <= 0 || input > size(IDTypeItems)) {
   __next = '8';
} else {
   __params.CertificateType = IDTypeItems.get(input - 1).getValue(); 
   __next = '9';
}","8","Select ID Type","<html>
<body>
Select ID Type<br>
$$ var languageCode = identity.getLocale().getLanguage();
$$ var index = 1;
$$ for (IDTypeItem : IDTypeItems) {
$$   var displayName = IDTypeItem.getNameByLanguageCode(languageCode);
  ${index} ${displayName} <br>
$$   index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","8590","1853","Create Frontliner","var input = __input.response;
if (input == null || empty(input)) {
    __next = '9';
} else {
    __params.CertificateNumber = input;
    __next = '10';
}","9","Input ID No.","<html>
<body>
Input ID No.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8591","1853","Create Frontliner","var input = __input.response;
if (empty(input) || !Validator.isDate(input, 'ddMMyyyy')) {
    __next = '4';
} else {
    __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '5';
}","4","Input New Date Of Birth","<html>
<body>
Input New Date Of Birth(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8592","1853","Create Frontliner","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '5';
} else {
    __params.ReceiverPartyIdentifierType = '05';  /*OPERATOR_ID*/
    __params.ReceiverPartyIdentifier = input;
    __next = '6';
}","5","Input Operator ID","<html>
<body>
Input Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","8595","1853","Create Frontliner","var input = Util.toInt(__input.response);
if (input <= 0 || input > size(roleTypes)) {
    __next = '7';
} else {
    __params.RoleID = roleTypes.get(input - 1).getRoleId();

    IDTypeItems = IC.queryAllIDTypeItem();
    if (IDTypeItems == null || empty(IDTypeItems)) {
        __errormsg = 'There are not any IDType items to select.';
        __next = 'error';
    } else {
        __next = '8';
    }
}","7","Select Role Type","<html>
<body>
Select RoleType<br>
$$ var index = 1;
$$ for(roleType : roleTypes) {
${index} ${roleType.getName()}<br>
$$ index = index + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","8596","1853","Create Frontliner","var input = __input.response;
if (input == null || empty(input) || !Validator.isMatchRegex(input,'^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$')) { 
    __next = '10';
} else {
   __params.PreferredNotificationChannel = '1011';
   __params.NotificationReceivingEmail = input;
   __next = '11';
}","10","Input Email address","<html>
<body>
Input Email address<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","8597","1853","Create Frontliner","var input = __input.response;
if (input == null || empty(input)) { 
    __next = '12';
} else {
   __params.KYCInfo = IC.buildOperatorInfo(__params);
   __params.@HEAD@PIN = input;
   __next = '13';
}","12","Input PIN","<html>
<body>
Input PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","14","8598","1853","Create Frontliner","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '13';
}","13","Confirm","<html>
<body>
Confirm to create the operator?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8599","1853","Create Frontliner","var input = __input.response;
__params.RegisterMsisdn = input;
roleTypes = IC.queryOrgOperatorAllRoleType(identity.identityId);
if (null == roleTypes || empty(roleTypes)) {
     __errormsg = 'There are not any role type to select.';
     __next = 'error';
 } else { 
__next = '7';
}","6","Input MSISDN","<html>
<body>
Input MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","5","8600","1827","Indosat Reload With Msisdn Status Validation via Web","CurResp = TargetService.invokeForScript(); 
__next = 'end';","4","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","6","8601","1827","Indosat Reload With Msisdn Status Validation via Web","__next='end';","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","8602","1854","Indosat Reload With Location Validation for APP","subscriberNumber= TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.SubscriberNumber')); 
denominationCode= CurReq.getValueFromBody('TransactionRequest.DenominationCode'); 
initiator = CurReq.getIdentifierDef('Initiator');
shortCode= initiator.shortCode;
var dupKey='';

dupKey = dupKey + subscriberNumber + denominationCode + shortCode;
resultCode = Util.checkDuplication(dupKey, 2);
if (resultCode == 'OK')
{
    serviceCode = CurReq.getRequest().header.serviceCode;
    spList = IC.queryServiceProperties(serviceCode);
    spValue = ''; 
    for(sp:spList )
    {
    if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
    {
    spValue = sp.servicePropertyValue;
    break;
    }
    }
    
    receipts = IC.queryPreValidationNotification(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,0,null);
    amsisdn = receipts.get(0).recipients;
    
    CurReq.putToBodyForce('TransactionRequest.SubscriberNumber',subscriberNumber);
    CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SubscriberNumber',subscriberNumber);
    CurReq.putValue4ReferenceData(""MSISDN"",subscriberNumber);   
    CurReq.putValue4ReferenceData(""Denomination Code"",denominationCode);     
    
    territoryType = '2';
         
    A_FactorX = '';       
    A_FactorY = '';
    

    __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
    __params.__sessionId= __sessionId;
    gpsPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
    
    __next = '1';
}
else
{
     __params.TransactionUMCPreValidationEvent='Pre-Validation';
     __params.TransactionUMCPreValidationError='A request is consecutively initiated multiple times in a short period of time.';
     duplicateErrorCode='UMC65002';
     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
     __errorCode=duplicateErrorCode;
     notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
     NC.sendPreValidationNotification(notificationInfoList ,duplicateErrorCode,__accessChannel,__params);
     resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode('UMC65002');
     __next = 'end';
}","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8603","1854","Indosat Reload With Location Validation for APP","if(empty(inServerName))
{
	notificationInfoList  = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
	NC.sendPreValidationNotification(notificationInfoList ,__params.Channel,101000000000001174,__params);
	__next = 'end';
}
else
{
if(empty(gpsPosition))
{
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
 __params.put('TransOutgoingRequest@LIST@Param.msisdn',amsisdn);
 AG.sendTransOutgoing(CurReq,__params,'71');
 __next = '2'; 
 }
else
{
OriginalReq.putValue4ReferenceData('GPSPosition',gpsPosition);
locationList = Util.getLocationXAndY(gpsPosition);
  if(spValue == '01' || spValue == '03')
    {
	   A_FactorX = locationList.get(1);
       A_FactorY = locationList.get(0);
       var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1','2',A_FactorX,A_FactorY);
          if(resultMap.ResultCode == 'SYS00000')
          {
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');    
              __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
              __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
             AG.sendTransOutgoing(CurReq,__params,'71');

             __next = '3';
          }
         else
         {				  
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
            OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		CurResp = TargetService.invokeForScript(); 
            __next = 'error';
         }
     }
	 else
	 {
   __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
              __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
             AG.sendTransOutgoing(CurReq,__params,'71');
	   __next = '3';
	 }
}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","3","8604","1854","Indosat Reload With Location Validation for APP","A_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
A_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(A_FactorX) && !empty(A_FactorY))
  {
OriginalReq.putValue4ReferenceData('A#CellID',A_FactorX);
OriginalReq.putValue4ReferenceData('A#LAC',A_FactorY); 
	  if(spValue == '01' || spValue == '03')
	  {
       var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',A_FactorX,A_FactorY);
        
       if(resultMap.ResultCode == 'SYS00000')
       {
           OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');   
		     __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
               __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
               AG.sendTransOutgoing(CurReq,__params,'71');
  
             __next = '3';
               
        }
        else
        {
		 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');   
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
           __next = 'error';
        }
        
        

		}else{
		
     OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
     __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
     AG.sendTransOutgoing(CurReq,__params,'71');
        __next = '3';
		}
     }
else
   {
   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
    
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
     __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
     AG.sendTransOutgoing(CurReq,__params,'71');
        __next = '3';
   }","2","Verify Identity Territory Result","Verify Identity Territory Result",""<endrec>
"Pre-Validation","","4","8605","1854","Indosat Reload With Location Validation for APP","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','1');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','EXT');        
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumber',subscriberNumber);
           __params.put('TransOutgoingRequest@LIST@Param.originTransactionID',__sessionId);
           __params.put('TransOutgoingRequest@LIST@Param.originHostName','SALDOMOBO');
           __params.put('TransOutgoingRequest@LIST@Param.originTimeStamp',Util.getISO8601CurrencyTime()); 
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumberNAI','1');
if(!empty(B_FactorX) && !empty(B_FactorY))
{ 
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorX);
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorY); 
        if(spValue == '02' || spValue == '03')
		{
       var resultMapB = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',B_FactorX,B_FactorY);      
        if(resultMapB.ResultCode == 'SYS00000')
        {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
       {
           __next = 'error';
        }     
else
       {


           __params.put('TransOutgoingRequest@LIST@Param.thirdPartyKey',inServerName);   
           OriginalReq.putValue4ReferenceData(""MSISDNTerritoryId"",resultMap.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'0');   
           AG.sendTransOutgoing(CurReq,__params,'72');
         __next = '4';
        }
        }
        else
       
        {
		OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'1');   
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
         __next = 'error';
        }
        
     }else
	 {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
   {
    __next = 'error';
   }     
else
       {
            __params.put('TransOutgoingRequest@LIST@Param.thirdPartyKey',inServerName);   
            OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
           AG.sendTransOutgoing(CurReq,__params,'72');
         __next = '4';
     }
	 }
    }
    else
    {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
   {
    __next = 'error';
   }     
else


   {
            __params.put('TransOutgoingRequest@LIST@Param.thirdPartyKey',inServerName);   
            OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
           AG.sendTransOutgoing(CurReq,__params,'72');
         __next = '4';
    }
    }","3","Verify Msisdn And Identity Territory Result","Verify Msisdn And Identity Territory Result",""<endrec>
"Pre-Validation","","5","8606","1854","Indosat Reload With Location Validation for APP","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');

if(confirmedOrNot)
{ 
var inServerName = IC.queryINServerName(subscriberNumber,'');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
        CurResp = TargetService.invokeForScript(); 
        __next = 'end';
}
  else
    {
        OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyAccountStatusFailed','true');
         CurResp = TargetService.invokeForScript(); 
        __next = 'error';
    }","4","Verify Msisdn Status","Verify Msisdn Status",""<endrec>
"Pre-Validation","","6","8607","1854","Indosat Reload With Location Validation for APP","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","8608","1855","Purchase Data Package for Web","__params.Channel = __accessChannel;
__params.__sessionId= __sessionId;
rechargedMSISDN = TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN')); 
CurReq.putToBodyForce('TransactionRequest.RechargedMSISDN',rechargedMSISDN);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.RechargedMSISDN',rechargedMSISDN);
initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
__next = '1';
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 CurReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PackageType','2');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BundleCategory','2');","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8609","1855","Purchase Data Package for Web","bmsisdn=CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN');
__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
__params.put('TransOutgoingRequest@LIST@Param.msisdn',bmsisdn);
AG.sendTransOutgoing(CurReq,__params,'71');
__next=2;","1","Get B Territory","Get B Territory",""<endrec>
"Pre-Validation","","3","8610","1855","Purchase Data Package for Web","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(B_FactorX) && !empty(B_FactorY))
{
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorX);
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorY);
}

   CurResp = TargetService.invokeForScript(); 
   __next = 'end';","2","Record B Territory","Record B Territory",""<endrec>
"Pre-Validation","","6","8613","1855","Purchase Data Package for Web","__next='end';","error","information","Verify failed.",""<endrec>
"Pre-Validation","","1","8619","1857","Dompetku Bill Payment for Web","PaymentType = CurReq.getValueFromBody('TransactionRequest.PaymentType');   
BillShortCode = CurReq.getValueFromBody('TransactionRequest.ShortCode'); 
BillNumber= CurReq.getValueFromBody('TransactionRequest.BillNumber'); 
MSISDN = CurReq.getValueFromBody('TransactionRequest.MSISDN'); 
DMPin = CurReq.getValueFromBody('TransactionRequest.DMPin'); 
BillAmount = CurReq.getValueFromBody('TransactionRequest.BillAmount'); 

OriginalReq.putValue4ReferenceData(""PaymentType"",PaymentType);  	
OriginalReq.putValue4ReferenceData(""ShortCode"",BillShortCode);  	
OriginalReq.putValue4ReferenceData(""MSISDN"",MSISDN);   
OriginalReq.putValue4ReferenceData(""BillNumber"",BillNumber);  	
OriginalReq.putValue4ReferenceData(""BillAmount"",BillAmount);   

__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","8623","1857","Dompetku Bill Payment for Web","CurResp = TargetService.invokeForScript(); 
__next = 'end';","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","4","8624","1857","Dompetku Bill Payment for Web","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","8626","1858","Dompetku Bill Payment for USSD","PaymentType = CurReq.getValueFromBody('TransactionRequest.PaymentType');   
BillShortCode = CurReq.getValueFromBody('TransactionRequest.ShortCode'); 
BillNumber= CurReq.getValueFromBody('TransactionRequest.BillNumber'); 
MSISDN = CurReq.getValueFromBody('TransactionRequest.MSISDN'); 
DMPin = CurReq.getValueFromBody('TransactionRequest.DMPin'); 
BillAmount = CurReq.getValueFromBody('TransactionRequest.BillAmount'); 

OriginalReq.putValue4ReferenceData(""PaymentType"",PaymentType);  	
OriginalReq.putValue4ReferenceData(""ShortCode"",BillShortCode);  	
OriginalReq.putValue4ReferenceData(""MSISDN"",MSISDN);   
OriginalReq.putValue4ReferenceData(""BillNumber"",BillNumber);  	
OriginalReq.putValue4ReferenceData(""BillAmount"",BillAmount);   

__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","8628","1858","Dompetku Bill Payment for USSD","CurResp = TargetService.invokeForScript(); 
__next = 'end';","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","4","8629","1858","Dompetku Bill Payment for USSD","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","8631","1859","Dompetku Bill Payment for APP","PaymentType = CurReq.getValueFromBody('TransactionRequest.PaymentType');   
BillShortCode = CurReq.getValueFromBody('TransactionRequest.ShortCode'); 
BillNumber= CurReq.getValueFromBody('TransactionRequest.BillNumber'); 
MSISDN = CurReq.getValueFromBody('TransactionRequest.MSISDN'); 
DMPin = CurReq.getValueFromBody('TransactionRequest.DMPin'); 
BillAmount = CurReq.getValueFromBody('TransactionRequest.BillAmount'); 

OriginalReq.putValue4ReferenceData(""PaymentType"",PaymentType);  	
OriginalReq.putValue4ReferenceData(""ShortCode"",BillShortCode);  	
OriginalReq.putValue4ReferenceData(""MSISDN"",MSISDN);   
OriginalReq.putValue4ReferenceData(""BillNumber"",BillNumber);  	
OriginalReq.putValue4ReferenceData(""BillAmount"",BillAmount);   

__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","8633","1859","Dompetku Bill Payment for APP","CurResp = TargetService.invokeForScript(); 
__next = 'end';","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","4","8634","1859","Dompetku Bill Payment for APP","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","8635","1859","Dompetku Bill Payment for APP","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
	__next = '2';
}
else
{
	if(empty(GPSPosition))
	{
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{
		
		locationList = Util.getLocationXAndY(GPSPosition);
		__params.aLAC = locationList.get(0);
		__params.aCI = locationList.get(1);
		OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
		if(!empty(__params.aLAC) && !empty(__params.aCI) )
		{
			OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
			spValue = ''; 
			serviceCode = CurReq.getRequest().header.serviceCode;
			spList = IC.queryServiceProperties(serviceCode);
			for(sp:spList )
			{
				if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
				{
					spValue = sp.servicePropertyValue;
					break;
				}
			}	
			
			if(spValue == '01' || spValue == '03')
			{
				territoryType = '2';

var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1','2',__params.aLAC,__params.aCI);
				if(resultMap.ResultCode == 'SYS00000')
				{ 
				   
				 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
						  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');  
						  CurResp = TargetService.invokeForScript(); 
						  __next = 'end';
				}
				else
				{				  
						 OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
						 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
						 CurResp = TargetService.invokeForScript(); 
						 __next='error';
				}		 
			}
			else
			{
					CurResp = TargetService.invokeForScript(); 
					__next = 'end';
			} 
		}
		else
		{
			  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
			  CurResp = TargetService.invokeForScript(); 
			  __next = 'end';
		}		
	}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","2","8641","1858","Dompetku Bill Payment for USSD","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
	__next = '2';
}
else
{
	if(empty(GPSPosition))
	{
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{
		
		locationList = Util.getLocationXAndY(GPSPosition);
		__params.aLAC = locationList.get(0);
		__params.aCI = locationList.get(1);
		OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
		if(!empty(__params.aLAC) && !empty(__params.aCI) )
		{
			OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
			spValue = ''; 
			serviceCode = CurReq.getRequest().header.serviceCode;
			spList = IC.queryServiceProperties(serviceCode);
			for(sp:spList )
			{
				if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
				{
					spValue = sp.servicePropertyValue;
					break;
				}
			}	
			
			if(spValue == '01' || spValue == '03')
			{
				territoryType = '2';

				var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
				if(resultMap.ResultCode == 'SYS00000')
				{ 
				   
				 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
						  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');  
						  CurResp = TargetService.invokeForScript(); 
						  __next = 'end';
				}
				else
				{				  
						 OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
						 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
						 CurResp = TargetService.invokeForScript(); 
						 __next='error';
				}		 
			}
			else
			{
					CurResp = TargetService.invokeForScript(); 
					__next = 'end';
			} 
		}
		else
		{
			  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
			  CurResp = TargetService.invokeForScript(); 
			  __next = 'end';
		}		
	}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"TILL","","1","8642","1861","Dompetku Bill Payment","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SHORT_CODE */
__params.ReceiverPartyIdentifier = '200000000000010001'; /* SHORT_CODE */
__params.InitiatorIdentifierType = '01'; /* MSISDN  */
__params.InitiatorShortCode=identity.shortCode;
__params.InitiatorIdentifier = msisdn;
 __next = '1';","begin","set parammeters","",""<endrec>
"TILL","","2","8643","1861","Dompetku Bill Payment","if (empty(paymentTypeList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(paymentTypeList)) {
               type = paymentTypeList.get(tmp);
                __params.PaymentType = type.productName;
		        __params.productIndex = type.productIndex;
				orgList = IC.queryOrgByProduct(__params.productIndex);
				if(!empty(orgList) && size(orgList) ==1) 
				{
				    type = orgList.get(0);
                    			__params.ShortCode = type.shortCode;
                                   __params.OrgName = type.identityName;
					__secure = true;
					__next = '3';
				}else
				{
					__secure = true;
                			__next = '2';
				}
         } else {
                __next = '1';
         }
    } else {
        __next = '1';
    }
}","1","Select Payment Type","<html>
<body>
Select Payment Type:<br>
$$paymentTypeList = IC.queryProductByProperty(""BILL_ISSUER"");
$$if (empty(paymentTypeList)) {
  No payment type can be selected.
$$} else {
  $$var i = 1;
  $$for(paymentType: paymentTypeList) {
  ${i} ${paymentType.productName}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8644","1861","Dompetku Bill Payment","if (empty(orgList)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(orgList)) {
               type = orgList.get(tmp);
                __params.ShortCode = type.shortCode;
                __params.OrgName = type.identityName;
                __secure = true;
                __next = '3';
         } else {
                __next = '2';
         }
    } else {
        __next = '2';
    }
}","2","Select Company","<html>
<body>
Select Company<br>
$$if (empty(orgList)) {
  No company can be selected.
$$} else {
  $$var i = 1;
  $$for(org: orgList) {
  ${i} ${org.identityName}<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8646","1861","Dompetku Bill Payment","var input = __input.response;
if(empty(input))
{
__next = '6';
}
else
{
	__params.PIN = input;
	kycMap = IC.queryOrganizationKYC(__params.ShortCode,'Bill Issuer Info','Function,Reference');
	if(!empty(kycMap) && !empty(kycMap.get('Function')) && !empty(kycMap.get('Reference')))
	{
		__params.put('TransOutgoingRequest@LIST@Param.Function',kycMap.get('Function'));
		__params.put('TransOutgoingRequest@LIST@Param.Reference',kycMap.get('Reference'));
		__params.put('TransOutgoingRequest@LIST@Param.PaymentType',__params.PaymentType);
		__params.put('TransOutgoingRequest@LIST@Param.BillIssuerName',__params.OrgName);
		__params.put('TransOutgoingRequest@LIST@Param.BillNumber',__params.BillNumber);
		__params.put('TransOutgoingRequest@LIST@Param.MSISDN',__params.MSISDN);
		__params.put('TransOutgoingRequest@LIST@Param.DMPin',__params.DMPin);
		__params.put('TransOutgoingRequest@LIST@Param.needEncrypt',__params.needEncrypt);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
              DompetkuMSISDNKYC = IC.getDompetkuMsisdn(__params.InitiatorShortCode);
              __params.put('TransOutgoingRequest@LIST@Param.Initiator',DompetkuMSISDNKYC);
		response=AG.sendGOAOutgoingByParams(__params,'70',__sessionId);
		if(!empty(response))
		{
		  billAmount = response.msgBody.GOAQueryDompetkuBillResponse.BillAmount;

                transid = response.msgBody.GOAQueryDompetkuBillResponse.Transid;
		  if(!empty(billAmount))
		  {
			__params.BillAmount = billAmount;
                     __params.Transid = transid;
			__next = '7';
		  }
		  else
		  {
			 __next = '9';
		  }
		}
		else
		{
		  __next = '9';
		}
	}
	else
	{
	  __next = '8';
	}
}","6","Enter your PIN code","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","8647","1861","Dompetku Bill Payment","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
Please confirm pay bill to biller short code ${__params.ShortCode} with amount ${__params.BillAmount} from Dompetku wallet<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8649","1861","Dompetku Bill Payment","var input = __input.response;
if(empty(input))
{
  __next = '5';
}
else
{
__params.DMPin = Util.encrypt(input);
__params.needEncrypt = 'Y';
__next = '6';
}","5","Enter Dompetku Pin","<html>
<body>
Enter Dompetku Pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8650","1861","Dompetku Bill Payment","var input = __input.response;
if(empty(input))
{
  __next = '3';
}
else
{
__params.BillNumber = input;
__next = '4';
}","3","Input Bill No","<html>
<body>
Input Bill No<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8651","1861","Dompetku Bill Payment","var input = __input.response;
if(empty(input))
{
  __next = '4';
}
else
{
__params.MSISDN = input;
__next = '5';
}","4","Input MSISDN","<html>
<body>
Input MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","8652","1862","Dompetku Bill Payment for API","PaymentType = CurReq.getValueFromBody('TransactionRequest.PaymentType');   
BillShortCode = CurReq.getValueFromBody('TransactionRequest.ShortCode'); 
BillNumber= CurReq.getValueFromBody('TransactionRequest.BillNumber'); 
MSISDN = CurReq.getValueFromBody('TransactionRequest.MSISDN'); 
DMPin = CurReq.getValueFromBody('TransactionRequest.DMPin'); 
BillAmount = CurReq.getValueFromBody('TransactionRequest.BillAmount'); 

OriginalReq.putValue4ReferenceData(""PaymentType"",PaymentType);  	
OriginalReq.putValue4ReferenceData(""ShortCode"",BillShortCode);  	
OriginalReq.putValue4ReferenceData(""MSISDN"",MSISDN);   
OriginalReq.putValue4ReferenceData(""BillNumber"",BillNumber);  	
OriginalReq.putValue4ReferenceData(""BillAmount"",BillAmount);   

__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","8653","1862","Dompetku Bill Payment for API","CurResp = TargetService.invokeForScript(); 
__next = 'end';","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","4","8654","1862","Dompetku Bill Payment for API","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","8655","1862","Dompetku Bill Payment for API","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
	__next = '2';
}
else
{
	if(empty(GPSPosition))
	{
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{
		
		locationList = Util.getLocationXAndY(GPSPosition);
		__params.aLAC = locationList.get(0);
		__params.aCI = locationList.get(1);
		OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
			OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
			  CurResp = TargetService.invokeForScript(); 
			  __next = 'end';
	}
}","1","Record Identity Territory","Record Identity Territory",""<endrec>
"TILL","","1","8656","1863","Redeem Points To Goods","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
 __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
__params.ActionType = 'RedeemPointsToGoods';
__next = '1';","begin","set parammeters","",""<endrec>
"TILL","","8","8657","1863","Redeem Points To Goods","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>Redeem goods ${__params.GoodsTypeId}, quantity is ${__params.Quantity}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8658","1863","Redeem Points To Goods","var input = __input.response;
if(!empty(input))
{
 __params.@HEAD@PIN = input;
}
else
{
__next = '6';
}
__next = '7';","6","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8659","1863","Redeem Points To Goods","var input = __input.response;
if (Validator.isDigit(input, 1, 99)) {
    __params.Quantity = input;
    __next = '4';
} else {
    __next = '3';
}","3","Input Quantity","<html>
<body>
Input Quantity:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8660","1863","Redeem Points To Goods","var input = __input.response;
__params.GoodsTypeId = input;
__next = '3';","2","Input Goods ID","<html>
<body>
Input Goods ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","8661","1863","Redeem Points To Goods","var input = __input.response;
if (input == '1') {
  __params.GoodsCatalog = 'Books';
  __next = '2';
} else if (input == '2') {
  __params.GoodsCatalog = 'Electronic product';
  __next = '2';
} else {
   __next = '1';
}","1","Select Goods Cataolog","<html>
<body>
Please select goods cataolog: <br>
1 Books<br>
2 Electronic product
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8662","1864","Change Frontliner Status","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'ChangeOrgOperatorStatus';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01';
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","8663","1864","Change Frontliner Status","var input = __input.response;
if (empty(input) || !Validator.isOperatorID(input)) {
    __next = '1';
} else {
    __params.ReceiverPartyIdentifierType = '05'; /* OPERATOR_ID */
    __params.ReceiverPartyIdentifier = input;

    IdentityStatusTypes = IC.queryOrgOperatorChangeStatus('01',msisdn,'05',input,identity.shortCode);
    if (IdentityStatusTypes == null || empty(IdentityStatusTypes)) {
        __errormsg = 'The Operator ID does not exist.';
        __next = 'error';
    } else {
        __next = '2';
    }
}","1","Input Operator ID","<html>
<body>
Input Operator ID<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8664","1864","Change Frontliner Status","var input = Util.toInt(__input.response);
if (input <= 0 || input > size(IdentityStatusTypes)) {
   __next = '2';
} else {
   __params.Status = IdentityStatusTypes.get(input - 1).toCode(); 
   __next = '3';
}","2","Select Status","<html>
<body>
Select Status<br>
$$ var index = 1;
$$ for(IdentityStatusType: IdentityStatusTypes) {
${index} ${IdentityStatusType.toName()}<br>
$$ index = index + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8666","1864","Change Frontliner Status","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '4';","3","Input PIN","<html>
<body>
Input PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8667","1864","Change Frontliner Status","var input = __input.response;
if (input == '1') {
   __next = 'end';
} else if (input == '0'){
   __next = 'cancel'; 
} else {
   __next = '4';
}","4","Confirm","<html>
<body>
Confirm to close the operator?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","8668","1865","Purchase VAS Package for Web","__params.Channel = __accessChannel;
__params.__sessionId= __sessionId;
rechargedMSISDN = TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN')); 
CurReq.putToBodyForce('TransactionRequest.RechargedMSISDN',rechargedMSISDN);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.RechargedMSISDN',rechargedMSISDN);
initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
__next = '1';
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 CurReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PackageType','3');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BundleCategory','3');","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8669","1865","Purchase VAS Package for Web","bmsisdn=CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN');
__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
__params.put('TransOutgoingRequest@LIST@Param.msisdn',bmsisdn);
AG.sendTransOutgoing(CurReq,__params,'71');
__next=2;","1","Get B Territory","Get B Territory",""<endrec>
"Pre-Validation","","3","8670","1865","Purchase VAS Package for Web","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(B_FactorX) && !empty(B_FactorY))
{
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorX);
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorY);
}

   CurResp = TargetService.invokeForScript(); 
   __next = 'end';","2","Record B Territory","Record B Territory",""<endrec>
"Pre-Validation","","6","8671","1865","Purchase VAS Package for Web","__next='end';","error","information","Verify failed.",""<endrec>
"Pre-Validation","","1","8672","1866","Purchase Data Package With Location Validation for APP","rechargedMSISDN = TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN')); 
CurReq.putToBodyForce('TransactionRequest.RechargedMSISDN',rechargedMSISDN);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.RechargedMSISDN',rechargedMSISDN);
spValue = ''; 
serviceCode = CurReq.getRequest().header.serviceCode;
__params.__sessionId= __sessionId;
spList = IC.queryServiceProperties(serviceCode);
for(sp:spList )
{
if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
{
spValue = sp.servicePropertyValue;
break;
}
}

territoryType = '2';

initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');


receipts = IC.queryPreValidationNotification(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,0,null);
if(!empty(receipts))
{
	__params.amsisdn = receipts.get(0).recipients;
}
__params.bmsisdn=CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PackageType','2');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BundleCategory','2');
  __next='1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8673","1866","Purchase Data Package With Location Validation for APP","locationList = Util.getLocationXAndY(GPSPosition);
A_FactorX = locationList.get(0);
A_FactorY = locationList.get(1);
if(!empty(A_FactorX) && !empty(A_FactorY) )
{
	if(spValue == '01' || spValue == '03')
    {
	 var resultMap =  IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1','2',A_FactorX,A_FactorY);
	if(resultMap.ResultCode != 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}
	else
	{
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');  
		__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	}
     }
	 else
	 {
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
	  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
		 __next='3';
	 }
 	
}
else
{
	__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
	__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.amsisdn);
	__next='2';
	AG.sendTransOutgoing(CurReq,__params,'71');
}","1","Recored Operator Location","Recored Operator Location",""<endrec>
"Pre-Validation","","3","8674","1866","Purchase Data Package With Location Validation for APP","__params.aLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
__params.aCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(__params.aLAC) && !empty(__params.aCI) )
  { 
    OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
	if(spValue == '01' || spValue == '03')
    {
	 var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode != 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}
	else
	{
	   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0'); 
          OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);     
		__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	}
     }
	 else
	 {

	  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	 }
     }
else
   {
   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
   }","2","Verify Operator Location","Verify Operator Location",""<endrec>
"Pre-Validation","","4","8675","1866","Purchase Data Package With Location Validation for APP","bLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
bCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
responseCode=CurReq.getValueFromBody('TransactionEventRequest.responseCode');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Lac',bLAC);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Ci',bCI);
aLAC = __params.aLAC;
aCI = __params.aCI;
if(!empty(aLAC))
{
	OriginalReq.putValue4ReferenceData('A#CellID',aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',aLAC);
}
if(!empty(bLAC))
{
	OriginalReq.putValue4ReferenceData('B#CellID',bCI);
	OriginalReq.putValue4ReferenceData('B#LAC',bLAC);
}
if(!empty(bLAC) && !empty(bCI))
{ 
if(spValue == '02' || spValue == '03')
		{
       var resultMapB = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',bLAC,bCI);      
        if(resultMapB.ResultCode == 'SYS00000')
        {
		   OriginalReq.putValue4ReferenceData(""MSISDNTerritoryId"",resultMapB.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'0');   
            CurResp = TargetService.invokeForScript(); 
	       __next='end';
        }
        else
        {

             OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		  OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'1');   
		  CurResp = TargetService.invokeForScript(); 
         __next = 'error';
        }
        
     }else
	 {
	            OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
            CurResp = TargetService.invokeForScript(); 
	       __next='end';
	 }
}

else
{
   OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
	CurResp = TargetService.invokeForScript();
	 __next='end';
}","3","Recored MSISDN Location","Recored MSISDN Location",""<endrec>
"Pre-Validation","","5","8676","1866","Purchase Data Package With Location Validation for APP","__next='end';","error","information","Verify failed.",""<endrec>
"Pre-Validation","","1","8677","1867","Purchase VAS Package With Location Validation for APP","spValue = ''; 
__params.__sessionId= __sessionId;
rechargedMSISDN = TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN')); 
CurReq.putToBodyForce('TransactionRequest.RechargedMSISDN',rechargedMSISDN);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.RechargedMSISDN',rechargedMSISDN);
serviceCode = CurReq.getRequest().header.serviceCode;
spList = IC.queryServiceProperties(serviceCode);
for(sp:spList )
{
if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
{
spValue = sp.servicePropertyValue;
break;
}
}

territoryType = '2';

initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');


receipts = IC.queryPreValidationNotification(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,0,null);
if(!empty(receipts))
{
	__params.amsisdn = receipts.get(0).recipients;
}
__params.bmsisdn=CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 CurReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PackageType','3');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BundleCategory','3');
  __next='1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8678","1867","Purchase VAS Package With Location Validation for APP","locationList = Util.getLocationXAndY(GPSPosition);
A_FactorX = locationList.get(0);
A_FactorY = locationList.get(1);
if(!empty(A_FactorX ) && !empty(A_FactorY) )
{
	
	if(spValue == '01' || spValue == '03')
    {
	 var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1','2',A_FactorX,A_FactorY);
	if(resultMap.ResultCode != 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}
	else
	{
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');  
		__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	}
     }
	 else
	 {
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
	  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
		 __next='3';
	 }
 	
}
else
{
	__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
	__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.amsisdn);
	__next='2';
	AG.sendTransOutgoing(CurReq,__params,'71');
}","1","Recored Operator Location","Recored Operator Location",""<endrec>
"Pre-Validation","","3","8679","1867","Purchase VAS Package With Location Validation for APP","__params.aLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
__params.aCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(__params.aLAC) && !empty(__params.aCI) )
  { 
    OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
	if(spValue == '01' || spValue == '03')
    {
	 var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode != 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}
	else
	{
	      OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');  
		__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	}
     }
	 else
	 {

	  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	 }
     }
else
   {
   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
   }","2","Verify Operator Location","Verify Operator Location",""<endrec>
"Pre-Validation","","4","8680","1867","Purchase VAS Package With Location Validation for APP","bLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
bCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
responseCode=CurReq.getValueFromBody('TransactionEventRequest.responseCode');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Lac',bLAC);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Ci',bCI);
aLAC = __params.aLAC;
aCI = __params.aCI;
if(!empty(aLAC))
{
	OriginalReq.putValue4ReferenceData('A#CellID',aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',aLAC);
}
if(!empty(bLAC))
{
	OriginalReq.putValue4ReferenceData('B#CellID',bCI);
	OriginalReq.putValue4ReferenceData('B#LAC',bLAC);
}
if(!empty(bLAC) && !empty(bCI))
{ 
if(spValue == '02' || spValue == '03')
		{
       var resultMapB = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',bLAC,bCI);      
        if(resultMapB.ResultCode == 'SYS00000')
        {
		   OriginalReq.putValue4ReferenceData(""MSISDNTerritoryId"",resultMapB.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'0');   
            CurResp = TargetService.invokeForScript(); 
	       __next='end';
        }
        else
        {

OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		  OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'1');   
		  CurResp = TargetService.invokeForScript(); 
         __next = 'error';
        }
        
     }else
	 {
	            OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
            CurResp = TargetService.invokeForScript(); 
	       __next='end';
	 }
}

else
{
   OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
	CurResp = TargetService.invokeForScript();
	 __next='end';
}","3","Recored MSISDN Location","Recored MSISDN Location",""<endrec>
"Pre-Validation","","5","8681","1867","Purchase VAS Package With Location Validation for APP","__next='end';","error","information","Verify failed.",""<endrec>
"Pre-Validation","","2","8682","1857","Dompetku Bill Payment for Web","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
	__next = '2';
}
else
{
	if(empty(GPSPosition))
	{
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{
		
		locationList = Util.getLocationXAndY(GPSPosition);
		__params.aLAC = locationList.get(0);
		__params.aCI = locationList.get(1);
		OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
		if(!empty(__params.aLAC) && !empty(__params.aCI) )
		{
			OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
			spValue = ''; 
			serviceCode = CurReq.getRequest().header.serviceCode;
			spList = IC.queryServiceProperties(serviceCode);
			for(sp:spList )
			{
				if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
				{
					spValue = sp.servicePropertyValue;
					break;
				}
			}	
			
			if(spValue == '01' || spValue == '03')
			{
				territoryType = '2';

				var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
				if(resultMap.ResultCode == 'SYS00000')
				{ 
				   
				 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
						  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');  
						  CurResp = TargetService.invokeForScript(); 
						  __next = 'end';
				}
				else
				{				  
						 OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
						 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
						 CurResp = TargetService.invokeForScript(); 
						 __next='error';
				}		 
			}
			else
			{
					CurResp = TargetService.invokeForScript(); 
					__next = 'end';
			} 
		}
		else
		{
			  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
			  CurResp = TargetService.invokeForScript(); 
			  __next = 'end';
		}		
	}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"TILL","","12","8683","1853","Create Frontliner","var input = __input.response;
 __params.PreferredNotificationChannel = '1001';
__params.NotificationReceivingMSISDN = input;
__next = '12';","11","Input MSISDN to receive notification","<html>
<body>
Input MSISDN to receive notification<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8684","1863","Redeem Points To Goods","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;
  __next = '6';
} else {
  __next = '5';
}","5","Input Operator ID","<html>
<body>
Input Operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8685","1863","Redeem Points To Goods","var input = __input.response;
if(!empty(input))
{
    __params.ReceiverPartyIdentifier=input;  
}
else
{
    __next = '4';
}
__next = '5';","4","Input Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","8714","1836","Transfer Loyalty Points","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '6';
}
else 
{
    __params.remark= input;
    __next = '7';
}","6","Input Remark","<html>
<body>
Input Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","8715","1836","Transfer Loyalty Points","var input = __input.response;
__params.PIN = input;
__next = '8';","7","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8716","1870","Transfer Loyalty Points","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'TransferIdentityPoints';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN  */
__params.InitiatorShortCode=identity.shortCode;
__params.InitiatorIdentifier = msisdn;
__params.PrimaryPartyIdentifierType = '04'; /* SHORT_CODE */
__params.PrimaryPartyIdentifier = identity.shortCode;
__next = '1b';","begin","Initialization","",""<endrec>
"TILL","","6","8718","1870","Transfer Loyalty Points","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
  __params.ReceiverPartyIdentifier= input;
  __next = '5';
} else {
  __next = '4';
}","4","Input Phone Number","<html>
<body>
Input Phone Number:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","8719","1870","Transfer Loyalty Points","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '7';
}","7","Confirm","<html>
<body>
ATM Provider - ${providerName} <br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8720","1870","Transfer Loyalty Points","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = input;
    __secure = true;
    __next = '1a';
} else {
    __next = '1';
}","1","Input Amount","<html>
<body>
Input Points Amount:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8721","1870","Transfer Loyalty Points","var input = __input.response;
if (!empty(input)) {
  __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
  __params.ReceiverPartyIdentifier= input;
  __next = '5';
} else {
  __next = '3';
}","3","Input Short Code","<html>
<body>
Input Short Code:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","8722","1870","Transfer Loyalty Points","var input = __input.response;
if (input == '2') {
  __next = '3';
} else if (input == '1') {
  __next = '4';
} else {
  __next = '2';
}","2","Select Receiver","<html>
<body>
Please select option: <br>
1 To customer<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8723","1870","Transfer Loyalty Points","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '5';
}
else 
{
    __params.remark= input;
    __next = '6';
}","5","Input Remark","<html>
<body>
Input Remark:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","8724","1870","Transfer Loyalty Points","var input = __input.response;
__params.@HEAD@PIN = input;
__next = '7';","6","Input PIN","<html>
<body>
Input PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","8726","1861","Dompetku Bill Payment","__next = 'cancel';","8","Check Bill Issuer KYC Null","<html>
<body>
The bill issuer kyc 'Function' or 'Reference' is null<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","8727","1861","Dompetku Bill Payment","__next = 'cancel';","9","Query Dompetku Bill Number Error","<html>
<body>
Query Dompetku bill number error<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","8878","1892","Query Customer Points","__params.ActionType='QueryCustomerPoints';
__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","8880","1892","Query Customer Points","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
 __params.@HEAD@PIN = input;
    __next = '2';
} else {
    __secure = true;
    __next = '1';
}","1","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","8881","1892","Query Customer Points","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8883","1893","Query Organization Points","__params.ActionType='QueryOrganizationPoints';
__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01';
__params.ReceiverPartyIdentifier =msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN  */
__params.InitiatorShortCode=identity.shortCode;
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","8887","1893","Query Organization Points","var input = __input.response;
 __params.@HEAD@PIN = input;
__next = '2';","1","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8888","1893","Query Organization Points","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","8927","1902","Pay Bill With Prevalidation","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
 __params.AccessDeviceIdentifierType = '01';   /* MSISDN */ 
 __params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '05'; /* Operator ID*/
 __params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
 __params.RequesterIdentifierType = '01';
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","8928","1902","Pay Bill With Prevalidation","var input = __input.response;
if (!empty(input)) {
  __params.RequesterIdentifier = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter customer phone no","<html>
<body>
Enter customer phone no <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","8929","1902","Pay Bill With Prevalidation","var input = __input.response;
__params.FirstName= input;
__next = '3';","2","Enter First Name","<html>
<body>
Enter First Name<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","8930","1902","Pay Bill With Prevalidation","__params.ReceiverPartyIdentifier=__input.response; 
if (!empty(__params.ReceiverPartyIdentifier)) {
      __next = '4';
   } 
 else 
   {
      __next = '3';
   }","3","Enter Short Code","<html>
<body>
Enter Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","8931","1902","Pay Bill With Prevalidation","var input = __input.response;
__params.BillReferenceNumber = input;
__next = '5';","4","Enter Business No","<html>
<body>
Enter Business No.<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","8932","1902","Pay Bill With Prevalidation","var input = __input.response;
if (Validator.isAmount(input)) {
    __params.Amount = TC.convertAmountFormat(input);
    __secure = true;
    __next = '6';
} else {
    __next = '5';
}","5","Enter Amount","<html>
<body>
Enter Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","8","8933","1902","Pay Bill With Prevalidation","var input = __input.response;
if (!empty(input)) {
  __params.InitiatorIdentifier = input;

  recipientList= IC.queryPreValidationNotificationByOrg(__params.InitiatorIdentifier,'05',0,__params.AccessDeviceIdentifier,'01');

  __next = '7';
} else {
  __next = '6';
}","6","Enter Operator ID","<html>
<body>
Enter operator ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","8934","1902","Pay Bill With Prevalidation","var input = __input.response;
if (!emtpy(input)) {
  __params.PIN = input;
  __next = '8';
} else {
  __next = '7';
}","7","Enter pin","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","13","8935","1902","Pay Bill With Prevalidation","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '11';
}","11","Confirm","<html>
<body>
Pay Bill - ${__params.BillReferenceNumber} ${__params.Amount}<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","10","8936","1902","Pay Bill With Prevalidation","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '8';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '9';
}","8","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","8938","1902","Pay Bill With Prevalidation","var input = __input.response;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
if (input == '1')
{
budgetMap=TC.calculatePreValidationFee(null,__params,__sessionId);
if(budgetMap.isError == '10')
{
__errormsg = 'Pre-Validation is failed,Please check notification.';
__params.TransactionUMCPreValidationEvent='Failed';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
__next = 'error';
}
else
{
var promptText = '';
feeList = budgetMap.fee;
if(!empty(feeList)){
i = 1;
sizeLen = size(feeList);
for(fee:feeList)
{
promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
if(i < sizeLen)
{
promptText = promptText + '<br>';
}
i = i+1 
}
}
taxList = budgetMap.tax;
if(!empty(taxList)){
i = 1;
sizeLen = size(taxList);
for(tax:taxList)
{
if(i ==1 &&  promptText != '')
{
promptText = promptText + '<br>';
}
promptText = promptText

+ fee.publicName + ':The amount of tax is '+tax.amount;
if(i <sizeLen)
{
promptText = promptText + '<br>';
} 
i = i+1;
}
}
if( promptText == '')
{promptText =' No charge.';} 
else
{promptText =promptText +'.';
}
var org=IC.queryIdentityName('05',__params.InitiatorIdentifier,'04',__params.ReceiverPartyIdentifier,'01',__params.AccessDeviceIdentifier);
var cust=IC.queryIdentityName('05',__params.InitiatorIdentifier,'01',__params.RequesterIdentifier,'01',__params.AccessDeviceIdentifier);
var custTips = cust.subType=='1002'?'Customer ' + cust.firstName + ' ' + cust.middleName + ' ' + cust.lastName:'NON M-PESA CUSTOMER';
var tips = 'You will Pay Bill of '+IC.formatAmount('', __params.Amount) + ' to ' + org.firstName +' with '+ __params.BillReferenceNumber+ ' on behalf of ' + custTips + ', Phone number '+__params.RequesterIdentifier + '. ';
promptText = promptText + '<br>' + tips;
__params.preValidationResult = promptText;
__next = '10';
}
}
else if (input == '2') {
  __next = '11';
  }
}
else {
 __next = '9';
}","9","Please Select","<html>
<body>Please Select:<br>
1 Pre-Validation<br>
2 Submit Directly<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","12","8939","1902","Pay Bill With Prevalidation","var input = __input.response;
preValidationNotificationInfo = IC.queryPreValidationNotification('',msisdn,'01','',0,'');
recipientList = preValidationNotificationInfo.recipientList;
if (Validator.isMatchRegex(input,'^([1-2])$'))
{
__params.OperationType= input ;
if (input == '1')
{
__params.EventType=""PRE_VALIDATION"";
__params.Reason=""Continue Pre-Validation Transaction"";
TC.savingPreValidationEventLog(__params);
__next = '11';
}
else if (input == '2') {
IC.cnsCancelationProcess('05',__params.InitiatorIdentifier);
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation Result is Rejected.';
__params.Reason=""Rejected"";
__errormsg = 'You have chosed to reject transation,Please check notification.';
TC.savingPreValidationEventLog(__params);
__params.TransactionUMCPreValidationEvent='Rejected';
__params.TransactionUMCPreValidationError='Choosing Reject';
__params.put('Common.Result.ErrorCode','TS28009');
__next = 'error';
}
}
else {
 __next = '10';
}","10","Pre-Validation Result","<html>
<body>
Pre-Validation Information:<br>
${__params.preValidationResult}<br>
Press 1 to continue or 2 to reject :<br>
1 Continue <br>
2 Reject <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","14","8940","1902","Pay Bill With Prevalidation","if(__errorCode == 'UMC64000')
{
__params.EventType=""PRE_VALIDATION"";
__params.errDesc='Pre-Validation confirmation is Timeout.';
__params.Reason=""Timeout"";
TC.savingPreValidationEventLog(__params);
__params.TransactionPreValidationEvent='Timeout';
__params.TransactionPreValidationError='Time out';
__params.put('Common.Result.ErrorCode','UMC64000');
if (empty(recipientList)) {
__errormsg = 'The recipient is null and send notification failed.';
} else {
NC.sendPreValidationNotification(recipientList,__params.Channel,208000000000053238,__params);
}
}","error","Execute while errors occur copy","error occurs.",""<endrec>
"Pre-Validation","","1","8941","1903","OTC Pay Bill With Prevalidation for WEB","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","8942","1903","OTC Pay Bill With Prevalidation for WEB","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{

CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);

var tips = 'You will Pay Bill of ';

var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
tips = tips + IC.formatAmount(currency, amount);

tips = tips + ' to ';

var org = IC.queryIdentityName(CurReq.getIdentifierDef('ReceiverParty'));
tips = tips + org.firstName;

tips = tips + ' with ';

var billReferenceNumber = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BillReferenceNumber');
tips = tips + (empty(billReferenceNumber)?'[]':billReferenceNumber);

tips = tips + ' on behalf of ';

var requester = CurReq.getIdentifierDef('Requester');
var cust = IC.queryIdentityName(requester);
if(cust.subType == '1002')
{
tips = tips + 'Customer ' + (empty(cust.firstName)?'[]':cust.firstName) + ' ' + (empty(cust.middleName)?'[]':cust.middleName) + ' ' + (empty(cust.lastName)?'[]':cust.lastName);
}
else
{
tips = tips + 'NON M-PESA CUSTOMER';
}


tips = tips + ', Phone number ' + (empty(cust.basicIdentifier)?requester.identifier:cust.basicIdentifier) + '. Respond with';

CurResp.putToBody('CalculateFeeResponse.tips', tips);

__next = '2';
}
else
{
CurResp = TargetService.invokeForScript(); 
__next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","3","8943","1903","OTC Pay Bill With Prevalidation for WEB","CurResp = TargetService.invokeForScript(); 
__next='end';","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","8947","1905","OTC Pay Bill With Prevalidation for STK","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","8948","1905","OTC Pay Bill With Prevalidation for STK","__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
__params.EventType='PRE_VALIDATION';
if(__errorCode == 'UMC64000')
{
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
__params.errDesc='Pre-Validation confirmation is Timeout.';
TC.savingPreValidationEventLog(__params);
}
else
{
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","2","8949","1905","OTC Pay Bill With Prevalidation for STK","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__params.Channel = __accessChannel;
var needDisplayFeeConfirmation=CurReq.hasValueInBody('TransactionRequest.needDisplayFeeConfirmation', 'true');
if (needDisplayFeeConfirmation)
{
TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
feeInfo=budgetMap.FeeInfo;
if(budgetMap.isError == '1')
{
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
 __next = 'end';
}
else
{
 feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
   var promptText = '';
  for(fee:feeList)
  {   
   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
 
   if(i < sizeLen)
   {
    promptText = promptText + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;

   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  promptText != '')
   {

    promptText = promptText + ',';
   }
 
    promptText = promptText + fee.publicName + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    promptText = promptText + ',';
   } 
   i = i+1;
  }
  if( promptText == '')
   {
     promptText =' No charge.';
   } 
 else
  {
    promptText =promptText +'.';
  } 

var tips = 'You will Pay Bill of ';

var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
tips = tips + IC.formatAmount(currency, amount);

tips = tips + ' to ';

var org = IC.queryIdentityName(CurReq.getIdentifierDef('ReceiverParty'));
tips = tips + org.firstName;

tips = tips + ' with ';

var billReferenceNumber = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BillReferenceNumber');
tips = tips + (empty(billReferenceNumber)?'[]':billReferenceNumber);

tips = tips + ' on behalf of ';

var requester = CurReq.getIdentifierDef('Requester');
var cust = IC.queryIdentityName(requester);
if(cust.subType == '1002')
{

tips = tips + 'Customer ' + (empty(cust.firstName)?'[]':cust.firstName) + ' ' + (empty(cust.middleName)?'[]':cust.middleName) + ' ' + (empty(cust.lastName)?'[]':cust.lastName);
}
else
{
tips = tips + 'NON M-PESA CUSTOMER';
}

tips = tips + ', Phone number ' + (empty(cust.basicIdentifier)?requester.identifier:cust.basicIdentifier) + '. Respond with';

promptText = promptText + '\n' + tips;

var promptText = promptText + '\n1. Yes\n2. No';
__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
accessDevice = CurReq.getIdentifierDef('AccessDevice');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
AG.sendTransOutgoing(CurReq,__params,'19');
__next = '2';
}
}
else
{
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Do Pre-Validation","Do Pre-Validation",""<endrec>
"Pre-Validation","","3","8950","1905","OTC Pay Bill With Prevalidation for STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if (confirmedOrNot)
{ 
__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
CurResp = TargetService.invokeForScript(); 
TC.savingPreValidationEventLog(__params);
__next='end';
}
else
{ 
 var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
 if(resultType == '2' || resultType == '3')
 {
 __params.errDesc='Pre-Validation Result is Rejected.';
__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
}
 else if(resultType == '4')
 {
 __params.errDesc='Pre-Validation confirmation is Timeout.';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
 }
 else
 {
__params.errDesc=""Pre-Validation Request Failed."";
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
 } 
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
TC.savingPreValidationEventLog(__params);
  __next='cancel';
 }","2","Pre-Validataion Result","Pre-Validataion Result",""<endrec>
"Pre-Validation","","1","8951","1906","Customer Deposit Money With Prevalidation for STK","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","8952","1906","Customer Deposit Money With Prevalidation for STK","__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
__params.EventType='PRE_VALIDATION';
if(__errorCode == 'UMC64000')
{
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
__params.errDesc='Pre-Validation confirmation is Timeout.';
TC.savingPreValidationEventLog(__params);
}
else
{
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","2","8953","1906","Customer Deposit Money With Prevalidation for STK","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__params.Channel = __accessChannel;
var needDisplayFeeConfirmation=CurReq.hasValueInBody('TransactionRequest.needDisplayFeeConfirmation', 'true');
if (needDisplayFeeConfirmation)
{
TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
feeInfo=budgetMap.FeeInfo;
if(budgetMap.isError == '1')
{
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
 __next = 'end';
}
else
{
 feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
   var promptText = '';
  for(fee:feeList)
  {   
   promptText = promptText + fee.publicName + ':The amount of charge is '+fee.amount;
 
   if(i < sizeLen)
   {
    promptText = promptText + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;

   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  promptText != '')
   {

    promptText = promptText + ',';
   }
 
    promptText = promptText + fee.publicName + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    promptText = promptText + ',';
   } 
   i = i+1;
  }
  if( promptText == '')
   {
     promptText =' No charge.';
   } 
 else
  {
    promptText =promptText +'.';
  } 

var info = IC.queryIdentityName(CurReq.getIdentifierDef('Requester'));
promptText = promptText + '\nThe Requester is ' + info.firstName + ' ' + info.middleName + ' ' + info.lastName;

info = IC.queryIdentityName(CurReq.getIdentifierDef('ReceiverParty'));
promptText = promptText + '\nThe Receiver Party is ' + info.firstName;

var promptText = promptText + '\n1. Yes\n2. No';
__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
accessDevice = CurReq.getIdentifierDef('AccessDevice');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
AG.sendTransOutgoing(CurReq,__params,'19');
__next = '2';
}
}
else
{
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Do Pre-Validation","Do Pre-Validation",""<endrec>
"Pre-Validation","","3","8954","1906","Customer Deposit Money With Prevalidation for STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if (confirmedOrNot)
{ 
__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
CurResp = TargetService.invokeForScript(); 
TC.savingPreValidationEventLog(__params);
__next='end';
}
else
{ 
 var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
 if(resultType == '2' || resultType == '3')
 {
 __params.errDesc='Pre-Validation Result is Rejected.';
__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
}
 else if(resultType == '4')
 {
 __params.errDesc='Pre-Validation confirmation is Timeout.';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
 }
 else
 {
__params.errDesc=""Pre-Validation Request Failed."";
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
 } 
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
TC.savingPreValidationEventLog(__params);
  __next='cancel';
 }","2","Pre-Validataion Result","Pre-Validataion Result",""<endrec>
"Pre-Validation","","1","8955","1907","OTC Pay Bill With Prevalidation for API","__next = '1';
 __params.Channel = __accessChannel;","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","8956","1907","OTC Pay Bill With Prevalidation for API","__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if(__errorCode == 'UMC64000')
{	
    __params.errCode='5';
    __params.errDesc='Pre-Validation confirmation is Timeout.';
    __params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
    __params.EventType='PRE_VALIDATION';
    __params.Reason='Timeout'; 
   TC.savingPreValidationEventLog(__params);
}
else
{
    __params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
 
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","2","8957","1907","OTC Pay Bill With Prevalidation for API","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;
if(budgetMap.isError == '1')
{
 __params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
  __params.ResultMsg = '';
  feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
  for(fee:feeList)
  {
  
   __params.ResultMsg =__params.ResultMsg + fee.publicName+ ':The amount of charge is '+fee.amount;
   
   if(i < sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;
   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  __params.ResultMsg != '')
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 

    __params.ResultMsg =__params.ResultMsg +tax.publicName+ ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
   i = i+1;
  }
  if( __params.ResultMsg == '')
   {
     __params.ResultMsg =' No charge.';
   }
 
 else
  {
    __params.ResultMsg =__params.ResultMsg +'.';
  }  

var tips = 'You will Pay Bill of ';

var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
tips = tips + IC.formatAmount(currency, amount);

tips = tips + ' to ';

var org = IC.queryIdentityName(CurReq.getIdentifierDef('ReceiverParty'));
tips = tips + org.firstName;

tips = tips + ' with ';

var billReferenceNumber = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BillReferenceNumber');
tips = tips + (empty(billReferenceNumber)?'[]':billReferenceNumber);

tips = tips + ' on behalf of ';

var requester = CurReq.getIdentifierDef('Requester');
var cust = IC.queryIdentityName(requester);
if(cust.subType == '1002')
{

tips = tips + 'Customer ' + (empty(cust.firstName)?'[]':cust.firstName) + ' ' + (empty(cust.middleName)?'[]':cust.middleName) + ' ' + (empty(cust.lastName)?'[]':cust.lastName);
}
else
{
tips = tips + 'NON M-PESA CUSTOMER';
}

tips = tips + ', Phone number ' + (empty(cust.basicIdentifier)?requester.identifier:cust.basicIdentifier) + '. Respond with';

__params.ResultMsg =__params.ResultMsg + '\n' + tips;

 __next = '2';
}
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);
}
else
{
  CurResp = TargetService.invokeForScript();
  __next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","3","8958","1907","OTC Pay Bill With Prevalidation for API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{  
    __params.Reason='Continue Pre-Validation Transaction.';
  __params.ResultCode='0';
  __params.ResultMsg ='You confirm initiate transaction!';
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}
else
{
  __params.Reason='Pre-Validation Result is Rejected.';
   __params.ResultCode='1';
   __params.ResultMsg ='You rejected initiate transaction!';
  __next='cancel';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","8959","1908","Customer Deposit Money With Prevalidation for API","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","8960","1908","Customer Deposit Money With Prevalidation for API","__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if(__errorCode == 'UMC64000')
{	
    __params.errCode='5';
    __params.errDesc='Pre-Validation confirmation is Timeout.';
    __params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
    __params.EventType='PRE_VALIDATION';
    __params.Reason='Timeout'; 
   TC.savingPreValidationEventLog(__params);
}
else
{
    __params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
 
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","2","8961","1908","Customer Deposit Money With Prevalidation for API","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;
if(budgetMap.isError == '1')
{
 __params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
  __params.ResultMsg = '';
  feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
  for(fee:feeList)
  {
  
   __params.ResultMsg =__params.ResultMsg + fee.publicName+ ':The amount of charge is '+fee.amount;
   
   if(i < sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;
   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  __params.ResultMsg != '')
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 

    __params.ResultMsg =__params.ResultMsg +tax.publicName+ ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
   i = i+1;
  }
  if( __params.ResultMsg == '')
   {
     __params.ResultMsg =' No charge.';
   }
 
 else
  {
    __params.ResultMsg =__params.ResultMsg +'.';
  }  

var tips = '';

var cust = IC.queryIdentityName(CurReq.getIdentifierDef('ReceiverParty'));
tips = tips + 'Customer ' + (empty(cust.firstName)?'[]':cust.firstName) + ' ' + (empty(cust.middleName)?'[]':cust.middleName) + ' ' + (empty(cust.lastName)?'[]':cust.lastName);
tips = tips + ', Phone number ';
tips = tips + cust.basicIdentifier;
tips = tips + ' will deposit ';

var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
tips = tips + IC.formatAmount(currency, amount);

tips = tips + '. Respond with';

__params.ResultMsg =__params.ResultMsg + '\n' + tips;

 __next = '2';
}
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);
}
else
{
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","3","8962","1908","Customer Deposit Money With Prevalidation for API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{  
    __params.Reason='Continue Pre-Validation Transaction.';
  __params.ResultCode='0';
  __params.ResultMsg ='You confirm initiate transaction!';
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}
else
{
  __params.Reason='Pre-Validation Result is Rejected.';
   __params.ResultCode='1';
   __params.ResultMsg ='You rejected initiate transaction!';
  __next='cancel';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"CUSTOMER","","1","8975","1910","CEB Pay Bill","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* SHORT_CODE */
orgBeneficiaries = IC.queryOrgListBeneficiary(msisdn);
CurrencyCode  = ""USD"";
__params.sessionId=universalSessionID.channelSessionID;
__params.TransTime=Util.getDefaultStartTime();
__next = '0';","begin","set parammeters","",""<endrec>
"CUSTOMER","","2","8976","1910","CEB Pay Bill","var input = __input.response;
if (input == '1') {
  __next = '1';
} else if (input == '2') {
  __next = '2';
} else {
  __next = '0';
}","0","Selete Short Code","<html>
<body>
Please Select ShortCode :<br>
  1 Selete Beneficiary Short Code<br>
  2 Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","8977","1910","CEB Pay Bill","var input = __input.response;
if(input =='0'){
 __next = '2';
}else if(input != '0')
{
var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(orgBeneficiaries)){
  orgBeneficiary= orgBeneficiaries.get(i);
  shortCode=orgBeneficiary.BeneficiaryShortCode;
  billReference=orgBeneficiary.BillReference;
  __params.ReceiverPartyIdentifier  = shortCode;
  __params.BillReferenceNumber= billReference;
  var isManual = TC.isManualSelectionMode(__params.ServiceCode);
if (isManual) {
  reasonTypes = TC.queryReasonTypes(__params.ServiceCode);
   if (empty(reasonTypes) || size(reasonTypes) == 0) {
      __errormsg = 'Sorry, there is not any reason types.';
      __next = 'error';
   } else {
      __next = '4';
   } 
   }else
   {
   __next = '5';
   }
   }
   }else
  {
  __next = '1';
  }","1","Select Beneficiary ShortCode","<html>
<body>
Please Select Beneficiary ShortCode:<br>
$$ var index = 1;
$$ for (orgBeneficiary: orgBeneficiaries){
 ${index} ${orgBeneficiary.BeneficiaryName} ${orgBeneficiary.BeneficiaryShortCode} ${orgBeneficiary.BeneficiaryReference} ${orgBeneficiary.BillReference} <br> 
$$ index = index + 1;
$$ }
     0 Input Short Code
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","8978","1910","CEB Pay Bill","var input = __input.response;
__params.ReceiverPartyIdentifier = input;
   __next = '3';","2","Input Short Code","<html>
<body>
Input Short Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","8979","1910","CEB Pay Bill","var input = __input.response;
__params.BillReferenceNumber = input;
var isManual = TC.isManualSelectionMode(__params.ServiceCode);
if (isManual) {
   reasonTypes = TC.queryReasonTypes(__params.ServiceCode);
   if (empty(reasonTypes) || size(reasonTypes) == 0) {
      __errormsg = 'Sorry, there is not any reason types.';
      __next = 'error';
   } else {
__next = '4';
}
   }  
 else {

__next = '5';
}","3","Input Bill No","<html>
<body>
Input Bill No <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","6","8980","1910","CEB Pay Bill","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(reasonTypes)) {
   __params.ReasonTypeCode = reasonTypes.get(i).getAlias();
   __next = '5';
} 
else {
   __next = '4';
}","4","Input Reason Type","<html>
<body>
Please select reason type:<br>
$$ var index = 1;
$$ for (reasonType : reasonTypes) {
  ${index} ${reasonType.getDisplayName(identity.locale)}<br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","7","8983","1910","CEB Pay Bill","if (empty(multiAccount)) {
  __next = 'error';
} else {
    var input = __input.response;
    if (!empty(input)) {
         var tmp = Util.toInt(input) - 1;
         if(tmp >=0 && tmp < size(multiAccount)) {
               type = multiAccount.get(tmp);
                __params.InitiatorAccountNo = type.AccountNo;
                __secure = true;
                __next = '6';
         } else {
                __next = '5';
         }
    } else {
        __next = '5';
    }
}","5","Choose Inititator Account","<html>
<body>
Please Choose Inititator Account :<br>
$$multiAccount = IC.queryMultiAccounts(identity.identityType, identity.identityId,'m-pesa',CurrencyCode);
$$if (empty(multiAccount )) {
  You have no account to query.
$$} else {
  $$var i = 1;
  $$for(type: multiAccount ) {
  ${i} ${type.AccountName}(${type.AccountType.AccountTypeAlias})(${type.Currency.CurrencyCode})<br>
  $$  i = i+1;
  $$}
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","8","8984","1910","CEB Pay Bill","var input = __input.response;
if(empty(input))
{
__next = '6';
}
else
{
	__params.PIN = input;
__params.put('TransOutgoingRequest@LIST@Param.BillReferenceNumber',__params.BillReferenceNumber);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode',__params.ReceiverPartyIdentifier);
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',__params.AccessDeviceIdentifier);
__params.put('TransOutgoingRequest@LIST@Param.TransType','PayBill_VDF_Demo');
__params.put('TransOutgoingRequest@LIST@Param.TransID',__params.sessionId);
__params.put('TransOutgoingRequest@LIST@Param.TransTime',__params.TransTime);
response=AG.sendSyncTransOutgoing(__params,'52');
		if(response.msgBody.C2BPaymentQueryResponse.IsSuccess.equals(""true""))
{
if(!empty(response))
		{
		  billAmount = response.msgBody.C2BPaymentQueryResponse.Amount;
		  if(!empty(billAmount))
		  {
			__params.Amount = billAmount;
			__next = '7';
		  }
		  else
		  {
			 __errormsg = 'Sorry, there is no bill amount';
            __next = 'error';
		  }
		}
		else
		{
		  __errormsg = 'Sorry, Query bill Statement error';
            __next = 'error';
		}
}
else
{
        __errormsg = 'Sorry, Query bill Statement error';
            __next = 'error';
}
	}","6","Input PIN","<html>
<body>
Input PIN :<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","10","8985","1910","CEB Pay Bill","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '8';
}","8","Confirm","<html>
<body>
$$orgName = IC.queryOrgName(__params.ReceiverPartyIdentifier);
$$formatAmount = IC.formatAmount(CurrencyCode, __params.Amount);
$$chargeFee = TC.queryCustomerCharge(__params);
$$if(empty(chargeFee))
$${
To Pay ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${orgName} for account number ${__params.BillReferenceNumber}.Press 1 to confirm or 0 to cancel.<br>
$$}
$$else
$${
To Pay ${formatAmount} to ${__params.ReceiverPartyIdentifier} ${orgName} for account number ${__params.BillReferenceNumber}, the charge is ${chargeFee}.Press 1 to confirm or 0 to cancel.<br>
$$}
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","9","8986","1910","CEB Pay Bill","var input = __input.response;
var length = size(input);
if (length > 255) 
{
    __next = '7';
}
else 
{
     __referenceData.Comment2Customer = input;
    __next = '8';
}","7","Enter Comment to Customer","<html>
<body>
Enter Comment to Customer:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","901","1009","Activate customer","__params.ServiceCode = __service.serviceCode;
__params.ActionType = 'Activate';
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization ","",""<endrec>
"Pre-Validation","","1","9016","1915","Cash Out To Bank Account for USSD","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9018","1915","Cash Out To Bank Account for USSD","__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;
   
accessDevice = CurReq.getIdentifierDef('AccessDevice');
var bankCode = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCode');
var bankAccountNumber = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankAccountNumber');

__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);         
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','2001');
__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);

__params=TC.buildCashOutInquiryMessage(accessDevice.identifier,__sessionId,bankCode,bankAccountNumber,__params);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Settlement',__params.get('TransOutgoingRequest@LIST@Param.Settlement'));

AG.sendTransOutgoing(CurReq,__params,'105');
__next = '2';","1","Do Validate Bank Information","Do Validate Bank Information",""<endrec>
"Pre-Validation","","3","9019","1915","Cash Out To Bank Account for USSD","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
	__params.__sessionId= __sessionId;
	__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);    
	accessDevice = CurReq.getIdentifierDef('AccessDevice');    
	__params.put('TransOutgoingRequest@LIST@Param.Msisdn',accessDevice.identifier);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','2001');

       var ussdContent = '';
       var customerName = CurReq.getValueFromBody('TransactionEventRequest.BankCustomerName');
	customerName=Util.subString(customerName ,46);
       OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCustomerName',customerName);
	var bankCode = OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCode');
var bankAccountNumber = OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankAccountNumber');
var amount= OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
var currency= OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
ussdContent = ussdContent + 'Bank Code Is:'+bankCode + ';Bank Account Number Is:' + bankAccountNumber  +';Customer Name Is:' + customerName + ';Amount Is:' + amount + ' ' + currency + '.Please Input Pin.';
	__params.put('TransOutgoingRequest@LIST@Param.ussdContent',ussdContent);
	 AG.sendTransOutgoing(CurReq,__params,'104');
	__next = '3';
}
else
{ 
	__next = 'error';
}","2","Validate Bank Information Result","Validate Bank Information Result",""<endrec>
"CUSTOMER","","2","902","1009","Activate customer","var i = Util.toInt(__input.response) - 1;
if (i >= 0 && i < size(languages)) {
  __params.@BODY@LanguageCode = languages.get(i).toString();
  __secure = true;
  __next = '2';
} else {
  __next = '1';
}","1","Select Language","<html>
<body>
Please select language:<br>
$$languages = IC.queryAllLanguages();
$$var i = 1;
$$for (lang: languages) {
  ${i} ${lang.getDisplayName(identity.locale)}<br>
$$ i = i + 1;
$$}
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","4","9020","1915","Cash Out To Bank Account for USSD","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
        var pin= CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
        var newPin = Util.convertMessageToObject(pin);
	if(!empty(newPin ))
	{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',newPin );
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SessionId',__sessionId);
	CurResp = TargetService.invokeForScript(); 
	__next='end';
	}
}
else
{ 
  __next = 'error';
}","3","Record Customer PIN","Record Customer PIN",""<endrec>
"Pre-Validation","","5","9021","1915","Cash Out To Bank Account for USSD","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
//NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","1","9022","1916","Cash Out To Bank Account for SMS","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9023","1916","Cash Out To Bank Account for SMS","__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;
   
accessDevice = CurReq.getIdentifierDef('AccessDevice');
var bankCode = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCode');
var bankAccountNumber = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankAccountNumber');

__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);         
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','2001');
__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);

__params=TC.buildCashOutInquiryMessage(accessDevice.identifier,__sessionId,bankCode,bankAccountNumber,__params);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Settlement',__params.get('TransOutgoingRequest@LIST@Param.Settlement'));

AG.sendTransOutgoing(CurReq,__params,'105');
__next = '2';","1","Do Validate Bank Information","Do Validate Bank Information",""<endrec>
"Pre-Validation","","3","9024","1916","Cash Out To Bank Account for SMS","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
	__params.__sessionId= __sessionId;
	__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);    
	accessDevice = CurReq.getIdentifierDef('AccessDevice');    
	__params.put('TransOutgoingRequest@LIST@Param.Msisdn',accessDevice.identifier);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','2001');

       var ussdContent = '';
       var customerName = CurReq.getValueFromBody('TransactionEventRequest.BankCustomerName');
	customerName=Util.subString(customerName ,46);
       OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCustomerName',customerName);
	var bankCode = OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCode');
var bankAccountNumber = OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankAccountNumber');
var amount= OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
var currency= OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
ussdContent = ussdContent + 'Bank Code Is:'+bankCode + ';Bank Account Number Is:' + bankAccountNumber  +';Customer Name Is:' + customerName + ';Amount Is:' + amount + ' ' + currency + '.Please Input Pin.';
	__params.put('TransOutgoingRequest@LIST@Param.ussdContent',ussdContent);
	 AG.sendTransOutgoing(CurReq,__params,'104');
	__next = '3';
}
else
{ 
	__next = 'error';
}","2","Validate Bank Information Result","Validate Bank Information Result",""<endrec>
"Pre-Validation","","4","9025","1916","Cash Out To Bank Account for SMS","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
        var pin= CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
        var newPin = Util.convertMessageToObject(pin);
	if(!empty(newPin ))
	{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',newPin );
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SessionId',__sessionId);
	CurResp = TargetService.invokeForScript(); 
	__next='end';
	}
}
else
{ 
  __next = 'error';
}","3","Record Customer PIN","Record Customer PIN",""<endrec>
"Pre-Validation","","5","9026","1916","Cash Out To Bank Account for SMS","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
//NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","1","9027","1917","Cash Out To Bank Account for API","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9028","1917","Cash Out To Bank Account for API","initiator= CurReq.getIdentifierDef('Initiator');
var bankCode = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCode');
var bankAccountNumber = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankAccountNumber');

__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);         
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','2001');
__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',initiator.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);

__params=TC.buildCashOutInquiryMessage(initiator.identifier,__sessionId,bankCode,bankAccountNumber,__params);
TC.buildIdentifier(CurReq,__params,'Initiator');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Settlement',__params.get('TransOutgoingRequest@LIST@Param.Settlement'));

AG.sendTransOutgoing(CurReq,__params,'105');
__next = '2';","1","Do Validate Bank Information","Do Validate Bank Information",""<endrec>
"Pre-Validation","","3","9029","1917","Cash Out To Bank Account for API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
__params.__sessionId= __sessionId;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;

__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);    
accessDevice = CurReq.getIdentifierDef('AccessDevice');    
__params.put('TransOutgoingRequest@LIST@Param.Msisdn',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','2001');
var ussdContent = '';
var customerName = CurReq.getValueFromBody('TransactionEventRequest.BankCustomerName');
customerName=Util.subString(customerName ,46);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCustomerName',customerName);
var bankCode = OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCode');
var bankAccountNumber = OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankAccountNumber');
var amount= OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
var currency= OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
ussdContent = ussdContent + 'Bank Code Is:'+bankCode + ';Bank Account Number Is:' + bankAccountNumber  +';Customer Name Is:' + customerName + ';Amount Is:' + amount + ' ' + currency + '.Please Input Pin.';

__params.ResultMsg = ussdContent;
AG.sendNotifyAPIResult(OriginalReq,__params,__sessionId,null);
__next = '3';
}
else
{ 
__params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);

 __next = 'error';
 }","2","Validate Bank Information Result","Validate Bank Information Result",""<endrec>
"CUSTOMER","","3","903","1009","Activate customer","var input = __input.response;
__params.OldPIN = input;
__params.@HEAD@PIN = input;
__secure = true;
__next = '3';
","2","Enter initial PIN","<html>
<body>
Enter initial PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","4","9030","1917","Cash Out To Bank Account for API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
        __params.Reason='Continue Pre-Validation Transaction.';
  __params.ResultCode='0';
  __params.ResultMsg ='You confirm initiate transaction!';
	var pin =  CurReq.getValueFromBody('TransactionEventRequest.ConfirmPIN');
	if(!empty(pin))
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',pin);
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SessionId',__sessionId);
		CurResp = TargetService.invokeForScript(); 
		__next='end';
	}
        
else
{ 
__params.Reason='Pre-Validation Result is Rejected.';
   __params.ResultCode='1';
   __params.ResultMsg ='You rejected initiate transaction!';
  __next = 'error';
 }
}
else
{ 
__params.Reason='Pre-Validation Result is Rejected.';
   __params.ResultCode='1';
   __params.ResultMsg ='You rejected initiate transaction!';
	__next = 'error';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","3","Record Customer PIN","Record Customer PIN",""<endrec>
"Pre-Validation","","5","9031","1917","Cash Out To Bank Account for API","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
//NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","error occurs.",""<endrec>
"CUSTOMER","","1","9039","1919","Organization Loan","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier=msisdn;
__params.PrimaryPartyIdentifierType = '04'; /* SHORT_CODE */
denominations= IC.queryOrganizationLoanDenomination();
 __next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","4","904","1009","Activate customer","var input = __input.response;
__params.NewPIN = input;
__secure = true;
__next = '4';","3","Enter New PIN","<html>
<body>
Enter New PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","2","9040","1919","Organization Loan","var input = __input.response;
__params.PrimaryPartyIdentifier = input;
__next = '2';","1","Enter Organiztion Code","<html>
<body>
Enter Organiztion Code<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","9041","1919","Organization Loan","var i = Util.toInt(__input.response) - 1;
 if (i >= 0 && i < size(denominations)){
__params.DenominationCode=denominations.get(i);
}

  __next = '3';","2","Select Denomination","<html>
<body>
Select Denomination:<br>
$$ var index = 1;
$$ for (denomination: denominations){
 ${index} ${denomination} <br>
$$ index = index + 1;
$$ }
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","9042","1919","Organization Loan","var input = __input.response;
__params.PIN = input;
__next = '4';","3","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","5","9044","1919","Organization Loan","var input = __input.response;
if (input == '1') {
__next = 'end';
} 
else if(input == '0') {
__next = 'cancel';
} 
else {
__next = '4';
}","4","Confirm","<html>
<body>
Request Organization loans?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","9045","1920","Customer Remittance For USSD Push","__params.__sessionId= __sessionId;    
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);        
__params.put('TransOutgoingRequest@LIST@Param.Msisdn','333');        
__params.put('TransOutgoingRequest@LIST@Param.ussdContent','444');        
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
 AG.sendTransOutgoing(CurReq,__params,'104');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9046","1920","Customer Remittance For USSD Push","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(empty(newPin))
 {
    __next = 'error';
 }
else
{OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',newPin);
CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","2","step2","step2",""<endrec>
"Pre-Validation","","4","9047","1920","Customer Remittance For USSD Push","notificationInfoList = IC.queryNotificationMsisdn(OriginalReq,'Initiator','500000000000010001');
 duplicateErrorCode='UMC65002';
     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,104000000000001172,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9048","1920","Customer Remittance For USSD Push","__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
__next = '2';","1","step1","step1",""<endrec>
"Pre-Validation","","1","9049","1921","Customer Remittance For USSD Push By APP","__params.__sessionId= __sessionId;    
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);        
__params.put('TransOutgoingRequest@LIST@Param.Msisdn','333');        
__params.put('TransOutgoingRequest@LIST@Param.ussdContent','444');        
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
 AG.sendTransOutgoing(CurReq,__params,'104');
__next = '1';","begin","set parammeters","",""<endrec>
"CUSTOMER","","5","905","1009","Activate customer","var input = __input.response;
if(__params.NewPIN == input)
{
__next = '5';
}
else
{
__next = '3';
}","4","Confirm new PIN","<html>
<body>
Confirm new PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","3","9050","1921","Customer Remittance For USSD Push By APP","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(empty(newPin))
 {
    __next = 'error';
 }
else
{
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPin',newPin);
CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","2","step2","step2",""<endrec>
"Pre-Validation","","4","9051","1921","Customer Remittance For USSD Push By APP","notificationInfoList = IC.queryNotificationMsisdn(OriginalReq,'Initiator','500000000000010001');
 duplicateErrorCode='UMC65002';
     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,104000000000001172,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9052","1921","Customer Remittance For USSD Push By APP","__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
__next = '2';","1","step1","step1",""<endrec>
"Pre-Validation","","1","9053","1922","Cash Out ussd push","__next = '1';
__params.__sessionId= __sessionId;    
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);        
__params.put('TransOutgoingRequest@LIST@Param.Msisdn','333');        
__params.put('TransOutgoingRequest@LIST@Param.ussdContent','444');        
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
 AG.sendTransOutgoing(CurReq,__params,'104');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9054","1922","Cash Out ussd push","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(empty(newPin))
 {
    __next = 'error';
 }
else
{
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPin',newPin);
CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","2","step2","step2",""<endrec>
"Pre-Validation","","4","9055","1922","Cash Out ussd push","notificationInfoList = IC.queryNotificationMsisdn(OriginalReq,'Initiator','500000000000010001');
 duplicateErrorCode='UMC65002';
     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,104000000000001172,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9056","1922","Cash Out ussd push","__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
__next = '2';","1","step1","step1",""<endrec>
"Pre-Validation","","1","9057","1923","Organization Loan","initiator= CurReq.getIdentifierDef('Initiator'); 

__params.__sessionId=__sessionId;
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.Msisdn',initiator.Identifier);
__params.put('TransOutgoingRequest@LIST@Param.ussdContent','EnterPin');
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

AG.sendTransOutgoing(CurReq,__params,'104');

__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9058","1923","Organization Loan","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(empty(newPin))
 {
    __next = 'error';
 }
else
{
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',newPin);
CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","2","Get Pin","Get Pin",""<endrec>
"Pre-Validation","","4","9059","1923","Organization Loan","notificationInfoList = IC.queryNotificationMsisdn(OriginalReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"CUSTOMER","","6","906","1009","Activate customer","var input = __input.response;
if (Validator.isDate(input, 'ddmmyyyy')) {
 __params.Birthday = IC.convertor2DefaultDateFormat(input, 'ddmmyyyy');
__params.Birthday = input;
    __next = '10';
} else {
    __next = '5';
}","5","Enter Date of Birth","<html>
<body>
Enter Date of Birth(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","2","9060","1923","Organization Loan","__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
__next = '2';","1","Input ShortCode","Input ShortCode",""<endrec>
"Pre-Validation","","1","9065","1925","Customer Change Language","initiator= CurReq.getIdentifierDef('Initiator'); 

__params.__sessionId=__sessionId;
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.Msisdn',initiator.Identifier);
__params.put('TransOutgoingRequest@LIST@Param.ussdContent','EnterPin');
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

AG.sendTransOutgoing(CurReq,__params,'104');

__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9066","1925","Customer Change Language","__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
__next = '2';","1","Input ShortCode","Input ShortCode",""<endrec>
"Pre-Validation","","3","9067","1925","Customer Change Language","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(empty(newPin))
 {
    __next = 'error';
 }
else
{
OriginalReq.setParamValue4RequestHeaderParam('PIN',newPin);
CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","2","Get Pin","Get Pin",""<endrec>
"Pre-Validation","","3","9068","1925","Customer Change Language","notificationInfoList = IC.queryNotificationMsisdn(OriginalReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","information","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9069","1926","Cash In By SMS","ReceiverParty= CurReq.getIdentifierDef('ReceiverParty'); 
num = ReceiverParty.Identifier;
flag = Util.isStartWith(num,'99');
if(!flag)
{
        CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ServiceCode','2001');
	CurReq.request.getHeader().setServiceCode('2001');
        OriginalReq.request.getHeader().setServiceCode('2001');
        CurReq.putToBody('TransactionRequest.ReceiverParty.IdentifierType','01');
        CurResp = TargetService.invokeForScript(); 
        __next = 'end';
}
else
{
        CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ServiceCode','2101');
	CurReq.request.getHeader().setServiceCode('2101');
        OriginalReq.request.getHeader().setServiceCode('2101');
        OriginalReq.putToBody('TransactionRequest.ReceiverParty.IdentifierType','03');
        CurResp = TargetService.invokeForScript(); 
        __next = 'end';
}
__next = 'end';","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","9073","1927","Cash In By USSD","ReceiverParty= CurReq.getIdentifierDef('ReceiverParty'); 
num = ReceiverParty.Identifier;
flag = Util.isStartWith(num,'99');
if(!flag)
{
        CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ServiceCode','2001');
	CurReq.request.getHeader().setServiceCode('2001');
        OriginalReq.request.getHeader().setServiceCode('2001');
        CurReq.putToBody('TransactionRequest.ReceiverParty.IdentifierType','01');
        CurResp = TargetService.invokeForScript(); 
        __next = 'end';
}
else
{
        CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ServiceCode','2101');
	CurReq.request.getHeader().setServiceCode('2101');
        OriginalReq.request.getHeader().setServiceCode('2101');
        OriginalReq.putToBody('TransactionRequest.ReceiverParty.IdentifierType','03');
        CurResp = TargetService.invokeForScript(); 
        __next = 'end';
}
__next = 'end';","begin","set parammeters","",""<endrec>
"Pre-Validation","","1","9074","1928","Indosat Reload With Location Validation for SMS","subscriberNumber= TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.SubscriberNumber')); 
denominationCode= CurReq.getValueFromBody('TransactionRequest.DenominationCode'); 
initiator = CurReq.getIdentifierDef('Initiator');
shortCode= initiator.shortCode;
var dupKey='';

dupKey = dupKey + subscriberNumber + denominationCode + shortCode;
resultCode = Util.checkDuplication(dupKey, 2);
if (resultCode == 'OK')
{
    serviceCode = CurReq.getRequest().header.serviceCode;
    __params.__sessionId= __sessionId;
    spList = IC.queryServiceProperties(serviceCode);
    spValue = ''; 
    for(sp:spList )
    {
        if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
       {
            spValue = sp.servicePropertyValue;
            break;
       }
    }
    
    
    receipts = IC.queryPreValidationNotification(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,0,null);
    amsisdn = receipts.get(0).recipients;
    CurReq.putToBodyForce('TransactionRequest.SubscriberNumber',subscriberNumber);
    CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SubscriberNumber',subscriberNumber);
    CurReq.putValue4ReferenceData(""MSISDN"",subscriberNumber);   
    CurReq.putValue4ReferenceData(""Denomination Code"",denominationCode);     
    
    territoryType = '2';
         
    A_FactorX = '';       

    A_FactorY = '';
    
    __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
    gpsPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
    __params.aLAC= CurReq.getValueFromBody('TransactionRequest.aLAC');
    __params.aCI= CurReq.getValueFromBody('TransactionRequest.aCI');
    
    __next = '1';
}
else
{
     __params.TransactionUMCPreValidationEvent='Pre-Validation';
     __params.TransactionUMCPreValidationError='A request is consecutively initiated multiple times in a short period of time.';
     duplicateErrorCode='UMC65002';
     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
     __errorCode=duplicateErrorCode;
     notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
     NC.sendPreValidationNotification(notificationInfoList ,duplicateErrorCode,__accessChannel,__params);
     resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode('UMC65002');
     __next = 'end';
}","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9075","1928","Indosat Reload With Location Validation for SMS","if(empty(inServerName))
{
	notificationInfoList  = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
	NC.sendPreValidationNotification(notificationInfoList ,__params.Channel,101000000000001174,__params);
	__next = 'end';
}
else
{
if(empty(__params.aLAC) || empty(__params.aCI))
{
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
 __params.put('TransOutgoingRequest@LIST@Param.msisdn',amsisdn);
 __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
 AG.sendTransOutgoing(CurReq,__params,'71');
 __next = '2'; 
 }
else
{
OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);

  if(spValue == '01' || spValue == '03')
    {
	 
       var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
          if(resultMap.ResultCode == 'SYS00000')
          {
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');    
              __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
              __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);

			   __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
             AG.sendTransOutgoing(CurReq,__params,'71');
             __next = '3';
          }
         else
         {				  
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
            __next = 'error';
         }
     }
	 else
	 {
   __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
              __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
			   __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
             AG.sendTransOutgoing(CurReq,__params,'71');
	   __next = '3';
	 }
}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","3","9076","1928","Indosat Reload With Location Validation for SMS","A_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
A_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(A_FactorX) && !empty(A_FactorY))
  {
OriginalReq.putValue4ReferenceData('A#CellID',A_FactorX);
OriginalReq.putValue4ReferenceData('A#LAC',A_FactorY); 
	  if(spValue == '01' || spValue == '03')
	  {
       var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',A_FactorX,A_FactorY);
        
       if(resultMap.ResultCode == 'SYS00000')
       {
           OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');   
		     __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
               __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
               AG.sendTransOutgoing(CurReq,__params,'71');
  
             __next = '3';
               
        }
        else
        {
		 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');   
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
           __next = 'error';
        }
        
        

		}else{
		
     OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
     __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
     AG.sendTransOutgoing(CurReq,__params,'71');
        __next = '3';
		}
     }
else
   {
   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
    
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
     __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
     AG.sendTransOutgoing(CurReq,__params,'71');
        __next = '3';
   }","2","Verify Identity Territory Result","Verify Identity Territory Result",""<endrec>
"Pre-Validation","","4","9077","1928","Indosat Reload With Location Validation for SMS","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','1');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','EXT');        
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumber',subscriberNumber);
           __params.put('TransOutgoingRequest@LIST@Param.originTransactionID',__sessionId);
           __params.put('TransOutgoingRequest@LIST@Param.originHostName','SALDOMOBO');
           __params.put('TransOutgoingRequest@LIST@Param.originTimeStamp',Util.getISO8601CurrencyTime()); 
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumberNAI','1');
if(!empty(B_FactorX) && !empty(B_FactorY))
{ 
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorX);
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorY); 
        if(spValue == '02' || spValue == '03')
		{
       var resultMapB = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',B_FactorX,B_FactorY);      
        if(resultMapB.ResultCode == 'SYS00000')
        {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
       {
           __next = 'error';
        }     
else
       {


           __params.put('TransOutgoingRequest@LIST@Param.thirdPartyKey',inServerName);   
           OriginalReq.putValue4ReferenceData(""MSISDNTerritoryId"",resultMap.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'0');   
           AG.sendTransOutgoing(CurReq,__params,'72');
         __next = '4';
        }
        }
        else
       
        {
		OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'1');   
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
         __next = 'error';
        }
        
     }else
	 {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
   {
    __next = 'error';
   }     
else
       {
            __params.put('TransOutgoingRequest@LIST@Param.thirdPartyKey',inServerName);   
            OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
           AG.sendTransOutgoing(CurReq,__params,'72');
         __next = '4';
     }
	 }
    }
    else
    {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
   {
    __next = 'error';
   }     
else


   {
            __params.put('TransOutgoingRequest@LIST@Param.thirdPartyKey',inServerName);   
            OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
           AG.sendTransOutgoing(CurReq,__params,'72');
         __next = '4';
    }
    }","3","Verify Msisdn And Identity Territory Result","Verify Msisdn And Identity Territory Result",""<endrec>
"Pre-Validation","","5","9078","1928","Indosat Reload With Location Validation for SMS","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');

if(confirmedOrNot)
{ 
var inServerName = IC.queryINServerName(subscriberNumber,'');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
        CurResp = TargetService.invokeForScript(); 
        __next = 'end';
}
  else
    {
        OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyAccountStatusFailed','true');
         CurResp = TargetService.invokeForScript(); 
        __next = 'error';
    }","4","Verify Msisdn Status","Verify Msisdn Status",""<endrec>
"Pre-Validation","","6","9079","1928","Indosat Reload With Location Validation for SMS","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9080","1929","Purchase Data Package With Location Validation for SMS","rechargedMSISDN = TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN')); 
CurReq.putToBodyForce('TransactionRequest.RechargedMSISDN',rechargedMSISDN);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.RechargedMSISDN',rechargedMSISDN);
spValue = ''; 
serviceCode = CurReq.getRequest().header.serviceCode;
__params.__sessionId= __sessionId;
spList = IC.queryServiceProperties(serviceCode);
for(sp:spList )
{
if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
{
spValue = sp.servicePropertyValue;
break;
}
}

territoryType = '2';

initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');


receipts = IC.queryPreValidationNotification(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,0,null);
if(!empty(receipts))
{
	__params.amsisdn = receipts.get(0).recipients;
}
__params.bmsisdn=CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN');
__params.aLAC= CurReq.getValueFromBody('TransactionRequest.aLAC');
__params.aCI= CurReq.getValueFromBody('TransactionRequest.aCI');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PackageType','2');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BundleCategory','2');
  __next='1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9081","1929","Purchase Data Package With Location Validation for SMS","if(!empty(__params.aLAC) && !empty(__params.aCI) )
{
	OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);
	if(spValue == '01' || spValue == '03')
    {
	 var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode != 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}
	else
	{
            OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');  
		__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	}
     }
	 else
	 {
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
	  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
		 __next='3';
	 }
 	
}
else
{
	__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
	__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.amsisdn);
	__next='2';
	AG.sendTransOutgoing(CurReq,__params,'71');
}","1","Recored Operator Location","Recored Operator Location",""<endrec>
"Pre-Validation","","3","9082","1929","Purchase Data Package With Location Validation for SMS","__params.aLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
__params.aCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(__params.aLAC) && !empty(__params.aCI) )
  { 
       OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);
	if(spValue == '01' || spValue == '03')
    {
	 var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode != 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}
	else
	{
	      OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');    
		__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	}
     }
	 else
	 {

	  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	 }
     }
else
   {
   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
   }","2","Verify Operator Location","Verify Operator Location",""<endrec>
"Pre-Validation","","4","9083","1929","Purchase Data Package With Location Validation for SMS","bLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
bCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
responseCode=CurReq.getValueFromBody('TransactionEventRequest.responseCode');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Lac',bLAC);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Ci',bCI);
aLAC = __params.aLAC;
aCI = __params.aCI;
if(!empty(aLAC))
{
	OriginalReq.putValue4ReferenceData('A#CellID',aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',aLAC);
}
if(!empty(bLAC))
{
	OriginalReq.putValue4ReferenceData('B#CellID',bCI);
	OriginalReq.putValue4ReferenceData('B#LAC',bLAC);
}
if(!empty(bLAC) && !empty(bCI))
{ 
if(spValue == '02' || spValue == '03')
		{
       var resultMapB = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',bLAC,bCI);      
        if(resultMapB.ResultCode == 'SYS00000')
        {
		   OriginalReq.putValue4ReferenceData(""MSISDNTerritoryId"",resultMapB.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'0');   
            CurResp = TargetService.invokeForScript(); 
	       __next='end';
        }
        else
        {

OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		  OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'1');   
		  CurResp = TargetService.invokeForScript(); 
         __next = 'error';
        }
        
     }else
	 {
	            OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
            CurResp = TargetService.invokeForScript(); 
	       __next='end';
	 }
}

else
{
   OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
	CurResp = TargetService.invokeForScript();
	 __next='end';
}","3","Recored MSISDN Location","Recored MSISDN Location",""<endrec>
"Pre-Validation","","5","9084","1929","Purchase Data Package With Location Validation for SMS","__next='end';","error","information","Verify failed.",""<endrec>
"Pre-Validation","","1","9085","1930","Purchase VAS Package With Location Validation for SMS","spValue = ''; 
__params.__sessionId= __sessionId;
rechargedMSISDN = TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN')); 
CurReq.putToBodyForce('TransactionRequest.RechargedMSISDN',rechargedMSISDN);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.RechargedMSISDN',rechargedMSISDN);
serviceCode = CurReq.getRequest().header.serviceCode;
spList = IC.queryServiceProperties(serviceCode);
for(sp:spList )
{
if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
{
spValue = sp.servicePropertyValue;
break;
}
}

territoryType = '2';

initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');


receipts = IC.queryPreValidationNotification(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,0,null);
if(!empty(receipts))
{
	__params.amsisdn = receipts.get(0).recipients;
}
__params.bmsisdn=CurReq.getValueFromBody('TransactionRequest.RechargedMSISDN');
__params.aLAC= CurReq.getValueFromBody('TransactionRequest.aLAC');
__params.aCI= CurReq.getValueFromBody('TransactionRequest.aCI');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PackageType','3');
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BundleCategory','3');
  __next='1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9086","1930","Purchase VAS Package With Location Validation for SMS","if(!empty(__params.aLAC) && !empty(__params.aCI) )
{
	OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);
	if(spValue == '01' || spValue == '03')
    {
	 var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode != 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}
	else
	{
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');  
		__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	}
     }
	 else
	 {
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
	  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
		 __next='3';
	 }
 	
}
else
{
	__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
	__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.amsisdn);
	__next='2';
	AG.sendTransOutgoing(CurReq,__params,'71');
}","1","Recored Operator Location","Recored Operator Location",""<endrec>
"Pre-Validation","","3","9087","1930","Purchase VAS Package With Location Validation for SMS","__params.aLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
__params.aCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(__params.aLAC) && !empty(__params.aCI) )
  { 
    OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);
	if(spValue == '01' || spValue == '03')
    {
	 var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode != 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}
	else
	{
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');  
		__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	}
     }
	 else
	 {

	  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
	 }
     }
else
   {
   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');      
       __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		__params.put('TransOutgoingRequest@LIST@Param.msisdn',__params.bmsisdn);
		AG.sendTransOutgoing(CurReq,__params,'71');
		 __next='3';
   }","2","Verify Operator Location","Verify Operator Location",""<endrec>
"Pre-Validation","","4","9088","1930","Purchase VAS Package With Location Validation for SMS","bLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
bCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
responseCode=CurReq.getValueFromBody('TransactionEventRequest.responseCode');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Lac',bLAC);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Ci',bCI);
aLAC = __params.aLAC;
aCI = __params.aCI;
if(!empty(aLAC))
{
	OriginalReq.putValue4ReferenceData('A#CellID',aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',aLAC);
}
if(!empty(bLAC))
{
	OriginalReq.putValue4ReferenceData('B#CellID',bCI);
	OriginalReq.putValue4ReferenceData('B#LAC',bLAC);
}
if(!empty(bLAC) && !empty(bCI))
{ 
if(spValue == '02' || spValue == '03')
		{
       var resultMapB = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',bLAC,bCI);      
        if(resultMapB.ResultCode == 'SYS00000')
        {
		   OriginalReq.putValue4ReferenceData(""MSISDNTerritoryId"",resultMapB.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'0');   
            CurResp = TargetService.invokeForScript(); 
	       __next='end';
        }
        else
        {

OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		  OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'1');   
		  CurResp = TargetService.invokeForScript(); 
         __next = 'error';
        }
        
     }else
	 {
	            OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
            CurResp = TargetService.invokeForScript(); 
	       __next='end';
	 }
}

else
{
   OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'-1');   
	CurResp = TargetService.invokeForScript();
	 __next='end';
}","3","Recored MSISDN Location","Recored MSISDN Location",""<endrec>
"Pre-Validation","","5","9089","1930","Purchase VAS Package With Location Validation for SMS","__next='end';","error","information","Verify failed.",""<endrec>
"Pre-Validation","","1","9090","1931","Indosat Reload via Cipika With Location Validation for API","subscriberNumber= TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.SubscriberNumber')); 
denominationCode= CurReq.getValueFromBody('TransactionRequest.DenominationCode'); 
initiator = CurReq.getIdentifierDef('Initiator');
shortCode= initiator.shortCode;
var dupKey='';
inServerName = IC.queryINServerName(subscriberNumber,'');

dupKey = dupKey + subscriberNumber + denominationCode + shortCode;
resultCode = Util.checkDuplication(dupKey, 2);
if (resultCode == 'OK')
{
    CurReq.putToBodyForce('TransactionRequest.SubscriberNumber',subscriberNumber);
    CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SubscriberNumber',subscriberNumber);

    __params.__sessionId= __sessionId;
    CurReq.putValue4ReferenceData(""MSISDN"",subscriberNumber);   
    CurReq.putValue4ReferenceData(""Denomination Code"",denominationCode);     
       
    A_FactorX = '';       
    A_FactorY = '';

    __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
    gpsPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');

    __next = '1';
}
else
{
     __params.TransactionUMCPreValidationEvent='Pre-Validation';
     __params.TransactionUMCPreValidationError='A request is consecutively initiated multiple times in a short period of time.';
     duplicateErrorCode='UMC65002';

     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
     __errorCode=duplicateErrorCode;
     notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
     NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);
     resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode('UMC65002');
     __next = 'end';
}
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
gpsPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');

__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9091","1931","Indosat Reload via Cipika With Location Validation for API","if(empty(inServerName))
{
	notificationInfoList  = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
	NC.sendPreValidationNotification(notificationInfoList ,__params.Channel,101000000000001174,__params);
	__next = 'end';
}
else
{
if(!empty(gpsPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',gpsPosition);
}
__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
 __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
 AG.sendTransOutgoing(CurReq,__params,'71');
__next = '2';
}","1","Record A Territory And Get B Territory","Record A Territory And Get B Territory",""<endrec>
"Pre-Validation","","3","9092","1931","Indosat Reload via Cipika With Location Validation for API","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(B_FactorX) && !empty(B_FactorY))
{
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorX);
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorY);
}

      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
{
    __next = 'error';
}     
else
{
           OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
           CurResp = TargetService.invokeForScript(); 
           __next = 'end';
}","2","Record B Territory","Record B Territory",""<endrec>
"Pre-Validation","","6","9094","1931","Indosat Reload via Cipika With Location Validation for API","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9095","1932","Indosat Reload via Cipika With Location Validation for APP","subscriberNumber= TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.SubscriberNumber')); 
denominationCode= CurReq.getValueFromBody('TransactionRequest.DenominationCode'); 
inServerName = IC.queryINServerName(subscriberNumber,'');
initiator = CurReq.getIdentifierDef('Initiator');
shortCode= initiator.shortCode;
var dupKey='';
sysDiscountTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_DISCOUNT_LOCATION_VALIDATION');
sysCommissionTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_COMMISSION_LOCATION_VALIDATION');

dupKey = dupKey + subscriberNumber + denominationCode + shortCode;
resultCode = Util.checkDuplication(dupKey, 2);
if (resultCode == 'OK')
{
    serviceCode = CurReq.getRequest().header.serviceCode;
    spList = IC.queryServiceProperties(serviceCode);
    spValue = ''; 
    for(sp:spList )
    {
    if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
    {
    spValue = sp.servicePropertyValue;
    break;
    }
    }
    
    receipts = IC.queryPreValidationNotification(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,0,null);
    amsisdn = receipts.get(0).recipients;
    
    CurReq.putToBodyForce('TransactionRequest.SubscriberNumber',subscriberNumber);
    CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SubscriberNumber',subscriberNumber);

    CurReq.putValue4ReferenceData(""MSISDN"",subscriberNumber);   
    CurReq.putValue4ReferenceData(""Denomination Code"",denominationCode);     
    
    territoryType = '2';
         
    A_FactorX = '';       
    A_FactorY = '';
    
    __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
    __params.__sessionId= __sessionId;
    gpsPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
    
    __next = '1';
}
else
{
     __params.TransactionUMCPreValidationEvent='Pre-Validation';
     __params.TransactionUMCPreValidationError='A request is consecutively initiated multiple times in a short period of time.';
     duplicateErrorCode='UMC65002';
     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
     __errorCode=duplicateErrorCode;
     notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
     NC.sendPreValidationNotification(notificationInfoList ,duplicateErrorCode,__accessChannel,__params);
     resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode('UMC65002');
     __next = 'end';
}","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9096","1932","Indosat Reload via Cipika With Location Validation for APP","if(empty(inServerName))
{
	notificationInfoList  = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
	NC.sendPreValidationNotification(notificationInfoList ,__params.Channel,101000000000001174,__params);
	__next = 'end';
}
else
{
if(empty(gpsPosition))
{
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
 __params.put('TransOutgoingRequest@LIST@Param.msisdn',amsisdn);
 AG.sendTransOutgoing(CurReq,__params,'71');
 __next = '2'; 
 }
else
{
OriginalReq.putValue4ReferenceData('GPSPosition',gpsPosition);
locationList = Util.getLocationXAndY(gpsPosition);
A_FactorX = locationList.get(1);
A_FactorY = locationList.get(0);
var resultADiscountMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysDiscountTerritoryType,'1','2',A_FactorX,A_FactorY);
var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1','2',A_FactorX,A_FactorY);
if(resultADiscountMap.ResultCode == 'SYS00000')
{
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Failed');  
}

if(resultACommissionMap.ResultCode == 'SYS00000')
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed');   
}


  if(spValue == '01' || spValue == '03')
    {
	   
       var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1','2',A_FactorX,A_FactorY);
          if(resultMap.ResultCode == 'SYS00000')
          {
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');    
              __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
              __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
             AG.sendTransOutgoing(CurReq,__params,'71');
             __next = '3';
          }
         else
         {				  
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
            OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		CurResp = TargetService.invokeForScript(); 

            __next = 'error';
         }
     }
	 else
	 {
   __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
              __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
             AG.sendTransOutgoing(CurReq,__params,'71');
	   __next = '3';
	 }
}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","3","9097","1932","Indosat Reload via Cipika With Location Validation for APP","A_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
A_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(A_FactorX) && !empty(A_FactorY))
  {
OriginalReq.putValue4ReferenceData('A#CellID',A_FactorX);
OriginalReq.putValue4ReferenceData('A#LAC',A_FactorY); 
var resultADiscountMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysDiscountTerritoryType,'1',A_FactorX,A_FactorY);
var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',A_FactorX,A_FactorY);
if(resultADiscountMap.ResultCode == 'SYS00000')
{
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Failed');  
}
if(resultACommissionMap.ResultCode == 'SYS00000')
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed');   
}

	  if(spValue == '01' || spValue == '03')
	  {

       var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',A_FactorX,A_FactorY);
        
       if(resultMap.ResultCode == 'SYS00000')
       {
           OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');   
		     __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
               __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
               AG.sendTransOutgoing(CurReq,__params,'71');
  
             __next = '3';
               
        }
        else
        {
		 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');   
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
           __next = 'error';
        }
        
        
		}else{
		
     OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
     __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
     AG.sendTransOutgoing(CurReq,__params,'71');
        __next = '3';
		}
     }
else
   {

   OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success'); 
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success');   
   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
    
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
     __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
     AG.sendTransOutgoing(CurReq,__params,'71');
        __next = '3';
   }","2","Verify Identity Territory Result","Verify Identity Territory Result",""<endrec>
"Pre-Validation","","4","9098","1932","Indosat Reload via Cipika With Location Validation for APP","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','1');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','EXT');        
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumber',subscriberNumber);
           __params.put('TransOutgoingRequest@LIST@Param.originTransactionID',__sessionId);
           __params.put('TransOutgoingRequest@LIST@Param.originHostName','SALDOMOBO');
           __params.put('TransOutgoingRequest@LIST@Param.originTimeStamp',Util.getISO8601CurrencyTime()); 
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumberNAI','1');
if(!empty(B_FactorX) && !empty(B_FactorY))
{ 
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorX);
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorY); 
var resultBDiscountMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysDiscountTerritoryType,'1',B_FactorX,B_FactorY);      
var resultBCommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',B_FactorX,B_FactorY); 
if(resultBDiscountMap.ResultCode == 'SYS00000')
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success');     
}
else

{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Failed');  
}
if(resultBCommissionMap.ResultCode == 'SYS00000')
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Failed');   
}     

        if(spValue == '02' || spValue == '03')
		{
       var resultMapB = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',B_FactorX,B_FactorY);      
        if(resultMapB.ResultCode == 'SYS00000')
        {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
       {
           __next = 'error';
        }     
else
       {
           OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
           CurResp = TargetService.invokeForScript(); 
           __next = 'end';
        }
        }
        else
       
        {
		OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'1');   

		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
         __next = 'error';
        }
        
     }else
	 {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
   {
    __next = 'error';
   }     
else
       {
           OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
           CurResp = TargetService.invokeForScript(); 
           __next = 'end';
     }
	 }
    }
    else
    {
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success');  
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success');  
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
   {
    __next = 'error';
   }     
else
   {
              OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
              CurResp = TargetService.invokeForScript(); 
              __next = 'end';
    }
    }","3","Verify Msisdn And Identity Territory Result","Verify Msisdn And Identity Territory Result",""<endrec>
"Pre-Validation","","6","9100","1932","Indosat Reload via Cipika With Location Validation for APP","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9101","1933","Indosat Reload via Cipika With Location Validation for SMS","subscriberNumber= TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.SubscriberNumber')); 
denominationCode= CurReq.getValueFromBody('TransactionRequest.DenominationCode'); 
inServerName = IC.queryINServerName(subscriberNumber,'');
initiator = CurReq.getIdentifierDef('Initiator');
shortCode= initiator.shortCode;
var dupKey='';
sysDiscountTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_DISCOUNT_LOCATION_VALIDATION');
sysCommissionTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_COMMISSION_LOCATION_VALIDATION');

dupKey = dupKey + subscriberNumber + denominationCode + shortCode;
resultCode = Util.checkDuplication(dupKey, 2);
if (resultCode == 'OK')
{
    serviceCode = CurReq.getRequest().header.serviceCode;
    __params.__sessionId= __sessionId;
    spList = IC.queryServiceProperties(serviceCode);
    spValue = ''; 
    for(sp:spList )
    {
        if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
       {
            spValue = sp.servicePropertyValue;
            break;
       }
    }
    
    
    receipts = IC.queryPreValidationNotification(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,0,null);
    amsisdn = receipts.get(0).recipients;
    CurReq.putToBodyForce('TransactionRequest.SubscriberNumber',subscriberNumber);

    CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SubscriberNumber',subscriberNumber);
    CurReq.putValue4ReferenceData(""MSISDN"",subscriberNumber);   
    CurReq.putValue4ReferenceData(""Denomination Code"",denominationCode);     
    
    territoryType = '2';
         
    A_FactorX = '';       
    A_FactorY = '';
    
    __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
    gpsPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
    __params.aLAC= CurReq.getValueFromBody('TransactionRequest.aLAC');
    __params.aCI= CurReq.getValueFromBody('TransactionRequest.aCI');
    
    __next = '1';
}
else
{
     __params.TransactionUMCPreValidationEvent='Pre-Validation';
     __params.TransactionUMCPreValidationError='A request is consecutively initiated multiple times in a short period of time.';
     duplicateErrorCode='UMC65002';
     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
     __errorCode=duplicateErrorCode;
     notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
     NC.sendPreValidationNotification(notificationInfoList ,duplicateErrorCode,__accessChannel,__params);
     resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode('UMC65002');
     __next = 'end';
}","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9102","1933","Indosat Reload via Cipika With Location Validation for SMS","if(empty(inServerName))
{
	notificationInfoList  = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
	NC.sendPreValidationNotification(notificationInfoList ,__params.Channel,101000000000001174,__params);
	__next = 'end';
}
else
{
if(empty(__params.aLAC) || empty(__params.aCI))
{
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
 __params.put('TransOutgoingRequest@LIST@Param.msisdn',amsisdn);
 __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
 AG.sendTransOutgoing(CurReq,__params,'71');
 __next = '2'; 
 }
else
{
OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
var resultADiscountMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysDiscountTerritoryType,'1',__params.aLAC,__params.aCI);
var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aLAC,__params.aCI);
if(resultADiscountMap.ResultCode == 'SYS00000')
{
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Failed');  
}

if(resultACommissionMap.ResultCode == 'SYS00000')
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed');   
}

  if(spValue == '01' || spValue == '03')
    {
	 
       var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
          if(resultMap.ResultCode == 'SYS00000')
          {
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');    
              __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
              __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
			   __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
             AG.sendTransOutgoing(CurReq,__params,'71');
             __next = '3';
          }
         else
         {				  
             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');

CurResp = TargetService.invokeForScript(); 
            __next = 'error';
         }
     }
	 else
	 {
   __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
              __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
			   __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
             AG.sendTransOutgoing(CurReq,__params,'71');
	   __next = '3';
	 }
}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","3","9103","1933","Indosat Reload via Cipika With Location Validation for SMS","A_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
A_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(A_FactorX) && !empty(A_FactorY))
  {
OriginalReq.putValue4ReferenceData('A#CellID',A_FactorX);
OriginalReq.putValue4ReferenceData('A#LAC',A_FactorY); 
var resultADiscountMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysDiscountTerritoryType,'1',A_FactorX,A_FactorY);
var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',A_FactorX,A_FactorY);
if(resultADiscountMap.ResultCode == 'SYS00000')
{
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Failed');  
}
if(resultACommissionMap.ResultCode == 'SYS00000')
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed');   
}

	  if(spValue == '01' || spValue == '03')
	  {

       var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',A_FactorX,A_FactorY);
        
       if(resultMap.ResultCode == 'SYS00000')
       {
           OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');   
		     __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
               __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
               AG.sendTransOutgoing(CurReq,__params,'71');
  
             __next = '3';
               
        }
        else
        {
		 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');   
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
           __next = 'error';
        }
        
        
		}else{
		
     OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
     __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
     AG.sendTransOutgoing(CurReq,__params,'71');
        __next = '3';
		}
     }
else
   {

   OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success'); 
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success');   
   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
    
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
     __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
     AG.sendTransOutgoing(CurReq,__params,'71');
        __next = '3';
   }","2","Verify Identity Territory Result","Verify Identity Territory Result",""<endrec>
"Pre-Validation","","4","9104","1933","Indosat Reload via Cipika With Location Validation for SMS","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','1');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','EXT');        
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumber',subscriberNumber);
           __params.put('TransOutgoingRequest@LIST@Param.originTransactionID',__sessionId);
           __params.put('TransOutgoingRequest@LIST@Param.originHostName','SALDOMOBO');
           __params.put('TransOutgoingRequest@LIST@Param.originTimeStamp',Util.getISO8601CurrencyTime()); 
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumberNAI','1');
if(!empty(B_FactorX) && !empty(B_FactorY))
{ 
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorX);
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorY); 
var resultBDiscountMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysDiscountTerritoryType,'1',B_FactorX,B_FactorY);      
var resultBCommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',B_FactorX,B_FactorY);    
if(resultBDiscountMap.ResultCode == 'SYS00000')
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success');     
}
else

{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Failed');  
}
if(resultBCommissionMap.ResultCode == 'SYS00000')
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Failed');   
}  


        if(spValue == '02' || spValue == '03')
		{
       var resultMapB = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',B_FactorX,B_FactorY);      
        if(resultMapB.ResultCode == 'SYS00000')
        {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
       {
           __next = 'error';
        }     
else
       {
           OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
           CurResp = TargetService.invokeForScript(); 
           __next = 'end';
        }
        }
        else
       
        {
		OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'1');   

		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
         __next = 'error';
        }
        
     }else
	 {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
   {
    __next = 'error';
   }     
else
       {
           OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
           CurResp = TargetService.invokeForScript(); 
           __next = 'end';
     }
	 }
    }
    else
    {
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success');  
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success');   
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
   {
    __next = 'error';
   }     
else


   {
            OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
            CurResp = TargetService.invokeForScript(); 
            __next = 'end';
    }
    }","3","Verify Msisdn And Identity Territory Result","Verify Msisdn And Identity Territory Result",""<endrec>
"Pre-Validation","","6","9106","1933","Indosat Reload via Cipika With Location Validation for SMS","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9107","1934","Indosat Reload via Cipika With Location Validation for USSD","subscriberNumber= TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.SubscriberNumber')); 
denominationCode= CurReq.getValueFromBody('TransactionRequest.DenominationCode'); 
initiator = CurReq.getIdentifierDef('Initiator');
shortCode= initiator.shortCode;
var dupKey='';
sysDiscountTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_DISCOUNT_LOCATION_VALIDATION');
sysCommissionTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_COMMISSION_LOCATION_VALIDATION');

dupKey = dupKey + subscriberNumber + denominationCode + shortCode;
resultCode = Util.checkDuplication(dupKey, 2);
if (resultCode == 'OK')
{
    serviceCode = CurReq.getRequest().header.serviceCode;
    __params.__sessionId= __sessionId;
    spList = IC.queryServiceProperties(serviceCode);
    spValue = ''; 
    for(sp:spList )
    {
        if(sp.servicePropertyCode == 'TERRITORY_CHECK_MODE')
       {
            spValue = sp.servicePropertyValue;
            break;
       }
    }
    
    
    receipts = IC.queryPreValidationNotification(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,0,null);
    amsisdn = receipts.get(0).recipients;
    CurReq.putToBodyForce('TransactionRequest.SubscriberNumber',subscriberNumber);
    CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SubscriberNumber',subscriberNumber);

    CurReq.putValue4ReferenceData(""MSISDN"",subscriberNumber);   
    CurReq.putValue4ReferenceData(""Denomination Code"",denominationCode);     
    
    territoryType = '2';
         
    A_FactorX = '';       
    A_FactorY = '';
    
    __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
    gpsPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
    __params.aLAC= CurReq.getValueFromBody('TransactionRequest.aLAC');
    __params.aCI= CurReq.getValueFromBody('TransactionRequest.aCI');
    
    __next = '1';
}
else
{
     __params.TransactionUMCPreValidationEvent='Pre-Validation';
     __params.TransactionUMCPreValidationError='A request is consecutively initiated multiple times in a short period of time.';
     duplicateErrorCode='UMC65002';
     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
     __errorCode=duplicateErrorCode;
     notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
     NC.sendPreValidationNotification(notificationInfoList ,duplicateErrorCode,__accessChannel,__params);
     resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode('UMC65002');
     __next = 'end';
}","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9108","1934","Indosat Reload via Cipika With Location Validation for USSD","inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
{
	notificationInfoList  = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
	NC.sendPreValidationNotification(notificationInfoList ,__params.Channel,101000000000001174,__params);
	__next = 'end';
}
else
{
if(empty(__params.aLAC) || empty(__params.aCI))
{
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
 __params.put('TransOutgoingRequest@LIST@Param.msisdn',amsisdn);
 __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
 AG.sendTransOutgoing(CurReq,__params,'71');
 __next = '2'; 
 }
else
{
OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
var resultADiscountMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysDiscountTerritoryType,'1',__params.aLAC,__params.aCI);
var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aLAC,__params.aCI);
if(resultADiscountMap.ResultCode == 'SYS00000')
{
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success');     
}
else
{

	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Failed');  
}
if(resultACommissionMap.ResultCode == 'SYS00000')
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed');   
}

  if(spValue == '01' || spValue == '03')
    {
	 
       var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
          if(resultMap.ResultCode == 'SYS00000')
          {
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
              OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');    
              __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
              __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
			   __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
             AG.sendTransOutgoing(CurReq,__params,'71');
             __next = '3';
          }
         else
         {				  

             OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');    
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
            __next = 'error';
         }
     }
	 else
	 {
   __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
              __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
			   __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
             AG.sendTransOutgoing(CurReq,__params,'71');
	   __next = '3';
	 }
}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","3","9109","1934","Indosat Reload via Cipika With Location Validation for USSD","A_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
A_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(A_FactorX) && !empty(A_FactorY))
  {
OriginalReq.putValue4ReferenceData('A#CellID',A_FactorX);
OriginalReq.putValue4ReferenceData('A#LAC',A_FactorY); 
var resultADiscountMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysDiscountTerritoryType,'1',A_FactorX,A_FactorY);
var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',A_FactorX,A_FactorY);
if(resultADiscountMap.ResultCode == 'SYS00000')
{
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Failed');  
}
if(resultACommissionMap.ResultCode == 'SYS00000')
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed');   
}

	  if(spValue == '01' || spValue == '03')
	  {

       var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',A_FactorX,A_FactorY);
        
       if(resultMap.ResultCode == 'SYS00000')
       {
           OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
           OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'0');   
		     __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
               __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
               AG.sendTransOutgoing(CurReq,__params,'71');
  
             __next = '3';
               
        }
        else
        {
		 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'1');   
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
           __next = 'error';
        }
        
        
		}else{
		
     OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
     __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
     AG.sendTransOutgoing(CurReq,__params,'71');
        __next = '3';
		}
     }
else
   {

   OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success'); 
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success');   
   OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'-1');   
    
 __params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
     __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
     AG.sendTransOutgoing(CurReq,__params,'71');
        __next = '3';
   }","2","Verify Identity Territory Result","Verify Identity Territory Result",""<endrec>
"Pre-Validation","","4","9110","1934","Indosat Reload via Cipika With Location Validation for USSD","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','1');
           __params.put('TransOutgoingRequest@LIST@Param.originNodeType','EXT');        
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumber',subscriberNumber);
           __params.put('TransOutgoingRequest@LIST@Param.originTransactionID',__sessionId);
           __params.put('TransOutgoingRequest@LIST@Param.originHostName','SALDOMOBO');
           __params.put('TransOutgoingRequest@LIST@Param.originTimeStamp',Util.getISO8601CurrencyTime()); 
           __params.put('TransOutgoingRequest@LIST@Param.subscriberNumberNAI','1');
if(!empty(B_FactorX) && !empty(B_FactorY))
{ 
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorX);
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorY); 
var resultBDiscountMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysDiscountTerritoryType,'1',B_FactorX,B_FactorY);      
var resultBCommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',B_FactorX,B_FactorY);      
if(resultBDiscountMap.ResultCode == 'SYS00000')
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success');     
}
else

{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Failed');  
}
if(resultBCommissionMap.ResultCode == 'SYS00000')
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success');     
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Failed');   
}

        if(spValue == '02' || spValue == '03')
		{
       var resultMapB = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',B_FactorX,B_FactorY);      
        if(resultMapB.ResultCode == 'SYS00000')
        {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
       {
           __next = 'error';
        }     
else
       {
           OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
           CurResp = TargetService.invokeForScript(); 
           __next = 'end';
        }
        }
        else
       
        {
		OriginalReq.putValue4ReferenceData(""MSISDNTerritoryVerificationResult"",'1');   

		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
CurResp = TargetService.invokeForScript(); 
         __next = 'error';
        }
        
     }else
	 {
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
   {
    __next = 'error';
   }     
else
       {
           OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
           CurResp = TargetService.invokeForScript(); 
           __next = 'end';
     }
	 }
    }
    else
    {
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success');  
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success');  
      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
   {
    __next = 'error';
   }     
else


   {
            OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
            CurResp = TargetService.invokeForScript(); 
            __next = 'end';
    }
    }","3","Verify Msisdn And Identity Territory Result","Verify Msisdn And Identity Territory Result",""<endrec>
"Pre-Validation","","6","9112","1934","Indosat Reload via Cipika With Location Validation for USSD","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9113","1935","Indosat Reload via Cipika With Msisdn Status Validation via Web","subscriberNumber= TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.SubscriberNumber')); 
denominationCode= CurReq.getValueFromBody('TransactionRequest.DenominationCode');
initiator = CurReq.getIdentifierDef('Initiator');
shortCode= initiator.shortCode;
var dupKey='';

dupKey = dupKey + subscriberNumber + denominationCode + shortCode;
resultCode = Util.checkDuplication(dupKey, 2);
if (resultCode == 'OK')
{
     __next = '1';
     __params.__sessionId= __sessionId;
}
else
{
     __params.TransactionUMCPreValidationEvent='Pre-Validation';
     __params.TransactionUMCPreValidationError='A request is consecutively initiated multiple times in a short period of time.';
     duplicateErrorCode='UMC65002';
     __params.put('Common.Result.ErrorCode',duplicateErrorCode);
     __errorCode=duplicateErrorCode;
     resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode('UMC65002');
     header.setResultMessage('The request is consecutively initiated multiple times in a short period of time. Wait a while and initiate the request again.');
     __next = 'end';
}","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9114","1935","Indosat Reload via Cipika With Msisdn Status Validation via Web","inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
{
     resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode('UMC65002');
     header.setResultMessage('Can Not Matche Mno ServerName By Msisdn.');
     __next = 'end';
}
else
{
var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{

    CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
    __next = '4';
}
else
{
subscriberNumber= TC.convertMsisdn(CurReq.getValueFromBody('TransactionRequest.SubscriberNumber')); 
CurReq.putToBodyForce('TransactionRequest.SubscriberNumber',subscriberNumber);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SubscriberNumber',subscriberNumber);
denominationCode= CurReq.getValueFromBody('TransactionRequest.DenominationCode'); 
OriginalReq.putValue4ReferenceData(""MSISDN"",subscriberNumber);   
OriginalReq.putValue4ReferenceData(""Denomination Code"",denominationCode);  	
__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId);        
 __params.put('TransOutgoingRequest@LIST@Param.msisdn',subscriberNumber);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
 AG.sendTransOutgoing(CurReq,__params,'71');
__next = '2'; 
}
}","1","Get B Territory","Get B Territory",""<endrec>
"Pre-Validation","","3","9115","1935","Indosat Reload via Cipika With Msisdn Status Validation via Web","B_FactorX =  CurReq.getValueFromBody('TransactionEventRequest.LAC');
B_FactorY =  CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(B_FactorX) && !empty(B_FactorY))
{
OriginalReq.putValue4ReferenceData('B#LAC',B_FactorX);
OriginalReq.putValue4ReferenceData('B#CellID',B_FactorY);
}

      var inServerName = IC.queryINServerName(subscriberNumber,'');
if(empty(inServerName))
{
    __next = 'error';
}     
else
{
           OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ThirdPartyKey',inServerName);
           CurResp = TargetService.invokeForScript(); 
           __next = 'end';
}","2","Record B Territory","Record B Territory",""<endrec>
"Pre-Validation","","5","9117","1935","Indosat Reload via Cipika With Msisdn Status Validation via Web","CurResp = TargetService.invokeForScript(); 
__next = 'end';","4","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","6","9118","1935","Indosat Reload via Cipika With Msisdn Status Validation via Web","__next='end';","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9124","1937","Unlink NFC Tag","receiver= CurReq.getIdentifierDef('ReceiverParty'); 

__params.__sessionId=__sessionId;
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.Msisdn',receiver.Identifier);
__params.put('TransOutgoingRequest@LIST@Param.ussdContent','EnterPin');
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9125","1937","Unlink NFC Tag","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(empty(newPin))
 {
    __next = 'error';
 }
else
{
    OriginalReq.setParamValue4RequestHeaderParam('PIN',newPin);
  CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","2","Get Pin","Get Pin",""<endrec>
"Pre-Validation","","4","9126","1937","Unlink NFC Tag","receiver= CurReq.getIdentifierDef('ReceiverParty'); 
NC.sendNotification(receiver.Identifier,__locale,__accessChannel,208000000000001226,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9127","1937","Unlink NFC Tag","AG.sendTransOutgoing(CurReq,__params,'104');
__next = '2';","1","Push Session","Push Session",""<endrec>
"Pre-Validation","","1","9128","1938","Unlink NFC Tag For Web","receiver= CurReq.getIdentifierDef('ReceiverParty'); 

__params.__sessionId=__sessionId;
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.Msisdn',receiver.Identifier);
__params.put('TransOutgoingRequest@LIST@Param.ussdContent','EnterPin');
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9129","1938","Unlink NFC Tag For Web","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(empty(newPin))
 {
    __next = 'error';
 }
else
{
    OriginalReq.setParamValue4RequestHeaderParam('NeedCheckReceiverPin','1');
   OriginalReq.setParamValue4RequestHeaderParam('ReceiverPin',newPin);
  CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","2","Get Pin","Get Pin",""<endrec>
"Pre-Validation","","4","9130","1938","Unlink NFC Tag For Web","receiver= CurReq.getIdentifierDef('ReceiverParty'); 
NC.sendNotification(receiver.Identifier,__locale,__accessChannel,208000000000001226,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9131","1938","Unlink NFC Tag For Web","AG.sendTransOutgoing(CurReq,__params,'104');
__next = '2';","1","Push Session","Push Session",""<endrec>
"Pre-Validation","","1","9132","1939","Link Identity Bank Account for HTTP","__params.Channel = __accessChannel;
 __next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9135","1939","Link Identity Bank Account for HTTP","receiverParty = CurReq.getIdentifierDef('ReceiverParty');
flag = Util.isMatchIdentity(receiverParty.IdentifierType ,'01');
if(flag)
{ 
 isNotExsited=IC.checkerCustomerExisted(receiverParty.Identifier);
 if(isNotExsited)
 {
    response=IC.registerRegCustomer(receiverParty.Identifier);
 if(""SYS00000"".equals(response.header.resultCode))
 {
    
var kycinfo = OriginalReq.getValueFromBody('CreateIdentityBankAccountRequest.kyc');
 if(empty(kycinfo))
{
     CurResp = TargetService.invokeForScript();
     __next = 'end'; 
}
else
{
       kycMap = Util.buildMap();
kycInfoMsg = Util.stringSplitToArray(kycinfo, '\\|');

kycMap.SingleKYC@RSB@Personal@@SPACE@@Details@RSB@First@@SPACE@@Name@RSB@=kycInfoMsg[0];
kycMap.SingleKYC@RSB@Address@@SPACE@@Details@RSB@Address@@SPACE@@Line@@SPACE@@1@RSB@=kycInfoMsg[1];
kycMap.SingleKYC@RSB@Address@@SPACE@@Details@RSB@City@RSB@=kycInfoMsg[2];
kycMap.MultiKYC@RSB@ID@@SPACE@@Details@RSB@ID@@SPACE@@Number@RSB@=kycInfoMsg[3];
kycMap.SingleKYC@RSB@Personal@@SPACE@@Details@RSB@Date@@SPACE@@of@@SPACE@@Birth@RSB@=kycInfoMsg[4];
kycMap.SingleKYC@RSB@Personal@@SPACE@@Details@RSB@Last@@SPACE@@Name@RSB@=kycInfoMsg[5];
kycMap.MultiKYC@RSB@ID@@SPACE@@Details@RSB@ID@@SPACE@@Type@RSB@=kycInfoMsg[6];

 response =IC.updateCustomerKyc( receiverParty.Identifier,kycMap);
 
 if(""SYS00000"".equals(response.header.resultCode))
 {

     CurResp = TargetService.invokeForScript();
__next = 'end'; 
 }
 else

 {
    resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode(response.header.resultCode);
     header.setResultMessage(response.header.resultMessage);
     __next = 'error';
 }
}
 }
 else
 {
    resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode(response.header.resultCode);
     header.setResultMessage(response.header.resultMessage);
     __next = 'error';
 }
 }
 else
 {  
var kycinfo = OriginalReq.getValueFromBody('CreateIdentityBankAccountRequest.kyc');
 if(empty(kycinfo))
{
     CurResp = TargetService.invokeForScript();
     __next = 'end'; 
}
else
{
       kycMap = Util.buildMap();
kycInfoMsg = Util.stringSplitToArray(kycinfo, '\\|');

kycMap.SingleKYC@RSB@Personal@@SPACE@@Details@RSB@First@@SPACE@@Name@RSB@=kycInfoMsg[0];
kycMap.SingleKYC@RSB@Address@@SPACE@@Details@RSB@Address@@SPACE@@Line@@SPACE@@1@RSB@=kycInfoMsg[1];
kycMap.SingleKYC@RSB@Address@@SPACE@@Details@RSB@City@RSB@=kycInfoMsg[2];
kycMap.MultiKYC@RSB@ID@@SPACE@@Details@RSB@ID@@SPACE@@Number@RSB@=kycInfoMsg[3];
kycMap.SingleKYC@RSB@Personal@@SPACE@@Details@RSB@Date@@SPACE@@of@@SPACE@@Birth@RSB@=kycInfoMsg[4];

kycMap.SingleKYC@RSB@Personal@@SPACE@@Details@RSB@Last@@SPACE@@Name@RSB@=kycInfoMsg[5];
kycMap.MultiKYC@RSB@ID@@SPACE@@Details@RSB@ID@@SPACE@@Type@RSB@=kycInfoMsg[6];

 response =IC.updateCustomerKyc( receiverParty.Identifier,kycMap);
 
 if(""SYS00000"".equals(response.header.resultCode))
 {
     CurResp = TargetService.invokeForScript();
__next = 'end'; 
 }
 else

 {
    resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode(response.header.resultCode);
     header.setResultMessage(response.header.resultMessage);
     __next = 'error';
 }
}
 }
}
else
{
CurResp = TargetService.invokeForScript();
__next = 'end'; 
}","1","Check Customer Exist","Create And Update Customer",""<endrec>
"Pre-Validation","","5","9136","1939","Link Identity Bank Account for HTTP","__next='end';","error","Execute while errors occur copy","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9137","1940","Link NFC Tag For Web","receiver= CurReq.getIdentifierDef('ReceiverParty'); 

__params.__sessionId=__sessionId;
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.Msisdn',receiver.Identifier);
__params.put('TransOutgoingRequest@LIST@Param.ussdContent','EnterPin');
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9138","1940","Link NFC Tag For Web","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(empty(newPin))
 {
    __next = 'error';
 }
else
{
    OriginalReq.setParamValue4RequestHeaderParam('NeedCheckReceiverPin','1');
   OriginalReq.setParamValue4RequestHeaderParam('ReceiverPin',newPin);
  CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","2","Get Pin","Get Pin",""<endrec>
"Pre-Validation","","2","9140","1940","Link NFC Tag For Web","AG.sendTransOutgoing(CurReq,__params,'104');
__next = '2';","1","Push Session","Push Session",""<endrec>
"Pre-Validation","","1","9141","1941","BuyGoods4Customer for SMS","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9142","1941","BuyGoods4Customer for SMS","initiator= CurReq.getIdentifierDef('Initiator'); 
receiver= CurReq.getIdentifierDef('ReceiverParty');
accessDevice = CurReq.getIdentifierDef('AccessDevice');
pin=CurReq.getValueFromBody('TransactionRequest.PIN');
if(!empty(pin) && !IC.verifyOrgOperatorPinAndStatus(accessDevice.Identifier,initiator,pin,'Active'))
{
	__next = 'error';
}
else
{
	if('03' eq  receiver.IdentifierType.toCode())
	{
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{
		__params.__sessionId=__sessionId;
		__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.Msisdn',initiator.Identifier);
		__params.put('TransOutgoingRequest@LIST@Param.ussdContent','EnterPin');
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
			
		AG.sendTransOutgoing(CurReq,__params,'104');
		__next = '2';
	}
}","1","USSD PUSH","USSD PUSH",""<endrec>
"Pre-Validation","","3","9143","1941","BuyGoods4Customer for SMS","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(!Util.equals(OriginalReq.getIdentifierDef('Initiator').Identifier,CurReq.getValueFromBody('TransactionEventRequest.msisdn')) || empty(newPin))
 {
    __next = 'error';
 }
else
{
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPin',newPin);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',newPin);

CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","2","GET PIN","GET PIN",""<endrec>
"Pre-Validation","","3","9144","1941","BuyGoods4Customer for SMS","notificationInfoList = IC.queryNotificationMsisdn(OriginalReq,'Initiator','500000000000010001');
__params.put('Common.Result.ErrorCode','TP40087');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001076,__params);","error","information","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9157","1944","Bill Payment By USSD","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9158","1944","Bill Payment By USSD","__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;
   
accessDevice = CurReq.getIdentifierDef('AccessDevice');
var bankCode = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCode');
var bankAccountNumber = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankAccountNumber');

__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);         
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','2001');
__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);

__params=TC.buildCashOutInquiryMessage(accessDevice.identifier,__sessionId,bankCode,bankAccountNumber,__params);
CurReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Settlement',__params.get('TransOutgoingRequest@LIST@Param.Settlement'));

AG.sendTransOutgoing(CurReq,__params,'105');
__next = '2';","1","Do Validate Bank Information","Do Validate Bank Information",""<endrec>
"Pre-Validation","","3","9159","1944","Bill Payment By USSD","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
	__params.__sessionId= __sessionId;
	__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);    
	accessDevice = CurReq.getIdentifierDef('AccessDevice');    
	__params.put('TransOutgoingRequest@LIST@Param.Msisdn',accessDevice.identifier);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','2001');

       var ussdContent = '';
       var customerName = CurReq.getValueFromBody('TransactionEventRequest.BankCustomerName');
	customerName=Util.subString(customerName ,46);
       OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCustomerName',customerName);
	var bankCode = OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankCode');
var bankAccountNumber = OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BankAccountNumber');
var amount= OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
var currency= OriginalReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
ussdContent = ussdContent + 'Bank Code Is:'+bankCode + ';Bank Account Number Is:' + bankAccountNumber  +';Customer Name Is:' + customerName + ';Amount Is:' + amount + ' ' + currency + '.Please Input Pin.';
	__params.put('TransOutgoingRequest@LIST@Param.ussdContent',ussdContent);
	 AG.sendTransOutgoing(CurReq,__params,'104');
	__next = '3';
}
else
{ 
	__next = 'error';
}","2","Validate Bank Information Result","Validate Bank Information Result",""<endrec>
"Pre-Validation","","4","9160","1944","Bill Payment By USSD","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
        var pin= CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
        var newPin = Util.convertMessageToObject(pin);
	if(!empty(newPin ))
	{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',newPin );
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.SessionId',__sessionId);
	CurResp = TargetService.invokeForScript(); 
	__next='end';
	}
}
else
{ 
  __next = 'error';
}","3","Record Customer PIN","Record Customer PIN",""<endrec>
"Pre-Validation","","5","9161","1944","Bill Payment By USSD","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
//NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","1","9176","1948","Airtime By USSD","initiator= CurReq.getIdentifierDef('Initiator'); 

__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.Msisdn',initiator.Identifier);
__params.put('TransOutgoingRequest@LIST@Param.ussdContent','EnterPin');
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','2001');

__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9177","1948","Airtime By USSD","AG.sendTransOutgoing(CurReq,__params,'104');
__next = '2';","1","Push Session","Push Session",""<endrec>
"Pre-Validation","","3","9178","1948","Airtime By USSD","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(empty(newPin))
 {
    __next = 'error';
 }
else
{
  OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',newPin);
  CurResp = TargetService.invokeForScript(); 
  __next = 'end';
}","2","Get Pin","Get Pin",""<endrec>
"Pre-Validation","","4","9179","1948","Airtime By USSD","receiver= CurReq.getIdentifierDef('ReceiverParty'); 
NC.sendNotification(receiver.Identifier,__locale,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9180","1949","Buy Data Package By USSD","initiator= CurReq.getIdentifierDef('Initiator'); 
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
packageCode = CurReq.getValueFromBody('TransactionRequest.PackageCode');
rechargeMSISDN = TC.convertMsisdn(initiator.Identifier); 
__params.__sessionId= __sessionId; 
__params.Channel = __accessChannel;
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.Msisdn',initiator.Identifier);
__params.put('TransOutgoingRequest@LIST@Param.ussdContent','EnterPin');
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','2001');

__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9181","1949","Buy Data Package By USSD","AG.sendTransOutgoing(CurReq,__params,'104');
__next = '2';","1","Push Session","Push Session",""<endrec>
"Pre-Validation","","3","9182","1949","Buy Data Package By USSD","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
if(empty(newPin))
{
  __next = 'error';
}
else
{
  var resultMap = IC.verifyIdentifierPinAndStatus(receiverParty,newPin,'',''); 
  if (resultMap.ResultCode == 'SYS00000')
  {
    __params.put('TransOutgoingRequest@LIST@Param.PackageCode',packageCode);
    __params.put('TransOutgoingRequest@LIST@Param.RechargeMSISDN',rechargeMSISDN );
    AG.sendTransOutgoing(CurReq,__params,'1');
    __next = '3';
  }
  else
  {
    __next='error';
  }
}","2","Get Pin And VerifyIdentifier","Get Pin And VerifyIdentifier",""<endrec>
"Pre-Validation","","5","9183","1949","Buy Data Package By USSD","NC.sendNotification(receiver.Identifier,__locale,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9184","1950","BuyGoods4Customer for USSD","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9185","1950","BuyGoods4Customer for USSD","initiator= CurReq.getIdentifierDef('Initiator'); 
receiver= CurReq.getIdentifierDef('ReceiverParty');
accessDevice = CurReq.getIdentifierDef('AccessDevice');
pin=CurReq.getValueFromBody('TransactionRequest.PIN');
if(!empty(pin) && !IC.verifyOrgOperatorPinAndStatus(accessDevice.Identifier,initiator,pin,'Active'))
{
	__next = 'error';
}
else
{
	if('03' eq  receiver.IdentifierType.toCode())
	{
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{
		__params.__sessionId=__sessionId;
		__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.Msisdn',initiator.Identifier);
		__params.put('TransOutgoingRequest@LIST@Param.ussdContent','EnterPin');
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
			
		AG.sendTransOutgoing(CurReq,__params,'104');
		__next = '2';
	}
}","1","USSD PUSH","USSD PUSH",""<endrec>
"Pre-Validation","","3","9186","1950","BuyGoods4Customer for USSD","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(empty(newPin))
 {
    __next = 'error';
 }
else
{
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPin',newPin);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',newPin);
CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","2","GET PIN","GET PIN",""<endrec>
"Pre-Validation","","3","9187","1950","BuyGoods4Customer for USSD","notificationInfoList = IC.queryNotificationMsisdn(OriginalReq,'AccessDevice','500000000000010001');
__params.put('Common.Result.ErrorCode','TP40087');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,102000000000000676,__params);","error","information","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9188","1951","PayBill4OrgOperator for USSD","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9189","1951","PayBill4OrgOperator for USSD","receiver= CurReq.getIdentifierDef('ReceiverParty'); 

if(receiver.IdentifierType == '01')
 {
__params.__sessionId=__sessionId;
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.Msisdn',receiver.Identifier);
__params.put('TransOutgoingRequest@LIST@Param.ussdContent','EnterPin');
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

AG.sendTransOutgoing(CurReq,__params,'104');
 }else
{
    __next = 'end';
}","1","USSD PUSH","USSD PUSH",""<endrec>
"Pre-Validation","","3","9190","1951","PayBill4OrgOperator for USSD","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(empty(newPin))
 {
    __next = 'error';
 }
else
{
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPin',newPin);
CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","2","GET PIN","GET PIN",""<endrec>
"Pre-Validation","","3","9191","1951","PayBill4OrgOperator for USSD","notificationInfoList = IC.queryNotificationMsisdn(OriginalReq,'receiver','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","information","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9192","1952","Link Identity Bank Account for WEB","__params.Channel = __accessChannel;
 __next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9193","1952","Link Identity Bank Account for WEB","receiverParty = CurReq.getIdentifierDef('ReceiverParty');
flag = Util.isMatchIdentity(receiverParty.IdentifierType ,'01');
if(flag)
{ 
 isNotExsited=IC.checkerCustomerExisted(receiverParty.Identifier);
 if(isNotExsited)
 {
    response=IC.registerRegCustomer(receiverParty.Identifier);
 if(""SYS00000"".equals(response.header.resultCode))
 {
    
var kycinfo = OriginalReq.getValueFromBody('CreateIdentityBankAccountRequest.kyc');
 if(empty(kycinfo))
{
     CurResp = TargetService.invokeForScript();
     __next = 'end'; 
}
else
{
       kycMap = Util.buildMap();
kycInfoMsg = Util.stringSplitToArray(kycinfo, '\\|');

kycMap.SingleKYC@RSB@Personal@@SPACE@@Details@RSB@First@@SPACE@@Name@RSB@=kycInfoMsg[0];
kycMap.SingleKYC@RSB@Address@@SPACE@@Details@RSB@Address@@SPACE@@Line@@SPACE@@1@RSB@=kycInfoMsg[1];
kycMap.SingleKYC@RSB@Address@@SPACE@@Details@RSB@City@RSB@=kycInfoMsg[2];
kycMap.MultiKYC@RSB@ID@@SPACE@@Details@RSB@ID@@SPACE@@Number@RSB@=kycInfoMsg[3];
kycMap.SingleKYC@RSB@Personal@@SPACE@@Details@RSB@Date@@SPACE@@of@@SPACE@@Birth@RSB@=kycInfoMsg[4];
kycMap.SingleKYC@RSB@Personal@@SPACE@@Details@RSB@Last@@SPACE@@Name@RSB@=kycInfoMsg[5];
kycMap.MultiKYC@RSB@ID@@SPACE@@Details@RSB@ID@@SPACE@@Type@RSB@=kycInfoMsg[6];

 response =IC.updateCustomerKyc( receiverParty.Identifier,kycMap);
 
 if(""SYS00000"".equals(response.header.resultCode))
 {

     CurResp = TargetService.invokeForScript();
__next = 'end'; 
 }
 else

 {
    resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode(response.header.resultCode);
     header.setResultMessage(response.header.resultMessage);
     __next = 'error';
 }
}
 }
 else
 {
    resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode(response.header.resultCode);
     header.setResultMessage(response.header.resultMessage);
     __next = 'error';
 }
 }
 else
 {  
var kycinfo = OriginalReq.getValueFromBody('CreateIdentityBankAccountRequest.kyc');
 if(empty(kycinfo))
{
     CurResp = TargetService.invokeForScript();
     __next = 'end'; 
}
else
{
       kycMap = Util.buildMap();
kycInfoMsg = Util.stringSplitToArray(kycinfo, '\\|');

kycMap.SingleKYC@RSB@Personal@@SPACE@@Details@RSB@First@@SPACE@@Name@RSB@=kycInfoMsg[0];
kycMap.SingleKYC@RSB@Address@@SPACE@@Details@RSB@Address@@SPACE@@Line@@SPACE@@1@RSB@=kycInfoMsg[1];
kycMap.SingleKYC@RSB@Address@@SPACE@@Details@RSB@City@RSB@=kycInfoMsg[2];
kycMap.MultiKYC@RSB@ID@@SPACE@@Details@RSB@ID@@SPACE@@Number@RSB@=kycInfoMsg[3];
kycMap.SingleKYC@RSB@Personal@@SPACE@@Details@RSB@Date@@SPACE@@of@@SPACE@@Birth@RSB@=kycInfoMsg[4];

kycMap.SingleKYC@RSB@Personal@@SPACE@@Details@RSB@Last@@SPACE@@Name@RSB@=kycInfoMsg[5];
kycMap.MultiKYC@RSB@ID@@SPACE@@Details@RSB@ID@@SPACE@@Type@RSB@=kycInfoMsg[6];

 response =IC.updateCustomerKyc( receiverParty.Identifier,kycMap);
 
 if(""SYS00000"".equals(response.header.resultCode))
 {
     CurResp = TargetService.invokeForScript();
__next = 'end'; 
 }
 else

 {
    resp=CurResp.getResponse();
     header=resp.getHeader();
     header.setResultCode(response.header.resultCode);
     header.setResultMessage(response.header.resultMessage);
     __next = 'error';
 }
}
 }
}
else
{
CurResp = TargetService.invokeForScript();
__next = 'end'; 
}","1","Check Customer Exist","Create And Update Customer",""<endrec>
"Pre-Validation","","5","9194","1952","Link Identity Bank Account for WEB","__next='end';","error","Execute while errors occur copy","Execute while errors occur",""<endrec>
"CUSTOMER","","10","9195","1563","Create Direct Debit Mandate by Customer","var input = __input.response;
if (!empty(input) && !Validator.isDate(input, 'ddMMyyyy')){
__next = '9';
} else {
    __params.ExpiryDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '10';
}","9","Enter Expiry Date","<html>
<body>
Enter Expiry Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","11","9196","1567","Create Direct Debit Mandate by Group","var input = __input.response;
if (!empty(input) && !Validator.isDate(input, 'ddMMyyyy')){
__next = '10';
} else {
    __params.ExpiryDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '12';
}","11","Enter Expiry Date","<html>
<body>
Enter Expiry Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","11","9197","1568","Create Direct Debit Mandate by Organization","var input = __input.response;
if (!empty(input) && !Validator.isDate(input, 'ddMMyyyy')){
__next = '10';
} else {
    __params.ExpiryDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '11';
}","10","Enter Expiry Date","<html>
<body>
Enter Expiry Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","9","9199","1671","Org Edit Direct Debit Mandate By Payee","var input = __input.response;
if (!empty(input) && !Validator.isDate(input, 'ddMMyyyy')){
__next = '8';
} else {
    __params.ExpiryDate = IC.convertor2DefaultDateFormat(input, 'ddMMyyyy');
    __next = '9';
}","8","Enter Expiry Date","<html>
<body>
Enter Expiry Date(DDMMYYYY)<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","9200","1953","PayBillWithInquiry for SMS","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9201","1953","PayBillWithInquiry for SMS","__params.__sessionId=__sessionId;
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);         
__params.put('TransOutgoingRequest@LIST@Param.ShortCode',CurReq.getIdentifierDef('ReceiverParty').Identifier);
__params.put('TransOutgoingRequest@LIST@Param.Msisdn',CurReq.getIdentifierDef('Initiator').Identifier);
__params.put('TransOutgoingRequest@LIST@Param.CurrentTime',Util.getCurrentTime());

AG.sendTransOutgoing(CurReq,__params,'52');

__next='2';","1","Inquiry","Inquiry",""<endrec>
"Pre-Validation","","3","9202","1953","PayBillWithInquiry for SMS","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{
var BillContent = CurReq.getValueFromBody('TransactionEventRequest.BillContent');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BillContent',BillContent);

var Amount = CurReq.getValueFromBody('TransactionEventRequest.Amount');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount',Amount);

__params.__sessionId=__sessionId;
__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.Msisdn',OriginalReq.getIdentifierDef('Initiator').Identifier);
__params.put('TransOutgoingRequest@LIST@Param.ussdContent',BillContent);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');

AG.sendTransOutgoing(CurReq,__params,'104');

__next = '3';
}
else
{
__next = 'error';
}","2","Push","Push",""<endrec>
"Pre-Validation","","4","9203","1953","PayBillWithInquiry for SMS","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
if(!Util.equals(OriginalReq.getIdentifierDef('Initiator').Identifier,CurReq.getValueFromBody('TransactionEventRequest.msisdn')) || empty(newPin))
{
__next = 'error';
}
else
{
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PIN',newPin);
CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","3","Payment","Payment",""<endrec>
"Pre-Validation","","5","9204","1953","PayBillWithInquiry for SMS","notificationInfoList = IC.queryNotificationMsisdn(OriginalReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","information","Execute while errors occur",""<endrec>
"Pre-Validation","","4","9205","1949","Buy Data Package By USSD","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{
  __next = 'end';
}
else
{
  __next = 'error';
}","3","Get Response","Get Response",""<endrec>
"Pre-Validation","","1","9214","1956","BuyGoods4Operator USSD without voucher","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9215","1956","BuyGoods4Operator USSD without voucher","initiator= CurReq.getIdentifierDef('Initiator'); 
receiver= CurReq.getIdentifierDef('ReceiverParty');
accessDevice = CurReq.getIdentifierDef('AccessDevice');
pin=CurReq.getValueFromBody('TransactionRequest.PIN');
if(!IC.verifyOrgOperatorPinAndStatus(accessDevice.Identifier,initiator,pin,'Active'))
{
	__next = 'error';
}
else
{
	if('03' eq  receiver.IdentifierType.toCode())
	{
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{
		__params.__sessionId=__sessionId;
		__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.Msisdn',receiver.Identifier);
		__params.put('TransOutgoingRequest@LIST@Param.ussdContent','EnterPin');
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
			
		AG.sendTransOutgoing(CurReq,__params,'104');
		__next = '2';
	}
}","1","USSD PUSH","USSD PUSH",""<endrec>
"Pre-Validation","","3","9216","1956","BuyGoods4Operator USSD without voucher","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(!Util.equals(OriginalReq.getIdentifierDef('ReceiverParty').Identifier,CurReq.getValueFromBody('TransactionEventRequest.msisdn')) || empty(newPin))
 {
    __next = 'error';
 }
else
{
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPin',newPin);
CurResp = TargetService.invokeForScript(); 
__next = 'end';

}","2","GET PIN","GET PIN",""<endrec>
"Pre-Validation","","3","9217","1956","BuyGoods4Operator USSD without voucher","notificationInfoList = IC.queryNotificationMsisdn(OriginalReq,'AccessDevice','500000000000010001');
__params.put('Common.Result.ErrorCode','TP40087');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,102000000000000676,__params);","error","information","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9218","1957","BuyGoods4Operator SMS without voucher","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9219","1957","BuyGoods4Operator SMS without voucher","initiator= CurReq.getIdentifierDef('Initiator'); 
receiver= CurReq.getIdentifierDef('ReceiverParty');
accessDevice = CurReq.getIdentifierDef('AccessDevice');
pin=CurReq.getValueFromBody('TransactionRequest.PIN');
if(!IC.verifyOrgOperatorPinAndStatus(accessDevice.Identifier,initiator,pin,'Active'))
{
	__next = 'error';
}
else
{
	if('03' eq  receiver.IdentifierType.toCode())
	{
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{
		__params.__sessionId=__sessionId;
		__params.put('TransOutgoingRequest@LIST@Param.pushReferenceId',__sessionId);
		__params.put('TransOutgoingRequest@LIST@Param.Msisdn',receiver.Identifier);
		__params.put('TransOutgoingRequest@LIST@Param.ussdContent','EnterPin');
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
			
		AG.sendTransOutgoing(CurReq,__params,'104');
		__next = '2';
	}
}","1","USSD PUSH","USSD PUSH",""<endrec>
"Pre-Validation","","3","9220","1957","BuyGoods4Operator SMS without voucher","pin=  CurReq.getValueFromBody('TransactionEventRequest.ussdContent');
newPin = Util.convertMessageToObject(pin);
 if(!Util.equals(OriginalReq.getIdentifierDef('ReceiverParty').Identifier,CurReq.getValueFromBody('TransactionEventRequest.msisdn')) || empty(newPin))
 {
    __next = 'error';
 }
else
{
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPin',newPin);
CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","2","GET PIN","GET PIN",""<endrec>
"Pre-Validation","","3","9221","1957","BuyGoods4Operator SMS without voucher","notificationInfoList = IC.queryNotificationMsisdn(OriginalReq,'AccessDevice','500000000000010001');
__params.put('Common.Result.ErrorCode','TP40087');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,102000000000000676,__params);","error","information","Execute while errors occur",""<endrec>
"CUSTOMER","","1","9245","1963","Disable CNS","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'ChangeCustCNSKYCFlag';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__params.CNSInitiatorFlag='02';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","9252","1963","Disable CNS","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo =  IC.buildCustomerInfo(__params);
__next = '2';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","9253","1963","Disable CNS","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
You are going to disable customer name search feature.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","9254","1964","Enable CNS","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'ChangeCustCNSKYCFlag';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__params.CNSInitiatorFlag='01';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","9255","1964","Enable CNS","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo =  IC.buildCustomerInfo(__params);
__next = '2';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","9256","1964","Enable CNS","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
You are going to enable customer name search feature.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","9257","1965","Not allow My name be searched","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'ChangeCustCNSKYCFlag';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__params.CNSReceiverFlag='02';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","9258","1965","Not allow My name be searched","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo = IC.buildCustomerInfo(__params);
__next = '2';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","9259","1965","Not allow My name be searched","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
You are going to not allow your name searchable.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","9260","1966","Allow My name  be searched","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'ChangeCustCNSKYCFlag';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__params.CNSReceiverFlag='01';
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","9261","1966","Allow My name  be searched","var input = __input.response;
__params.@HEAD@PIN = input;
__params.KYCInfo =  IC.buildCustomerInfo(__params);
__next = '2';","1","Enter PIN","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","9262","1966","Allow My name  be searched","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
You are going to allow your name searchable.<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","9281","1971","Merchant Owner Deposit By WEB","__params.__sessionId= __sessionId;    
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.ReceiverPin','1234');
CurResp = TargetService.invokeForScript(); 
__next = 'end';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","9283","1971","Merchant Owner Deposit By WEB","__next = 'end';","error","Execute while errors occur","Execute while errors occur",""<endrec>
"CUSTOMER","","1","9291","1974","Return Main Menu","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__next = 'returnMainMenu';","begin","Initialization","",""<endrec>
"TILL","","1","9297","1975","Return Main Menu","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__next = 'returnMainMenu';","begin","set parammeters","",""<endrec>
"CUSTOMER","","1","9304","1976","Query Customer Coupons","__params.ActionType='QueryIdentityCouponList';
__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","9305","1976","Query Customer Coupons","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
 __params.@HEAD@PIN = input;
    __next = '2';
} else {
    __secure = true;
    __next = '1';
}","1","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","9306","1976","Query Customer Coupons","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","9307","1977","Query Customer Promotions","__params.ActionType='QueryIdentityPromotionList';
__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.ReceiverPartyIdentifierType= '01'; /* MSISDN */
__params.ReceiverPartyIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"CUSTOMER","","2","9308","1977","Query Customer Promotions","var input = __input.response;
if (!empty(input) && Validator.isDigit(input,4,6)) {
 __params.@HEAD@PIN = input;
    __next = '2';
} else {
    __secure = true;
    __next = '1';
}","1","Enter pin","<html>
<body>
Enter pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","9309","1977","Query Customer Promotions","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html>
<body>
Confirm to query?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","9310","1978","Buy Goods Using Special Price for HTTP","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
initiator= CurReq.getIdentifierDef('Initiator');
primaryParty= CurReq.getIdentifierDef('PrimaryParty');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9311","1978","Buy Goods Using Special Price for HTTP","__params.ReceiverPartyIdentifierType= receiverParty.IdentifierType.toCode(); 
__params.ReceiverPartyIdentifier= receiverParty.Identifier; 
__params.InitiatedTime=CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatedTime');
__params.PromotionId=CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PromotionId');
__params.Currency=CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
__params.PrimaryIdentityfier=primaryParty.Identifier;
__params.PrimaryIdentifierType=primaryParty.IdentifierType.toCode();
var promotion=IC.querySpecialPriceFromPromotion(__params);
CurReq.putValue4ReferenceData('PromotionId',__params.PromotionId);
if(empty(promotion) || empty(promotion.specialPrice))
{
resp=CurResp.getResponse();
header=resp.getHeader();
header.setResultCode('UMC65002');
header.setResultMessage('The customer has no permission to do transaction with special price.');
__next = 'error';
}
else
{
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount',promotion.specialPrice);
var primaryPin=CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PrimaryPin');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PrimaryPIN',primaryPin);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.IsTransAmountZero','true');
CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","1","query special price from promotion","query special price from promotion and ussd pusd to get pin",""<endrec>
"Pre-Validation","","3","9313","1978","Buy Goods Using Special Price for HTTP","","error","information","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9326","1982","Buy Goods Using Special Price Next Time for HTTP","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
initiator= CurReq.getIdentifierDef('Initiator');
primaryParty= CurReq.getIdentifierDef('PrimaryParty');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9327","1982","Buy Goods Using Special Price Next Time for HTTP","__params.ReceiverPartyIdentifierType= receiverParty.IdentifierType.toCode(); 
__params.ReceiverPartyIdentifier= receiverParty.Identifier; 
__params.InitiatedTime=CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatedTime');
__params.PromotionId=CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.CouponId');
__params.Currency=CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
__params.PrimaryIdentityfier=primaryParty.Identifier;
__params.PrimaryIdentifierType=primaryParty.IdentifierType.toCode();
var promotion=IC.querySpecialPriceFromPromotion(__params);
CurReq.putValue4ReferenceData('CouponId',__params.PromotionId);
if(empty(promotion) || empty(promotion.specialPrice))
{
resp=CurResp.getResponse();
header=resp.getHeader();
header.setResultCode('UMC65002');
header.setResultMessage('The customer has no permission to do transaction with special price.');
__next = 'error';
}
else
{
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount',promotion.specialPrice);
var primaryPin=CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PrimaryPin');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.PrimaryPIN',primaryPin);
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.IsTransAmountZero','true');
CurResp = TargetService.invokeForScript(); 
__next = 'end';
}","1","query special price from promotion","query special price from promotion and ussd pusd to get pin",""<endrec>
"Pre-Validation","","3","9328","1982","Buy Goods Using Special Price Next Time for HTTP","","error","information","Execute while errors occur",""<endrec>
"Pre-Validation","","1","9368","1992","Withdraw At Agent With Prevalidation for API","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","9369","1992","Withdraw At Agent With Prevalidation for API","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","3","9371","1992","Withdraw At Agent With Prevalidation for API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if (confirmedOrNot)
{  
     __params.put('ResultType','0');
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.ResultCode='0';
	__params.ResultMsg ='You confirm initiate transaction!';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{
	IC.cnsCancelationProcess(CurReq.getIdentifierDef('Initiator'));
	__params.ResultCode='1';
        __params.errDesc='Pre-Validation Result is Rejected.';
	__params.Reason='Pre-Validation Result is Rejected.';
	__params.TransactionUMCPreValidationError ='You rejected initiate transaction!';
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","9376","1994","Withdraw At Agent With Prevalidation for WEB","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9378","1994","Withdraw At Agent With Prevalidation for WEB","var resultType =   CurReq.getValueFromBody('TransactionEventRequest.ResultType');
__params.put('ResultType',resultType);
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

if (resultType == '0')
{ 
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	__params.put('Common.Result.ErrorCode','TS28009');
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
	
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
TC.savingPreValidationEventLog(__params);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","9379","1995","Cusotmer Buy Goods With Prevalidation for API","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","9380","1995","Cusotmer Buy Goods With Prevalidation for API","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","3","9382","1995","Cusotmer Buy Goods With Prevalidation for API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if (confirmedOrNot)
{  
     __params.put('ResultType','0');
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.ResultCode='0';
	__params.ResultMsg ='You confirm initiate transaction!';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{
	IC.cnsCancelationProcess(CurReq.getIdentifierDef('Initiator'));
	__params.ResultCode='1';
        __params.errDesc='Pre-Validation Result is Rejected.';
	__params.Reason='Pre-Validation Result is Rejected.';
	__params.TransactionUMCPreValidationError ='You rejected initiate transaction!';
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","9383","1996","Cusotmer Buy Goods With Prevalidation for STK","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","9384","1996","Cusotmer Buy Goods With Prevalidation for STK","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","3","9386","1996","Cusotmer Buy Goods With Prevalidation for STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if (confirmedOrNot)
{ 
 __params.put('ResultType','0');
__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
CurResp = TargetService.invokeForScript(); 
TC.savingPreValidationEventLog(__params);
__next='end';
}
else
{ 
 var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
 if(resultType == '2' || resultType == '3')
 {
 __params.errDesc='Pre-Validation Result is Rejected.';
__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
}
 else if(resultType == '4')
 {
 __params.errDesc='Pre-Validation confirmation is Timeout.';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
 }
 else
 {
__params.errDesc=""Pre-Validation Request Failed."";
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
 } 
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
TC.savingPreValidationEventLog(__params);
  __next='cancel';
 }","2","Pre-Validataion Result","Pre-Validataion Result",""<endrec>
"Pre-Validation","","1","9387","1997","Cusotmer Buy Goods With Prevalidation for WEB","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9389","1997","Cusotmer Buy Goods With Prevalidation for WEB","var resultType =   CurReq.getValueFromBody('TransactionEventRequest.ResultType');
__params.put('ResultType',resultType);
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

if (resultType == '0')
{ 
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	__params.put('Common.Result.ErrorCode','TS28009');
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
	
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
TC.savingPreValidationEventLog(__params);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","9394","1999","Send Money_USSD Push POC","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
initiator= CurReq.getIdentifierDef('Initiator'); 
__params.__sessionId= __sessionId; 
__params.put('TransOutgoingRequest@LIST@Param.sessionid',__sessionId);
__params.put('TransOutgoingRequest@LIST@Param.msisdn',initiator.Identifier);
__params.put('TransOutgoingRequest@LIST@Param.message','EnterPin');
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','808090');
DEBUG.error('test');
__next = '3';","begin","set parammeters","",""<endrec>
"Pre-Validation","","5","9395","1999","Send Money_USSD Push POC","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","3","9396","1999","Send Money_USSD Push POC","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;
if(budgetMap.isError == '1')
{
 __params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
  __params.ResultMsg = '';
  var tips = '';
  tips = tips+'You will send ' ;
  var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
  tips = tips + IC.formatAmount(currency, amount);
  
  tips = tips+' to ';
  
  var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
  __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);


var maskname=  IC.maskIdentityName(empty(cust.firstName) ? '' : cust.firstName, empty(cust.middleName) ? '' : (' ' + cust.middleName), empty(cust.lastName) ? '' : (' ' + cust.lastName));
  
  tips = tips + 'Customer ' +maskname;
  tips = tips + ', Phone number ';

  tips = tips + cust.basicIdentifier;
  
  tips = tips +'.	Charge for this transaction is:\n ';

  __params.ResultMsg = __params.ResultMsg + tips ;
 
  feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
  for(fee:feeList)
  {
  
   __params.ResultMsg =__params.ResultMsg + ':The amount of charge is '+fee.amount;
   
   if(i < sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;
   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  __params.ResultMsg != '')
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
    __params.ResultMsg =__params.ResultMsg + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
   i = i+1;
  }
  if( __params.ResultMsg == '')
   {
     __params.ResultMsg =' No charge.';

   }

 
 else
  {
    __params.ResultMsg =__params.ResultMsg +'.';
  }  
 __next = '2';
}
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);
}
else
{

  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","4","9397","1999","Send Money_USSD Push POC","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if (confirmedOrNot)
{  
     __params.put('ResultType','0');
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.ResultCode='0';
	__params.ResultMsg ='You confirm initiate transaction!';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{
	IC.cnsCancelationProcess(CurReq.getIdentifierDef('Initiator'));
	__params.ResultCode='1';
        __params.errDesc='Pre-Validation Result is Rejected.';
	__params.Reason='Pre-Validation Result is Rejected.';
	__params.TransactionUMCPreValidationError ='You rejected initiate transaction!';
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","9398","2000","Send Money With Prevalidation for STK","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","9399","2000","Send Money With Prevalidation for STK","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","3","9401","2000","Send Money With Prevalidation for STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
	__params.Reason=""Continue Pre-Validation Transaction."";
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
	IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
 }
TC.savingPreValidationEventLog(__params);","2","Pre-Validataion Result","Pre-Validataion Result",""<endrec>
"Pre-Validation","","1","9402","2001","Send Money With Prevalidation for WEB","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9403","2001","Send Money With Prevalidation for WEB","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId,__params);

	if(__params.get('BudgetResult') == '0')
	{
		var tips = '';
		tips = tips+'You will send ' ;
		var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
		var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
		tips = tips + IC.formatAmount(currency, amount);
	  
		tips = tips+' to ';
	  
		var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
		__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
		__params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
		var maskname=  IC.maskIdentityName(empty(cust.firstName) ? '' : cust.firstName, empty(cust.middleName) ? '' : (' ' + cust.middleName), empty(cust.lastName) ? '' : (' ' + cust.lastName));
	  
		tips = tips + 'Customer ' +maskname;
		tips = tips + ', Phone number ';
		tips = tips + cust.basicIdentifier;
	  
		tips = tips +'. ';

		CurResp.putToBody('CalculateFeeResponse.tips', tips);
	}
	__next = '2';
}
else
{
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","3","9404","2001","Send Money With Prevalidation for WEB","var resultType =   CurReq.getValueFromBody('TransactionEventRequest.ResultType');
__params.put('ResultType',resultType);
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

if (resultType == '0')
{ 
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	__params.put('Common.Result.ErrorCode','TS28009');
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
	
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
TC.savingPreValidationEventLog(__params);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","9405","2002","Customer Pay Bill With Prevalidation for API","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","9406","2002","Customer Pay Bill With Prevalidation for API","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","3","9408","2002","Customer Pay Bill With Prevalidation for API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if (confirmedOrNot)
{  
     __params.put('ResultType','0');
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.ResultCode='0';
	__params.ResultMsg ='You confirm initiate transaction!';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{
	IC.cnsCancelationProcess(CurReq.getIdentifierDef('Initiator'));
	__params.ResultCode='1';
        __params.errDesc='Pre-Validation Result is Rejected.';
	__params.Reason='Pre-Validation Result is Rejected.';
	__params.TransactionUMCPreValidationError ='You rejected initiate transaction!';
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","9409","2003","Customer Pay Bill With Prevalidation for STK","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","9410","2003","Customer Pay Bill With Prevalidation for STK","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","3","9412","2003","Customer Pay Bill With Prevalidation for STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
 __params.put('ResultType','0');
__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
CurResp = TargetService.invokeForScript(); 
TC.savingPreValidationEventLog(__params);
__next='end';
}
else
{ 
 var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
 if(resultType == '2' || resultType == '3')
 {
 __params.errDesc='Pre-Validation Result is Rejected.';
__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
}
 else if(resultType == '4')
 {
 __params.errDesc='Pre-Validation confirmation is Timeout.';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
 }
 else
 {
__params.errDesc=""Pre-Validation Request Failed."";
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
 } 
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
TC.savingPreValidationEventLog(__params);
  __next='cancel';
 }","2","Pre-Validataion Result","Pre-Validataion Result",""<endrec>
"Pre-Validation","","1","9413","2004","Customer Pay Bill With Prevalidation for WEB","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9415","2004","Customer Pay Bill With Prevalidation for WEB","var resultType =   CurReq.getValueFromBody('TransactionEventRequest.ResultType');
__params.put('ResultType',resultType);
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

if (resultType == '0')
{ 
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	__params.put('Common.Result.ErrorCode','TS28009');
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
	
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
TC.savingPreValidationEventLog(__params);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","9416","2005","Customer Buy Airtime  With Prevalidation for API","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","9417","2005","Customer Buy Airtime  With Prevalidation for API","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","3","9419","2005","Customer Buy Airtime  With Prevalidation for API","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.put('Common.Result.ErrorCode','TS28009');
if (confirmedOrNot)
{  
     __params.put('ResultType','0');
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.ResultCode='0';
	__params.ResultMsg ='You confirm initiate transaction!';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{
	IC.cnsCancelationProcess(CurReq.getIdentifierDef('Initiator'));
	__params.ResultCode='1';
        __params.errDesc='Pre-Validation Result is Rejected.';
	__params.Reason='Pre-Validation Result is Rejected.';
	__params.TransactionUMCPreValidationError ='You rejected initiate transaction!';
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
__params.EventType='PRE_VALIDATION';
TC.savingPreValidationEventLog(__params);
__params.UMC_SessionID=__sessionId;
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","1","9420","2006","Customer Buy Airtime  With Prevalidation for STK","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","9421","2006","Customer Buy Airtime  With Prevalidation for STK","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","3","9423","2006","Customer Buy Airtime  With Prevalidation for STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
__params.put('ResultType','0');
__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
CurResp = TargetService.invokeForScript(); 
TC.savingPreValidationEventLog(__params);
__next='end';
}
else
{ 
 var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
 if(resultType == '2' || resultType == '3')
 {
 __params.errDesc='Pre-Validation Result is Rejected.';
__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
}
 else if(resultType == '4')
 {
 __params.errDesc='Pre-Validation confirmation is Timeout.';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
 }
 else
 {
__params.errDesc=""Pre-Validation Request Failed."";
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
 } 
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
TC.savingPreValidationEventLog(__params);
  __next='cancel';
 }","2","Pre-Validataion Result","Pre-Validataion Result",""<endrec>
"Pre-Validation","","1","9428","2008","Customer Buy Airtime  With Prevalidation for WEB","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9430","2008","Customer Buy Airtime  With Prevalidation for WEB","var resultType =   CurReq.getValueFromBody('TransactionEventRequest.ResultType');
__params.put('ResultType',resultType);
__params.EventType='PRE_VALIDATION';
__params.TransactionUMCPreValidationEvent='Pre-Validation';

if (resultType == '0')
{ 
	__params.Reason='Continue Pre-Validation Transaction.';
	__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
	CurResp = TargetService.invokeForScript(); 
	__next='end';
}
else
{ 
	__params.put('Common.Result.ErrorCode','TS28009');
	if(resultType == '2' || resultType == '3')
	{
		__params.errDesc='Pre-Validation Result is Rejected.';
		__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
	}
	else if(resultType == '4')
	{
		__params.errDesc='Pre-Validation confirmation is Timeout.';
		__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
	}
	else
	{
		__params.errDesc=""Pre-Validation Request Failed."";
		__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
	}
	
	NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
	__next='cancel';
}
TC.savingPreValidationEventLog(__params);","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","2","9431","2000","Send Money With Prevalidation for STK","__params.Channel = __accessChannel;
var needDisplayFeeConfirmation=CurReq.hasValueInBody('TransactionRequest.RequestContext.Parameter.needDisplayFeeConfirmation', 'true');
if (needDisplayFeeConfirmation)
{
        TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
        budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
    __params.FeeInfo=budgetMap.FeeInfo;
    feeInfo=budgetMap.FeeInfo;
    if(budgetMap.isError == '1')
    {
        __params.errDesc=budgetMap.errorMsg;
        __params.TransactionUMCPreValidationError=budgetMap.errorMsg;
        __params.put('Common.Result.ErrorCode','TS28009');
        NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
        TC.savingPreValidationEventLog(__params);
        __next = 'end';
    }
    else
    {
        feeList = budgetMap.fee;
        i = 1;
        sizeLen = size(feeList);
        var promptText = '';
        promptText= promptText+'You will send ' ;
        var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
        var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
        promptText =  promptText + IC.formatAmount(currency, amount);
        promptText  = promptText +' to ';

        var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
        __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
        __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
        var maskname=  IC.maskIdentityName(empty(cust.firstName) ? '' : cust.firstName, empty(cust.middleName) ? '' : (' ' + cust.middleName), empty(cust.lastName) ? '' : (' ' + cust.lastName)) + ',';
        promptText = promptText + 'Customer ' +maskname;
        promptText = promptText + ', Phone number ';
        promptText = promptText + cust.basicIdentifier;
        promptText = promptText+'.  Charge for this transaction is:\n ';
        for(fee:feeList)
        {   
            promptText = promptText + ':The amount of charge is '+fee.amount;
 
                if(i < sizeLen)
                {
                    promptText = promptText + ',';
            }
            i = i+1 
        }
        taxList = budgetMap.tax;
        i = 1;

        sizeLen = size(taxList);
        for(tax:taxList)
        {
            if(i ==1 &&  promptText != '')
            {
                promptText = promptText + ',';
            }
            promptText = promptText + ':The amount of tax is '+tax.amount;
            if(i <sizeLen)
            {

                promptText = promptText + ',';
            } 
            i = i+1;
        }
        if( promptText == '')
        {
            promptText =' No charge.';
        } 
        else
        {
            promptText =promptText +'.';
        } 
        var promptText = promptText + '\n1. Yes\n2. No';

        __params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
        accessDevice = CurReq.getIdentifierDef('AccessDevice');
        __params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
        __params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
        AG.sendTransOutgoing(CurReq,__params,'19');
        __next = '2';
    }
}
else
{
    CurResp = TargetService.invokeForScript(); 
    __next='end';
}","1","Do Pre-Validation","Do Pre-Validation",""<endrec>
"Pre-Validation","","2","9432","1995","Cusotmer Buy Goods With Prevalidation for API","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;
if(budgetMap.isError == '1')
{
 __params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
  __params.ResultMsg = '';
  var tips = '';
  tips = tips+'You will pay ' ;
  var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
  tips = tips + IC.formatAmount(currency, amount);
  
  tips = tips+' to ';
  
  var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
   __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);

  var maskname=   (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty  (cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);
  
  tips = tips +maskname;
  tips = tips + ', Phone number ';
  tips = tips + cust.basicIdentifier;
  
  tips = tips +'.	Charge for this transaction is:\n ';

  __params.ResultMsg = __params.ResultMsg + tips ;
 
  feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
  for(fee:feeList)
  {
  
   __params.ResultMsg =__params.ResultMsg + ':The amount of charge is '+fee.amount;
   
   if(i < sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;
   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  __params.ResultMsg != '')
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
    __params.ResultMsg =__params.ResultMsg + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
   i = i+1;
  }
  if( __params.ResultMsg == '')
   {
     __params.ResultMsg =' No charge.';
   }
 
 else
  {

    __params.ResultMsg =__params.ResultMsg +'.';
  }  
 __next = '2';
}
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);
}
else
{
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","2","9434","1906","Customer Deposit Money With Prevalidation for STK","__params.Channel = __accessChannel;
var needDisplayFeeConfirmation=CurReq.hasValueInBody('TransactionRequest.RequestContext.Parameter.needDisplayFeeConfirmation', 'true');
if (needDisplayFeeConfirmation)
{
TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
feeInfo=budgetMap.FeeInfo;
if(budgetMap.isError == '1')
{
__params.errDesc=budgetMap.errorMsg;
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
 feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
   var promptText = '';
   promptText= promptText+'You will pay ' ;
   var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
   promptText =  promptText + IC.formatAmount(currency, amount);
   promptText  = promptText +'to';
var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);

 __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
 var maskname=IC.maskIdentityName( (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty  (cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName));

  promptText = promptText + 'Customer ' +maskname;
  promptText = promptText + ', Phone number ';
  promptText = promptText + cust.basicIdentifier;
  promptText = promptText+'.	Charge for this transaction is:\n ';
  for(fee:feeList)
  {   
   promptText = promptText + ':The amount of charge is '+fee.amount;
 
   if(i < sizeLen)
   {
    promptText = promptText + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;

   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  promptText != '')
   {
    promptText = promptText + ',';
   }
 
    promptText = promptText + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    promptText = promptText + ',';
   } 
   i = i+1;
  }
  if( promptText == '')
   {
     promptText =' No charge.';
   } 
 else
  {
    promptText =promptText +'.';
  } 
var promptText = promptText + '\n1. Yes\n2. No';

__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
accessDevice = CurReq.getIdentifierDef('AccessDevice');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
AG.sendTransOutgoing(CurReq,__params,'19');
__next = '2';
}
}
else
{
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Do Pre-Validation","Do Pre-Validation",""<endrec>
"Pre-Validation","","2","9435","1996","Cusotmer Buy Goods With Prevalidation for STK","__params.Channel = __accessChannel;
var needDisplayFeeConfirmation=CurReq.hasValueInBody('TransactionRequest.RequestContext.Parameter.needDisplayFeeConfirmation', 'true');
if (needDisplayFeeConfirmation)
{
TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
feeInfo=budgetMap.FeeInfo;
if(budgetMap.isError == '1')
{
__params.errDesc=budgetMap.errorMsg;
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);
TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
 feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
   var promptText = '';
   promptText= promptText+'You will pay ' ;
   var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
   promptText =  promptText + IC.formatAmount(currency, amount);
   promptText  = promptText +' to ';
var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);

 __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);

var maskname= (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty  (cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);

  promptText = promptText +maskname;
  promptText = promptText + ', Phone number ';
  promptText = promptText + cust.basicIdentifier;
  promptText = promptText+'.	Charge for this transaction is:\n ';
  for(fee:feeList)
  {   
   promptText = promptText + ':The amount of charge is '+fee.amount;
 
   if(i < sizeLen)
   {
    promptText = promptText + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;

   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  promptText != '')
   {
    promptText = promptText + ',';
   }
 
    promptText = promptText + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    promptText = promptText + ',';
   } 
   i = i+1;
  }
  if( promptText == '')
   {
     promptText =' No charge.';
   } 
 else
  {
    promptText =promptText +'.';
  } 
var promptText = promptText + '\n1. Yes\n2. No';


__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
accessDevice = CurReq.getIdentifierDef('AccessDevice');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
AG.sendTransOutgoing(CurReq,__params,'19');
__next = '2';
}
}
else
{
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Do Pre-Validation","Do Pre-Validation",""<endrec>
"Pre-Validation","","2","9436","1997","Cusotmer Buy Goods With Prevalidation for WEB","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId,__params);

	if(__params.get('BudgetResult') == '0')
	{
		 var tips = '';
		  tips = tips+'You will pay ' ;
		  var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
		  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
		  tips = tips + IC.formatAmount(currency, amount);
  
		  tips = tips+' to ';
  
		  var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
		  __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
		  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
		  var maskname=   (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty  (cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);
  
		  tips = tips  +maskname;
		  tips = tips + ', Phone number ';
		  tips = tips + cust.basicIdentifier;
  
		  tips = tips +'. ';
 

		CurResp.putToBody('CalculateFeeResponse.tips', tips);
	}
__next = '2';
}
else
{
CurResp = TargetService.invokeForScript(); 
__next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","2","9437","2005","Customer Buy Airtime  With Prevalidation for API","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;
if(budgetMap.isError == '1')
{
 __params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
  __params.ResultMsg = '';
  var tips = '';
  tips = tips+'You will Buy Airtime of  ' ;
  var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
  tips = tips + IC.formatAmount(currency, amount);
  
  tips = tips+' to ';
 
  var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
   __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);  

 var maskname=  (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty  (cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);
  
  tips = tips  +maskname;

  tips = tips + ', Phone number ';
  tips = tips + cust.basicIdentifier;
  
  tips = tips +'.	Charge for this transaction is:\n ';
  __params.ResultMsg = __params.ResultMsg + tips ;
 
  feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
  for(fee:feeList)
  {
  
   __params.ResultMsg =__params.ResultMsg + ':The amount of charge is '+fee.amount;
   
   if(i < sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;
   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  __params.ResultMsg != '')
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
    __params.ResultMsg =__params.ResultMsg + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
   i = i+1;
  }
  if( __params.ResultMsg == '')
   {
     __params.ResultMsg =' No charge.';
   }
 
 else
  {


    __params.ResultMsg =__params.ResultMsg +'.';
  }  

 __next = '2';
}
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);
}
else
{
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","2","9438","2006","Customer Buy Airtime  With Prevalidation for STK","__params.Channel = __accessChannel;
var needDisplayFeeConfirmation=CurReq.hasValueInBody('TransactionRequest.RequestContext.Parameter.needDisplayFeeConfirmation', 'true');
if (needDisplayFeeConfirmation)
{
TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
feeInfo=budgetMap.FeeInfo;
if(budgetMap.isError == '1')
{
__params.errDesc=budgetMap.errorMsg;
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
__params.put('Common.Result.ErrorCode','TS28009');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);
TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
 feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
   var promptText = '';
   promptText= promptText+'You will Buy Airtime of  ' ;
   var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
   promptText =  promptText + IC.formatAmount(currency, amount);
   promptText = promptText+' to ';

var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);

 __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
 var maskname=  (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty(cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);

  promptText = promptText +maskname;
  promptText = promptText + ', Phone number ';
  promptText = promptText + cust.basicIdentifier;
  promptText = promptText+'.	Charge for this transaction is:\n ';
  for(fee:feeList)
  {   
   promptText = promptText + ':The amount of charge is '+fee.amount;
 
   if(i < sizeLen)
   {
    promptText = promptText + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;

   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  promptText != '')
   {
    promptText = promptText + ',';
   }
 
    promptText = promptText  + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    promptText = promptText + ',';
   } 
   i = i+1;
  }
  if( promptText == '')
   {
     promptText =' No charge.';
   } 
 else
  {

    promptText =promptText +'.';
  } 
var promptText = promptText + '\n1. Yes\n2. No';

__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
accessDevice = CurReq.getIdentifierDef('AccessDevice');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
AG.sendTransOutgoing(CurReq,__params,'19');
__next = '2';
}
}
else
{
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Do Pre-Validation","Do Pre-Validation",""<endrec>
"Pre-Validation","","2","9439","2008","Customer Buy Airtime  With Prevalidation for WEB","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId,__params);

	if(__params.get('BudgetResult') == '0')
	{
		 var tips = '';
		  tips = tips+'You will Buy Airtime of  ' ;
		  var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
		  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
		  tips = tips + IC.formatAmount(currency, amount);
  
		  tips = tips+' to ';

		   var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty')); 
		  __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
		  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
		   var maskname=  (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty(cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);
  
		  tips = tips  +maskname;
  
 
		  tips = tips + ', Phone number ';
		  tips = tips + cust.basicIdentifier;
  
		  tips = tips +'. ';
 

		CurResp.putToBody('CalculateFeeResponse.tips', tips);
	}
__next = '2';
}
else
{
CurResp = TargetService.invokeForScript(); 
__next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","2","9440","2002","Customer Pay Bill With Prevalidation for API","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;
if(budgetMap.isError == '1')
{
 __params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
  __params.ResultMsg = '';
  var tips = '';
  tips = tips+'You will Pay Bill of  ' ;
  var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
  tips = tips + IC.formatAmount(currency, amount);
  
  tips = tips+' to ';
 
  var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
  __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);

 var maskname= (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty  (cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);
  
  tips = tips +maskname;

  tips = tips + ', Phone number ';
  tips = tips + cust.basicIdentifier;
  
  var billReferenceNumber = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BillReferenceNumber');
tips = tips + (empty(billReferenceNumber)?'':' with  bill reference number  '+billReferenceNumber);
  tips = tips +'.	Charge for this transaction is:\n ';
  __params.ResultMsg = __params.ResultMsg + tips ;
 
  feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
  for(fee:feeList)
  {
  
   __params.ResultMsg =__params.ResultMsg + ':The amount of charge is '+fee.amount;
   
   if(i < sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;
   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  __params.ResultMsg != '')
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
    __params.ResultMsg =__params.ResultMsg + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';

   } 
   i = i+1;
  }
  if( __params.ResultMsg == '')
   {
     __params.ResultMsg =' No charge.';
   }
 
 else
  {
 
    __params.ResultMsg =__params.ResultMsg +'.';
  }  

 __next = '2';
}
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);
}
else
{

  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","2","9441","2003","Customer Pay Bill With Prevalidation for STK","__params.Channel = __accessChannel;
var needDisplayFeeConfirmation=CurReq.hasValueInBody('TransactionRequest.RequestContext.Parameter.needDisplayFeeConfirmation', 'true');
if (needDisplayFeeConfirmation)
{
TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
feeInfo=budgetMap.FeeInfo;
if(budgetMap.isError == '1')
{
__params.errDesc=budgetMap.errorMsg;
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
 feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
   var promptText = '';
   promptText= promptText+'You will Pay Bill of   ' ;
   var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
   promptText =  promptText + IC.formatAmount(currency, amount);

   promptText = promptText+' to ';

var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);

 __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
 var maskname =(empty(cust.firstName)?'':cust.firstName) + ' ' + (empty  (cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);

  promptText = promptText +maskname;
  var billReferenceNumber = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BillReferenceNumber');
tips = tips + (empty(billReferenceNumber)?'':' with  bill reference number  '+billReferenceNumber);
  promptText = promptText + ', Phone number ';
  promptText = promptText + cust.basicIdentifier;
  promptText = promptText+'.	Charge for this transaction is:\n ';
  for(fee:feeList)
  {   
   promptText = promptText + ':The amount of charge is '+fee.amount;
 
   if(i < sizeLen)
   {
    promptText = promptText + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;

   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  promptText != '')
   {
    promptText = promptText + ',';
   }
 
    promptText = promptText + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    promptText = promptText + ',';
   } 
   i = i+1;
  }
  if( promptText == '')
   {
     promptText =' No charge.';

   } 
 else
  {

    promptText =promptText +'.';
  } 
var promptText = promptText + '\n1. Yes\n2. No';
__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);
accessDevice = CurReq.getIdentifierDef('AccessDevice');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
AG.sendTransOutgoing(CurReq,__params,'19');
__next = '2';
}
}
else
{
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Do Pre-Validation","Do Pre-Validation",""<endrec>
"Pre-Validation","","2","9442","2004","Customer Pay Bill With Prevalidation for WEB","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId,__params);

	if(__params.get('BudgetResult') == '0')
	{
		 var tips = '';
		  tips = tips+'You will Pay Bill of  ' ;
		  var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
		  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
		  tips = tips + IC.formatAmount(currency, amount);
  
		  tips = tips+' to ';
  
		  var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
		  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
		 __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus); 
		  var maskname=   (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty  (cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);
  
		  tips = tips  +maskname;
		   var billReferenceNumber = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.BillReferenceNumber');
		tips = tips + (empty(billReferenceNumber)?'':' with  bill reference number  '+billReferenceNumber);
		  tips = tips + ', Phone number ';
		  tips = tips + cust.basicIdentifier;
  

		  tips = tips +'.  ';

		CurResp.putToBody('CalculateFeeResponse.tips', tips);
	}
__next = '2';
}
else
{
CurResp = TargetService.invokeForScript(); 
__next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","2","9443","1992","Withdraw At Agent With Prevalidation for API","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
__params.ResultCode='0';
__params.ResultMsg = budgetMap.ResultMessage;
__params.UMC_SessionID=__sessionId;
if(budgetMap.isError == '1')
{
 __params.ResultCode='1';
  __params.EventType='PRE_VALIDATION';
  __params.errCode='2';
   __params.errDesc='Pre-Validation Request Failed.';
   __params.Reason='Failed';
  TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
  __params.ResultMsg = '';
  var tips = '';
  tips = tips+'You will withdraw ' ;
  var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
  tips = tips + IC.formatAmount(currency, amount);
  
  tips = tips+' from ';
  
  var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
  __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);

  var maskname= (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty(cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);
  
  tips = tips +maskname;
  tips = tips + ', Phone number ';
  tips = tips + cust.basicIdentifier;
  
  tips = tips +'.	Charge for this transaction is:\n ';

  __params.ResultMsg = __params.ResultMsg + tips ;
 
  feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
  for(fee:feeList)
  {
  
   __params.ResultMsg =__params.ResultMsg + ':The amount of charge is '+fee.amount;
   
   if(i < sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;
   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  __params.ResultMsg != '')
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
    __params.ResultMsg =__params.ResultMsg + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    __params.ResultMsg =__params.ResultMsg + ',';
   } 
   i = i+1;
  }
  if( __params.ResultMsg == '')
   {
     __params.ResultMsg =' No charge.';
   }
 
 else
  {

    __params.ResultMsg =__params.ResultMsg +'.';
  }  
 __next = '2';
}
AG.sendNotifyAPIResult(CurReq,__params,__sessionId,null);
}
else
{
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","2","9444","1994","Withdraw At Agent With Prevalidation for WEB","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId,__params);

if(__params.get('BudgetResult') == '0')
{
	 var tips = '';
	  tips = tips+'You will withdraw ' ;
	  var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
	  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
	  tips = tips + IC.formatAmount(currency, amount);
  
	  tips = tips+' from ';
  
	  var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
	  __params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
	  __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);
	  var maskname=   (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty  (cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);
  
	  tips = tips +maskname;
	  tips = tips + ', Phone number ';
	  tips = tips + cust.basicIdentifier;
  
	  tips = tips +'. ';

	CurResp.putToBody('CalculateFeeResponse.tips', tips);
}
__next = '2';
}
else
{
CurResp = TargetService.invokeForScript(); 
__next='end';
}","1","Query Charge Fee","Query Charge Fee",""<endrec>
"Pre-Validation","","4","9468","2001","Send Money With Prevalidation for WEB","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","4","9469","1997","Cusotmer Buy Goods With Prevalidation for WEB","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","4","9471","2008","Customer Buy Airtime  With Prevalidation for WEB","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","4","9473","2004","Customer Pay Bill With Prevalidation for WEB","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc =""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","4","9474","1994","Withdraw At Agent With Prevalidation for WEB","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","4","9475","1903","OTC Pay Bill With Prevalidation for WEB","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc=""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","1","9481","2016","Withdraw At Agent With Prevalidation for STK","__params.Channel = __accessChannel;
__params.TransactionUMCPreValidationEvent='Pre-Validation';
__params.EventType='PRE_VALIDATION';
__params.put('Common.Result.ErrorCode','TS28009');
notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","9482","2016","Withdraw At Agent With Prevalidation for STK","if(__errorCode == 'UMC64000')
{
var policy=TC.getConfirmExpirePolicy();
__params.put('ExpiredPolicy',policy);
if('3' == policy)
{
__params.errDesc =""Continue Pre-Validation Transaction"";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction';
CurResp = TargetService.invokeForScript();
}
else
{
if('2' == policy)
{
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
__params.errDesc='Pre-Validation Result is Rejected';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
} 
else
{
__params.errDesc='Pre-Validation confirmation is Timeout';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout';
}
}
}
else
{
__params.errDesc='Pre-Validation Request Failed';
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed';
}
if('3' != __params.get('ExpiredPolicy'))
{
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
}
TC.savingPreValidationEventLog(__params);","error","Execute while errors occur","error occurs.",""<endrec>
"Pre-Validation","","3","9483","2016","Withdraw At Agent With Prevalidation for STK","var confirmedOrNot=CurReq.hasValueInBody('TransactionEventRequest.IsSuccess', 'true');
if (confirmedOrNot)
{ 
__params.put('ResultType','0');
__params.Reason=""Continue Pre-Validation Transaction."";
__params.TransactionUMCPreValidationError='Continue Pre-Validation Transaction.';
CurResp = TargetService.invokeForScript(); 
TC.savingPreValidationEventLog(__params);
__next='end';
}
else
{ 
 var resultType = CurReq.getValueFromBody('TransactionEventRequest.Parameters.Parameter.ResultType');
 if(resultType == '2' || resultType == '3')
 {
 __params.errDesc='Pre-Validation Result is Rejected.';
__params.TransactionUMCPreValidationError='Pre-Validation Result is Rejected.';
}
 else if(resultType == '4')
 {
 __params.errDesc='Pre-Validation confirmation is Timeout.';
__params.TransactionUMCPreValidationError='Pre-Validation confirmation is Timeout.';
 }
 else
 {
__params.errDesc=""Pre-Validation Request Failed."";
__params.TransactionUMCPreValidationError='Pre-Validation Request Failed.';
 } 
IC.cnsCancelationProcess(OriginalReq.getIdentifierDef('Initiator'));
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
TC.savingPreValidationEventLog(__params);
  __next='cancel';
 }","2","Pre-Validataion Result","Pre-Validataion Result",""<endrec>
"Pre-Validation","","2","9484","2016","Withdraw At Agent With Prevalidation for STK","__params.Channel = __accessChannel;
var needDisplayFeeConfirmation=CurReq.hasValueInBody('TransactionRequest.RequestContext.Parameter.needDisplayFeeConfirmation', 'true');
if (needDisplayFeeConfirmation)
{
TC.buildPreValidationParams4CalculateFee(CurReq,__params,__sessionId);
budgetMap=TC.calculatePreValidationFee(CurReq,__params,__sessionId);
__params.FeeInfo=budgetMap.FeeInfo;
feeInfo=budgetMap.FeeInfo;
if(budgetMap.isError == '1')
{
__params.errDesc=budgetMap.errorMsg;
__params.TransactionUMCPreValidationError=budgetMap.errorMsg;
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,208000000000053238,__params);
TC.savingPreValidationEventLog(__params);
 __next = 'end';
}
else
{
 feeList = budgetMap.fee;
   i = 1;
   sizeLen = size(feeList);
   var promptText = '';
   promptText= promptText+'You will withdraw ' ;
   var currency = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Currency');
  var amount = CurReq.getValueFromBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.Amount');
   promptText =  promptText + IC.formatAmount(currency, amount);
   promptText  = promptText +' from ';
var cust = IC.queryIdentityName(CurReq.getIdentifierDef('Initiator'),CurReq.getIdentifierDef('ReceiverParty'));
__params.put('InitiatorCNSStatus',cust.initiatorCNSStatus);
 __params.put('ReceiverCNSStatus',cust.receiverCNSStatus);


var maskname= (empty(cust.firstName)?'':cust.firstName) + ' ' + (empty  (cust.middleName)?'':cust.middleName) + ' ' + (empty(cust.lastName)?'':cust.lastName);

  promptText = promptText +maskname;
  promptText = promptText + ', Phone number ';
  promptText = promptText + cust.basicIdentifier;
  promptText = promptText+'.	Charge for this transaction is:\n ';
  for(fee:feeList)
  {   
   promptText = promptText + ':The amount of charge is '+fee.amount;
 
   if(i < sizeLen)
   {
    promptText = promptText + ',';
   }
    i = i+1 
  }
   taxList = budgetMap.tax;
   i = 1;

   sizeLen = size(taxList);
  for(tax:taxList)
  {
     if(i ==1 &&  promptText != '')
   {
    promptText = promptText + ',';
   }
 
    promptText = promptText + ':The amount of tax is '+tax.amount;
   
   
   if(i <sizeLen)
   {
    promptText = promptText + ',';
   } 
   i = i+1;
  }
  if( promptText == '')
   {
     promptText =' No charge.';
   } 
 else
  {
    promptText =promptText +'.';
  } 
var promptText = promptText + '\n1. Yes\n2. No';

__params.put('TransOutgoingRequest@LIST@Param.PromptText',promptText);

accessDevice = CurReq.getIdentifierDef('AccessDevice');
__params.put('TransOutgoingRequest@LIST@Param.MSISDN',accessDevice.identifier);
__params.put('TransOutgoingRequest@LIST@Param.TransactionID',__sessionId);
AG.sendTransOutgoing(CurReq,__params,'19');
__next = '2';
}
}
else
{
  CurResp = TargetService.invokeForScript(); 
  __next='end';
}","1","Do Pre-Validation","Do Pre-Validation",""<endrec>
"Pre-Validation","","1","9486","2017","Send Outgoing from MFS to TSEL Point for API","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","2","9488","2017","Send Outgoing from MFS to TSEL Point for API","trxtype = CurReq.getValueFromBody('TransactionRequest.trxtype');
nfcUid = CurReq.getValueFromBody('TransactionRequest.msisdn');
keyword = CurReq.getValueFromBody('TransactionRequest.keyword');
trxid = CurReq.getValueFromBody('TransactionRequest.trxid');
channel = CurReq.getValueFromBody('TransactionRequest.channel');
identifierType = CurReq.getValueFromBody('TransactionRequest.Initiator.IdentifierType');
if(identifierType == '62' )
{
  msisdn= IC.queryMSISDNByNFCUID(nfcUid);
  if(empty(msisdn))
    {
	if(trxtype == 'RedeemPoint')
	{
          CurResp.putToBody('responseCode', 'BCS50073|||do not match between uid and msisdn at redeempoint'); 
	 }
	 else if(trxtype == 'RefundPoint')
	 {
           CurResp.putToBody('responseCode', 'BCS50073|||do not match between uid and msisdn at refundpoint'); 
	  }
    }
    else
    {
      __params.put('TransOutgoingRequest@LIST@Param.msisdn',msisdn);
      __params.put('TransOutgoingRequest@LIST@Param.keyword',keyword);
      __params.put('TransOutgoingRequest@LIST@Param.trxid',trxid);
      __params.put('TransOutgoingRequest@LIST@Param.channel',channel);
      __params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
        if (trxtype == 'RedeemPoint')
        {
          outgoingResp = AG.sendSyncTransOutgoing(__params,'120');
          outgoingRespBody = outgoingResp.getMsgBody();


            if (outgoingRespBody.RedeemTSELPointResponse.responseMsg == '001|||Timeout')
            {
               AG.addUnverifiedIfno('1000',msisdn,keyword,trxid);
 	       CurResp.putToBody('responseCode', outgoingRespBody.RedeemTSELPointResponse.responseMsg);
            }
	    else if(!Util.equals(Util.substring(outgoingRespBody.RedeemTSELPointResponse.responseMsg,0,3),'000'))
	    {
  	       CurResp.putToBody('responseCode', outgoingRespBody.RedeemTSELPointResponse.responseMsg);
	    }
	       CurResp.putToBody('responseCode', outgoingRespBody.RedeemTSELPointResponse.responseMsg);
        }
        else if (trxtype == 'RefundPoint')
        {
           outgoingResp = AG.sendSyncTransOutgoing(__params,'121');
           outgoingRespBody = outgoingResp.getMsgBody();
           responseMsg = outgoingRespBody.RefundTSELPointResponse.responseMsg;
           responseCode = Util.substring(responseMsg,0,3);
           if (responseMsg == '001|||Timeout')
           {
              AG.addUnverifiedIfno('1001',msisdn,keyword,trxid);
	      CurResp.putToBody('responseCode', responseMsg);
           }
           else if(!Util.equals(responseCode,'000'))
	    {
	       AG.addUnverifiedIfno('1001',msisdn,keyword,trxid);
  	       CurResp.putToBody('responseCode', responseMsg); 
	    }
	    CurResp.putToBody('responseCode', responseMsg); 
        }
        __next = 'end';

     }
}","1","sendRedeemPointMFS2TSEL","sendRedeemPointMFS2TSEL",""<endrec>
"TILL","","1","9493","2019","Apply OTP","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType='ApplyOTP';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* short code*/
__params.ReceiverPartyIdentifier = '2001';
__params.InitiatorIdentifierType = '01'; /* MSISDN  */
__params.InitiatorShortCode=identity.shortCode;
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","3","9496","2019","Apply OTP","var input = __input.response;
if (!emtpy(input)) {
__params.@HEAD@PIN = input;
  __params.PIN = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter PIN","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","9497","2019","Apply OTP","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html><body>Confirm to apply OTP?<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","9498","2019","Apply OTP","var input = __input.response;
if (!empty(input) && Util.isDigitString(input)) {
__params.MSISDN = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter MSISDN Number","<html>
<body>
Enter MSISDN Number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","9499","2020","Register SIM Card","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType='RegisterSIMCard';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '04'; /* short code*/
__params.ReceiverPartyIdentifier = '2001';
__params.InitiatorIdentifierType = '01'; /* MSISDN  */
__params.InitiatorShortCode=identity.shortCode;
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","6","9500","2020","Register SIM Card","var input = __input.response;
if (!emtpy(input)) {
__params.@HEAD@PIN = input;
  __params.PIN = input;
  __next = '6';
} else {
  __next = '5';
}","5","Enter PIN","<html>
<body>
Enter PIN <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","9501","2020","Register SIM Card","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html><body>Confirm to apply OTP?<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","9502","2020","Register SIM Card","var input = __input.response;
if (!empty(input) && Util.isDigitString(input)) {
__params.MSISDN = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter MSISDN Number","<html>
<body>
Enter MSISDN Number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","9503","2020","Register SIM Card","var input = __input.response;
if (!empty(input) && Util.isDigitString(input)) {
__params.CitizenID = input;
} else {
  __params.CitizenID = '';
}
__next = '3';","2","Enter User Citizen ID","<html>
<body>
Enter End user Citizen ID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","9504","2020","Register SIM Card","var input = __input.response;
__params.MotherName = input;
 __next = '4';","3","Enter Mother name of the end user","<html>
<body>
Enter Mother name of the end user<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","9505","2020","Register SIM Card","var input = __input.response;
if (!empty(input)) {
__params.OTP = input;
  __next = '5';
} else {
  __next = '4';
}","4","Enter OTP","<html>
<body>
Enter OTP<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","9506","2021","QueryIndosatBill for API","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","9507","2021","QueryIndosatBill for API","__next = 'end';","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","2","9509","2021","QueryIndosatBill for API","msisdn=CurReq.getValueFromBody('QueryIndosatBillRequest.MSISDN');
productCode=CurReq.getValueFromBody('QueryIndosatBillRequest.ProductCode');
__params.put('TransOutgoingRequest@LIST@Param.isGetFlag','true');
__params.put('TransOutgoingRequest@LIST@Param.BillNumber',msisdn);
__params.put('TransOutgoingRequest@LIST@Param.BillType','MSISDN');
__params.put('TransOutgoingRequest@LIST@Param.ProductCode',productCode);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
response=AG.sendSyncTransOutgoing(__params,'2');

if(!empty(response))
{
    billNumber = response.msgBody.SimponiBillInquiryResponse.BillNumber;
    billType = response.msgBody.SimponiBillInquiryResponse.BillType;
    billRef = response.msgBody.SimponiBillInquiryResponse.BillRef;
    customerName = response.msgBody.SimponiBillInquiryResponse.CustomerName;
    productCode = response.msgBody.SimponiBillInquiryResponse.ProductCode;
    billAmount = response.msgBody.SimponiBillInquiryResponse.Amount;
    errorCode = response.msgBody.SimponiBillInquiryResponse.ErrorCode;
    errorMessage = response.msgBody.SimponiBillInquiryResponse.ErrorMessage;
    
    if(!empty(errorCode))
    {
        if(errorCode == '10')
        {
            if(!empty(billAmount))
            {
                __params.BillNumber = billNumber;
                __params.BillType = billType;
                __params.BillRef = billRef;

                __params.CustomerName = customerName;
                __params.ProductCode = productCode;
                __params.Amount = billAmount;
                __params.ErrorCode = errorCode;
                __params.ErrorMessage = errorMessage;
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.BillNumber', billNumber);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.BillType', billType);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.BillRef', billRef);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.CustomerName', customerName);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.ProductCode', productCode);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.Amount', billAmount);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.ErrorCode', errorCode);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.ErrorMessage', errorMessage);
            }
        }
    }
}

CurResp = TargetService.invokeForScript(); 
__next = 'end';","1","process","process",""<endrec>
"Pre-Validation","","1","9510","2022","QueryIndosatBill for APP","__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","4","9511","2022","QueryIndosatBill for APP","__next = 'end';","error","Execute while errors occur","Send Message to Initiator",""<endrec>
"Pre-Validation","","2","9512","2022","QueryIndosatBill for APP","msisdn=CurReq.getValueFromBody('QueryIndosatBillRequest.MSISDN');
productCode=CurReq.getValueFromBody('QueryIndosatBillRequest.ProductCode');
__params.put('TransOutgoingRequest@LIST@Param.isGetFlag','true');
__params.put('TransOutgoingRequest@LIST@Param.BillNumber',msisdn);
__params.put('TransOutgoingRequest@LIST@Param.BillType','MSISDN');
__params.put('TransOutgoingRequest@LIST@Param.ProductCode',productCode);
__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
response=AG.sendSyncTransOutgoing(__params,'2');

if(!empty(response))
{
    billNumber = response.msgBody.SimponiBillInquiryResponse.BillNumber;
    billType = response.msgBody.SimponiBillInquiryResponse.BillType;
    billRef = response.msgBody.SimponiBillInquiryResponse.BillRef;
    customerName = response.msgBody.SimponiBillInquiryResponse.CustomerName;
    productCode = response.msgBody.SimponiBillInquiryResponse.ProductCode;
    billAmount = response.msgBody.SimponiBillInquiryResponse.Amount;
    errorCode = response.msgBody.SimponiBillInquiryResponse.ErrorCode;
    errorMessage = response.msgBody.SimponiBillInquiryResponse.ErrorMessage;
    
    if(!empty(errorCode))
    {
        if(errorCode == '10')
        {
            if(!empty(billAmount))
            {
                __params.BillNumber = billNumber;
                __params.BillType = billType;
                __params.BillRef = billRef;

                __params.CustomerName = customerName;
                __params.ProductCode = productCode;
                __params.Amount = billAmount;
                __params.ErrorCode = errorCode;
                __params.ErrorMessage = errorMessage;
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.BillNumber', billNumber);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.BillType', billType);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.BillRef', billRef);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.CustomerName', customerName);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.ProductCode', productCode);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.Amount', billAmount);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.ErrorCode', errorCode);
                OriginalReq.putToBodyForce('QueryIndosatBillRequest.ErrorMessage', errorMessage);
            }
        }
    }
}

CurResp = TargetService.invokeForScript(); 
__next = 'end';","1","process","process",""<endrec>
"TILL","","1","9659","2055","Query SIM Card Status","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType='QuerySIMCardStatus';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN  */
__params.InitiatorShortCode=identity.shortCode;
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","3","9660","2055","Query SIM Card Status","var input = __input.response;
if (!emtpy(input)) {
__params.@HEAD@PIN = input;
  __params.PIN = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter PIN","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","9661","2055","Query SIM Card Status","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to query?<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","9662","2055","Query SIM Card Status","var input = __input.response;
var length = size(input);
if (!empty(input) && Util.isDigitString(input) && length <= 20) {
__params.MSISDN = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter MSISDN Number","<html>
<body>
Enter MSISDN Number <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","9663","2056","Query SIM Card Quantity","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType='QuerySIMCardQuantity';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN  */
__params.InitiatorShortCode=identity.shortCode;
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","3","9664","2056","Query SIM Card Quantity","var input = __input.response;
if (!emtpy(input)) {
__params.@HEAD@PIN = input;
  __params.PIN = input;
  __next = '3';
} else {
  __next = '2';
}","2","Enter PIN","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","9665","2056","Query SIM Card Quantity","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to query?<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","9666","2056","Query SIM Card Quantity","var input = __input.response;
var length = size(input);
if (!empty(input) && Util.isDigitString(input) && length <= 30) {
__params.CitizenID = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter CitizenID Number","<html>
<body>
Enter CitizenID <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","9700","2063","Apply Voucher for Redeem Saldo Mobo Goods","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__params.RequesterIdentifierType= '01'; /* MSISDN */
__params.RequesterIdentifier = msisdn;
__next = '1';","begin","Initialization","",""<endrec>
"TILL","","2","9701","2063","Apply Voucher for Redeem Saldo Mobo Goods","var input = __input.response;
if (!emtpy(input)) {
__params.@HEAD@PIN = input;
  __params.PIN = input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter PIN","<html>
<body>
Enter pin <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","9702","2063","Apply Voucher for Redeem Saldo Mobo Goods","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0'){
  __next = 'cancel';
} else {
  __next = '2';
}","2","Confirm","<html><body>Confirm to apply voucher?<br>
1 OK <br>
0 Cancel <br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","1","9759","2076","Redeem Coupon","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.ActionType = 'RedeemCoupon';
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.InitiatorIdentifierType = '01'; /* MSISDN */
__params.InitiatorIdentifier = msisdn;
__next = '1';","begin","begin set parammeters","",""<endrec>
"CUSTOMER","","2","9760","2076","Redeem Coupon","var input = __input.response;
if (!empty(input)) {
  __params.CouponId= input;
  __next = '2';
} else {
  __next = '1';
}","1","Enter Coupon ID","<html>
<body>
Enter Coupon ID:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","3","9762","2076","Redeem Coupon","var input = __input.response;
if (!empty(input) && Validator.isDigit(input)) {
 __params.@HEAD@PIN = input;
    __next = '3';
} else {
    __secure = true;
    __next = '2';
}","2","Enter PIN","<html>
<body>
Enter PIN:<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"CUSTOMER","","4","9763","2076","Redeem Coupon","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if(input == '0') {
  __next = 'cancel';
} else {
  __next = '3';
}","3","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","9880","2100","Dompetku Cash In","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SHORT_CODE */
__params.ReceiverPartyIdentifier = '200000000000010001'; /* SHORT_CODE */
__params.InitiatorIdentifierType = '01'; /* MSISDN  */
__params.InitiatorShortCode=identity.shortCode;
__params.InitiatorIdentifier = msisdn;
 __next = '1';","begin","set parammeters","",""<endrec>
"TILL","","5","9883","2100","Dompetku Cash In","var input = __input.response;
if(empty(input))
{
__next = '4';
}
else
{
		__params.PIN = input;
		DompetkuMSISDN = IC.getDompetkuMsisdn(__params.InitiatorShortCode);
              __params.put('TransOutgoingRequest@LIST@Param.Initiator',DompetkuMSISDN);
		__params.put('TransOutgoingRequest@LIST@Param.MSISDN',__params.MSISDN);
		__params.put('TransOutgoingRequest@LIST@Param.DompetkuPIN',__params.DompetkuPIN);
		__params.put('TransOutgoingRequest@LIST@Param.needEncrypt',__params.needEncrypt);
		__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
		response=AG.sendGOAOutgoingByParams(__params,'124',__sessionId);
		if(!empty(response))
		{
		  customerName = response.msgBody.GOAQueryDompetkuCustomerResponse.CustomerName;
                transid = response.msgBody.GOAQueryDompetkuCustomerResponse.Transid;
		  if(!empty(customerName) && !empty(transid))
		  {
			__params.CustomerName = customerName;
           		 __params.Transid = transid;
			__next = '5';
		  }
		  else
		  {
			 __next = '6';
		  }
		}
		else
		{
		  __next = '6';
		}		 
}","4","Enter your PIN code","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","6","9884","2100","Dompetku Cash In","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '5';
}","5","Confirm","<html>
<body>
Please confirm Cash In with CustomerName ${__params.CustomerName} from Dompetku wallet<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","9885","2100","Dompetku Cash In","var input = __input.response;
if(empty(input))
{
  __next = '3';
}
else
{
__params.DompetkuPIN = Util.encrypt(input);
__params.needEncrypt = 'Y';
__next = '4';
}","3","Enter Dompetku Pin","<html>
<body>
Enter Dompetku Pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","9887","2100","Dompetku Cash In","var input = __input.response;
if(empty(input))
{
  __next = '1';
}
else
{
__params.MSISDN = input;
__next = '2';
}","1","Input Customer MSISDN","<html>
<body>
Input Customer MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","9889","2100","Dompetku Cash In","__next = 'cancel';","6","Query Dompetku Customer error","<html>
<body>
Query Dompetku Customer error<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","9900","2100","Dompetku Cash In","var input = __input.response;
if(empty(input))
{
  __next = '2';
}
else
{
__params.Amount = input;
__next = '3';
}","2","Input Amount","<html>
<body>
Input Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","1","9901","2102","Dompetku Cash Out","__params.ServiceCode = __service.serviceCode;
__params.Channel = universalSessionID.channelType;
__params.AccessDeviceIdentifierType = '01';   /* MSISDN */
__params.AccessDeviceIdentifier = msisdn;
__params.ReceiverPartyIdentifierType = '10'; /* SHORT_CODE */
__params.ReceiverPartyIdentifier = '200000000000010001'; /* SHORT_CODE */
__params.InitiatorIdentifierType = '01'; /* MSISDN  */
__params.InitiatorShortCode=identity.shortCode;
__params.InitiatorIdentifier = msisdn;
 __next = '1';","begin","set parammeters","",""<endrec>
"TILL","","6","9902","2102","Dompetku Cash Out","var input = __input.response;
if(empty(input))
{
  __next = '5';
}
else
{
__params.PIN = input;
  __next = '6';
}","5","Enter your PIN code","<html>
<body>
Enter PIN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","7","9903","2102","Dompetku Cash Out","var input = __input.response;
if (input == '1') {
  __next = 'end';
} else if (input == '0') {
  __next = 'cancel';
} else {
  __next = '6';
}","6","Confirm","<html>
<body>
Confirm to submit?<br>
1 OK<br>
0 Cancel<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","5","9904","2102","Dompetku Cash Out","var input = __input.response;
if(empty(input))
{
  __next = '4';
}
else
{
__params.DompetkuPIN = Util.encrypt(input);
__params.needEncrypt = 'Y';
__next = '5';
}","4","Enter Dompetku Pin","<html>
<body>
Enter Dompetku Pin<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","2","9905","2102","Dompetku Cash Out","var input = __input.response;
if(empty(input))
{
  __next = '1';
}
else
{
__params.MSISDN = input;
__next = '2';
}","1","Input Customer MSISDN","<html>
<body>
Input Customer MSISDN<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","4","9907","2102","Dompetku Cash Out","var input = __input.response;
if(empty(input))
{
  __next = '3';
}
else
{
__params.Amount = input;
__next = '4';
}","3","Input Amount","<html>
<body>
Input Amount<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"TILL","","3","9908","2102","Dompetku Cash Out","var input = __input.response;
if(empty(input))
{
  __next = '2';
}
else
{
__params.Token = input;
__next = '3';
}","2","Input Token Number","<html>
<body>
Input Token Number<br>
<a href=""${mobilemoneyURL}"" default=""yes""></a>
</body>
</html>",""<endrec>
"Pre-Validation","","1","9941","2111","Dompetku Cash In for API","MSISDN = CurReq.getValueFromBody('TransactionRequest.MSISDN'); 
DompetkuPIN = CurReq.getValueFromBody('TransactionRequest.DompetkuPIN'); 
Amount = CurReq.getValueFromBody('TransactionRequest.Amount'); 
Transid = CurReq.getValueFromBody('TransactionRequest.Transid');

OriginalReq.putValue4ReferenceData(""MSISDN"",MSISDN);   
OriginalReq.putValue4ReferenceData(""DompetkuAmount"",Amount);   
OriginalReq.putValue4ReferenceData(""DompetkuTransid"" ,Transid);   

sysDiscountTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_DISCOUNT_LOCATION_VALIDATION');
sysCommissionTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_COMMISSION_LOCATION_VALIDATION');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success'); 
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success'); 

__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9942","2111","Dompetku Cash In for API","CurResp = TargetService.invokeForScript(); 
__next = 'end';","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","4","9943","2111","Dompetku Cash In for API","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9944","2111","Dompetku Cash In for API","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification');   
	__next = '2';
}
else
{
	if(empty(GPSPosition))
	{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success'); 
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification');   
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{
		
		locationList = Util.getLocationXAndY(GPSPosition);
		__params.aLAC = locationList.get(0);
		__params.aCI = locationList.get(1);
		
var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aCI,__params.aLAC);
if(resultACommissionMap.ResultCode == 'SYS00000')
{
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
}
else
{

OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed'); 
}

		OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
			OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification');   
			  CurResp = TargetService.invokeForScript(); 
			  __next = 'end';
	}
}","1","Record Identity Territory","Record Identity Territory",""<endrec>
"Pre-Validation","","1","9949","2113","Dompetku Cash In for APP","MSISDN = CurReq.getValueFromBody('TransactionRequest.MSISDN'); 
DompetkuPIN = CurReq.getValueFromBody('TransactionRequest.DompetkuPIN'); 
Amount = CurReq.getValueFromBody('TransactionRequest.Amount'); 
Transid = CurReq.getValueFromBody('TransactionRequest.Transid');

OriginalReq.putValue4ReferenceData(""MSISDN"",MSISDN);   
OriginalReq.putValue4ReferenceData(""DompetkuAmount"",Amount);   
OriginalReq.putValue4ReferenceData(""DompetkuTransid"" ,Transid);   

sysDiscountTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_DISCOUNT_LOCATION_VALIDATION');
sysCommissionTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_COMMISSION_LOCATION_VALIDATION');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success'); 
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success'); 

__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receipts = IC.queryPreValidationNotification(initiator,initiator.shortCode,0,null);
amsisdn = receipts.get(0).recipients;
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9950","2113","Dompetku Cash In for APP","__params.aLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
__params.aCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(__params.aLAC) && !empty(__params.aCI))
{ 
	var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aCI,__params.aLAC);
	if(resultACommissionMap.ResultCode == 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
	}
	else
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed'); 
	}
	OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);
	territoryType = '2';
	var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode == 'SYS00000')
	{ 
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId); 
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Success'); 
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{ 

		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Failed'); 
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	} 
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success'); 
	OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification'); 
	CurResp = TargetService.invokeForScript(); 
	__next = 'end';
}","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","4","9951","2113","Dompetku Cash In for APP","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9952","2113","Dompetku Cash In for APP","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
	__next = '2';
}
else
{
	if(empty(GPSPosition))
	{
	__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId); 
	__params.put('TransOutgoingRequest@LIST@Param.msisdn',amsisdn);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
	__asyncTaskList = AG.sendTransOutgoingWithAsncTask(CurReq,__params,'71');
	__next = '2'; 
	}
	else
	{
		
		locationList = Util.getLocationXAndY(GPSPosition);
		__params.aLAC = locationList.get(0);
		__params.aCI = locationList.get(1);
		
			var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aCI,__params.aLAC);
			if(resultACommissionMap.ResultCode == 'SYS00000')
			{
			OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
			}
			else
			{
			OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed'); 
			}
			territoryType = '2';

			var resultMap  = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType ,'1','2',__params.aLAC,__params.aCI);
			if(resultMap.ResultCode == 'SYS00000')
			{ 
				OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId); 
				OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Success'); 
				CurResp = TargetService.invokeForScript(); 
				__next = 'end';
			}
			else
			{ 
				OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
				OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Failed'); 
				CurResp = TargetService.invokeForScript(); 
				__next='error';
			} 
	}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","1","9953","2114","Dompetku Cash In for USSD","MSISDN = CurReq.getValueFromBody('TransactionRequest.MSISDN'); 
Amount = CurReq.getValueFromBody('TransactionRequest.Amount'); 
Transid = CurReq.getValueFromBody('TransactionRequest.Transid');

OriginalReq.putValue4ReferenceData(""MSISDN"",MSISDN);   
OriginalReq.putValue4ReferenceData(""DompetkuAmount"",Amount);   
OriginalReq.putValue4ReferenceData(""DompetkuTransid"" ,Transid);   

sysDiscountTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_DISCOUNT_LOCATION_VALIDATION');
sysCommissionTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_COMMISSION_LOCATION_VALIDATION');

OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success'); 
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success'); 

__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receipts = IC.queryPreValidationNotification(initiator,initiator.shortCode,0,null);
amsisdn = receipts.get(0).recipients;
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
__params.aLAC= CurReq.getValueFromBody('TransactionRequest.aLAC');
__params.aCI= CurReq.getValueFromBody('TransactionRequest.aCI');
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9954","2114","Dompetku Cash In for USSD","__params.aLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
__params.aCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(__params.aLAC) && !empty(__params.aCI))
{ 
	var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aCI,__params.aLAC);
	if(resultACommissionMap.ResultCode == 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
	}
	else
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed'); 
	}
	OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);
	territoryType = '2';
	var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode == 'SYS00000')
	{ 
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId); 
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Success'); 
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{ 

		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Failed'); 
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	} 
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success'); 
	OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification'); 
	CurResp = TargetService.invokeForScript(); 
	__next = 'end';
}","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","4","9955","2114","Dompetku Cash In for USSD","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9956","2114","Dompetku Cash In for USSD","if(empty(__params.aLAC) || empty(__params.aCI))
{
	__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId); 
	__params.put('TransOutgoingRequest@LIST@Param.msisdn',amsisdn);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
	__asyncTaskList = AG.sendTransOutgoingWithAsncTask(CurReq,__params,'71');
	__next = '2'; 
}
else
{
	var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aCI,__params.aLAC);
	if(resultACommissionMap.ResultCode == 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
	}
	else
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed'); 
	}

	OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);

	territoryType = '2';
	var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode == 'SYS00000')
	{ 
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId); 
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Success'); 

		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{ 
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Failed'); 
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}  
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","1","9957","2115","Dompetku Cash In for Web","MSISDN = CurReq.getValueFromBody('TransactionRequest.MSISDN'); 
if(empty(MSISDN))
{
   MSISDN = CurReq.getValueFromBody('TransactionRequest.RequestContext.Parameter.MSISDN'); 
}

Amount = CurReq.getValueFromBody('TransactionRequest.Amount'); 
if(empty(Amount))
{
   Amount = CurReq.getValueFromBody('TransactionRequest.RequestContext.Parameter.Amount'); 
}
Transid = CurReq.getValueFromBody('TransactionRequest.Transid');
if(empty(Transid))
{
   Transid = CurReq.getValueFromBody('TransactionRequest.RequestContext.Parameter.Transid'); 
}

OriginalReq.putValue4ReferenceData(""MSISDN"",MSISDN);   
OriginalReq.putValue4ReferenceData(""DompetkuAmount"",Amount);   
OriginalReq.putValue4ReferenceData(""DompetkuTransid"" ,Transid);   

sysDiscountTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_DISCOUNT_LOCATION_VALIDATION');
sysCommissionTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_COMMISSION_LOCATION_VALIDATION');

OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success'); 
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success'); 

__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9958","2115","Dompetku Cash In for Web","CurResp = TargetService.invokeForScript(); 
__next = 'end';","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","4","9959","2115","Dompetku Cash In for Web","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9960","2115","Dompetku Cash In for Web","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
       OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification');   
	__next = '2';
}
else
{
	if(empty(GPSPosition))
	{
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification');   
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{
		
		locationList = Util.getLocationXAndY(GPSPosition);
		__params.aLAC = locationList.get(0);
		__params.aCI = locationList.get(1);
		OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
			
		var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aCI,__params.aLAC);
		if(resultACommissionMap.ResultCode == 'SYS00000')
		{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
		}
		else
		{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed'); 
		}


		if(!empty(__params.aLAC) && !empty(__params.aCI) )
		{
			OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
			
				territoryType = '2';
				var resultMap =
 IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
				if(resultMap.ResultCode == 'SYS00000')
				{ 
				   
				 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
						  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Success');  
						  CurResp = TargetService.invokeForScript(); 
						  __next = 'end';
				}
				else
				{				  
						 OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
						 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Failed');    
						 CurResp = TargetService.invokeForScript(); 
						 __next='error';
				}		 
			
		}
		else
		{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success'); 
        OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 

			  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification');   
			  CurResp = TargetService.invokeForScript(); 
			  __next = 'end';
		}		
	}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","1","9961","2116","Dompetku Cash Out for API","MSISDN = CurReq.getValueFromBody('TransactionRequest.MSISDN'); 
DompetkuPIN = CurReq.getValueFromBody('TransactionRequest.DompetkuPIN'); 
Amount = CurReq.getValueFromBody('TransactionRequest.Amount'); 
TokenNumber = CurReq.getValueFromBody('TransactionRequest.Token');

OriginalReq.putValue4ReferenceData(""MSISDN"",MSISDN);   
OriginalReq.putValue4ReferenceData(""DompetkuAmount"",Amount);   
OriginalReq.putValue4ReferenceData(""TokenNumber"" ,TokenNumber);   

sysDiscountTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_DISCOUNT_LOCATION_VALIDATION');
sysCommissionTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_COMMISSION_LOCATION_VALIDATION');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success'); 
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success'); 

__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9962","2116","Dompetku Cash Out for API","CurResp = TargetService.invokeForScript(); 
__next = 'end';","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","4","9963","2116","Dompetku Cash Out for API","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9964","2116","Dompetku Cash Out for API","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
	__next = '2';
}
else
{
	if(empty(GPSPosition))
	{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success'); 
    OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{
		
		locationList = Util.getLocationXAndY(GPSPosition);
		__params.aLAC = locationList.get(0);
		__params.aCI = locationList.get(1);
		
var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aCI,__params.aLAC);
if(resultACommissionMap.ResultCode == 'SYS00000')
{
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
}
else
{
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed'); 
}

		OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);

			OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification');   
			  CurResp = TargetService.invokeForScript(); 
			  __next = 'end';
	}
}","1","Record Identity Territory","Record Identity Territory",""<endrec>
"Pre-Validation","","1","9965","2117","Dompetku Cash Out for APP","MSISDN = CurReq.getValueFromBody('TransactionRequest.MSISDN'); 
DompetkuPIN = CurReq.getValueFromBody('TransactionRequest.DompetkuPIN'); 
Amount = CurReq.getValueFromBody('TransactionRequest.Amount'); 
TokenNumber = CurReq.getValueFromBody('TransactionRequest.Token');

OriginalReq.putValue4ReferenceData(""MSISDN"",MSISDN);   
OriginalReq.putValue4ReferenceData(""DompetkuAmount"",Amount);   
OriginalReq.putValue4ReferenceData(""TokenNumber"" ,TokenNumber);   

sysDiscountTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_DISCOUNT_LOCATION_VALIDATION');
sysCommissionTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_COMMISSION_LOCATION_VALIDATION');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success'); 
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success'); 

__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receipts = IC.queryPreValidationNotification(initiator,initiator.shortCode,0,null);
amsisdn = receipts.get(0).recipients;
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9966","2117","Dompetku Cash Out for APP","__params.aLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
__params.aCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(__params.aLAC) && !empty(__params.aCI))
{ 
	var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aCI,__params.aLAC);
	if(resultACommissionMap.ResultCode == 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
	}
	else
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed'); 
	}
	OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);
	territoryType = '2';
	var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode == 'SYS00000')
	{ 
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId); 
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Success'); 
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{ 

		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Failed'); 
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	} 
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success'); 
	OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification'); 
	CurResp = TargetService.invokeForScript(); 
	__next = 'end';
}","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","4","9967","2117","Dompetku Cash Out for APP","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9968","2117","Dompetku Cash Out for APP","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
	__next = '2';
}
else
{
	if(empty(GPSPosition))
	{
	__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId); 
	__params.put('TransOutgoingRequest@LIST@Param.msisdn',amsisdn);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
	__asyncTaskList = AG.sendTransOutgoingWithAsncTask(CurReq,__params,'71');
	__next = '2'; 
	}
	else
	{
		
		locationList = Util.getLocationXAndY(GPSPosition);
		__params.aLAC = locationList.get(0);
		__params.aCI = locationList.get(1);
		
			var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aCI,__params.aLAC);
			if(resultACommissionMap.ResultCode == 'SYS00000')
			{
			OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
			}
			else
			{
			OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed'); 
			}
			territoryType = '2';

			var resultMap  = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType ,'1','2',__params.aLAC,__params.aCI);
			if(resultMap.ResultCode == 'SYS00000')
			{ 
				OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId); 
				OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Success'); 
				CurResp = TargetService.invokeForScript(); 
				__next = 'end';
			}
			else
			{ 
				OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
				OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Failed'); 
				CurResp = TargetService.invokeForScript(); 
				__next='error';
			} 
	}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","1","9969","2118","Dompetku Cash Out for USSD","MSISDN = CurReq.getValueFromBody('TransactionRequest.MSISDN'); 
DompetkuPIN = CurReq.getValueFromBody('TransactionRequest.DompetkuPIN'); 
Amount = CurReq.getValueFromBody('TransactionRequest.Amount'); 
TokenNumber = CurReq.getValueFromBody('TransactionRequest.Token');

OriginalReq.putValue4ReferenceData(""MSISDN"",MSISDN);   
OriginalReq.putValue4ReferenceData(""DompetkuAmount"",Amount);   
OriginalReq.putValue4ReferenceData(""TokenNumber"" ,TokenNumber);   

sysDiscountTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_DISCOUNT_LOCATION_VALIDATION');
sysCommissionTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_COMMISSION_LOCATION_VALIDATION');
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success'); 
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success'); 

__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receipts = IC.queryPreValidationNotification(initiator,initiator.shortCode,0,null);
amsisdn = receipts.get(0).recipients;
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9970","2118","Dompetku Cash Out for USSD","__params.aLAC=CurReq.getValueFromBody('TransactionEventRequest.LAC');
__params.aCI=CurReq.getValueFromBody('TransactionEventRequest.CellID');
if(!empty(__params.aLAC) && !empty(__params.aCI))
{ 
	var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aCI,__params.aLAC);
	if(resultACommissionMap.ResultCode == 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
	}
	else
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed'); 
	}
	OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);
	territoryType = '2';
	var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode == 'SYS00000')
	{ 
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId); 
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Success'); 
		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{ 

		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Failed'); 
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	} 
}
else
{
	OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success'); 
	OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification'); 
	CurResp = TargetService.invokeForScript(); 
	__next = 'end';
}","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","4","9971","2118","Dompetku Cash Out for USSD","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9972","2118","Dompetku Cash Out for USSD","if(empty(__params.aLAC) || empty(__params.aCI))
{
	__params.put('TransOutgoingRequest@LIST@Param.tid',__sessionId); 
	__params.put('TransOutgoingRequest@LIST@Param.msisdn',amsisdn);
	__params.put('TransOutgoingRequest@LIST@Param.ShortCode','0');
	__asyncTaskList = AG.sendTransOutgoingWithAsncTask(CurReq,__params,'71');
	__next = '2'; 
}
else
{
	var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aCI,__params.aLAC);
	if(resultACommissionMap.ResultCode == 'SYS00000')
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
	}
	else
	{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed'); 
	}

	OriginalReq.putValue4ReferenceData('A#CellID',__params.aCI);
	OriginalReq.putValue4ReferenceData('A#LAC',__params.aLAC);

	territoryType = '2';
	var resultMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
	if(resultMap.ResultCode == 'SYS00000')
	{ 
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId); 
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Success'); 

		CurResp = TargetService.invokeForScript(); 
		__next = 'end';
	}
	else
	{ 
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
		OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Failed'); 
		CurResp = TargetService.invokeForScript(); 
		__next='error';
	}  
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
"Pre-Validation","","1","9973","2119","Dompetku Cash Out for Web","MSISDN = CurReq.getValueFromBody('TransactionRequest.MSISDN'); 
if(empty(MSISDN))
{
   MSISDN = CurReq.getValueFromBody('TransactionRequest.RequestContext.Parameter.MSISDN'); 
}
Amount = CurReq.getValueFromBody('TransactionRequest.Amount'); 
if(empty(Amount))
{
   Amount = CurReq.getValueFromBody('TransactionRequest.RequestContext.Parameter.Amount'); 
}
TokenNumber = CurReq.getValueFromBody('TransactionRequest.Token');
if(empty(TokenNumber))
{
   TokenNumber = CurReq.getValueFromBody('TransactionRequest.RequestContext.Parameter.Token'); 
}


OriginalReq.putValue4ReferenceData(""MSISDN"",MSISDN);   
OriginalReq.putValue4ReferenceData(""DompetkuAmount"",Amount);   
OriginalReq.putValue4ReferenceData(""TokenNumber"" ,TokenNumber);   

sysDiscountTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_DISCOUNT_LOCATION_VALIDATION');
sysCommissionTerritoryType = Util.getSysParameter('TERRITORY_LEVEL_OF_COMMISSION_LOCATION_VALIDATION');

OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNTerritoryVerificationResult','Success'); 
OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.MSISDNCommissionTerritoryVerificationResult','Success'); 

__params.__sessionId= __sessionId;
initiator = CurReq.getIdentifierDef('Initiator');
receiverParty = CurReq.getIdentifierDef('ReceiverParty');
GPSPosition = CurReq.getValueFromBody('TransactionRequest.GPSPosition');
if(!empty(GPSPosition))
{
 OriginalReq.putValue4ReferenceData('GPSPosition',GPSPosition);
}
__next = '1';","begin","set parammeters","",""<endrec>
"Pre-Validation","","3","9974","2119","Dompetku Cash Out for Web","CurResp = TargetService.invokeForScript(); 
__next = 'end';","2","Confirm Initiate Transaction","Confirm Initiate Transaction",""<endrec>
"Pre-Validation","","4","9975","2119","Dompetku Cash Out for Web","notificationInfoList = IC.queryNotificationMsisdn(CurReq,'Initiator','500000000000010001');
NC.sendPreValidationNotification(notificationInfoList ,__accessChannel,101000000000001078,__params);","error","Execute while errors occur","Execute while errors occur",""<endrec>
"Pre-Validation","","2","9976","2119","Dompetku Cash Out for Web","var isPreValidation=CurReq.hasValueInBody('TransactionRequest.IsPreValidation', 'true');
if (isPreValidation)
{
	CurResp=TC.calculateFeeForPortal(CurReq,__sessionId);
	OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification');   
	__next = '2';
}
else
{
	if(empty(GPSPosition))
	{
		CurResp = TargetService.invokeForScript(); 
					OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification');   
		__next = 'end';
	}
	else
	{
		
		locationList = Util.getLocationXAndY(GPSPosition);
		__params.aLAC = locationList.get(0);
		__params.aCI = locationList.get(1);
		OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
			
		var resultACommissionMap = IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,sysCommissionTerritoryType,'1',__params.aCI,__params.aLAC);
		if(resultACommissionMap.ResultCode == 'SYS00000')
		{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 
		}
		else
		{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Failed'); 
		}


		if(!empty(__params.aLAC) && !empty(__params.aCI) )
		{
			OriginalReq.putValue4ReferenceData('A#CellID',__params.aLAC);
			OriginalReq.putValue4ReferenceData('A#LAC',__params.aCI);
			
				territoryType = '2';
				var resultMap =
 IC.verifyIdentityTerritory(initiator.identifier,initiator.identifierType.toCode(),initiator.shortCode,territoryType,'1',__params.aLAC,__params.aCI);
				if(resultMap.ResultCode == 'SYS00000')
				{ 
				   
				 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryId"",resultMap.TerritoryId);   
						  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Success');  
						  CurResp = TargetService.invokeForScript(); 
						  __next = 'end';
				}
				else
				{				  
						 OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.isValifyFailed','true');
						 OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'Failed');    
						 CurResp = TargetService.invokeForScript(); 
						 __next='error';
				}		 
			
		}
		else
		{
		OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorTerritoryVerificationResult','Success'); 
        OriginalReq.putToBodyAsKeyValue('TransactionRequest.RequestContext.Parameter.InitiatorCommissionTerritoryVerificationResult','Success'); 

			  OriginalReq.putValue4ReferenceData(""InitiatorTerritoryVerificationResult"",'NotVerification');   
			  CurResp = TargetService.invokeForScript(); 
			  __next = 'end';
		}		
	}
}","1","Verify Identity Territory","Verify Identity Territory",""<endrec>
